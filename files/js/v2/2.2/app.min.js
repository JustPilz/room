pdfprint = 1;var LIB={};function is_a_number(e){return 0<=(e=parseInt(e))||e<=0}function is_point_exists(e){return is_a_number(e.x)&&is_a_number(e.y)}function is_point_not_zero(e){return 0===e.x&&0===e.y}function compare_distances(e,t){return e.distance-t.distance}function compare_areas(e,t){return e.area-t.area}function get_projection(e,t){var i=t.s,n=t.e,e={x:i.x+(n.x-i.x)*(((e.x-i.x)*(n.x-i.x)+(e.y-i.y)*(n.y-i.y))/(Math.pow(n.x-i.x,2)+Math.pow(n.y-i.y,2))),y:i.y+(n.y-i.y)*(((e.x-i.x)*(n.x-i.x)+(e.y-i.y)*(n.y-i.y))/(Math.pow(n.x-i.x,2)+Math.pow(n.y-i.y,2)))};return!!is_point_on_line(e,t)&&e}function is_point_inside_polygon(i,n){for(let t=0;t<n.length;t++){let e=get_line(n[t],n[t+1]);if(is_point_on_line(i,e=t===n.length-1?get_line(n[t],n[0]):e))return!1}let s=!1;for(let e=0,t=n.length-1;e<n.length;t=e++){var o=n[e].x,l=n[e].y,r=n[t].x,a=n[t].y;l>i.y!=a>i.y&&i.x<(r-o)*(i.y-l)/(a-l)+o&&(s=!s)}return s}function is_point_over_polygon(i,n){let s=!1;for(let e=0,t=n.length-1;e<n.length;t=e++){var o=n[e].x,l=n[e].y,r=n[t].x,a=n[t].y;l>i.y!=a>i.y&&i.x<(r-o)*(i.y-l)/(a-l)+o&&(s=!s)}return s}function point_in_polygon(i,n){for(let t=0;t<n.length;t++){let e=get_line(n[t],n[t+1]);if(is_point_on_line(i,e=t===n.length-1?get_line(n[t],n[0]):e))return!0}let s=!1;for(let e=0,t=n.length-1;e<n.length;t=e++){var o=n[e].x,l=n[e].y,r=n[t].x,a=n[t].y;l>i.y!=a>i.y&&i.x<(r-o)*(i.y-l)/(a-l)+o&&(s=!s)}return s}function are_lines_perpendicular_BAK(e,t){let i=e.e.x-e.s.x,n=e.e.y-e.s.y,s=t.e.x-t.s.x,o=t.e.y-t.s.y;return i*s+n*o==0}function are_lines_perpendicular(e,t){var e=get_big_line(e),t=get_big_line(t),i=line_and_line_intersection(e,t);return!!i&&(89<=(e=get_angle(e.s,i,t.s))&&e<=91)}function get_perpendicular_line(e,t,i){return get_line(get_point_near_line_point(e,t,i/2,"L"),get_point_near_line_point(e,t,i/2,"R"))}function compare_descending(e,t){return t<e?-1:e<t?1:0}function compare_ascending(e,t){return e<t?-1:t<e?1:0}function show_point(e,t,i){return i=i||"red",t=t||2,svg.circle(t).cx(e.x).cy(e.y).attr({stroke:i,"stroke-width":1,fill:i})}function show_line(e,t,i){return i=i||"red",t=t||.4,svg.line(e.s.x,e.s.y,e.e.x,e.e.y).attr({stroke:i,"stroke-width":t})}function get_distance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function get_point_to_line_distance(e,t){t=LIB.projection(e,t);return!!t&&get_distance(e,t)}function get_line_length(e){return Math.sqrt(Math.pow(e.s.x-e.e.x,2)+Math.pow(e.s.y-e.e.y,2))}function get_center(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}function get_line_center(e){return{x:(e.s.x+e.e.x)/2,y:(e.s.y+e.e.y)/2}}function get_normal(e,t){t=get_center(e,t);return{s:{x:t.x+1e3*(e.y-t.y),y:t.y+1e3*(t.x-e.x)},e:{x:t.x+-1e3*(e.y-t.y),y:t.y+-1e3*(t.x-e.x)}}}function getPolygon(e,t){return"small"===(t=t||"small")?[e.l1,e.l2,e.r2,e.r1]:"big"===t?[e.s,e.l1,e.l2,e.e,e.r2,e.r1]:void 0}function get_parallel(e,t,i,n){i=get_point_near_line_center(e,t,i,n);return{s:{x:i.x-5*(t.x-e.x),y:i.y-5*(t.y-e.y)},e:{x:i.x- -5*(t.x-e.x),y:i.y- -5*(t.y-e.y)}}}function get_point_near_line_point(e,t,i,n){return console.warn(),get_point_projection(t,get_parallel(e.s,e.e,i,n))}function are_lines_collinear(e,t){e=get_vector(e),t=get_vector(t);return e.x*t.y-t.x*e.y==0}function get_point_near_line_center(e,t,i,n){var s=get_distance(e,t);return"R"===n?{x:(e.x+t.x)/2+i*(e.y-t.y)/s,y:(e.y+t.y)/2-i*(e.x-t.x)/s}:"L"===n?{x:(e.x+t.x)/2-i*(e.y-t.y)/s,y:(e.y+t.y)/2+i*(e.x-t.x)/s}:void 0}function point_near_line_end_point(e,t,i,n){var s=get_distance(e,t);return"R"===n?{x:t.x-(t.y-e.y)*i/s,y:t.y+(t.x-e.x)*i/s}:"L"===n?{x:t.x+(t.y-e.y)*i/s,y:t.y-(t.x-e.x)*i/s}:void 0}function point_near_line_end(e,t,i,n){var s=get_distance(e,t);return"R"===n?{x:t.x-(t.y-e.y)*i/s,y:t.y+(t.x-e.x)*i/s}:"L"===n?{x:t.x+(t.y-e.y)*i/s,y:t.y-(t.x-e.x)*i/s}:void 0}function are_points_equal(e,t,i=.5){return Math.abs(e.x-t.x)<=.5&&Math.abs(e.y-t.y)<=i}function are_points_equal2(e,t){return get_distance(e,t)<1}function point_to_line_projection(e,t){var i=t.s,t=t.e;return{x:i.x+(t.x-i.x)*(((e.x-i.x)*(t.x-i.x)+(e.y-i.y)*(t.y-i.y))/(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))),y:i.y+(t.y-i.y)*(((e.x-i.x)*(t.x-i.x)+(e.y-i.y)*(t.y-i.y))/(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))}}function is_point_on_straight(e,t){return(t.s.x-e.x)*(t.e.y-e.y)==(t.e.x-e.x)*(t.s.y-e.y)}function are_lines_on_straight(e,t){return is_point_on_straight(e.s,t)&&is_point_on_straight(e.e,t)}function get_vector_length(e){var t=Math.pow(e.x),e=Math.pow(e.y);return Math.abs(Math.sqrt(t+e))}function get_angle_old(e,t,i,n){void 0===n&&(n="deg");var s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),t=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),i=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));let o;return"rad"===n&&(o=Math.acos((t*t+s*s-i*i)/(2*t*s))),"deg"===n&&(o=180*Math.acos((t*t+s*s-i*i)/(2*t*s))/Math.PI,0===(o=isNaN(o)?180:o)&&(o=180)),Math.round(o)}function get_angle_OLD(e,t,i,n){let s=e.x-t.x,o=e.y-t.y,l=i.x-t.x,r=i.y-t.y,a;return"rad"===(n=void 0===n?"deg":n)&&(a=Math.atan2(s*r-o*l,s*l+o*r)),"deg"===n&&(a=180*Math.atan2(s*r-o*l,s*l+o*r)/Math.PI),isNaN(a)&&console.log("Scheiße!"),Math.abs(Math.round(a))}function get_angle(e,t,i){let n=e.x-t.x,s=e.y-t.y,o=i.x-t.x,l=i.y-t.y,r=180*Math.atan2(n*l-s*o,n*o+s*l)/Math.PI;return isNaN(r)&&console.log("get_angle: Scheiße!",e,t,i),Math.abs(r.toFixed(2))}function get_two_lines_angle(e,t){var e=get_vector(e),t=get_vector(t),i=e.x*t.x+e.y*t.y,e=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))*Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),t=Math.acos(i/e),t=Math.round(180*t/Math.PI);return isNaN(t)||0===t?180:t}function is_line_on_straight(e,t){var t=get_big_line(t),i=is_point_on_line(e.s,t,.5),e=is_point_on_line(e.e,t,.5);return i&&e}function get_line_orientation(e){var t=0<=Math.abs(e.s.x-e.e.x)&&Math.abs(e.s.x-e.e.x)<.1&&e.s.y!==e.e.y,e=0<=Math.abs(e.s.y-e.e.y)&&Math.abs(e.s.y-e.e.y)<.1&&e.s.x!==e.e.x;return!0==t?"V":!0==e?"H":"D"}function get_path___(){this.p1.x,this.p1.y,this.p2.x,this.p2.y,this.p3.x,this.p3.y,this.p4.x,this.p4.y}function get_polygon_centroid(e){let i=e.slice();var n=i[0],e=i[i.length-1];n.x==e.x&&n.y==e.y||i.push(n);let s=0,o=0,l=0,r=i.length,a,h,g;for(let e=0,t=r-1;e<r;t=e++)a=i[e],h=i[t],g=(a.y-n.y)*(h.x-n.x)-(h.y-n.y)*(a.x-n.x),s+=g,o+=(a.x+h.x-2*n.x)*g,l+=(a.y+h.y-2*n.y)*g;return g=3*s,{x:o/g+n.x,y:l/g+n.y}}function get_polygon_edges(n){let s=[];for(let i=0;i<n.length;i++){let e=n[i],t;t=i===n.length-1?n[0]:n[i+1],s.push(get_line(e,t))}return s}function is_point_on_line(e,t,i=.01){return!!are_points_equal(e,t.s)||(!!are_points_equal(e,t.e)||Math.abs(get_distance(t.s,e)+get_distance(t.e,e)-get_distance(t.s,t.e))<i)}function is_point_on_line_v2(e,t,i=.5){if(are_points_equal(e,t.s))return!0;if(are_points_equal(e,t.e))return!0;t=LIB.projection(e,t);return!!(t&&get_distance(e,t)<i)}function is_point_on_line_1_sm(e,t,i=.01){return!!are_points_equal(e,t.s,1)||(!!are_points_equal(e,t.e,1)||Math.abs(get_distance(t.s,e)+get_distance(t.e,e)-get_distance(t.s,t.e))<i)}function is_point_close_to_line(e,t){t=LIB.projection(e,t);return!!(t&&get_distance(e,t)<=3)}function is_point_between_line_points(e,t){return!are_points_equal(e,t.s)&&(!are_points_equal(e,t.e)&&Math.abs(get_distance(t.s,e)+get_distance(t.e,e)-get_distance(t.s,t.e))<.01)}function is_point_on_straigth(e,t){t=get_big_line(t);return Math.abs(get_distance(t.s,e)+get_distance(t.e,e)-get_distance(t.s,t.e))<.01}function is_line_on_line_BACKUP(e,t){var i=get_big_line(e,20),n=get_big_line(t,20);let s=get_angle(n.s,e.s,n.e),o=get_angle(n.s,e.e,n.e),l=get_angle(i.s,t.s,i.e),r=get_angle(i.s,t.e,i.e);return!isNaN(s)&&180!==s||(s=0),!isNaN(o)&&180!==o||(o=0),!isNaN(l)&&180!==l||(l=0),!isNaN(r)&&180!==r||(r=0),0===s&&0===o&&0===l&&0===r}function is_line_on_line_СЛИШКОМ_ТОЧНАЯ(e,t){t=get_big_line(t,1e3);let i=get_angle(t.s,e.s,t.e,e,t),n=get_angle(t.s,e.e,t.e,e,t);return isNaN(i)||isNaN(n)?(console.log("is_line_on_line: Scheiße!"),!1):(0===i&&(i=180),0===n&&(n=180),180===i&&180===n)}function is_line_on_line(e,t,i=.01){var t=get_big_line(t,1e3),n=is_point_on_line(e.s,t,i),e=is_point_on_line(e.e,t,i);return n&&e}function is_line_on_line_2(e,t){var t=get_big_line(t,get_line_length(e)+10),i=is_point_on_line(e.s,t),e=is_point_on_line(e.e,t);return i&&e}function get_key_by_value(t,i){return Object.keys(t).find(e=>t[e]===i)}function is_line_on_line_strict(i,n){if(is_point_between_line_points(n.s,i)||is_point_between_line_points(n.e,i)){n=get_big_line(n,1e3);let e=get_angle(n.s,i.s,n.e,i,n),t=get_angle(n.s,i.e,n.e,i,n);return isNaN(e)||isNaN(t)?(console.log("is_line_on_line: Scheiße!"),!1):(0===e&&(e=180),0===t&&(t=180),180===e&&180===t)}return!1}function two_vectors_cos(e,t){var e=get_vector(e),t=get_vector(t),i=Math.pow(e.x,2)+Math.pow(e.y,2),n=Math.pow(t.x,2)+Math.pow(t.y,2);return(e.x*t.x+e.y*t.y)/(Math.sqrt(i)*Math.sqrt(n))}function line_and_line_intersection(e,t){var i=(t.e.x-t.s.x)*(e.s.y-t.s.y)-(t.e.y-t.s.y)*(e.s.x-t.s.x),n=(e.e.x-e.s.x)*(e.s.y-t.s.y)-(e.e.y-e.s.y)*(e.s.x-t.s.x),t=(t.e.y-t.s.y)*(e.e.x-e.s.x)-(t.e.x-t.s.x)*(e.e.y-e.s.y);if(0==t)return!1;if(0==i&&0==t)return!1;if(0==n&&0==t)return!1;i/=t,n/=t;return 0<=i&&i<=1&&0<=n&&n<=1&&{x:e.s.x+i*(e.e.x-e.s.x),y:e.s.y+i*(e.e.y-e.s.y)}}function polygon_area(t){let i=[],n=[],s=(t.forEach(function(e){i.push(e.x),n.push(e.y)}),0),o=t.length-1;for(let e=0;e<t.length;e++)s+=(i[o]+i[e])*(n[o]-n[e]),o=e;return Math.abs(s/2)}function get_polygon_area(t,e){let i,n=(e&&"m"!==e||(i=1e4),[]),s=[],o=(t.forEach(function(e){n.push(e.x),s.push(e.y)}),0),l=t.length-1;for(let e=0;e<t.length;e++)o+=(n[l]+n[e])*(s[l]-s[e]),l=e;return o=(Math.abs(o/2)/i).toFixed(2),parseFloat(o)}function get_polygon_center(i){let n=[],s=[];for(let e=0,t=i.length;e<t;e++)n.push(i[e].x),s.push(i[e].y);return{x:(Math.min.apply(null,n)+Math.max.apply(null,n))/2,y:(Math.min.apply(null,s)+Math.max.apply(null,s))/2}}function get_polygon_props(t,e){let i,n=(e&&"m"!==e||(i=1e4),[]),s=[];t.forEach(function(e){n.push(e.x),s.push(e.y)});var o,e=Math.min.apply(null,n),l=Math.max.apply(null,n),r=Math.min.apply(null,s),a=Math.max.apply(null,s);let h=0,g=t.length-1;for(let e=0;e<t.length;e++)h+=(n[g]+n[e])*(s[g]-s[e]),g=e;h=(Math.abs(h/2)/i).toFixed(2);let _=[];for(let e=0;e<t.length;e++)e!==t.length-1?(o=get_line(t[e],t[e+1]),_.push(o)):(o=get_line(t[e],t[0]),_.push(o));return{edges:_,area:parseFloat(h),x_min:e,x_max:l,y_min:r,y_max:a}}function get_polygon_dimensions(e){let t=[],i=[];e.forEach(function(e){t.push(e.x),i.push(e.y)});var e=Math.min.apply(null,t),n=Math.max.apply(null,t),s=Math.min.apply(null,i),o=Math.max.apply(null,i);return{width:Math.abs(e-n),height:Math.abs(s-o)}}function polygon_center(e){let t=[],i=[];return e.forEach(function(e){t.push(e.x),i.push(e.y)}),{x:(Math.min.apply(null,t)+Math.max.apply(null,t))/2,y:(Math.min.apply(null,i)+Math.max.apply(null,i))/2}}function polygon_center_b(e){let t=[],i=[];e.forEach(function(e){t.push(e.x),i.push(e.y)});var e=Math.min.apply(null,t),n=Math.max.apply(null,t),s=Math.min.apply(null,i),o=Math.max.apply(null,i);return{x:(e+n)/2,y:(s+o)/2,x_min:e,x_max:n,y_min:s,y_max:o}}function get_line_angle(e,t){return"rad"===(t=void 0===t?"deg":t)?Math.atan2(e.e.y-e.s.y,e.e.x-e.s.x):"deg"===t?180*Math.atan2(e.e.y-e.s.y,e.e.x-e.s.x)/Math.PI:void 0}function get_point(e,t){return{x:e,y:t}}function get_line(e,t){return{s:e,e:t}}function get_big_line(e,t){return{s:LIB.pointOnLine(e.e,e.s,t=t||1e4),e:LIB.pointOnLine(e.s,e.e,t)}}function get_ray(e,t,i=0){return get_line(e,LIB.pointOnLine(e,t,i))}function get_short_line(e,t,i){return i=i||t,{s:LIB.pointOnLine(e.e,e.s,-t),e:LIB.pointOnLine(e.s,e.e,-i)}}function copy_point(e){return{x:e.x,y:e.y}}function make_path(t){let i=[];i.push("M"+[t[0].x,t[0].y]);for(let e=1;e<t.length;e++)i.push("L"+[t[e].x,t[e].y]);return i.push("Z"),i.join(" ")}function get_svg_path(t){let i=[];i.push("M");for(let e=0;e<t.length;e++)i.push(t[e].x,t[e].y);return i.push("Z"),i.join(" ")}function is_line_inside_line(e,t){var i=is_point_on_line(e.s,t),e=is_point_on_line(e.e,t);return i&&e}function is_line_over_line(e,t,i){var n=is_point_on_line(e.s,t,i),e=is_point_on_line(e.e,t,i);return n&&e}function is_line_over_line_v2(e,t){var i=LIB.pointOnLine(e.e,e.s,-.8),e=LIB.pointOnLine(e.s,e.e,-.8),i=is_point_on_line(i,t),e=is_point_on_line(e,t);return!(!i||!e)}function get_line_polygon_intersections(t,n){let s,o;for(let e=0;e<n.length;e++){var i=n[e];are_points_equal(i,t.s)&&(s=t.s),are_points_equal(i,t.e)&&(o=t.e)}if(!s||!o){t.c=get_line_center(t);var l=get_big_line(get_line(t.s,t.c),10),r=get_big_line(get_line(t.e,t.c),10);for(let i=0;i<n.length;i++){n[i];let e=n[i],t;var a={s:e,e:t=i===n.length-1?n[0]:n[i+1]};s||line_and_line_intersection(l,a)&&(s=line_and_line_intersection(l,a)),o||line_and_line_intersection(r,a)&&(o=line_and_line_intersection(r,a))}}return s&&o?[s,o]:[]}function is_polygon_in_polygon(e,i){let n=[];var s=get_svg_path(i);for(let t=0;t<e.length;t++){var o=e[t];is_point_in_polygon_w1([o.x,o.y],s)?n[t]=!0:n[t]=!1;for(let e=0;e<i.length;e++)are_points_equal(o,i[e])&&(n[t]=!0)}let t=!0;for(let e=0;e<n.length;e++)!1===n[e]&&(t=!1);return t}function is_polygon_in_polygon_new(e,t){let i,n,s=(e.length<=t.length&&(i=e,n=t),e.length>t.length&&(i=t,n=e),0);for(let t=0;t<i.length;t++)for(let e=0;e<n.length;e++)are_points_equal(i[t],n[e])&&s++;t=s===i.length;return console.log(i,n,s,t),s===i.length}function is_polygon_in_polygon_(e,t,i,n){let s,o,l,r,a=(e.length<=i.length&&(s=e.slice(),l=t,o=i.slice(),r=n),e.length>i.length&&(s=i.slice(),l=n,o=e.slice(),r=t),[]),h=o.slice();for(let t=0;t<s.length;t++)for(let e=0;e<o.length;e++)are_points_equal(s[t],o[e])&&a.push(s[t]);for(let t=0;t<a.length;t++)for(let e=0;e<h.length;e++)are_points_equal(a[t],h[e])&&(h.splice(e,1),e--);console.log(l,r,"bg_equals",a.length,"bg_not_equals",h.length);let g=0,_=0;for(let e=0;e<h.length;e++)is_point_inside_polygon(h[e],s)?g++:_++;return console.log(l,r,"bg_equals",a.length,"bg_not_equals",h.length),h.length===g?l:h.length===_&&is_point_inside_polygon(get_polygon_center(s),o)?r:void 0}function get_svg_point(e){let t=svg.node.createSVGPoint();t.x=e.x.toFixed(2),t.y=e.y.toFixed(2);e=svg.node.getScreenCTM().inverse();return t=t.matrixTransform(e),{x:parseFloat(t.x.toFixed(2)),y:parseFloat(t.y.toFixed(2))}}function collect_walls_objects_paths(){cache.wall_objects_paths=[];for(let t=0;t<walls.length;t++){for(let e=0;e<walls[t].windows.length;e++)cache.wall_objects_paths.push(walls[t].windows[e].path);for(let e=0;e<walls[t].doors.length;e++)cache.wall_objects_paths.push(walls[t].doors[e].path);for(let e=0;e<walls[t].doorways.length;e++)cache.wall_objects_paths.push(walls[t].doorways[e].path)}}function get_screen_point(e){let t=svg.node.createSVGPoint();t.x=e.x,t.y=e.y;e=svg.node.getScreenCTM();return t.matrixTransform(e)}function get_vector(e){var t=e.s,e=e.e;return{x:e.x-t.x,y:e.y-t.y}}function get_vector_by_points(e,t){return{x:t.x-e.x,y:t.y-e.y}}function get_vertical(e){return{s:{x:e.x,y:-1e6},e:{x:e.x,y:1e6}}}function is_vertical(e){return Math.abs(e.s.x-e.e.x)<=.1}function is_horizontal(e){return Math.abs(e.s.y-e.e.y)<=.1}function get_horizontal(e){return{s:{x:-1e6,y:e.y},e:{x:1e6,y:e.y}}}function generate_id(){return Math.random().toString(36).substr(2,7)}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})}function analyze_two_vectors(e,t){e=get_vector(e),t=get_vector(t);return{collinear:e.x*t.y-t.x*e.y==0,codirection:0<e.x*t.x+e.y*t.y}}function delete_empties(t){let i=[];for(let e=0;e<t.length;e++)e in t&&i.push(t[e]);return i}function get_svg_point_v2(e){let t=document.getElementById("svgjs"),i=t.createSVGPoint();return i.x=e.x,i.y=e.y,i.matrixTransform(t.getScreenCTM().inverse())}function get_screen_point_v2(e){let t=document.getElementById("svgjs"),i=t.createSVGPoint();return i.x=e.x,i.y=e.y,i.matrixTransform(t.getScreenCTM())}function merge_two_lines(e,t){let i,n;return are_points_equal(e.s,t.s)&&(i=copy_point(e.e),n=copy_point(t.e)),are_points_equal(e.s,t.e)&&(i=copy_point(e.e),n=copy_point(t.s)),are_points_equal(e.e,t.s)&&(i=copy_point(e.s),n=copy_point(t.e)),are_points_equal(e.e,t.e)&&(i=copy_point(e.s),n=copy_point(t.s)),{s:i,e:n}}function merge_three_lines(e,t,i){e=merge_two_lines(e,t),t=merge_two_lines(t,i),i=merge_two_lines(e,t);return{s:i.s,e:i.e}}function get_point_projection(e,t){var i=t.s,t=t.e;return{x:i.x+(t.x-i.x)*(((e.x-i.x)*(t.x-i.x)+(e.y-i.y)*(t.y-i.y))/(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))),y:i.y+(t.y-i.y)*(((e.x-i.x)*(t.x-i.x)+(e.y-i.y)*(t.y-i.y))/(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))}}function get_point_place(e,t){e=(e.x-t.s.x)*(t.e.y-t.s.y)-(e.y-t.s.y)*(t.e.x-t.s.x);return 0==e?"axis":0<e?"L":e<0?"R":void 0}function in_array(e,t,i=!1){let n=!1;for(var s in i=!!i,t)if(t.hasOwnProperty(s)&&(i&&t[s]===e||!i&&t[s]==e)){n=!0;break}return n}function arrays_has_equals_elements(t,i){for(let e=0;e<t.length;e++)if(in_array(t[e],i))return!0;return!1}function objects_has_equals_keys(e,t){for(var i in e)if(e.hasOwnProperty(i)&&t.hasOwnProperty(i))return!0;return!1}function array_flip(e){let t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function get_rotation(e,t,i){return i=i/180*Math.PI,{s:{x:t.x+(e.s.x-t.x)*Math.cos(i)-(e.s.y-t.y)*Math.sin(i),y:t.y+(e.s.y-t.y)*Math.cos(i)-(e.s.x-t.x)*Math.sin(i)},e:{x:t.x+(e.e.x-t.x)*Math.cos(i)-(e.e.y-t.y)*Math.sin(i),y:t.y+(e.e.y-t.y)*Math.cos(i)-(e.e.x-t.x)*Math.sin(i)}}}function closestPoint(e,t,i){var n=get_distance(e,t),e=get_distance(e,i);return n<e?t:e<n?i:void 0}function farthestPoint(e,t,i){var n=get_distance(e,t),e=get_distance(e,i);return e<n?t:n<e?i:void 0}function extendLine(e,t,i){let n={};return n.s=copy.point(e.s),n.e=copy.point(e.e),t&&0<t&&(n.s=LIB.pointOnLine(e.e,e.s,t)),i&&0<i&&(n.e=LIB.pointOnLine(e.s,e.e,i)),n}function is_empty(e){return!e||Array.isArray(e)&&0===e.length||"object"==typeof e&&0===Object.keys(e).length}function get_diff_point(e,t){return get_point(e.x-t.x,e.y-t.y)}function get_sum_point(e,t){return get_point(e.x+t.x,e.y+t.y)}function get_pseudo_tool_path(e,t){let i=0,n=0,s=e,o=0,l=e,r=t,a=0,h=t;return"M"+i+","+n+" L"+s+","+o+" L"+l+","+r+" L"+a+","+h+" Z"}function point_on_line(e,t,i){i/=get_distance(e,t);let n=e.x+(t.x-e.x)*i,s=e.y+(t.y-e.y)*i;return{x:+n.toFixed(2),y:+s.toFixed(2)}}LIB.id=function(){return Math.random().toString(36).substr(2,7)},LIB.randomColor=function(){let t="#";for(let e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},LIB.line=function(e,t,i=0,n=0){return{s:e=i?LIB.pointOnLine(t,e,i):e,e:t=n?LIB.pointOnLine(e,t,n):t,c:LIB.center(e,t)}},LIB.distance=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},LIB.center=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},LIB.pointOnLine=function(e,t,i){var n=LIB.distance(e,t),i=(n+i)/n;return{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}},LIB.arePointsEqual=function(e,t,i=.5){return Math.abs(e.x-t.x)<=.5&&Math.abs(e.y-t.y)<=i},LIB.mergeLines=function(t,i,n){for(let e=0;e<n.length;e++){var s=n[e];if(e!==i){var o=LIB.arePointsEqual(t.s,s.s),l=LIB.arePointsEqual(t.s,s.e),r=LIB.arePointsEqual(t.e,s.s),a=LIB.arePointsEqual(t.e,s.e);if(o||l||r||a)if(180===get_two_lines_angle(t,s)){if(o){t.s=copy_point(s.e),n.splice(e,1);break}if(l){t.s=copy_point(s.s),n.splice(e,1);break}if(r){t.e=copy_point(s.e),n.splice(e,1);break}if(a){t.e=copy_point(s.s),n.splice(e,1);break}}}}},LIB.isPointOnLine=function(e,t,i=.01){return!!LIB.arePointsEqual(e,t.s)||(!!LIB.arePointsEqual(e,t.e)||Math.abs(LIB.distance(t.s,e)+LIB.distance(t.e,e)-LIB.distance(t.s,t.e))<i)},LIB.unique=function(i){let n=[];e:for(let t=0;t<i.length;t++){for(let e=0;e<n.length;e++)if(LIB.arePointsEqual(n[e],i[t]))continue e;n.push(i[t])}return n},LIB.twoLinesIntersection=function(e,t,i=!0){if(!1===i){if(LIB.arePointsEqual(e.s,t.s))return!1;if(LIB.arePointsEqual(e.s,t.e))return!1;if(LIB.arePointsEqual(e.e,t.s))return!1;if(LIB.arePointsEqual(e.e,t.e))return!1}if(LIB.isPointOnLine(e.s,t))return!1;if(LIB.isPointOnLine(e.e,t))return!1;if(LIB.isPointOnLine(t.s,e))return!1;if(LIB.isPointOnLine(t.e,e))return!1;var i=(t.e.x-t.s.x)*(e.s.y-t.s.y)-(t.e.y-t.s.y)*(e.s.x-t.s.x),n=(e.e.x-e.s.x)*(e.s.y-t.s.y)-(e.e.y-e.s.y)*(e.s.x-t.s.x),t=(t.e.y-t.s.y)*(e.e.x-e.s.x)-(t.e.x-t.s.x)*(e.e.y-e.s.y);if(0==t)return!1;if(0==i&&0==t)return!1;if(0==n&&0==t)return!1;i/=t,n/=t;return 0<=i&&i<=1&&0<=n&&n<=1&&{x:e.s.x+i*(e.e.x-e.s.x),y:e.s.y+i*(e.e.y-e.s.y)}},LIB.lineAndPolygonIntersections=function(t,i){t.c||(t.c=LIB.center(t.s,t.e));var n=LIB.line(t.c,t.s,0,5),s=LIB.line(t.c,t.e,0,5);let o,l;for(let e=0;e<i.length;e++){var r=i[e];LIB.arePointsEqual(r,t.s)&&(o=t.s),LIB.arePointsEqual(r,t.e)&&(l=t.e)}var a=LIB.polygonEdges(i);if(!o)for(let e=0;e<a.length;e++){var h=a[e],h=LIB.twoLinesIntersection(n,h);h&&(o=h)}if(!l)for(let e=0;e<a.length;e++){var g=a[e],g=LIB.twoLinesIntersection(s,g);g&&(l=g)}return o&&l?[o,l]:[]},LIB.polygonEdges=function(i){let n=[];for(let t=0;t<i.length;t++){var s=i[t];let e;e=t===i.length-1?i[0]:i[t+1];s=LIB.line(s,e);n.push(s)}return n},LIB.simplifyPolygon=function(n){for(let i=0;i<n.length;i++){let e,t;t=0===i?(e=n[n.length-1],n[1]):i===n.length-1?(e=n[n.length-2],n[0]):(e=n[i-1],n[i+1]);var s=get_line(e,t);delete n[i].remove,is_point_between_line_points(n[i],s)&&(n[i].remove=!0)}for(let e=0;e<n.length;e++)!0===n[e].remove&&(n.splice(e,1),e--);return n},LIB.splitPolygonByLine=function(o,e){var l,r=LIB.lineAndPolygonIntersections(e,o);if(2!==r.length)return[];{for(let t=0;t<o.length;t++){var a=o[t];let e=o[t+1];a={s:a,e:e=t===o.length-1?o[0]:e};if(is_point_on_line(r[0],a)){o.splice(t+1,0,r[0]);break}}for(let t=0;t<o.length;t++){var h=o[t];let e=o[t+1];h={s:h,e:e=t===o.length-1?o[0]:e};if(is_point_on_line(r[1],h)){o.splice(t+1,0,r[1]);break}}let n=[];for(let t=0;t<o.length;t++){var g=o[t];let e=o[t+1];t===o.length-1&&(e=o[0]),n.push(get_line(g,e))}for(let e=0;e<n.length;e++)LIB.lineLength(n[e])<1&&(n.splice(e,1),e--);for(let i=0;i<n.length;i++){let t=n[i];for(let e=0;e<n.length;e++)e!==i&&(l=n[e],get_distance(t.s,l.s)<1?t.slink={index:e,end:"S"}:get_distance(t.s,l.e)<1&&(t.slink={index:e,end:"E"}),get_distance(t.e,l.s)<1?t.elink={index:e,end:"S"}:get_distance(t.e,l.e)<1&&(t.elink={index:e,end:"E"}))}let t;for(let e=0;e<n.length;e++)if(LIB.arePointsEqual(n[e].s,r[0])){t=n[e];break}let i=function(e,t,i){let n=[e.s],s=!0,o=(copy.point(e.s),"E"),l=0;for(;"E"===o?e&&e.elink?(n.push(e.e),e.passed=!0,"S"===e.elink.end&&(o="E"),"E"===e.elink.end&&(o="S"),e=t[e.elink.index]):s=!1:"S"===o&&(e&&e.slink?(n.push(e.s),e.passed=!0,"S"===e.slink.end&&(o="E"),"E"===e.slink.end&&(o="S"),e=t[e.slink.index]):s=!1),2<n.length&&LIB.arePointsEqual(n[n.length-1],i)&&(e.passed=!0,s=!1),l++,!0===s&&l<t.length;);return n}(t,n,r[1]);e=i.slice();let s=o.slice();for(let t=0;t<i.length;t++)if(!LIB.arePointsEqual(i[t],r[0])&&!LIB.arePointsEqual(i[t],r[1]))for(let e=0;e<s.length;e++)LIB.arePointsEqual(i[t],s[e])&&(s.splice(e,1),e--);return e=LIB.unique(e),s=LIB.unique(s),[LIB.simplifyPolygon(e),s=LIB.simplifyPolygon(s)]}},LIB.point=function(t,i,e){if("svg"===e){let e=svg.node.createSVGPoint();e.x=t.toFixed(2),e.y=i.toFixed(2);var n=svg.node.getScreenCTM().inverse();return e=e.matrixTransform(n),{x:parseFloat(e.x.toFixed(2)),y:parseFloat(e.y.toFixed(2))}}if("screen"!==e)return{x:t,y:i};{let e=svg.node.createSVGPoint();e.x=t,e.y=i;n=svg.node.getScreenCTM();return e.matrixTransform(n)}},LIB.pointSVG=function(e,t){return e&&t||!window.global_event_mousemove||(e=window.global_event_mousemove.x,t=window.global_event_mousemove.y),LIB.point(e,t,"svg")},LIB.isPointOnLine=function(e,t,i=.01){return!!LIB.arePointsEqual(e,t.s)||(!!LIB.arePointsEqual(e,t.e)||Math.abs(LIB.distance(t.s,e)+LIB.distance(t.e,e)-LIB.distance(t.s,t.e))<i)},LIB.isPointInsidePolygon=function(i,n){for(let t=0;t<n.length;t++){let e=get_line(n[t],n[t+1]);if(is_point_on_line(i,e=t===n.length-1?get_line(n[t],n[0]):e))return!1}let s=!1;for(let e=0,t=n.length-1;e<n.length;t=e++){var o=n[e].x,l=n[e].y,r=n[t].x,a=n[t].y;l>i.y!=a>i.y&&i.x<(r-o)*(i.y-l)/(a-l)+o&&(s=!s)}return s},LIB.line45=function(e,t){var i,n;return 45===t?(i=LIB.point(e.x+1e5,e.y-1e5),n=LIB.point(e.x-1e5,e.y+1e5),LIB.line(i,n)):-45===t?(i=LIB.point(e.x-1e5,e.y-1e5),n=LIB.point(e.x+1e5,e.y+1e5),LIB.line(i,n)):void 0},LIB.position=function(e,t){e=(e.x-t.s.x)*(t.e.y-t.s.y)-(e.y-t.s.y)*(t.e.x-t.s.x);return 0==e?"A":0<e?"L":e<0?"R":void 0},LIB.projection=function(e,t){var i=t.s,n=t.e,e={x:i.x+(n.x-i.x)*(((e.x-i.x)*(n.x-i.x)+(e.y-i.y)*(n.y-i.y))/(Math.pow(n.x-i.x,2)+Math.pow(n.y-i.y,2))),y:i.y+(n.y-i.y)*(((e.x-i.x)*(n.x-i.x)+(e.y-i.y)*(n.y-i.y))/(Math.pow(n.x-i.x,2)+Math.pow(n.y-i.y,2)))};return!!LIB.isPointOnLine(e,t)&&e},LIB.pointOnLine=function(e,t,i){i=(LIB.distance(e,t)+i)/LIB.distance(e,t);return{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}},LIB.pointAtLineCenter=function(e,t,i,n){var s=LIB.distance(e,t);return"R"===n?{x:(e.x+t.x)/2+i*(e.y-t.y)/s,y:(e.y+t.y)/2-i*(e.x-t.x)/s}:"L"===n?{x:(e.x+t.x)/2-i*(e.y-t.y)/s,y:(e.y+t.y)/2+i*(e.x-t.x)/s}:void 0},LIB.pointAtLinePoint=function(e,t,i,n){e=LIB.parallel(e.s,e.e,i,n);return LIB.projection(t,e)},LIB.parallel=function(e,t,i,n){i=LIB.pointAtLineCenter(e,t,i,n);return{s:{x:i.x-5*(t.x-e.x),y:i.y-5*(t.y-e.y)},e:{x:i.x- -5*(t.x-e.x),y:i.y- -5*(t.y-e.y)}}},LIB.center=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},LIB.lineCenter=function(e){return{x:(e.s.x+e.e.x)/2,y:(e.s.y+e.e.y)/2}},LIB.lineLength=function(e){return Math.sqrt(Math.pow(e.s.x-e.e.x,2)+Math.pow(e.s.y-e.e.y,2))},LIB.lineAngle=function(e,t="deg"){return"rad"===t?Math.atan2(e.e.y-e.s.y,e.e.x-e.s.x):"deg"===t?180*Math.atan2(e.e.y-e.s.y,e.e.x-e.s.x)/Math.PI:void 0},LIB.extendLine=function(e,t,i){let n={};return n.s=copy.point(e.s),n.e=copy.point(e.e),t&&0!==t&&(n.s=LIB.pointOnLine(e.e,e.s,t)),i&&0!==i&&(n.e=LIB.pointOnLine(e.s,e.e,i)),n},LIB.copyPoint=function(e){return{x:e.x,y:e.y}},LIB.fixPoint=function(e){return{x:parseInt(100*e.x)/100,y:parseInt(100*e.y)/100}},LIB.isObjectEmpty=function(e){for(var t in e)return!1;return!0},LIB.isPoint=function(e){return is_a_number(e.x)&&is_a_number(e.y)},LIB.angleBetweenTwoLines=function(e,t){var e=get_vector(e),t=get_vector(t),i=e.x*t.x+e.y*t.y,e=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))*Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),t=Math.acos(i/e),t=Math.round(180*t/Math.PI);return isNaN(t)||0===t?180:t},LIB.vector=function(e){var t=e.s,e=e.e;return{x:e.x-t.x,y:e.y-t.y}},LIB.areLinesCodirection=function(e,t){e=LIB.vector(e),t=LIB.vector(t);return 0<e.x*t.x+e.y*t.y},window.get_object=function(t,i){for(let e=0;e<t.length;e++)if(t[e]&&t[e].id===i)return t[e]},window.objectIndexById=function(t,i){for(let e=0;e<t.length;e++)if(t[e].id===i)return e},copy={point:function(e){return{x:e.x,y:e.y}},line:function(e){return{s:{x:e.s.x,y:e.s.y},e:{x:e.e.x,y:e.e.y}}},polygon:function(t){let i=[];for(let e=0;e<t.length;e++)i.push(copy.point(t[e]));return i},object:function(e){return JSON.parse(JSON.stringify(e))}};var CryptoJS=CryptoJS||function(r){function i(){}var e={},t=e.lib={},n=t.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=t.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var s=0;s<e;s++)t[n+s>>>2]|=(i[s>>>2]>>>24-s%4*8&255)<<24-(n+s)%4*8;else if(65535<i.length)for(s=0;s<e;s+=4)t[n+s>>>2]=i[s>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=r.ceil(t/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],i=0;i<e;i+=4)t.push(4294967296*r.random()|0);return new a.init(t,e)}}),s=e.enc={},o=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(i,t/2)}},l=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(i,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},g=t.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,i=t.words,n=t.sigBytes,s=this.blockSize,o=n/(4*s),o=e?r.ceil(o):r.max((0|o)-this._minBufferSize,0),n=r.min(4*(e=o*s),n);if(e){for(var l=0;l<e;l+=s)this._doProcessBlock(i,l);l=i.splice(0,e),t.sigBytes-=n}return new a.init(l,n)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),_=(t.Hasher=g.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(e,t){return new i.init(t).finalize(e)}},_createHmacHelper:function(i){return function(e,t){return new _.HMAC.init(i,t).finalize(e)}}}),e.algo={});return e}(Math);function levenshtein(e,t){var i,n,s,o,e=(i=e.split("")).length,l=(t=t.split("")).length;if(!e&&!l)return Math.max(e,l);for(var r=[],a=e+1;a;r[--a]=[a]);for(a=l+1;r[0][--a]=a;);for(a=-1,s=i.length;++a<s;)for(n=-1,o=t.length;++n<o;)r[1+(a*=1)][1+(n*=1)]=Math.min(r[a][n+1]+1,r[a+1][n]+1,r[a][n]+(i[a]!=t[n]));return r[e][l]}function levenshtein_ratio(e,t){var i=e.length,n=t.length,i=n<i?i:n;return Math.round(100*(1-levenshtein(e,t)/i))}function send_error_js(t,i,n){try{var s={name:t,text:i,stack:n,screen:window.screen.width+"x"+window.screen.height,plan:window.plan||"",tool:window.tool||"none",user_agent:navigator&&navigator.userAgent?navigator.userAgent:"",session:window.global_session,version:window.global_version,save_id:window.save_counter};windows.errors_js=windows.errors_js||{},windows.errors_js_timers=windows.errors_js_timers||{};let e=CryptoJS.MD5(n);windows.errors_js[e]=s,windows.errors_js_timers[e]&&(clearTimeout(windows.errors_js_timers[e]),delete windows.errors_js_timers[e]),windows.errors_js_timers[e]=setTimeout(function(){save_error_js(windows.errors_js[e]),delete windows.errors_js[e],delete windows.errors_js_timers[e]},2e3)}catch(e){}}function save_error_js(e){try{e.object_id=$("body").attr("data-object-id"),$.ajax({url:"/setup/api/error_js/",timeout:15e3,data:e,type:"POST"})}catch(e){}}!function(o){function b(e,t,i,n,s,o,l){return((e=e+(t&i|~t&n)+s+l)<<o|e>>>32-o)+t}function v(e,t,i,n,s,o,l){return((e=e+(t&n|i&~n)+s+l)<<o|e>>>32-o)+t}function x(e,t,i,n,s,o,l){return((e=e+(t^i^n)+s+l)<<o|e>>>32-o)+t}function B(e,t,i,n,s,o,l){return((e=e+(i^(t|~n))+s+l)<<o|e>>>32-o)+t}for(var e=CryptoJS,t=(n=e.lib).WordArray,i=n.Hasher,n=e.algo,k=[],s=0;s<64;s++)k[s]=4294967296*o.abs(o.sin(s+1))|0;n=n.MD5=i.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var n=e[s=t+i];e[s]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var i=this._hash.words,s=e[t+0],n=e[t+1],o=e[t+2],l=e[t+3],r=e[t+4],a=e[t+5],h=e[t+6],g=e[t+7],_=e[t+8],d=e[t+9],p=e[t+10],c=e[t+11],A=e[t+12],u=e[t+13],w=e[t+14],m=e[t+15],f=b(i[0],y=i[1],C=i[2],I=i[3],s,7,k[0]),I=b(I,f,y,C,n,12,k[1]),C=b(C,I,f,y,o,17,k[2]),y=b(y,C,I,f,l,22,k[3]),f=b(f,y,C,I,r,7,k[4]),I=b(I,f,y,C,a,12,k[5]),C=b(C,I,f,y,h,17,k[6]),y=b(y,C,I,f,g,22,k[7]),f=b(f,y,C,I,_,7,k[8]),I=b(I,f,y,C,d,12,k[9]),C=b(C,I,f,y,p,17,k[10]),y=b(y,C,I,f,c,22,k[11]),f=b(f,y,C,I,A,7,k[12]),I=b(I,f,y,C,u,12,k[13]),C=b(C,I,f,y,w,17,k[14]),f=v(f,y=b(y,C,I,f,m,22,k[15]),C,I,n,5,k[16]),I=v(I,f,y,C,h,9,k[17]),C=v(C,I,f,y,c,14,k[18]),y=v(y,C,I,f,s,20,k[19]),f=v(f,y,C,I,a,5,k[20]),I=v(I,f,y,C,p,9,k[21]),C=v(C,I,f,y,m,14,k[22]),y=v(y,C,I,f,r,20,k[23]),f=v(f,y,C,I,d,5,k[24]),I=v(I,f,y,C,w,9,k[25]),C=v(C,I,f,y,l,14,k[26]),y=v(y,C,I,f,_,20,k[27]),f=v(f,y,C,I,u,5,k[28]),I=v(I,f,y,C,o,9,k[29]),C=v(C,I,f,y,g,14,k[30]),f=x(f,y=v(y,C,I,f,A,20,k[31]),C,I,a,4,k[32]),I=x(I,f,y,C,_,11,k[33]),C=x(C,I,f,y,c,16,k[34]),y=x(y,C,I,f,w,23,k[35]),f=x(f,y,C,I,n,4,k[36]),I=x(I,f,y,C,r,11,k[37]),C=x(C,I,f,y,g,16,k[38]),y=x(y,C,I,f,p,23,k[39]),f=x(f,y,C,I,u,4,k[40]),I=x(I,f,y,C,s,11,k[41]),C=x(C,I,f,y,l,16,k[42]),y=x(y,C,I,f,h,23,k[43]),f=x(f,y,C,I,d,4,k[44]),I=x(I,f,y,C,A,11,k[45]),C=x(C,I,f,y,m,16,k[46]),f=B(f,y=x(y,C,I,f,o,23,k[47]),C,I,s,6,k[48]),I=B(I,f,y,C,g,10,k[49]),C=B(C,I,f,y,w,15,k[50]),y=B(y,C,I,f,a,21,k[51]),f=B(f,y,C,I,A,6,k[52]),I=B(I,f,y,C,l,10,k[53]),C=B(C,I,f,y,p,15,k[54]),y=B(y,C,I,f,n,21,k[55]),f=B(f,y,C,I,_,6,k[56]),I=B(I,f,y,C,m,10,k[57]),C=B(C,I,f,y,h,15,k[58]),y=B(y,C,I,f,u,21,k[59]),f=B(f,y,C,I,r,6,k[60]),I=B(I,f,y,C,c,10,k[61]),C=B(C,I,f,y,o,15,k[62]),y=B(y,C,I,f,d,21,k[63]);i[0]=i[0]+f|0,i[1]=i[1]+y|0,i[2]=i[2]+C|0,i[3]=i[3]+I|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes,s=(t[n>>>5]|=128<<24-n%32,o.floor(i/4294967296));for(t[15+(64+n>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t[14+(64+n>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,i=0;i<4;i++)n=t[i],t[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8);return e},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=i._createHelper(n),e.HmacMD5=i._createHmacHelper(n)}(Math),window.onerror=function(e,t,i,n,s){send_error_js(s.name,e,s.stack)};const signal_types={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20};function convert_trace(e,t=0){let n=[];return e.split("\n").forEach(e=>{if(e.includes("files/js/v2/2.2/")){let t=e.replace(" at ","").replace("http://localhost:8085","").replace("https://remplanner.ru","").replace("https://planner.legko.com","").replace("/files/js/v2/2.2/",""),i=t.split(".js?");if(void 0!==i[1]){let e=i[1].split(":");3===e.length&&(e.splice(0,1),t=i[0]+".js:"+e.join(":"))}n.push(t.trim())}}),0<t&&0<n.length&&n.splice(0,t),n}function union_l10n(){if(window.global_l10n&&window.l10n)for(var e in window.l10n)window.l10n.hasOwnProperty(e)&&window.global_l10n.hasOwnProperty(e)&&(window.l10n[e]=window.global_l10n[e])}window.global_session=Math.round(55e3*Math.random()+1e4),window.global_version=42,window.log_plan={wall1:0,wall2:0,items1:0,items2:0,break_json:0,counter_saving_one_session:0},window.global_event_mousemove={x:0,y:0},union_l10n();let LogItems={created:[],created_ids:{},removed:[],removed_ids:{},bad_item_removed:[],actions:[],start_count:0,current_count:0,removed_from_trees:[],removed_without_index:[],was_file_load:!1,was_project_delete:!1,miss_undo:[],start:function(){this.created=[],this.created_ids={},this.removed=[],this.removed_ids={},this.actions=[],this.removed_from_trees=[],this.removed_without_index=[],this.start_count=this.get_count_items(),this.current_count=this.start_count,this.was_file_load=!1,this.was_project_delete=!1,this.miss_undo=[]},get_count_items(){return window.items&&window.items.db&&window.items.db.length?window.items.db.length:0},add:function(e,t,i){this.created.push({id:e,name:t,tool:window.tool,plan:window.plan,date:(new Date).getTime()/1e3}),this.created_ids[e]=this.created.length-1},remove:function(e,t,i){this.removed.push({id:e,name:t,tool:window.tool,plan:window.plan,date:(new Date).getTime()/1e3,index:i}),this.removed_ids[e]=this.removed.length-1},remove_without_index:function(e,t,i){this.removed_without_index.push({id:e,name:t,tool:window.tool,plan:window.plan,date:(new Date).getTime()/1e3,stack:i})},remove_bad:function(e,t,i){this.bad_item_removed.push({id:e,name:t,reason:i})},save_action(t,i,l){var n=this.get_count_items();if(this.current_count!==n){this.current_count=n;let e=[],o=[];if(l)try{if((l=JSON.parse(l))&&l.items&&l.items.length){let t=[],i=[],n={},s={};l.items&&l.items.length&&l.items.forEach(e=>{t.push(e.id),n[e.id]=e.name}),window.items&&window.items.db&&window.items.db.length&&window.items.db.forEach(e=>{i.push(e.props.id),s[e.props.id]=e.props.name}),e=t.filter(e=>!i.includes(e)),o=i.filter(e=>!t.includes(e)),e=e.map(e=>({id:e,name:n[e]})),o=o.map(e=>({id:e,name:s[e]}))}}catch(e){console.error(e)}if(t&&this.actions.push({stack:convert_trace(t,1),items_count:n,items_id_last:e,items_id_current:o,tool:window.tool,plan:window.plan,date:(new Date).getTime()/1e3}),i){if(this.actions.push({action:i,items_count:n,items_id_last:e,items_id_current:o,tool:window.tool,plan:window.plan,date:(new Date).getTime()/1e3}),i.includes("undo")&&e.forEach(e=>{this.miss_undo.push(e.id)}),this.created.length&&window.items.db&&window.items.db&&window.items.db.length){let t=copy.object(this.created_ids);for(let e=0;e<window.items.db.length;e++)void 0!==t[window.items.db[e].props.id]&&(t[window.items.db[e].props.id]=!0);for(var s in t)t.hasOwnProperty(s)&&(!0!==t[s]?this.created[this.created_ids[s]].undo=1:delete this.created[this.created_ids[s]].undo)}if(this.removed.length&&window.items.db&&window.items.db&&window.items.db.length){let t=copy.object(this.removed_ids);for(let e=0;e<window.items.db.length;e++)void 0!==t[window.items.db[e].props.id]&&(t[window.items.db[e].props.id]=!0);for(var r in t)t.hasOwnProperty(r)&&(!0===t[r]?this.removed[this.removed_ids[r]].undo=1:delete this.removed[this.removed_ids[r]].undo)}}}},send_to_server:function(c,A,u,w,m){try{let t=0,i=0,n=[],s=!1,o,l;this.created.forEach(e=>{1!==e.undo&&t++}),this.removed.forEach(e=>{1!==e.undo&&(i++,n.push(e.id))});try{o=JSON.parse(c)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e),o={},s=!0}try{l=JSON.parse(A)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e),l={},s=!0}let e=!1;if(o.items&&o.items.length&&l.items&&l.items.length&&o.items.length>l.items.length&&(e=!0),!(0<this.actions.length||0<i||e))return;let r=[],a=[],h={},g=(o.items&&o.items.length&&o.items.forEach(e=>{r.push(e.id),h[e.id]=e.name}),l.items&&l.items.length&&l.items.forEach(e=>{a.push(e.id)}),r.filter(e=>!a.includes(e)));if(0===g.length&&!s)return;let _=g.filter(e=>!n.includes(e)),d=[];this.bad_item_removed.forEach(e=>{d.push(e.id)});var f=(_=_.filter(e=>!d.includes(e))).filter(e=>!this.miss_undo.includes(e));g=g.map(e=>({id:e,name:h[e]}));let p=(_=_.map(e=>({id:e,name:h[e]}))).length;var I=0===f.length&&0<_.length,C=((I||this.was_file_load||this.was_project_delete)&&(p=0),{start_count:this.start_count,finish_count:this.current_count,created_count:t,removed_count:i,created:this.created,removed:this.removed,bad_item_removed:this.bad_item_removed,actions:this.actions,diff_items:g,miss_items:_,removed_from_trees:this.removed_from_trees,removed_without_index:this.removed_without_index,log_plan:window.log_plan,break_json:s?1:0,trace:m,was_file_load:this.was_file_load?1:0,was_project_delete:this.was_project_delete?1:0,miss_undo:I?1:0}),y={object_id:$("body").attr("data-object-id"),old_save_id:u,new_save_id:w,created:t,removed:i,diff_items:g.length,miss_items:p,bad_item_removed:this.bad_item_removed.length,start_count:this.start_count,finish_count:this.current_count,start_project:c,finish_project:A,log:JSON.stringify(C),session:window.global_session,version:window.global_version};$.ajax({url:"/setup/api/log_items/",timeout:15e3,data:JSON.stringify(y),dataType:"json",type:"POST"})}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}};function show_item_by_id(t){if(window.items&&window.items.db)for(let e=0;e<window.items.db.length;e++)if(window.items.db[e].props.id===t)return show.point(window.items.db[e].props.center),!0;return!1}let ZoneLabel=function(t){let i=this;return this.zone=t,this.IMAGE=layers.zones.group().draggable().on("mouseover",function(e){i.mouseover(e)}).on("mouseleave",function(e){i.mouseleave(e)}).on("mouseup",function(e){i.mouseup(e)}).on("dragstart",function(){this.center0=get_point(this.cx(),this.cy())}).on("dragmove",function(){$("body").css("cursor","move"),something.moving=!0,this.center1=get_point(this.cx(),this.cy()),this.delta=get_distance(this.center0,this.center1),3<this.delta&&(isContextmenuHidden()||$(".contextmenu").hide())}).on("dragend",function(){$("body").css("cursor","default"),something.moving=!1;let e=get_object(rooms2.data,i.zone.id_room);e&&isContextmenuHidden()&&(is_point_inside_polygon(this.center1,i.zone.polygon)?i.zone.center=this.center1:i.zone.center=this.center0,e.draw())}),"none"===t.name&&(this.IMAGE.add(svg.circle(24).attr({stroke:"#dc143c","stroke-width":.6,fill:"#ffffff"}).cx(t.center.x).cy(t.center.y)),this.IMAGE.add(svg.plain("?").font({family:"Arial",size:12,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(t.center.x).cy(t.center.y))),"none"!==t.name&&(this.IMAGE.plain(t.name).font({family:"Arial",size:13,"stroke-width":.4,fill:"#000000",cursor:"pointer"}).cx(t.center.x).cy(t.center.y-20),this.IMAGE.add(svg.text(function(e){e.tspan(t.area+" м").font({family:"Arial",size:12,"stroke-width":0,fill:"crimson"}),e.tspan("2").font({family:"Arial",size:7,"stroke-width":0,fill:"crimson"}).dy(-4)}).cx(t.center.x).cy(t.center.y)),this.IMAGE.line(t.center.x-32,t.center.y,t.center.x+32,t.center.y).attr({stroke:"#3e3e3e","stroke-width":.4,fill:"#ffffff"}).cx(t.center.x).cy(t.center.y+10),this.IMAGE.plain("H = "+t.height+" см.").font({family:"Arial",size:12,"stroke-width":0,fill:"green"}).cx(t.center.x).cy(t.center.y+20)),this.IMAGE},RoomCap=(ZoneLabel.prototype.mouseover=function(e){"eraser"===tool?($("body").css("cursor","default"),customCursor.overObject=!0):(something.moving||$("body").css("cursor","pointer"),something.moving&&$("body").css("cursor","move"))},ZoneLabel.prototype.mouseleave=function(e){something.moving||$("body").css("cursor","default"),"eraser"===tool&&($("body").css("cursor","default"),customCursor.overObject=!1)},ZoneLabel.prototype.mouseup=function(e){selected.zoneLabel=this,1===e.detail&&("none"!==tool||something.moving||this.show(e,"contextmenu"),"eraser"===tool&&(id.room=this.zone.id_room,id.room_zone=this.zone.id,customCursor.fire("eraserReaction",e),$('#zone_name_contextmenu [action="delete"]').trigger("click"))),3!==e.which&&2!==e.detail||something.moving||this.show(e,"contextmenu")},ZoneLabel.prototype.show=function(e,t){"contextmenu"===t&&(hide2.contextmenu(),id.room=this.zone.id_room,id.room_zone=this.zone.id,"none"===this.zone.name&&$("#zone_name_input").val(""),"none"!==this.zone.name&&$("#zone_name_input").val(this.zone.name),$("#zone_height_input").val(this.zone.height),showContextmenu("#zone_name_contextmenu",e.clientX,e.clientY,canvas.position().top))},function(e){let t=this;return this.room=e,this.IMAGE=layers.caps.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}).on("dragstart",function(){$("body").css("cursor","move"),this.center_before={x:this.cx(),y:this.cy()}}).on("dragend",function(){$("body").css("cursor","default");let e=t.room;this.center_after={x:this.cx(),y:this.cy()},is_point_inside_polygon(this.center_after,e.polygon)?e.cap_center=this.center_after:e.cap_center=this.center_before,e.draw()}),this.draw(),this.IMAGE}),Ceiling=(RoomCap.prototype.draw=function(){this.IMAGE.clear();var e=this.room;"none"===e.cap&&(this.IMAGE.add(layers.caps.circle(24).attr({stroke:"#3e3e3e","stroke-width":.4,fill:"#fafafa"}).cx(e.cap_center.x).cy(e.cap_center.y)),this.IMAGE.add(layers.caps.plain("?").font({family:"Arial",size:14,stroke:"crimson","stroke-width":.4,fill:"crimson"}).cx(e.cap_center.x).cy(e.cap_center.y))),"none"!==e.cap&&(this.IMAGE.add(layers.caps.plain(e.cap_type).font({family:"Arial",size:13,"stroke-width":0,fill:"#555555"}).cx(e.cap_center.x).cy(e.cap_center.y-12)),this.IMAGE.add(layers.caps.rect(66,24).radius(2).attr({stroke:"#3e3e3e","stroke-width":.4,fill:"#fafafa"}).cx(e.cap_center.x).cy(e.cap_center.y+12)),this.IMAGE.add(layers.caps.plain(e.cap+" мм.").font({family:"Arial",size:12,"stroke-width":0,fill:"crimson"}).cx(e.cap_center.x).cy(e.cap_center.y+12)))},RoomCap.prototype.mouseover=function(e){"eraser"===tool?($("body").css("cursor","default"),"none"!==this.room.cap&&(customCursor.overObject=!0)):(something.moving||$("body").css("cursor","pointer"),something.moving&&$("body").css("cursor","move"))},RoomCap.prototype.mouseleave=function(e){something.moving||$("body").css("cursor","default"),"eraser"===tool&&($("body").css("cursor","default"),customCursor.overObject=!1)},RoomCap.prototype.mousedown=function(t){if(1===t.detail&&"eraser"===tool&&"none"!==this.room.cap&&(i=this.room,id.room=i.id,customCursor.fire("eraserReaction",t),$('#floor_cap_contextmenu [action="delete"]').trigger("click")),(3===t.which||2===t.detail)&&!something.moving){hide2.contextmenu();var i=this.room;id.room=i.id,$("#floor_cap_input").val("");let e=i.cap;"none"===i.cap&&(e=0),$("#floor_cap_input").val("").attr("placeholder",e).focus(),is_empty(i.cap_type)||$('#floor_cap_type_select option:contains("'+i.cap_type+'")').prop("selected",!0),showContextmenu("#floor_cap_contextmenu",t.clientX,t.clientY,canvas.position().top)}},function(t,i,e){let n=this,s=(this.level=i.level,layers.ceilings.group().on("mousedown",function(e){deactivate_tool(),allow.pan=!0,id.room=t.id,id.ceiling=i.id,1===e.detail&&(1===e.which&&hide2.contextmenu(),3===e.which&&n.showContextmenu(e)),2===e.detail&&n.showContextmenu(e)}).on("dragstart",function(){$("body").css("cursor","move"),this.center_before={x:this.cx(),y:this.cy()}}).on("dragend",function(){$("body").css("cursor","default"),this.center_after={x:this.cx(),y:this.cy()},is_point_inside_polygon(this.center_after,i.polygon)?i.center=this.center_after:("ceiling"===n.type&&(i.center=this.center_before),"complex_ceiling"===n.type&&(i.complex_ceiling.center=this.center_before)),t.draw()}));var o=i.center;return s.add(svg.polygon(i.polygon).fill(i.filling)),0!==i.level&&(s.rect(48,28).attr({stroke:"#000000","stroke-width":.4,fill:"#ffffff"}).cx(o.x).cy(o.y),s.plain("-"+i.level).font({family:"Arial",size:12,"stroke-width":0,fill:"#3e3e3e",cursor:"pointer"}).cx(o.x).cy(o.y)),s}),ComplexCeiling=(Ceiling.prototype.showContextmenu=function(e){hide2.contextmenu(),$("#ceiling_contextmenu_item1").hide(),0!==this.level&&($("#ceiling-level").val("").attr("placeholder",this.level),$("#ceiling_contextmenu_item1").show()),showContextmenu("#ceiling-contextmenu",e.clientX,e.clientY,canvas.position().top)},function(e,t,i=!1){let n=this,s=(this.room=e,this.ceiling=t,layers.ceilings.group().on("mousedown",function(e){deactivate_tool(),allow.pan=!0}).on("contextmenu",function(e){n.showContextmenu(e)}).on("dblclick",function(e){n.showContextmenu(e)}));var o=t.offset,l=t.radius,e=t.material2;let r=[],a=[],h=[];for(let e=0;e<t.edges.length;e++){var g=t.edges[e],_=t.niches[e];_&&(!0===_.exist&&(r[e]={s:_.ps,e:_.pe,offset:_.depth}),!1===_.exist&&(r[e]={s:g.s,e:g.e,offset:0}))}if(r)for(let e=0;e<2;e++)for(let e=0;e<r.length;e++)LIB.mergeLines(r[e],e,r);for(let e=0;e<r.length;e++){var d=r[e];if(!d)return!1;var p=get_point_near_line_center(d.s,d.e,10+d.offset,"L"),c=get_point_near_line_center(d.s,d.e,10+d.offset,"R");is_point_inside_polygon(p,t.polygon)&&(h[e]=get_parallel(d.s,d.e,o,"L")),is_point_inside_polygon(c,t.polygon)&&(h[e]=get_parallel(d.s,d.e,o,"R"))}for(let i=0;i<h.length;i++){let e,t;t=0===i?(e=h.length-1,1):i===h.length-1?(e=h.length-2,0):(e=i-1,i+1);var A=h[e],u=h[i],w=h[t],A=line_and_line_intersection(u,A),u=line_and_line_intersection(u,w);a[i]={},u&&(a[i].s=A),A&&(a[i].e=u)}for(let e=0;e<a.length;e++)a[e].s&&a[e].e&&(h[e]=copy.line(a[e]));this.polygon=[];for(let e=0;e<h.length;e++)this.polygon.push(h[e].s);t.edges2=[];for(let e=0;e<h.length;e++)t.edges2[e]=copy.line(h[e]);for(let t=0;t<h.length;t++){let e=h[t];e.ps_inner=LIB.pointOnLine(e.e,e.s,-l),e.pe_inner=LIB.pointOnLine(e.s,e.e,-l),e.ps_inside=get_point_near_line_end(e.pe_inner,e.ps_inner,l,"L"),e.ps_outside=get_point_near_line_end(e.pe_inner,e.ps_inner,l,"R")}let m=[];for(let n=0;n<h.length;n++){let e,t=(e=0===n?1:n===h.length-1?0:n+1,h[n]);var f=h[e],I=(0===n?m.push("M"):m.push("L"),m.push(t.ps_inner.x,t.ps_inner.y),m.push("L",t.pe_inner.x,t.pe_inner.y),get_point_place(f.e,t));let i;"L"===I&&(i=0,t.radius_mark_place="outer"),"R"===I&&(i=1,t.radius_mark_place="inner"),m.push("A",l,l,0,0,i,f.ps_inner.x,f.ps_inner.y)}m.push("Z"),m.join(""),t.filling="#f2aeac",t.filling2="#b1fba2";let C,y=("stretch_ceiling"===t.cover&&(C="#d4facc"),"paint_ceiling"===t.cover&&(C="#fdfcb6"),"gypsum_ceiling"===t.cover&&(C="#f6d1d0"),"level_ceiling"===t.cover&&(C="#d0d2f9"),"rack_ceiling"===t.cover&&(C="#e2bde6"),"plastic_panels_ceiling"===t.cover&&(C="#f3eac3"),"stretch_ceiling"===e&&(t.filling2="#dbffd4"),"paint_ceiling"===e&&(t.filling2="#fffea9"),"gypsum_ceiling"===e&&(t.filling2="#ffccca"),1),b=1;if(!0===i&&(t.filling="#ecde97",t.filling2="#ffffff",y=.2,b=.5),s.polygon(t.polygon).attr({stroke:"#555555","stroke-width":.6,fill:t.filling,opacity:y}),s.path(m).attr({stroke:"#555555","stroke-width":.6,fill:t.filling2,opacity:b}),!1===i){s.rect(72,28).attr({stroke:"#000000","stroke-width":.4,fill:"#ffffff"}).cx(t.center.x).cy(t.center.y),s.plain("-"+t.level+" / -"+t.level2).font({family:"Arial",size:12,"stroke-width":0,fill:"#3e3e3e",cursor:"pointer"}).cx(t.center.x).cy(t.center.y);for(let i=0;i<h.length;i++){var v=h[i],x=get_point_near_line_center(v.s,v.e,5,"L");let e,t;t=(e=is_point_inside_polygon(x,this.polygon)?get_point_near_line_center(v.s,v.e,o,"R"):get_point_near_line_center(v.s,v.e,o,"L"),get_center(v.s,v.e)),s.add(new DimensionSimple({s:e,e:t,style:"clear",center:!1}))}if(0<l){let i=.5*l;i<20&&(i=20);for(let t=0;t<h.length;t++){var B=h[t],k=LIB.pointOnLine(B.s,B.e,-i);let e;"inner"===B.radius_mark_place&&(e=point_near_line_end(B.e,k,i,"L")),"outer"===B.radius_mark_place&&(e=point_near_line_end(B.e,k,i,"R")),s.plain("R"+l).font({family:"Arial",size:9,"font-style":"italic",stroke:"#161616","stroke-width":.4,fill:"#161616"}).cx(e.x).cy(e.y)}}}return s}),CeilingNiche=(ComplexCeiling.prototype.showContextmenu=function(e){var t=this.ceiling;id.room=this.room.id,id.ceiling=t.id,hide2.contextmenu(),$("#ceiling-level-1").val("").attr("placeholder",t.level),$("#ceiling-level-2").val("").attr("placeholder",t.level2),$("#ceiling-offset").val("").attr("placeholder",t.offset),$("#ceiling-radius").val("").attr("placeholder",t.radius),"stretch_ceiling"===t.material2&&$("#complex_ceiling_material [value='1']").attr("selected","selected"),"paint_ceiling"===t.material2&&$("#complex_ceiling_material [value='2']").attr("selected","selected"),"gypsum_ceiling"===t.material2&&$("#complex_ceiling_material [value='3']").attr("selected","selected"),"closed"===t.type&&$("#complex_ceiling_type [value='1']").attr("selected","selected"),"opened"===t.type&&$("#complex_ceiling_type [value='2']").attr("selected","selected"),showContextmenu("#ceiling-contextmenu-2",e.clientX,e.clientY,canvas.position().top)},function(e,t){let i=this;var n;return this.props=e,this.IMAGE=layers.niches.group().on("contextmenu",function(e){id.room=i.props.id_room,id.ceiling=i.props.id_ceiling,id.niche=i.props.id_niche,hide2.contextmenu(),$("#ceiling_niche_depth_input").val("").attr("placeholder",i.props.depth),showContextmenu("#niche_contextmenu",e.clientX,e.clientY,canvas.position().top)}).on("dblclick",function(e){id.room=i.props.id_room,id.ceiling=i.props.id_ceiling,id.niche=i.props.id_niche,hide2.contextmenu(),$("#ceiling_niche_depth_input").val("").attr("placeholder",i.props.depth),showContextmenu("#niche_contextmenu",e.clientX,e.clientY,canvas.position().top)}),!0===t&&(e.color="#fbf8e9"),this.IMAGE.add(svg.polygon([this.props.p1,this.props.p2,this.props.p3,this.props.p4]).attr({"stroke-width":0,fill:e.color})),this.IMAGE.add(svg.line(this.props.p3.x,this.props.p3.y,this.props.p4.x,this.props.p4.y).attr({"stroke-width":.4,stroke:"#000000"})),this.props.ps_free_end&&this.IMAGE.add(svg.line(this.props.p1.x,this.props.p1.y,this.props.p4.x,this.props.p4.y).attr({"stroke-width":.4,stroke:"#000000"})),this.props.pe_free_end&&this.IMAGE.add(svg.line(this.props.p2.x,this.props.p2.y,this.props.p3.x,this.props.p3.y).attr({"stroke-width":.4,stroke:"#000000"})),!1===t&&(t=get_point_place(get_center(this.props.p1,this.props.p2),{s:this.props.p3,e:this.props.p4}),n=get_center(this.props.p3,this.props.p4),e=get_point_near_line_center(this.props.p3,this.props.p4,e.depth,t),this.IMAGE.add(new DimensionSimple({s:n,e:e,style:"clear",center:!0}))),this.IMAGE}),Floor=function(e){let t=this;return this.id=e.id,this.pid=e.pid,this.polygon=e.polygon,this.filling=e.filling,this.strokeWidth=e.strokeWidth,this.IMAGE=layers.floors.polygon(this.polygon).attr({fill:this.filling}).on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.IMAGE};Floor.prototype.paint=function(e,t){e=e||"#000000",t=t?2*this.strokeWidth:this.strokeWidth,this.filling.each(function(){"path"===this.type&&this.attr({stroke:e,"stroke-width":t})})},Floor.prototype.remove=function(e){if("floor"===plan&&isContextmenuHidden()){if(1===e.which&&(tool,"eraser"===tool))return id.room=this.pid,id.roomFloor=this.id,customCursor.fire("eraserReaction",e),void $('#floor_contextmenu [action="delete"]').trigger("click");3!==e.which&&2!==e.detail||(this.paint("orange","big"),id.room=this.pid,id.roomFloor=this.id,$(".contextmenu").hide(),showContextmenu("#floor_contextmenu",e.clientX,e.clientY,canvas.position().top))}},Floor.prototype.mouseover=function(e){"floor"===plan&&isContextmenuHidden()&&("none"===tool&&this.paint("orange","big"),"eraser"===tool&&(this.paint("crimson","big"),customCursor.overObject=!0))},Floor.prototype.mouseleave=function(e){"floor"===plan&&isContextmenuHidden()&&(this.paint(),customCursor.overObject=!1)},Floor.prototype.mousedown=function(e){if(console.warn("TST"),"floor"===plan&&isContextmenuHidden()){if(1===e.which&&(tool,"eraser"===tool))return id.room=this.pid,id.roomFloor=this.id,customCursor.fire("eraserReaction",e),void $('#floor_contextmenu [action="delete"]').trigger("click");3!==e.which&&2!==e.detail||(this.paint("orange","big"),id.room=this.pid,id.roomFloor=this.id,$(".contextmenu").hide(),showContextmenu("#floor_contextmenu",e.clientX,e.clientY,canvas.position().top))}};class TreeLines{constructor(e={}){this.id=e.id||LIB.id(),this.color=e.color||"gray",this.connections=e.connections||{},this.items=e.items||{},this.lines=[],this.type="",this.plan="",this.name_human="",this.points_connections=e.points_connections||{},this.socket_group_ids=e.socket_group_ids||{},this.points_line=[],this.length=0,this.IMAGE=null,this.IMAGE_2=null,this.IMAGE_3=null}serialize(){return{id:this.id,connections:this.connections,items:this.items,type:this.type,length:this.length}}erase(){this.IMAGE.clear(),this.IMAGE_2&&this.IMAGE_2.clear(),this.IMAGE_3&&this.IMAGE_3.clear(),this.points_line.forEach(e=>{e.erase()}),this.points_line=[]}show(){this.IMAGE.show(),this.IMAGE_2&&this.IMAGE_2.show(),this.IMAGE_3&&this.IMAGE_3.show(),this.points_line.forEach(e=>{e.show()})}hide(){this.IMAGE.hide(),this.IMAGE_2&&this.IMAGE_2.hide(),this.IMAGE_3&&this.IMAGE_3.hide(),this.points_line.forEach(e=>{e.hide()})}mouseover(e){return plan===this.plan&&(!!isContextmenuHidden()&&!!e.target)}mouseleave(e){return plan===this.plan&&!!isContextmenuHidden()}mousedown(e){return plan===this.plan&&!!e.target}drawOneElement(e,t,i,n){}getTypeItem(e){return""}addNew(e){}deleteFromStorage(e){}getLining(){switch(this.plan){case"water":return piping;case"light_connections":return cabling;case"cables":return cabling_socket;case"conditioners":return"CableConditioner"===this.constructor.name?cabling_conditioner:piping_conditioner;case"warm_floor":return cabling_warm_floor;case"radiators":return piping_heat;case"light":return"LedStrip"===this.constructor.name?striping_led:"LineStrip"===this.constructor.name?striping_line:striping_light}return{}}getItem(e){return this.getLining().get_item(e)}getIdItem(e){return this.getLining().get_id_item(e)}getNameItem(e){return this.getLining().get_name_item(e)}unsetFromItem(e,t){this.getLining().unset_tree_id(e,t,this.type,this.id)}setToItem(e,t){this.getLining().set_tree_id(e,t,this.id,this.type)}getPoint(e,t){return this.getLining().get_point(this.type,e,t,this.id)}updateData(){this.items={},this.color="gray";var e,t,i=this.getFirstItem();for(e in i&&this.updateDataRecursive(i,this.connections[i]),this.defineColor(),this.getNodes().forEach(e=>{e.image.attr({stroke:this.getLining().get_color_of_item(e,this.color)})}),this.points_connections)this.points_connections.hasOwnProperty(e)&&(t=e.split("-"),void 0!==this.items[t[0]]&&void 0!==this.items[t[1]]||delete this.points_connections[e])}getNodes(){let e=[];for(var t in this.items)!this.items.hasOwnProperty(t)||"node"===this.items[t]&&(t=this.getItem(t))&&e.push(t);return e}isNode(e){return"node"===this.items[this.getIdItem(e)]||"node"===this.getTypeItem(e)}getFirstItem(){for(var e in this.connections)if(this.connections.hasOwnProperty(e))return e}draw(){if(plan===this.plan||"light"===plan&&"light_connections"===this.plan){try{this.erase(),this.lines=[];var e=this.getFirstItem();e&&this.drawRecursive(e,this.connections[e])}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}this.updateLength(),this.getLining().draw_box()}}drawRecursive(e,t){if(0!==Object.keys(t).length){var i,n=this.getItem(e);for(i in t)if(t.hasOwnProperty(i)){var s=this.getItem(i);if(!n||!s)return;this.drawOneElement(n,s,e,i),this.drawRecursive(i,t[i])}}}deleteFull(t="",i=!1){try{for(var n in this.erase(),this.items)if(this.items.hasOwnProperty(n)){let e=this.getItem(n);e?(this.unsetFromItem(e,n),e.paint(),"node"!==this.items[n]||!0===i&&t===n||e.delete({no_delete_lines:!0})):console.warn("plan "+this.plan+". No item "+this.items[n]+" "+n)}this.deleteFromStorage(this.id)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}this.getLining().draw_box()}deleteByItem(e,t=!1){try{if(2===Object.keys(this.items).length)return LogItems.removed_from_trees.push({tree_id:this.id,desc:"delete by item (full)",type:this.type,date:(new Date).getTime()/1e3}),this.deleteFull(e,t),!0;var i=this.getFirstItem();return i&&this.deleteByItemRecursive(e,i,this.connections),this.getLining().draw_box(),!0}catch(e){return send_error_js(e.name,e.message,e.stack),console.error(e),!1}}deleteByItemRecursive(e,t,i){if(e===t){if("Cable"===this.constructor.name&&this.switches)for(var n of this.switches)this.removeCableFromSwitch(n);for(var s in i[t])if(i[t].hasOwnProperty(s)){let e={};e[s]=copy.object(i[t][s]),delete i[t][s],this.addNew(e)}return delete i[t],this.split(),void LogItems.removed_from_trees.push({tree_id:this.id,item_id:t,desc:"delete by item",type:this.type,date:(new Date).getTime()/1e3})}for(var o in i[t])i[t].hasOwnProperty(o)&&this.deleteByItemRecursive(e,o,i[t])}deleteByLine(e){if(window.contextmenu_tree_line_id=null,e){if(2===Object.keys(this.items).length)return LogItems.removed_from_trees.push({tree_id:this.id,desc:"delete by line (full)",type:this.type,date:(new Date).getTime()/1e3}),this.deleteFull(),void project.localSave();for(var t in this.connections)this.connections.hasOwnProperty(t)&&this.deleteByLineRecursive(e,t,this.connections);this.getLining().draw_box(),project.localSave()}}deleteByLineRecursive(t,i,n){if(0!==Object.keys(n[i]).length)for(var s in n[i])if(n[i].hasOwnProperty(s)){if(i+"_"+s===t||s+"_"+i===t){if("Cable"===this.constructor.name&&this.switches)for(var o of this.switches)this.removeCableFromSwitch(o);let e={};return e[s]=copy.object(n[i][s]),delete n[i][s],this.addNew(e),this.split(),void LogItems.removed_from_trees.push({tree_id:this.id,tree_line_id:t,desc:"delete by line",type:this.type,date:(new Date).getTime()/1e3})}this.deleteByLineRecursive(t,s,n[i])}}updateLength(){try{this.length=+(this.getLength()/100).toFixed(2),this.length||(this.length=0)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}getLength(){let e=0;for(var t in this.connections)this.connections.hasOwnProperty(t)&&(e+=this.getLengthRecursive(t,this.connections[t]));return+e.toFixed(1)}getLengthRecursive(e,t){let i=0;if(0===Object.keys(t).length)return i;var n,s=this.getItem(e);for(n in t)if(t.hasOwnProperty(n)){var o=this.getItem(n);if(!s||!o)return;var l=this.getPosition(e,n);i=(i+=get_distance(l.s||this.getPoint(s,e),l.e||this.getPoint(o,n)))+this.getLengthRecursive(n,t[n])}return i}getItemsByTree(){var e,t=[];for(e in this.connections)this.connections.hasOwnProperty(e)&&this.getItemsByTreeRecursive(e,this.connections[e],t);return t}getItemsByTreeRecursive(e,t,i){for(var n in i.push(e),t)t.hasOwnProperty(n)&&this.getItemsByTreeRecursive(n,t[n],i)}contextmenu(e){hide2.contextmenu()}addItem(e,t){if(0===Object.keys(this.connections).length)return this.connections[e]={},void(this.connections[e][t]={});for(var i in this.connections)if(this.connections.hasOwnProperty(i)){if(i===e)return void(this.connections[i][t]={});if(i===t)return void(this.connections[i][e]={});this.searchSourceItemAndAddNewItemRecursive(e,t,this.connections[i])}}searchSourceItemAndAddNewItemRecursive(e,t,i){for(var n in i)if(i.hasOwnProperty(n)){if(n===e)return void(i[n][t]={});if(n===t)return void(i[n][e]={});this.searchSourceItemAndAddNewItemRecursive(e,t,i[n])}}getCountItems(e=""){if(""===e)return Object.keys(this.items).length;let t=0;for(var i in this.items)this.items.hasOwnProperty(i)&&this.items[i]===e&&t++;return t}union(e,t,i,n=null,s=null){for(var o in null!==n&&null!==s?this.points_connections[t+"-"+i]=[n,s]:(null!==n&&(this.points_connections[t+"-"+i]=[n,""]),null!==s&&(this.points_connections[t+"-"+i]=["",s])),e.points_connections)e.points_connections.hasOwnProperty(o)&&(this.points_connections[o]=e.points_connections[o]);let l={};for(var r in e.connections)if(e.connections.hasOwnProperty(r)){if(r===i){l=e.connections;break}l=this.searchTargetItemAndReverseTree(e.connections[r],i,[r],e)}for(var a in this.connections)if(this.connections.hasOwnProperty(a)){if(a===t){this.connections[a][i]=l[i];break}this.searchSourceItemAndAddNewItemUnionRecursive(t,i,this.connections[a],l)}e.erase(),this.deleteFromStorage(e.id),this.updateData(),this.draw()}unionByNode(e,t,i){for(var n in e.points_connections)e.points_connections.hasOwnProperty(n)&&(this.points_connections[n]=e.points_connections[n]);let s={};for(var o in e.connections)if(e.connections.hasOwnProperty(o)){if(o===i){s=e.connections;break}s=this.searchTargetItemAndReverseTree(e.connections[o],i,[o],e)}for(var l in this.connections)if(this.connections.hasOwnProperty(l)){if(l===t){for(var r in s[i])s[i].hasOwnProperty(r)&&(this.connections[l][r]=s[i][r]);break}this.searchSourceItemAndAddChildrenItemsUnionRecursive(t,i,this.connections[l],s)}e.erase(),this.deleteFromStorage(e.id),this.updateData(),this.draw()}insert(e,t,i){for(var n in e.points_connections)e.points_connections.hasOwnProperty(n)&&(this.points_connections[n]=e.points_connections[n]);let s={};for(var o in e.connections)if(e.connections.hasOwnProperty(o)){if(o===t){s=e.connections;break}s=this.searchTargetItemAndReverseTree(e.connections[o],t,[o],e)}for(var l in this.connections)this.connections.hasOwnProperty(l)&&this.insertByLineRecursive(i,l,this.connections,s[t],t);e.erase(),this.deleteFromStorage(e.id),this.updateData(),this.draw()}insertByLineRecursive(e,n,s,o,l){if(0!==Object.keys(s[n]).length)for(var r in s[n])if(s[n].hasOwnProperty(r)){if(n+"_"+r===e||r+"_"+n===e){let e={};e[r]=copy.object(s[n][r]),delete s[n][r],s[n][l]=o,s[n][l][r]=e[r];let t,i;return this.points_connections[n+"-"+r]?(t=this.points_connections[n+"-"+r][0],i=this.points_connections[n+"-"+r][1],delete this.points_connections[n+"-"+r]):this.points_connections[r+"-"+n]&&(t=this.points_connections[r+"-"+n][1],i=this.points_connections[r+"-"+n][0],delete this.points_connections[r+"-"+n]),t&&(this.points_connections[n+"-"+l]=[t,""]),void(i&&(this.points_connections[r+"-"+l]=[i,""]))}this.insertByLineRecursive(e,r,s[n],o,l)}}searchTargetItemAndReverseTree(t,i,n,s){for(var o in t)if(t.hasOwnProperty(o)){if(o===i){let e={};return e[o]=copy.object(t[o]),delete t[o],this.reverseTree(s.connections,e,n,o)}let e=copy.object(n);if(e.push(o),void 0===t[i]){o=this.searchTargetItemAndReverseTree(t[o],i,e,s);if(o)return o}}}reverseTree(e,n,s,o){for(;0<s.length;){let t=copy.object(e),i="";for(let e=0;e<s.length;e++)t=t[s[e]],i=s[e];for(var l in delete t[o],n)if(n.hasOwnProperty(l)){if(l===o){for(var r in n[l][i]={},t)t.hasOwnProperty(r)&&(n[l][i][r]=t[r]);break}this.searchSourceItemAndAddNewItemsUnionRecursive(o,i,n,t)}o=i,s.pop()}return n}searchSourceItemAndAddNewItemsUnionRecursive(e,t,i,n){for(var s in i)if(i.hasOwnProperty(s)){if(s===e){for(var o in i[s][t]={},n)n.hasOwnProperty(o)&&(i[s][t][o]=n[o]);return}this.searchSourceItemAndAddNewItemsUnionRecursive(e,t,i[s],n)}}searchSourceItemAndAddNewItemUnionRecursive(e,t,i,n){for(var s in i)if(i.hasOwnProperty(s)){if(s===e)return void(i[s][t]=n[t]);this.searchSourceItemAndAddNewItemUnionRecursive(e,t,i[s],n)}}searchSourceItemAndAddChildrenItemsUnionRecursive(e,t,i,n){for(var s in i)if(i.hasOwnProperty(s)){if(s===e){for(var o in n[t])n[t].hasOwnProperty(o)&&(i[s][o]=n[t][o]);return}this.searchSourceItemAndAddChildrenItemsUnionRecursive(e,t,i[s],n)}}updateDataRecursive(e,t){let i=this.getItem(e);if(i){this.items[e]=this.getTypeItem(i);let t=this.getLining();this.getLining().is_multi(i)&&t.names_line_id_by_tool[this.type]&&i.props[t.name_object_lines]&&i.props[t.name_object_lines][t.names_line_id_by_tool[this.type]]&&Array.isArray(i.props[t.name_object_lines][t.names_line_id_by_tool[this.type]])&&(i.props[t.name_object_lines][t.names_line_id_by_tool[this.type]]=i.props[t.name_object_lines][t.names_line_id_by_tool[this.type]].filter(e=>{return!!t.get_tree_from_storage(e)})),this.setToItem(i,e)}for(var n in t)t.hasOwnProperty(n)&&this.updateDataRecursive(n,t[n])}split(){try{this.erase(),this.isNotEmptyTree(this.connections)?(this.updateData(),this.draw()):(this.unsetFromItems(Object.keys(this.connections)),this.deleteFromStorage(this.id))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}unsetFromItems(i){for(let t=0;t<i.length;t++){var n=i[t];let e=this.getItem(n);this.unsetFromItem(e,n),this.isNode(e)?e.delete({no_delete_lines:!0}):e.paint()}}isNotEmptyTree(e){for(var t in e)if(e.hasOwnProperty(t)&&0<Object.keys(e[t]).length)return!0;return!1}addSpot(e,t,i,n,s=null,o=null){e=this.getTypeItem(e),t=this.getTypeItem(t);this.items[i]=e,this.items[n]=t,null!==s&&null!==o?this.points_connections[i+"-"+n]=[s,o]:(null!==s&&(this.points_connections[i+"-"+n]=[s,""]),null!==o&&(this.points_connections[i+"-"+n]=["",o])),this.addItem(i,n)}changeSpot(e,t,i,n){var s,t=this.getTypeItem(t);for(s in delete this.items[i],this.items[n]=t,this.connections)if(this.connections.hasOwnProperty(s)){if(s===i)return this.connections[n]=this.connections[i],void delete this.connections[i];this.searchSourceItemAndChangeItemRecursive(i,n,this.connections[s])}}searchSourceItemAndChangeItemRecursive(e,t,i){for(var n in i)if(i.hasOwnProperty(n)){if(n===e)return i[t]=i[e],void delete i[e];this.searchSourceItemAndChangeItemRecursive(e,t,i[n])}}isExistMovingNodes(){for(var e in this.items)if(this.items.hasOwnProperty(e))if("node"===this.items[e])if(this.getItem(e).click_zone.moving)return!0;return!1}isExistMovingItems(){for(let e=0;e<items.db.length;e++){var t=items.db[e];if(this.getLining().items_any_connections[t.props.name]&&t.click_zone.moving)return!0}return!1}changeSizeNodes(t){this.getNodes().forEach(e=>{this.getLining().change_size_node(e,t)})}defineColor(){this.color=this.getLining().get_color_by_type(this.type)}addNode(e,t,i,n=null){var i=this.getLining().add_node_item(this.type,i.center,i.id_room),s=i.props.id;return this.items[t]=this.getTypeItem(e),this.items[s]="node",null!==n&&(this.points_connections[t+"-"+s]=[n,""]),this.addItem(t,s),i}getMultiItemIds(){let e=[];for(var t in this.items){var i;this.items.hasOwnProperty(t)&&((i=this.getItem(t))&&this.getLining().is_multi(i)&&e.push(t))}return e}getPosition(e,t){let i="",n="",s,o;return this.points_connections[e+"-"+t]?(s=this.points_connections[e+"-"+t][0],o=this.points_connections[e+"-"+t][1]):this.points_connections[t+"-"+e]&&(s=this.points_connections[t+"-"+e][1],o=this.points_connections[t+"-"+e][0]),s&&(e=this.getLining().get_polygon(this.getItem(e)),e=s.i<e.length-1?get_line(e[s.i],e[s.i+1]):get_line(e[s.i],e[0]),i=LIB.pointOnLine(e.e,e.s,-(get_distance(e.e,e.s)*s.d))),o&&(e=this.getLining().get_polygon(this.getItem(t)),t=o.i<e.length-1?get_line(e[o.i],e[o.i+1]):get_line(e[o.i],e[0]),n=LIB.pointOnLine(t.e,t.s,-(get_distance(t.e,t.s)*o.d))),{s:i,e:n}}checkValid(){try{var e,n=this.getItemsByTree();if(is_empty(n))return console.warn(this.constructor.name+". Check valid (empty). Delete "+this.id),send_warning_signals(signal_types[3],"Удаление сломанного "+this.name_human+": ",this.id+" (empty)",1,1),void this.deleteFull();let t=[],i=[];for(let e=0;e<n.length;e++){var s=n[e];this.getItem(s)||t.push(s)}for(e in this.items)!this.items.hasOwnProperty(e)||this.getItem(e)||i.push(e);if(2<n.length){if(0===t.length&&0<i.length){let t="";try{this.updateData()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e),t="(error) "}return console.warn('Исправление "update" '+t+this.name_human+": ",this.id+" ("+JSON.stringify(i)+")"),void send_warning_signals(signal_types[12],'Исправление "update" '+t+this.name_human+": ",this.id+" ("+JSON.stringify(i)+")",1,1)}if(1===t.length){var o=!1===this.deleteByItem(t[0])?"(error) ":"";if(console.warn('Исправление "remove" '+o+this.name_human+": ",this.id+" ("+JSON.stringify(t)+")"),send_warning_signals(signal_types[12],'Исправление "remove" '+o+this.name_human+": ",this.id+" ("+JSON.stringify(t)+")",1,1),!o)return}}if(0<i.length){let t=[];for(let e=0;e<i.length;e++){var l=i[e],r=this.items[l]||"";t.push(l+" | "+r)}return console.warn(this.constructor.name+". Check valid. Delete "+this.id),send_warning_signals(signal_types[3],"Удаление сломанного "+this.name_human+": ",this.id+" ("+t.join(", ")+")",1,1),void this.deleteFull()}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}unionLine(e){this.searchNodeAndJoinLinesRecursive(e,this.connections),this.updateData(),this.draw()}searchNodeAndJoinLinesRecursive(e,s,o=""){for(var l in s)if(s.hasOwnProperty(l)){if(l===e&&o){let e="";for(e in s[l])if(s[l].hasOwnProperty(e)){s[e]=s[l][e];break}delete s[l];let t=this.getItem(l),i=(delete t.props[this.getLining().name_object_lines],t&&t.delete(),""),n="";return this.points_connections[o+"-"+l]?(i=(i=i||this.points_connections[o+"-"+l][0])||this.points_connections[o+"-"+l][1],delete this.points_connections[o+"-"+l]):this.points_connections[l+"-"+o]&&(i=(i=i||this.points_connections[l+"-"+o][1])||this.points_connections[l+"-"+o][0],delete this.points_connections[l+"-"+o]),this.points_connections[l+"-"+e]?(n=(n=n||this.points_connections[l+"-"+e][0])||this.points_connections[l+"-"+e][1],delete this.points_connections[l+"-"+e]):this.points_connections[e+"-"+l]&&(n=(n=n||this.points_connections[e+"-"+l][1])||this.points_connections[e+"-"+l][0],delete this.points_connections[e+"-"+l]),void((i||n)&&(this.points_connections[o+"-"+e]=[i,n]))}this.searchNodeAndJoinLinesRecursive(e,s[l],l)}}splitLine(t,e){window.contextmenu_tree_line_id=null,window.contextmenu_tree_line_point=null;let i=e;for(let e=0;e<this.lines.length;e++)if(this.lines[e].line_id===t){i=LIB.projection(mouse.end,this.lines[e].line);break}let n="",s=(rooms2.data&&null!==mouse.over.room&&rooms2.data[mouse.over.room]?n=rooms2.data[mouse.over.room].id:(mouse.over.search("room"),rooms2.data&&null!==mouse.over.room&&rooms2.data[mouse.over.room]&&(n=rooms2.data[mouse.over.room].id)),this.getLining().add_node_item(this.type,i,n));for(var o in this.connections)this.connections.hasOwnProperty(o)&&this.insertByLineRecursive(t,o,this.connections,{},s.props.id);this.updateData(),void 0===this.items[s.props.id]&&s.delete(),this.draw()}}class TreeLining{constructor(){this.unselect_source_item(),this.tools=[],this.name_object_lines="",this.plan="",this.name_node="",this.source_items={},manager_lining.reference_lines=[],this.temporary_line=null,this.color_line="gray",this.names_line_id_by_tool={},this.multi_spots={},this.items_any_connections={}}unselect_source_item(){if(this.source_node_id){let e=this.get_item(this.source_node_id);e&&e.delete()}this.source_item=null,this.source_id=null,this.source_name=null,this.source_point=null,this.target_item=null,this.target_id=null,this.target_point=null,this.source_node_id=null,this.target_tree_line=null,this.source_tree_line=null}is_multi(e){return this.multi_spots[this.get_name_item(e)]}get_type(){if(void 0!==window.tool&&in_array(tool,this.tools))return window.tool;if(this.source_name===this.name_node&&this.source_item){var e=this.get_tree(this.source_item,!0);if(e)return e.type}return""}get_item(e){if(null===e)return null;e.includes("|s|")&&(e=e.split("|s|")[0]);e=get_item(e);return e||null}get_name_item(e){return e.props.name}get_id_item(e){return e.props.id}get_point(e,t,i,n){return t.props.center}check_allow_connect(e,t,i=0,n,s){}get_color_by_type(e){return""}check_source_select(e,t,i=0){return!1}get_tree_from_storage(e){return{}}get_trees_from_storage(){return[]}select(e,t){}unselect(e){}add_node_item(e,t,i){return{}}get_polygon(e){}mousedown(e,t,i=0){return!1}is_exist_tree(e,t=!1,i){if(void 0===window.tool&&!t&&!i||!(e&&e.props&&e.props[this.name_object_lines]))return null;if(t){for(var n in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(n)&&!is_empty(e.props[this.name_object_lines][this.names_line_id_by_tool[n]]))return!0;return!1}for(var s in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(s)&&(window.tool===s||i===s)&&!is_empty(e.props[this.name_object_lines][this.names_line_id_by_tool[s]]))return!0;return!1}check_connection_items(e,t){var i=this.get_type();return!(!this.source_items[i][e]||!this.source_items[i][e][t])}check_source_items(e){var t=this.get_type();return!!this.source_items[t][e]}get_tree(t,e=!1,i){if(void 0===window.tool&&!e&&!i||!(t&&t.props&&t.props[this.name_object_lines]))return null;for(var n in Array.isArray(i)||(i=[i]),this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(n)&&(window.tool===n||e||in_array(n,i))&&!is_empty(t.props[this.name_object_lines][this.names_line_id_by_tool[n]])){let e;if(e=this.is_multi(t)?this.get_tree_from_storage(t.props[this.name_object_lines][this.names_line_id_by_tool[n]][0]):this.get_tree_from_storage(t.props[this.name_object_lines][this.names_line_id_by_tool[n]]))return e}return null}set_tree_id(e,t,i,n){return!(!(n=n||this.get_type())||!this.names_line_id_by_tool[n])&&(e.props[this.name_object_lines]||(e.props[this.name_object_lines]={}),this.is_multi(e)?(e.props[this.name_object_lines][this.names_line_id_by_tool[n]]||(e.props[this.name_object_lines][this.names_line_id_by_tool[n]]=[]),-1===e.props[this.name_object_lines][this.names_line_id_by_tool[n]].indexOf(i)&&e.props[this.name_object_lines][this.names_line_id_by_tool[n]].push(i)):e.props[this.name_object_lines][this.names_line_id_by_tool[n]]=i,!0)}unset_tree_id(e,t,i,n){return!(!(i=i||this.get_type())||!this.names_line_id_by_tool[i])&&(e.props[this.name_object_lines]||(e.props[this.name_object_lines]={}),this.is_multi(e)?e.props[this.name_object_lines][this.names_line_id_by_tool[i]]&&-1!==(n=e.props[this.name_object_lines][this.names_line_id_by_tool[i]].indexOf(n))&&e.props[this.name_object_lines][this.names_line_id_by_tool[i]].splice(n,1):delete e.props[this.name_object_lines][this.names_line_id_by_tool[i]],!0)}set_source_new_node(e,t){if(!is_empty(this.items_any_connections))for(let e=0;e<items.db.length;e++)if(this.items_any_connections[items.db[e].props.name]&&this.check_source_items(this.get_name_item(items.db[e]))&&this.check_source_select(items.db[e],items.db[e].props.id,!0)){let t=!1,i,n=0,s=0;var o=this.get_polygon(items.db[e]);for(let e=0;e<o.length;e++){var l=e<o.length-1?get_line(o[e],o[e+1]):get_line(o[e],o[0]),r=LIB.projection(mouse.end,l);if(get_distance(mouse.end,r)<=5){t=!0,i=r,n=e,s=get_distance(o[e],r)/get_distance(l.s,l.e);break}}if(t)return this.source_item=items.db[e],this.source_id=this.get_id_item(this.source_item),this.source_point=i,this.source_connect={i:n,d:+s.toFixed(4)},this.source_name=this.get_name_item(this.source_item),this.color_line=this.get_color_by_type(this.get_type()),void this.draw_reference_lines()}!t&&in_array(tool,[...striping_light.tools,...striping_led.tools,...striping_line.tools])||(e=this.add_node_item(this.get_type(),e,t),this.source_node_id=e.props.id,this.source_id=e.props.id,this.source_point=e.props.center,this.source_item=e,this.source_name=this.name_node,this.search_tree_line(),this.draw_reference_lines())}set_source_node(n){this.source_id=n.props.id,this.source_point=n.props.center,this.source_item=n,this.source_name=this.name_node;let s=this.get_tree(n,!0);if(s&&s.items[n.props.id]){let t=0,i;for(let e=0;e<s.lines.length;e++)s.lines[e].line_id.includes(n.props.id)&&(i=s.lines[e].line_id,t++);var e;1===t&&(e=i.replace(n.props.id,"").replace("_",""),(e=s.getItem(e))&&this.draw_reference_lines_by_point(e.props.center))}}is_node(e){return this.get_name_item(e)===this.name_node&&(e.props[this.name_object_lines]||e.props.class_lining===this.constructor.name)}draw_reference_lines(t=null,i=!1){if(this.erase_reference_lines(),allow.magnet){manager_lining.image_reference_lines=layers.reference_lines.group();var n,s=get_big_line(get_line({x:this.source_point.x-100,y:this.source_point.y},{x:this.source_point.x+100,y:this.source_point.y}));let e;if(t)if(this.is_node(t))!t.start_item_tree||(o=this.get_item(t.start_item_tree))&&(e=get_big_line(get_line(this.source_point,this.get_point(this.get_type(),o,t.start_item_tree))));else if("pillar_water"===this.get_name_item(t)){if(t.id_room){var o=get_room(t.id_room);if(o&&o.edges)for(var l of o.edges){var r=LIB.projection(this.source_point,l);r&&get_distance(this.source_point,r)<20&&(e=copy.line(l))}}}else{o=get_wall(t.props.id_wall);!o||(t=LIB.projection(this.source_point,o.axis))&&(t=get_distance(this.source_point,t),e=get_parallel(o.axis.s,o.axis.e,t,"R",10),is_point_on_line(this.source_point,e)||(e=get_parallel(o.axis.s,o.axis.e,t,"L",10)))}if(e=e||copy.line(s))for(n in this.add_reference_lines(s,s),i||0<get_two_lines_angle(e,s)%45&&this.add_reference_lines(e,s),manager_lining.reference_lines)if(manager_lining.reference_lines.hasOwnProperty(n)){var a=3<n?"blue":"red",h=manager_lining.reference_lines[n];let e=manager_lining.image_reference_lines.line().attr({stroke:a,"stroke-width":.5,"stroke-dasharray":"3,3","stroke-opacity":.5});e.plot(h.s.x,h.s.y,h.e.x,h.e.y)}}}draw_reference_lines_by_point(e){var t;if((this.erase_reference_lines(),allow.magnet)&&(manager_lining.image_reference_lines=layers.reference_lines.group(),t=get_big_line(get_line({x:e.x-100,y:e.y},{x:e.x+100,y:e.y}))))for(var i in this.add_reference_lines(t,t,e),manager_lining.reference_lines)if(manager_lining.reference_lines.hasOwnProperty(i)){var n=3<i?"blue":"red",i=manager_lining.reference_lines[i];let e=manager_lining.image_reference_lines.line().attr({stroke:n,"stroke-width":.5,"stroke-dasharray":"3,3","stroke-opacity":.5});e.plot(i.s.x,i.s.y,i.e.x,i.e.y)}}add_reference_lines(e,t,i=null){i=i||this.source_point;let n=Math.round(Math.abs(get_line_angle(e)));is_point_on_line(get_line_center(e),e=get_rotation(t,i,n))||(n=-n),manager_lining.reference_lines.push(get_rotation(t,i,n)),manager_lining.reference_lines.push(get_rotation(t,i,n+45)),manager_lining.reference_lines.push(get_rotation(t,i,n+90)),manager_lining.reference_lines.push(get_rotation(t,i,n+135))}erase_reference_lines(){manager_lining.erase_reference_lines()}union_node(s,o){try{if(this.source_id&&this.is_exist_tree(this.source_item,!1,this.get_type())&&this.check_connection_items(this.source_name,this.get_name_item(s))){let e=this.source_item,t=s;var l=this.get_type();if(!this.check_allow_connect(e,t,this.source_id,o,!0))return!1;let i=this.get_tree(e,!1,l),n=!1;if(this.is_exist_tree(t,!1,l)){let e=this.get_tree(t,!1,l);e.unionByNode(i,o,this.source_id)}else i.changeSpot(e,t,this.source_id,o),this.set_tree_id(t,o,i.id,l),n=!0;this.unset_tree_id(e,this.source_id,l,i.id),e.delete({no_delete_lines:!0});try{t.paint()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}n&&i.draw(),this.unselect_source_item(),project.localSave()}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}insert_node(t){try{let e=this.get_tree_from_storage(t.id);if(this.source_id&&this.is_exist_tree(this.source_item,!1,this.get_type())&&e){var i=this.source_item,n=this.get_type();if(void 0!==e.items[this.source_id])return!1;if(n!==e.type)return!1;var s=this.get_tree(i,!1,n,this.source_id);e.insert(s,this.source_id,t.line_id),e.draw(),this.unselect_source_item(),project.localSave()}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}search_tree_line(){try{if(this.source_tree_line=null,!this.source_id)return;let t=this.source_item;var i=this.get_type(),n=this.get_trees_from_storage();for(let e=0;e<n.length;e++){var s=n[e];if(void 0===s.items[this.source_id]&&i===s.type)for(let e=0;e<s.lines.length;e++){var o=LIB.projection(mouse.end,s.lines[e].line);if(get_distance(mouse.end,o)<10)return this.source_tree_line=s.lines[e],this.source_point=o,t.props.center=o,void t.image.cx(o.x).cy(o.y)}}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}search_item(){try{if(this.source_id)return;for(let e=0;e<items.db.length;e++){var t=items.db[e];if(this.check_source_items(this.get_name_item(t))){let e=t.props.id;if(("socket_group"!==this.get_name_item(t)||(e=socketsGroup.getIdSocketByPoint(mouse.end,t)))&&this.check_source_select(t,e)&&(this.get_name_item(t)!==this.name_node||this.is_node(t))){var i=get_line(t.tp,t.bp);if(is_point_on_line(mouse.end,i,1))return!1!==this.mousedown(t,e);if(this.is_node(t)&&"StripingLight"===this.constructor.name&&"up"===t.spot_node_size&&get_distance(mouse.end,t.props.center)<9)return!1!==this.mousedown(t,e)}}}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_color_fill_of_item(e,t){return t=this.is_node(e)&&(e=this.get_tree(e,!0))?e.color:t}change_size_node(e,t){e&&("up"===t?e.image.attr({r:3,"stroke-width":1.5,fill:"#fafafa"}):e.image.attr({r:.5,"stroke-width":1,fill:this.get_color_fill_of_item(e,e.props.filling)}),e.spot_node_size=t)}mouseover(e,t){try{this.source_id?this.check_connection_items(this.source_name,this.get_name_item(e))&&this.check_allow_connect(this.source_item,e,this.source_id,t)&&($("body").css("cursor","pointer"),this.select(e,t)):this.check_source_items(this.get_name_item(e))&&this.check_source_select(e,t)&&($("body").css("cursor","pointer"),this.select(e,t),in_array(tool,[...striping_light.tools,...striping_led.tools,...striping_line.tools])&&this.is_node(e)&&(mouse.end=this.get_point(this.get_type(),e,t)))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mouseleave(e){this.source_id?$("body").css("cursor","crosshair"):$("body").css("cursor","pointer"),e.selected||this.unselect(e)}get_color_of_item(e,t){return this.is_node(e)&&((e=this.get_tree(e,!0))?t=e.color:(e=this.get_type())&&(t=this.get_color_by_type(e))),t}set_color_stroke(e,t,i){}set_color_fill(e,t){this.is_node(e)&&e.image.attr({fill:t})}draw_lines(i){if(i.props&&i.props[this.name_object_lines])for(var n in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(n)&&i.props[this.name_object_lines][this.names_line_id_by_tool[n]])if(this.is_multi(i))for(let t=0;t<i.props[this.name_object_lines][this.names_line_id_by_tool[n]].length;t++){let e=this.get_tree_from_storage(i.props[this.name_object_lines][this.names_line_id_by_tool[n]][t]);e&&e.draw()}else{let e=this.get_tree_from_storage(i.props[this.name_object_lines][this.names_line_id_by_tool[n]]);e&&e.draw()}}delete_lines(i,n=!1){if(i.props&&i.props[this.name_object_lines])for(var t in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(t)&&i.props[this.name_object_lines][this.names_line_id_by_tool[t]])if(this.is_multi(i)){var s=Object.values(i.props[this.name_object_lines][this.names_line_id_by_tool[t]]);for(let t=0;t<s.length;t++){let e=this.get_tree_from_storage(s[t]);e&&e.deleteByItem(this.get_id_item(i),n)}}else{let e=this.get_tree_from_storage(i.props[this.name_object_lines][this.names_line_id_by_tool[t]]);e&&e.deleteByItem(this.get_id_item(i),n)}}is_point_inside_item(e,t){return!(!t||!t.p1)&&is_point_over_polygon(e,[t.p1,t.p2,t.p3,t.p4])}get_all_multi_ids(t,i,n=null){let s=[];if("socket_group"===this.get_name_item(t)){n=socketsGroup.getSocketById(n,t);if(n&&this.names_line_id_by_tool[i]&&n[this.name_object_lines]&&n[this.name_object_lines][this.names_line_id_by_tool[i]]){let e=this.get_tree_from_storage(n[this.name_object_lines][this.names_line_id_by_tool[i]]);e&&(s=s.concat(e.getMultiItemIds()))}}else if(this.names_line_id_by_tool[i]&&t.props[this.name_object_lines]&&t.props[this.name_object_lines][this.names_line_id_by_tool[i]])if(this.is_multi(t))s=[this.get_id_item(t)];else{s.push(t.props[this.name_object_lines][this.names_line_id_by_tool[i]]);let e=this.get_tree_from_storage(t.props[this.name_object_lines][this.names_line_id_by_tool[i]]);e&&(s=e.getMultiItemIds())}return s}get_point_in_mousedown(e,t){let o;if(this.items_any_connections[this.get_name_item(e)]){let t=0,i=0;var l=this.get_polygon(e);let n=[],s={};for(let e=0;e<l.length;e++){var r=e<l.length-1?get_line(l[e],l[e+1]):get_line(l[e],l[0]),a=LIB.projection(mouse.end,r),h=get_distance(mouse.end,a);h<=5&&(n.push(h),s[h]={projection:a,edge_index:e,edge_distance:get_distance(l[e],a)/get_distance(r.s,r.e)})}if(0<n.length&&(n.sort(function(e,t){return e-t}),o=s[n[0]].projection,t=s[n[0]].edge_index,i=s[n[0]].edge_distance),!o)for(let e=0;e<l.length;e++){var g=e<l.length-1?get_line(l[e],l[e+1]):get_line(l[e],l[0]),_=LIB.projection(mouse.end,g);if(get_distance(mouse.end,_)<20){o=_,t=e,i=get_distance(l[e],o)/get_distance(g.s,g.e);break}}o||(o=LIB.projection(mouse.end,get_line(l[0],l[1])),t=0,i=get_distance(l[0],o)/get_distance(l[0],l[1])),this.source_connect={i:t,d:+i.toFixed(4)}}else o=this.get_point(this.get_type(),e,t);return o}draw_box(){return!1}}class ManagerLining{constructor(){this.image_reference_lines,this.reference_lines=[]}get_all_lining(){return[cabling,piping,cabling_socket,piping_conditioner,cabling_warm_floor,piping_heat,cabling_conditioner,striping_light,striping_led,striping_line]}get_lining_with_nodes(){return[piping,cabling_socket,piping_conditioner,cabling_warm_floor,piping_heat,cabling_conditioner,striping_light,striping_led,striping_line]}get_lining_with_pillar(){return[piping,piping_conditioner]}get_lining_with_nodes_dynamic(){return[piping,cabling_socket,piping_conditioner,cabling_warm_floor,piping_heat,cabling_conditioner,striping_light,striping_led,striping_line]}get_all_tools(){return[...cabling.tools,...piping.tools,...cabling_socket.tools,...piping_conditioner.tools,...cabling_warm_floor.tools,...piping_heat.tools,...cabling_conditioner.tools,...striping_light.tools,...striping_led.tools,...striping_line.tools]}svg_mouseup(t){if("light"===plan&&"track_line_spot"===tool&&striping_light.selected_strip_light_line&&striping_light.selected_strip_light_line.point_2)return!1===striping_light.mousedown_track_line_spot()&&striping_light.temporary_line_track_line.hide(),!0;t||(mouse.over.search("room"),null!==mouse.over.room&&rooms2.data[mouse.over.room]&&(t=rooms2.data[mouse.over.room].id));for(let e=0;e<this.get_lining_with_nodes().length;e++)if(this.svg_mouseup_tool(this.get_lining_with_nodes()[e],t))return!0;return!1}svg_mouseup_tool(e,t){if(in_array(tool,e.tools)){if(e.source_id){if(e.target_item&&e.target_id)return(e.target_item.moving=!1)===e.mousedown(e.target_item,e.target_id)&&(e.temporary_line.hide(),manager_lining.erase_reference_lines()),!0;if(e.target_point)return!1===e.mousedown(null,null,{center:e.target_point,id_room:t})&&(e.temporary_line.hide(),manager_lining.erase_reference_lines()),!0}return e.temporary_line.hide(),manager_lining.erase_reference_lines(),!0}return!1}svg_mousedown(){if("light"===plan&&"track_line_spot"===tool)striping_light.selected_strip_light_line&&(striping_light.selected_strip_light_line.point_1=striping_light.selected_strip_light_line.point);else{for(let e=0;e<this.get_lining_with_nodes().length;e++)this.svg_mousedown_tool(this.get_lining_with_nodes()[e]);in_array(tool,cabling.tools)&&!cabling.source_id&&cabling.search_item()}}svg_mousedown_tool(e){!in_array(tool,e.tools)||e.source_id||e.search_item()||(mouse.over.search("room"),e.set_source_new_node(mouse.end,null!==mouse.over.room?rooms2.data[mouse.over.room].id:""))}svg_mousemove(t){for(let e=0;e<this.get_all_lining().length;e++)this.svg_mousemove_tool(this.get_all_lining()[e],t);"light"===plan&&"track_line_spot"===tool&&striping_light.selected_strip_light_line&&striping_light.mousemove_track_line_spot(t)}svg_mousemove_tool(e,t){in_array(tool,e.tools)&&(e.source_id&&e.mousemove(t),"default"===$("body").css("cursor")&&(e.source_id?$("body").css("cursor","crosshair"):$("body").css("cursor","pointer")),in_array(tool,[...striping_light.tools,...striping_led.tools,...striping_line.tools])&&cursors.own.fire("move",t))}key_escape(){this.paint(),this.hide_temporary_line()}paint(){pipes.paint(),cables_socket.paint(),cables_warm_floor.paint(),pipes_conditioner.paint(),cables_conditioner.paint(),cables.paint(),pipes_heat.paint(),stripes_light.paint(),led_strips.paint(),line_strips.paint()}hide(){pipes.hide(),cables_socket.hide(),cables_warm_floor.hide(),pipes_conditioner.hide(),cables_conditioner.hide(),cables.hide(),pipes_heat.hide(),stripes_light.hide(),led_strips.hide(),line_strips.hide()}erase_reference_lines(){manager_lining.image_reference_lines&&manager_lining.image_reference_lines.clear(),layers.reference_lines.clear(),manager_lining.reference_lines&&(manager_lining.reference_lines=[]),window.light_reference_lines&&light_reference_lines.erase()}hide_temporary_line(){for(let e=0;e<this.get_all_lining().length;e++)this.get_all_lining()[e].temporary_line.hide();striping_light.temporary_line_track_line.hide(),this.erase_reference_lines()}init_temporary_line(){cabling.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i){this.IMAGE.clear();let n=2*get_distance(e,t);var s=["M",e.x,e.y,"A",n,n,0,0,1,t.x,t.y,"L",e.x,e.y,"A",n,n,0,0,0,t.x,t.y,"Z"].join(" "),e=["M",e.x,e.y,"A",n,n,0,0,1,t.x,t.y].join(" ");this.IMAGE.add(svg.path(s).attr({"stroke-width":0,fill:"transparent"})),this.IMAGE.add(svg.path(e).attr({stroke:i,"stroke-width":1,"stroke-dasharray":"8,4",fill:"none"})),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),cabling.unselect_source_item()}},piping.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n}),this.line.plot(e.x,e.y,t.x,t.y),piping.target_item&&piping.items_any_connections[piping.get_name_item(piping.target_item)]&&(this.point_e=this.IMAGE.circle(4).attr({fill:i}),this.point_e.cx(t.x).cy(t.y)),piping.source_item&&piping.items_any_connections[piping.get_name_item(piping.source_item)]&&(this.point_s=this.IMAGE.circle(4).attr({fill:i}),this.point_s.cx(e.x).cy(e.y)),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),piping.unselect_source_item()}},piping_conditioner.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n,"stroke-dasharray":"8,4"}),this.line.plot(e.x,e.y,t.x,t.y),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),piping_conditioner.unselect_source_item()}},cabling_conditioner.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n}),this.line.plot(e.x,e.y,t.x,t.y),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),cabling_conditioner.unselect_source_item()}},cabling_socket.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n,s){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n}),in_array(s,["wire_earth_3_15","wire_earth_3_60"])&&this.line.attr({"stroke-dasharray":"8,4"}),this.line.plot(e.x,e.y,t.x,t.y),cabling_socket.target_item&&cabling_socket.items_any_connections[cabling_socket.get_name_item(cabling_socket.target_item)]&&(this.point_e=this.IMAGE.circle(4).attr({fill:i}),this.point_e.cx(t.x).cy(t.y)),cabling_socket.source_item&&cabling_socket.items_any_connections[cabling_socket.get_name_item(cabling_socket.source_item)]&&(this.point_s=this.IMAGE.circle(4).attr({fill:i}),this.point_s.cx(e.x).cy(e.y)),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),cabling_socket.unselect_source_item()}},cabling_warm_floor.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n}),this.line.plot(e.x,e.y,t.x,t.y),cabling_warm_floor.target_item&&cabling_warm_floor.target_item.props&&"warm_floor"===cabling_warm_floor.target_item.props.name&&(this.point_e=this.IMAGE.circle(4).attr({stroke:"#dc143c","stroke-width":1,fill:"#dc143c"}),this.point_e.cx(t.x).cy(t.y)),"warm_floor"===cabling_warm_floor.source_name&&(this.point_s=this.IMAGE.circle(4).attr({stroke:"#dc143c","stroke-width":1,fill:"#dc143c"}),this.point_s.cx(e.x).cy(e.y)),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),cabling_warm_floor.unselect_source_item()}},piping_heat.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n,"stroke-dasharray":"8,4"}),this.line.plot(e.x,e.y,t.x,t.y),piping_heat.target_item&&piping_heat.items_any_connections[piping_heat.get_name_item(piping_heat.target_item)]&&(this.point_e=this.IMAGE.circle(5).attr({fill:i}),this.point_e.cx(t.x).cy(t.y)),piping_heat.source_item&&piping_heat.items_any_connections[piping_heat.get_name_item(piping_heat.source_item)]&&(this.point_s=this.IMAGE.circle(5).attr({fill:i}),this.point_s.cx(e.x).cy(e.y)),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),piping_heat.unselect_source_item()}},striping_light.temporary_line={IMAGE:serviceLayer.group(),draw:function(i,n,s,e,t){this.IMAGE.clear();var o=get_parallel(i,n,1.5,"L"),l=get_parallel(i,n,1.5,"R"),r=get_projection(i,o),o=get_projection(n,o),a=get_projection(i,l),l=get_projection(n,l);if("recessed_strip"===t){let e=svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:s})}),t=(e.untransform(),e.transform({rotation:get_line_angle(get_line(i,n))}),this.IMAGE.polygon().attr({stroke:"transparent",fill:e}));t.plot([r,o,l,a])}this.line_1=this.IMAGE.line().attr({stroke:s,"stroke-width":e}),"pendent_strip"===t&&this.line_1.attr({"stroke-dasharray":"4,2"}),this.line_1.plot(r.x,r.y,o.x,o.y),this.line_2=this.IMAGE.line().attr({stroke:s,"stroke-width":e}),"pendent_strip"===t&&this.line_2.attr({"stroke-dasharray":"4,2"}),this.line_2.plot(a.x,a.y,l.x,l.y),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),striping_light.unselect_source_item()}},striping_led.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n,"stroke-dasharray":"8,5,1,5,1,5,1,5","stroke-linecap":"round"}),this.line.plot(e.x,e.y,t.x,t.y),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),striping_led.unselect_source_item()}},striping_line.temporary_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n,"stroke-linecap":"round"}),this.line.plot(e.x,e.y,t.x,t.y);var i=get_parallel(e,t,1.5,"L"),n=get_parallel(e,t,1.5,"R"),s=get_projection(e,i),i=get_projection(t,i),e=get_projection(e,n),t=get_projection(t,n);let o=this.IMAGE.line().attr({stroke:"#000","stroke-width":1}),l=(o.plot(s.x,s.y,i.x,i.y),this.IMAGE.line().attr({stroke:"#000","stroke-width":1}));l.plot(e.x,e.y,t.x,t.y),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),striping_line.unselect_source_item()}},striping_light.temporary_line_track_line={IMAGE:serviceLayer.group(),draw:function(e,t,i,n){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({stroke:i,"stroke-width":n,"stroke-linecap":"round"}),this.line.plot(e.x,e.y,t.x,t.y);var n=get_parallel(e,t,1.5,"L"),s=get_parallel(e,t,1.5,"R"),o=get_projection(e,n),n=get_projection(t,n),l=get_projection(e,s),s=get_projection(t,s);let r=this.IMAGE.line().attr({stroke:"#000","stroke-width":1}),a=(r.plot(o.x,o.y,n.x,n.y),this.IMAGE.line().attr({stroke:"#000","stroke-width":1}));a.plot(l.x,l.y,s.x,s.y),this.point_e=this.IMAGE.circle(5).attr({fill:i}),this.point_e.cx(t.x).cy(t.y),this.point_s=this.IMAGE.circle(5).attr({fill:i}),this.point_s.cx(e.x).cy(e.y),this.IMAGE.show()},show:function(){this.IMAGE.show()},hide:function(){this.IMAGE.hide(),striping_light.unselect_source_item()}}}project_draw(){"light_connections"===plan&&(cables.draw(),cables.paint(),stripes_light.draw(),stripes_light.paint(),led_strips.draw(),led_strips.paint(),line_strips.draw(),line_strips.paint()),"water"===plan&&(pipes.draw(),pipes.paint()),"cables"===plan&&(cables_socket.draw(),cables_socket.paint()),"warm_floor"===plan&&(cables_warm_floor.draw(),cables_warm_floor.paint()),"conditioners"===plan&&(pipes_conditioner.draw(),pipes_conditioner.paint(),cables_conditioner.draw(),cables_conditioner.paint()),"radiators"===plan&&(pipes_heat.draw(),pipes_heat.paint()),"light"===plan&&(stripes_light.draw(),stripes_light.paint(),led_strips.draw(),led_strips.paint(),line_strips.draw(),line_strips.paint())}project_restore(e){led_strips.restore(e.led_strips,e.cables),stripes_light.restore(e.stripes_light),line_strips.restore(e.line_strips),cables.restore(e.cables),pipes.restore(e.pipes),pipes_conditioner.restore(e.pipes_conditioner),cables_conditioner.restore(e.cables_conditioner),pipes_heat.restore(e.pipes_heat),cables_socket.restore(e.cables_socket),cables_warm_floor.restore(e.cables_warm_floor)}project_update_length(){cables.update_length(),pipes.update_length(),pipes_conditioner.update_length(),cables_conditioner.update_length(),pipes_heat.update_length(),cables_socket.update_length(),cables_warm_floor.update_length(),stripes_light.update_length(),led_strips.update_length(),line_strips.update_length()}project_delete(){cables.delete(),pipes.delete(),pipes_conditioner.delete(),cables_conditioner.delete(),pipes_heat.delete(),cables_socket.delete(),cables_warm_floor.delete(),stripes_light.delete(),led_strips.delete(),line_strips.delete()}cursor_create(e){if("light"===plan&&"track_line_spot"===tool)return!0;if(in_array(tool,cabling.tools))return null===e||cabling.source_id&&cabling.target_item&&cabling.target_id&&(cabling.target_item.moving=!1,cabling.mousedown(cabling.target_item,cabling.target_id,cabling.target_strip_node_id)),!0;for(let e=0;e<this.get_lining_with_nodes().length;e++)if(in_array(tool,this.get_lining_with_nodes()[e].tools))return!0;return!1}pillar_draw(i){for(let t=0;t<this.get_lining_with_pillar().length;t++){let e=this.get_lining_with_pillar()[t];plan===e.plan&&i.props&&i.props[e.name_object_lines]&&e.draw_lines(i)}}pillar_delete(i){if(i.props)for(let t=0;t<this.get_lining_with_pillar().length;t++){let e=this.get_lining_with_pillar()[t];i.props[e.name_object_lines]&&e.delete_lines(i)}}pillar_mouseover(i){for(let t=0;t<this.get_lining_with_pillar().length;t++){let e=this.get_lining_with_pillar()[t];plan===e.plan&&in_array(tool,e.tools)&&e.mouseover(i,i.id)}}pillar_mouseleave(i){for(let t=0;t<this.get_lining_with_pillar().length;t++){let e=this.get_lining_with_pillar()[t];plan===e.plan&&in_array(tool,e.tools)&&(i.selected=!1,e.mouseleave(i))}}pillar_mousedown(i){for(let t=0;t<this.get_lining_with_pillar().length;t++){let e=this.get_lining_with_pillar()[t];plan===e.plan&&in_array(tool,e.tools)&&e.mousedown(i,i.id)}}item_beforedrag(t){for(let e=0;e<this.get_lining_with_nodes().length;e++)this.item_beforedrag_tool(this.get_lining_with_nodes()[e],t)}item_beforedrag_tool(e,t){plan===e.plan&&e.is_node(t)&&t.props[e.name_object_lines]&&e.set_source_node(t),plan===striping_light.plan&&in_array(t.props.name,striping_light.track_spots)&&t.props.strip_light_id&&striping_light.set_moved_strip_light(t)}item_dragmove(t){for(let e=0;e<this.get_lining_with_nodes().length;e++)if(this.item_dragmove_tool(this.get_lining_with_nodes()[e],t))return!0;return!1}item_dragmove_tool(e,t){return!(plan!==e.plan||!e.is_node(t)||!e.target_point)&&(t.props.center=e.target_point,!0)}item_dragend(t){for(let e=0;e<this.get_lining_with_nodes().length;e++)this.item_dragend_tool(this.get_lining_with_nodes()[e],t);plan===striping_light.plan&&in_array(t.props.name,striping_light.track_spots)&&t.props.strip_light_id&&striping_light.update_spot_strip_light(t)}item_dragend_tool(e,t){e.is_node(t)&&(e.source_id&&t.props[e.name_object_lines]&&(e.target_item?(e.target_item.moving=!1,e.union_node(e.target_item,e.target_id)):e.target_tree_line&&e.insert_node(e.target_tree_line)),manager_lining.erase_reference_lines(),e.unselect_source_item())}item_draw(i){for(let t=0;t<this.get_all_lining().length;t++){let e=this.get_all_lining()[t];plan===e.plan&&e.draw_lines(i)}}item_move(i){plan===cabling.plan&&cabling.draw_lines(i);for(let t=0;t<this.get_lining_with_nodes().length;t++){let e=this.get_lining_with_nodes()[t];plan===e.plan&&(i.props[e.name_object_lines]&&(e.is_node(i)&&(e.source_point=i.props.center,e.mousemove_node()||(i.image.cx(i.props.center.x).cy(i.props.center.y),i.show()),plan===striping_light.plan&&(i.lines&&i.lines.clear(),i.build("XDimensions"))),e.draw_lines(i)),plan===striping_light.plan&&striping_light.update_line_size(i))}}item_blink(i){if(i.props.cable_id||i.props.cables)return cabling.mouseleave(i),!0;for(let t=0;t<this.get_lining_with_nodes().length;t++){let e=this.get_lining_with_nodes()[t];if(i.props[e.name_object_lines])return e.mouseleave(i),!0}return!1}item_delete(i){for(let t=0;t<this.get_all_lining().length;t++){let e=this.get_all_lining()[t];e.delete_lines(i,!0)}plan===striping_light.plan&&striping_light.delete_spot(i,!0)}item_mousedown(i){if(plan===cabling.plan&&"cable"===tool){let e;if(striping_led.is_node(i)&&i.props[striping_led.name_object_lines]?e=striping_led.get_tree(i,!0):striping_line.is_node(i)&&i.props[striping_line.name_object_lines]?e=striping_line.get_tree(i,!0):striping_light.is_node(i)&&i.props[striping_light.name_object_lines]&&(e=striping_light.get_tree(i,!0)),e)return i.click_zone.moving=!1,cabling.mousedown(e,e.id,i.props.id),!0}for(let t=0;t<this.get_all_lining().length;t++){let e=this.get_all_lining()[t];if(in_array(tool,e.tools)&&(i.selected_socket_group||i.props.id))return i.click_zone.moving=!1,e.mousedown(i,i.selected_socket_group||i.props.id),!0}return!1}item_mouseover_check(e){for(let e=0;e<this.get_lining_with_nodes().length;e++){var t=this.get_lining_with_nodes()[e];if(plan===t.plan&&(t.source_id||!0===t.moving_point_line))return!0}return!!(e&&e.props&&"socket_group"===e.props.name&&in_array(plan,[cabling_socket.plan,cabling.plan])&&in_array(tool,cabling_socket.tools.concat(cabling.tools)))}item_mouseover(i){for(let t=0;t<this.get_all_lining().length;t++){let e=this.get_all_lining()[t];in_array(tool,e.tools)&&e.mouseover(i,i.selected_socket_group||i.props.id)}if(plan===cabling.plan&&"cable"===tool){let e;striping_led.is_node(i)&&i.props[striping_led.name_object_lines]?e=striping_led.get_tree(i,!0):striping_line.is_node(i)&&i.props[striping_line.name_object_lines]?e=striping_line.get_tree(i,!0):striping_light.is_node(i)&&i.props[striping_light.name_object_lines]&&(e=striping_light.get_tree(i,!0)),e&&cabling.mouseover(e,e.id,i.props.id,i)}}item_select(e){plan===piping.plan&&piping.select(e,e.props.id),plan===cabling_socket.plan&&cabling_socket.select(e,e.selected_socket_group||e.props.id)}item_mouseleave(i){for(let t=0;t<this.get_all_lining().length;t++){let e=this.get_all_lining()[t];in_array(tool,e.tools)&&(!e.source_id&&e.check_source_items(i.props.name)||e.source_id&&e.check_connection_items(e.source_name,i.props.name))&&(e.get_name_item(i)!==e.name_node||e.is_node(i))?e.mouseleave(i):plan===piping.plan&&!i.selected&&i.isAvailable()&&piping.unselect(i)}if(plan===cabling.plan&&"cable"===tool){let e;striping_led.is_node(i)&&i.props[striping_led.name_object_lines]?e=striping_led.get_tree(i,!0):striping_line.is_node(i)&&i.props[striping_line.name_object_lines]?e=striping_line.get_tree(i,!0):striping_light.is_node(i)&&i.props[striping_light.name_object_lines]&&(e=striping_light.get_tree(i,!0)),e&&cabling.mouseleave(e,i)}}is_lining_plan(e){return cabling.is_cabling_plan(e)||cabling_socket.is_cabling_plan(e)}item_get_stroke(i,n){for(let t=0;t<this.get_all_lining().length;t++){let e=this.get_all_lining()[t];if((plan===e.plan||e.plans&&in_array(plan,e.plans))&&(i.props[e.name_object_lines]||"light_connections"===e.plan&&"electrospot_node"!==i.props.name))return e.get_color_of_item(i,n)}return n}item_get_stroke_width(i,e){for(let t=0;t<this.get_lining_with_nodes_dynamic().length;t++){let e=this.get_lining_with_nodes_dynamic()[t];if(plan===e.plan&&e.is_node(i)&&"up"===i.spot_node_size)return 1.5}return e}item_get_filling(i,n){for(let t=0;t<this.get_lining_with_nodes_dynamic().length;t++){let e=this.get_lining_with_nodes_dynamic()[t];if((plan===e.plan||e.plans&&in_array(plan,e.plans))&&i.props[e.name_object_lines])return n=e.get_color_fill_of_item(i,n),n=e.is_node(i)&&"up"===i.spot_node_size?"#fafafa":n}return n}change_size_node(i,n){for(let t=0;t<this.get_lining_with_nodes_dynamic().length;t++){let e=this.get_lining_with_nodes_dynamic()[t];(plan===e.plan||e.plans&&in_array(plan,e.plans))&&i.props[e.name_object_lines]&&e.is_node(i)&&e.change_size_node(i,n)}}get_tree_by_node(e){var t=get_item(e);if(!t||!t.props)return!1;for(let e=0;e<this.get_lining_with_nodes().length;e++)if(t.props[this.get_lining_with_nodes()[e].name_object_lines]){var i=Object.values(t.props[this.get_lining_with_nodes()[e].name_object_lines]);if(i&&i[0]){i=this.get_lining_with_nodes()[e].get_tree_from_storage(i[0]);if(i)return i}break}return!1}is_allow_union_line(t){let i=this.get_tree_by_node(t);if(!i)return!1;let n=0;for(let e=0;e<i.lines.length;e++)i.lines[e].line_id.includes(t)&&n++;return 2===n}union_line(e){let t=this.get_tree_by_node(e);t&&t.unionLine(e)}}var manager_lining=new ManagerLining;class GraphLines{constructor(e={}){this.id=e.id||LIB.id(),this.color=e.color||"gray",this.matrix=e.matrix||[],this.vertexes=e.vertexes||[],this.items=e.items||{},this.lines=[],this.type="",this.plan="",this.plans=[],this.name_human="",this.points_connections=e.points_connections||{},this.socket_group_ids=e.socket_group_ids||{},this.points_line=[],this.length=0,this.IMAGE=null,this.IMAGE_2=null,this.IMAGE_3=null}serialize(){return{id:this.id,matrix:this.matrix,vertexes:this.vertexes,items:this.items,type:this.type,length:this.length}}erase(){this.IMAGE.clear(),this.IMAGE_2&&this.IMAGE_2.clear(),this.IMAGE_3&&this.IMAGE_3.clear(),this.points_line.forEach(e=>{e.erase()}),this.points_line=[]}show(){this.IMAGE.show(),this.IMAGE_2&&this.IMAGE_2.show(),this.IMAGE_3&&this.IMAGE_3.show(),this.points_line.forEach(e=>{e.show()})}hide(){this.IMAGE.hide(),this.IMAGE_2&&this.IMAGE_2.hide(),this.IMAGE_3&&this.IMAGE_3.hide(),this.points_line.forEach(e=>{e.hide()})}mouseover(e){return plan===this.plan&&(!!isContextmenuHidden()&&!!e.target)}mouseleave(e){return plan===this.plan&&!!isContextmenuHidden()}mousedown(e){return plan===this.plan&&!!e.target}drawOneElement(e,t,i,n){}getTypeItem(e){return""}addNew(e){}deleteFromStorage(e){}getLining(){switch(this.plan){case"water":return piping;case"light_connections":return cabling;case"cables":return cabling_socket;case"conditioners":return"CableConditioner"===this.constructor.name?cabling_conditioner:piping_conditioner;case"warm_floor":return cabling_warm_floor;case"radiators":return piping_heat;case"light":return"LedStrip"===this.constructor.name?striping_led:"LineStrip"===this.constructor.name?striping_line:striping_light}return{}}getItem(e){return this.getLining().get_item(e)}getIdItem(e){return this.getLining().get_id_item(e)}getNameItem(e){return this.getLining().get_name_item(e)}unsetFromItem(e,t){this.getLining().unset_tree_id(e,t,this.type,this.id)}setToItem(e,t){this.getLining().set_tree_id(e,t,this.id,this.type)}getPoint(e,t){return this.getLining().get_point(this.type,e,t,this.id)}updateData(e={}){this.items={},this.color="gray";for(let i=0;i<this.vertexes.length;i++){let e=this.getItem(this.vertexes[i].id);if(e){this.items[this.vertexes[i].id]=this.getTypeItem(e);let t=this.getLining();this.getLining().is_multi(e)&&t.names_line_id_by_tool[this.type]&&e.props[t.name_object_lines]&&e.props[t.name_object_lines][t.names_line_id_by_tool[this.type]]&&Array.isArray(e.props[t.name_object_lines][t.names_line_id_by_tool[this.type]])&&(e.props[t.name_object_lines][t.names_line_id_by_tool[this.type]]=e.props[t.name_object_lines][t.names_line_id_by_tool[this.type]].filter(e=>{return!!t.get_tree_from_storage(e)})),this.setToItem(e,this.vertexes[i].id)}}for(var t in this.defineColor(),this.getNodes().forEach(e=>{e.image.attr({stroke:this.getLining().get_color_of_item(e,this.color)})}),this.points_connections){var i;this.points_connections.hasOwnProperty(t)&&(i=t.split("-"),void 0!==this.items[i[0]]&&void 0!==this.items[i[1]]||delete this.points_connections[t])}if((!0===e.update_spots||void 0===e.update_spots)&&this.spots){for(var n in this.spots)if(this.spots.hasOwnProperty(n)){var s=this.spots[n].line_id.split("_");if(void 0===this.items[s[0]]||void 0===this.items[s[1]])delete this.spots[n];else{let e=get_item(n);e&&(e.props.strip_light_id=this.id)}}for(let e=this.line_spots.length-1;0<=e;e--){var o=this.line_spots[e].line_id.split("_");void 0!==this.items[o[0]]&&void 0!==this.items[o[1]]||this.line_spots.splice(e,1)}}}getNodes(){let e=[];for(var t in this.items)!this.items.hasOwnProperty(t)||"node"===this.items[t]&&(t=this.getItem(t))&&e.push(t);return e}isNode(e){return"node"===this.items[this.getIdItem(e)]||"node"===this.getTypeItem(e)}draw(){if(plan===this.plan||in_array(plan,this.plans)){try{this.erase(),this.lines=[];for(let t=0;t<this.matrix.length;t++)for(let e=t;e<this.matrix[t].length;e++){var i,n;null!==this.matrix[t][e]&&(i=this.getItem(this.vertexes[t].id),n=this.getItem(this.vertexes[e].id),i&&n&&this.drawOneElement(i,n,this.vertexes[t].id,this.vertexes[e].id))}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}if(this.updateLength(),this.getLining().draw_box(),in_array(this.constructor.name,["LedStrip","LineStrip","StripLight"])&&this.props.cable_id){let e=cabling.get_tree_from_storage(this.props.cable_id);e&&e.draw()}}}deleteFull(t="",i=!1){try{for(var n in this.erase(),this.items)if(this.items.hasOwnProperty(n)){let e=this.getItem(n);e?(this.unsetFromItem(e,n),e.paint(),"node"!==this.items[n]||!0===i&&t===n||e.delete({no_delete_lines:!0})):console.warn("plan "+this.plan+". No item "+this.items[n]+" "+n)}this.deleteFromStorage(this.id)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}this.getLining().draw_box()}deleteByItem(e,t=!1){try{if(2===Object.keys(this.items).length)return this.deleteFull(e,t),!0;var i=this.getIndexVertex(e);if(!1===i)return!1;for(let e=0;e<this.matrix[i].length;e++)null!==this.matrix[i][e]&&(this.matrix[i][e]=null,this.matrix[e][i]=null);var n=this.getSubMatrix();if(is_empty(n))return this.deleteFull(e,t),!0;if(1===n.length)return this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box(),!0;for(let e=0;e<n.length;e++){var s=n[e];1===s.length?this.unsetFromItems([this.vertexes[+s[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,s)}return this.erase(),this.deleteFromStorage(this.id),!0}catch(e){return send_error_js(e.name,e.message,e.stack),console.error(e),!1}}deleteByLine(e){if(window.contextmenu_tree_line_id=null,e){if(2===Object.keys(this.items).length)return this.deleteFull(),void project.localSave();e=e.split("_");if(2!==e.length)return!1;var t=this.getIndexVertex(e[0]);if(!1===t)return!1;e=this.getIndexVertex(e[1]);if(!1===e)return!1;this.matrix[t][e]=null,this.matrix[e][t]=null;var i=this.getSubMatrix();if(is_empty(i))return this.deleteFull(),project.localSave(),!0;if(1===i.length)this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box();else{for(let e=0;e<i.length;e++){var n=i[e];1===n.length?this.unsetFromItems([this.vertexes[+n[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,n)}this.erase(),this.deleteFromStorage(this.id)}return project.localSave(),!0}}updateLength(){try{this.length=+(this.getLength()/100).toFixed(2),this.length||(this.length=0)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}getLength(){let i=0;for(let t=0;t<this.matrix.length;t++)for(let e=t;e<this.matrix[t].length;e++){var n,s,o;null!==this.matrix[t][e]&&(n=this.getItem(this.vertexes[t].id),s=this.getItem(this.vertexes[e].id),n&&s&&(o=this.getPosition(this.vertexes[t].id,this.vertexes[e].id),i+=get_distance(o.s||this.getPoint(n,this.vertexes[t].id),o.e||this.getPoint(s,this.vertexes[e].id))))}return+i.toFixed(1)}contextmenu(e){hide2.contextmenu()}addItem(e,t){let i=this.getIndexVertex(e),n=(!1===i&&(this.vertexes.push({id:e}),i=this.vertexes.length-1,this.addRowMatrix()),this.getIndexVertex(t));!1===n&&(this.vertexes.push({id:t}),n=this.vertexes.length-1,this.addRowMatrix()),this.matrix[i][n]={length:1},this.matrix[n][i]={length:1}}addRowMatrix(){this.matrix.push([]);var t=this.matrix.length-1;for(let e=0;e<this.matrix.length-1;e++)this.matrix[t].push(null);for(let e=0;e<this.matrix.length;e++)this.matrix[e].push(null)}getCountItems(e=""){if(""===e)return Object.keys(this.items).length;let t=0;for(var i in this.items)this.items.hasOwnProperty(i)&&this.items[i]===e&&t++;return t}union(i,e,t,n=null,s=null){for(var o in null!==n&&null!==s?this.points_connections[e+"-"+t]=[n,s]:(null!==n&&(this.points_connections[e+"-"+t]=[n,""]),null!==s&&(this.points_connections[e+"-"+t]=["",s])),i.points_connections)i.points_connections.hasOwnProperty(o)&&(this.points_connections[o]=i.points_connections[o]);if(i.spots){for(var l in i.spots)i.spots.hasOwnProperty(l)&&(this.spots[l]=i.spots[l]);for(let e=0;e<i.line_spots.length;e++)this.line_spots.push(i.line_spots[e])}var r=this.matrix.length;for(let t=0;t<this.matrix.length;t++)for(let e=0;e<i.vertexes.length;e++)this.matrix[t].push(null);for(let t=0;t<i.vertexes.length;t++){this.vertexes.push(i.vertexes[t]),this.matrix.push([]);for(let e=0;e<r;e++)this.matrix[this.matrix.length-1].push(null);for(let e=0;e<i.matrix[t].length;e++)this.matrix[this.matrix.length-1].push(i.matrix[t][e])}n=this.getIndexVertex(e);return!1!==n&&(!1!==(s=this.getIndexVertex(t))&&(this.matrix[n][s]={length:1},this.matrix[s][n]={length:1},in_array(this.constructor.name,["LedStrip","LineStrip","StripLight"])&&(this.deleteCable(),i.deleteCable()),i.erase(),this.deleteFromStorage(i.id),this.updateData(),void this.draw()))}unionByNode(i,e,t){for(var n in i.points_connections)i.points_connections.hasOwnProperty(n)&&(this.points_connections[n]=i.points_connections[n]);if(i.spots){for(var s in i.spots)i.spots.hasOwnProperty(s)&&(this.spots[s]=i.spots[s]);for(let e=0;e<i.line_spots.length;e++)this.line_spots.push(i.line_spots[e])}var o=this.getIndexVertex(e);if(!1===o)return!1;var l=i.getIndexVertex(t);if(!1===l)return!1;var r,a=this.matrix.length;for(let t=0;t<this.matrix.length;t++)for(let e=0;e<i.vertexes.length-1;e++)this.matrix[t].push(null);for(let t=0;t<i.vertexes.length;t++)if(t!==l){this.vertexes.push(i.vertexes[t]),this.matrix.push([]);for(let e=0;e<a;e++)this.matrix[this.matrix.length-1].push(null);for(let e=0;e<i.matrix[t].length;e++)e!==l&&this.matrix[this.matrix.length-1].push(i.matrix[t][e])}for(let e=0;e<i.matrix[l].length;e++)null!==i.matrix[l][e]&&(r=l>e?e+a:e+a-1,this.matrix[o][r]={length:1},this.matrix[r][o]={length:1});in_array(this.constructor.name,["LedStrip","LineStrip","StripLight"])&&(this.deleteCable(),i.deleteCable()),i.erase(),this.deleteFromStorage(i.id),this.updateData({update_spots:!1}),this.draw(),this.spots&&(this.update_spots(),this.draw())}insert(i,e,t){for(var n in i.points_connections)i.points_connections.hasOwnProperty(n)&&(this.points_connections[n]=i.points_connections[n]);if(i.spots){for(var s in i.spots)i.spots.hasOwnProperty(s)&&(this.spots[s]=i.spots[s]);for(let e=0;e<i.line_spots.length;e++)this.line_spots.push(i.line_spots[e])}t=t.split("_");if(2!==t.length)return!1;var o=this.getIndexVertex(t[0]);if(!1===o)return!1;var l=this.getIndexVertex(t[1]);if(!1===l)return!1;this.matrix[o][l]=null,this.matrix[l][o]=null;var r=this.matrix.length;for(let t=0;t<this.matrix.length;t++)for(let e=0;e<i.vertexes.length;e++)this.matrix[t].push(null);for(let t=0;t<i.vertexes.length;t++){this.vertexes.push(i.vertexes[t]),this.matrix.push([]);for(let e=0;e<r;e++)this.matrix[this.matrix.length-1].push(null);for(let e=0;e<i.matrix[t].length;e++)this.matrix[this.matrix.length-1].push(i.matrix[t][e])}var a=this.getIndexVertex(e);!1!==a&&(this.matrix[o][a]={length:1},this.matrix[a][o]={length:1},this.matrix[l][a]={length:1},this.matrix[a][l]={length:1});let h,g;this.points_connections[t[0]+"-"+t[1]]?(h=this.points_connections[t[0]+"-"+t[1]][0],g=this.points_connections[t[0]+"-"+t[1]][1],delete this.points_connections[t[0]+"-"+t[1]]):this.points_connections[t[1]+"-"+t[0]]&&(h=this.points_connections[t[1]+"-"+t[0]][1],g=this.points_connections[t[1]+"-"+t[0]][0],delete this.points_connections[t[1]+"-"+t[0]]),h&&(this.points_connections[t[0]+"-"+e]=[h,""]),g&&(this.points_connections[t[1]+"-"+e]=[g,""]),in_array(this.constructor.name,["LedStrip","LineStrip","StripLight"])&&(this.deleteCable(),i.deleteCable()),i.erase(),this.deleteFromStorage(i.id),this.updateData({update_spots:!1}),this.draw(),this.spots&&(this.update_spots(),this.draw())}unsetFromItems(i){for(let t=0;t<i.length;t++){var n=i[t];let e=this.getItem(n);this.unsetFromItem(e,n),this.isNode(e)?e.delete({no_delete_lines:!0}):e.paint()}}addSpot(e,t,i,n,s=null,o=null){e=this.getTypeItem(e),t=this.getTypeItem(t);this.items[i]=e,this.items[n]=t,null!==s&&null!==o?this.points_connections[i+"-"+n]=[s,o]:(null!==s&&(this.points_connections[i+"-"+n]=[s,""]),null!==o&&(this.points_connections[i+"-"+n]=["",o])),this.addItem(i,n)}changeSpot(e,t,i,n){t=this.getTypeItem(t),delete this.items[i],this.items[n]=t,t=this.getIndexVertex(i);this.vertexes[t].id=n}isExistMovingNodes(){for(var e in this.items)if(this.items.hasOwnProperty(e))if("node"===this.items[e])if(this.getItem(e).click_zone.moving)return!0;return!1}isExistMovingItems(){for(let e=0;e<items.db.length;e++){var t=items.db[e];if(this.getLining().items_any_connections[t.props.name]&&t.click_zone.moving)return!0}return!1}changeSizeNodes(t){this.getNodes().forEach(e=>{this.getLining().change_size_node(e,t)})}defineColor(){this.color=this.getLining().get_color_by_type(this.type)}addNode(e,t,i,n=null){var i=this.getLining().add_node_item(this.type,i.center,i.id_room),s=i.props.id;return this.items[t]=this.getTypeItem(e),this.items[s]="node",null!==n&&(this.points_connections[t+"-"+s]=[n,""]),this.addItem(t,s),i}getMultiItemIds(){let e=[];for(var t in this.items){var i;this.items.hasOwnProperty(t)&&((i=this.getItem(t))&&this.getLining().is_multi(i)&&e.push(t))}return e}getPosition(e,t){let i="",n="",s,o;return this.points_connections[e+"-"+t]?(s=this.points_connections[e+"-"+t][0],o=this.points_connections[e+"-"+t][1]):this.points_connections[t+"-"+e]&&(s=this.points_connections[t+"-"+e][1],o=this.points_connections[t+"-"+e][0]),s&&(e=this.getLining().get_polygon(this.getItem(e)),e=s.i<e.length-1?get_line(e[s.i],e[s.i+1]):get_line(e[s.i],e[0]),i=LIB.pointOnLine(e.e,e.s,-(get_distance(e.e,e.s)*s.d))),o&&(e=this.getLining().get_polygon(this.getItem(t)),t=o.i<e.length-1?get_line(e[o.i],e[o.i+1]):get_line(e[o.i],e[0]),n=LIB.pointOnLine(t.e,t.s,-(get_distance(t.e,t.s)*o.d))),{s:i,e:n}}checkValid(){}unionLine(t){var i=this.getIndexVertex(t);if(!1===i)return!1;let n=[],s=[];for(let e=0;e<this.matrix[i].length;e++)null!==this.matrix[i][e]&&(n.push(e),s.push(this.vertexes[e].id),this.matrix[i][e]=null,this.matrix[e][i]=null);if(2!==n.length)return!1;if(this.matrix[n[0]][n[1]]={length:1},this.matrix[n[1]][n[0]]={length:1},in_array(this.constructor.name,["LedStrip","LineStrip","StripLight"])&&this.props.cable_id){var o=cabling.get_tree_from_storage(this.props.cable_id);if(o){let e=JSON.stringify(o.strips_connections);e.includes(t)&&this.deleteCable()}}let e=this.getItem(t),l=(delete e.props[this.getLining().name_object_lines],e&&e.delete(),""),r="";if(this.points_connections[s[0]+"-"+t]?(l=(l=l||this.points_connections[s[0]+"-"+t][0])||this.points_connections[s[0]+"-"+t][1],delete this.points_connections[s[0]+"-"+t]):this.points_connections[t+"-"+s[0]]&&(l=(l=l||this.points_connections[t+"-"+s[0]][1])||this.points_connections[t+"-"+s[0]][0],delete this.points_connections[t+"-"+s[0]]),this.points_connections[t+"-"+s[1]]?(r=(r=r||this.points_connections[t+"-"+s[1]][0])||this.points_connections[t+"-"+s[1]][1],delete this.points_connections[t+"-"+s[1]]):this.points_connections[s[1]+"-"+t]&&(r=(r=r||this.points_connections[s[1]+"-"+t][1])||this.points_connections[s[1]+"-"+t][0],delete this.points_connections[s[1]+"-"+t]),(l||r)&&(this.points_connections[s[0]+"-"+s[1]]=[l,r]),this.rebuildGraph(),this.updateData({update_spots:!1}),this.spots){for(var a in this.spots)if(this.spots.hasOwnProperty(a)){var h=this.spots[a].line_id.split("_");if(void 0===this.items[h[0]]||void 0===this.items[h[1]]){delete this.spots[a];let e=get_item(a);e&&e.delete()}}for(let e=this.line_spots.length-1;0<=e;e--){var g=this.line_spots[e].line_id.split("_");void 0!==this.items[g[0]]&&void 0!==this.items[g[1]]||this.line_spots.splice(e,1)}}this.draw()}splitLine(t,e){window.contextmenu_tree_line_id=null,window.contextmenu_tree_line_point=null;let i=e;for(let e=0;e<this.lines.length;e++)if(this.lines[e].line_id===t){i=LIB.projection(mouse.end,this.lines[e].line);break}let n="",s=(rooms2.data&&null!==mouse.over.room&&rooms2.data[mouse.over.room]?n=rooms2.data[mouse.over.room].id:(mouse.over.search("room"),rooms2.data&&null!==mouse.over.room&&rooms2.data[mouse.over.room]&&(n=rooms2.data[mouse.over.room].id)),this.getLining().add_node_item(this.type,i,n));e=t.split("_");if(2!==e.length)return!1;var o=this.getIndexVertex(e[0]);if(!1===o)return!1;var l=this.getIndexVertex(e[1]);if(!1===l)return!1;this.matrix[o][l]=null,this.matrix[l][o]=null;for(let e=0;e<this.matrix.length;e++)this.matrix[e].push(null);this.vertexes.push({id:s.props.id}),this.matrix.push([]);for(let e=0;e<this.matrix.length;e++)this.matrix[this.matrix.length-1].push(null);var r=this.getIndexVertex(s.props.id);!1!==r&&(this.matrix[o][r]={length:1},this.matrix[r][o]={length:1},this.matrix[l][r]={length:1},this.matrix[r][l]={length:1});let a,h;this.points_connections[e[0]+"-"+e[1]]?(a=this.points_connections[e[0]+"-"+e[1]][0],h=this.points_connections[e[0]+"-"+e[1]][1],delete this.points_connections[e[0]+"-"+e[1]]):this.points_connections[e[1]+"-"+e[0]]&&(a=this.points_connections[e[1]+"-"+e[0]][1],h=this.points_connections[e[1]+"-"+e[0]][0],delete this.points_connections[e[1]+"-"+e[0]]),a&&(this.points_connections[e[0]+"-"+s.props.id]=[a,""]),h&&(this.points_connections[e[1]+"-"+s.props.id]=[h,""]),this.updateData({update_spots:!1}),void 0===this.items[s.props.id]?s.delete():s.draw(),this.draw(),this.spots&&(this.update_spots(),this.draw())}getIndexVertex(t){for(let e=0;e<this.vertexes.length;e++)if(this.vertexes[e].id===t)return e;return!1}getSubMatrix(){let n=copy.object(this.matrix),s=[],e=500;for(;0<e--;){let e={},i={};for(let t=0;t<n.length;t++){for(let e=t;e<n[t].length;e++)if(null!==n[t][e]){i[t]=1;break}if(0<Object.keys(i).length)break}if(0===Object.keys(i).length)break;let t=500;for(;0<Object.keys(i).length&&0<t--;)for(var o in i)if(i.hasOwnProperty(o)){for(let e=0;e<n[o].length;e++)null!==n[o][e]&&(i[e]=1);e[o]=1,delete i[o]}for(var l in e)if(e.hasOwnProperty(l))for(let e=0;e<n[l].length;e++)null!==n[l][e]&&(n[l][e]=null,n[e][l]=null);s.push(Object.keys(e))}return s}rebuildGraph(){let n=[];for(let i=0;i<this.matrix.length;i++){let t=0;for(let e=0;e<this.matrix[i].length;e++)null!==this.matrix[i][e]&&t++;0===t&&n.push(i)}n.reverse();for(let t=0;t<n.length;t++){this.matrix.splice(n[t],1);for(let e=0;e<this.matrix.length;e++)this.matrix[e].splice(n[t],1);let e=this.getItem(this.vertexes[n[t]].id);e&&(this.unsetFromItem(e,this.vertexes[n[t]].id),e.paint(),"node"===this.items[this.vertexes[n[t]].id]&&e.delete({no_delete_lines:!0})),this.vertexes.splice(n[t],1)}}}class Cable extends TreeLines{constructor(e={}){super(e),this.color_custom=e.color_custom||"",this.switches=e.switches||[],this.strips_connections=e.strips_connections||{},is_empty(this.strips_connections)&&e.led_strips_connections&&(this.strips_connections=e.led_strips_connections),this.type_switch=e.type_switch||"",this.type=e.type||"light",this.plan="light_connections",this.name_human="Освещение",this.v=e.v||1,this.defineColor();let t=this;this.IMAGE=layers.cables.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}serialize(){return{id:this.id,connections:this.connections,items:this.items,switches:this.switches,strips_connections:this.strips_connections,type_switch:this.type_switch,type:this.type,color_custom:this.color_custom,length:this.length}}getPoint(e,t,i){return cabling.get_point_light(e,t,i,this.id)}getTypeItem(e){return cabling.is_switch(e)?"switch":cabling.is_led_strip(e)?"led_strip":cabling.is_line_strip(e)?"line_strip":cabling.is_strip_light(e)?"strip_light":"lamp"}mouseover(e){!super.mouseover(e)||(e=e.target.getAttribute("cable_line_id"))&&("none"===tool&&this.paint("orange",e),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){super.mouseleave(e)&&(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("cable_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.cable=this.id,cables.paint(),this.contextmenu(event),this.paint("orange",t)),"eraser"===tool&&1===e.which&&(id.cable=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan)if(this.show(),t=t||this.color,i){let e=$('[is_cable_line][cable_id="'+this.id+'"][cable_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_cable_line][cable_id="'+this.id+'"]');e.attr({stroke:t})}}defineColor(){try{this.color_custom?this.color=this.color_custom:0<this.switches.length?this.color="#000000":this.color="gray"}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}getPosition(e,t){let i="",n="";return this.strips_connections[e+"-"+t]?(i=this.strips_connections[e+"-"+t][0],n=this.strips_connections[e+"-"+t][1]):this.strips_connections[t+"-"+e]&&(i=this.strips_connections[t+"-"+e][1],n=this.strips_connections[t+"-"+e][0]),{s:i,e:n}}drawOneElement(e,t,i,n){var s=this.getPosition(i,n);let o=this.getPoint(e,i,s.s),l=this.getPoint(t,n,s.e);e=get_distance(o,l);let r=.9*e,a=4*e;100<e&&(r=1.2*e,a=2*e);t=["M",o.x,o.y,"A",r,r,0,0,1,l.x,l.y,"L",l.x,l.y,"A",a,a,0,0,0,o.x,o.y,"Z"].join(" "),s=i+"_"+n;let h=1.5*e;i=["M",o.x,o.y,"A",h,h,0,0,1,l.x,l.y].join(" ");this.IMAGE.add(svg.path(t).attr({cable_line_id:s,"stroke-width":0,fill:"transparent"})),this.IMAGE.add(svg.path(i).attr({cable_id:this.id,cable_line_id:s,stroke:this.color,"stroke-width":1,"stroke-dasharray":"8,4",fill:"none",is_cable_line:1}))}unsetFromItem(e,t){cabling.is_switch(e)?this.removeCableFromSwitch(t):cabling.unset_cable_id(e)}setToItem(t,i){if(cabling.is_switch(t))if("socket_group"===cabling.get_name_item(t)){let e=socketsGroup.getSocketById(i,t);e&&(e.cables||(e.cables=[]),-1===e.cables.indexOf(this.id)&&e.cables.push(this.id))}else t.props.cables&&-1===t.props.cables.indexOf(this.id)&&t.props.cables.push(this.id);else t.props.cable_id=this.id}updateData(){this.switches=[],this.items={},this.type_switch="",this.color="gray";var e,t,i=this.getFirstItem();for(e in i&&this.updateDataRecursive(i,this.connections[i]),this.strips_connections)this.strips_connections.hasOwnProperty(e)&&(t=e.split("-"),void 0!==this.items[t[0]]&&void 0!==this.items[t[1]]||delete this.strips_connections[e]);this.defineColor()}updateDataRecursive(e,t){let i=this.getItem(e);for(var n in i&&(this.items[e]=this.getTypeItem(i),this.setToItem(i,e),cabling.is_switch(i)&&(this.isExistSwitch(e)||this.switches.push(e),this.type_switch=cabling.is_through_switch(i)?"through":""),plan===this.plan&&i.paint()),t)t.hasOwnProperty(n)&&this.updateDataRecursive(n,t[n])}addNew(t){try{if(this.isNotEmptyTree(t)){let e=new Cable;e.color_custom=this.color_custom,plan!==this.plan&&e.hide(),e.connections=t,e.strips_connections=copy.object(this.strips_connections),cables.db.push(e),e.updateData(),e.draw()}else this.unsetFromItems(Object.keys(t))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}getLengthRecursive(e,t){let i=0;if(0===Object.keys(t).length)return i;var n,s=this.getItem(e);for(n in t)if(t.hasOwnProperty(n)){var o=this.getItem(n);if(!s||!o)return;var l=this.getPosition(e,n);i=(i+=get_distance(this.getPoint(s,e,l.s),this.getPoint(o,n,l.e)))+this.getLengthRecursive(n,t[n])}return i}contextmenu(e){super.contextmenu(e),showContextmenu("#cable_contextmenu",e.clientX,e.clientY,canvas.position().top),open_color_wrapper("#cable_contextmenu",this.color),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("cable_line_id"))}hasLamp(e){return this.items[e]&&in_array(this.items[e],["lamp","led_strip","line_strip","strip_light"])}hasSwitch(e){return this.items[e]&&"switch"===this.items[e]}addLamp(e,t,i,n){this.items[e]=this.getTypeItem(this.getItem(e)),this.items[t]=this.getTypeItem(this.getItem(t)),i&&n?this.strips_connections[e+"-"+t]=[i,n]:(i&&(this.strips_connections[e+"-"+t]=[i,""]),n&&(this.strips_connections[e+"-"+t]=["",n])),this.addItem(e,t)}addSwitch(e,t,i){this.isExistSwitch(e)||this.switches.push(e),this.items[e]="switch",this.items[t]=this.getTypeItem(this.getItem(t)),i&&(this.strips_connections[e+"-"+t]=["",i]),this.addItem(e,t)}getCountSwitches(){return this.switches.length}isExistSwitch(t){for(let e=0;e<this.switches.length;e++)if(this.switches[e]===t)return!0;return!1}removeCableFromSwitch(t){let i=this.getItem(t);if(i){if("socket_group"===cabling.get_name_item(i)){if(i.props.socket_group)for(let e=0;e<i.props.socket_group.length;e++){var n;i.props.socket_group[e].cables&&(-1!==(n=i.props.socket_group[e].cables.indexOf(this.id))&&(i.props.socket_group[e].cables.splice(n,1),i.paint()))}}else{var e=i.props.cables.indexOf(this.id);-1!==e&&(i.props.cables.splice(e,1),i.paint())}this.switches=this.switches.filter(function(e){return t!==e})}else console.warn("Cable. No switcher "+t)}union(e,t,i,n,s){if(e.switches)for(var o of e.switches)e.removeCableFromSwitch(o);for(var l in n&&s?this.strips_connections[t+"-"+i]=[n,s]:(n&&(this.strips_connections[t+"-"+i]=[n,""]),s&&(this.strips_connections[t+"-"+i]=["",s])),e.strips_connections)e.strips_connections.hasOwnProperty(l)&&(this.strips_connections[l]=e.strips_connections[l]);this.color_custom=this.color_custom||e.color_custom,super.union(e,t,i)}deleteFromStorage(t){for(let e=0;e<cables.db.length;e++)if(cables.db[e].id===t){cables.db.splice(e,1);break}}setColor(e){this.color_custom=e,this.defineColor(),this.paint()}}class Cabling extends TreeLining{constructor(){super(),this.tools=["cable"],this.name_object_lines="cables",this.plan="light_connections",this.switches={socket_group:1},this.switches_list={light_switch:1,light_switch_double:2,light_switch_triple:3,light_switch_through:1,light_switch_through_double:2,light_switch_cross:1,light_switch_cross_double:2,light_dimmer:1e3},this.lamps={chandelier:1,ceiling_chandelier_shades:1,ceiling_chandelier_led:1,hanging_chandelier_shades:1,hanging_chandelier_led:1,cascading_chandelier:1,crystal_chandelier:1,hanging_light:1,track_single:1,track_double:1,track_triple:1,wall_spot:1,bra:1,bra_shades:1,led_lamp:1,light_stick:1,painting_lighting:1,wall_lamp:1,lightspot:1,lightspot_surface:1,fan:1,led_strip:1,line_light:1,recessed_strip:1,surface_stripe:1,pendent_strip:1},this.target_for_lamps=Object.assign(copy.object(this.lamps),this.switches),this.target_for_switches=copy.object(this.lamps),this.target_for_light_dimmer=copy.object(this.target_for_switches),delete this.target_for_light_dimmer.fan,this.target_for_fan=copy.object(this.target_for_lamps),delete this.target_for_fan.light_dimmer,this.source_items={socket_group:this.target_for_switches,chandelier:this.target_for_lamps,ceiling_chandelier_shades:this.target_for_lamps,ceiling_chandelier_led:this.target_for_lamps,hanging_chandelier_shades:this.target_for_lamps,hanging_chandelier_led:this.target_for_lamps,cascading_chandelier:this.target_for_lamps,crystal_chandelier:this.target_for_lamps,hanging_light:this.target_for_lamps,track_single:this.target_for_lamps,track_double:this.target_for_lamps,track_triple:this.target_for_lamps,wall_spot:this.target_for_lamps,bra:this.target_for_lamps,bra_shades:this.target_for_lamps,led_lamp:this.target_for_lamps,light_stick:this.target_for_lamps,painting_lighting:this.target_for_lamps,wall_lamp:this.target_for_lamps,lightspot:this.target_for_lamps,lightspot_surface:this.target_for_lamps,fan:this.target_for_fan,led_strip:this.target_for_lamps,line_light:this.target_for_lamps,recessed_strip:this.target_for_lamps,surface_stripe:this.target_for_lamps,pendent_strip:this.target_for_lamps},this.through_switches={light_switch_through:1,light_switch_through_double:1},this.cross_switches={light_switch_cross:1,light_switch_cross_double:1}}unselect_source_item(){this.source_item=null,this.source_id=null,this.source_name=null,this.source_point=null,this.target_item=null,this.target_id=null,this.target_point=null,this.target_strip_node_id=null,this.source_strip_node_id=null}check_connection_items(e,t){return!(!this.source_items[e]||!this.source_items[e][t])}check_source_items(e){return!!this.source_items[e]}check_source_select(i,n,s=!1){if(this.is_switch(i)){let e=[],t=this.get_name_item(i);if("socket_group"===this.get_name_item(i)){n=socketsGroup.getSocketById(n,i);if(!n)return!1;if(t=n.name,!this.switches_list[t])return!1;n.cables&&(e=n.cables)}else i.props.cables&&(e=i.props.cables);if(e.length===this.get_max_count_keys_on_switch(t))return s&&warning.show("yellow",l10n.cabling_not_select,4e3),!1}return this.is_lamp(i),this.is_led_strip(i),!0}check_allow_connect(n,s,o,l,e,t,r=!1){if(this.is_switch(n)){let i=[];if("socket_group"===this.get_name_item(n)){var a=socketsGroup.getSocketById(this.source_id,n);if(!a)return!1;if(!this.switches_list[a.name])return!1;a.cables&&(i=a.cables)}else n.props.cables&&(i=n.props.cables);for(let t=0;t<i.length;t++){let e=this.get_tree_from_storage(i[t]);if(e.hasLamp(l))return r&&warning.show("yellow",l10n.cabling_already_connect_switch,3e3),!1}if("socket_group"===this.get_name_item(n)&&0===i.length&&this.is_lamp(s)&&s.props.cable_id){let e=this.get_tree_from_storage(s.props.cable_id);if(e.isExistSwitch(o))return r&&warning.show("yellow",l10n.cabling_already_connect_group,3e3),!1}}if(this.is_lamp(n)||this.is_strip(n))if(this.is_lamp(s)||this.is_strip(s)){if(o===l)return r&&warning.show("yellow",l10n.cabling_this_same,3e3),!1;let t=this.get_tree_from_storage(n.props.cable_id);if(n.props.cable_id&&s.props.cable_id){let e=this.get_tree_from_storage(s.props.cable_id);if(0<t.getCountSwitches()&&0<e.getCountSwitches()&&(t.hasLamp(l)||t.id===e.id||arrays_has_equals_elements(t.switches,e.switches)))return r&&warning.show("yellow",l10n.cabling_already_connect,3e3),!1;if(t.id===e.id)return!1}}else{let e=this.get_tree_from_storage(n.props.cable_id);if(e&&e.isExistSwitch(l))return r&&warning.show("yellow",l10n.cabling_not_select_2,4e3),!1;let t=[],i=this.get_name_item(s);if("socket_group"===this.get_name_item(s)){a=socketsGroup.getSocketById(l,s);if(!a)return!1;if(i=a.name,!this.switches_list[i])return!1;a.cables&&(t=a.cables)}else s.props.cables&&(t=s.props.cables);if(t.length===this.get_max_count_keys_on_switch(i))return r&&warning.show("yellow",l10n.cabling_not_select,4e3),!1}return!0}is_switch(e){return!!this.switches[e.props.name]}is_lamp(e){return!!this.lamps[e.props.name]}is_strip(e){return this.is_led_strip(e)||this.is_line_strip(e)||this.is_strip_light(e)}is_led_strip(e){return"led_strip"===e.props.name}is_line_strip(e){return"line_light"===e.props.name}is_strip_light(e){return in_array(e.props.name,striping_light.tools)}is_through_switch(e){return!!this.through_switches[e.props.name]}get_max_count_keys_on_switch(e){return this.switches_list[e]}select(e,t,i){this.is_strip(e)?(manager_lining.change_size_node(i,"up"),i.image.attr({stroke:"#ff8a0d"})):"socket_group"===this.get_name_item(e)?socketsGroup.isSocketId(t)&&socketsGroup.setAttr(e.image,this.get_name_item(e),{stroke:"#ff8a0d"},t):e.image.attr({stroke:"#ff8a0d"})}unselect(e,t){var i;this.is_strip(e)?(manager_lining.change_size_node(t,"down"),i=manager_lining.item_get_stroke(t,t.model.stroke_color),t.image.attr({stroke:i})):(t=cabling.get_color_of_item(e),e.image.attr({stroke:t,"stroke-width":e.model.stroke_width}),socketsGroup.setDefaultColor(e.image,this.get_name_item(e),e))}mouseover(e,t,i,n){try{this.source_id?this.check_connection_items(this.source_name,e.props.name)&&this.check_allow_connect(this.source_item,e,this.source_id,t,this.source_strip_node_id,i)&&($("body").css("cursor","pointer"),this.select(e,t,n)):this.check_source_items(e.props.name)&&this.check_source_select(e,t)&&($("body").css("cursor","pointer"),this.select(e,t,n))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mouseleave(e,t){cabling.source_id?$("body").css("cursor","crosshair"):$("body").css("cursor","pointer"),e.selected&&!this.is_strip(e)||this.unselect(e,t)}get_point(e,t,i,n){var s=this.get_name_item(t);let o;return o=(o="socket_group"===s&&(s=socketsGroup.getSocketById(i,t))?s.center_moving||s.center:o)||t.props.center}mousedown(e,o,l){try{if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,e.props.name)){let i=this.source_item,n=e;if(!o)return void send_warning_signals(signal_types[10],"item_id = null в tree.mousedown: ",this.get_id_item(n),1,0);if(!this.check_allow_connect(i,n,this.source_id,o,this.source_strip_node_id,l,!0))return;let s;if(this.is_switch(i)&&n.props.cable_id)(s=this.get_tree_from_storage(n.props.cable_id)).type_switch=this.is_through_switch(i)?"through":"",s.addSwitch(this.source_id,o,l),s.defineColor();else if((this.is_lamp(i)||this.is_strip(i))&&i.props.cable_id)if(s=this.get_tree_from_storage(i.props.cable_id),i.props.cable_id&&n.props.cable_id&&(this.is_lamp(i)||this.is_strip(i))&&(this.is_lamp(n)||this.is_strip(n))){let e=this.get_tree_from_storage(i.props.cable_id),t=this.get_tree_from_storage(n.props.cable_id);s=e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o,this.source_strip_node_id,l),e):(t.union(e,o,this.source_id,l,this.source_strip_node_id),t)}else this.is_lamp(n)||this.is_strip(n)?s.addLamp(this.source_id,o,this.source_strip_node_id,l):this.is_switch(n)&&(s.type_switch=this.is_through_switch(n)?"through":"",s.addSwitch(o,this.source_id,this.source_strip_node_id),s.defineColor());else(this.is_lamp(i)||this.is_strip(i))&&!i.props.cable_id&&n.props.cable_id?(s=this.get_tree_from_storage(n.props.cable_id)).addLamp(this.source_id,o,this.source_strip_node_id,l):(s=new Cable({type_switch:this.is_through_switch(i)?"through":""}),this.is_switch(i)?s.addSwitch(this.source_id,o,l):this.is_switch(n)?(s.addSwitch(o,this.source_id,this.source_strip_node_id),s.type_switch=this.is_through_switch(n)?"through":""):s.addLamp(this.source_id,o,this.source_strip_node_id,l),s.defineColor(),cables.db.push(s));this.is_switch(i)&&s.setToItem(i,this.source_id),this.is_switch(n)&&s.setToItem(n,o),!this.is_lamp(i)&&!this.is_strip(i)||i.props.cable_id||(i.props.cable_id=s.id),!this.is_lamp(n)&&!this.is_strip(n)||n.props.cable_id||(n.props.cable_id=s.id),s.draw(),i.selected=!1,this.temporary_line.hide(),i.paint(),n.paint(),(this.is_led_strip(i)||this.is_led_strip(n))&&window.led_strips.paint(),(this.is_line_strip(i)||this.is_line_strip(n))&&window.line_strips.paint(),(this.is_strip_light(i)||this.is_strip_light(n))&&window.stripes_light.paint(),project.localSave()}else this.source_id&&cabling.is_switch(this.source_item)&&cabling.is_switch(e)&&warning.show("red",l10n.cabling_not_connect_switch,6e3);else if(this.check_source_items(e.props.name)){if(!this.check_source_select(e,o,!0))return;var t;if(e.selected=!0,this.source_item=e,this.source_id=o,this.is_strip(e)?(t=striping_led.get_item(l),this.source_point=striping_led.get_point("",t),this.unselect(e,t)):this.source_point=this.get_point("",e,this.source_id),this.source_name=this.get_name_item(e),this.source_strip_node_id=l,this.color_line="gray",this.source_item)if(this.is_switch(this.source_item))this.color_line="black";else if(this.source_item.props.cable_id){let e=this.get_tree_from_storage(this.source_item.props.cable_id);e&&0<e.getCountSwitches()&&(this.color_line=e.color_custom||"black")}e.paint(),$("body").css("cursor","crosshair")}else warning.show("yellow",l10n.wire_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(){try{if(this.target_item=null,this.target_id=null,this.target_strip_node_id=null,$("body").css("cursor","crosshair"),!this.source_id)return;let s=!1;var o=this.get_item(this.source_id);for(let e=0;e<items.db.length;e++){var i=items.db[e];if(this.check_connection_items(this.source_name,i.props.name)){this.unselect(i);let e=!1,t=this.get_id_item(i);if("socket_group"===this.get_name_item(i)?(t=socketsGroup.getIdSocketByPoint(mouse.end,i))&&(e=!0):get_distance(mouse.end,i.props.center)<15&&(e=!0),e){if(!this.check_allow_connect(o,i,this.source_id,t))break;this.target_item=i,this.target_id=t,mouse.end=this.get_point("",i,this.target_id),this.select(i,this.target_id),$("body").css("cursor","pointer"),s=!0;break}}}if(!s){let i=15,n;for(let t=0;t<led_strips.db.length;t++){let e=led_strips.db[t];if(this.check_connection_items(this.source_name,e.props.name))for(var l in e.items)if(e.items.hasOwnProperty(l)&&"node"===e.items[l]){var r=striping_led.get_item(l),a=(this.unselect(e,r),striping_led.get_point("",r)),h=get_distance(mouse.end,a);if(h<i){if(!this.check_allow_connect(o,e,this.source_id,this.get_id_item(e),this.source_strip_node_id,l))break;n={target_item:e,target_id:this.get_id_item(e),target_strip_node_id:l,point:a,item_node:r},i=h}}}n&&(this.target_item=n.target_item,this.target_id=n.target_id,this.target_strip_node_id=n.target_strip_node_id,mouse.end=n.point,this.select(this.target_item,this.target_id,n.item_node),$("body").css("cursor","pointer"),s=!0)}if(!s){let i=15,n;for(let t=0;t<line_strips.db.length;t++){let e=line_strips.db[t];if(this.check_connection_items(this.source_name,e.props.name))for(var g in e.items)if(e.items.hasOwnProperty(g)&&"node"===e.items[g]){var _=striping_line.get_item(g),d=(this.unselect(e,_),striping_line.get_point("",_)),p=get_distance(mouse.end,d);if(p<i){if(!this.check_allow_connect(o,e,this.source_id,this.get_id_item(e),this.source_strip_node_id,g))break;n={target_item:e,target_id:this.get_id_item(e),target_strip_node_id:g,point:d,item_node:_},i=p}}}n&&(this.target_item=n.target_item,this.target_id=n.target_id,this.target_strip_node_id=n.target_strip_node_id,mouse.end=n.point,this.select(this.target_item,this.target_id,n.item_node),$("body").css("cursor","pointer"),s=!0)}if(!s){let i=15,n;for(let t=0;t<stripes_light.db.length;t++){let e=stripes_light.db[t];if(this.check_connection_items(this.source_name,e.props.name))for(var c in e.items)if(e.items.hasOwnProperty(c)&&"node"===e.items[c]){var A=striping_light.get_item(c),u=(this.unselect(e,A),striping_light.get_point("",A)),w=get_distance(mouse.end,u);if(w<i){if(!this.check_allow_connect(o,e,this.source_id,this.get_id_item(e),this.source_strip_node_id,c))break;n={target_item:e,target_id:this.get_id_item(e),target_strip_node_id:c,point:u,item_node:A},i=w}}}n&&(this.target_item=n.target_item,this.target_id=n.target_id,this.target_strip_node_id=n.target_strip_node_id,mouse.end=n.point,this.select(this.target_item,this.target_id,n.item_node),$("body").css("cursor","pointer"),s=!0)}this.temporary_line.draw(this.source_point,mouse.end,this.color_line)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}unset_cable_id(e){e.props.cable_id=null}get_color_of_item(e,t){return e&&e.props&&(e.props.cable_id||e.props.cables&&(e.props.cables.length===this.get_max_count_keys_on_switch(this.get_name_item(e))||"light_dimmer"===this.get_name_item(e)&&0<e.props.cables.length))?"#148515":"#dc143c"}draw_lines(n){if(n.props){if(n.props.cable_id){let e=this.get_tree_from_storage(n.props.cable_id);e&&e.draw()}if("socket_group"===this.get_name_item(n)&&n.props.socket_group){for(let i=0;i<n.props.socket_group.length;i++)if(n.props.socket_group[i].cables)for(let t=0;t<n.props.socket_group[i].cables.length;t++){let e=this.get_tree_from_storage(n.props.socket_group[i].cables[t]);e&&e.draw()}}else if(n.props.cables)for(let t=0;t<n.props.cables.length;t++){let e=this.get_tree_from_storage(n.props.cables[t]);e&&e.draw()}}}delete_lines(n,s=!1){if(n.props){if(n.props.cable_id){let e=this.get_tree_from_storage(n.props.cable_id);e&&e.deleteByItem(this.get_id_item(n),s)}if("socket_group"===this.get_name_item(n)&&n.props.socket_group){for(let i=0;i<n.props.socket_group.length;i++)if(n.props.socket_group[i].cables){var o=Object.values(n.props.socket_group[i].cables);for(let t=0;t<o.length;t++){let e=this.get_tree_from_storage(o[t]);e&&e.deleteByItem(socketsGroup.generateIdSocket(n,n.props.socket_group[i].id),s)}}}else if(n.props.cables){var i=Object.values(n.props.cables);for(let t=0;t<i.length;t++){let e=this.get_tree_from_storage(i[t]);e&&e.deleteByItem(this.get_id_item(n),s)}}}}get_tree_from_storage(e){return get_cable(e)}get_trees_from_storage(){return cables.db}is_cabling_plan(e){if("light_connections"===plan){if(in_array(e.props.name,striping_light.track_spots))return!1;if(e.model.plan.hasOwnProperty("light")||"fan"===e.props.name)return!0}return!1}get_item(e){let t=super.get_item(e);return t||((t=get_led_strip(e))||(t=get_line_strip(e))||(t=get_stripe_light(e))?t:null)}get_point_light(e,t,i,n){let s;var o;return s=this.is_strip(e)?(o=this.get_item(i),this.get_point("",o,i,n)):this.get_point("",e,t,n)}draw_box(){if(!super.draw_box())return!1;try{var e,t=$(".options_cables_socket.active").data("type");$("#box_cables_socket").empty();let s="",o=0,l=1;for(let n=0;n<cables.db.length;n++){let e=cables.db[n],t=0,i=0;for(var r in e.items)e.items.hasOwnProperty(r)&&(in_array(e.items[r],["lamp","led_strip","line_strip","strip_light"])&&i++,"switch"===e.items[r]&&t++);s+='<div class="options_cables_socket_item" data-id="'+e.id+'">'+l+++". Выкл. - "+t+". Лампы - "+i+"<span>"+e.length+"</span></div>",o+=e.length}s&&(e=t?"active":"",$("#box_cables_socket").append('<div class="box_cables_socket_label">Провода<span>'+o.toFixed(2)+' м</span></div><div class="options_cables_socket '+e+'" data-type="light">'+s+"</div></div>")),$("#box_cables_socket_wrapper").show()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!0}}var cabling=new Cabling;class Pipe extends TreeLines{constructor(e={}){super(e),this.type=e.type||"water_pipe";e={water:"water_pipe",drainage:"drainage_pipe"};e[this.type]&&(this.type=e[this.type]),this.plan="water",this.name_human="Водоснабжение",this.defineColor();let t=this;this.IMAGE=layers.pipes.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}serialize(){return{id:this.id,connections:this.connections,items:this.items,type:this.type,points_connections:this.points_connections,length:this.length}}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||this.isExistMovingItems()||!0===this.getLining().moving_point_line||(e=e.target.getAttribute("pipe_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("pipe_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.pipe=this.id,pipes.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.pipe=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}isExistMovingItems(){for(let e=0;e<items.db.length;e++){var t=items.db[e];if(this.getLining().all_items[t.props.name]&&t.click_zone.moving)return!0}return!1}paint(t,i){if(this.hide(),plan===this.plan)if(this.show(),t||(t=this.color,this.changeSizeNodes("down")),i){let e=$('[is_pipe_line][pipe_id="'+this.id+'"][pipe_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_pipe_line][pipe_id="'+this.id+'"]');e.attr({stroke:t})}}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":this.getLining().is_multi(e)?"multi":"waterspot"}drawOneElement(e,t,i,n){var s=this.getPosition(i,n),o=s.s||this.getPoint(e,i),s=s.e||this.getPoint(t,n),l=i+"_"+n;t.start_item_tree=i;let r=this.IMAGE.line().attr({pipe_line_id:l,stroke:"transparent","stroke-width":8}),a=(r.plot(o.x,o.y,s.x,s.y),this.IMAGE.line().attr({pipe_id:this.id,pipe_line_id:l,stroke:this.color,"stroke-width":this.getLining().get_stroke(this.type),is_pipe_line:1}));a.plot(o.x,o.y,s.x,s.y),this.getLining().items_any_connections[this.getNameItem(e)]&&this.points_line.push(new ConnectPointLine({type:this.type,plan:this.plan,color:this.color,point:o,line_id:l,tree_id:this.id,item_id:i,line_point_number:1,line:a})),this.getLining().items_any_connections[this.getNameItem(t)]&&this.points_line.push(new ConnectPointLine({type:this.type,plan:this.plan,color:this.color,point:s,line_id:l,tree_id:this.id,item_id:n,line_point_number:2,line:a})),this.lines.push({line:get_line(o,s),id:this.id,line_id:l})}addNew(t){try{if(this.isNotEmptyTree(t)){let e=new Pipe({type:this.type});e.connections=t,e.points_connections=copy.object(this.points_connections),pipes.db.push(e),e.updateData(),e.draw()}else this.unsetFromItems(Object.keys(t))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#pipe_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("pipe_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<pipes.db.length;e++)if(pipes.db[e].id===t){pipes.db.splice(e,1);break}}}class Piping extends TreeLining{constructor(){super(),this.water_items=["waterspot_cold","waterspot_hot","waterspot_cold_hot"],this.drainage_items=["waterspot_drainage","waterspot_drainage_cold","waterspot_drainage_hot","waterspot_drainage_cold_hot"],this.water_drainage_items=["waterspot_cold","waterspot_hot","waterspot_cold_hot","waterspot_drainage","waterspot_drainage_cold","waterspot_drainage_hot","waterspot_drainage_cold_hot"],this.all_items={waterspot_cold:1,waterspot_hot:1,waterspot_cold_hot:1,waterspot_drainage:1,waterspot_drainage_cold:1,waterspot_drainage_hot:1,waterspot_drainage_cold_hot:1,waterspot_collector:1,waterspot_node:1,pillar_water:1},this.tools=["water_pipe","water_hot_pipe","drainage_pipe"],this.name_object_lines="pipes",this.plan="water",this.name_node="waterspot_node",this.waterspots={water_pipe:{waterspot_cold:1,waterspot_cold_hot:1,waterspot_drainage_cold:1,waterspot_drainage_cold_hot:1,waterspot_collector:1,waterspot_node:1,pillar_water:1},water_hot_pipe:{waterspot_hot:1,waterspot_cold_hot:1,waterspot_drainage_hot:1,waterspot_drainage_cold_hot:1,waterspot_collector:1,waterspot_node:1,pillar_water:1},drainage_pipe:{waterspot_drainage:1,waterspot_drainage_cold:1,waterspot_drainage_hot:1,waterspot_drainage_cold_hot:1,waterspot_node:1,pillar_water:1}},this.source_items={water_pipe:{waterspot_cold:this.waterspots.water_pipe,waterspot_cold_hot:this.waterspots.water_pipe,waterspot_drainage_cold:this.waterspots.water_pipe,waterspot_drainage_cold_hot:this.waterspots.water_pipe,waterspot_collector:this.waterspots.water_pipe,waterspot_node:this.waterspots.water_pipe,pillar_water:this.waterspots.water_pipe},water_hot_pipe:{waterspot_hot:this.waterspots.water_hot_pipe,waterspot_cold_hot:this.waterspots.water_hot_pipe,waterspot_drainage_hot:this.waterspots.water_hot_pipe,waterspot_drainage_cold_hot:this.waterspots.water_hot_pipe,waterspot_collector:this.waterspots.water_hot_pipe,waterspot_node:this.waterspots.water_hot_pipe,pillar_water:this.waterspots.water_hot_pipe},drainage_pipe:{waterspot_drainage:this.waterspots.drainage_pipe,waterspot_drainage_cold:this.waterspots.drainage_pipe,waterspot_drainage_hot:this.waterspots.drainage_pipe,waterspot_drainage_cold_hot:this.waterspots.drainage_pipe,waterspot_node:this.waterspots.drainage_pipe,pillar_water:this.waterspots.drainage_pipe}},this.offset_point_water_pipe_w=3,this.offset_point_water_pipe_d=0,this.offset_point_drainage_pipe=3.5,this.names_line_id_by_tool={water_pipe:"water_pipe_id",water_hot_pipe:"water_hot_pipe_id",drainage_pipe:"drainage_pipe_id"},this.multi_spots={waterspot_collector:1},this.items_any_connections={waterspot_collector:1},this.tools_names={water_pipe:"ХВС",water_hot_pipe:"ГВС",drainage_pipe:"Канализация"}}unselect_source_item(){super.unselect_source_item(),this.source_connect=null,this.target_connect=null}get_stroke(e){return"water_pipe"!==e&&"drainage_pipe"===e?2.5:1.5}check_source_select(e,t,i=!1){if(this.is_node(e)){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.piping_not_select_node,4e3),!1}return!0}check_allow_connect(i,n,e=null,s=null,o=!1){var l=this.get_type(),t=(this.get_name_item(i),this.get_name_item(n));if((e=e||this.get_id_item(i))===(s=s||this.get_id_item(n)))return!1;if(i&&n){if(i.props[this.name_object_lines]&&n.props[this.name_object_lines])for(var r in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(r)&&l===r&&i.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&n.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&i.props[this.name_object_lines][this.names_line_id_by_tool[r]]===n.props[this.name_object_lines][this.names_line_id_by_tool[r]])return o&&warning.show("yellow",l10n.piping_already_connect_pipe,3e3),!1;let e=this.get_tree(i,!1,l),t=this.get_tree(n,!1,l);if(e&&t&&arrays_has_equals_elements(e.getMultiItemIds(),t.getMultiItemIds()))return o&&warning.show("yellow",l10n.piping_has_same_collector,3e3),!1}if(t===this.name_node){e=this.get_tree(n,!0);if(!e)return!1;if(e.type!==l)return o&&warning.show("yellow",l10n.piping_not_select_node,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){let t=this.get_tree_from_storage(this.source_tree_line.id);if(t){if(void 0!==t.items[s])return o&&warning.show("yellow",l10n.piping_already_connect_pipe+" (003)",4e3),!1;let e=this.get_tree(n,!1,l);if(e&&arrays_has_equals_elements(t.getMultiItemIds(),e.getMultiItemIds()))return o&&warning.show("yellow",l10n.piping_has_same_collector,3e3),!1}}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if((void 0!==this.waterspots.water_pipe[l]||void 0!==this.waterspots.drainage_pipe[l])&&(l!==this.name_node||this.is_node(items.db[e]))){var r=get_distance(s.center,items.db[e].props.center);if(void 0===s.index_graph&&(r<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e]))){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.piping_not_join_pipe,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}}let n;if(this.is_exist_tree(t)&&!this.is_multi(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s,this.source_connect),void 0!==s.index_graph&&(i.index_graph=s.index_graph)):(n=new Pipe({type:this.get_type()}),i=n.addNode(t,this.source_id,s,this.source_connect),void 0!==s.index_graph&&(i.index_graph=s.index_graph),n.defineColor(),pipes.db.push(n)),this.is_exist_tree(t)&&!this.is_multi(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,this.source_id,o,!0))return!1;let s;if(!this.is_exist_tree(i)||this.is_multi(i)||this.is_exist_tree(n)&&!this.is_multi(n))if(this.is_exist_tree(i)&&!this.is_multi(i)||!this.is_exist_tree(n)||this.is_multi(n))if(this.is_exist_tree(i)&&this.is_exist_tree(n)&&!this.is_multi(i)&&!this.is_multi(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o),e):(t.union(e,o,this.source_id),t)}else(s=new Pipe({type:this.get_type()})).addSpot(i,n,this.source_id,o,this.source_connect,this.target_connect),s.defineColor(),pipes.db.push(s);else(s=this.get_tree(n)).addSpot(n,i,o,this.source_id,this.target_connect,this.source_connect),s.defineColor();else(s=this.get_tree(i)).addSpot(i,n,this.source_id,o,this.source_connect,this.target_connect),s.defineColor();if(this.is_exist_tree(i)&&!this.is_multi(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)&&!this.is_multi(n)||this.set_tree_id(n,this.get_id_item(n),s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=this.get_point_in_mousedown(e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),$("body").css("cursor","crosshair"),this.draw_reference_lines(e)}else warning.show("yellow",l10n.piping_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_connect=null,this.target_tree_line=null,$("body").css("cursor","crosshair"),!this.source_id)return;let s=!1;var i,n,o,l=this.get_item(this.source_id),r=this.get_type();for(let e=0;e<items.db.length;e++){var a=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(a))&&(this.get_name_item(a)!==this.name_node||this.is_node(items.db[e]))){this.unselect(a);let t=!1,i,n=null;if(this.items_any_connections[this.get_name_item(a)]){var h=this.get_polygon(a);for(let e=0;e<h.length;e++){var g=e<h.length-1?get_line(h[e],h[e+1]):get_line(h[e],h[0]),_=LIB.projection(mouse.end,g);if(get_distance(mouse.end,_)<8){t=!0,i=_,n={i:e,d:+(get_distance(h[e],_)/get_distance(g.s,g.e)).toFixed(4)};break}}if(!t&&this.is_point_inside_item(mouse.end,a)){var d=get_line(mouse.end,this.source_point);for(let e=0;e<h.length;e++){var p=e<h.length-1?get_line(h[e],h[e+1]):get_line(h[e],h[0]),c=line_and_line_intersection(d,p);if(c){t=!0,i=c,n={i:e,d:+(get_distance(h[e],c)/get_distance(p.s,p.e)).toFixed(4)};break}}}}else(get_distance(mouse.end,a.props.center)<(this.get_name_item(a)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,a))&&(i=this.get_point(r,a,this.get_id_item(a)),t=!0);if(t){if(!this.check_allow_connect(l,a))break;this.target_item=a,this.target_id=this.get_id_item(a),mouse.end=i,this.target_connect=n,this.select(a,this.target_id),$("body").css("cursor","pointer"),s=!0;break}}}if(!s)for(let e=0;e<pillars.db.length;e++){var t=pillars.db[e];if("pillar_water"===t.role)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.unselect(t),get_distance(mouse.end,t.center)<15){if(!this.check_allow_connect(l,t))break;this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),this.select(t,this.target_id),$("body").css("cursor","pointer"),s=!0;break}}if(!s){let i=this.source_tree_line?this.get_tree_from_storage(this.source_tree_line.id):null;for(let e=0;e<pipes.db.length;e++){let t=pipes.db[e];if(void 0===t.items[this.source_id]&&(r===t.type&&(!i||i.id!==t.id)&&(!i||!arrays_has_equals_elements(i.getMultiItemIds(),t.getMultiItemIds()))&&(i||!arrays_has_equals_elements(this.get_all_multi_ids(l,r),t.getMultiItemIds())))){t.paint();for(let e=0;e<t.lines.length;e++){var A=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,A)<8){this.target_tree_line=t.lines[e],mouse.end=A,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),s=!0;break}}if(s)break}}}if(!s&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var u in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(u)&&(i=manager_lining.reference_lines[u],(n=LIB.projection(mouse.end,i))&&(o=get_distance(mouse.end,n))<t&&(t=o,e=n));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(r)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke(r)),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let n=!1,s=this.source_item;var i,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(!this.items_any_connections[this.get_name_item(t)])if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)){if(!this.check_allow_connect(s,t))break;s.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),s.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),n=!0;break}}if(!n)for(let e=0;e<pillars.db.length;e++){var a=pillars.db[e];if("pillar_water"===a.role)if(this.check_connection_items(this.source_name,this.get_name_item(a)))if(this.unselect(a),get_distance(mouse.end,a.center)<15){if(!this.check_allow_connect(s,a))break;s.hide(),this.target_item=a,this.target_id=this.get_id_item(a),mouse.end=this.get_point(r,a,this.target_id),s.props.center=mouse.end,this.target_point=mouse.end,this.select(a,this.target_id),$("body").css("cursor","pointer"),n=!0;break}}if(!n){s.show();let i=this.get_tree(s,!0);for(let e=0;e<pipes.db.length;e++){let t=pipes.db[e];if(void 0===t.items[this.source_id]&&!(r!==t.type||i&&arrays_has_equals_elements(i.getMultiItemIds(),t.getMultiItemIds()))){t.paint();for(let e=0;e<t.lines.length;e++){var h=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,h)<5){this.target_tree_line=t.lines[e],mouse.end=h,s.props.center=mouse.end,this.target_point=mouse.end,s.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),n=!0;break}}if(n)break}}}if(!n&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var g in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(g)&&(i=manager_lining.reference_lines[g],(o=LIB.projection(mouse.end,i))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return n?!0:(s.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_point(t,i,e,n){let s;if(s=("pillar_water"===i.role?i:i.props).center,in_array(t,["water_pipe","water_hot_pipe"])&&i.props&&i.props.projection&&i.image.node&&i.image.node.children)for(let e=0;e<i.image.node.children.length;e++)if($(i.image.node.children[e]).attr("type")===t){var o=i.image.node.children[e].getBoundingClientRect();if(o&&void 0!==o.left){var l,r,a,h=get_svg_point({x:o.left,y:o.top}),g=get_svg_point({x:o.right,y:o.bottom});s=get_center(h,g),"water_pipe"===t&&(h=get_svg_point({x:o.left,y:o.top}),g=get_svg_point({x:o.right,y:o.top}),a=get_svg_point({x:o.left,y:o.bottom}),o=get_svg_point({x:o.right,y:o.bottom}),l=get_center(h,g),r=get_center(o,a),h=get_center(h,a),a=get_center(g,o),(g=get_room(i.props.id_room))&&(point_in_polygon(l,g.polygon)?point_in_polygon(r,g.polygon)?point_in_polygon(h,g.polygon)?point_in_polygon(a,g.polygon)||(s=LIB.pointOnLine(h,a,-2)):s=LIB.pointOnLine(a,h,-2):s=LIB.pointOnLine(l,r,-2):s=LIB.pointOnLine(r,l,-2)));break}}return s}get_color_by_type(e){let t="gray";switch(e){case"water_pipe":t="#0000ff";break;case"water_hot_pipe":t="#dc143c";break;case"drainage_pipe":t="#90ee90"}return t}get_item(e){let t=super.get_item(e);return t||((t=get_pillar(e))?t:null)}get_name_item(e){return e.props.name||e.role}get_id_item(e){return e.props.id||e.id}select(e,t){"pillar_water"===this.get_name_item(e)?e.paint("orange"):(e.image.attr({stroke:"#ff8a0d"}),CustomIcons.setAttr(e.image,this.get_name_item(e),{stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up"))}unselect(e){"pillar_water"===this.get_name_item(e)?e.paint():(e.image.attr({stroke:this.get_color_of_item(e,e.model.stroke_color)}),CustomIcons.setDefaultColor(e.image,this.get_name_item(e),e),this.is_node(e)&&this.change_size_node(e,"down"))}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.filling="#fafafa",n.width="drainage_pipe"!==e?1:2,n.height="drainage_pipe"!==e?1:2,n.width_changed="drainage_pipe"!==e?1:2,n.height_changed="drainage_pipe"!==e?1:2,n.stroke_width=1,n.group="waterspots",n.plan={water:1};e=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(e),e}get_tree_from_storage(e){return get_pipe(e)}get_trees_from_storage(){return pipes.db}get_polygon(e){let t=[];e.getPolygon();var i=e.polygon;return t="waterspot_collector"===this.get_name_item(e)?[i[0],i[1]]:[i[0],i[1],i[2],i[3]]}change_size_node(t,i){if(t){let e="";var n=this.get_tree(t,!0);n&&(e=n.type),"up"===i?t.image.attr({r:"drainage_pipe"!==e?2.5:3,"stroke-width":"drainage_pipe"!==e?1.5:2,fill:"#fafafa"}):t.image.attr({r:"drainage_pipe"!==e?.5:1,"stroke-width":1,fill:this.get_color_fill_of_item(t,t.props.filling)}),t.spot_node_size=i}}draw_box(){if(!super.draw_box())return!1;try{var e,o=$(".options_cables_socket.active").data("type");$("#box_cables_socket").empty();for(let s=0;s<this.tools.length;s++){let t="",i=0,n=1;for(let e=0;e<pipes.db.length;e++){var l=pipes.db[e];l.type===this.tools[s]&&(t+='<div class="options_cables_socket_item type_pipes" data-id="'+l.id+'">'+n+++"<span>"+l.length+"</span></div>",i+=l.length)}t&&(e=o===this.tools[s]?"active":"",$("#box_cables_socket").append('<div class="box_cables_socket_label">'+this.tools_names[this.tools[s]]+"<span>"+i.toFixed(2)+' м</span></div><div class="options_cables_socket '+e+'" data-type="'+this.tools[s]+'">'+t+"</div></div>"))}$("#box_cables_socket_wrapper").show()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}}var piping=new Piping;class GroupWaterSpots{constructor(){this.unselect_source_item(),this.source_items={waterspot_cold:{waterspot_hot:"waterspot_cold_hot",waterspot_drainage:"waterspot_drainage_cold",waterspot_drainage_hot:"waterspot_drainage_cold_hot"},waterspot_hot:{waterspot_cold:"waterspot_cold_hot",waterspot_drainage_cold:"waterspot_drainage_cold_hot",waterspot_drainage:"waterspot_drainage_hot"},waterspot_drainage:{waterspot_hot:"waterspot_drainage_hot",waterspot_cold:"waterspot_drainage_cold",waterspot_cold_hot:"waterspot_drainage_cold_hot"}},this.removed_items={waterspot_drainage_cold_hot:{waterspot_hot:"waterspot_drainage_cold",waterspot_cold:"waterspot_drainage_hot",waterspot_drainage:"waterspot_cold_hot"},waterspot_drainage_hot:{waterspot_hot:"waterspot_drainage",waterspot_drainage:"waterspot_hot"},waterspot_drainage_cold:{waterspot_cold:"waterspot_drainage",waterspot_drainage:"waterspot_cold"},waterspot_cold_hot:{waterspot_cold:"waterspot_hot",waterspot_hot:"waterspot_cold"}}}unselect_source_item(){this.target_id=null,this.name_item=null}is_source(e){return void 0!==this.source_items[e]}is_target(e,t){return void 0!==this.source_items[e]&&void 0!==this.source_items[e][t]}get_group_name(e,t){return this.source_items[e][t]}unset_item(e){hide2.contextmenu();let t=get_item();if(t&&this.removed_items[t.props.name]&&this.removed_items[t.props.name][e]){var i=this.removed_items[t.props.name][e];if(t.findComment(),"waterspot_drainage"===i&&(t.props.settings.need_show_baseline=!0),t.props.name=i,"waterspot_drainage"===e&&(t.props.center=LIB.pointOnLine(t.props.projection,t.props.center,-3),t.updateComment()),t.props.height=tools[t.props.name].height,t.props.width=tools[t.props.name].width,t.props.settings.anchor=tools[t.props.name].anchor,t.props.settings.filling=tools[t.props.name].filling,t.props.settings.filling_after=tools[t.props.name].filling_after,t.props.settings.height=tools[t.props.name].height,t.props.settings.height_changed=tools[t.props.name].height,t.props.settings.width=tools[t.props.name].width,t.props.settings.width_changed=tools[t.props.name].width,t.props.settings.stroke_after=tools[t.props.name].stroke_after,t.props.settings.stroke_color=tools[t.props.name].stroke_color,t.props.settings.stroke_width=tools[t.props.name].stroke_width,"waterspot_drainage"===e&&t.props.pipes&&t.props.pipes.drainage_pipe_id){let e=piping.get_tree_from_storage(t.props.pipes.drainage_pipe_id);e&&e.deleteByItem(piping.get_id_item(t))}if("waterspot_hot"===e&&t.props.pipes&&t.props.pipes.water_hot_pipe_id){let e=piping.get_tree_from_storage(t.props.pipes.water_hot_pipe_id);e&&e.deleteByItem(piping.get_id_item(t))}if("waterspot_cold"===e&&t.props.pipes&&t.props.pipes.water_pipe_id){let e=piping.get_tree_from_storage(t.props.pipes.water_pipe_id);e&&e.deleteByItem(piping.get_id_item(t))}for(let e=0;e<items.db.length;e++)if(items.db[e].props.id===t.props.id){items.db[e].erase(),items.db[e]=new Item(t.props);break}project.localSave(),piping.draw_lines(t)}}change_sequence(){hide2.contextmenu();let e=get_item();e&&(e.props.waterspots_change_sequence=e.props.waterspots_change_sequence?0:1,project.localSave(),e.paint(),piping.draw_lines(e))}}var groupWaterSpots=new GroupWaterSpots;class SocketsGroup{constructor(){this.target_id=null,this.name_item=null,this.reset_cursor=!1,this.block_cursor=!1,this.cursor_side="R",this.point=null,this.types={socket:{type:"socket",stroke:"#148515",plan:"sockets"},socket_ip44:{type:"socket",stroke:"#26618e",legend:"IP44",plan:"sockets"},socket_tv:{type:"socket_lowcurrent",stroke:"#da0aea",legend:"TV",plan:"sockets"},socket_ip:{type:"socket_lowcurrent",stroke:"#da0aea",legend:"IP",plan:"sockets"},socket_usb:{type:"socket_lowcurrent",stroke:"#da0aea",legend:"USB",plan:"sockets"},socket_hdmi:{type:"socket_lowcurrent",stroke:"#da0aea",legend:"HDMI",plan:"sockets"},socket_audio:{type:"socket_lowcurrent",stroke:"#da0aea",legend:"AU",plan:"sockets"},socket_phone:{type:"socket_lowcurrent",stroke:"#da0aea",legend:"TF",plan:"sockets"},light_switch:{type:"switch",stroke:"#dc143c",plan:"light_connections"},light_switch_double:{type:"switch",stroke:"#dc143c",plan:"light_connections"},light_switch_through:{type:"switch",stroke:"#dc143c",plan:"light_connections"},light_switch_through_double:{type:"switch",stroke:"#dc143c",plan:"light_connections"},light_switch_triple:{type:"switch",stroke:"#dc143c",plan:"light_connections"},light_switch_cross:{type:"switch",stroke:"#dc143c",plan:"light_connections"},light_switch_cross_double:{type:"switch",stroke:"#dc143c",plan:"light_connections"},light_dimmer:{type:"switch",stroke:"#dc143c",plan:"light_connections"}}}get_path(e){let t=this.types[e]&&this.types[e].path;return t=t||(tools&&tools[e]&&tools[e].path?tools[e].path:"")}get_height(e){return tools&&tools[e]&&tools[e].height?+tools[e].height:14}get_width(e){return tools&&tools[e]&&tools[e].width?+tools[e].width:14}is_allow(e){return void 0!==this.types[e]}get_image(i){let n=layers.items1.group(),s=!1,o=!1;for(let e=0;e<i.length;e++)s||"switch"!==socketsGroup.types[i[e].name].type||(s=!0),o||"switch"===socketsGroup.types[i[e].name].type||(o=!0);for(let t=0;t<i.length;t++){let e=0;e=s?!o||"switch"===socketsGroup.types[i[t].name].type?9:11:7,n.path(this.get_path(i[t].name)).cx(7*(t+1)).cy(e).attr({"stroke-width":2,stroke:socketsGroup.types[i[t].name].stroke,fill:"#ffffff",socket_index:t,socket_name:i[t].name,socket_id:i[t].id||""})}return n}get_plans(t){let i={};for(let e=0;e<t.length;e++)i[socketsGroup.types[t[e].name].plan]=1;return i}get_max_height(t){let i=14;for(let e=0;e<t.length;e++)tools&&tools[t[e].name]&&tools[t[e].name].height&&(i=Math.max(i,+tools[t[e].name].height));return i}get_legend(e){return this.types[e]&&this.types[e].legend?this.types[e].legend:""}get_plan(e){return this.types[e]&&this.types[e].plan?this.types[e].plan:""}setAttr(t,i,n,s=null){if((this.is_allow(i)||"socket_group"===i)&&t.node&&t.node.children){let e=null;if(s&&(i=s.split("|s|"),(i=get_item(i[0]))&&(e=this.getIndexSocketById(i,s))),Number.isInteger(e)&&t.node.children[e])$(t.node.children[e]).attr(n);else for(let e=0;e<t.node.children.length;e++){var o=$(t.node.children[e]).attr("socket_name");this.types[o].plan===plan&&"#a5a5a5"===n.stroke||$(t.node.children[e]).attr(n)}}}setDefaultColor(i,e,n){if((this.is_allow(e)||"socket_group"===e)&&i.node&&i.node.children)for(let t=0;t<i.node.children.length;t++){var s=$(i.node.children[t]).attr("socket_name"),o=$(i.node.children[t]).attr("socket_id");let e=socketsGroup.types[s].stroke;var l=socketsGroup.types[s].type;this.types[s].plan!==plan&&"cables"!==plan?e="#a5a5a5":n&&plan===cabling.plan&&"switch"===l&&n.props&&n.props.socket_group&&o&&((l=this.getSocketById(o,n))&&l.cables&&(l.cables.length===cabling.get_max_count_keys_on_switch(s)||"light_dimmer"===s&&0<l.cables.length)&&(e="#148515")),$(i.node.children[t]).attr({stroke:e}),$(i.node.children[t]).attr({fill:"#ffffff"}),$(i.node.children[t]).attr({"stroke-width":2})}}getIndexSocketByPoint(t,i){if(i.polygons_socket_group)for(let e=i.polygons_socket_group.length-1;0<=e;e--)if(is_point_inside_polygon(t,i.polygons_socket_group[e])&&(this.types[i.props.socket_group[e].name].plan===plan||"cables"===plan))return e;return null}getIdSocketByIndex(e,t){return null!==t&&e&&e.props&&e.props.socket_group&&e.props.socket_group[t]?this.generateIdSocket(e,e.props.socket_group[t].id):null}getIndexSocketById(t,i){if(t&&t.props&&t.props.socket_group){i=this.getSocketIdFromFullId(i);for(let e=0;e<t.props.socket_group.length;e++)if(t.props.socket_group[e].id===i)return e}return null}getIdSocketByPoint(e,t){e=this.getIndexSocketByPoint(e,t);return null!==e?this.getIdSocketByIndex(t,e):null}generateIdSocket(e,t){return e.props.id+"|s|"+t}getSocketById(t,i=null){if(is_empty(t))return null;var e;if(null===i&&(e=t.split("|s|"),i=get_item(e[0])),i&&i.props&&i.props.socket_group&&(t=this.getSocketIdFromFullId(t)))for(let e=0;e<i.props.socket_group.length;e++)if(i.props.socket_group[e].id===t)return i.props.socket_group[e];return null}getSocketIdFromFullId(e){e=e.split("|s|");return e[1]||e[0]}isSocketId(e){return e&&e.includes("|s|")}}var socketsGroup=new SocketsGroup;class CableSocket extends TreeLines{constructor(e={}){super(e),this.type=e.type||"wire_3_25",this.plan="cables",this.name_human="Электропроводка",this.v=e.v||2,this.defineColor();let t=this;this.IMAGE=layers.cables_socket.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.IMAGE_2=layers.sockets_up.group(),this.draw()}serialize(){return{id:this.id,connections:this.connections,items:this.items,type:this.type,points_connections:this.points_connections,length:this.length,v:this.v}}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":this.getLining().is_multi(e)?"multi":"electrospot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||this.isExistMovingItems()||!0===this.getLining().moving_point_line||(e=e.target.getAttribute("cable_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("cable_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.cable_socket=this.id,cables_socket.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.cable_socket=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan)if(this.show(),t||(t=this.color,this.changeSizeNodes("down")),i){let e=$('[is_cable_socket_line][cable_id="'+this.id+'"][cable_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_cable_socket_line][cable_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(e,t,i,n){var s=this.getPosition(i,n),o=s.s||this.getPoint(e,i),s=s.e||this.getPoint(t,n),l=i+"_"+n;t.start_item_tree=i;let r=this.IMAGE.line().attr({cable_line_id:l,stroke:"transparent","stroke-width":8}),a=(r.plot(o.x,o.y,s.x,s.y),this.IMAGE.line().attr({cable_id:this.id,cable_line_id:l,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_cable_socket_line:1}));in_array(this.type,["wire_earth_3_15","wire_earth_3_60"])&&a.attr({"stroke-dasharray":"8,4"}),a.plot(o.x,o.y,s.x,s.y),this.getLining().items_any_connections[this.getNameItem(e)]&&this.points_line.push(new ConnectPointLine({type:this.type,plan:this.plan,color:this.color,point:o,line_id:l,tree_id:this.id,item_id:i,line_point_number:1,line:a})),this.getLining().items_any_connections[this.getNameItem(t)]&&this.points_line.push(new ConnectPointLine({type:this.type,plan:this.plan,color:this.color,point:s,line_id:l,tree_id:this.id,item_id:n,line_point_number:2,line:a})),this.lines.push({line:get_line(o,s),id:this.id,line_id:l})}addNew(t){try{if(this.isNotEmptyTree(t)){let e=new CableSocket({type:this.type});e.connections=t,e.points_connections=copy.object(this.points_connections),cables_socket.db.push(e),e.updateData(),e.draw()}else this.unsetFromItems(Object.keys(t))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#cable_socket_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("cable_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<cables_socket.db.length;e++)if(cables_socket.db[e].id===t){cables_socket.db.splice(e,1);break}}setToItem(e,t){this.getLining().set_tree_id(e,t,this.id,this.type)}}class CablingSocket extends TreeLining{constructor(){super(),this.tools=["wire_3_25","wire_3_15","wire_3_40","wire_5_40","wire_3_60","wire_earth_3_15","wire_earth_3_60","wire_tv","wire_utp","wire_hdmi","wire_audio","wire_phone"],this.tools_power=["wire_3_25","wire_3_15","wire_3_40","wire_5_40","wire_3_60"],this.tools_for_switches=["wire_3_15"],this.tools_lowcurrent=["wire_tv","wire_utp","wire_hdmi","wire_audio","wire_phone"],this.tools_earth=["wire_earth_3_15","wire_earth_3_60"],this.name_object_lines="cables_socket",this.plan="cables",this.name_node="electrospot_node",this.sockets={socket_group:1,socket_power:1,socket_380:1,floor_socket:1,wire_oven:1,wire_stove:1,wire_conditioner:1,wire_light:1,wire:1,wire_lowcurrent:1,socket_thermo:1},this.sockets_single=["socket_power","socket_380","floor_socket","wire_oven","wire_stove","wire_conditioner","wire_light","wire","wire_lowcurrent","socket_thermo"],this.sockets_power_in_group={socket:1,socket_ip44:1},this.sockets_lowcurrent_in_group={socket_tv:1,socket_ip:1,socket_usb:1,socket_hdmi:1,socket_audio:1,socket_phone:1},this.switches_in_group={light_switch:1,light_switch_double:1,light_switch_triple:1,light_switch_through:1,light_switch_through_double:1,light_switch_cross:1,light_switch_cross_double:1,light_dimmer:1},this.items_for_power_sockets={socket_group:1,socket_power:1,socket_380:1,floor_socket:1,electric_shield:1,electric_shield_internal:1,electric_shield_old:1,electric_box:1,electrospot_node:1,wire_oven:1,wire_stove:1,wire_conditioner:1,wire_light:1,wire:1,socket_thermo:1},this.items_for_lowcurrent_sockets={socket_group:1,electric_shield:1,electric_shield_internal:1,electric_shield_old:1,electric_box:1,electrospot_node:1,wire_lowcurrent:1},this.spots={wire_3_25:this.items_for_power_sockets,wire_3_15:this.items_for_power_sockets,wire_3_40:this.items_for_power_sockets,wire_5_40:this.items_for_power_sockets,wire_3_60:this.items_for_power_sockets,wire_earth_3_15:Object.assign(copy.object(this.items_for_power_sockets),{electric_kup:1}),wire_earth_3_60:Object.assign(copy.object(this.items_for_power_sockets),{electric_kup:1}),wire_tv:this.items_for_lowcurrent_sockets,wire_utp:this.items_for_lowcurrent_sockets,wire_hdmi:this.items_for_lowcurrent_sockets,wire_audio:this.items_for_lowcurrent_sockets,wire_phone:this.items_for_lowcurrent_sockets},this.source_items={wire_3_25:{socket_group:this.spots.wire_3_25,socket_power:this.spots.wire_3_25,socket_380:this.spots.wire_3_25,floor_socket:this.spots.wire_3_25,electric_shield:this.spots.wire_3_25,electric_shield_internal:this.spots.wire_3_25,electric_shield_old:this.spots.wire_3_25,electric_box:this.spots.wire_3_25,electrospot_node:this.spots.wire_3_25,wire_oven:this.spots.wire_3_25,wire_stove:this.spots.wire_3_25,wire_conditioner:this.spots.wire_3_25,wire_light:this.spots.wire_3_25,wire:this.spots.wire_3_25,socket_thermo:this.spots.wire_3_25},wire_3_15:{socket_group:this.spots.wire_3_15,socket_power:this.spots.wire_3_15,socket_380:this.spots.wire_3_15,floor_socket:this.spots.wire_3_15,electric_shield:this.spots.wire_3_15,electric_shield_internal:this.spots.wire_3_15,electric_shield_old:this.spots.wire_3_15,electric_box:this.spots.wire_3_15,electrospot_node:this.spots.wire_3_15,wire_oven:this.spots.wire_3_15,wire_stove:this.spots.wire_3_15,wire_conditioner:this.spots.wire_3_15,wire_light:this.spots.wire_3_15,wire:this.spots.wire_3_15,socket_thermo:this.spots.wire_3_25},wire_3_40:{socket_group:this.spots.wire_3_40,socket_power:this.spots.wire_3_40,socket_380:this.spots.wire_3_40,floor_socket:this.spots.wire_3_40,electric_shield:this.spots.wire_3_40,electric_shield_internal:this.spots.wire_3_40,electric_shield_old:this.spots.wire_3_40,electric_box:this.spots.wire_3_40,electrospot_node:this.spots.wire_3_40,wire_oven:this.spots.wire_3_40,wire_stove:this.spots.wire_3_40,wire_conditioner:this.spots.wire_3_40,wire_light:this.spots.wire_3_40,wire:this.spots.wire_3_40,socket_thermo:this.spots.wire_3_25},wire_5_40:{socket_group:this.spots.wire_5_40,socket_power:this.spots.wire_5_40,socket_380:this.spots.wire_5_40,floor_socket:this.spots.wire_5_40,electric_shield:this.spots.wire_5_40,electric_shield_internal:this.spots.wire_5_40,electric_shield_old:this.spots.wire_5_40,electric_box:this.spots.wire_5_40,electrospot_node:this.spots.wire_5_40,wire_oven:this.spots.wire_5_40,wire_stove:this.spots.wire_5_40,wire_conditioner:this.spots.wire_5_40,wire_light:this.spots.wire_5_40,wire:this.spots.wire_5_40,socket_thermo:this.spots.wire_3_25},wire_3_60:{socket_group:this.spots.wire_3_60,socket_power:this.spots.wire_3_60,socket_380:this.spots.wire_3_60,floor_socket:this.spots.wire_3_60,electric_shield:this.spots.wire_3_60,electric_shield_internal:this.spots.wire_3_60,electric_shield_old:this.spots.wire_3_60,electric_box:this.spots.wire_3_60,electrospot_node:this.spots.wire_3_60,wire_oven:this.spots.wire_3_60,wire_stove:this.spots.wire_3_60,wire_conditioner:this.spots.wire_3_60,wire_light:this.spots.wire_3_60,wire:this.spots.wire_3_60,socket_thermo:this.spots.wire_3_25},wire_earth_3_15:{socket_group:this.spots.wire_earth_3_15,socket_power:this.spots.wire_earth_3_15,socket_380:this.spots.wire_earth_3_15,floor_socket:this.spots.wire_earth_3_15,electric_shield:this.spots.wire_earth_3_15,electric_shield_internal:this.spots.wire_earth_3_15,electric_shield_old:this.spots.wire_earth_3_15,electric_box:this.spots.wire_earth_3_15,electrospot_node:this.spots.wire_earth_3_15,wire_oven:this.spots.wire_earth_3_15,wire_stove:this.spots.wire_earth_3_15,wire_conditioner:this.spots.wire_earth_3_15,wire_light:this.spots.wire_earth_3_15,wire:this.spots.wire_earth_3_15,socket_thermo:this.spots.wire_3_25,electric_kup:this.spots.wire_earth_3_15},wire_earth_3_60:{socket_group:this.spots.wire_earth_3_60,socket_power:this.spots.wire_earth_3_60,socket_380:this.spots.wire_earth_3_60,floor_socket:this.spots.wire_earth_3_60,electric_shield:this.spots.wire_earth_3_60,electric_shield_internal:this.spots.wire_earth_3_60,electric_shield_old:this.spots.wire_earth_3_60,electric_box:this.spots.wire_earth_3_60,electrospot_node:this.spots.wire_earth_3_60,wire_oven:this.spots.wire_earth_3_60,wire_stove:this.spots.wire_earth_3_60,wire_conditioner:this.spots.wire_earth_3_60,wire_light:this.spots.wire_earth_3_60,wire:this.spots.wire_earth_3_60,socket_thermo:this.spots.wire_3_25,electric_kup:this.spots.wire_earth_3_60},wire_tv:{socket_group:this.spots.wire_tv,electric_shield:this.spots.wire_tv,electric_shield_internal:this.spots.wire_tv,electric_shield_old:this.spots.wire_tv,electric_box:this.spots.wire_tv,electrospot_node:this.spots.wire_tv,wire_lowcurrent:this.spots.wire_tv},wire_utp:{socket_group:this.spots.wire_utp,electric_shield:this.spots.wire_utp,electric_shield_internal:this.spots.wire_utp,electric_shield_old:this.spots.wire_utp,electric_box:this.spots.wire_utp,electrospot_node:this.spots.wire_utp,wire_lowcurrent:this.spots.wire_utp},wire_hdmi:{socket_group:this.spots.wire_hdmi,electric_shield:this.spots.wire_hdmi,electric_shield_internal:this.spots.wire_hdmi,electric_shield_old:this.spots.wire_hdmi,electric_box:this.spots.wire_hdmi,electrospot_node:this.spots.wire_hdmi,wire_lowcurrent:this.spots.wire_hdmi},wire_audio:{socket_group:this.spots.wire_audio,electric_shield:this.spots.wire_audio,electric_shield_internal:this.spots.wire_audio,electric_shield_old:this.spots.wire_audio,electric_box:this.spots.wire_audio,electrospot_node:this.spots.wire_audio,wire_lowcurrent:this.spots.wire_audio},wire_phone:{socket_group:this.spots.wire_phone,electric_shield:this.spots.wire_phone,electric_shield_internal:this.spots.wire_phone,electric_shield_old:this.spots.wire_phone,electric_box:this.spots.wire_phone,electrospot_node:this.spots.wire_phone,wire_lowcurrent:this.spots.wire_audio}},this.names_line_id_by_tool={wire_3_25:"cable_wire_3_25_id",wire_3_15:"cable_wire_3_15_id",wire_3_40:"cable_wire_3_40_id",wire_5_40:"cable_wire_5_40_id",wire_3_60:"cable_wire_3_60_id",wire_earth_3_15:"cable_wire_earth_3_15_id",wire_earth_3_60:"cable_wire_earth_3_60_id",wire_tv:"cable_wire_tv_id",wire_utp:"cable_wire_utp_id",wire_hdmi:"cable_wire_hdmi_id",wire_audio:"cable_wire_audio_id",wire_phone:"cable_wire_phone_id"},this.multi_spots={electric_shield:1,electric_shield_internal:1,electric_shield_old:1,electric_box:1,electric_kup:1},this.items_any_connections={electric_shield:1,electric_shield_internal:1,electric_shield_old:1},this.tools_names={wire_3_25:"Кабель 3 x 2.5",wire_3_15:"Кабель 3 x 1.5",wire_3_40:"Кабель 3 x 4",wire_5_40:"Кабель 5 x 4",wire_3_60:"Кабель 3 x 6",wire_earth_3_15:"Заземление 1 x 2.5",wire_earth_3_60:"Заземление 1 x 6",wire_tv:"Телевизионный",wire_utp:"Интернет",wire_hdmi:"HDMI",wire_audio:"Акустический",wire_phone:"Телефонный"}}unselect_source_item(){super.unselect_source_item(),this.source_connect=null,this.target_connect=null}get_stroke(){return 1.5}is_exist_tree(e,t=!1,i,n=null){if("socket_group"!==this.get_name_item(e))return super.is_exist_tree(e,t,i);if(void 0===window.tool&&!t&&!i||!e||!e.props)return!1;var s,o=socketsGroup.getSocketById(n,e);if(!o||!o[this.name_object_lines])return!1;if(t){for(var l in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(l)&&o[this.name_object_lines][this.names_line_id_by_tool[l]])return!!this.get_tree_from_storage(o[this.name_object_lines][this.names_line_id_by_tool[l]]);return!1}for(s in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(s)&&(window.tool===s||i===s)&&o[this.name_object_lines][this.names_line_id_by_tool[s]])return!!this.get_tree_from_storage(o[this.name_object_lines][this.names_line_id_by_tool[s]]);return!1}get_tree(e,t=!1,i,n=null){if("socket_group"!==this.get_name_item(e))return super.get_tree(e,t,i);if(void 0===window.tool&&!t&&!i||!e||!e.props)return null;var s,o=socketsGroup.getSocketById(n,e);if(!o||!o[this.name_object_lines])return null;for(s in Array.isArray(i)||(i=[i]),this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(s)&&(window.tool===s||t||in_array(s,i))&&o[this.name_object_lines][this.names_line_id_by_tool[s]]){var l=this.get_tree_from_storage(o[this.name_object_lines][this.names_line_id_by_tool[s]]);if(l)return l}return null}set_tree_id(e,t,i,n){if("socket_group"!==this.get_name_item(e))return super.set_tree_id(e,t,i,n);if(!(n=n||this.get_type())||!this.names_line_id_by_tool[n])return!1;let s=socketsGroup.getSocketById(t,e);return!!s&&(s[this.name_object_lines]||(s[this.name_object_lines]={}),s[this.name_object_lines][this.names_line_id_by_tool[n]]=i,!0)}unset_tree_id(e,t,i,n){if("socket_group"!==this.get_name_item(e))return super.unset_tree_id(e,t,i,n);if(!(i=i||this.get_type())||!this.names_line_id_by_tool[i])return!1;if(!n||!e.props.socket_group||!socketsGroup.isSocketId(t))return!1;let s=socketsGroup.getSocketById(t,e);return!!(s&&s[this.name_object_lines]&&s[this.name_object_lines][this.names_line_id_by_tool[i]])&&(s[this.name_object_lines][this.names_line_id_by_tool[i]]===n&&(delete s[this.name_object_lines][this.names_line_id_by_tool[i]],!0))}check_source_select(t,i,n=!1){var s=this.get_name_item(t),o=this.get_type();if(s===this.name_node){var l=this.get_tree(t,!0);if(!l)return!1;if(l.type!==o)return n&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}if(void 0!==this.sockets[s]){if("socket_group"===s){l=socketsGroup.getSocketById(i,t);if(l){var s=void 0!==this.sockets_power_in_group[l.name],r=void 0!==this.sockets_lowcurrent_in_group[l.name],l=void 0!==this.switches_in_group[l.name];if(!(in_array(o,this.tools_lowcurrent)&&r||in_array(o,this.tools_power.concat(this.tools_earth))&&s||in_array(o,this.tools_for_switches)&&l))return n&&warning.show("yellow",l10n.cabling_socket_not_select,4e3),!1}}let e;if((e=in_array(o,this.tools_earth)?this.get_tree(t,!1,this.tools_earth,i):this.get_tree(t,!1,this.tools_power.concat(this.tools_lowcurrent),i))&&e.type!==o)return n&&warning.show("yellow",l10n.cabling_socket_not_select_2,4e3),!1}return!0}check_allow_connect(i,n,t,s,o=!1){var l=this.get_type(),r=(this.get_name_item(i),this.get_name_item(n));if(t===s)return!1;if(i&&n){if(i.props[this.name_object_lines]&&n.props[this.name_object_lines])for(var a in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(a)&&l===a&&i.props[this.name_object_lines][this.names_line_id_by_tool[a]]&&n.props[this.name_object_lines][this.names_line_id_by_tool[a]]&&i.props[this.name_object_lines][this.names_line_id_by_tool[a]]===n.props[this.name_object_lines][this.names_line_id_by_tool[a]])return o&&warning.show("yellow",l10n.cabling_already_connect_cable,3e3),!1;let e=this.get_tree(i,!1,l,this.source_id),t=this.get_tree(n,!1,l,s);if(e&&t&&arrays_has_equals_elements(e.getMultiItemIds(),t.getMultiItemIds()))return o&&warning.show("yellow",l10n.cabling_socket_has_same_box,3e3),!1}if(r===this.name_node){t=this.get_tree(n,!0,[],s);if(!t)return!1;if(t.type!==l)return o&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}if(void 0!==this.sockets[r]){if("socket_group"===r){t=socketsGroup.getSocketById(s,n);if(t){var r=void 0!==this.sockets_power_in_group[t.name],h=void 0!==this.sockets_lowcurrent_in_group[t.name],t=void 0!==this.switches_in_group[t.name];if(!(in_array(l,this.tools_lowcurrent)&&h||in_array(l,this.tools_power.concat(this.tools_earth))&&r||in_array(l,this.tools_for_switches)&&t))return o&&warning.show("yellow",l10n.cabling_socket_not_select,4e3),!1}}let e;if((e=in_array(l,this.tools_earth)?this.get_tree(n,!1,this.tools_earth,s):this.get_tree(n,!1,this.tools_power.concat(this.tools_lowcurrent),s))&&e.type!==l)return o&&warning.show("yellow",l10n.cabling_socket_not_select_2,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){let t=this.get_tree_from_storage(this.source_tree_line.id);if(t){if(void 0!==t.items[s])return o&&warning.show("yellow",l10n.cabling_already_connect_cable,4e3),!1;let e=this.get_tree(n,!1,l,s);if(e&&arrays_has_equals_elements(t.getMultiItemIds(),e.getMultiItemIds()))return o&&warning.show("yellow",l10n.cabling_socket_has_same_box,3e3),!1}}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.spots.wire_3_25[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.cabling_not_join_cable,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}let n;if(this.is_exist_tree(t,!1,"",this.source_id)&&!this.is_multi(t)?(n=this.get_tree(t,!1,[],this.source_id),i=n.addNode(t,this.source_id,s,this.source_connect)):(n=new CableSocket({type:this.get_type()}),i=n.addNode(t,this.source_id,s,this.source_connect),n.defineColor(),cables_socket.db.push(n)),this.is_exist_tree(t,!1,"",this.source_id)&&!this.is_multi(t)||this.set_tree_id(t,this.source_id,n.id,n.type),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,this.source_id,o,!0))return!1;let s;if(!this.is_exist_tree(i,!1,"",this.source_id)||this.is_multi(i)||this.is_exist_tree(n,!1,"",o)&&!this.is_multi(n))if(this.is_exist_tree(i,!1,"",this.source_id)&&!this.is_multi(i)||!this.is_exist_tree(n,!1,"",o)||this.is_multi(n))if(this.is_exist_tree(i,!1,"",this.source_id)&&this.is_exist_tree(n,!1,"",o)&&!this.is_multi(i)&&!this.is_multi(n)){let e=this.get_tree(i,!1,[],this.source_id),t=this.get_tree(n,!1,[],o);s=e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o,this.source_connect,this.target_connect),e):(t.union(e,o,this.source_id,this.target_connect,this.source_connect),t)}else(s=new CableSocket({type:this.get_type()})).addSpot(i,n,this.source_id,o,this.source_connect,this.target_connect),s.defineColor(),cables_socket.db.push(s);else(s=this.get_tree(n,!1,[],o)).addSpot(n,i,o,this.source_id,this.target_connect,this.source_connect),s.defineColor();else(s=this.get_tree(i,!1,[],this.source_id)).addSpot(i,n,this.source_id,o,this.source_connect,this.target_connect),s.defineColor();if(this.is_exist_tree(i,!1,"",this.source_id)&&!this.is_multi(i)||this.set_tree_id(i,this.source_id,s.id,s.type),this.is_exist_tree(n,!1,"",o)&&!this.is_multi(n)||this.set_tree_id(n,o,s.id,s.type),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=o,this.source_point=this.get_point_in_mousedown(e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item,!1,[],this.source_id))&&t.color&&(this.color_line=t.color),e.paint(),$("body").css("cursor","crosshair"),this.draw_reference_lines(e)}else warning.show("yellow",l10n.cabling_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,this.target_connect=null,$("body").css("cursor","crosshair"),!this.source_id)return;let s=!1;var i,n,o,l=this.get_item(this.source_id),r=this.get_type();for(let e=0;e<items.db.length;e++){var a=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(a))&&(this.get_name_item(a)!==this.name_node||this.is_node(items.db[e]))){this.unselect(a);let t=!1,i,e=this.get_id_item(a),n=null;if("socket_group"===this.get_name_item(a))(e=socketsGroup.getIdSocketByPoint(mouse.end,a))&&(i=this.get_point(r,a,e),t=!0);else if(this.items_any_connections[this.get_name_item(a)]){var h=this.get_polygon(a);for(let e=0;e<h.length;e++){var g=e<h.length-1?get_line(h[e],h[e+1]):get_line(h[e],h[0]),_=LIB.projection(mouse.end,g);if(get_distance(mouse.end,_)<8){t=!0,i=_,n={i:e,d:+(get_distance(h[e],_)/get_distance(g.s,g.e)).toFixed(4)};break}}if(!t&&this.is_point_inside_item(mouse.end,a)){var d=get_line(mouse.end,this.source_point);for(let e=0;e<h.length;e++){var p=e<h.length-1?get_line(h[e],h[e+1]):get_line(h[e],h[0]),c=line_and_line_intersection(d,p);if(c){t=!0,i=c,n={i:e,d:+(get_distance(h[e],c)/get_distance(p.s,p.e)).toFixed(4)};break}}}}else{if(!a.props.center&&!a.center)continue;(get_distance(mouse.end,a.props.center||a.center)<(this.get_name_item(a)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,a))&&(i=this.get_point(r,a,e),t=!0)}if(t){if(!this.check_allow_connect(l,a,this.source_id,e))break;this.target_item=a,this.target_id=e,this.target_connect=n,mouse.end=i,this.select(a,this.target_id),$("body").css("cursor","pointer"),s=!0;break}}}if(!s){let i=this.source_tree_line?this.get_tree_from_storage(this.source_tree_line.id):null;for(let e=0;e<cables_socket.db.length;e++){let t=cables_socket.db[e];if(void 0===t.items[this.source_id]&&(r===t.type&&(!i||i.id!==t.id)&&(!i||!arrays_has_equals_elements(i.getMultiItemIds(),t.getMultiItemIds()))&&(i||!arrays_has_equals_elements(this.get_all_multi_ids(l,r,this.source_id),t.getMultiItemIds())))){t.paint();for(let e=0;e<t.lines.length;e++){var A=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,A)<8){this.target_tree_line=t.lines[e],mouse.end=A,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),s=!0;break}}if(s)break}}}if(!s&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var u in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(u)&&(i=manager_lining.reference_lines[u],(n=LIB.projection(mouse.end,i))&&(o=get_distance(mouse.end,n))<t&&(t=o,e=n));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(r)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke(),r),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let n=!1,s=this.source_item;var i,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var a=items.db[e];if(a.props.id!==this.source_id&&(this.check_connection_items(this.source_name,this.get_name_item(a))&&(this.get_name_item(a)!==this.name_node||this.is_node(items.db[e]))&&!this.items_any_connections[this.get_name_item(a)])){this.unselect(a);let e=!1,t=this.get_id_item(a);if("socket_group"===this.get_name_item(a)?(t=socketsGroup.getIdSocketByPoint(mouse.end,a))&&(e=!0):(get_distance(mouse.end,a.props.center||a.center)<(this.get_name_item(a)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,a))&&(e=!0),e){if(!this.check_allow_connect(s,a,this.source_id,t))break;s.hide(),this.target_item=a,this.target_id=t,mouse.end=this.get_point(r,a,this.target_id),s.props.center=mouse.end,this.target_point=mouse.end,this.select(a,this.target_id),$("body").css("cursor","pointer"),n=!0;break}}}if(!n){s.show();let i=this.get_tree(s,!0);for(let e=0;e<cables_socket.db.length;e++){let t=cables_socket.db[e];if(void 0===t.items[this.source_id]&&!(r!==t.type||i&&arrays_has_equals_elements(i.getMultiItemIds(),t.getMultiItemIds()))){t.paint();for(let e=0;e<t.lines.length;e++){var h=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,h)<5){this.target_tree_line=t.lines[e],mouse.end=h,s.props.center=mouse.end,this.target_point=mouse.end,s.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),n=!0;break}}if(n)break}}}if(!n&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var g in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(g)&&(i=manager_lining.reference_lines[g],(o=LIB.projection(mouse.end,i))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return n?!0:(s.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_point(e,t,i,n){var s=this.get_name_item(t);let o;return o=(o="socket_group"===s&&(s=socketsGroup.getSocketById(i,t))?s.center_moving||s.center:o)||t.props.center}get_color_by_type(e){let t="gray";switch(e){case"wire_3_25":t="#cc0000";break;case"wire_3_15":t="#24a5ff";break;case"wire_3_40":t="#19218c";break;case"wire_5_40":t="#c65a1f";break;case"wire_3_60":t="#911fc6";break;case"wire_earth_3_15":t="#b9e700";break;case"wire_earth_3_60":t="#0ec113";break;case"wire_tv":t="#70e300";break;case"wire_utp":t="#f147cb";break;case"wire_hdmi":t="#000000";break;case"wire_audio":t="#964b00";break;case"wire_phone":t="#d0098a"}return t}select(e,t){e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up"),"socket_group"===this.get_name_item(e)&&socketsGroup.isSocketId(t)&&socketsGroup.setAttr(e.image,this.get_name_item(e),{stroke:"#ff8a0d"},t)}unselect(e){var t=this.get_color_of_item(e,e.model.stroke_color),i=this.get_color_fill_of_item(e,e.model.filling);e.image.attr({stroke:t,fill:i}),socketsGroup.setDefaultColor(e.image,this.get_name_item(e),e),this.is_node(e)&&this.change_size_node(e,"down")}is_cabling_plan(e){return!("cables"!==plan||!(e.model.plan.hasOwnProperty("sockets")||e.model.plan.hasOwnProperty("light_connections")||e.model.plan.hasOwnProperty("warm_floor"))||void 0===this.sockets[e.props.name])}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.width_changed=1,n.height_changed=1,n.group="cables",n.plan={cables:1};t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_tree_from_storage(e){return get_cable_socket(e)}get_trees_from_storage(){return cables_socket.db}union_node(n,s){try{if(this.source_id&&this.is_exist_tree(this.source_item,!1,this.get_type(),this.source_id)&&this.check_connection_items(this.source_name,this.get_name_item(n))){let e=this.source_item;var o=n,l=this.get_type();if(!this.check_allow_connect(e,o,this.source_id,s,!0))return!1;let t=this.get_tree(e,!1,l,this.source_id),i=!1;if(!this.is_exist_tree(o,!1,l,s)||this.is_multi(o))t.changeSpot(e,o,this.source_id,s),this.set_tree_id(o,s,t.id,l),i=!0;else{let e=this.get_tree(o,!1,l,s);e.unionByNode(t,s,this.source_id)}this.unset_tree_id(e,this.source_id,l,t.id),e.delete({no_delete_lines:!0}),i&&t.draw(),this.unselect_source_item(),project.localSave()}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}get_type(){if(void 0!==window.tool&&in_array(tool,this.tools))return window.tool;if(this.source_name===this.name_node&&this.source_item){var e=this.get_tree(this.source_item,!0,[],this.source_id);if(e)return e.type}return""}get_all_tree_ids(t,i){let n=[];if("socket_group"===this.get_name_item(t)&&t.props.socket_group)for(let e=0;e<t.props.socket_group.length;e++)t.props.socket_group[e][this.name_object_lines]&&t.props.socket_group[e][this.name_object_lines][this.names_line_id_by_tool[i]]&&n.push(t.props.socket_group[e][this.name_object_lines][this.names_line_id_by_tool[i]]);else this.names_line_id_by_tool[i]&&t.props[this.name_object_lines]&&t.props[this.name_object_lines][this.names_line_id_by_tool[i]]&&(this.is_multi(t)?n=Object.values(t.props[this.name_object_lines][this.names_line_id_by_tool[i]]):n.push(t.props[this.name_object_lines][this.names_line_id_by_tool[i]]));return n}delete_lines(i,n=!1){if("socket_group"!==this.get_name_item(i))return super.delete_lines(i);if(i.props&&i.props.socket_group)for(let t=0;t<i.props.socket_group.length;t++)if(i.props.socket_group[t][this.name_object_lines])for(var s in i.props.socket_group[t][this.name_object_lines])if(i.props.socket_group[t][this.name_object_lines].hasOwnProperty(s)){let e=this.get_tree_from_storage(i.props.socket_group[t][this.name_object_lines][s]);e&&e.deleteByItem(socketsGroup.generateIdSocket(i,i.props.socket_group[t].id),n)}}get_polygon(e){let t=[],i=0;e.getPolygon();var n=e.polygon;switch(this.get_name_item(e)){case"electric_shield":i=Math.floor(.14*get_distance(n[1],n[2])),t=[LIB.pointOnLine(n[3],n[0],-i),LIB.pointOnLine(n[2],n[1],-i)];break;case"electric_shield_internal":i=Math.floor(.472*get_distance(n[1],n[2])),t=[LIB.pointOnLine(n[3],n[0],-i),LIB.pointOnLine(n[2],n[1],-i)];break;case"electric_shield_old":i=Math.floor(.45*get_distance(n[1],n[2])),t=[LIB.pointOnLine(n[3],n[0],-i),LIB.pointOnLine(n[2],n[1],-i)];break;default:t=[n[0],n[1],n[2],n[3]]}return t}draw_box(){if(!super.draw_box())return!1;try{var e,t=$(".options_cables_socket.active").data("type");$("#box_cables_socket").empty();for(let o=0;o<this.tools.length;o++){let i="",n=0,s=1;for(let e=0;e<cables_socket.db.length;e++){let t=cables_socket.db[e];if(t.type===this.tools[o]){var l,r=is_empty(t.points_line)?0:1;let e=0;for(l in t.items)t.items.hasOwnProperty(l)&&"electrospot"===t.items[l]&&e++;i+='<div class="options_cables_socket_item type_cables_socket" data-id="'+t.id+'">'+s+++". Щиток "+r+". Розетки "+e+"<span>"+t.length+"</span></div>",n+=t.length}}i&&(e=t===this.tools[o]?"active":"",$("#box_cables_socket").append('<div class="box_cables_socket_label">'+this.tools_names[this.tools[o]]+"<span>"+n.toFixed(2)+' м</span></div><div class="options_cables_socket '+e+'" data-type="'+this.tools[o]+'">'+i+"</div></div>"))}$("#box_cables_socket_wrapper").show()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}}var cabling_socket=new CablingSocket;class PipeConditioner extends TreeLines{constructor(e={}){super(e),this.type=e.type||"conditioner_drainage",this.plan="conditioners",this.name_human="Дренаж кондиционера",this.defineColor();let t=this;this.IMAGE=layers.pipes_conditioner.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":"waterspot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||(e=e.target.getAttribute("pipe_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("pipe_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.conditioner_pipe=this.id,pipes_conditioner.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.conditioner_pipe=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan)if(this.show(),t||(t=this.color,this.changeSizeNodes("down")),i){let e=$('[is_pipe_conditioner_line][pipe_id="'+this.id+'"][pipe_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_pipe_conditioner_line][pipe_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(e,t,i,n){var e=this.getPoint(e,i),s=this.getPoint(t,n),n=i+"_"+n;t.start_item_tree=i;let o=this.IMAGE.line().attr({pipe_line_id:n,stroke:"transparent","stroke-width":8}),l=(o.plot(e.x,e.y,s.x,s.y),this.IMAGE.line().attr({pipe_id:this.id,pipe_line_id:n,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_pipe_conditioner_line:1,"stroke-dasharray":"8,4"}));l.plot(e.x,e.y,s.x,s.y),this.lines.push({line:get_line(e,s),id:this.id,line_id:n})}addNew(t){try{if(this.isNotEmptyTree(t)){let e=new PipeConditioner({type:this.type});e.connections=t,pipes_conditioner.db.push(e),e.updateData(),e.draw()}else this.unsetFromItems(Object.keys(t))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#pipe_conditioner_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("pipe_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<pipes_conditioner.db.length;e++)if(pipes_conditioner.db[e].id===t){pipes_conditioner.db.splice(e,1);break}}}class PipingConditioner extends TreeLining{constructor(){super(),this.tools=["conditioner_drainage"],this.name_object_lines="pipes_conditioner",this.plan="conditioners",this.name_node="waterspot_node",this.waterspots={conditioner_drainage:{conditioner:1,floor_conditioner:1,duct_indoor_block:1,cassette_indoor_block:1,breezer:1,pillar_water:1,waterspot_node:1}},this.source_items={conditioner_drainage:{conditioner:this.waterspots.conditioner_drainage,floor_conditioner:this.waterspots.conditioner_drainage,duct_indoor_block:this.waterspots.conditioner_drainage,cassette_indoor_block:this.waterspots.conditioner_drainage,breezer:this.waterspots.conditioner_drainage,pillar_water:this.waterspots.conditioner_drainage,waterspot_node:this.waterspots.conditioner_drainage}},this.names_line_id_by_tool={conditioner_drainage:"drainage_pipe_id"}}get_stroke(){return 1.5}check_source_select(e,t,i=!1){if(this.is_node(e)){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.piping_not_select_node,4e3),!1}return!0}check_allow_connect(e,t,i=null,n=null,s=!1){var o=this.get_type(),l=(this.get_name_item(e),this.get_name_item(t));if((i=i||this.get_id_item(e))===(n=n||this.get_id_item(t)))return!1;if(e.props[this.name_object_lines]&&t.props[this.name_object_lines])for(var r in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(r)&&o===r&&e.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&t.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&e.props[this.name_object_lines][this.names_line_id_by_tool[r]]===t.props[this.name_object_lines][this.names_line_id_by_tool[r]])return s&&warning.show("yellow",l10n.piping_already_connect_pipe,3e3),!1;if(l===this.name_node){i=this.get_tree(t,!0);if(!i)return!1;if(i.type!==o)return s&&warning.show("yellow",l10n.piping_not_select_node,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){l=this.get_tree_from_storage(this.source_tree_line.id);if(l&&void 0!==l.items[n])return s&&warning.show("yellow",l10n.piping_already_connect_pipe+" (003)",4e3),!1}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.waterspots.conditioner_drainage[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.piping_not_join_pipe,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}let n;if(this.is_exist_tree(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s)):(n=new PipeConditioner({type:this.get_type()}),i=n.addNode(t,this.source_id,s),n.defineColor(),pipes_conditioner.db.push(n)),this.is_exist_tree(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,!0))return!1;let s;if(this.is_exist_tree(i)&&!this.is_exist_tree(n))(s=this.get_tree(i)).addSpot(i,n,this.source_id,o),s.defineColor();else if(!this.is_exist_tree(i)&&this.is_exist_tree(n))(s=this.get_tree(n)).addSpot(n,i,o,this.source_id),s.defineColor();else if(this.is_exist_tree(i)&&this.is_exist_tree(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o),e):(t.union(e,o,this.source_id),t)}else(s=new PipeConditioner({type:this.get_type()})).addSpot(i,n,this.source_id,o),s.defineColor(),pipes_conditioner.db.push(s);if(this.is_exist_tree(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)||this.set_tree_id(n,o,s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=this.get_point(this.get_type(),e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),$("body").css("cursor","crosshair"),this.draw_reference_lines(e)}else warning.show("yellow",l10n.piping_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,$("body").css("cursor","crosshair"),!this.source_id)return;let i=!1;var n,s,o,t=this.get_item(this.source_id),l=this.get_type();for(let e=0;e<items.db.length;e++){var r=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(r)))if(this.get_name_item(r)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(r),get_distance(mouse.end,r.props.center||r.center)<(this.get_name_item(r)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,r)){if(!this.check_allow_connect(t,r))break;this.target_item=r,this.target_id=this.get_id_item(r),mouse.end=this.get_point(l,r,this.target_id),this.select(r,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i)for(let e=0;e<pillars.db.length;e++){var a=pillars.db[e];if("pillar_water"===a.role)if(this.check_connection_items(this.source_name,this.get_name_item(a)))if(this.unselect(a),get_distance(mouse.end,a.center)<15){if(!this.check_allow_connect(t,a))break;this.target_item=a,this.target_id=this.get_id_item(a),mouse.end=this.get_point(l,a,this.target_id),this.select(a,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i)for(let e=0;e<pipes_conditioner.db.length;e++){let t=pipes_conditioner.db[e];if(void 0===t.items[this.source_id]&&(l===t.type&&(!this.source_tree_line||this.source_tree_line.id!==t.id))){t.paint();for(let e=0;e<t.lines.length;e++){var h=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,h)<8){this.target_tree_line=t.lines[e],mouse.end=h,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var g in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(g)&&(n=manager_lining.reference_lines[g],(s=LIB.projection(mouse.end,n))&&(o=get_distance(mouse.end,s))<t&&(t=o,e=s));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(l)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke()),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1,n=this.source_item;var s,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,t)){if(!this.check_allow_connect(n,t))break;n.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),n.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i)for(let e=0;e<pillars.db.length;e++){var a=pillars.db[e];if("pillar_water"===a.role)if(this.check_connection_items(this.source_name,this.get_name_item(a)))if(this.unselect(a),get_distance(mouse.end,a.center)<15){if(!this.check_allow_connect(n,a))break;n.hide(),this.target_item=a,this.target_id=this.get_id_item(a),mouse.end=this.get_point(r,a,this.target_id),n.props.center=mouse.end,this.target_point=mouse.end,this.select(a,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i){n.show();for(let e=0;e<pipes_conditioner.db.length;e++){let t=pipes_conditioner.db[e];if(void 0===t.items[this.source_id]&&r===t.type){t.paint();for(let e=0;e<t.lines.length;e++){var h=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,h)<5){this.target_tree_line=t.lines[e],mouse.end=h,n.props.center=mouse.end,this.target_point=mouse.end,n.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var g in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(g)&&(s=manager_lining.reference_lines[g],(o=LIB.projection(mouse.end,s))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return i?!0:(n.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_point(e,t,i,n){let s;return s=("pillar_water"===t.role?t:t.props).center}get_color_by_type(e){return"#0000ff"}get_item(e){let t=super.get_item(e);return t||((t=get_pillar(e))?t:null)}get_name_item(e){return e.props.name||e.role}get_id_item(e){return e.props.id||e.id}select(e,t){"pillar_water"===this.get_name_item(e)?e.paint("orange"):(e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up"))}unselect(e){"pillar_water"===this.get_name_item(e)?e.paint():(e.image.attr({stroke:this.get_color_of_item(e,e.model.stroke_color)}),this.is_node(e)&&this.change_size_node(e,"down"))}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.filling="#fafafa",n.width=1,n.height=1,n.width_changed=1,n.height_changed=1,n.stroke_width=1,n.group="conditioners",n.plan={conditioners:1};t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_tree_from_storage(e){return get_pipe_conditioner(e)}get_trees_from_storage(){return pipes_conditioner.db}}var piping_conditioner=new PipingConditioner;class CableConditioner extends TreeLines{constructor(e={}){super(e),this.type=e.type||"conditioner_wire",this.plan="conditioners",this.name_human="Кабель кондиционеров",this.defineColor();let t=this;this.IMAGE=layers.cables_conditioner.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":"electrospot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||(e=e.target.getAttribute("tree_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("tree_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.conditioner_cable=this.id,cables_conditioner.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.conditioner_cable=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan)if(this.show(),t||(t=this.color,this.changeSizeNodes("down")),i){let e=$('[is_cable_conditioner_line][tree_id="'+this.id+'"][tree_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_cable_conditioner_line][tree_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(e,t,i,n){var s=this.getPoint(e,i),o=this.getPoint(t,n),n=i+"_"+n;t.start_item_tree=i;let l=this.IMAGE.line().attr({tree_line_id:n,stroke:"transparent","stroke-width":8}),r=(l.plot(s.x,s.y,o.x,o.y),this.IMAGE.line().attr({tree_id:this.id,tree_line_id:n,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_cable_conditioner_line:1}));if(r.plot(s.x,s.y,o.x,o.y),!this.isNode(t)){let e=this.IMAGE.circle(4).attr({fill:"#dc143c"});e.cx(o.x).cy(o.y)}if(!this.isNode(e)){let e=this.IMAGE.circle(4).attr({fill:"#dc143c"});e.cx(s.x).cy(s.y)}this.lines.push({line:get_line(s,o),id:this.id,line_id:n})}addNew(t){try{if(this.isNotEmptyTree(t)){let e=new CableConditioner({type:this.type});e.connections=t,cables_conditioner.db.push(e),e.updateData(),e.draw()}else this.unsetFromItems(Object.keys(t))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#cable_conditioner_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("tree_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<cables_conditioner.db.length;e++)if(cables_conditioner.db[e].id===t){cables_conditioner.db.splice(e,1);break}}}class CablingConditioner extends TreeLining{constructor(){super(),this.tools=["conditioner_wire"],this.name_object_lines="cables_conditioner",this.plan="conditioners",this.name_node="electrospot_node",this.spots={conditioner_wire:{conditioner_engine:1,external_block_multisplit:1,conditioner:1,floor_conditioner:1,duct_indoor_block:1,cassette_indoor_block:1,inflow_valve:1,breezer:1,recuperator:1,electrospot_node:1}},this.source_items={conditioner_wire:{conditioner_engine:this.spots.conditioner_wire,external_block_multisplit:this.spots.conditioner_wire,conditioner:this.spots.conditioner_wire,floor_conditioner:this.spots.conditioner_wire,duct_indoor_block:this.spots.conditioner_wire,cassette_indoor_block:this.spots.conditioner_wire,inflow_valve:this.spots.conditioner_wire,breezer:this.spots.conditioner_wire,recuperator:this.spots.conditioner_wire,electrospot_node:this.spots.conditioner_wire}},this.names_line_id_by_tool={conditioner_wire:"conditioner_cable_id"}}get_stroke(){return 1.5}check_source_select(e,t,i=!1){if(this.is_node(e)){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}return!0}check_allow_connect(e,t,i=null,n=null,s=!1){var o=this.get_type(),l=(this.get_name_item(e),this.get_name_item(t));if((i=i||this.get_id_item(e))===(n=n||this.get_id_item(t)))return!1;if(e.props[this.name_object_lines]&&t.props[this.name_object_lines])for(var r in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(r)&&o===r&&e.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&t.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&e.props[this.name_object_lines][this.names_line_id_by_tool[r]]===t.props[this.name_object_lines][this.names_line_id_by_tool[r]])return s&&warning.show("yellow",l10n.cabling_already_connect_cable,3e3),!1;if(l===this.name_node){i=this.get_tree(t,!0);if(!i)return!1;if(i.type!==o)return s&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){l=this.get_tree_from_storage(this.source_tree_line.id);if(l&&void 0!==l.items[n])return s&&warning.show("yellow",l10n.cabling_already_connect_cable,4e3),!1}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.spots.conditioner_wire[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.cabling_not_join_cable,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}let n;if(this.is_exist_tree(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s)):(n=new CableConditioner({type:this.get_type()}),i=n.addNode(t,this.source_id,s),n.defineColor(),cables_conditioner.db.push(n)),this.is_exist_tree(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,!0))return!1;let s;if(this.is_exist_tree(i)&&!this.is_exist_tree(n))(s=this.get_tree(i)).addSpot(i,n,this.source_id,o),s.defineColor();else if(!this.is_exist_tree(i)&&this.is_exist_tree(n))(s=this.get_tree(n)).addSpot(n,i,o,this.source_id),s.defineColor();else if(this.is_exist_tree(i)&&this.is_exist_tree(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o),e):(t.union(e,o,this.source_id),t)}else(s=new CableConditioner({type:this.get_type()})).addSpot(i,n,this.source_id,o),s.defineColor(),cables_conditioner.db.push(s);if(this.is_exist_tree(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)||this.set_tree_id(n,o,s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=this.get_point(this.get_type(),e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),$("body").css("cursor","crosshair"),this.draw_reference_lines(e)}else warning.show("yellow",l10n.cabling_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,$("body").css("cursor","crosshair"),!this.source_id)return;let i=!1;var n,s,o,t=this.get_item(this.source_id),l=this.get_type();for(let e=0;e<items.db.length;e++){var r=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(r)))if(this.get_name_item(r)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(r),get_distance(mouse.end,r.props.center||r.center)<(this.get_name_item(r)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,r)){if(!this.check_allow_connect(t,r))break;this.target_item=r,this.target_id=this.get_id_item(r),mouse.end=this.get_point(l,r,this.target_id),this.select(r,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i)for(let e=0;e<cables_conditioner.db.length;e++){let t=cables_conditioner.db[e];if(void 0===t.items[this.source_id]&&(l===t.type&&(!this.source_tree_line||this.source_tree_line.id!==t.id))){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<8){this.target_tree_line=t.lines[e],mouse.end=a,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(n=manager_lining.reference_lines[h],(s=LIB.projection(mouse.end,n))&&(o=get_distance(mouse.end,s))<t&&(t=o,e=s));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(l)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke()),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1,n=this.source_item;var s,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,t)){if(!this.check_allow_connect(n,t))break;n.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),n.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i){n.show();for(let e=0;e<cables_conditioner.db.length;e++){let t=cables_conditioner.db[e];if(void 0===t.items[this.source_id]&&r===t.type){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<5){this.target_tree_line=t.lines[e],mouse.end=a,n.props.center=mouse.end,this.target_point=mouse.end,n.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(s=manager_lining.reference_lines[h],(o=LIB.projection(mouse.end,s))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return i?!0:(n.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_color_by_type(e){return"#dc143c"}select(e,t){e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up")}unselect(e){e.image.attr({stroke:this.get_color_of_item(e,e.model.stroke_color)}),this.is_node(e)&&this.change_size_node(e,"down")}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.filling="#fafafa",n.width=1,n.height=1,n.width_changed=1,n.height_changed=1,n.stroke_width=1,n.group="conditioners",n.plan={conditioners:1};t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_tree_from_storage(e){return get_cable_conditioner(e)}get_trees_from_storage(){return cables_conditioner.db}}var cabling_conditioner=new CablingConditioner;class CableWarnFloor extends TreeLines{constructor(e={}){super(e),this.type=e.type||"warm_floor_wire",this.plan="warm_floor",this.name_human="Кабель теплого пола",this.defineColor();let t=this;this.IMAGE=layers.cables_warm_floor.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}getTypeItem(e){e=this.getNameItem(e);return e===this.getLining().name_node?"node":"socket_thermo"===e?"socket_thermo":"warm_floor"===e?"warm_floor":"electrospot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||(e=e.target.getAttribute("cable_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("cable_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.cable_warm_floor=this.id,cables_warm_floor.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.cable_warm_floor=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan)if(this.show(),t||(t=this.color,this.changeSizeNodes("down")),i){let e=$('[is_cable_warm_floor_line][cable_id="'+this.id+'"][cable_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_cable_warm_floor_line][cable_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(e,t,i,n){var s=this.getPoint(e,i),o=this.getPoint(t,n),n=i+"_"+n;t.start_item_tree=i;let l=this.IMAGE.line().attr({cable_line_id:n,stroke:"transparent","stroke-width":8}),r=(l.plot(s.x,s.y,o.x,o.y),this.IMAGE.line().attr({cable_id:this.id,cable_line_id:n,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_cable_warm_floor_line:1}));if(r.plot(s.x,s.y,o.x,o.y),"warm_floor"===this.getNameItem(t)){let e=this.IMAGE.circle(4).attr({stroke:"#dc143c","stroke-width":1,fill:"#dc143c"});e.cx(o.x).cy(o.y)}if("warm_floor"===this.getNameItem(e)){let e=this.IMAGE.circle(4).attr({stroke:"#dc143c","stroke-width":1,fill:"#dc143c"});e.cx(s.x).cy(s.y)}this.lines.push({line:get_line(s,o),id:this.id,line_id:n})}addNew(t){try{if(this.isNotEmptyTree(t)){let e=new CableWarnFloor({type:this.type});e.connections=t,cables_warm_floor.db.push(e),e.updateData(),e.draw()}else this.unsetFromItems(Object.keys(t))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#cable_warm_floor_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("cable_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<cables_warm_floor.db.length;e++)if(cables_warm_floor.db[e].id===t){cables_warm_floor.db.splice(e,1);break}}hasSocketThermo(){for(var e in this.items)if(this.items.hasOwnProperty(e)&&"socket_thermo"===this.items[e])return!0;return!1}hasWarmFloor(){for(var e in this.items)if(this.items.hasOwnProperty(e)&&"warm_floor"===this.items[e])return!0;return!1}}class CablingWarnFloor extends TreeLining{constructor(){super(),this.tools=["warm_floor_wire"],this.name_object_lines="cables_warm_floor",this.plan="warm_floor",this.name_node="electrospot_node",this.spots={warm_floor_wire:{socket_thermo:1,warm_floor:1,electrospot_node:1}},this.source_items={warm_floor_wire:{socket_thermo:{warm_floor:1,electrospot_node:1},warm_floor:this.spots.warm_floor_wire,electrospot_node:this.spots.warm_floor_wire}},this.names_line_id_by_tool={warm_floor_wire:"cable_warm_floor_id"}}get_stroke(){return 1.5}get_id_item(e){return e.props.id||e.id}get_point(e,t,i,n){return t.props.center||t.props.point_connection}get_item(e){let t=super.get_item(e);return t||((t=get_warm_floor(e))?t:null)}check_source_select(e,t,i=!1){if(this.get_name_item(e)===this.name_node){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.wire_not_select_node,4e3),!1}return!0}check_allow_connect(t,i,e=null,n=null,s=!1){var o=this.get_type(),l=this.get_name_item(t),r=this.get_name_item(i);if((e=e||this.get_id_item(t))===(n=n||this.get_id_item(i)))return!1;if(t.props.cables_warm_floor&&i.props.cables_warm_floor)for(var a in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(a)&&o===a&&t.props[this.name_object_lines][this.names_line_id_by_tool[a]]&&i.props[this.name_object_lines][this.names_line_id_by_tool[a]]&&t.props[this.name_object_lines][this.names_line_id_by_tool[a]]===i.props[this.name_object_lines][this.names_line_id_by_tool[a]])return s&&warning.show("yellow",l10n.wire_already_connect_cable,3e3),!1;if(this.get_name_item(i)===this.name_node){e=this.get_tree(i,!0);if(!e)return!1;if(e.type!==o)return s&&warning.show("yellow",l10n.wire_not_select_node,4e3),!1}if("socket_thermo"!==l&&"socket_thermo"===r&&t.props.cables_warm_floor){let e=this.get_tree(t,!1,"warm_floor_wire");if(e&&e.hasSocketThermo())return s&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_thermo,4e3),!1}if("socket_thermo"!==r&&"socket_thermo"===l&&i.props.cables_warm_floor){let e=this.get_tree(i,!1,"warm_floor_wire");if(e&&e.hasSocketThermo())return s&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_thermo,4e3),!1}if("socket_thermo"!==l&&"socket_thermo"!==r&&t.props.cables_warm_floor&&i.props.cables_warm_floor){let e=this.get_tree(t,!1,"warm_floor_wire");if(e&&e.hasSocketThermo()){let e=this.get_tree(i,!1,"warm_floor_wire");if(e&&e.hasSocketThermo())return s&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_thermo,4e3),!1}}if("warm_floor"===r&&i.props.cables_warm_floor&&this.get_tree(i,!1,"warm_floor_wire"))return s&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_same_floor,4e3),!1;if("warm_floor"===r&&"warm_floor"===l)return s&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_floor,4e3),!1;if(this.source_tree_line&&this.source_tree_line.id){e=this.get_tree_from_storage(this.source_tree_line.id);if(e&&void 0!==e.items[n])return s&&warning.show("yellow",l10n.wire_already_connect_cable,4e3),!1}return!0}check_allow_connect_lines(t,i,n,s,o=!1){if(n&&s&&n.hasSocketThermo()&&s.hasSocketThermo())return o&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_thermo,4e3),!1;if(t&&s){let e=this.get_tree(t,!1,s.type);if((e&&e.hasSocketThermo()||"socket_thermo"===this.get_name_item(t))&&s.hasSocketThermo())return o&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_thermo,4e3),!1}if(n&&i){let e=this.get_tree(i,!1,n.type);if((e&&e.hasSocketThermo()||"socket_thermo"===this.get_name_item(i))&&n.hasSocketThermo())return o&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_thermo,4e3),!1}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.spots.warm_floor_wire[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.wire_not_join_cable,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1;if(this.source_tree_line&&!this.check_allow_connect_lines(t,items.db[e],this.get_tree_from_storage(this.source_tree_line.id),null,!0))return!1}}if(!this.target_tree_line)for(let t=0;t<rooms2.data.length;t++)if(rooms2.data[t].warm_floors)for(let e=0;e<rooms2.data[t].warm_floors.length;e++){var r=rooms2.data[t].warm_floors[e].polygon;if(is_point_inside_polygon(s.center,r))return rooms2.data[t].warm_floors[e].props&&rooms2.data[t].warm_floors[e].props[this.name_object_lines]&&rooms2.data[t].warm_floors[e].props[this.name_object_lines].cable_warm_floor_id?warning.show("yellow",l10n.cabling_warm_floor_not_connect_same_floor,3e3):"warm_floor"===this.source_name&&this.source_id===rooms2.data[t].warm_floors[e].id?warning.show("yellow",l10n.cabling_warm_floor_not_connect_self,3e3):"warm_floor"===this.source_name&&warning.show("yellow",l10n.cabling_warm_floor_not_connect_two_floor,3e3),!1}let n;if(this.is_exist_tree(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s)):(n=new CableWarnFloor({type:this.get_type()}),i=n.addNode(t,this.source_id,s),n.defineColor(),cables_warm_floor.db.push(n)),this.is_exist_tree(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,!0))return!1;let s;if(this.is_exist_tree(i)&&!this.is_exist_tree(n))(s=this.get_tree(i)).addSpot(i,n,this.source_id,o),s.defineColor();else if(!this.is_exist_tree(i)&&this.is_exist_tree(n))(s=this.get_tree(n)).addSpot(n,i,o,this.source_id),s.defineColor();else if(this.is_exist_tree(i)&&this.is_exist_tree(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o),e):(t.union(e,o,this.source_id),t)}else(s=new CableWarnFloor({type:this.get_type()})).addSpot(i,n,this.source_id,o),s.defineColor(),cables_warm_floor.db.push(s);if(this.is_exist_tree(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)||this.set_tree_id(n,o,s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=e.props.center,this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),$("body").css("cursor","crosshair"),this.draw_reference_lines(e)}else warning.show("yellow",l10n.wire_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,$("body").css("cursor","crosshair"),!this.source_id)return;let s=!1;var i,n,o,l=this.get_item(this.source_id),r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)){if(!this.check_allow_connect(l,t))break;if(!this.check_allow_connect_lines(l,t,this.source_tree_line?this.get_tree_from_storage(this.source_tree_line.id):null,null))break;this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=t.props.center,this.select(t,this.target_id),$("body").css("cursor","pointer"),s=!0;break}}if(!s)for(let e=0;e<cables_warm_floor.db.length;e++){let t=cables_warm_floor.db[e];if(void 0===t.items[this.source_id]&&(r===t.type&&(!this.source_tree_line||this.source_tree_line.id!==t.id)&&this.check_allow_connect_lines(l,null,this.source_tree_line?this.get_tree_from_storage(this.source_tree_line.id):null,t))){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<8){this.target_tree_line=t.lines[e],mouse.end=a,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),s=!0;break}}if(s)break}}if(!s)for(let n=0;n<rooms2.data.length;n++)if(rooms2.data[n].warm_floors){let t=!1,i;for(let e=0;e<rooms2.data[n].warm_floors.length;e++)if(this.check_allow_connect(l,this.get_item(rooms2.data[n].warm_floors[e].id))){var h=rooms2.data[n].warm_floors[e].polygon;for(let e=0;e<h.length;e++){var g=e<h.length-1?LIB.projection(mouse.end,get_line(h[e],h[e+1])):LIB.projection(mouse.end,get_line(h[e],h[0]));if(get_distance(mouse.end,g)<10){t=!0,i=g;break}}if(!t&&is_point_inside_polygon(mouse.end,h)&&(t=!0,i=mouse.end),t){this.target_item={props:{name:"warm_floor",point_connection:i},id:rooms2.data[n].warm_floors[e].id,id_room:rooms2.data[n].warm_floors[e].id_room,paint:function(){}},this.target_id=rooms2.data[n].warm_floors[e].id,mouse.end=i,$("body").css("cursor","pointer"),s=!0;break}}if(s)break}if(!s&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var _ in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(_)&&(i=manager_lining.reference_lines[_],(n=LIB.projection(mouse.end,i))&&(o=get_distance(mouse.end,n))<t&&(t=o,e=n));mouse.end=e}!this.source_node_id&&"warm_floor"!==this.source_name||(this.color_line=this.get_color_by_type(r)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke()),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1,n=this.source_item;var s,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)){if(!this.check_allow_connect(n,t))break;n.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),n.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i){n.show();for(let e=0;e<cables_warm_floor.db.length;e++){let t=cables_warm_floor.db[e];if(void 0===t.items[this.source_id]&&(r===t.type&&this.check_allow_connect_lines(n,null,null,t))){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<5){this.target_tree_line=t.lines[e],mouse.end=a,n.props.center=mouse.end,this.target_point=mouse.end,n.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(s=manager_lining.reference_lines[h],(o=LIB.projection(mouse.end,s))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return i?!0:(n.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_color_by_type(e){let t="warm_floor_wire"===e?"#cc0000":"gray";return t}select(e,t){e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up")}unselect(e){var t=this.get_color_of_item(e,e.model.stroke_color),i=this.get_color_fill_of_item(e,e.model.filling);e.image.attr({stroke:t,fill:i}),this.is_node(e)&&this.change_size_node(e,"down")}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.width_changed=1,n.height_changed=1,n.group="warm_floor",n.plan={warm_floor:1};t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_tree_from_storage(e){return get_cable_warm_floor(e)}get_trees_from_storage(){return cables_warm_floor.db}set_tree_id(t,e,i,n){if(!super.set_tree_id(t,e,i,n))return!1;if(n=n||this.get_type(),"warm_floor"===this.get_name_item(t)){let e=get_warm_floor(this.get_id_item(t),!0);e.props||(e.props={}),e.props[this.name_object_lines]||(e.props[this.name_object_lines]={}),e.props.point_connection=t.props.point_connection,e.props[this.name_object_lines][this.names_line_id_by_tool[n]]=i}return!0}unset_tree_id(t,e,i,n){if(!super.unset_tree_id(t,e,i,n))return!1;if(i=i||this.get_type(),"warm_floor"===this.get_name_item(t)){let e=get_warm_floor(this.get_id_item(t),!0);e.props||(e.props={}),e.props[this.name_object_lines]||(e.props[this.name_object_lines]={}),delete e.props.point_connection,e.props[this.name_object_lines][this.names_line_id_by_tool[i]]=null}return!0}set_source_new_node(e,t){for(let n=0;n<rooms2.data.length;n++)if(rooms2.data[n].warm_floors){let t=!1,i;for(let e=0;e<rooms2.data[n].warm_floors.length;e++){var s=rooms2.data[n].warm_floors[e].polygon;for(let e=0;e<s.length;e++){var o=e<s.length-1?LIB.projection(mouse.end,get_line(s[e],s[e+1])):LIB.projection(mouse.end,get_line(s[e],s[0]));get_distance(mouse.end,o)<15&&(t=!0,i=o)}if(!t&&is_point_inside_polygon(mouse.end,s)&&(t=!0,i=mouse.end),t)return rooms2.data[n].warm_floors[e].props&&rooms2.data[n].warm_floors[e].props[this.name_object_lines]&&rooms2.data[n].warm_floors[e].props[this.name_object_lines].cable_warm_floor_id?void warning.show("yellow",l10n.cabling_warm_floor_not_connect_same_floor,3e3):(this.source_id=rooms2.data[n].warm_floors[e].id,this.source_point=i,this.source_item={props:{name:"warm_floor",point_connection:i},id:rooms2.data[n].warm_floors[e].id,id_room:rooms2.data[n].warm_floors[e].id_room,paint:function(){}},this.source_name="warm_floor",void this.draw_reference_lines())}}super.set_source_new_node(e,t)}}var cabling_warm_floor=new CablingWarnFloor;class PipeHeat extends TreeLines{constructor(e={}){super(e),this.type=e.type||"heat_pipe_hot",this.plan="radiators",this.name_human="Магистраль отопления",this.defineColor();let t=this;this.IMAGE=layers.pipes_heat.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}serialize(){return{id:this.id,connections:this.connections,items:this.items,type:this.type,points_connections:this.points_connections,length:this.length}}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":this.getLining().is_multi(e)?"multi":"waterspot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||this.isExistMovingItems()||!0===this.getLining().moving_point_line||(e=e.target.getAttribute("pipe_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("pipe_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.heat_pipe=this.id,pipes_heat.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.heat_pipe=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan)if(this.show(),t||(t=this.color,this.changeSizeNodes("down")),i){let e=$('[is_pipe_heat_line][pipe_id="'+this.id+'"][pipe_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_pipe_heat_line][pipe_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(e,t,i,n){var s=this.getPosition(i,n),o=s.s||this.getPoint(e,i),s=s.e||this.getPoint(t,n),l=i+"_"+n;t.start_item_tree=i;let r=this.IMAGE.line().attr({pipe_line_id:l,stroke:"transparent","stroke-width":8}),a=(r.plot(o.x,o.y,s.x,s.y),this.IMAGE.line().attr({pipe_id:this.id,pipe_line_id:l,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_pipe_heat_line:1,"stroke-dasharray":"8,4"}));a.plot(o.x,o.y,s.x,s.y),this.getLining().items_any_connections[this.getNameItem(e)]&&this.points_line.push(new ConnectPointLine({type:this.type,plan:this.plan,color:this.color,point:o,radius:2.5,line_id:l,tree_id:this.id,item_id:i,line_point_number:1,line:a})),this.getLining().items_any_connections[this.getNameItem(t)]&&this.points_line.push(new ConnectPointLine({type:this.type,plan:this.plan,color:this.color,point:s,radius:2.5,line_id:l,tree_id:this.id,item_id:n,line_point_number:2,line:a})),this.lines.push({line:get_line(o,s),id:this.id,line_id:l})}addNew(t){try{if(this.isNotEmptyTree(t)){let e=new PipeHeat({type:this.type});e.connections=t,e.points_connections=copy.object(this.points_connections),pipes_heat.db.push(e),e.updateData(),e.draw()}else this.unsetFromItems(Object.keys(t))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#pipe_heat_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("pipe_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<pipes_heat.db.length;e++)if(pipes_heat.db[e].id===t){pipes_heat.db.splice(e,1);break}}}class PipingHeat extends TreeLining{constructor(){super(),this.tools=["heat_pipe_hot","heat_pipe_cold"],this.name_object_lines="pipes_heat",this.plan="radiators",this.name_node="waterspot_node",this.radiators={radiator_bimetal:1,radiator_steel:1,radiator_iron:1,vertical_radiator:1,floor_convector:1,radiator_old:1},this.waterspots={heat_pipe_hot:{radiator_bimetal:1,radiator_steel:1,radiator_iron:1,vertical_radiator:1,floor_convector:1,radiator_collector:1,radiator_old:1,waterspot_node:1},heat_pipe_cold:{radiator_bimetal:1,radiator_steel:1,radiator_iron:1,vertical_radiator:1,floor_convector:1,radiator_collector:1,radiator_old:1,waterspot_node:1}},this.source_items={heat_pipe_hot:{radiator_bimetal:this.waterspots.heat_pipe_hot,radiator_steel:this.waterspots.heat_pipe_hot,radiator_iron:this.waterspots.heat_pipe_hot,vertical_radiator:this.waterspots.heat_pipe_hot,floor_convector:this.waterspots.heat_pipe_hot,radiator_collector:this.waterspots.heat_pipe_hot,radiator_old:this.waterspots.heat_pipe_hot,waterspot_node:this.waterspots.heat_pipe_hot},heat_pipe_cold:{radiator_bimetal:this.waterspots.heat_pipe_cold,radiator_steel:this.waterspots.heat_pipe_cold,radiator_iron:this.waterspots.heat_pipe_cold,vertical_radiator:this.waterspots.heat_pipe_cold,floor_convector:this.waterspots.heat_pipe_cold,radiator_collector:this.waterspots.heat_pipe_cold,radiator_old:this.waterspots.heat_pipe_cold,waterspot_node:this.waterspots.heat_pipe_cold}},this.names_line_id_by_tool={heat_pipe_hot:"heat_pipe_hot_id",heat_pipe_cold:"heat_pipe_cold_id"},this.multi_spots={radiator_collector:1},this.items_any_connections={radiator_bimetal:1,radiator_steel:1,radiator_iron:1,vertical_radiator:1,floor_convector:1,radiator_collector:1,radiator_old:1}}unselect_source_item(){super.unselect_source_item(),this.source_connect=null,this.target_connect=null}get_stroke(){return 1}check_source_select(e,t,i=!1){if(this.is_node(e)){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.piping_not_select_node,4e3),!1}return!0}check_allow_connect(i,n,e=null,s=null,o=!1){var l=this.get_type(),t=(this.get_name_item(i),this.get_name_item(n));if((e=e||this.get_id_item(i))===(s=s||this.get_id_item(n)))return!1;if(i&&n){if(i.props[this.name_object_lines]&&n.props[this.name_object_lines])for(var r in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(r)&&l===r&&i.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&n.props[this.name_object_lines][this.names_line_id_by_tool[r]]&&i.props[this.name_object_lines][this.names_line_id_by_tool[r]]===n.props[this.name_object_lines][this.names_line_id_by_tool[r]])return o&&warning.show("yellow",l10n.piping_already_connect_pipe,3e3),!1;let e=this.get_tree(i,!1,l),t=this.get_tree(n,!1,l);if(e&&t&&arrays_has_equals_elements(e.getMultiItemIds(),t.getMultiItemIds()))return o&&warning.show("yellow",l10n.piping_has_same_collector,3e3),!1}if(t===this.name_node){e=this.get_tree(n,!0);if(!e)return!1;if(e.type!==l)return o&&warning.show("yellow",l10n.piping_not_select_node,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){let t=this.get_tree_from_storage(this.source_tree_line.id);if(t){if(void 0!==t.items[s])return o&&warning.show("yellow",l10n.piping_already_connect_pipe+" (003)",4e3),!1;let e=this.get_tree(n,!1,l);if(e&&arrays_has_equals_elements(t.getMultiItemIds(),e.getMultiItemIds()))return o&&warning.show("yellow",l10n.piping_has_same_collector,3e3),!1}}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.waterspots.heat_pipe_hot[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.piping_not_join_pipe,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}let n;if(this.is_exist_tree(t)&&!this.is_multi(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s,this.source_connect)):(n=new PipeHeat({type:this.get_type()}),i=n.addNode(t,this.source_id,s,this.source_connect),n.defineColor(),pipes_heat.db.push(n)),this.is_exist_tree(t)&&!this.is_multi(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,!0))return!1;let s;if(!this.is_exist_tree(i)||this.is_multi(i)||this.is_exist_tree(n)&&!this.is_multi(n))if(this.is_exist_tree(i)&&!this.is_multi(i)||!this.is_exist_tree(n)||this.is_multi(n))if(this.is_exist_tree(i)&&this.is_exist_tree(n)&&!this.is_multi(i)&&!this.is_multi(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o,this.source_connect,this.target_connect),e):(t.union(e,o,this.source_id,this.target_connect,this.source_connect),t)}else(s=new PipeHeat({type:this.get_type()})).addSpot(i,n,this.source_id,o,this.source_connect,this.target_connect),s.defineColor(),pipes_heat.db.push(s);else(s=this.get_tree(n)).addSpot(n,i,o,this.source_id,this.target_connect,this.source_connect),s.defineColor();else(s=this.get_tree(i)).addSpot(i,n,this.source_id,o,this.source_connect,this.target_connect),s.defineColor();if(this.is_exist_tree(i)&&!this.is_multi(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)&&!this.is_multi(n)||this.set_tree_id(n,o,s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=this.get_point_in_mousedown(e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),$("body").css("cursor","crosshair"),this.draw_reference_lines(e)}else warning.show("yellow",l10n.piping_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_connect=null,this.target_tree_line=null,$("body").css("cursor","crosshair"),!this.source_id)return;let s=!1;var i,n,o,l=this.get_item(this.source_id),r=this.get_type();for(let e=0;e<items.db.length;e++){var a=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(a))&&(this.get_name_item(a)!==this.name_node||this.is_node(items.db[e]))){this.unselect(a);let t=!1,i,n=null;if(this.items_any_connections[this.get_name_item(a)]){var h=this.get_polygon(a);for(let e=0;e<h.length;e++){var g=e<h.length-1?get_line(h[e],h[e+1]):get_line(h[e],h[0]),_=LIB.projection(mouse.end,g);if(get_distance(mouse.end,_)<8){t=!0,i=_,n={i:e,d:+(get_distance(h[e],_)/get_distance(g.s,g.e)).toFixed(4)};break}}if(!t&&this.is_point_inside_item(mouse.end,a)){var d=get_line(mouse.end,this.source_point);for(let e=0;e<h.length;e++){var p=e<h.length-1?get_line(h[e],h[e+1]):get_line(h[e],h[0]),c=line_and_line_intersection(d,p);if(c){t=!0,i=c,n={i:e,d:+(get_distance(h[e],c)/get_distance(p.s,p.e)).toFixed(4)};break}}}}else(get_distance(mouse.end,a.props.center)<(this.get_name_item(a)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,a))&&(i=this.get_point(r,a,this.get_id_item(a)),t=!0);if(t){if(!this.check_allow_connect(l,a))break;this.target_item=a,this.target_id=this.get_id_item(a),mouse.end=i,this.target_connect=n,this.select(a,this.target_id),$("body").css("cursor","pointer"),s=!0;break}}}if(!s){let i=this.source_tree_line?this.get_tree_from_storage(this.source_tree_line.id):null;for(let e=0;e<pipes_heat.db.length;e++){let t=pipes_heat.db[e];if(void 0===t.items[this.source_id]&&(r===t.type&&(!i||i.id!==t.id)&&(!i||!arrays_has_equals_elements(i.getMultiItemIds(),t.getMultiItemIds()))&&(i||!arrays_has_equals_elements(this.get_all_multi_ids(l,r),t.getMultiItemIds())))){t.paint();for(let e=0;e<t.lines.length;e++){var A=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,A)<8){this.target_tree_line=t.lines[e],mouse.end=A,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),s=!0;break}}if(s)break}}}if(!s&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var u in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(u)&&(i=manager_lining.reference_lines[u],(n=LIB.projection(mouse.end,i))&&(o=get_distance(mouse.end,n))<t&&(t=o,e=n));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(r)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke()),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let n=!1,s=this.source_item;var i,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(!this.items_any_connections[this.get_name_item(t)])if(this.unselect(t),get_distance(mouse.end,t.props.center)<(this.get_name_item(t)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,t)){if(!this.check_allow_connect(s,t))break;s.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),s.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),n=!0;break}}if(!n){s.show();let i=this.get_tree(s,!0);for(let e=0;e<pipes_heat.db.length;e++){let t=pipes_heat.db[e];if(void 0===t.items[this.source_id]&&!(r!==t.type||i&&arrays_has_equals_elements(i.getMultiItemIds(),t.getMultiItemIds()))){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<5){this.target_tree_line=t.lines[e],mouse.end=a,s.props.center=mouse.end,this.target_point=mouse.end,s.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),n=!0;break}}if(n)break}}}if(!n&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(i=manager_lining.reference_lines[h],(o=LIB.projection(mouse.end,i))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return n?!0:(s.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_color_by_type(e){let t="gray";switch(e){case"heat_pipe_hot":t="#cc0000";break;case"heat_pipe_cold":t="#0000ff"}return t}select(e,t){e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up")}unselect(e){e.image.attr({stroke:this.get_color_of_item(e,e.model.stroke_color)}),this.is_node(e)&&this.change_size_node(e,"down")}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.filling="#fafafa",n.width=1,n.height=1,n.width_changed=1,n.height_changed=1,n.stroke_width=1,n.group="radiators",n.plan={radiators:1};t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_tree_from_storage(e){return get_pipe_heat(e)}get_trees_from_storage(){return pipes_heat.db}get_polygon(e){let t=[],i=0;e.getPolygon();var n=e.polygon;switch(this.get_name_item(e)){case"radiator_steel":i=Math.floor(.15*get_distance(n[1],n[2])),t=[n[0],n[1],LIB.pointOnLine(n[1],n[2],-i),LIB.pointOnLine(n[0],n[3],-i)];break;case"radiator_bimetal":i=Math.floor(.145*get_distance(n[1],n[2])),t=[n[0],n[1],LIB.pointOnLine(n[1],n[2],-i),LIB.pointOnLine(n[0],n[3],-i)];break;case"radiator_iron":i=Math.floor(.12*get_distance(n[1],n[2])),t=[n[0],n[1],LIB.pointOnLine(n[1],n[2],-i),LIB.pointOnLine(n[0],n[3],-i)];break;case"vertical_radiator":i=Math.floor(.2*get_distance(n[1],n[2])),t=[n[0],n[1],LIB.pointOnLine(n[1],n[2],-i),LIB.pointOnLine(n[0],n[3],-i)];break;case"floor_convector":i=Math.floor(.54*get_distance(n[1],n[2])),t=[LIB.pointOnLine(n[3],n[0],-i),LIB.pointOnLine(n[2],n[1],-i),n[2],n[3]];break;case"radiator_collector":t=[n[0],n[1]];break;default:t=[n[0],n[1],n[2],n[3]]}return t}}var piping_heat=new PipingHeat;class StripLight extends GraphLines{constructor(e={}){super(e),this.type=e.type||"recessed_strip",this.plan="light",this.plans=["light_connections"],this.name_human="Шины освещения",this.props={id:this.id,name:this.type,cable_id:e.cable_id||""},this.spots=e.spots||{},this.line_spots=e.line_spots||[],this.defineColor();let t=this;this.IMAGE=layers.stripes_light.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.IMAGE_2=layers.stripes_light_sizes.group(),this.IMAGE_3=layers.stripes_light_track_line_spots.group().on("mouseover",function(e){t.mouseover_track_line_spot(e)}).on("mouseleave",function(e){t.mouseleave_track_line_spot(e)}).on("mousedown",function(e){t.mousedown_track_line_spot(e)}),this.draw()}serialize(){return{id:this.id,matrix:this.matrix,vertexes:this.vertexes,items:this.items,type:this.type,length:this.length,spots:this.spots,line_spots:this.line_spots,cable_id:this.props.cable_id}}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":"electrospot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||!0===this.getLining().moving_point_line||(e=e.target.getAttribute("tree_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("tree_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.stripe_light=this.id,stripes_light.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.stripe_light=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}mouseover_track_line_spot(e){if(super.mouseover(e)&&!this.getLining().source_id&&!this.isExistMovingNodes()&&!0!==this.getLining().moving_point_line){let i=e.target.getAttribute("tree_line_id");if(i){let t=e.target.getAttribute("track_line_spot_index");if("none"===tool&&this.points_line.forEach(e=>{e.line_id===i&&e.index==t&&e.circle.attr({r:2.5})}),"eraser"===tool){let e=$('[is_track_line_spot][tree_id="'+this.id+'"][tree_line_id="'+i+'"][track_line_spot_index="'+t+'"]');e.attr({stroke:"crimson"}),this.points_line.forEach(e=>{e.line_id===i&&e.index==t&&e.circle.attr({fill:"crimson"})}),customCursor.overObject=!0}}}}mouseleave_track_line_spot(e){if(super.mouseleave(e)&&!this.getLining().source_id){let e=$('[is_track_line_spot][tree_id="'+this.id+'"]');e.attr({stroke:"#ffdc00"}),this.points_line.forEach(e=>{e.circle.attr({r:.9,fill:"#ffdc00"})}),$("body").css("cursor","default"),customCursor.overObject=!1}}mousedown_track_line_spot(e){var t;super.mousedown(e)&&e.target.getAttribute("tree_line_id")&&(t=e.target.getAttribute("track_line_spot_index"),"none"!==tool||3!==e.which&&2!==e.detail||(id.track_line_spot={id:this.id,index:t},hide2.contextmenu(),showContextmenu("#track_line_spot_contextmenu",e.clientX,e.clientY,canvas.position().top),this.points_line.forEach(e=>{e.circle.attr({r:.9,fill:"#ffdc00"})})),"eraser"===tool&&1===e.which&&(id.stripe_light=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteTrackLineSpotByIndex(t)))}paint(t,i){if(this.hide(),plan===this.plan||in_array(plan,this.plans))if(this.show(),t||(t=this.color,t="light_connections"!==plan||this.props.cable_id?t:"#5e88e3",this.changeSizeNodes("down")),i){let e=$('[is_strip_light_line][tree_id="'+this.id+'"][tree_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_strip_light_line][tree_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(n,s,o,l){var n=this.getPoint(n,o),r=this.getPoint(s,l),a=o+"_"+l;s.start_item_tree=o;let e=this.IMAGE.line().attr({tree_line_id:a,stroke:"transparent","stroke-width":8});e.plot(n.x,n.y,r.x,r.y);var l=get_parallel(n,r,1.5,"L"),s=get_parallel(n,r,1.5,"R"),o=get_projection(n,l),l=get_projection(r,l),h=get_projection(n,s),s=get_projection(r,s);if("recessed_strip"===this.type){let t="light_connections"!==plan||this.props.cable_id?this.getLining().get_color_by_type(this.type):"#5e88e3",e=svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:t})}),i=(e.untransform(),e.transform({rotation:get_line_angle(get_line(n,r))}),this.IMAGE.polygon().attr({tree_line_id:a,stroke:"transparent",fill:e}));i.plot([o,l,s,h])}let t=this.IMAGE.line().attr({tree_id:this.id,tree_line_id:a,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_strip_light_line:1}),i=("pendent_strip"===this.type&&t.attr({"stroke-dasharray":"4,2"}),t.plot(o.x,o.y,l.x,l.y),this.IMAGE.line().attr({tree_id:this.id,tree_line_id:a,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_strip_light_line:1}));"pendent_strip"===this.type&&i.attr({"stroke-dasharray":"4,2"}),i.plot(h.x,h.y,s.x,s.y);var g,_=get_line(n,r);for(g in this.lines.push({line:_,id:this.id,line_id:a}),this.spots)if(this.spots.hasOwnProperty(g)){let t=this.spots[g];var d=t.line_id.split("_");if(a==d[0]+"_"+d[1]||a==d[1]+"_"+d[0]){let e=get_item(g);e&&(e.props.center=LIB.pointOnLine(_.e,_.s,-(get_distance(_.e,_.s)*t.d)),d=Math.round(get_line_angle(_)),e.props.angle=d+180,e.draw())}}this.drawLineSpotsByLine(a),this.drawLineSizeByLine(a)}addNew(n,s,o,l){try{let i=[],t=[];for(let e=0;e<o.length;e++)i.push([]),t.push(s[+o[e]]);for(let t=0;t<i.length;t++)for(let e=0;e<i.length;e++)null!==n[+o[t]][+o[e]]?i[t].push({length:1}):i[t].push(null);let e=new StripLight({type:this.type});e.matrix=i,e.vertexes=t,e.spots=copy.object(l),stripes_light.db.push(e),e.updateData(),e.draw()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#stripes_light_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("tree_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<stripes_light.db.length;e++)if(stripes_light.db[e].id===t){stripes_light.db.splice(e,1);break}}deleteFull(t="",i=!1){try{for(var n in this.deleteCable(),this.erase(),this.items)if(this.items.hasOwnProperty(n)){let e=this.getItem(n);e?(this.unsetFromItem(e,n),e.paint(),"node"!==this.items[n]||!0===i&&t===n||e.delete({no_delete_lines:!0})):console.warn("plan "+this.plan+". No item "+this.items[n]+" "+n)}for(var s in this.spots)if(this.spots.hasOwnProperty(s)){let e=this.getItem(s);e?e.delete():console.warn("plan "+this.plan+". No item "+this.items[s]+" "+s)}this.deleteFromStorage(this.id)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}this.getLining().draw_box()}deleteByItem(i,e=!1){try{if(2===Object.keys(this.items).length)return this.deleteFull(i,e),!0;var n=this.getIndexVertex(i);if(!1===n)return!1;for(let t=0;t<this.matrix[n].length;t++)if(null!==this.matrix[n][t]&&(this.matrix[n][t]=null,this.matrix[t][n]=null,this.vertexes[t].id)){for(var s in this.spots)if(this.spots.hasOwnProperty(s)){var o=this.spots[s];if(o.line_id===i+"_"+this.vertexes[t].id||o.line_id===this.vertexes[t].id+"_"+i){let e=get_item(s);e&&(e.delete(),delete this.spots[s])}}for(let e=this.line_spots.length-1;0<=e;e--)this.line_spots[e].line_id!==i+"_"+this.vertexes[t].id&&this.line_spots[e].line_id!==this.vertexes[t].id+"_"+i||this.line_spots.splice(e,1)}var t=this.getSubMatrix();if(is_empty(t))return this.deleteFull(i,e),!0;if(this.deleteCable(),1===t.length)return this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box(),!0;for(let e=0;e<t.length;e++){var l=t[e];1===l.length?this.unsetFromItems([this.vertexes[+l[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,l,this.spots)}return this.erase(),this.deleteFromStorage(this.id),!0}catch(e){return send_error_js(e.name,e.message,e.stack),console.error(e),!1}}deleteByLine(e){if(window.contextmenu_tree_line_id=null,e){if(2===Object.keys(this.items).length)return this.deleteFull(),void project.localSave();var t=e.split("_");if(2!==t.length)return!1;e=this.getIndexVertex(t[0]);if(!1===e)return!1;var i,n=this.getIndexVertex(t[1]);if(!1===n)return!1;for(i in this.matrix[e][n]=null,this.matrix[n][e]=null,this.spots)if(this.spots.hasOwnProperty(i)){var s=this.spots[i];if(s.line_id===t[0]+"_"+t[1]||s.line_id===t[1]+"_"+t[0]){let e=get_item(i);e&&(e.delete(),delete this.spots[i])}}for(let e=this.line_spots.length-1;0<=e;e--)this.line_spots[e].line_id!==t[0]+"_"+t[1]&&this.line_spots[e].line_id!==t[1]+"_"+t[0]||this.line_spots.splice(e,1);this.deleteCable();var o=this.getSubMatrix();if(is_empty(o))return this.deleteFull(),project.localSave(),!0;if(1===o.length)this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box();else{for(let e=0;e<o.length;e++){var l=o[e];1===l.length?this.unsetFromItems([this.vertexes[+l[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,l,this.spots)}this.erase(),this.deleteFromStorage(this.id)}return project.localSave(),!0}}update_spots(){for(var i in this.spots)if(this.spots.hasOwnProperty(i)){let t=get_item(i);if(t){for(let e=0;e<this.lines.length;e++)LIB.isPointOnLine(t.props.center,this.lines[e].line)&&this.spots[i].line_id!==this.lines[e].line_id&&(this.spots[i].line_id=this.lines[e].line_id,this.spots[i].d=+(get_distance(this.lines[e].line.s,t.props.center)/get_distance(this.lines[e].line.s,this.lines[e].line.e)).toFixed(4));t.props.strip_light_id=this.id}}for(let t=this.line_spots.length-1;0<=t;t--)for(let e=0;e<this.lines.length;e++)LIB.isPointOnLine(this.line_spots[t].line.s,this.lines[e].line)&&LIB.isPointOnLine(this.line_spots[t].line.e,this.lines[e].line)&&this.line_spots[t].line_id!==this.lines[e].line_id&&(this.line_spots[t].line_id=this.lines[e].line_id,this.line_spots[t].d_s=+(get_distance(this.lines[e].line.s,this.line_spots[t].line.s)/get_distance(this.lines[e].line.s,this.lines[e].line.e)).toFixed(4),this.line_spots[t].d_e=+(get_distance(this.lines[e].line.s,this.line_spots[t].line.e)/get_distance(this.lines[e].line.s,this.lines[e].line.e)).toFixed(4));for(var e in this.spots){var t;this.spots.hasOwnProperty(e)&&(t=this.spots[e].line_id.split("_"),void 0!==this.items[t[0]]&&void 0!==this.items[t[1]]||delete this.spots[e])}for(let e=this.line_spots.length-1;0<=e;e--){var n=this.line_spots[e].line_id.split("_");void 0!==this.items[n[0]]&&void 0!==this.items[n[1]]||this.line_spots.splice(e,1)}}drawLineSizeByLine(n){let t;var i=n.split("_");for(let e=0;e<this.lines.length;e++)if(this.lines[e].line_id===i[0]+"_"+i[1]||this.lines[e].line_id===i[1]+"_"+i[0]){n=this.lines[e].line_id,t=this.lines[e].line;break}if(t){if(this.IMAGE_2&&this.IMAGE_2.node&&this.IMAGE_2.node.children)for(let e=this.IMAGE_2.node.children.length-1;0<=e;e--)$(this.IMAGE_2.node.children[e]).attr("tree_line_id")===n&&$(this.IMAGE_2.node.children[e]).remove();if("light_connections"!==plan){let i=[];for(var s in this.spots)if(this.spots.hasOwnProperty(s)){let e=this.spots[s];var o=e.line_id.split("_");n!==o[0]+"_"+o[1]&&n!==o[1]+"_"+o[0]||(o=get_item(s))&&i.push({point:o.props.center,distance:+get_distance(t.s,o.props.center).toFixed(2)})}if(0<i.length&&striping_light.selected_strip_light&&i.push({point:striping_light.selected_strip_light.point,distance:+get_distance(t.s,striping_light.selected_strip_light.point).toFixed(2)}),1<i.length){i.sort(function(e,t){return e.distance-t.distance});for(let t=0;t<i.length-1;t++){let e=Math.round(i[t+1].distance-i[t].distance);var l=LIB.center(i[t+1].point,i[t].point),r={1:10,2:14,3:18}[e.toString().length||3]||22;this.IMAGE_2.add(svg.rect(r,12).radius(2).attr({stroke:"#000000","stroke-width":0,fill:"#ffffff",opacity:.9,tree_line_id:n}).cx(l.x).cy(l.y)),this.IMAGE_2.add(svg.plain(e.toString()).attr({x:l.x,y:l.y}).font({family:"Arial",size:9,stroke:"#000000","stroke-width":.3,fill:"#000000",tree_line_id:n}).cx(l.x).cy(l.y))}}}}}drawLineSpotsByLine(o){let l;var t=o.split("_");for(let e=0;e<this.lines.length;e++)if(this.lines[e].line_id===t[0]+"_"+t[1]||this.lines[e].line_id===t[1]+"_"+t[0]){o=this.lines[e].line_id,l=this.lines[e].line;break}if(l){if(this.IMAGE_3&&this.IMAGE_3.node&&this.IMAGE_3.node.children)for(let e=this.IMAGE_3.node.children.length-1;0<=e;e--)$(this.IMAGE_3.node.children[e]).attr("tree_line_id")===o&&$(this.IMAGE_3.node.children[e]).remove();if("light_connections"!==plan)for(let s=0;s<this.line_spots.length;s++){var r=this.line_spots[s].line_id.split("_");if(o===r[0]+"_"+r[1]||o===r[1]+"_"+r[0]){this.line_spots[s].line.s=LIB.pointOnLine(l.e,l.s,-(get_distance(l.e,l.s)*this.line_spots[s].d_s)),this.line_spots[s].line.e=LIB.pointOnLine(l.e,l.s,-(get_distance(l.e,l.s)*this.line_spots[s].d_e));let e=this.IMAGE_3.line().attr({track_line_spot_index:s,tree_id:this.id,tree_line_id:o,stroke:"transparent","stroke-width":8}),t=(e.plot(this.line_spots[s].line.s.x,this.line_spots[s].line.s.y,this.line_spots[s].line.e.x,this.line_spots[s].line.e.y),this.IMAGE_3.line().attr({track_line_spot_index:s,tree_id:this.id,tree_line_id:o,stroke:"#ffdc00","stroke-width":2.2,is_track_line_spot:1}));t.plot(this.line_spots[s].line.s.x,this.line_spots[s].line.s.y,this.line_spots[s].line.e.x,this.line_spots[s].line.e.y);var r=get_parallel(this.line_spots[s].line.s,this.line_spots[s].line.e,1.5,"L"),a=get_parallel(this.line_spots[s].line.s,this.line_spots[s].line.e,1.5,"R"),h=get_projection(this.line_spots[s].line.s,r),r=get_projection(this.line_spots[s].line.e,r),g=get_projection(this.line_spots[s].line.s,a),a=get_projection(this.line_spots[s].line.e,a),_=get_line(LIB.pointOnLine(h,r,1),LIB.pointOnLine(r,h,1)),h=_.s,r=_.e,_=get_line(LIB.pointOnLine(g,a,1),LIB.pointOnLine(a,g,1)),g=_.s,a=_.e;let i=this.IMAGE_3.line().attr({track_line_spot_index:s,tree_id:this.id,tree_line_id:o,stroke:"#000","stroke-width":1}),n=(i.plot(h.x,h.y,r.x,r.y),this.IMAGE_3.line().attr({track_line_spot_index:s,tree_id:this.id,tree_line_id:o,stroke:"#000","stroke-width":1}));n.plot(g.x,g.y,a.x,a.y),this.points_line.push(new TrackPointLine({point:this.line_spots[s].line.s,line_id:o,tree_id:this.id,index:s,line:t,line_1:i,line_2:n,line_point_number:1})),this.points_line.push(new TrackPointLine({point:this.line_spots[s].line.e,line_id:o,tree_id:this.id,index:s,line:t,line_1:i,line_2:n,line_point_number:2}))}}}}deleteCable(){if(this.props.cable_id){let e=cabling.get_tree_from_storage(this.props.cable_id);e&&e.deleteByItem(this.props.id)}}deleteTrackLineSpotByIndex(e){void 0!==e&&(this.line_spots.splice(e,1),this.draw(),project.localSave())}}class StripingLight extends TreeLining{constructor(){super(),this.tools=["recessed_strip","surface_stripe","pendent_strip"],this.track_spots=["track_spot","track_pendent_spot","track_panel_spot"],this.name_object_lines="stripes_light",this.plan="light",this.plans=["light_connections"],this.name_node="electrospot_node",this.spots={recessed_strip:{electrospot_node:1},surface_stripe:{electrospot_node:1},pendent_strip:{electrospot_node:1}},this.source_items={recessed_strip:{electrospot_node:this.spots.recessed_strip},surface_stripe:{electrospot_node:this.spots.surface_stripe},pendent_strip:{electrospot_node:this.spots.pendent_strip}},this.names_line_id_by_tool={recessed_strip:"recessed_strip_id",surface_stripe:"surface_stripe_id",pendent_strip:"pendent_strip_id"},this.selected_strip_light=null,this.moved_strip_light=null,this.selected_strip_light_line=null}unselect_source_item(){super.unselect_source_item(),this.selected_strip_light=null,this.moved_strip_light=null,this.selected_strip_light_line=null}get_stroke(){return 1}check_source_select(e,t,i=!1){if(this.is_node(e)){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}return!0}check_is_same(e,t,i=!1){var n=this.get_type();if(e.props[this.name_object_lines]&&t.props[this.name_object_lines])for(var s in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(s)&&n===s&&e.props[this.name_object_lines][this.names_line_id_by_tool[s]]&&t.props[this.name_object_lines][this.names_line_id_by_tool[s]]&&e.props[this.name_object_lines][this.names_line_id_by_tool[s]]===t.props[this.name_object_lines][this.names_line_id_by_tool[s]])return i&&warning.show("yellow",l10n.cabling_already_connect_cable,3e3),!1;return!0}check_allow_connect(e,t,i=null,n=null,s=!1){var o=this.get_type(),l=(this.get_name_item(e),this.get_name_item(t));if((i=i||this.get_id_item(e))===(n=n||this.get_id_item(t)))return!1;if(l===this.name_node){e=this.get_tree(t,!0);if(!e)return!1;if(e.type!==o)return s&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){i=this.get_tree_from_storage(this.source_tree_line.id);if(i&&void 0!==i.items[n])return s&&warning.show("yellow",l10n.cabling_already_connect_cable,4e3),!1}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.spots.recessed_strip[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.cabling_not_join_cable,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}let n;if(this.is_exist_tree(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s)):(n=new StripLight({type:this.get_type()}),i=n.addNode(t,this.source_id,s),n.defineColor(),stripes_light.db.push(n)),this.is_exist_tree(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,!0))return!1;let s;if(this.is_exist_tree(i)&&!this.is_exist_tree(n))(s=this.get_tree(i)).addSpot(i,n,this.source_id,o),s.defineColor();else if(!this.is_exist_tree(i)&&this.is_exist_tree(n))(s=this.get_tree(n)).addSpot(n,i,o,this.source_id),s.defineColor();else if(this.is_exist_tree(i)&&this.is_exist_tree(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.id===t.id?(e.addSpot(n,i,o,this.source_id),e):e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o),e):(t.union(e,o,this.source_id),t)}else(s=new StripLight({type:this.get_type()})).addSpot(i,n,this.source_id,o),s.defineColor(),stripes_light.db.push(s);if(this.is_exist_tree(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)||this.set_tree_id(n,o,s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=this.get_point(this.get_type(),e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),this.draw_reference_lines(e)}else warning.show("yellow",l10n.cabling_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(e){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1;var n,s,o,t=this.get_item(this.source_id),l=this.get_type();for(let e=0;e<items.db.length;e++){var r=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(r)))if(this.get_name_item(r)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(r),get_distance(mouse.end,r.props.center||r.center)<(this.get_name_item(r)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,r)){if(!this.check_allow_connect(t,r))break;this.target_item=r,this.target_id=this.get_id_item(r),mouse.end=this.get_point(l,r,this.target_id),this.select(r,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i)for(let e=0;e<stripes_light.db.length;e++){let t=stripes_light.db[e];if(void 0===t.items[this.source_id]&&(l===t.type&&(!this.source_tree_line||this.source_tree_line.id!==t.id))){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<8){this.target_tree_line=t.lines[e],mouse.end=a,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(n=manager_lining.reference_lines[h],(s=LIB.projection(mouse.end,n))&&(o=get_distance(mouse.end,s))<t&&(t=o,e=s));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(l)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke(),l),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_track_line_spot(e){try{if(!this.selected_strip_light_line||!this.selected_strip_light_line.point_1)return;var i=this.get_tree_from_storage(this.selected_strip_light_line.id);if(!i)return;var n=this.selected_strip_light_line.line_id.split("_");let t;for(let e=0;e<i.lines.length;e++)if(i.lines[e].line_id===n[0]+"_"+n[1]||i.lines[e].line_id===n[1]+"_"+n[0]){t=i.lines[e].line;break}if(!t)return;var s=LIB.projection(mouse.end,t);if(!s)return;mouse.end=s,this.temporary_line_track_line.draw(this.selected_strip_light_line.point_1,mouse.end,"#ffdc00",2.2),this.selected_strip_light_line.point_2=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousedown_track_line_spot(){try{if(this.selected_strip_light_line.point_1&&this.selected_strip_light_line.point_2){var e=get_line(this.selected_strip_light_line.point_1,this.selected_strip_light_line.point_2);let t=this.get_tree_from_storage(striping_light.selected_strip_light_line.id);if(!t)return!1;var n=striping_light.selected_strip_light_line.line_id.split("_");let i;for(let e=0;e<t.lines.length;e++)if(t.lines[e].line_id===n[0]+"_"+n[1]||t.lines[e].line_id===n[1]+"_"+n[0]){i=t.lines[e].line;break}if(!i)return!1;5<get_distance(e.s,e.e)&&t.line_spots.push({line_id:striping_light.selected_strip_light_line.line_id,line:e,d_s:+(get_distance(i.s,e.s)/get_distance(i.s,i.e)).toFixed(4),d_e:+(get_distance(i.s,e.e)/get_distance(i.s,i.e)).toFixed(4)}),this.temporary_line_track_line.hide(),allow.draw=!1,project.localSave(),t.draw()}}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1,n=this.source_item;var s,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,t)){if(!this.check_is_same(n,t)||!this.check_allow_connect(n,t))break;n.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),n.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i){n.show();for(let e=0;e<stripes_light.db.length;e++){let t=stripes_light.db[e];if(void 0===t.items[this.source_id]&&r===t.type){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<5){this.target_tree_line=t.lines[e],mouse.end=a,n.props.center=mouse.end,this.target_point=mouse.end,n.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(s=manager_lining.reference_lines[h],(o=LIB.projection(mouse.end,s))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return i?!0:(n.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_color_by_type(e){return"#1453dc"}select(e,t){e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up")}unselect(e){e.image.attr({stroke:this.get_color_of_item(e,e.model.stroke_color)}),this.is_node(e)&&this.change_size_node(e,"down")}change_size_node(e,t){e&&("up"===t?e.image.attr({r:3,"stroke-width":1.5,fill:"#fafafa"}):e.image.attr({r:1.5,"stroke-width":1,fill:this.get_color_fill_of_item(e,e.props.filling)}),e.spot_node_size=t)}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.filling="#fafafa",n.width=3,n.height=3,n.width_changed=3,n.height_changed=3,n.stroke_width=1,n.group="lights",n.plan={light:1},n.anchor="ceiling";t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_tree_from_storage(e){return get_stripe_light(e)}get_trees_from_storage(){return stripes_light.db}set_spot_in_strip(t){if(null!==this.selected_strip_light){let e=this.get_tree_from_storage(this.selected_strip_light.id);e&&(e.spots[t.props.id]={name:t.props.name,line_id:this.selected_strip_light.line_id,d:this.selected_strip_light.d},t.props.strip_light_id=this.selected_strip_light.id,e.drawLineSizeByLine(this.selected_strip_light.line_id),this.selected_strip_light=null)}}set_moved_strip_light(e){let t=this.get_tree_from_storage(e.props.strip_light_id);if(t&&t.spots[e.props.id]){var i=t.spots[e.props.id].line_id.split("_");for(let e=0;e<t.lines.length;e++)if(t.lines[e].line_id===i[0]+"_"+i[1]||t.lines[e].line_id===i[1]+"_"+i[0]){this.moved_strip_light={line:t.lines[e].line};break}}}get_point_moved_strip_light(e){if(!this.moved_strip_light)return!1;e=LIB.projection(e,this.moved_strip_light.line);return e||!1}update_spot_strip_light(t){if(this.moved_strip_light){let e=this.get_tree_from_storage(t.props.strip_light_id);e&&e.spots[t.props.id]&&(e.spots[t.props.id].d=+(get_distance(this.moved_strip_light.line.s,t.props.center)/get_distance(this.moved_strip_light.line.s,this.moved_strip_light.line.e)).toFixed(4),this.moved_strip_light=null)}}update_line_size(t){if(t&&t.props&&t.props.name&&t.props.strip_light_id&&in_array(t.props.name,striping_light.track_spots)){let e=this.get_tree_from_storage(t.props.strip_light_id);e&&e.spots[t.props.id]&&e.drawLineSizeByLine(e.spots[t.props.id].line_id)}}delete_spot(t){if(t&&t.props&&t.props.name&&t.props.strip_light_id&&in_array(t.props.name,striping_light.track_spots)){let e=this.get_tree_from_storage(t.props.strip_light_id);var i;e&&e.spots[t.props.id]&&(i=e.spots[t.props.id].line_id,delete e.spots[t.props.id],e.drawLineSizeByLine(i))}}}var striping_light=new StripingLight;class LedStrip extends GraphLines{constructor(e={}){super(e),this.type=e.type||"led_strip",this.plan="light",this.plans=["light_connections"],this.name_human="Светодиодные ленты",this.props={id:this.id,name:this.type,cable_id:e.cable_id||""},this.defineColor();let t=this;this.IMAGE=layers.led_strips.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}serialize(){return{id:this.id,matrix:this.matrix,vertexes:this.vertexes,items:this.items,type:this.type,length:this.length,cable_id:this.props.cable_id}}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":"electrospot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||(e=e.target.getAttribute("tree_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("tree_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.led_strip=this.id,led_strips.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.led_strip=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan||in_array(plan,this.plans))if(this.show(),t||(t=this.color,t="light_connections"!==plan||this.props.cable_id?t:"#5e88e3",this.changeSizeNodes("down")),i){let e=$('[is_strip_led_line][tree_id="'+this.id+'"][tree_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_strip_led_line][tree_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(e,t,i,n){var e=this.getPoint(e,i),s=this.getPoint(t,n),n=i+"_"+n;t.start_item_tree=i;let o=this.IMAGE.line().attr({tree_line_id:n,stroke:"transparent","stroke-width":8}),l=(o.plot(e.x,e.y,s.x,s.y),this.IMAGE.line().attr({tree_id:this.id,tree_line_id:n,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_strip_led_line:1,"stroke-dasharray":"8,5,1,5,1,5,1,5","stroke-linecap":"round"}));l.plot(e.x,e.y,s.x,s.y);t=get_line(e,s);this.lines.push({line:t,id:this.id,line_id:n}),this.drawLineSizeByLine(n)}addNew(n,s,o,e){try{let i=[],t=[];for(let e=0;e<o.length;e++)i.push([]),t.push(s[+o[e]]);for(let t=0;t<i.length;t++)for(let e=0;e<i.length;e++)null!==n[+o[t]][+o[e]]?i[t].push({length:1}):i[t].push(null);let e=new LedStrip({type:this.type});e.matrix=i,e.vertexes=t,led_strips.db.push(e),e.updateData(),e.draw()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#led_strip_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("tree_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<led_strips.db.length;e++)if(led_strips.db[e].id===t){led_strips.db.splice(e,1);break}}deleteFull(t="",i=!1){try{for(var n in this.deleteCable(),this.erase(),this.items)if(this.items.hasOwnProperty(n)){let e=this.getItem(n);e?(this.unsetFromItem(e,n),e.paint(),"node"!==this.items[n]||!0===i&&t===n||e.delete({no_delete_lines:!0})):console.warn("plan "+this.plan+". No item "+this.items[n]+" "+n)}for(var s in this.spots)if(this.spots.hasOwnProperty(s)){let e=this.getItem(s);e?e.delete():console.warn("plan "+this.plan+". No item "+this.items[s]+" "+s)}this.deleteFromStorage(this.id)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}this.getLining().draw_box()}deleteByItem(t,e=!1){try{if(2===Object.keys(this.items).length)return this.deleteFull(t,e),!0;var i=this.getIndexVertex(t);if(!1===i)return!1;for(let e=0;e<this.matrix[i].length;e++)if(null!==this.matrix[i][e]&&(this.matrix[i][e]=null,this.matrix[e][i]=null,this.vertexes[e].id))for(var n in this.spots)if(this.spots.hasOwnProperty(n)){var s=this.spots[n];if(s.line_id===t+"_"+this.vertexes[e].id||s.line_id===this.vertexes[e].id+"_"+t){let e=get_item(n);e&&(e.delete(),delete this.spots[n])}}var o=this.getSubMatrix();if(is_empty(o))return this.deleteFull(t,e),!0;if(this.deleteCable(),1===o.length)return this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box(),!0;for(let e=0;e<o.length;e++){var l=o[e];1===l.length?this.unsetFromItems([this.vertexes[+l[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,l,this.spots)}return this.erase(),this.deleteFromStorage(this.id),!0}catch(e){return send_error_js(e.name,e.message,e.stack),console.error(e),!1}}deleteByLine(e){if(window.contextmenu_tree_line_id=null,e){if(2===Object.keys(this.items).length)return this.deleteFull(),void project.localSave();var t=e.split("_");if(2!==t.length)return!1;e=this.getIndexVertex(t[0]);if(!1===e)return!1;var i,n=this.getIndexVertex(t[1]);if(!1===n)return!1;for(i in this.matrix[e][n]=null,this.matrix[n][e]=null,this.spots)if(this.spots.hasOwnProperty(i)){var s=this.spots[i];if(s.line_id===t[0]+"_"+t[1]||s.line_id===t[1]+"_"+t[0]){let e=get_item(i);e&&(e.delete(),delete this.spots[i])}}this.deleteCable();var o=this.getSubMatrix();if(is_empty(o))return this.deleteFull(),project.localSave(),!0;if(1===o.length)this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box();else{for(let e=0;e<o.length;e++){var l=o[e];1===l.length?this.unsetFromItems([this.vertexes[+l[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,l,this.spots)}this.erase(),this.deleteFromStorage(this.id)}return project.localSave(),!0}}drawLineSizeByLine(t){let i;var n=t.split("_");for(let e=0;e<this.lines.length;e++)if(this.lines[e].line_id===n[0]+"_"+n[1]||this.lines[e].line_id===n[1]+"_"+n[0]){t=this.lines[e].line_id,i=this.lines[e].line;break}if(i){let e=Math.round(get_distance(i.s,i.e));var s=LIB.center(i.s,i.e),o={1:10,2:14,3:20}[e.toString().length||3]||22;this.IMAGE.add(svg.rect(o,12).radius(2).attr({stroke:"#000000","stroke-width":0,fill:"#ffffff",opacity:.95,tree_line_id:t}).cx(s.x).cy(s.y)),this.IMAGE.add(svg.plain(e.toString()).attr({x:s.x,y:s.y}).font({family:"Arial",size:9,stroke:"#161616","stroke-width":.4,fill:"#161616",tree_line_id:t}).cx(s.x).cy(s.y))}}deleteCable(){if(this.props.cable_id){let e=cabling.get_tree_from_storage(this.props.cable_id);e&&e.deleteByItem(this.props.id)}}}class StripingLed extends TreeLining{constructor(){super(),this.tools=["led_strip"],this.name_object_lines="led_strips",this.plan="light",this.plans=["light_connections"],this.name_node="electrospot_node",this.spots={led_strip:{electrospot_node:1}},this.source_items={led_strip:{electrospot_node:this.spots.led_strip}},this.names_line_id_by_tool={led_strip:"led_strip_id"}}get_stroke(){return 3}check_source_select(e,t,i=!1){if(this.is_node(e)){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}return!0}check_is_same(e,t,i=!1){var n=this.get_type();if(e.props[this.name_object_lines]&&t.props[this.name_object_lines])for(var s in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(s)&&n===s&&e.props[this.name_object_lines][this.names_line_id_by_tool[s]]&&t.props[this.name_object_lines][this.names_line_id_by_tool[s]]&&e.props[this.name_object_lines][this.names_line_id_by_tool[s]]===t.props[this.name_object_lines][this.names_line_id_by_tool[s]])return i&&warning.show("yellow",l10n.cabling_already_connect_cable,3e3),!1;return!0}check_allow_connect(e,t,i=null,n=null,s=!1){var o=this.get_type(),l=(this.get_name_item(e),this.get_name_item(t));if((i=i||this.get_id_item(e))===(n=n||this.get_id_item(t)))return!1;if(l===this.name_node){e=this.get_tree(t,!0);if(!e)return!1;if(e.type!==o)return s&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){i=this.get_tree_from_storage(this.source_tree_line.id);if(i&&void 0!==i.items[n])return s&&warning.show("yellow",l10n.cabling_already_connect_cable,4e3),!1}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.spots.led_strip[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.cabling_not_join_cable,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}let n;if(this.is_exist_tree(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s)):(n=new LedStrip({type:this.get_type()}),i=n.addNode(t,this.source_id,s),n.defineColor(),led_strips.db.push(n)),this.is_exist_tree(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,!0))return!1;let s;if(this.is_exist_tree(i)&&!this.is_exist_tree(n))(s=this.get_tree(i)).addSpot(i,n,this.source_id,o),s.defineColor();else if(!this.is_exist_tree(i)&&this.is_exist_tree(n))(s=this.get_tree(n)).addSpot(n,i,o,this.source_id),s.defineColor();else if(this.is_exist_tree(i)&&this.is_exist_tree(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.id===t.id?(e.addSpot(n,i,o,this.source_id),e):e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o),e):(t.union(e,o,this.source_id),t)}else(s=new LedStrip({type:this.get_type()})).addSpot(i,n,this.source_id,o),s.defineColor(),led_strips.db.push(s);if(this.is_exist_tree(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)||this.set_tree_id(n,o,s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=this.get_point(this.get_type(),e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),this.draw_reference_lines(e)}else warning.show("yellow",l10n.cabling_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(e){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1;var n,s,o,t=this.get_item(this.source_id),l=this.get_type();for(let e=0;e<items.db.length;e++){var r=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(r)))if(this.get_name_item(r)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(r),get_distance(mouse.end,r.props.center||r.center)<(this.get_name_item(r)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,r)){if(!this.check_allow_connect(t,r))break;this.target_item=r,this.target_id=this.get_id_item(r),mouse.end=this.get_point(l,r,this.target_id),this.select(r,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i)for(let e=0;e<led_strips.db.length;e++){let t=led_strips.db[e];if(void 0===t.items[this.source_id]&&(l===t.type&&(!this.source_tree_line||this.source_tree_line.id!==t.id))){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<8){this.target_tree_line=t.lines[e],mouse.end=a,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(n=manager_lining.reference_lines[h],(s=LIB.projection(mouse.end,n))&&(o=get_distance(mouse.end,s))<t&&(t=o,e=s));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(l)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke(),l),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1,n=this.source_item;var s,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,t)){if(!this.check_is_same(n,t)||!this.check_allow_connect(n,t))break;n.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),n.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i){n.show();for(let e=0;e<led_strips.db.length;e++){let t=led_strips.db[e];if(void 0===t.items[this.source_id]&&r===t.type){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<5){this.target_tree_line=t.lines[e],mouse.end=a,n.props.center=mouse.end,this.target_point=mouse.end,n.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(s=manager_lining.reference_lines[h],(o=LIB.projection(mouse.end,s))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return i?!0:(n.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_color_by_type(e){return"#325dc8"}select(e,t){e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up")}unselect(e){e.image.attr({stroke:this.get_color_of_item(e,e.model.stroke_color)}),this.is_node(e)&&this.change_size_node(e,"down")}change_size_node(e,t){e&&("up"===t?e.image.attr({r:3,"stroke-width":1.5,fill:"#fafafa"}):e.image.attr({r:1,"stroke-width":1,fill:this.get_color_fill_of_item(e,e.props.filling)}),e.spot_node_size=t)}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.filling="#fafafa",n.width=2,n.height=2,n.width_changed=2,n.height_changed=2,n.stroke_width=1,n.group="lights",n.plan={light:1};t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_tree_from_storage(e){return get_led_strip(e)}get_trees_from_storage(){return led_strips.db}get_point_moved_strip_light(e){if(!this.moved_strip_light)return!1;e=LIB.projection(e,this.moved_strip_light.line);return e||!1}}var striping_led=new StripingLed;class LineStrip extends GraphLines{constructor(e={}){super(e),this.type=e.type||"line_light",this.plan="light",this.plans=["light_connections"],this.name_human="Линейное освещение",this.props={id:this.id,name:this.type,cable_id:e.cable_id||""},this.defineColor();let t=this;this.IMAGE=layers.line_strips.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.draw()}serialize(){return{id:this.id,matrix:this.matrix,vertexes:this.vertexes,items:this.items,type:this.type,length:this.length,cable_id:this.props.cable_id}}getTypeItem(e){return this.getNameItem(e)===this.getLining().name_node?"node":"electrospot"}mouseover(e){!super.mouseover(e)||this.getLining().source_id||this.isExistMovingNodes()||(e=e.target.getAttribute("tree_line_id"))&&("none"===tool&&(this.paint("orange",e),this.changeSizeNodes("up")),"eraser"===tool&&(this.paint("crimson",e),customCursor.overObject=!0))}mouseleave(e){!super.mouseleave(e)||this.getLining().source_id||(this.paint(),customCursor.overObject=!1)}mousedown(e){var t;!super.mousedown(e)||(t=e.target.getAttribute("tree_line_id"))&&("none"!==tool||3!==e.which&&2!==e.detail||(id.line_strip=this.id,line_strips.paint(),this.contextmenu(event),this.paint("orange",t),this.changeSizeNodes("down")),"eraser"===tool&&1===e.which&&(id.line_strip=this.id,hide2.contextmenu(),customCursor.fire("eraserReaction",e),this.deleteByLine(t)))}paint(t,i){if(this.hide(),plan===this.plan||in_array(plan,this.plans))if(this.show(),t||(t=this.color,t="light_connections"!==plan||this.props.cable_id?t:"#efe186",this.changeSizeNodes("down")),i){let e=$('[is_strip_line_line][tree_id="'+this.id+'"][tree_line_id="'+i+'"]');e.attr({stroke:t})}else{let e=$('[is_strip_line_line][tree_id="'+this.id+'"]');e.attr({stroke:t})}}drawOneElement(e,t,i,n){var e=this.getPoint(e,i),s=this.getPoint(t,n),n=i+"_"+n;t.start_item_tree=i;let o=this.IMAGE.line().attr({tree_line_id:n,stroke:"transparent","stroke-width":8}),l=(o.plot(e.x,e.y,s.x,s.y),this.IMAGE.line().attr({tree_id:this.id,tree_line_id:n,stroke:this.color,"stroke-width":this.getLining().get_stroke(),is_strip_line_line:1}));l.plot(e.x,e.y,s.x,s.y);var t=get_parallel(e,s,1.5,"L"),i=get_parallel(e,s,1.5,"R"),r=get_projection(e,t),t=get_projection(s,t),a=get_projection(e,i),i=get_projection(s,i);let h=this.IMAGE.line().attr({tree_id:this.id,tree_line_id:n,stroke:"#000","stroke-width":1}),g=(h.plot(r.x,r.y,t.x,t.y),this.IMAGE.line().attr({tree_id:this.id,tree_line_id:n,stroke:"#000","stroke-width":1}));g.plot(a.x,a.y,i.x,i.y);r=get_line(e,s);this.lines.push({line:r,id:this.id,line_id:n}),this.drawLineSizeByLine(n)}addNew(n,s,o,e){try{let i=[],t=[];for(let e=0;e<o.length;e++)i.push([]),t.push(s[+o[e]]);for(let t=0;t<i.length;t++)for(let e=0;e<i.length;e++)null!==n[+o[t]][+o[e]]?i[t].push({length:1}):i[t].push(null);let e=new LineStrip({type:this.type});e.matrix=i,e.vertexes=t,line_strips.db.push(e),e.updateData(),e.draw()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}contextmenu(e){super.contextmenu(e),showContextmenu("#line_strip_contextmenu",e.clientX,e.clientY,canvas.position().top),e.target&&(window.contextmenu_tree_line_id=e.target.getAttribute("tree_line_id"),window.contextmenu_tree_line_point=LIB.point(e.clientX,e.clientY,"svg"))}deleteFromStorage(t){for(let e=0;e<line_strips.db.length;e++)if(line_strips.db[e].id===t){line_strips.db.splice(e,1);break}}deleteFull(t="",i=!1){try{for(var n in this.deleteCable(),this.erase(),this.items)if(this.items.hasOwnProperty(n)){let e=this.getItem(n);e?(this.unsetFromItem(e,n),e.paint(),"node"!==this.items[n]||!0===i&&t===n||e.delete({no_delete_lines:!0})):console.warn("plan "+this.plan+". No item "+this.items[n]+" "+n)}for(var s in this.spots)if(this.spots.hasOwnProperty(s)){let e=this.getItem(s);e?e.delete():console.warn("plan "+this.plan+". No item "+this.items[s]+" "+s)}this.deleteFromStorage(this.id)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}this.getLining().draw_box()}deleteByItem(t,e=!1){try{if(2===Object.keys(this.items).length)return this.deleteFull(t,e),!0;var i=this.getIndexVertex(t);if(!1===i)return!1;for(let e=0;e<this.matrix[i].length;e++)if(null!==this.matrix[i][e]&&(this.matrix[i][e]=null,this.matrix[e][i]=null,this.vertexes[e].id))for(var n in this.spots)if(this.spots.hasOwnProperty(n)){var s=this.spots[n];if(s.line_id===t+"_"+this.vertexes[e].id||s.line_id===this.vertexes[e].id+"_"+t){let e=get_item(n);e&&(e.delete(),delete this.spots[n])}}var o=this.getSubMatrix();if(is_empty(o))return this.deleteFull(t,e),!0;if(this.deleteCable(),1===o.length)return this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box(),!0;for(let e=0;e<o.length;e++){var l=o[e];1===l.length?this.unsetFromItems([this.vertexes[+l[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,l,this.spots)}return this.erase(),this.deleteFromStorage(this.id),!0}catch(e){return send_error_js(e.name,e.message,e.stack),console.error(e),!1}}deleteByLine(e){if(window.contextmenu_tree_line_id=null,e){if(2===Object.keys(this.items).length)return this.deleteFull(),void project.localSave();var t=e.split("_");if(2!==t.length)return!1;e=this.getIndexVertex(t[0]);if(!1===e)return!1;var i,n=this.getIndexVertex(t[1]);if(!1===n)return!1;for(i in this.matrix[e][n]=null,this.matrix[n][e]=null,this.spots)if(this.spots.hasOwnProperty(i)){var s=this.spots[i];if(s.line_id===t[0]+"_"+t[1]||s.line_id===t[1]+"_"+t[0]){let e=get_item(i);e&&(e.delete(),delete this.spots[i])}}this.deleteCable();var o=this.getSubMatrix();if(is_empty(o))return this.deleteFull(),project.localSave(),!0;if(1===o.length)this.rebuildGraph(),this.updateData(),this.draw(),this.getLining().draw_box();else{for(let e=0;e<o.length;e++){var l=o[e];1===l.length?this.unsetFromItems([this.vertexes[+l[0]]]):this.addNew(copy.object(this.matrix),this.vertexes,l,this.spots)}this.erase(),this.deleteFromStorage(this.id)}return project.localSave(),!0}}drawLineSizeByLine(t){let i;var n=t.split("_");for(let e=0;e<this.lines.length;e++)if(this.lines[e].line_id===n[0]+"_"+n[1]||this.lines[e].line_id===n[1]+"_"+n[0]){t=this.lines[e].line_id,i=this.lines[e].line;break}if(i){let e=Math.round(get_distance(i.s,i.e));var s=LIB.center(i.s,i.e),o={1:10,2:14,3:20}[e.toString().length||3]||22;this.IMAGE.add(svg.rect(o,12).radius(2).attr({stroke:"#000000","stroke-width":0,fill:"#ffffff",opacity:.95,tree_line_id:t}).cx(s.x).cy(s.y)),this.IMAGE.add(svg.plain(e.toString()).attr({x:s.x,y:s.y}).font({family:"Arial",size:9,stroke:"#161616","stroke-width":.4,fill:"#161616",tree_line_id:t}).cx(s.x).cy(s.y))}}deleteCable(){if(this.props.cable_id){let e=cabling.get_tree_from_storage(this.props.cable_id);e&&e.deleteByItem(this.props.id)}}}class StripingLine extends TreeLining{constructor(){super(),this.tools=["line_light"],this.name_object_lines="line_strips",this.plan="light",this.plans=["light_connections"],this.name_node="electrospot_node",this.spots={line_light:{electrospot_node:1}},this.source_items={line_light:{electrospot_node:this.spots.line_light}},this.names_line_id_by_tool={line_light:"line_light_id"}}get_stroke(){return 3}check_source_select(e,t,i=!1){if(this.is_node(e)){e=this.get_tree(e,!0);if(!e)return!1;if(e.type!==this.get_type())return i&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}return!0}check_is_same(e,t,i=!1){var n=this.get_type();if(e.props[this.name_object_lines]&&t.props[this.name_object_lines])for(var s in this.names_line_id_by_tool)if(this.names_line_id_by_tool.hasOwnProperty(s)&&n===s&&e.props[this.name_object_lines][this.names_line_id_by_tool[s]]&&t.props[this.name_object_lines][this.names_line_id_by_tool[s]]&&e.props[this.name_object_lines][this.names_line_id_by_tool[s]]===t.props[this.name_object_lines][this.names_line_id_by_tool[s]])return i&&warning.show("yellow",l10n.cabling_already_connect_cable,3e3),!1;return!0}check_allow_connect(e,t,i=null,n=null,s=!1){var o=this.get_type(),l=(this.get_name_item(e),this.get_name_item(t));if((i=i||this.get_id_item(e))===(n=n||this.get_id_item(t)))return!1;if(l===this.name_node){e=this.get_tree(t,!0);if(!e)return!1;if(e.type!==o)return s&&warning.show("yellow",l10n.cabling_not_select_node,4e3),!1}if(this.source_tree_line&&this.source_tree_line.id){i=this.get_tree_from_storage(this.source_tree_line.id);if(i&&void 0!==i.items[n])return s&&warning.show("yellow",l10n.cabling_already_connect_cable,4e3),!1}return!0}mousedown(e,o,s){try{if(!e&&this.source_id){let t=this.source_item,i;for(let e=0;e<items.db.length;e++){var l=this.get_name_item(items.db[e]);if(void 0!==this.spots.line_light[l])if(l!==this.name_node||this.is_node(items.db[e]))if(get_distance(s.center,items.db[e].props.center)<(l===this.name_node?6:12)||this.is_point_inside_item(s.center,items.db[e])){if(!this.check_connection_items(this.source_name,l))return warning.show("yellow",l10n.cabling_not_join_cable,3e3),!1;if(!this.check_allow_connect(t,items.db[e],this.source_id,this.get_id_item(items.db[e]),!0))return!1}}let n;if(this.is_exist_tree(t)?(n=this.get_tree(t),i=n.addNode(t,this.source_id,s)):(n=new LineStrip({type:this.get_type()}),i=n.addNode(t,this.source_id,s),n.defineColor(),line_strips.db.push(n)),this.is_exist_tree(t)||this.set_tree_id(t,this.source_id,n.id),this.set_tree_id(i,this.get_id_item(i),n.id,n.type),n.draw(),this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&n.type===e.type&&(e.insert(n,this.source_id,this.source_tree_line.line_id),e.draw(),n=null,n=e)}if(this.target_tree_line){let e=this.get_tree_from_storage(this.target_tree_line.id);void 0===e.items[this.get_id_item(i)]&&n.type===e.type&&(e.insert(n,this.get_id_item(i),this.target_tree_line.line_id),e.draw())}t.selected=!1,this.source_node_id=null,this.temporary_line.hide(),t.paint(),i.paint(),project.localSave(),this.erase_reference_lines()}else if(this.source_id)if(this.source_id&&this.check_connection_items(this.source_name,this.get_name_item(e))){let i=this.source_item,n=e;if(!this.check_allow_connect(i,n,!0))return!1;let s;if(this.is_exist_tree(i)&&!this.is_exist_tree(n))(s=this.get_tree(i)).addSpot(i,n,this.source_id,o),s.defineColor();else if(!this.is_exist_tree(i)&&this.is_exist_tree(n))(s=this.get_tree(n)).addSpot(n,i,o,this.source_id),s.defineColor();else if(this.is_exist_tree(i)&&this.is_exist_tree(n)){let e=this.get_tree(i),t=this.get_tree(n);s=e.id===t.id?(e.addSpot(n,i,o,this.source_id),e):e.getCountItems()>t.getCountItems()?(e.union(t,this.source_id,o),e):(t.union(e,o,this.source_id),t)}else(s=new LineStrip({type:this.get_type()})).addSpot(i,n,this.source_id,o),s.defineColor(),line_strips.db.push(s);if(this.is_exist_tree(i)||this.set_tree_id(i,this.source_id,s.id),this.is_exist_tree(n)||this.set_tree_id(n,o,s.id),s.draw(),this.source_node_id&&this.source_tree_line){let e=this.get_tree_from_storage(this.source_tree_line.id);void 0===e.items[this.source_id]&&s.type===e.type&&(e.insert(s,this.source_id,this.source_tree_line.line_id),e.draw())}i.selected=!1,this.source_node_id=null,this.temporary_line.hide(),i.paint(),n.paint(),project.localSave(),this.erase_reference_lines()}else this.source_id;else if(this.check_source_items(this.get_name_item(e))){if(!this.check_source_select(e,o,!0))return!1;var t;e.selected=!0,this.source_item=e,this.source_id=this.get_id_item(e),this.source_point=this.get_point(this.get_type(),e,this.source_id),this.source_name=this.get_name_item(e),this.color_line=this.get_color_by_type(this.get_type()),!this.source_item||(t=this.get_tree(this.source_item))&&t.color&&(this.color_line=t.color),e.paint(),this.draw_reference_lines(e)}else warning.show("yellow",l10n.cabling_not_source,3e3)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove(e){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1;var n,s,o,t=this.get_item(this.source_id),l=this.get_type();for(let e=0;e<items.db.length;e++){var r=items.db[e];if(this.check_connection_items(this.source_name,this.get_name_item(r)))if(this.get_name_item(r)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(r),get_distance(mouse.end,r.props.center||r.center)<(this.get_name_item(r)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,r)){if(!this.check_allow_connect(t,r))break;this.target_item=r,this.target_id=this.get_id_item(r),mouse.end=this.get_point(l,r,this.target_id),this.select(r,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i)for(let e=0;e<line_strips.db.length;e++){let t=line_strips.db[e];if(void 0===t.items[this.source_id]&&(l===t.type&&(!this.source_tree_line||this.source_tree_line.id!==t.id))){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<8){this.target_tree_line=t.lines[e],mouse.end=a,t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(n=manager_lining.reference_lines[h],(s=LIB.projection(mouse.end,n))&&(o=get_distance(mouse.end,s))<t&&(t=o,e=s));mouse.end=e}this.source_node_id&&(this.color_line=this.get_color_by_type(l)),this.temporary_line.draw(this.source_point,mouse.end,this.color_line,this.get_stroke(),l),this.target_point=mouse.end}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}}mousemove_node(){try{if(this.target_item=null,this.target_id=null,this.target_point=null,this.target_tree_line=null,!this.source_id)return;let i=!1,n=this.source_item;var s,o,l,r=this.get_type();for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.props.id!==this.source_id)if(this.check_connection_items(this.source_name,this.get_name_item(t)))if(this.get_name_item(t)!==this.name_node||this.is_node(items.db[e]))if(this.unselect(t),get_distance(mouse.end,t.props.center||t.center)<(this.get_name_item(t)===this.name_node?8:15)||this.is_point_inside_item(mouse.end,t)){if(!this.check_is_same(n,t)||!this.check_allow_connect(n,t))break;n.hide(),this.target_item=t,this.target_id=this.get_id_item(t),mouse.end=this.get_point(r,t,this.target_id),n.props.center=mouse.end,this.target_point=mouse.end,this.select(t,this.target_id),$("body").css("cursor","pointer"),i=!0;break}}if(!i){n.show();for(let e=0;e<line_strips.db.length;e++){let t=line_strips.db[e];if(void 0===t.items[this.source_id]&&r===t.type){t.paint();for(let e=0;e<t.lines.length;e++){var a=LIB.projection(mouse.end,t.lines[e].line);if(get_distance(mouse.end,a)<5){this.target_tree_line=t.lines[e],mouse.end=a,n.props.center=mouse.end,this.target_point=mouse.end,n.image.cx(this.target_point.x).cy(this.target_point.y),t.paint("orange",t.lines[e].line_id),$("body").css("cursor","pointer"),i=!0;break}}if(i)break}}}if(!i&&manager_lining.reference_lines){let e=mouse.end,t=11;for(var h in manager_lining.reference_lines)manager_lining.reference_lines.hasOwnProperty(h)&&(s=manager_lining.reference_lines[h],(o=LIB.projection(mouse.end,s))&&(l=get_distance(mouse.end,o))<t&&(t=l,e=o));mouse.end=e}return i?!0:(n.props.center=mouse.end,!1)}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}return!1}get_color_by_type(e){return"#ffdc00"}select(e,t){e.image.attr({stroke:"#ff8a0d"}),this.is_node(e)&&this.change_size_node(e,"up")}unselect(e){e.image.attr({stroke:this.get_color_of_item(e,e.model.stroke_color)}),this.is_node(e)&&this.change_size_node(e,"down")}change_size_node(e,t){e&&("up"===t?e.image.attr({r:3,"stroke-width":1.5,fill:"#fafafa",stroke:"#000"}):e.image.attr({r:1.5,"stroke-width":1,fill:"#000",stroke:"#000"}),e.spot_node_size=t)}add_node_item(e,t,i){let n=copy.object(tools[this.name_node]);n.filling="#000",n.width=3,n.height=3,n.width_changed=3,n.height_changed=3,n.stroke_width=1,n.group="lights",n.plan={light:1};t=new Item({settings:n,name:this.name_node,length:1,center:t,id_room:i,class_lining:this.constructor.name});return items.db.push(t),t}get_color_of_item(e,t){return t=this.is_node(e)?"#000":t}get_color_fill_of_item(e,t){return t=this.is_node(e)?"#000":t}get_tree_from_storage(e){return get_line_strip(e)}get_trees_from_storage(){return line_strips.db}get_point_moved_strip_light(e){if(!this.moved_strip_light)return!1;e=LIB.projection(e,this.moved_strip_light.line);return e||!1}}var striping_line=new StripingLine;class ConnectPointLine{constructor(e={}){this.type=e.type||"",this.plan=e.plan||"",this.color=e.color||"black",this.point=e.point,this.line_id=e.line_id,this.tree_id=e.tree_id,this.item_id=e.item_id,this.line=e.line,this.line_point_number=e.line_point_number,this.radius=e.radius||2;let t=this;this.IMAGE=layers.connect_point_line.group().draggable().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("beforedrag",function(e){t.beforedrag(e)}).on("dragmove",function(e){t.dragmove(e)}).on("dragend",function(e){t.dragend(e)}),this.circle=this.IMAGE.circle(2*this.radius).attr({fill:this.color}),this.circle.cx(this.point.x).cy(this.point.y)}erase(){this.IMAGE.clear()}show(){this.IMAGE.show()}hide(){this.IMAGE.hide()}mouseover(e){if(plan===this.plan&&"none"===tool&&isContextmenuHidden()&&e.target&&!this.getLining().source_id){let e=this.getLining().get_tree_from_storage(this.tree_id);e&&(e.isExistMovingNodes()||e.isExistMovingItems())||(this.circle.attr({r:this.radius+1}),$("body").css("cursor","pointer"))}}mouseleave(e){plan===this.plan&&"none"===tool&&isContextmenuHidden()&&e.target&&(this.circle.attr({r:this.radius}),$("body").css("cursor","default"))}beforedrag(e){"none"===tool&&(this.moving=!0,this.getLining().moving_point_line=!0,this.mStart=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.mEnd=copy.point(this.mStart))}dragmove(i){if(i.preventDefault(),!0===this.moving){this.circle.attr({r:this.radius+1}),this.mEnd=LIB.pointSVG(i.detail.event.clientX,i.detail.event.clientY);var i=this.getLining().get_item(this.item_id),n=this.getLining().get_polygon(i);let t=!1;for(let e=0;e<n.length;e++){var s=e<n.length-1?get_line(n[e],n[e+1]):get_line(n[e],n[0]),o=LIB.projection(this.mEnd,s);if(get_distance(this.mEnd,o)<5){t=!0,this.point_connection=o,this.target_connect={i:e,d:+(get_distance(n[e],o)/get_distance(s.s,s.e)).toFixed(4)};break}}if(!t)for(let e=0;e<n.length;e++){var l=e<n.length-1?get_line(n[e],n[e+1]):get_line(n[e],n[0]),r=LIB.projection(this.mEnd,l);if(get_distance(this.mEnd,r)<10){t=!0,this.point_connection=r,this.target_connect={i:e,d:+(get_distance(n[e],r)/get_distance(l.s,l.e)).toFixed(4)};break}}if(!t){let t=[],i={};for(let e=0;e<n.length;e++){var a,h=e<n.length-1?get_line(n[e],n[e+1]):get_line(n[e],n[0]),g=LIB.projection(this.mEnd,h);g&&(a=get_distance(this.mEnd,g),t.push(a),i[a]={projection:g,edge_index:e,edge_distance:get_distance(n[e],g)/get_distance(h.s,h.e)})}0<t.length&&(t.sort(function(e,t){return e-t}),this.point_connection=i[t[0]].projection,this.target_connect={i:i[t[0]].edge_index,d:i[t[0]].edge_distance})}this.point_connection||(this.point_connection=this.point),this.circle.cx(this.point_connection.x).cy(this.point_connection.y);let e={};e["x"+this.line_point_number]=this.point_connection.x,e["y"+this.line_point_number]=this.point_connection.y,this.line.attr(e),$("body").css("cursor","pointer")}}dragend(e){if(delete this.getLining().moving_point_line,delete this.mStart,delete this.mEnd,delete this.moving,delete this.point_connection,this.circle.attr({r:this.radius}),$("body").css("cursor","default"),this.target_connect){let e=this.getLining().get_tree_from_storage(this.tree_id);var t;e&&(t=this.line_id.split("_"),e.points_connections[t[0]+"-"+t[1]]?e.points_connections[t[0]+"-"+t[1]][1===this.line_point_number?0:1]=this.target_connect:e.points_connections[t[1]+"-"+t[0]]&&(e.points_connections[t[1]+"-"+t[0]][1===this.line_point_number?1:0]=this.target_connect),delete this.target_connect,e.draw(),project.localSave())}}getLining(){switch(this.plan){case"water":return piping;case"light_connections":return cabling;case"cables":return cabling_socket;case"conditioners":return"CableConditioner"===this.constructor.name?cabling_conditioner:piping_conditioner;case"warm_floor":return cabling_warm_floor;case"radiators":return piping_heat;case"light":return"LedStrip"===this.constructor.name?striping_led:"LineStrip"===this.constructor.name?striping_line:striping_light}return{}}}class TrackPointLine{constructor(e={}){this.plan="light",this.color="#ffdc00",this.point=e.point,this.line_id=e.line_id,this.tree_id=e.tree_id,this.index=e.index,this.line_point_number=e.line_point_number,this.line=e.line,this.line_1=e.line_1,this.line_2=e.line_2;let t=this;this.IMAGE=layers.stripes_light_track_line_spots.group().draggable().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("beforedrag",function(e){t.beforedrag(e)}).on("dragmove",function(e){t.dragmove(e)}).on("dragend",function(e){t.dragend(e)}),this.circle=this.IMAGE.circle(1.8).attr({fill:this.color}),this.circle.cx(this.point.x).cy(this.point.y)}erase(){this.IMAGE.clear()}show(){this.IMAGE.show()}hide(){this.IMAGE.hide()}mouseover(e){if(plan===this.plan&&"none"===tool&&isContextmenuHidden()&&e.target&&!striping_light.source_id){let e=striping_light.get_tree_from_storage(this.tree_id);e&&(e.isExistMovingNodes()||striping_light.moving_point_line)||(this.circle.attr({r:2.5}),$("body").css("cursor","pointer"))}}mouseleave(e){plan===this.plan&&"none"===tool&&isContextmenuHidden()&&e.target&&(this.circle.attr({r:.9}),$("body").css("cursor","default"))}beforedrag(e){"none"===tool&&(this.moving=!0,striping_light.moving_point_line=!0,this.mStart=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.mEnd=copy.point(this.mStart),delete this.point_moving)}dragmove(i){if(i.preventDefault(),!0===this.moving){this.circle.attr({r:2.5}),this.mEnd=LIB.pointSVG(i.detail.event.clientX,i.detail.event.clientY);var n=striping_light.get_tree_from_storage(this.tree_id);if(n){let t;var s=this.line_id.split("_");for(let e=0;e<n.lines.length;e++)if(n.lines[e].line_id===s[0]+"_"+s[1]||n.lines[e].line_id===s[1]+"_"+s[0]){t=n.lines[e].line;break}!t||(i=LIB.projection(this.mEnd,t))&&(this.point_moving=i)}this.point_moving||(this.point_moving=this.point),this.circle.cx(this.point_moving.x).cy(this.point_moving.y);let e={};e["x"+this.line_point_number]=this.point_moving.x,e["y"+this.line_point_number]=this.point_moving.y,this.line.attr(e);var i=get_line(get_point(this.line.attr("x1"),this.line.attr("y1")),get_point(this.line.attr("x2"),this.line.attr("y2"))),t=get_parallel(i.s,i.e,1.5,"L"),o=get_parallel(i.s,i.e,1.5,"R"),l=get_projection(i.s,t),t=get_projection(i.e,t),r=get_projection(i.s,o),i=get_projection(i.e,o),o=get_line(LIB.pointOnLine(l,t,1),LIB.pointOnLine(t,l,1)),l=o.s,t=o.e,o=get_line(LIB.pointOnLine(r,i,1),LIB.pointOnLine(i,r,1)),r=o.s,i=o.e;(e={})["x"+this.line_point_number]=l.x,e["y"+this.line_point_number]=l.y,2===this.line_point_number?(this.line_1.attr({x1:l.x,y1:l.y}),this.line_2.attr({x1:r.x,y1:r.y})):(this.line_1.attr({x2:t.x,y2:t.y}),this.line_2.attr({x2:i.x,y2:i.y})),$("body").css("cursor","pointer")}}dragend(e){if(delete striping_light.moving_point_line,delete this.mStart,delete this.mEnd,delete this.moving,this.circle.attr({r:.9}),$("body").css("cursor","default"),this.point_moving){let i=striping_light.get_tree_from_storage(this.tree_id);if(i){let t;var n=this.line_id.split("_");for(let e=0;e<i.lines.length;e++)if(i.lines[e].line_id===n[0]+"_"+n[1]||i.lines[e].line_id===n[1]+"_"+n[0]){t=i.lines[e].line;break}if(t){let e=i.line_spots[this.index];1===this.line_point_number?(e.s=this.point_moving,e.d_s=+(get_distance(t.s,e.s)/get_distance(t.s,t.e)).toFixed(4)):(e.e=this.point_moving,e.d_e=+(get_distance(t.s,e.e)/get_distance(t.s,t.e)).toFixed(4))}delete this.point_moving,i.draw(),project.localSave()}}}}class LightReferenceLines{constructor(){this.lines=[],this.image=null,this.tools=["lightspot","lightspot_surface"]}erase(){this.lines=[],null!==this.image&&(this.image.clear(),this.image=null)}build(t){this.erase(),null===this.image&&(this.image=layers.reference_lines.group());for(let e=0;e<items.db.length;e++){var i,n,s=items.db[e];in_array(s.props.name,this.tools)&&s.props.id!==t&&(n=get_big_line(n=get_line({x:(i=s.props.center).x-100,y:i.y},{x:i.x+100,y:i.y})),this.lines.push({line:n,item_id:s.props.id,point:i}),this.lines.push({line:get_rotation(n,i,90),item_id:s.props.id,point:i}))}}show(n){if(null!==this.image&&this.image.clear(),!allow.magnet)return n;let s=[];for(let i=0;i<this.lines.length;i++){var e=get_projection(n,this.lines[i].line);if(e){var t=get_distance(this.lines[i].point,e);if(!(300<t)){let t=!1;for(let e=0;e<s.length;e++)if(is_line_on_line(s[e].line,this.lines[i].line,.001)){t=!0;break}if(!(t||20<get_distance(n,e))){let e=this.image.line().attr({stroke:"red","stroke-width":.5,"stroke-dasharray":"3,3","stroke-opacity":.5});e.plot(this.lines[i].line.s.x,this.lines[i].line.s.y,this.lines[i].line.e.x,this.lines[i].line.e.y),s.push(this.lines[i])}}}}let i=5,o;if(1<s.length){for(let t=0;t<s.length;t++)for(let e=t+1;e<s.length;e++){var l,r=line_and_line_intersection(s[t].line,s[e].line);!r||(l=get_distance(n,r))<=i&&(o={intersection:r},i=l)}if(o)return copy.point(o.intersection)}i=10;let a;for(let e=0;e<s.length;e++){var h,g=LIB.projection(n,s[e].line);!g||(h=get_distance(n,g))<=i&&(a={projection:g,line:s[e]},i=h)}return a?copy.point(a.projection):n}get_close_item_point(t,i=null){let n=1e5,s=null;for(let e=0;e<items.db.length;e++){var o,l=items.db[e];in_array(l.props.name,this.tools)&&l.props.id!==i&&LIB.isPointOnLine(l.props.center,t)&&((o=get_distance(t.s,l.props.center))<=n&&(s=copy.point(l.props.center),n=o))}return s}build_center_room(i){if(this.erase(),i){null===this.image&&(this.image=layers.reference_lines.group());for(let t=0;t<i.points.length;t++)for(let e=t+1;e<i.points.length;e++){var n=get_line(i.points[t],i.points[e]);if(LIB.isPointOnLine(i.center,n)){let e=this.image.line().attr({stroke:"gray","stroke-width":.5,"stroke-dasharray":"3,3","stroke-opacity":.5});e.plot(n.s.x,n.s.y,n.e.x,n.e.y)}}}}}var light_reference_lines=new LightReferenceLines;function open_color_wrapper(e,t){t=t.replace("#","");let i=$(e);i&&(i.find('.color_wrapper .color[action="set_color"]').removeClass("active"),i.find('.color_wrapper .color[action="set_color"] .contextmenu_item_icon_circle[data-value="'+t+'"]').parent().addClass("active"))}class PDFUploader{constructor(){this.files=[],this.xhr,this.file_ix=0,this.filepos=0,this.chunksize=10485760,this.upload_started_time=0,this.upload_finished=!1,this.response=[],this.callback_error,this.callback_success,this.object_id=$("body").attr("data-object-id"),this.file_name="",this.total_size=0}isMobile(){return!!navigator.userAgent.match("/Android|Mobile|iPad|Dorothy|BlackBerry|Blazer|Bolt|samsung|Fennec|nokia|Symbian|Doris|GoBrowser|IEMobile|Iris|MIB|motorola|Minimo|NetFront|Opera Mini|SonyEricsson|Skyfire|TeaShark|Teleca|uZard/i")}isCompatible(){return!this.isMobile()&&!!(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.Uint8Array)}new_xhr(){let t=!1;if("undefined"!=typeof XMLHttpRequest)try{t=new XMLHttpRequest}catch(e){send_error_js(e.name,e.message,e.stack),t=!1}if(!t&&window.createRequest)try{t=window.createRequest}catch(e){send_error_js(e.name,e.message,e.stack),t=!1}return t}upload_api_getlinks(){this.upload_finished=!0,this.callback_success()}upload_files(){for(;!1===this.files[this.file_ix]&&this.file_ix<this.files.length;)this.file_ix++;if(this.file_ix>=this.files.length)this.upload_api_getlinks();else{const i=this.files[this.file_ix];let e=this.filepos+this.chunksize;e>i.size&&(e=i.size);const n=new FileReader,s=this;n.onloadend=function(e){var t;e.target.readyState===FileReader.DONE&&(t=(Math.random().toString()+Math.random().toString()+Math.random().toString()+Math.random().toString()).replace(/[.]/g,"").substring(0,40),e=e.target.result,e=new Blob(["--"+t+'\r\nContent-Disposition: form-data; name="upload"; filename="'+i.name+'"\r\nContent-Type: application/octet-stream\r\n\r\n',e,"\r\n--"+t+"--\r\n"],{type:"application/octet-stream"}),s.xhr=s.new_xhr(),0!==s.xhr.readyState&&4!==s.xhr.readyState||(s.xhr.open("POST","/setup/api/planner/pdf_file_api/?file="+encodeURIComponent(s.file_name)+"&object_id="+encodeURIComponent(s.object_id)+"&size="+encodeURIComponent(i.size),!0),s.xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),s.xhr.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.response);if("uploaded"===e.status?s.response[s.file_ix]=e:"error"===e.status&&(s.response[s.file_ix]=e,s.file_ix++),("uploaded"===e.status||"OK"===e.status)&&(s.filepos+=s.chunksize,s.filepos>=s.files[s.file_ix].size))for(s.filepos=0,s.file_ix++;!1===s.files[s.file_ix]&&s.file_ix<s.files.length;)s.file_ix++;let t=0;for(let e=0;e<s.files.length;e++)s.files[e]&&e<s.file_ix&&(t+=s.files[e].size);s.show_progress_fileapi(t+s.filepos),setTimeout(s.upload_files(),10)}},s.xhr.upload.onprogress=function(e){let t=0;for(let e=0;e<s.files.length;e++)s.files[e]&&e<s.file_ix&&(t+=s.files[e].size);e.lengthComputable&&s.show_progress_fileapi(t+s.filepos+e.loaded-200)},s.xhr.onerror=function(){this.abort(),setTimeout(s.upload_files,1e3)},s.xhr.send(e)))};var t=i.slice(s.filepos,e);n.readAsArrayBuffer(t)}}upload(){if(0<this.upload_started_time)this.callback_error();else if(0===this.files.length)this.callback_error();else{for(let e=0;e<this.files.length;e++)if(!this.files[e])return void this.callback_error();const e=new Date;this.upload_started_time=e.getTime(),this.show_progress_fileapi(0),this.upload_files()}}show_total_progress(e,t){const i=new Date;var n=i.getTime();let s=0,o=(0<t&&(s=e/t),"");var l,n=e/(n-this.upload_started_time+1)*1e3;if(0<n&&(o=Math.floor((t-e)/n),e=Math.floor(o/3600),o%=3600,n=Math.floor(o/60),l=o%=60,o="",0<e&&(o=e+" "+l10n.time_h+" "),(0<n||0<e)&&(o=o+n+" "+l10n.time_min+" "),0===e&&(o=o+""+l+" "+l10n.time_s)),0<=t){let e=l10n.pdf_saving+" - "+Math.floor(100*s)+"%";o&&(e+="<br>"+l10n.pdf_wait_time+" - "+o),$("#fog_message").html(e)}else this.upload_finished=!0}show_progress_fileapi(e){let t=0;for(let e=0;e<this.files.length;e++)this.files[e]&&(t+=this.files[e].size);this.total_size=t,this.show_total_progress(e,t)}size_hr(e){return e<1048576?Math.floor(e/1024)+" KB":Math.floor(e/1024/1024)+" MB"}}class Graph{constructor(){this.matrix={water_pipe:[],water_hot_pipe:[],drainage_pipe:[]},this.points=[],this.santeh={bathtub_acryl:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},bathtub_acryl_hydro:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},bathtub:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},shower_cabin:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},sink:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},hygienic_shower:{item_name:"waterspot_cold_hot",pipes:["water_pipe","water_hot_pipe"]},towel_dryer:{item_name:"waterspot_hot",pipes:["water_hot_pipe"]},toilet:{item_name:"waterspot_drainage_cold",pipes:["water_pipe","drainage_pipe"]},toilet_embedded:{item_name:"waterspot_drainage_cold",pipes:["water_pipe","drainage_pipe"]},kitchen_sink:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},dishwashing_machine:{item_name:"waterspot_drainage_cold",pipes:["water_pipe","drainage_pipe"]},washing_machine:{item_name:"waterspot_drainage_cold",pipes:["water_pipe","drainage_pipe"]},boiler_collector:{item_name:"waterspot_cold_hot",pipes:["water_pipe","water_hot_pipe"]},boiler:{item_name:"waterspot_cold_hot",pipes:["water_pipe","water_hot_pipe"]},sink_box:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},sink_corner:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},sink_table:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},sink_standalone:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},kitchen_sink_large:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},kitchen_sink_corner:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},bidet:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},shower_system:{item_name:"waterspot_cold_hot",pipes:["water_pipe","water_hot_pipe"]},bathtub_corner:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},bathtub_corner_hydro:{item_name:"waterspot_drainage_cold_hot",pipes:["water_pipe","water_hot_pipe","drainage_pipe"]},pissoir:{item_name:"waterspot_drainage_cold",pipes:["water_pipe","drainage_pipe"]},toilet_with_frame:{item_name:"waterspot_drainage_cold",pipes:["water_pipe","drainage_pipe"]}},this.IMAGE=layers.graph.group()}reset(){this.matrix={water_pipe:[],water_hot_pipe:[],drainage_pipe:[]},this.points=[],this.IMAGE.clear()}buildByLines(i,s=""){var n=this.matrix.water_pipe.length;if(0<n)for(let t=0;t<this.matrix.water_pipe.length;t++)for(let e=0;e<i.length;e++)this.matrix.water_pipe[t].push(null);for(let t=0;t<i.length;t++){if(this.points.push({point:{x:+i[t].x.toFixed(2),y:+i[t].y.toFixed(2)},type:"room",id_room:s}),this.matrix.water_pipe.push([]),0<n)for(let e=0;e<n;e++)this.matrix.water_pipe[this.matrix.water_pipe.length-1].push(null);for(let e=0;e<i.length;e++)e===t+1||e===t-1||0===t&&e===i.length-1||t===i.length-1&&0===e?this.matrix.water_pipe[this.matrix.water_pipe.length-1].push({length:+get_distance(i[t],i[e]).toFixed(2)}):this.matrix.water_pipe[this.matrix.water_pipe.length-1].push(null)}for(let i=0;i<this.matrix.water_pipe.length;i++)for(let t=i;t<this.matrix.water_pipe[i].length;t++)if(i!==t&&null===this.matrix.water_pipe[i][t]){let e=get_distance(this.points[i].point,this.points[t].point);0<e&&e<=15&&(this.matrix.water_pipe[i][t]={length:+e.toFixed(2)},this.matrix.water_pipe[t][i]={length:+e.toFixed(2)})}let o=[];for(let n=0;n<this.points.length;n++)if("room"===this.points[n].type&&this.points[n].id_room===s)for(let i=0;i<this.matrix.water_pipe.length;i++)for(let e=i;e<this.matrix.water_pipe[i].length;e++)if(null!==this.matrix.water_pipe[i][e]&&"room"===this.points[i].type&&"room"===this.points[e].type&&this.points[i].id_room===this.points[e].id_room&&this.points[i].id_room!==s){var t=get_line(this.points[i].point,this.points[e].point),l=LIB.projection(this.points[n].point,t);if(l&&!are_points_equal(l,this.points[i].point)&&!are_points_equal(l,this.points[e].point)){let t=!1;for(let e=0;e<this.points.length;e++)if("room"===this.points[e].type&&this.points[e].id_room!==s&&are_points_equal(l,this.points[e].id_room)){t=!0;break}t||LIB.distance(l,this.points[n].point)<=15&&o.push({point:l,id_room:this.points[i].id_room,index_point:n})}}for(let i=0;i<this.points.length;i++)if("room"===this.points[i].type&&this.points[i].id_room!==s)for(let t=0;t<this.matrix.water_pipe.length;t++)for(let e=t;e<this.matrix.water_pipe[t].length;e++)if(null!==this.matrix.water_pipe[t][e]&&"room"===this.points[t].type&&"room"===this.points[e].type&&this.points[t].id_room===this.points[e].id_room&&this.points[t].id_room===s){var r=get_line(this.points[t].point,this.points[e].point),a=LIB.projection(this.points[i].point,r);if(a&&!are_points_equal(a,this.points[t].point)&&!are_points_equal(a,this.points[e].point)){let t=!1;for(let e=0;e<this.points.length;e++)if("room"===this.points[e].type&&this.points[e].id_room!==s&&are_points_equal(a,this.points[e].id_room)){t=!0;break}t||LIB.distance(a,this.points[i].point)<=15&&o.push({point:a,id_room:s,index_point:i})}}if(0<o.length)for(let e=0;e<o.length;e++)this.addVertex(o[e].point,"room","","",o[e].id_room)&&(this.matrix.water_pipe[o[e].index_point][this.matrix.water_pipe.length-1]={length:+get_distance(this.points[o[e].index_point].point,o[e].point).toFixed(2)},this.matrix.water_pipe[this.matrix.water_pipe.length-1][o[e].index_point]={length:+get_distance(this.points[o[e].index_point].point,o[e].point).toFixed(2)})}addVertex(i,n,s,o="",l=""){for(let t=0;t<this.matrix.water_pipe.length;t++)for(let e=t;e<this.matrix.water_pipe[t].length;e++)if(null!==this.matrix.water_pipe[t][e]){var r=get_line(this.points[t].point,this.points[e].point);if(LIB.isPointOnLine(i,r))return this.points.push({point:{x:+i.x.toFixed(2),y:+i.y.toFixed(2)},type:n,id:s,name:o,id_room:l}),this.addRowCol(),this.matrix.water_pipe[t][e]=null,this.matrix.water_pipe[e][t]=null,this.matrix.water_pipe[t][this.matrix.water_pipe.length-1]={length:+get_distance(this.points[t].point,i).toFixed(2)},this.matrix.water_pipe[this.matrix.water_pipe.length-1][t]={length:+get_distance(this.points[t].point,i).toFixed(2)},this.matrix.water_pipe[e][this.matrix.water_pipe.length-1]={length:+get_distance(this.points[e].point,i).toFixed(2)},this.matrix.water_pipe[this.matrix.water_pipe.length-1][e]={length:+get_distance(this.points[e].point,i).toFixed(2)},!0}return!1}addRowCol(){this.matrix.water_pipe.push([]);var t=this.matrix.water_pipe.length-1;for(let e=0;e<this.matrix.water_pipe.length-1;e++)this.matrix.water_pipe[t].push(null);for(let e=0;e<this.matrix.water_pipe.length;e++)this.matrix.water_pipe[e].push(null)}printGraph(){let i="";for(let t=0;t<this.matrix.length;t++){for(let e=0;e<this.matrix[t].length;e++)i+="["+this.matrix[t][e]+"] ";i+="\n"}console.log(i)}drawGraph(i){this.IMAGE.clear();for(let t=0;t<this.matrix[i].length;t++)for(let e=t;e<this.matrix[i][t].length;e++){var n;null!==this.matrix[i][t][e]&&(n=get_line(this.points[t].point,this.points[e].point),this.IMAGE.line(n.s.x,n.s.y,n.e.x,n.e.y).attr({stroke:"red","stroke-width":2}))}for(let e=0;e<this.points.length;e++){var t,s=this.points[e];s.point&&("item"===s.type&&in_array(i,this.santeh[s.name].pipes)||"pillar"===s.type)&&(t="item"===s.type?"green":"blue",this.IMAGE.circle(3).cx(s.point.x).cy(s.point.y).attr({stroke:t,"stroke-width":1,fill:t}).draggable())}}drawPipesDrainage(l){let o=3;"water_pipe"===l&&(o=2);for(let s=0;s<this.matrix[l].length;s++)for(let n=s;n<this.matrix[l][s].length;n++)if(null!==this.matrix[l][s][n]){let i=get_room(this.points[s].id_room);if(i)for(let t=0;t<i.edges.length;t++)if(LIB.isPointOnLine(this.points[s].point_1,i.edges[t])){var r=get_parallel(i.edges[t].s,i.edges[t].e,o,"R");let e=get_projection(this.points[s].point_1,r);(is_point_inside_polygon(e,i.polygon)||LIB.isPointOnLine(e,i.edges[t])||0<=t-1&&LIB.isPointOnLine(e,i.edges[t-1])||t+1<i.edges.length&&LIB.isPointOnLine(e,i.edges[t+1]))&&(this.points[s].edge||(this.points[s].edge=copy.object(i.edges[t])),this.points[s].point_1=e),r=get_parallel(i.edges[t].s,i.edges[t].e,o,"L"),(is_point_inside_polygon(e=get_projection(this.points[s].point_1,r),i.polygon)||LIB.isPointOnLine(e,i.edges[t])||0<=t-1&&LIB.isPointOnLine(e,i.edges[t-1])||t+1<i.edges.length&&LIB.isPointOnLine(e,i.edges[t+1]))&&(this.points[s].edge||(this.points[s].edge=copy.object(i.edges[t])),this.points[s].point_1=e)}if(i=get_room(this.points[n].id_room))for(let t=0;t<i.edges.length;t++)if(LIB.isPointOnLine(this.points[n].point_1,i.edges[t])){var a=get_parallel(i.edges[t].s,i.edges[t].e,o,"R");let e=get_projection(this.points[n].point_1,a);(is_point_inside_polygon(e,i.polygon)||LIB.isPointOnLine(e,i.edges[t])||0<=t-1&&LIB.isPointOnLine(e,i.edges[t-1])||t+1<i.edges.length&&LIB.isPointOnLine(e,i.edges[t+1]))&&(this.points[n].edge||(this.points[n].edge=copy.object(i.edges[t])),this.points[n].point_1=e),a=get_parallel(i.edges[t].s,i.edges[t].e,o,"L"),(is_point_inside_polygon(e=get_projection(this.points[n].point_1,a),i.polygon)||LIB.isPointOnLine(e,i.edges[t])||0<=t-1&&LIB.isPointOnLine(e,i.edges[t-1])||t+1<i.edges.length&&LIB.isPointOnLine(e,i.edges[t+1]))&&(this.points[n].edge||(this.points[n].edge=copy.object(i.edges[t])),this.points[n].point_1=e)}}for(let i=0;i<this.points.length;i++){let t=[];for(let e=0;e<this.matrix[l][i].length;e++)if(null!==this.matrix[l][i][e]&&(t.push(e),2===t.length)){var n=get_line(this.points[i].point_1,this.points[t[0]].point_1),s=get_line(this.points[i].point_1,this.points[t[1]].point_1),h=get_two_lines_angle(n,s);if(90<h&&h<180){var h=get_big_line(n),n=get_big_line(s),s=get_projection(this.points[t[1]].point_1,h),h=get_projection(this.points[t[0]].point_1,n),n=get_distance(s,this.points[i].point_1),g=get_distance(h,this.points[i].point_1);let e;e=n<g?s:h,this.points[i].point_1=e}}}tool=l;for(let o=0;o<this.matrix[l].length;o++)for(let s=o;s<this.matrix[l][o].length;s++)if(null!==this.matrix[l][o][s]){let i,n;for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.index_graph===o&&("waterspot_node"===t.props.name&&t.props.pipes&&t.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[o].name]&&t.props.name===this.santeh[this.points[o].name].item_name)){i=t;break}}for(let e=0;e<items.db.length;e++){var _=items.db[e];if(_.index_graph===s&&("waterspot_node"===_.props.name&&_.props.pipes&&_.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[s].name]&&_.props.name===this.santeh[this.points[s].name].item_name)){n=_;break}}if(!i){if("item"===this.points[o].type&&in_array(l,this.santeh[this.points[o].name].pipes)){var d=this.santeh[this.points[o].name].item_name;let e=tools[d],t=(e.height_changed=e.height,e.width_changed=e.width,get_line_angle(this.points[o].edge));"R"===this.points[o].edge.room_side&&(t+=180),360===t&&(t=0),items.db.push(new Item({settings:e,name:d,edge:null,length:1,center:this.points[o].point_1,angle:t,projection:this.points[o].point,height:null,id_room:this.points[o].id_room,plan:"water"})),i=items.db[items.db.length-1]}else i=piping.add_node_item(l,this.points[o].point_1,this.points[o].id_room);i.index_graph=o}if(!n&&"item"===this.points[s].type&&in_array(l,this.santeh[this.points[s].name].pipes)){d=this.santeh[this.points[s].name].item_name;let e=tools[d],t=(e.height_changed=e.height,e.width_changed=e.width,get_line_angle(this.points[s].edge));"R"===this.points[s].edge.room_side&&(t+=180),360===t&&(t=0),items.db.push(new Item({settings:e,name:d,edge:null,length:1,center:this.points[s].point_1,angle:t,projection:this.points[s].point,height:null,id_room:this.points[s].id_room,plan:"water"})),(n=items.db[items.db.length-1]).index_graph=s}piping.source_point=i.props.center,piping.source_name=i.props.name,piping.source_id=i.props.id,piping.source_item=i,n?piping.mousedown(n,n.props.id):piping.mousedown(null,null,{center:this.points[s].point_1,id_room:this.points[s].id_room,index_graph:s})}for(let i=0;i<this.points.length;i++){var e=this.points[i];if("pillar"===e.type){e=get_pillar(e.id);if(e){let t;for(let e=0;e<items.db.length;e++){var p=items.db[e];if(p.index_graph===i&&("waterspot_node"===p.props.name&&p.props.pipes&&p.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[i].name]&&p.props.name===this.santeh[this.points[i].name].item_name)){t=p;break}}t&&(piping.source_point=t.props.center,piping.source_name=t.props.name,piping.source_id=t.props.id,piping.source_item=t,piping.mousedown(e,e.id))}}}tool="none"}drawPipesWaterCold(l){for(let i=0;i<this.points.length;i++){let t=[];for(let e=0;e<this.matrix[l][i].length;e++)if(null!==this.matrix[l][i][e]&&(t.push(e),2===t.length)){var n=get_line(this.points[i].point,this.points[t[0]].point),s=get_line(this.points[i].point,this.points[t[1]].point);if(90==get_two_lines_angle(n,s)){var o=get_parallel(n.s,n.e,2,"R"),n=get_parallel(n.s,n.e,2,"L"),r=get_parallel(s.s,s.e,2,"R"),s=get_parallel(s.s,s.e,2,"L"),a=get_projection(this.points[i].point,o),h=get_projection(this.points[i].point,n),g=get_projection(this.points[i].point,r),_=get_projection(this.points[i].point,s),d=get_room(this.points[i].id_room);if(d){let e=[];a&&!point_in_polygon(a,d.polygon)&&e.push(o),h&&!point_in_polygon(h,d.polygon)&&e.push(n),g&&!point_in_polygon(g,d.polygon)&&e.push(r),_&&!point_in_polygon(_,d.polygon)&&e.push(s),2!==e.length||(a=line_and_line_intersection(e[0],e[1]))&&(this.points[i].point_2=a)}}}}for(let s=0;s<this.matrix[l].length;s++)for(let n=s;n<this.matrix[l][s].length;n++)if(null!==this.matrix[l][s][n]){let i=get_room(this.points[s].id_room);if(i)for(let t=0;t<i.edges.length;t++)if(LIB.isPointOnLine(this.points[s].point_2,i.edges[t])){var p=get_parallel(i.edges[t].s,i.edges[t].e,2,"R");let e=get_projection(this.points[s].point_2,p);point_in_polygon(e,i.polygon)||(this.points[s].edge||(this.points[s].edge=copy.object(i.edges[t])),this.points[s].point_2=e),p=get_parallel(i.edges[t].s,i.edges[t].e,2,"L"),point_in_polygon(e=get_projection(this.points[s].point_2,p),i.polygon)||(this.points[s].edge||(this.points[s].edge=copy.object(i.edges[t])),this.points[s].point_2=e)}if(i=get_room(this.points[n].id_room))for(let t=0;t<i.edges.length;t++)if(LIB.isPointOnLine(this.points[n].point_2,i.edges[t])){var c=get_parallel(i.edges[t].s,i.edges[t].e,2,"R");let e=get_projection(this.points[n].point_2,c);point_in_polygon(e,i.polygon)||(this.points[n].edge||(this.points[n].edge=copy.object(i.edges[t])),this.points[n].point_2=e),c=get_parallel(i.edges[t].s,i.edges[t].e,2,"L"),point_in_polygon(e=get_projection(this.points[n].point_2,c),i.polygon)||(this.points[n].edge||(this.points[n].edge=copy.object(i.edges[t])),this.points[n].point_2=e)}}for(let i=0;i<this.points.length;i++){let t=[];for(let e=0;e<this.matrix[l][i].length;e++)if(null!==this.matrix[l][i][e]&&(t.push(e),2===t.length)){var A=get_line(this.points[i].point_2,this.points[t[0]].point_2),u=get_line(this.points[i].point_2,this.points[t[1]].point_2),w=get_two_lines_angle(A,u);if(90<w&&w<180||30<w&&w<90){var w=get_big_line(A),A=get_big_line(u),u=get_projection(this.points[t[1]].point_2,w),w=get_projection(this.points[t[0]].point_2,A),A=get_distance(u,this.points[i].point_2),m=get_distance(w,this.points[i].point_2);let e;e=A<m?u:w,this.points[i].point_2=e}}}tool=l;for(let o=0;o<this.matrix[l].length;o++)for(let s=o;s<this.matrix[l][o].length;s++)if(null!==this.matrix[l][o][s]){let i,n;for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.index_graph===o&&("waterspot_node"===t.props.name&&t.props.pipes&&t.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[o].name]&&t.props.name===this.santeh[this.points[o].name].item_name)){i=t;break}}for(let e=0;e<items.db.length;e++){var f=items.db[e];if(f.index_graph===s&&("waterspot_node"===f.props.name&&f.props.pipes&&f.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[s].name]&&f.props.name===this.santeh[this.points[s].name].item_name)){n=f;break}}if(!i){if("item"===this.points[o].type&&in_array(l,this.santeh[this.points[o].name].pipes)){var I=this.santeh[this.points[o].name].item_name;let e=tools[I],t=(e.height_changed=e.height,e.width_changed=e.width,get_line_angle(this.points[o].edge));"R"===this.points[o].edge.room_side&&(t+=180),360===t&&(t=0),items.db.push(new Item({settings:e,name:I,edge:null,length:1,center:this.points[o].point,angle:t,projection:this.points[o].point,height:null,id_room:this.points[o].id_room,plan:"water"})),i=items.db[items.db.length-1]}else i=piping.add_node_item(l,this.points[o].point_2,this.points[o].id_room);i.index_graph=o}if(!n&&"item"===this.points[s].type&&in_array(l,this.santeh[this.points[s].name].pipes)){I=this.santeh[this.points[s].name].item_name;let e=tools[I],t=(e.height_changed=e.height,e.width_changed=e.width,get_line_angle(this.points[s].edge));"R"===this.points[s].edge.room_side&&(t+=180),360===t&&(t=0),items.db.push(new Item({settings:e,name:I,edge:null,length:1,center:this.points[s].point,angle:t,projection:this.points[s].point,height:null,id_room:this.points[s].id_room,plan:"water"})),(n=items.db[items.db.length-1]).index_graph=s}piping.source_point=i.props.center,piping.source_name=i.props.name,piping.source_id=i.props.id,piping.source_item=i,n?piping.mousedown(n,n.props.id):piping.mousedown(null,null,{center:this.points[s].point_2,id_room:this.points[s].id_room,index_graph:s})}for(let i=0;i<this.points.length;i++){var e=this.points[i];if("pillar"===e.type){e=get_pillar(e.id);if(e){let t;for(let e=0;e<items.db.length;e++){var C=items.db[e];if(C.index_graph===i&&("waterspot_node"===C.props.name&&C.props.pipes&&C.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[i].name]&&C.props.name===this.santeh[this.points[i].name].item_name)){t=C;break}}t&&(piping.source_point=t.props.center,piping.source_name=t.props.name,piping.source_id=t.props.id,piping.source_item=t,piping.mousedown(e,e.id))}}}tool="none"}drawPipesWaterHot(l){for(let n=0;n<this.matrix[l].length;n++)for(let i=n;i<this.matrix[l][n].length;i++)if(null!==this.matrix[l][n][i]){let t=get_room(this.points[n].id_room);if(t)for(let e=0;e<t.edges.length;e++)!LIB.isPointOnLine(this.points[n].point,t.edges[e])||this.points[n].edge||(this.points[n].edge=copy.object(t.edges[e]));if(t=get_room(this.points[i].id_room))for(let e=0;e<t.edges.length;e++)!LIB.isPointOnLine(this.points[i].point,t.edges[e])||this.points[i].edge||(this.points[i].edge=copy.object(t.edges[e]))}tool=l;for(let o=0;o<this.matrix[l].length;o++)for(let s=o;s<this.matrix[l][o].length;s++)if(null!==this.matrix[l][o][s]){let i,n;for(let e=0;e<items.db.length;e++){var t=items.db[e];if(t.index_graph===o&&("waterspot_node"===t.props.name&&t.props.pipes&&t.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[o].name]&&t.props.name===this.santeh[this.points[o].name].item_name)){i=t;break}}for(let e=0;e<items.db.length;e++){var r=items.db[e];if(r.index_graph===s&&("waterspot_node"===r.props.name&&r.props.pipes&&r.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[s].name]&&r.props.name===this.santeh[this.points[s].name].item_name)){n=r;break}}if(!i){if("item"===this.points[o].type&&in_array(l,this.santeh[this.points[o].name].pipes)){var a=this.santeh[this.points[o].name].item_name;let e=tools[a],t=(e.height_changed=e.height,e.width_changed=e.width,get_line_angle(this.points[o].edge));"R"===this.points[o].edge.room_side&&(t+=180),360===t&&(t=0),items.db.push(new Item({settings:e,name:a,edge:null,length:1,center:this.points[o].point,angle:t,projection:this.points[o].point,height:null,id_room:this.points[o].id_room,plan:"water"})),i=items.db[items.db.length-1]}else i=piping.add_node_item(l,this.points[o].point,this.points[o].id_room);i.index_graph=o}if(!n&&"item"===this.points[s].type&&in_array(l,this.santeh[this.points[s].name].pipes)){a=this.santeh[this.points[s].name].item_name;let e=tools[a],t=(e.height_changed=e.height,e.width_changed=e.width,get_line_angle(this.points[s].edge));"R"===this.points[s].edge.room_side&&(t+=180),360===t&&(t=0),items.db.push(new Item({settings:e,name:a,edge:null,length:1,center:this.points[s].point,angle:t,projection:this.points[s].point,height:null,id_room:this.points[s].id_room,plan:"water"})),(n=items.db[items.db.length-1]).index_graph=s}piping.source_point=i.props.center,piping.source_name=i.props.name,piping.source_id=i.props.id,piping.source_item=i,n?piping.mousedown(n,n.props.id):piping.mousedown(null,null,{center:this.points[s].point,id_room:this.points[s].id_room,index_graph:s})}for(let i=0;i<this.points.length;i++){var e=this.points[i];if("pillar"===e.type){e=get_pillar(e.id);if(e){let t;for(let e=0;e<items.db.length;e++){var n=items.db[e];if(n.index_graph===i&&("waterspot_node"===n.props.name&&n.props.pipes&&n.props.pipes[piping.names_line_id_by_tool[l]]||this.santeh[this.points[i].name]&&n.props.name===this.santeh[this.points[i].name].item_name)){t=n;break}}t&&(piping.source_point=t.props.center,piping.source_name=t.props.name,piping.source_id=t.props.id,piping.source_item=t,piping.mousedown(e,e.id))}}}tool="none"}calc(a){let t=[],h={},g=[],e=500;for(let e=0;e<this.points.length;e++){var i=this.points[e];"item"===i.type&&in_array(a,this.santeh[i.name].pipes)&&(h[e]=!1),"pillar"===i.type&&(t.push(i.id),g.push(e))}if(0!==t.length){for(;g.length-t.length!==Object.keys(h).length&&0<e--;){let t=[],i=[],n=[];for(let e=0;e<g.length;e++)for(var _ in t[e]=1e7,i[e]=null,n[e]=this.dijkstra(a,g[e]),h)h.hasOwnProperty(_)&&!in_array(_,g)&&-1<n[e][_]&&n[e][_]<t[e]&&(i[e]=_,t[e]=n[e][_]);let s=1e7,o=null,l=[],r=null;for(let e=0;e<t.length;e++)t[e]<s&&(o=i[e],s=t[e],l=n[e],r=g[e]);if(null!==o){var d=this.getPath(a,r,+o,l);for(let e=0;e<d.length-1;e++)this.matrix[a][d[e]][d[e+1]].use=!0,this.matrix[a][d[e+1]][d[e]].use=!0;g.push(o)}}for(let t=0;t<this.matrix[a].length;t++)for(let e=t;e<this.matrix[a][t].length;e++)null===this.matrix[a][t][e]||this.matrix[a][t][e].use||(this.matrix[a][t][e]=null,this.matrix[a][e][t]=null);for(let i=0;i<this.matrix[a].length;i++)if("room"===this.points[i].type||"item"===this.points[i].type&&!in_array(a,this.santeh[this.points[i].name].pipes)){let t=[];for(let e=0;e<this.matrix[a][i].length;e++)null!==this.matrix[a][i][e]&&t.push(e);2===t.length&&is_line_on_line(get_line(this.points[i].point,this.points[t[0]].point),get_line(this.points[i].point,this.points[t[1]].point))&&(this.matrix[a][i][t[0]]=null,this.matrix[a][i][t[1]]=null,this.matrix[a][t[0]][i]=null,this.matrix[a][t[1]][i]=null,this.matrix[a][t[0]][t[1]]={length:+get_distance(this.points[t[0]].point,this.points[t[1]].point).toFixed(2)},this.matrix[a][t[1]][t[0]]={length:+get_distance(this.points[t[0]].point,this.points[t[1]].point).toFixed(2)})}}}dijkstra(t,i){var n=this.matrix[t].length;let s=[],o=[],l=1e7;for(let e=0;e<n;e++)s.push(-1),o.push(1e7);for(let e=s[i]=0;e<n;e++){for(let e=0;e<n;e++)this.matrix[t][i][e]&&-1===s[e]&&(o[e]=+Math.min(this.matrix[t][i][e].length+s[i],o[e]).toFixed(2));for(let e=0;e<n;e++)o[e]<l&&-1===s[e]&&(l=o[e],i=e);l=1e7,s[i]=o[i]}return s}getPath(t,e,i,n){let s=-1,o=[i],l=i,r=500;for(;s!==e&&0<r--;)for(let e=0;e<this.matrix[t].length;e++)if(this.matrix[t][l][e]&&+(n[l]-this.matrix[t][l][e].length).toFixed(2)==+n[e].toFixed(2)){s=e,l=e,o.push(l);break}return o=o.reverse()}}function build_santeh_pipes(){for(let e=0;e<window.graphs.length;e++)window.graphs[e].reset();window.graphs=[];let s={},o=[];for(let e=0;e<pillars.db.length;e++)"pillar_water"===pillars.db[e].role&&(pillars.db[e].id_room?(void 0===s[pillars.db[e].id_room]&&(s[pillars.db[e].id_room]=[]),s[pillars.db[e].id_room].push(pillars.db[e])):o.push(pillars.db[e]));if(!is_empty(s)||!is_empty(o)){for(let e=0;e<rooms2.data.length;e++)void 0!==s[rooms2.data[e].id]||in_array(rooms2.data[e].id,o)||(s[rooms2.data[e].id]=[]);let n=new Graph;for(var l in s)if(s.hasOwnProperty(l)){var r=get_room(l);if(r&&r.points){n.buildByLines(r.points,l);let o=[];for(let e=0;e<items.db.length;e++){var t=items.db[e];n.santeh[t.props.name]&&t.props.id_room===l&&o.push(t)}for(let t=0;t<o.length;t++){let s;for(let e=0;e<r.edges.length;e++){var i=LIB.projection(o[t].pbp,r.edges[e]);if(i&&LIB.distance(o[t].pbp,i)<1){s=i;break}}if(!s){var a=get_line(o[t].pbp,o[t].ptp);for(let e=0;e<r.edges.length;e++){var h=LIB.twoLinesIntersection(a,r.edges[e]);if(h){s=h;break}}}if(!s){let i=100,n=[get_center(o[t].p1,o[t].p2),get_center(o[t].p2,o[t].p3),get_center(o[t].p3,o[t].p4),get_center(o[t].p4,o[t].p1)];"bathtub_acryl"===o[t].props.name&&(n=[get_center(o[t].p4,o[t].p1)]);for(let t=0;t<r.edges.length;t++)for(let e=0;e<n.length;e++){var g,_=LIB.projection(n[e],r.edges[t]);!_||(g=LIB.distance(_,n[e]))<i&&(i=g,s=_)}}s&&(o[t].projection=s,n.addVertex(s,"item",o[t].props.id,o[t].props.name,l))}for(let e=0;e<s[l].length;e++){let t=s[l][e],i=1e4;for(let e=0;e<r.edges.length;e++){var d,p=LIB.projection(t.center,r.edges[e]);!p||(d=LIB.distance(p,t.center))<i&&(i=d,t.projection=p)}t.projection&&n.addVertex(t.projection,"pillar",t.id,"",l)}}}window.graphs.push(n);for(let s=0;s<o.length;s++)for(let n=0;n<window.graphs.length;n++){let i=[];for(let t=0;t<window.graphs[n].matrix.water_pipe.length;t++)for(let e=t;e<window.graphs[n].matrix.water_pipe[t].length;e++){var c;null!==window.graphs[n].matrix.water_pipe[t][e]&&(c=get_line(window.graphs[n].points[t].point,window.graphs[n].points[e].point),(c=LIB.projection(o[s].center,c))&&LIB.distance(c,o[s].center)<50&&i.push([c,window.graphs[n].points[t].id_room||""]))}if(0<i.length)for(let e=0;e<i.length;e++)window.graphs[n].addVertex(i[e][0],"pillar",o[s].id,"",i[e][1])}for(let e=pipes.db.length-1;0<=e;e--)pipes.db[e].deleteFull();for(let t=0;t<window.graphs.length;t++){window.graphs[t].matrix.water_hot_pipe=copy.object(window.graphs[t].matrix.water_pipe),window.graphs[t].matrix.drainage_pipe=copy.object(window.graphs[t].matrix.water_pipe),window.graphs[t].calc("drainage_pipe"),window.graphs[t].calc("water_pipe"),window.graphs[t].calc("water_hot_pipe");for(let e=0;e<window.graphs[t].points.length;e++)window.graphs[t].points[e].point_1=copy.object(window.graphs[t].points[e].point),window.graphs[t].points[e].point_2=copy.object(window.graphs[t].points[e].point);window.graphs[t].drawPipesDrainage("drainage_pipe"),window.graphs[t].drawPipesWaterCold("water_pipe"),window.graphs[t].drawPipesWaterHot("water_hot_pipe")}}}window.graphs=[],$(document).ready(function(e){union_l10n(),$(document).on("keyup","input[type='text']",function(e){13===e.keyCode&&this.id&&$("#"+this.id).trigger("change")});let t=0;function i(){console.warn(id.room,id.ceiling),hide2.contextmenu();let e=get_object(rooms2.data,id.room);if(e){let n=get_object(e.ceilings,id.ceiling);if(n){for(let i=0;i<comments.db.length;i++){let t=comments.db[i];for(let e=0;e<n.niches.length;e++){var s=n.niches[e];!0===s.exist&&t.id_item===s.id&&(t.delete(),i--)}}for(let e=0;e<n.niches.length;e++)n.niches[e];for(var t in n)"polygon"!==t&&"id"!==t&&delete n[t];n.exist=!1,e.draw()}}}function n(e){let t=get_item();var i=parseInt($(e).val()),n=(console.warn(i),t.props.over_floor.value=i,parseInt(t.model.over_floor.value));if(i===n){t.props.over_floor.display=!1;try{t.legend_over_floor.clear()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}warning.show("yellow",l10n.height_from_floor.replace("[x]",n+" см. "),3e3)}i!==n&&(t.props.over_floor.display=!0),$(e).val("").attr("placeholder",i),t.draw(),t.paint(),project.localSave()}function s(e,t,i){return e=Number(e),isNaN(e)&&(e=t),isNaN(e)||i<(e=e<t?t:e)&&(e=i),e}function o(){console.warn("new comment"),hide2.contextmenu(),items.paint();let e=get_item();var t,i;e.findComment(),e.comment?warning.show("yellow",l10n.comment_already_exist,3e3):e.comment||(hide2.contextmenu(),allow.pan=!1,comments.db.push(new Comment({s:e.props.center,text:"...",label:e.model.label,id_item:e.props.id,name_item:e.props.name,plan:plan})),selected.comment=comments.db.length-1,i=get_screen_point((t=comments.db[selected.comment]).center),showContextmenu("#comment_contextmenu",i.x,i.y,canvas.offset().top),$("#comment_input").val("").focus(),open_color_wrapper("#comment_contextmenu",t.color),selectedObject="comment")}function l(){hide2.contextmenu(),selected.item&&(selected.item.delete(),project.localSave(),selected.item=!1)}$("#wall_length_input").on("change",function(e){if(1===++t){hide2.contextmenu();let t=get_object(walls.db,id.wall);if(t){if(!t.free.s&&!t.free.e)return hide2.contextmenu(),t.paint(),void warning.show("yellow",l10n.wall_not_change_length,3e3);var i=get_line_length(t.EdgeO),n=get_line_length(t.EdgeI),i=Math.min(i,n);let e=parseInt($("#wall_length_input").val());if((e=e<10?10:e)>defs.wall.max_length)return n=l10n.wall_max_length+" - "+defs.wall.max_length+" см. ("+defs.wall.max_length/100+" м.)",void warning.show("yellow",n,5e3);n=e-i;if(0===t.walls_e.length){t.e=LIB.pointOnLine(t.s,t.e,n);for(let e=0;e<walls.db.length;e++){var s=walls.db[e];if("init"===plan){if("build"===s.label)continue;if("init_copy"===s.label)continue}if("build"===plan){if("break"===s.label)continue;if("init_copy"===s.label)continue}var o=line_and_line_intersection(get_line(t.c,t.e),s);!o||are_points_equal(o,s.s)||are_points_equal(o,s.e)||(t.e=copy.point(o),hide2.contextmenu(),warning.show("yellow",l10n.wall_not_cross_other_wall,3e3))}t.force_connection("e")}if(0!==t.walls_e.length){t.s=LIB.pointOnLine(t.e,t.s,n);for(let e=0;e<walls.db.length;e++){var l=walls.db[e];if("init"===plan){if("build"===l.label)continue;if("init_copy"===l.label)continue}if("build"===plan){if("break"===l.label)continue;if("init_copy"===l.label)continue}var r=line_and_line_intersection(get_line(t.c,t.s),l);!r||are_points_equal(r,l.s)||are_points_equal(r,l.e)||(t.s=copy.point(r),hide2.contextmenu(),warning.show("yellow",l10n.wall_not_cross_other_wall,3e3))}t.force_connection("s")}t.draw(),walls.draw(),t.paint("orange"),t.delete_rooms(),create_rooms(),project.localSave()}}setTimeout(function(){t=0},3e3)}),$("#wall_depth_input").on("change",function(){let i=get_object(walls.db,id.wall);if(i){if("init"===i.label||"break"===i.label)for(let e=0;e<sectors.db.length;e++){var n=sectors.db[e];if(is_point_inside_polygon(n.cp,i.polygon))return n.like_wall&&warning.show("yellow",l10n.wall_marked_break,3e3),n.like_wall||warning.show("yellow",l10n.wall_sector_marked_break,3e3),void hide2.contextmenu()}let t=parseInt($("#wall_depth_input").val());isNaN(t)&&(t=i.depth);var s=null!==i.links.s&&"pillar"===i.links.s.object,o=null!==i.links.e&&"pillar"===i.links.e.object;if(s||o){if(s){let e;var s=pillars.db[i.links.s.index],s=("T"===i.links.s.side&&(e=s.t_edge),"R"===i.links.s.side&&(e=s.r_edge),"B"===i.links.s.side&&(e=s.b_edge),"L"===i.links.s.side&&(e=s.l_edge),get_point_near_line_end(i.e,i.s,t/2,"R")),l=get_point_near_line_end(i.e,i.s,t/2,"L"),s=is_point_on_line(s,e),l=is_point_on_line(l,e);if(!s||!l)return hide2.contextmenu(),void warning.show("yellow",l10n.wall_not_change_depth,3e3)}if(o){let e;s=pillars.db[i.links.e.index],l=("T"===i.links.e.side&&(e=s.t_edge),"R"===i.links.e.side&&(e=s.r_edge),"B"===i.links.e.side&&(e=s.b_edge),"L"===i.links.e.side&&(e=s.l_edge),get_point_near_line_end(i.s,i.e,t/2,"L")),o=get_point_near_line_end(i.s,i.e,t/2,"R"),s=is_point_between_line_points(l,e),l=is_point_between_line_points(o,e);if(!s||!l)return hide2.contextmenu(),void warning.show("yellow",l10n.wall_not_change_depth,3e3)}}(t<8||9===t)&&(t=8,warning.show("yellow",l10n.wall_min_length+" - 8 см.",3e3)),t>defs.wall.max_depth&&(t=40,warning.show("yellow",l10n.wall_max_length+" - "+defs.wall.max_depth+" см.",3e3)),$(this).val("").attr("placeholder",t),i.depth=t,10<i.depth&&($(".contextmenu_item_align").removeClass("disabled"),"outer"===i.aligned&&(i.inner_depth=5,i.outer_depth=i.depth-5,$(".align .outer").addClass("active")),"center"===i.aligned&&(i.inner_depth=i.depth/2,i.outer_depth=i.depth/2,$(".align .center").addClass("active")),"inner"===i.aligned&&(i.outer_depth=5,i.inner_depth=i.depth-5,$(".align .right").addClass("active"))),i.delete_rooms(),8===i.depth&&($(".contextmenu_item_align").removeClass("disabled"),"outer"===i.aligned&&(i.inner_depth=3,i.outer_depth=5,$(".align .outer").addClass("active")),"center"===i.aligned&&(i.inner_depth=4,i.outer_depth=4,$(".align .center").addClass("active")),"inner"===i.aligned&&(i.inner_depth=5,i.outer_depth=3,$(".align .right").addClass("active"))),10===i.depth&&($(".align").removeClass("active"),$(".contextmenu_item_align").addClass("disabled"),i.aligned="center",i.inner_depth=i.depth/2,i.outer_depth=i.depth/2),i.draw(),project.draw(),i.paint("orange"),create_rooms(),project.localSave()}}),$('#wall-contextmenu [action="align_outer"]').on("click",function(){$(".align").removeClass("active");let e=get_object(walls.db,id.wall);e&&10<e.depth&&(e.inner_depth=5,e.delete_rooms(),$(this).addClass("active"),e.aligned="outer",e.outer_depth=e.depth-e.inner_depth,e.draw(),project.draw(),create_rooms(),project.localSave()),e&&8===e.depth&&(e.delete_rooms(),$(this).addClass("active"),e.aligned="outer",e.inner_depth=3,e.outer_depth=5,e.draw(),project.draw(),create_rooms(),project.localSave())}),$('#wall-contextmenu [action="align_center"]').on("click",function(){$(".align").removeClass("active");let e=get_object(walls.db,id.wall);e&&(10<e.depth||e.depth<10)&&(e.delete_rooms(),$(this).addClass("active"),e.aligned="center",e.outer_depth=e.depth/2,e.inner_depth=e.depth/2,e.draw(),project.draw(),create_rooms(),project.localSave())}),$('#wall-contextmenu [action="align_inner"]').on("click",function(){$(".align").removeClass("active");let e=get_object(walls.db,id.wall);e&&10<e.depth&&(e.outer_depth=5,e.delete_rooms(),$(this).addClass("active"),e.aligned="inner",e.inner_depth=e.depth-e.outer_depth,e.draw(),project.draw(),create_rooms(),project.localSave()),e&&8===e.depth&&(e.delete_rooms(),$(this).addClass("active"),e.aligned="inner",e.outer_depth=3,e.inner_depth=5,e.draw(),project.draw(),create_rooms(),project.localSave())}),$('#wall-contextmenu [action="split"]').on("click",function(){hide2.contextmenu();let t=walls.db[selected.wall],n=[];for(let e=0;e<walls.db.length;e++){var i=walls.db[e];"init_copy"!==i.label&&"break"!==i.label&&i.id!==t.id&&(null!==i.links.s&&i.links.s.id===t.id&&n.push({coords:i.s,id:t.id,end:"S"}),null!==i.links.e&&i.links.e.id===t.id&&n.push({coords:i.e,id:t.id,end:"E"}))}if(0!==n.length){for(let i=0;i<n.length;i++)for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if("init"!==plan||"build"!==e.label){if("build"===plan){if("init_copy"===e.label)continue;if("break"===e.label)continue}var s=n[i].coords;is_point_inside_polygon(s,e.polygon)&&(e.split(s),pillars.draw(),walls.calc())}}walls.paint(),walls.draw(),project.localSave()}if(0===n.length){var o=get_center(t.s,t.e);if("init"===t.label||"break"===t.label)for(let e=0;e<sectors.db.length;e++){var l=sectors.db[e];if(l&&l.polygon&&is_point_inside_polygon(o,l.polygon))return l.like_wall&&warning.show("yellow",l10n.wall_marked_break,3e3),void(l.like_wall||warning.show("yellow",l10n.wall_sector_marked_break,3e3))}for(let e=0;e<windows.db.length;e++){var r=windows.db[e];if(r&&r.polygon&&is_point_inside_polygon(o,r.polygon))return void warning.show("yellow",l10n.wall_window_prevent_divide,2e3)}for(let e=0;e<doors.db.length;e++){var a=doors.db[e];if(a&&a.polygon&&is_point_inside_polygon(o,a.polygon))return void warning.show("yellow",l10n.wall_door_prevent_divide,2e3)}t.split(o);let e=walls.db[walls.db.length-1];tool="wall_split",t.paint("orange"),e.paint("orange"),SplitMark.wall1=t,SplitMark.wall2=e,SplitMark.point=t.e,SplitMark.init(),t.draw(),e.draw(),t.delete_rooms,create_rooms(),project.localSave()}}),$('#wall-contextmenu [action="merge"]').on("click",function(){hide2.contextmenu();let i=walls.db[selected.wall],n=!1,s=!1;for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if(e.id!==i.id&&(e.label===i.label&&is_line_on_line(i,e)&&i.depth===e.depth))if(are_points_equal(i.s,e.s)){var o=e.find_objects();if(console.warn(o,"s"),!o){i.s=copy.point(e.e),e.delete(),walls.draw(),n=!0;break}s=!0}else if(are_points_equal(i.s,e.e)){o=e.find_objects();if(console.warn(o,"s"),!o){i.s=copy.point(e.s),e.delete(),walls.draw(),n=!0;break}s=!0}}let l=!1,r=!1;for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if(e.id!==i.id&&(e.label===i.label&&is_line_on_line(i,e)&&i.depth===e.depth))if(are_points_equal(i.e,e.s)){if(!e.find_objects()){l=!0,i.e=copy.point(e.e),e.delete(),pillars.draw(),walls.draw();break}r=!0}else if(are_points_equal(i.e,e.e)){if(!e.find_objects()){l=!0,i.e=copy.point(e.s),e.delete(),pillars.draw(),walls.draw();break}r=!0}}walls.draw(),s||r?warning.show("yellow",l10n.wall_not_allow_join,6e3):n||l?project.localSave():warning.show("yellow",l10n.wall_not_allow_join_2,3e3)}),$('#wall-contextmenu [action="move"]').on("click",function(){hide2.contextmenu();let t=get_object(walls.db,id.wall);if(t){if("build"===t.label)for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if("break"===i.label&&is_point_inside_polygon(t.c,i.polygon))return void warning.show("red",l10n.wall_break_not_move,3e3)}if("build"===t.label)for(let e=0;e<sectors.db.length;e++){var n=sectors.db[e];if(are_lines_equal(t,n))return void warning.show("red",l10n.wall_sector_break_not_move,3e3)}if("init"===t.label||"break"===t.label)for(let e=0;e<sectors.db.length;e++){var s=sectors.db[e];if(is_point_inside_polygon(s.cp,t.polygon))return s.like_wall&&warning.show("yellow",l10n.wall_marked_break,3e3),void(s.like_wall||warning.show("yellow",l10n.wall_sector_marked_break,3e3))}if("init"===t.label||"break"===t.label){for(let e=0;e<t.walls_s.length;e++)if("pillar"===t.walls_s[e].role)return void warning.show("yellow",l10n.wall_pillar_not_move,3e3);for(let e=0;e<t.walls_e.length;e++)if("pillar"===t.walls_e[e].role)return void warning.show("yellow",l10n.wall_pillar_not_move,3e3)}!1!==t.isDraggable()&&(selected.wallPoint="c",wallControls.fire("on",{wallPoint:selected.wallPoint}),t.get_linked_walls(),t.get_linked_pillars(),t.get_moving_limits(t.c))}}),$('#wall-contextmenu [action="delete"]').on("click",function(){$("body").css("cursor","default"),hide2.contextmenu(),drawing=!1,panning=!1;let t=get_object(walls.db,id.wall);if(t){for(let e=0;e<items.db.length;e++){var i=items.db[e];if("wall"===i.model.anchor&&i.props.projection){var n=is_point_on_line(i.props.projection,t.EdgeO),i=is_point_on_line(i.props.projection,t.EdgeI);if(n||i)return selected.wall=t,void open_actionmenu("remove_wall_objects")}}t.delete("complex"),wallControls.fire("off"),pillars.draw(),walls.draw(),create_rooms(),get_borders_links(),items.setParents,questions.bind(),project.localSave()}}),$("#confirm-wall-delete").on("click",function(){close_actionmenu(),selected.wall.delete("complex"),wallControls.fire("off"),pillars.draw(),walls.draw(),create_rooms(),get_borders_links(),items.setParents,questions.bind(),project.localSave()}),$("#select-wall-material").on("change",function(){var e=parseInt($("#select-wall-material option:selected").val());let t=get_object(walls.db,id.wall);t&&(1===e&&(t.material="pgb"),2===e&&(t.material="blocks"),3===e&&(t.material="bricks"),4===e&&(t.material="gypsum"),5===e&&(t.material="glass"),6===e&&(t.material="bar"),5!==e&&6!==e||(t.pattern=new WallPattern(t.material).addClass("CustomPattern")),t.init(),t.draw(),project.localSave())}),$('#delimiter-contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let t=get_object(rooms2.data,id.room);if(t){var i=get_object(t.delimiters,id.delimiter);if(i){if(1<t.delimiters.length)for(let e=0;e<t.delimiters.length;e++){var n=t.delimiters[e];if(n.id!==id.delimiter&&n.type===i.type){var s=is_point_between_line_points(n.s,i),n=is_point_between_line_points(n.e,i);if(s||n)return void warning.show("red",l10n.delimiter_is_reference,4e3)}}t.removeDelimiter(id.delimiter),project.localSave()}}}),$('#vent_hole_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu(),selected.wall&&id.ventHole&&(selected.wall.removeVentHole(id.ventHole),selected.wall.draw(),project.localSave())}),$('#pillar_contextmenu [action="change"]').on("click",function(){hide2.contextmenu(),selected.pillar&&("pillar"===selected.pillar.role||"gypsum"===selected.pillar.role?pillarControls.fire("on"):warning.show("yellow",l10n.action_not_available_this_object,4e3))}),$('#pillar_contextmenu [action="delete"]').on("click",function(){var e,t;hide2.contextmenu(),selected.pillar&&(e=selected.pillar.role,t=selected.pillar.plan,selected.pillar.delete(),"pillar"!==e&&"gypsum"!==e||(pillars.draw(),walls.draw(),create_rooms()),"pillar_air"===e&&("init"===t&&rooms1.create(),"build"===t&&rooms2.draw()),pillars.get("parents"),project.localSave())}),$('#sector_contextmenu [action="delete"]').on("click",function(){console.log("Удаляем сектор (contextmenu)"),hide2.contextmenu();let e=get_object(sectors.db,id.sector);e&&(e.delete(),project.draw(),project.localSave())}),$('#wall-sector-contextmenu [action="delete"]').on("click",function(){console.log("Удаляем полное выделение (contextmenu)"),hide2.contextmenu(),console.warn(id.wall);let t=get_object(walls.db,id.wall);if(t){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if("build"===i.label){var n=LIB.pointOnLine(i.e,i.s,-3),s=LIB.pointOnLine(i.s,i.e,-3),n=is_point_inside_polygon(n,t.polygon),o=is_point_inside_polygon(i.c,t.polygon),s=is_point_inside_polygon(s,t.polygon),i=is_point_inside_polygon(t.c,i.polygon);if(n||o||s||i)return void warning.show("red",l10n.wall_delete_mark,4e3)}}t.removeBreakLabel(),project.draw(),project.localSave()}}),$("#window_width_input").on("change",function(){$(".contextmenu").hide(50);let e=get_object(walls.db,id.wall),t=get_object(windows.db,id.window);var i,n,s=Number(parseInt($(this).val()));e&&t&&!isNaN(s)?(e.get_stops(t),n=get_distance(s_stop,e_stop),s<defs.window.min_width?warning.show("yellow",l10n.window_min_width+" - "+defs.window.min_width+" см.",3e3):s>defs.window.max_width?warning.show("yellow",l10n.window_max_width+" - "+defs.window.max_width+" см.",3e3):n<s?warning.show("yellow",l10n.window_max_width_2+" - "+n+" см. ",1e4):(t.width=s,t.draw(),n=get_distance(t.center,s_stop),i=get_distance(t.center,e_stop),n<t.width/2&&(n=Math.abs(n-t.width/2),t.center=LIB.pointOnLine(s_stop,t.center,n),t.draw()),i<t.width/2&&(n=Math.abs(i-t.width/2),t.center=LIB.pointOnLine(e_stop,t.center,n),t.draw()),$(this).val("").attr("placeholder",s),e.init(),project.localSave())):$(this).val("").attr("placeholder",t.width)}),$("#window_height_input").on("change",function(){let e=get_object(windows.db,id.window);var t;e&&(t=Number(parseInt($(this).val())),$(this).val(""),isNaN(t)?$(this).attr("placeholder",e.height):($(this).attr("placeholder",t),e.height=t),project.localSave())}),$("#window_floor_height_input").on("change",function(){let t=get_object(windows.db,id.window);if(t){let e=Number(parseInt($(this).val()));e<0&&(e=0),$(this).val(""),isNaN(e)?$(this).attr("placeholder",t.floor_height):($(this).attr("placeholder",e),t.floor_height=e),project.localSave()}}),$("#window_slopes_input").on("change",function(){let e=get_object(windows.db,id.window);var t;e&&(t=Number(parseInt($(this).val())),$(this).val(""),isNaN(t)?$(this).attr("placeholder",e.slopes):($(this).attr("placeholder",t),e.slopes=t),project.localSave())}),$('#window_contextmenu [action="move"]').on("click",function(){hide2.contextmenu(),windowControl.fire("on",selected.window)}),$('#window_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_object(windows.db,id.window);e&&("init"===plan?(e.delete(),project.draw(),project.localSave()):warning.show("red",l10n.action_not_available_this_plan,3e3),tool="window_moving")}),$("#windoor_window_width_input").on("change",function(){$(".contextmenu").hide(50);let e=get_object(walls.db,id.wall),t=get_object(windows.db,id.window);var i,n,s=Number(parseInt($(this).val()));e&&t&&!isNaN(s)?(e.get_stops(t),n=get_distance(s_stop,e_stop),s<defs.windoor.window.width_min?warning.show("yellow",l10n.windoor_window_min_width+" - "+defs.windoor.window.width_min+" см.",6e3):s>defs.windoor.window.width_max?warning.show("yellow",l10n.windoor_window_max_width+" - "+defs.windoor.window.width_max+" см.",6e3):s+t.door_width>n?warning.show("yellow",l10n.windoor_window_max_width_2.replace("[x1]",n-t.door_width+" см").replace("[x2]",n+" см"),1e4):(t.window_width=s,t.draw(),n=get_distance(t.center,s_stop),i=get_distance(t.center,e_stop),n<t.width/2&&(n=Math.abs(n-t.width/2),t.center=LIB.pointOnLine(s_stop,t.center,n),t.draw()),i<t.width/2&&(n=Math.abs(i-t.width/2),t.center=LIB.pointOnLine(e_stop,t.center,n),t.draw()),$(this).val("").attr("placeholder",s),e.init(),project.localSave())):$(this).val("").attr("placeholder",t.window_width)}),$("#windoor_window_height_input").on("change",function(){let e=get_object(windows.db,id.window);var t;e&&(t=Number(parseInt($(this).val())),$(this).val(""),isNaN(t)?$(this).attr("placeholder",e.window_height):($(this).attr("placeholder",t),e.window_height=t,project.localSave()))}),$("#windoor_door_width_input").on("change",function(){$(".contextmenu").hide(50);let e=get_object(walls.db,id.wall),t=get_object(windows.db,id.window);var i,n,s=Number(parseInt($(this).val()));e&&t&&!isNaN(s)?(e.get_stops(t),n=get_distance(s_stop,e_stop),s<defs.windoor.door.width_min?warning.show("yellow",l10n.windoor_door_min_width+" - "+defs.windoor.door.width_min+" см.",6e3):s>defs.windoor.door.width_max?warning.show("yellow",l10n.windoor_door_max_width+" - "+defs.windoor.door.width_max+" см.",6e3):s+t.window_width>n?warning.show("yellow",l10n.windoor_door_max_width_2.replace("[x1]",n-t.window_width+" см").replace("[x2]",n+" см"),1e4):(t.door_width=s,t.draw(),n=get_distance(t.center,s_stop),i=get_distance(t.center,e_stop),n<t.width/2&&(n=Math.abs(n-t.width/2),t.center=LIB.pointOnLine(s_stop,t.center,n),t.draw()),i<t.width/2&&(n=Math.abs(i-t.width/2),t.center=LIB.pointOnLine(e_stop,t.center,n),t.draw()),$(this).attr("placeholder",s),e.init(),project.localSave())):$(this).attr("placeholder",t.door_width)}),$("#windoor_door_height_input").on("change",function(){let e=get_object(windows.db,id.window);var t;e&&(t=Number(parseInt($(this).val())),$(this).val(""),isNaN(t)?$(this).attr("placeholder",e.door_height):($(this).attr("placeholder",t),e.door_height=t,project.localSave()))}),$("#windoor_slopes_input").on("change",function(){let e=get_object(windows.db,id.window);var t;e&&(t=Number(parseInt($(this).val())),$(this).val(""),isNaN(t)?$(this).attr("placeholder",e.slopes):($(this).attr("placeholder",t),e.slopes=t,project.localSave()))}),$('#windoor_contextmenu [action="rotate"]').on("click",function(){selected.window&&(selected.window.rotate(),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){project.localSave()},1e3))}),$('#windoor_contextmenu [action="move"]').on("click",function(){hide2.contextmenu(),windowControl.fire("on",selected.window)}),$('#windoor_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_object(windows.db,id.window);e&&("init"===plan?(e.delete(),project.draw(),project.localSave()):warning.show("red",l10n.action_not_available_this_plan,3e3))}),$('#window_contextmenu_v2 [action="delete"]').on("click",function(){hide2.contextmenu();let t=get_object(windows.db,id.window);if(t){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if("build"===i.label&&is_point_inside_polygon(t.center,i.polygon))return void warning.show("red",l10n.wall_delete_mark,4e3)}t.demount=!1,t.draw(),project.localSave()}}),$("#door_width_input_BAK").on("change",function(){$("#door_contextmenu").hide(50);let t=get_object(walls.db,id.wall),i=get_object(doors.db,id.door);if(t&&i)if(i.demount---!0)warning.show("yellow",l10n.door_not_change_width+"<br>"+l10n.door_not_change_width_reason_1,4e3);else if(i.hasReplacement---!0)warning.show("yellow",l10n.door_not_change_width+"<br>"+l10n.door_not_change_width_reason_2,5e3);else if(!0===i.replacement)warning.show("yellow",l10n.door_not_change_width+"<br>"+l10n.door_not_change_width_reason_3,5e3);else{t.get_stops(i);Math.ceil(get_distance(s_stop,e_stop));var n=parseInt($("#door_width_input").val());if(isNaN(n))$(this).val("").attr("placeholder",i.width);else{let e=1e3;if("single"===i.type&&(e=defs.door.max_width),"double"===i.type&&(e=defs.door_double.max_width),"door_coupe"===i.type&&(e=defs.door_coupe.max_width),"door_penal"===i.type&&(e=defs.door_penal.max_width),n<defs.door.min_width)warning.show("yellow",l10n.door_min_width+" - "+defs.door.min_width+" см.",3e3);else if(n>e)warning.show("yellow",l10n.door_max_width+" - "+e+" см.",3e3);else{if(n<=e){let e=!0;var s,o=get_line(i.center,s_stop),o=(is_point_on_line(i.e,o)&&(e=!1),n-i.width);let t=!1;if(!0===e&&(get_distance(s_stop,i.s)>=o&&(s=LIB.pointOnLine(i.e,i.s,o),i.center=get_center(s,i.e),i.width=n,t=!0,console.warn("в сторону s_stop")),get_distance(e_stop,i.e)>=o&&(s=LIB.pointOnLine(i.s,i.e,o),i.center=get_center(i.s,s),i.width=n,t=!0,console.warn("в сторону e_stop"))),!1===e&&(get_distance(s_stop,i.e)>=o&&(s=LIB.pointOnLine(i.s,i.e,o),i.center=get_center(i.s,s),i.width=n,t=!0,console.warn("в сторону s_stop")),get_distance(e_stop,i.s)>=o&&(s=LIB.pointOnLine(i.e,i.s,o),i.center=get_center(s,i.e),i.width=n,t=!0,console.warn("в сторону e_stop"))),!1===t&&n<=get_distance(s_stop,e_stop)&&(i.center=get_center(s_stop,e_stop),i.width=n,t=!0),!1===t)return o=get_distance(s_stop,e_stop),void warning.show("yellow",l10n.door_max_width_2+" - "+o+" см.",3e3)}$(this).val("").attr("placeholder",n),i.width=n,i.draw(),t.init(),project.localSave()}}}}),$("#door_width_input").on("change",function(){$(".contextmenu").hide(50);let e=get_object(walls.db,id.wall),t=get_object(doors.db,id.door);var i,n,s;e&&t&&(console.warn(t),t.hasReplacement?warning.show("yellow",l10n.door_must_change,6e3):(i=Number(parseInt($(this).val())),isNaN(i)?$(this).val("").attr("placeholder",t.width):(e.get_stops(t),s=get_distance(s_stop,e_stop),i<defs.door.min_width?warning.show("yellow",l10n.door_min_width+" - "+defs.door.min_width+" см.",3e3):i>defs.door.max_width?warning.show("yellow",l10n.door_max_width+" - "+defs.door.max_width+" см.",3e3):s<i?warning.show("yellow",l10n.door_max_width_3+" - "+s+" см. ",1e4):(t.width=i,t.draw(),s=get_distance(t.center,s_stop),n=get_distance(t.center,e_stop),s<t.width/2&&(s=Math.abs(s-t.width/2),t.center=LIB.pointOnLine(s_stop,t.center,s),t.draw()),n<t.width/2&&(s=Math.abs(n-t.width/2),t.center=LIB.pointOnLine(e_stop,t.center,s),t.draw()),$(this).val("").attr("placeholder",i),e.init(),project.localSave()))))}),$("#door_height_input").on("change",function(){let e=get_object(doors.db,id.door);var t;e&&(t=Number(parseInt($(this).val())),isNaN(t)?$(this).val("").attr("placeholder",e.height):(e.height=t,$(this).val("").attr("placeholder",t),project.localSave()))}),$('#door_contextmenu [action="rotate"]').on("click",function(){let e=get_object(doors.db,id.door);e&&(e.rotate(),e.paint("orange"),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){project.localSave()},1e3))}),$('#door_contextmenu [action="move"]').on("click",function(){hide2.contextmenu();let e=get_object(doors.db,id.door);e&&!1!==e.isDraggable()&&doorControl.fire("on")}),$('#door_contextmenu [action="delete"]').on("click",function(){console.warn("== Door deleting =="),hide2.contextmenu();let i=get_object(doors.db,id.door);if(i){if("build"===i.plan){console.warn(i.replacement);for(let t=0;t<doors.db.length;t++){let e=doors.db[t];if(!0===e.hasReplacement&&are_points_equal(i.center,e.center)){e.hasReplacement=!1;break}}if(!0===i.replacement)return i.deleteOnly(),project.draw(),void project.localSave()}i.delete(),project.draw(),project.localSave()}}),$('#door_contextmenu_v2 [action="delete"]').on("click",function(){hide2.contextmenu();let i=get_object(doors.db,id.door);if(i){for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if("build"===t.label&&is_point_inside_polygon(i.center,t.polygon))return void warning.show("red",l10n.wall_delete_mark,4e3)}i.demount=!1,i.draw();for(let t=0;t<doors.db.length;t++){let e=doors.db[t];"build"===e.plan&&is_point_inside_polygon(e.center,i.polygon)&&e.delete(t)}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];!0===e.patch&&are_lines_equal(e.axis,i.axis)&&e.delete()}project.localSave()}}),$("#doorway_width_input_BAK").on("change",function(){$("#doorway_contextmenu").hide(50);let e=get_object(walls.db,id.wall),i=get_object(doors.db,id.door);if(e&&i){e.get_stops(i);Math.ceil(get_distance(s_stop,e_stop));var n=parseInt($("#doorway_width_input").val());if(isNaN(n))$(this).val("").attr("placeholder",i.width);else if(n<defs.doorway.min_width)warning.show("yellow",l10n.doorway_min_width+" - "+defs.door.min_width+" см.",3e3);else if(n>defs.doorway.max_width)warning.show("yellow",l10n.doorway_max_width+" - "+defs.doorway.max_width+" см.",3e3);else{if(n<=defs.doorway.max_width){let e=!0;var s,o=get_line(i.center,s_stop),o=(is_point_on_line(i.e,o)&&(e=!1),n-i.width);let t=!1;if(!0===e&&(get_distance(s_stop,i.s)>=o&&(s=LIB.pointOnLine(i.e,i.s,o),i.center=get_center(s,i.e),i.width=n,t=!0,console.warn("в сторону s_stop")),get_distance(e_stop,i.e)>=o&&(s=LIB.pointOnLine(i.s,i.e,o),i.center=get_center(i.s,s),i.width=n,t=!0,console.warn("в сторону e_stop"))),!1===e&&(get_distance(s_stop,i.e)>=o&&(s=LIB.pointOnLine(i.s,i.e,o),i.center=get_center(i.s,s),i.width=n,t=!0,console.warn("в сторону s_stop")),get_distance(e_stop,i.s)>=o&&(s=LIB.pointOnLine(i.e,i.s,o),i.center=get_center(s,i.e),i.width=n,t=!0,console.warn("в сторону e_stop"))),!1===t&&n<=get_distance(s_stop,e_stop)&&(i.center=get_center(s_stop,e_stop),i.width=n,t=!0),!1===t)return o=get_distance(s_stop,e_stop),void warning.show("yellow",l10n.doorway_max_width_2+" - "+o+" см.",3e3)}i.width=n,i.draw(),e.init(),project.localSave()}}}),$("#doorway_width_input").on("change",function(){$(".contextmenu").hide(50);let e=get_object(walls.db,id.wall),t=get_object(doors.db,id.door);var i,n,s;e&&t&&(console.warn(id.doorway),i=Number(parseInt($(this).val())),isNaN(i)?$(this).val("").attr("placeholder",t.width):(e.get_stops(t),s=get_distance(s_stop,e_stop),i<defs.doorway.min_width?warning.show("yellow",l10n.doorway_min_width+" - "+defs.doorway.min_width+" см.",3e3):i>defs.doorway.max_width?warning.show("yellow",l10n.doorway_max_width+" - "+defs.doorway.max_width+" см.",3e3):s<i?warning.show("yellow",l10n.doorway_max_width_3+" - "+s+" см. ",1e4):(t.width=i,t.draw(),s=get_distance(t.center,s_stop),n=get_distance(t.center,e_stop),s<t.width/2&&(s=Math.abs(s-t.width/2),t.center=LIB.pointOnLine(s_stop,t.center,s),t.draw()),n<t.width/2&&(s=Math.abs(n-t.width/2),t.center=LIB.pointOnLine(e_stop,t.center,s),t.draw()),$(this).val("").attr("placeholder",i),e.init(),project.localSave())))}),$("#doorway_height_input").on("change",function(){$("#doorway_contextmenu").hide(50);let e=get_object(doors.db,id.door);var t;e&&(t=Number(parseInt($(this).val())),isNaN(t)||(e.height=t,$(this).val(""),$(this).attr("placeholder",t),project.localSave()))}),$('#doorway_contextmenu [action="move"]').on("click",function(){hide2.contextmenu();var e=get_object(doors.db,id.door);e&&(!0===e.remove?warning.show("yellow",l10n.doorway_break_not_move,4e3):doorControl.fire("on"))}),$('#doorway_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_object(doors.db,id.door);e&&(e.delete(),project.draw(),project.localSave())}),$("#zone_name_input").on("change",function(){if(1===++t){hide2.contextmenu();let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.zones,id.room_zone);console.warn(t,e),e&&(e.name=$("#zone_name_input").val(),""!==e&&"?"!==e||(e.name="none"),t.draw(),project.localSave())}}setTimeout(function(){t=0},500)}),$("#zone_height_input").on("change",function(){if(hide2.contextmenu(),1===++t){hide2.contextmenu();let i=Number($("#zone_height_input").val());999<(i=i<100?100:i)&&(i=999),params.total_height=i;for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.height=i,e.draw()}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.height=i}walls.calc();for(let t=0;t<sectors.db.length;t++){let e=sectors.db[t];e.height=i}project.localSave()}setTimeout(function(){t=0},500)}),$('#zone_name_contextmenu [action="move"]').on("click",function(){hide2.contextmenu(),$("body").css("cursor","move")}),$('#zone_name_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.zones,id.room_zone);e&&(e.name="none",t.draw(),project.localSave())}}),$("#ceiling-level").on("change",function(){$(".contextmenu").hide();let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.ceilings,id.ceiling);var i;e&&(i=parseInt($(this).val()),e.level=i,t.draw())}}),$("#ceiling-level-1").on("change",function(){let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.ceilings,id.ceiling);var i;e&&(i=parseInt($(this).val()),e.level=i,t.draw())}}),$("#ceiling-level-2").on("change",function(){let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.ceilings,id.ceiling);var i;e&&(i=parseInt($(this).val()),e.level2=i,t.draw())}}),$("#ceiling-offset").on("change",function(){let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.ceilings,id.ceiling);var i;e&&(i=parseInt($(this).val()),e.offset=i,t.draw(),project.localSave())}}),$("#ceiling-radius").on("change",function(){let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.ceilings,id.ceiling);var i;e&&(i=parseInt($(this).val()),e.radius=i,t.draw(),project.localSave())}}),$("#complex_ceiling_material").on("change",function(){let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.ceilings,id.ceiling);var i;e&&(1===(i=parseInt($("#complex_ceiling_material option:selected").val()))&&(e.material2="stretch_ceiling"),2===i&&(e.material2="paint_ceiling"),3===i&&(e.material2="gypsum_ceiling"),t.draw(),project.localSave())}}),$("#complex_ceiling_type").on("change",function(){var t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.ceilings,id.ceiling);e&&(1===(t=parseInt($("#complex_ceiling_type option:selected").val()))&&(e.type="closed"),2===t&&(e.type="opened"),project.localSave())}}),$('#ceiling-contextmenu [action="delete"]').on("click",function(){i()}),$('#ceiling-contextmenu-2 [action="delete"]').on("click",function(){i()}),$('#wires_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();for(let t=0;t<wires.db.length;t++){let e=wires.db[t];if(e.props.id===id.ware){e.erase(),wires.db.splice(t,1);break}}}),$('#cable_contextmenu [action="delete_all"]').on("click",function(){if(hide2.contextmenu(),id.cable){let e=get_cable(id.cable);e&&(e.deleteFull(),project.localSave())}}),$('#cable_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_cable(id.cable);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#pipe_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_pipe(id.pipe);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$("#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action]").on("click",function(){groupWaterSpots.unset_item($(this).attr("action"))}),$("#waterspots-contextmenu .contextmenu_item.pointer.change_sequence").on("click",function(){groupWaterSpots.change_sequence($(this).attr("action"))}),$('#pipe_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_pipe(id.pipe);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$('#cable_socket_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_cable_socket(id.cable_socket);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#cable_socket_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_cable_socket(id.cable_socket);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$('#cable_warm_floor_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_cable_warm_floor(id.cable_warm_floor);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#cable_warm_floor_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_cable_warm_floor(id.cable_warm_floor);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$('#pipe_conditioner_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_pipe_conditioner(id.conditioner_pipe);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#pipe_conditioner_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_pipe_conditioner(id.conditioner_pipe);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$('#cable_conditioner_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_cable_conditioner(id.conditioner_cable);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#cable_conditioner_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_cable_conditioner(id.conditioner_cable);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$('#stripes_light_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_stripe_light(id.stripe_light);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#stripes_light_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_stripe_light(id.stripe_light);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$('#track_line_spot_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),id.track_line_spot){let e=get_stripe_light(id.track_line_spot.id);e&&e.deleteTrackLineSpotByIndex(id.track_line_spot.index)}}),$('#pipe_heat_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_pipe_heat(id.heat_pipe);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#pipe_heat_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_pipe_heat(id.heat_pipe);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$("#ceiling_niche_depth_input").on("change",function(){hide2.contextmenu();let t=get_object(rooms2.data,id.room);if(t){var i=get_object(t.ceilings,id.ceiling);if(i){let e=get_object(i.niches,id.niche);e&&(e.depth=parseInt($("#ceiling_niche_depth_input").val()),t.draw(),project.localSave())}}}),$('#niche_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_object(rooms2.data,id.room);if(e){var t=get_object(e.ceilings,id.ceiling);if(t){console.warn(t.niches,id.niche);let i=get_object(t.niches,id.niche);if(i){for(let t=0;t<comments.db.length;t++){let e=comments.db[t];e.id_item===i.id&&e.delete()}for(var n in i)"id"!==n&&delete i[n];i.exist=!1,i.temp=!1,e.draw(),project.localSave()}}}}),$('#led_strip_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_led_strip(id.led_strip);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#led_strip_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_led_strip(id.led_strip);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$('#line_strip_contextmenu [action="delete"]').on("click",function(){if(hide2.contextmenu(),window.contextmenu_tree_line_id){let e=get_line_strip(id.line_strip);e&&e.deleteByLine(window.contextmenu_tree_line_id)}}),$('#line_strip_contextmenu [action="split_line"]').on("click",function(e){if(hide2.contextmenu(),window.contextmenu_tree_line_id&&window.contextmenu_tree_line_point){let e=get_line_strip(id.line_strip);e&&e.splitLine(window.contextmenu_tree_line_id,window.contextmenu_tree_line_point)}}),$("#furniture_width").on("input",function(){var e=parseInt($(this).val(),10);let t=parseInt($("#furniture_depth").val());isNaN(t)&&(t=parseInt($("#furniture_depth").attr("placeholder"),10)),isNaN(e)||0===e||isNaN(t)||0===t||(cursors.own.fire("update",{width:e,height:t}),cursors.own.fire("park"))}).on("mouseleave",function(){var e;"ventilation_hole"===tool&&(e=parseInt($(this).val()),!isNaN(e)&&0!==e||(e=parseInt($("#furniture_width").attr("placeholder"),10),cursors.own.fire("update",{width:e}),cursors.own.fire("park")))}),$("#furniture_depth").on("input",function(){let e=parseInt($("#furniture_width").val());isNaN(e)&&(e=parseInt($("#furniture_width").attr("placeholder"),10));var t=parseInt($(this).val(),10);isNaN(e)||0===e||isNaN(t)||0===t||(cursors.own.fire("update",{width:e,height:t}),cursors.own.fire("park"))}),$("#furniture_width_input").on("change",function(){let e=get_item(),t=parseInt($(this).val(),10);t<=0&&(t=1),"stairs"===e.model.group&&t<10&&(t=10),e&&!isNaN(t)&&($(this).val("").attr("placeholder",t),e.resize(t,null),project.localSave())}),$("#furniture_depth_input").on("change",function(){let e=get_item(),t=parseInt($(this).val(),10);t<=0&&(t=1),e&&!isNaN(t)&&($(this).val("").attr("placeholder",t),e.resize(null,t),project.localSave())}),$("#furniture_height_input").on("change",function(){let e=get_item(),t=Number(parseInt($(this).val()));t<=0&&(t=1),e&&!isNaN(t)&&($(this).val(""),e.model.self_height=t,$(this).attr("placeholder",t),e.draw(),project.localSave())}),$("#furniture_over_floor_input").on("change",function(){let t=get_item();var i=Number(parseInt($(this).val()));if(!isNaN(i)){$(this).val("").attr("placeholder",i),t.props.over_floor.value=i;let e={};"furniture"===t.model.group&&t.props.over_floor&&0<t.props.over_floor.value&&(e.set_layer=!0),t.draw(null,e),project.localSave()}}),$(document).on("change","#furniture_contextmenu_custom_options select",function(e){var t=$(this)[0].id,i=$(this)[0].value;let n=get_item();var s,o=n.model.custom_options;let l;for(s in o)if(o[s].name===t)for(var r in o[s].options)o[s].options[r].value===i&&(l=o[s].options[r].title);n.props[t]={value:i,title:l},console.log(n.props),project.localSave()}),$(document).on("change","#furniture_contextmenu_custom_options input",function(e){var t=$(this)[0].id,i=parseInt($(this)[0].value);let n=get_item();isNaN(i)?($(this).val(""),$(this).attr("placeholder",n.props[t].value)):(n.props[t].value=i,$(this).val(""),$(this).attr("placeholder",i),console.warn(n.props)),project.localSave()}),$(document).on("change","#window_contextmenu_custom_options select",function(e){var t=$(this)[0].id,i=$(this)[0].value;let n=get_object(windows.db,id.window);if(n){var s,o=n.custom_options;let e;for(s in o)if(o[s].name===t)for(var l in o[s].options)o[s].options[l].value===i&&(e=o[s].options[l].title);n.values[t]={value:i,title:e},project.localSave()}}),$(document).on("change","#window_contextmenu_custom_options input",function(e){var t=$(this)[0].id,i=parseInt($(this)[0].value);let n=get_object(windows.db,id.window);n&&(isNaN(i)?($(this).val(""),$(this).attr("placeholder",n.values[t].value)):(n.values[t].value=i,$(this).val(""),$(this).attr("placeholder",i),project.localSave()))}),$(document).on("change","#door_contextmenu_custom_options select",function(e){var t=$(this)[0].id,i=$(this)[0].value;let n=get_object(doors.db,id.door);if(n){var s,o=n.custom_options;let e;for(s in o)if(o[s].name===t)for(var l in o[s].options)o[s].options[l].value===i&&(e=o[s].options[l].title);n.values[t]={value:i,title:e},project.localSave()}}),$(document).on("change","#door_contextmenu_custom_options input",function(e){var t=$(this)[0].id,i=parseInt($(this)[0].value);let n=get_object(doors.db,id.door);n&&(isNaN(i)?($(this).val(""),$(this).attr("placeholder",n.values[t].value)):(n.values[t].value=i,$(this).val(""),$(this).attr("placeholder",i),project.localSave()))}),$('#item_contextmenu_v2 [action="delete"]').on("click",function(){hide2.contextmenu(),selected.item&&(selected.item.props.demount=!1,selected.item.draw()),project.localSave()}),$("#planner_ui_options_wrapper").on("mouseover",function(){"window"===tool||"windoor"===tool?cursors.window.fire("park"):"door"===tool||"doorway"===tool?cursors.door.fire("park"):"pillar"===tool?cursors.pillar.fire("park"):"pillar_air"===tool?cursors.pillar_air.fire("park"):"pillar_water"===tool?cursors.pillar_water.fire("park"):"gypsum_box"===tool?cursors.pillar.fire("park"):"furniture"===tool_group&&cursors.own.fire("park")}),$("#window_width").on("input",function(){var e=Number(parseInt($(this).val()));isNaN(e)||(defs.window.width=e,cursors.window.fire("init"),cursors.window.fire("park"))}),$("#window_width").on("mouseleave",function(){Number(parseInt($(this).val()))<defs.window.min_width&&($(this).val(defs.window.min_width),defs.window.width=defs.window.min_width,cursors.window.fire("init"),cursors.window.fire("park"),warning.show("yellow",l10n.window_min_width+" - "+defs.window.min_width+" см.",3e3))}),$("#window_height").on("input",function(){var e=Number(parseInt($(this).val()));isNaN(e)||(defs.window.height=e)}),$("#window_floor_height").on("input",function(){var e=Number(parseInt($(this).val()));isNaN(e)||(defs.window.floor_height=e)}),$("#window_slopes").on("input",function(){var e=Number(parseInt($(this).val()));isNaN(e)||(defs.window.slopes=e)}),$("#door_width").on("input",function(){var e=Number(parseInt($(this).val()));isNaN(e)||("doorway"===tool&&(defs.doorway.width=e),"door"===tool&&(defs.door.width=e),"door_double"===tool&&(defs.door_double.width=e),"door_coupe"===tool&&(defs.door_coupe.width=e),"door_penal"===tool&&(defs.door_penal.width=e),cursors.door.fire("init"),cursors.door.fire("park"))}),$("#door_width").on("mouseleave",function(){var e=Number(parseInt($(this).val()));"doorway"===tool&&e<defs.doorway.min_width&&($(this).val(defs.doorway.min_width),defs.doorway.width=defs.doorway.min_width,cursors.door.fire("init"),cursors.door.fire("park"),warning.show("yellow",l10n.doorway_min_width+" - "+defs.doorway.min_width+" см.",3e3)),"door"===tool&&e<defs.door.min_width&&($(this).val(defs.door.min_width),defs.door.width=defs.door.min_width,cursors.door.fire("init"),cursors.door.fire("park"),warning.show("yellow",l10n.door_min_width+" - "+defs.door.min_width+" см.",3e3)),tool,tool,tool}),$("#door_height").on("input",function(){var e=Number(parseInt($(this).val()));isNaN(e)||("doorway"===tool&&(defs.doorway.height=e),"door"===tool&&(defs.door.height=e),"door_double"===tool&&(defs.door_double.height=e),"door_coupe"===tool&&(defs.door_coupe.height=e),"door_penal"===tool&&(defs.door_penal.height=e))}),$("#windoor_window_width").on("input",function(){defs.windoor.window_width=Number($(this).val()),cursors.window.fire("init"),cursors.window.fire("park")}),$("#windoor_window_height").on("input",function(){defs.windoor.window_height=Number($(this).val())}),$("#windoor_door_width").on("input",function(){defs.windoor.door_width=Number($(this).val()),cursors.window.fire("init"),cursors.window.fire("park")}),$("#windoor_door_height").on("input",function(){defs.windoor.door_height=Number($(this).val())}),$("#windoor_position").on("change focus",function(){cursors.window.fire("init"),cursors.window.fire("park")}),$("#lights_over_floor_input").on("change",function(){let e=get_item();var t=parseInt($(this).val());e.props.over_floor.value;isNaN(t)?$(this).val("").attr("placeholder",e.props.over_floor.value):(e.props.over_floor.value=t,$(this).val("").attr("placeholder",t),e.draw(),e.paint())}),$("#socket-over-floor").on("change",function(){n("#socket-over-floor")}),$("#socket-lc-over-floor").on("change",function(){n("#socket-lc-over-floor")}),$("#switch-over-floor").on("change",function(){n("#switch-over-floor")}),$("#waterspots-over-floor").on("change",function(){n("#waterspots-over-floor")}),$("#wire-over-floor").on("change",function(){n("#wire-over-floor")}),$("#pillar_width").on("input",function(){var e=$(this).val();"pillar"===tool&&(defs.pillar.width=s(e,defs.pillar.min_width,defs.pillar.max_width),cursors.pillar.fire("init"),cursors.pillar.fire("park")),"pillar_air"===tool&&(defs.pillar_air.width=s(e,defs.pillar_air.min_width,defs.pillar_air.max_width),$(this).attr("placeholder",defs.pillar_air.width),cursors.pillar_air.fire("init"),cursors.pillar_air.fire("park")),"pillar_water"===tool&&(defs.pillar_water.width=s(e,defs.pillar_water.min_width,defs.pillar_water.max_width),$(this).attr("placeholder",defs.pillar_water.width),cursors.pillar_water.fire("init"),cursors.pillar_water.fire("park")),"gypsum_box"===tool&&(defs.gypsum_box.width=s(e,defs.gypsum_box.min_width,defs.gypsum_box.max_width),$(this).attr("placeholder",defs.gypsum_box.width),cursors.pillar.fire("init"),cursors.pillar.fire("park"))}),$("#pillar_height").on("input",function(){var e=$(this).val();"pillar"===tool&&(defs.pillar.height=s(e,defs.pillar.min_height,defs.pillar.max_height),$(this).attr("placeholder",e),cursors.pillar.fire("init"),cursors.pillar.fire("park")),"pillar_air"===tool&&(defs.pillar_air.height=s(e,defs.pillar_air.min_height,defs.pillar_air.max_height),cursors.pillar_air.fire("init"),cursors.pillar_air.fire("park")),"pillar_water"===tool&&(defs.pillar_water.height=s(e,defs.pillar_water.min_height,defs.pillar_water.max_height),cursors.pillar_water.fire("init"),cursors.pillar_water.fire("park")),"gypsum_box"===tool&&(defs.gypsum_box.height=s(e,defs.gypsum_box.min_height,defs.gypsum_box.max_height),cursors.pillar.fire("init"),cursors.pillar.fire("park"))}),$("#pillar_width").on("mouseleave",function(){if(0<$(this).val()){let e;"pillar"===tool&&(e=defs.pillar.width),"pillar_air"===tool&&(e=defs.pillar_air.width),"pillar_water"===tool&&(e=defs.pillar_water.width),"gypsum_box"===tool&&(e=defs.gypsum_box.width),$(this).val(e).attr("placeholder",e)}}),$("#pillar_height").on("mouseleave",function(){if(0<$(this).val()){let e;"pillar"===tool&&(e=defs.pillar.height),"pillar_air"===tool&&(e=defs.pillar_air.height),"pillar_water"===tool&&(e=defs.pillar_water.height),"gypsum_box"===tool&&(e=defs.gypsum_box.height),$(this).val(e).attr("placeholder",e)}}),$("#floor_cap_input").on("change",function(){let e=get_object(rooms2.data,id.room);var t;e&&(t=parseInt($("#floor_cap_input").val()),t=Number(t),e.cap=t,isNaN(t)||0===t?(e.cap="none",$("#floor_cap_input").val(""),$("#floor_cap_input").attr("placeholder",0)):($("#floor_cap_input").val(e.cap),$("#floor_cap_input").attr("placeholder",e.cap)),e.cap_type=$("#floor_cap_type_select option:selected").text(),e.draw(),project.localSave())}),$("#floor_cap_type").on("change",function(){let e=get_object(rooms2.data,id.room);e&&(e.cap_type=$("#floor_cap_type_select option:selected").text(),e.draw(),project.localSave())}),$('#floor_cap_contextmenu [action="move"]').on("click",function(){hide2.contextmenu(),$("body").css("cursor","move"),something.moving=!0,selected.room.img.cap.draggable()}),$('#floor_cap_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_object(rooms2.data,id.room);e&&(e.cap="none",e.cap_type="none",e.draw(),project.localSave())}),$('#floor_contextmenu [action="rotate"]').on("click",function(){var t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.floors,id.roomFloor);e&&(t=e.filling.transform().rotation,e.angle=(t+45).toFixed(2),e.filling.rotate(e.angle),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){project.localSave()},1e3))}}),$('#floor_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.floors,id.roomFloor);if(e){for(var i in t.removeFloorMoldings(),e)"polygon"!==i&&delete e[i];e.exist=!1,t.draw(),project.localSave()}}}),$('#hydroisolation_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let t=get_object(rooms2.data,id.room);if(t){let e=get_object(t.hydroisolation,id.roomHydroisolation);if(e){for(var i in e)"polygon"!==i&&delete e[i];e.exist=!1,t.draw(),project.localSave()}}}),$('#wall_decor_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let t=rooms2.data[selected.room];for(let e=0;e<t.decor.length;e++)t.decor[e]={name:"none",color:"none",area:"none"};t.draw()}),$('#ceiling-contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_room(id.room);e.ceiling={exist:!1},e.niches=[],e.complex_ceiling={exist:!1},e.draw()}),$('#isolation_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let t=rooms2.data[selected.room];for(let e=0;e<t.isolation.length;e++)t.isolation[e]={name:"none",color:"none",area:"none"};t.draw(),project.localSave()}),$('#plaster_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let t=rooms2.data[selected.room];for(let e=0;e<t.plaster.length;e++)t.plaster[e]={name:"none",color:"none",area:"none"};t.draw(),project.localSave()}),$('#warm_floor_contextmenu [action="move"]').on("click",function(){let e=warm_floors.db[selected.warm_floor];switch($(this).attr("action")){case"move":allow.crosshair=!1,selected.warm_floor=null;for(let e=0;e<warm_floors.db.length;e++)if(warm_floors.db[e].id===id.warm_floor){selected.warm_floor=e;break}var t,i,n,s;null!==selected.warm_floor&&(t=get_center((s=warm_floors.db[selected.warm_floor]).s,s.s2),i=get_center(s.s,s.e2),n=get_center(s.e,s.e2),s=get_center(s.e,s.s2),svg.circle(10).fill("red").cx(t.x).cy(t.y),svg.circle(10).fill("red").cx(i.x).cy(i.y),svg.circle(10).fill("red").cx(n.x).cy(n.y),svg.circle(10).fill("red").cx(s.x).cy(s.y));break;case"delete":e.delete(),project.draw(),project.localSave()}hide2.contextmenu()}),$('#warm_floor_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=rooms2.data[index.room];var t;e&&e.warm_floors&&void 0!==index.warm_floor&&(t=e.warm_floors[index.warm_floor].id,t=get_warm_floor(t),cabling_warm_floor.delete_lines(t),e.warm_floors.splice(index.warm_floor,1),e.draw(),project.localSave())}),$('#socket-contextmenu [action="comment"]').on("click",function(){o()}),$('#socket-lc-contextmenu [action="comment"]').on("click",function(){o()}),$('#lights-contextmenu [action="comment"]').on("click",function(){o()}),$('#switch-contextmenu [action="comment"]').on("click",function(){o()}),$('#waterspots-contextmenu [action="comment"]').on("click",function(){o()}),$('#wire-contextmenu [action="comment"]').on("click",function(){o()}),$('#furniture-contextmenu [action="comment"]').on("click",function(){o()}),$('#item-contextmenu-simple [action="comment"]').on("click",function(){o()}),$('#comment_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_object(comments.db,id.comment);e&&(e.delete(),console.warn(comments.db.length),project.localSave()),$(".footer_bar_tool").removeClass("active"),"comment"===tool&&(tool="none")}),$("#comment_input").on("change",function(){hide2.contextmenu();let t=get_object(items.db,id.item);var i=$("#comment_input").val();if(""!==i){let e=comments.db[selected.comment];e.text=i,e.draw(),t&&(t.props.comment.exist=!0,t.props.comment.id=e.id),project.localSave()}$(".footer_bar_tool").removeClass("active"),"comment"===tool&&(tool="none")}),$('#socket-contextmenu [action="delete"]').on("click",function(){l()}),$('#socket-lc-contextmenu [action="delete"]').on("click",function(){l()}),$('#switch-contextmenu [action="delete"]').on("click",function(){l()}),$('#lights-contextmenu [action="delete"]').on("click",function(){l()}),$('#waterspots-contextmenu [action="delete"]').on("click",function(){l()}),$('#item_delete_only-contextmenu [action="delete"]').on("click",function(){l()}),$('#tree_node-contextmenu [action="delete"]').on("click",function(){l()}),$('#wire-contextmenu [action="delete"]').on("click",function(){l()}),$('#furniture-contextmenu [action="delete"]').on("click",function(){l()}),$('#item-contextmenu-simple [action="delete"]').on("click",function(){l()}),$('#socket-contextmenu [action="move"]').on("click",function(){hide2.contextmenu()}),$('#socket-lc-contextmenu [action="move"]').on("click",function(){hide2.contextmenu()}),$('#lights-contextmenu [action="move"]').on("click",function(){hide2.contextmenu()}),$('#switch-contextmenu [action="move"]').on("click",function(){hide2.contextmenu()}),$('#waterspots-contextmenu [action="move"]').on("click",function(){hide2.contextmenu()}),$('#wire-contextmenu [action="move"]').on("click",function(){hide2.contextmenu()}),$('#furniture-contextmenu [action="move"]').on("click",function(){hide2.contextmenu()}),$('#furniture-contextmenu [action="copy"]').on("click",function(){hide2.contextmenu();let e=get_item();e.copy()}),$("#furniture").on("mousedown",function(){if(in_array(plan,plansForFurniture)){let e=$("#furniture_switch");if(e.hasClass("active")?e.removeClass("active"):e.addClass("active"),e.hasClass("active")){furnitureSwitch[plan]=!0,visibility.furniture=!0;for(let t=0;t<items.db.length;t++){let e=items.db[t];var i=e.model.plan.hasOwnProperty("furniture"),n=e.model.plan.hasOwnProperty("santeh")&&"santeh"!==plan;(i||n)&&(e.paint(),e.show())}}else{furnitureSwitch[plan]=!1,visibility.furniture=!1;for(let t=0;t<items.db.length;t++){let e=items.db[t];var s=e.model.plan.hasOwnProperty("furniture"),o=e.model.plan.hasOwnProperty("santeh")&&"santeh"!==plan;(s||o)&&(e.paint(),e.hide())}}}}),$("#sockets").on("mousedown",function(){if(in_array(plan,plansForSockets)){let e=$("#sockets_switch");if(e.hasClass("active")?e.removeClass("active"):e.addClass("active"),e.hasClass("active")){socketsSwitch[plan]=!0,visibility.sockets=!0;for(let t=0;t<items.db.length;t++){let e=items.db[t];!e.model.plan.hasOwnProperty("sockets")&&"switches"!==e.model.group||e.show({only_image:!0})}}else{socketsSwitch[plan]=!1,visibility.sockets=!1;for(let t=0;t<items.db.length;t++){let e=items.db[t];!e.model.plan.hasOwnProperty("sockets")&&"switches"!==e.model.group||e.hide()}}}}),$("#dimensions").on("click",function(){let e=$("#dimensions_switch");if(e.hasClass("active"))return e.removeClass("active"),dimensionsSwitch[plan]=!1,layers.wallsDimensions.hide(),layers.pillarsDimensions.hide(),layers.doorsDimensions.hide(),void layers.windowsDimensions.hide();e.hasClass("active")||(e.addClass("active"),dimensionsSwitch[plan]=!0,layers.wallsDimensions.show(),layers.pillarsDimensions.show(),layers.doorsDimensions.show(),layers.windowsDimensions.show())}),$("#magnets").on("click",function(){if(console.warn("allow.magnet",allow.magnet),allow.magnet)return $("#magnets_switch").removeClass("active"),pillarGuidlines.fire("off"),void(allow.magnet=!1);allow.magnet||($("#magnets_switch").addClass("active"),"pillar"===tool&&pillarGuidlines.fire("on"),allow.magnet=!0)}),$("#handline_magnets").on("click",function(){if(allow.handline_magnet)return $("#handline_magnets_switch").removeClass("active"),void(allow.handline_magnet=!1);allow.handline_magnet||($("#handline_magnets_switch").addClass("active"),allow.handline_magnet=!0)}),$("#project-to-center").on("mousedown",function(){$(this).addClass("active")}),$("#project-to-center").on("mouseup",function(){$(this).removeClass("active"),project.focus()}),$("#user_save").on("click",function(){project.save()}),$("#project-delete").on("click",function(){project.delete(),project.localSave(),LogItems.was_project_delete=!0}),$("#comments").on("click",function(e){hide(),$(".tools_item.active").removeClass("active"),$("body").css("cursor","crosshair"),deactivate_tool(),tool="comment",tool_group="none"}),$("#eraser").on("click",function(e){tool_deactivate(),newHide(),tool="eraser",customCursor.fire("on",e)}),$("#freeline").on("mousedown",function(){tool_deactivate(),newHide(),$("body").css("cursor","crosshair"),tool="freeline"}),$('#comment_contextmenu .color_wrapper .color[action="set_color"]').on("click",function(){var t=$(this).find(".contextmenu_item_icon_circle").data("value");if($('.color_wrapper .color[action="set_color"]').removeClass("active"),$(this).addClass("active"),void 0!==selected.comment){let e=comments.db[selected.comment];e&&(e.setColor("#"+t),project.localSave(),hide2.contextmenu())}}),$('#freeline-contextmenu .color_wrapper .color[action="set_color"]').on("click",function(){var e=$(this).find(".contextmenu_item_icon_circle").data("value");$('.color_wrapper .color[action="set_color"]').removeClass("active"),$(this).addClass("active"),selected.freeline&&(selected.freeline.setColor("#"+e),project.localSave(),hide2.contextmenu())}),$('#cable_contextmenu .color_wrapper .color[action="set_color"]').on("click",function(){var t=$(this).find(".contextmenu_item_icon_circle").data("value");if($('.color_wrapper .color[action="set_color"]').removeClass("active"),$(this).addClass("active"),id.cable){let e=get_cable(id.cable);e&&(e.setColor("#"+t),project.localSave(),hide2.contextmenu())}}),$(document).on("click",".box_cables_socket_label",function(){cables_socket.paint();var e=!$(this).next().hasClass("active");$(".options_cables_socket").removeClass("active"),e&&$(this).next().addClass("active")}),$(document).on("click",".options_cables_socket_item.type_cables_socket",function(){$(".options_cables_socket_item").removeClass("active"),cables_socket.paint();var e=$(this).data("id");$(this).addClass("active");let t=get_cable_socket(e);t&&t.paint("orange")}),$(document).on("click",".options_cables_socket_item.type_pipes",function(){$(".options_cables_socket_item").removeClass("active"),pipes.paint();var e=$(this).data("id");$(this).addClass("active");let t=get_pipe(e);t&&t.paint("orange")}),$('#tree_node-contextmenu [action="union_line"]').on("click",function(){hide2.contextmenu(),selected.item&&manager_lining.union_line(selected.item.props.id)}),$(document).on("click","#build_pipe_santeh_button",function(){window.no_local_save=!0;try{build_santeh_pipes()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e),send_warning_signals(signal_types[1],"Ошибка при построении водоснабжения","",1,1)}window.no_local_save=!1,project.localSave()})});let canvas,svg,svg_copy,svg_print,svg_for_stamp,svg_for_frame,background,stamp,zoom_min=.2,zoom_max=3,zoom_factor=.2,arrows,colors,gradient,laminate,floor_tile,linoleum,fitted_carpet,parquet_board,wood_board,paths,CustomIcons={};$(document).ready(function(){(canvas=$("#canvas")).on("mousemove",function(e){window.global_event_mousemove={x:e.clientX,y:e.clientY}}),svg=SVG("canvas").id("main_svg").size(canvas.width(),canvas.height()).panZoom({zoomMin:zoom_min,zoomMax:zoom_max,zoomFactor:zoom_factor}),svg_copy=SVG("canvas").id("svg_copy").size(canvas.width(),canvas.height()),svg_print=SVG("canvas").id("svg_print").size(canvas.width(),canvas.height()),svg_for_stamp=SVG("canvas").id("svg_for_stamp").size(420,80),svg_for_frame=SVG("canvas").id("svg_for_frame").size(canvas.width(),canvas.height()),stamp=svg_for_stamp.group(),background=svg.image(),laminate=svg.pattern(126,36,function(e){e.rect(126,36).attr({fill:"#ffffff"}),e.path("M0,0 L126,0").attr({"stroke-width":1,stroke:"#000000"}),e.path("M0,18 L126,18").attr({"stroke-width":.4,stroke:"#000000"}),e.path("M63,0 L63,18").attr({"stroke-width":.4,stroke:"#000000"}),e.path("M0,18 L0,36").attr({"stroke-width":1,stroke:"#000000"})}),floor_tile=svg.pattern(30,30,function(e){e.rect(30,30).attr({fill:"#ffffff"}),e.path("M0,0h30 M30,0v30").attr({"stroke-width":.4,stroke:"#000000"})}),linoleum=svg.pattern(30,30,function(e){e.rect(30,30).attr({fill:"#ffffff"}),e.path("M0,0h30 M30,0v30").attr({"stroke-width":3,stroke:"#bd38bb"})}),fitted_carpet=svg.pattern(30,30,function(e){e.rect(30,30).attr({fill:"#ffffff"}),e.path("M0,0h30 M30,0v30").attr({"stroke-width":3,stroke:"#6163bc"})}),parquet_board=svg.pattern(30,30,function(e){e.rect(30,30).attr({fill:"#ffffff"}),e.path("M0,0h30 M30,0v30").attr({"stroke-width":3,stroke:"#fdaaab"})}),wood_board=svg.pattern(30,30,function(e){e.rect(30,30).attr({fill:"#ffffff"}),e.path("M0,0h30 M30,0v30").attr({"stroke-width":3,stroke:"#8bdddc"})}),window.hammer="M6.9,0.8C7.4,0.3,8,0,8.7,0c0.7,0,1.4,0.3,1.9,0.8l2.9,2.9c0.5,0.5,0.8,1.2,0.8,1.9c0,0.7-0.3,1.4-0.8,1.9l-1.1,1.1L13,9c0.1,0.1,0.1,0.4,0,0.5l-0.3,0.3l11,11c0,0,0,0,0,0c0.2,0.2,0.3,0.5,0.3,0.8c0,0.3-0.1,0.6-0.3,0.8c0,0,0,0,0,0l-1.3,1.3c0,0,0,0,0,0c-0.2,0.2-0.5,0.3-0.8,0.3c-0.3,0-0.6-0.1-0.8-0.3L13,15.9c0,0,0,0,0,0c0,0,0,0,0,0l-0.8-0.8c0,0,0,0,0,0c0,0,0,0,0,0l-2.4-2.4L9.5,13c-0.1,0.1-0.2,0.1-0.3,0.1c-0.1,0-0.2,0-0.3-0.1l-0.5-0.5l-1.1,1.1c-0.5,0.5-1.2,0.8-1.9,0.8S4.2,14,3.7,13.5l-2.9-2.9c-1-1-1-2.7,0-3.7L6.9,0.8z M8.4,12.4 L12.4,8.5 M13,15.9 L15.9,13 M9.8,12.7 L12.7,9.8",window.hammer="M21.9,23.9L6,6.9C5.7,6.6,5.7,6.1,6,5.8l0.3-0.3c0.3-0.3,0.8-0.3,1.1,0l16.5,16.2c0.3,0.3-0.1,1.3-0.4,1.6l-0.3,0.3C22.9,23.9,22.2,24.2,21.9,23.9z M3.7,4.8L2.9,4c-0.1-0.1-0.1-0.3,0-0.5l1-1.1c0.1-0.1,0.3-0.1,0.5,0l0.8,0.8c0.1,0.1,0.1,0.3,0,0.5l-1,1.1C4,5,3.8,5,3.7,4.8z M2.5,10.3L0.1,7.8C0,7.7,0,7.5,0.1,7.3L7,0.2C7.2,0,7.4,0,7.6,0l3.8,1.6L3,10.3C2.8,10.4,2.6,10.4,2.5,10.3z",window.hammer="M21.4,23.9c0.2,0.2,0.4,0.2,0.6,0l1.8-1.8c0.2-0.2,0.2-0.4,0-0.6L10.7,8.2l-2.4,2.4L21.4,23.9zM2.7,5.2l1.9-1.9l0.5-0.5L4.9,2.4C4.8,2.4,4.7,2.3,4.6,2.3c-0.1,0-0.2,0-0.3,0.1L2.4,4.3c-0.2,0.2-0.2,0.4,0,0.6L2.7,5.2zM4.3,13.4L0,9.2L9.2,0l4.3,4.3L4.3,13.4z",window.hammer="M26.5,29.1c0.2,0.2,0.4,0.2,0.6,0l1.8-1.8c0.2-0.2,0.2-0.4,0-0.6L15.8,13.4l-2.4,2.4L26.5,29.1z M7.8,10.4l1.9-1.9L10.2,8L10,7.6c-0.1,0-0.2-0.1-0.3-0.1s-0.2,0-0.3,0.1L7.5,9.5c-0.2,0.2-0.2,0.4,0,0.6L7.8,10.4z M9.4,18.6l-4.3-4.2l9.2-9.2l4.3,4.3L9.4,18.6z",window.hammer_after="M27.1,13.7c0.2,0,0.4-0.2,0.4-0.4v-2.6c0-0.2-0.2-0.4-0.4-0.4l-18.7,0v3.5L27.1,13.7zM0.6,13.7l0-2.7l0-0.7H0.2c-0.1,0-0.2,0-0.3,0.1c-0.1,0.1-0.1,0.2-0.1,0.3v2.6c0,0.2,0.2,0.4,0.4,0.4L0.6,13.7zM7.5,18.5h-6l0-12.9l6,0L7.5,18.5z",window.trowel=svg.group(),trowel.sign="M0.1,1.6l5.6,17.6c0.1,0.4,0.5,0.7,0.9,0.8c0.1,0,0.2,0,0.3,0c0.3,0,0.6-0.1,0.9-0.4l5.1-5.1l2.3,2.3l-0.3,0.3c-0.2,0.2-0.2,0.5,0,0.7l5.5,5.5c0.4,0.4,1,0.6,1.5,0.6c0.6,0,1.1-0.2,1.5-0.6c0.9-0.9,0.9-2.2,0-3.1l-5.5-5.5c-0.2-0.2-0.5-0.2-0.7,0l-0.3,0.3l-2.3-2.3l5.1-5.1C20,7.4,20.1,7,20,6.6c-0.1-0.4-0.4-0.8-0.8-0.9L1.6,0.1C1.2-0.1,0.7,0,0.4,0.4C0,0.7-0.1,1.2,0.1,1.6z M15.8,17.6l1.7-1.7l5.1,5.1c0.5,0.5,0.5,1.3,0,1.7c-0.5,0.5-1.3,0.5-1.7,0L15.8,17.6z M10.6,11.1c-0.1-0.1-0.1-0.3,0-0.5c0.1-0.1,0.3-0.1,0.5,0l5.2,5.2l-0.5,0.5L10.6,11.1z M1,1c0,0,0.1-0.1,0.3-0.1l17.6,5.6c0.1,0,0.2,0.2,0.2,0.2c0,0,0,0.2-0.1,0.3L14,12.1l-2.2-2.2c-0.5-0.5-1.3-0.5-1.8,0c-0.5,0.5-0.5,1.3,0,1.8l2.2,2.2L7.1,19c-0.1,0.1-0.2,0.1-0.3,0.1c0,0-0.2-0.1-0.2-0.2L1,1.3C0.9,1.2,1,1.1,1,1z",trowel.line="M0.1,1.6l5.6,17.6c0.1,0.4,0.5,0.7,0.9,0.8c0.1,0,0.2,0,0.3,0c0.3,0,0.6-0.1,0.9-0.4l5.1-5.1l2.3,2.3l-0.3,0.3c-0.2,0.2-0.2,0.5,0,0.7l5.5,5.5c0.4,0.4,1,0.6,1.5,0.6c0.6,0,1.1-0.2,1.5-0.6c0.9-0.9,0.9-2.2,0-3.1l-5.5-5.5c-0.2-0.2-0.5-0.2-0.7,0l-0.3,0.3l-2.3-2.3l5.1-5.1C20,7.4,20.1,7,20,6.6c-0.1-0.4-0.4-0.8-0.8-0.9L1.6,0.1C1.2-0.1,0.7,0,0.4,0.4C0,0.7-0.1,1.2,0.1,1.6z M15.8,17.6l1.7-1.7l5.1,5.1c0.5,0.5,0.5,1.3,0,1.7c-0.5,0.5-1.3,0.5-1.7,0L15.8,17.6z M10.6,11.1c-0.1-0.1-0.1-0.3,0-0.5c0.1-0.1,0.3-0.1,0.5,0l5.2,5.2l-0.5,0.5L10.6,11.1z M1,1c0,0,0.1-0.1,0.3-0.1l17.6,5.6c0.1,0,0.2,0.2,0.2,0.2c0,0,0,0.2-0.1,0.3L14,12.1l-2.2-2.2c-0.5-0.5-1.3-0.5-1.8,0c-0.5,0.5-0.5,1.3,0,1.8l2.2,2.2L7.1,19c-0.1,0.1-0.2,0.1-0.3,0.1c0,0-0.2-0.1-0.2-0.2L1,1.3C0.9,1.2,1,1.1,1,1z",paths={sign_destroy:"M0.1,5.3l1.6-1.6L1.6,3.5c-0.3-0.3-0.3-0.7,0-1c0,0,0,0,0,0l1-1c0.3-0.3,0.7-0.3,1,0c0,0,0,0,0,0l0.2,0.2l1.6-1.6C5.4,0,5.6,0,5.7,0.1l2.6,2.6c0.1,0.1,0.1,0.2,0,0.3L6.7,4.7l7.1,7.1c0.3,0.3,0.3,0.7,0,1l-1,1c-0.3,0.3-0.7,0.3-1,0L4.7,6.7L3,8.3c-0.1,0.1-0.2,0.1-0.3,0L0.1,5.7C0,5.6,0,5.4,0.1,5.3z M3.2,1.9C3.1,1.8,3,1.8,2.9,1.9c0,0,0,0,0,0l-1,1C1.8,3,1.8,3.1,1.9,3.2L2,3.4l1-1L3.4,2L3.2,1.9z M12.1,13.5c0.1,0.1,0.2,0.1,0.3,0l1-1c0.1-0.1,0.1-0.2,0-0.3L6.3,5L5,6.3L12.1,13.5z M2.9,7.8l4.9-4.9L5.5,0.6L0.6,5.5L2.9,7.8z",sign_stop:"M12,0C5.4,0,0,5.4,0,12s5.4,12,12,12s12-5.4,12-12S18.6,0,12,0z M2.9,12C2.9,7,7,2.9,12,2.9c1.9,0,3.7,0.6,5.3,1.7L12,9.8l-7.4,7.4C3.4,15.7,2.9,13.9,2.9,12z M12,21.1c-1.9,0-3.7-0.6-5.3-1.7L19.4,6.7c1.1,1.6,1.7,3.4,1.7,5.3C21.1,17,17,21.1,12,21.1z"},colors={white:"#ffffff",black:"#000000",grey:"#000000",green:"#148515",green_light:"#f1fceb",blue:"#106fc6",crimson:"#dc143c",yellow:"#fcf8e3",orange:"#cd7721",of_shading:"#a5a5a5",pgb:"#106fc6",block:"#32a28b",brick:"#fd7951",gypsum:"#ba70cd",glass:"#4290FF",bar:"brown"},hatch={grey:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#a5a5a5"})}),green:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#148515"})}),blue:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#106fc6"})}),crimson:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#dc143c"})}),crimson_2:svg.pattern(8,8,function(e){e.rect(8,8).attr({fill:"transparent"}),e.path("M-1,1 l2,-2 M0,8 l8,-8 M7,9 l2,-2").attr({"stroke-width":.2,stroke:"#dc143c"})}),yellow:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"yellow"})}),orange:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":1.2,stroke:"#e48423"})}),pgb:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#106fc6"})}),block:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#32a28b"})}),brick:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#fd7951"})}),gypsum:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#ffffff"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#ba70cd"})}),glass:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#EDF9FD"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#4290FF"})}),bar:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:"#EDF9FD"}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:"#4290FF"})})},gradient={yellow:svg.gradient("linear",function(e){e.at({offset:0,color:"#fcf8e3"}),e.at({offset:.8,color:"#f8f3d6"})}).from(0,0).to(0,.8),red:svg.gradient("linear",function(e){e.at({offset:0,color:"#feeeed"}),e.at({offset:.8,color:"#fce5e3"})}).from(0,0).to(0,.8)},arrows=svg.group().add(svg.circle(8).cx(15).cy(15).attr({"stroke-width":2,stroke:"#dc143c",fill:"#fafafa"})).add(svg.polyline([5,10,0,15,5,20]).attr({"stroke-width":2,stroke:"#dc143c","stroke-linecap":"round",fill:"none"})).add(svg.polyline([25,10,30,15,25,20]).attr({"stroke-width":2,stroke:"#dc143c","stroke-linecap":"round",fill:"none"})).hide(),window.item_plus=svg.group().add(svg.rect(14,14).radius(2,2).attr({stroke:"#000000","stroke-width":.4,fill:"#f4f4f4",cursor:"pointer"})).add(svg.line(2,7,12,7).attr({stroke:"#000000","stroke-width":1.4,cursor:"pointer"})).add(svg.line(7,2,7,12).attr({stroke:"#000000","stroke-width":1.4,cursor:"pointer"})).on("mousedown",function(){let e=items.db[closest.socket];e.props.length<5&&(e.props.length++,e.blink("positive")),1<e.props.length&&(item_minus.cx(e.btn_minus_center.x),item_minus.cy(e.btn_minus_center.y),item_minus.show().front()),5===e.props.length&&this.hide(),e.draw()}).hide(),window.item_minus=svg.group().add(svg.rect(14,14).radius(2,2).attr({stroke:"#000000","stroke-width":.4,fill:"#f4f4f4",cursor:"pointer"})).add(svg.line(2,7,12,7).attr({stroke:"#000000","stroke-width":1.4,cursor:"pointer"})).on("mousedown",function(){let e=items.db[closest.socket];1<e.props.length&&(e.props.length--,e.blink("positive")),e.props.length<5&&(item_plus.cx(e.btn_plus_center.x),item_plus.cy(e.btn_plus_center.y),item_plus.show().front()),1===e.props.length&&this.hide(),e.draw()}).hide(),window.SplitMark={wall1:{},wall2:{},point:{},IMAGE:svg.group().draggable().on("dragstart",function(){var e={s:SplitMark.wall1.s,e:SplitMark.wall2.e};let t=5,i=5;SplitMark.wall1.free.s||(t=20),SplitMark.wall2.free.e||(i=20),this.axis={s:LIB.pointOnLine(e.e,e.s,-t),e:LIB.pointOnLine(e.s,e.e,-i)}}).on("dragmove",function(e){e.preventDefault();e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),e=LIB.projection(e,this.axis);e&&(SplitMark.wall1.e=e,SplitMark.wall2.s=e,SplitMark.wall1.draw(),SplitMark.wall2.draw(),drawing=!1,panning=!1,SplitMark.draw())}),init:function(){this.IMAGE.clear(),this.line=this.IMAGE.line().attr({"stroke-width":2,stroke:"#e48423",fill:"#fafafa"}).hide(),this.oCircle=this.IMAGE.circle(10).attr({"stroke-width":2,stroke:"#e48423",fill:"#fafafa"}).hide(),this.iCircle=this.IMAGE.circle(10).attr({"stroke-width":2,stroke:"#e48423",fill:"#fafafa"}).hide(),layers.upper.add(this.IMAGE),this.draw()},draw:function(){var e=get_point_near_line_end(this.wall1.s,this.wall1.e,this.wall1.outer_depth+12,"L"),t=get_point_near_line_end(this.wall1.s,this.wall1.e,this.wall1.inner_depth+12,"R");this.line.plot(e.x,e.y,t.x,t.y).show(),this.oCircle.cx(e.x).cy(e.y).show(),this.iCircle.cx(t.x).cy(t.y).show()}},window.icons={},icons.warning_red_dark="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAACXBIWXMAAAsTAAALEwEAmpwYAAA55mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMwMTQgNzkuMTU2Nzk3LCAyMDE0LzA4LzIwLTA5OjUzOjAyICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNC0wNi0xNlQxMzowMzo0NCswNDowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE1LTA1LTAzVDE4OjUwOjIxKzAzOjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxNS0wNS0wM1QxODo1MDoyMSswMzowMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDo1YmUyNDRhMS0yYzcxLTQzMTQtYjNkZS05N2E0ZWY3NzdhOTI8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPnhtcC5kaWQ6Y2M1MzYxZWEtYzc1OC00MTQzLThhODgtMTMyMTFmNjQ2NGNkPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6Y2M1MzYxZWEtYzc1OC00MTQzLThhODgtMTMyMTFmNjQ2NGNkPC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOmNjNTM2MWVhLWM3NTgtNDE0My04YTg4LTEzMjExZjY0NjRjZDwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxNC0wNi0xNlQxMzowMzo0NCswNDowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5zYXZlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjViZTI0NGExLTJjNzEtNDMxNC1iM2RlLTk3YTRlZjc3N2E5Mjwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxNS0wNS0wM1QxODo1MDoyMSswMzowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpjaGFuZ2VkPi88L3N0RXZ0OmNoYW5nZWQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+NjU1MzU8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjUxMjwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj41MTI8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PopMtvwAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOgAAFIIAAEVWAAAOpcAABdv11ofkAAAG05JREFUeNrs3dtVHGt6x+H/ROCaC127icAQgZsIBiIQikAQAU0EoAgEEdCOQD0RQAa0r+fClcH2xVv7MHsLiUMf6vA8a+21l+3lGfqjW/p1fe9X9bdffvklAMC0/E0AAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAAjDQA/rW48luA3fhHksMk8+7fTfe/X3f/rJL8T5JHSwXb92FxKQCArWmSfE5ylmT2wv+fdZJFkjvLBwJA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",icons.warning_red_light="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAABN2lDQ1BBZG9iZSBSR0IgKDE5OTgpAAAokZWPv0rDUBSHvxtFxaFWCOLgcCdRUGzVwYxJW4ogWKtDkq1JQ5ViEm6uf/oQjm4dXNx9AidHwUHxCXwDxamDQ4QMBYvf9J3fORzOAaNi152GUYbzWKt205Gu58vZF2aYAoBOmKV2q3UAECdxxBjf7wiA10277jTG+38yH6ZKAyNguxtlIYgK0L/SqQYxBMygn2oQD4CpTto1EE9AqZf7G1AKcv8ASsr1fBBfgNlzPR+MOcAMcl8BTB1da4Bakg7UWe9Uy6plWdLuJkEkjweZjs4zuR+HiUoT1dFRF8jvA2AxH2w3HblWtay99X/+PRHX82Vun0cIQCw9F1lBeKEuf1UYO5PrYsdwGQ7vYXpUZLs3cLcBC7dFtlqF8hY8Dn8AwMZP/fNTP8gAAAAJcEhZcwAACxMAAAsTAQCanBgAAAamaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjQwMzYsIDIwMTkvMDgvMTMtMDE6MDY6NTcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE0IChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxNC0wNi0xNlQxMzowMzo0NCswNDowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTktMTEtMjZUMTE6NTU6NDErMDM6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTktMTEtMjZUMTE6NTU6NDErMDM6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjc2MzYwZTY2LWFhZWItNGY1OS04ZWQ1LWQ4MTQ4YTgwNDM3NiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmJmYTg3NzkxLTUxYmItMTE3OS05NDdmLWNjZTc3YmQwMWI0ZCIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmNjNTM2MWVhLWM3NTgtNDE0My04YTg4LTEzMjExZjY0NjRjZCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6Y2M1MzYxZWEtYzc1OC00MTQzLThhODgtMTMyMTFmNjQ2NGNkIiBzdEV2dDp3aGVuPSIyMDE0LTA2LTE2VDEzOjAzOjQ0KzA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NWJlMjQ0YTEtMmM3MS00MzE0LWIzZGUtOTdhNGVmNzc3YTkyIiBzdEV2dDp3aGVuPSIyMDE1LTA1LTAzVDE4OjUwOjIxKzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NzYzNjBlNjYtYWFlYi00ZjU5LThlZDUtZDgxNDhhODA0Mzc2IiBzdEV2dDp3aGVuPSIyMDE5LTExLTI2VDExOjU1OjQxKzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjEuMCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz62S3hTAAAyvklEQVR4nO3dbW9j6X3f8f8hKZCM2CNGFFgrpKxjSxmpustRJZZalhRPdDdqZEBqiwB9UEAK0OejvoJRX4H1AgqsA/SZkSJpHSNxtqnUKFuoQSGmSlCoLpp1IzmGo6TW1o0cJN7pA2p2qYuHM7ohz3Vuvh9g4cxZ7sw/MyPxx3N+13UZb968EQAAEC0x3QMAAADvEQAAAIggAgAAABFEAAAAIIIIAAAARBABAACACCIAAAAQQQQAAAAiiAAAAEAEEQAAAIggAgAAABFEAAAAIIIIAAAARBABAACACCIAAAAQQQQAAAAiiAAAAEAEEQAAAIggAgAAABFEAAAAIIIIAAAARBABAACACCIAAAAQQQQAAAAiiAAAAEAEEQAAAIggAgAAABFEAAAAIIIIAAAARBABAACACCIAAAAQQQQAAAAiiAAAAEAEEQAAAIggAgAAABFEAAAAIIIIAAAARBABAACACCIAAAAQQQQAAAAiiAAAAEAEEQAAAIggAgAAABFEAAAAIIIIAAAARBABAACACCIAAAAQQQQAAAAiiAAAAEAEEQAAAIggAgAAABFEAAAAIIIIAAAARBABAACACCIAAAAQQQQAAAAiiAAAAEAEEQAAAIggAgAAABGU8PoX/Bd7/9zrXxKIum0RsUXEufvfbIfXfXL3z5GI/IaINHo6FYB7/vU3/o2nv57nAQCAJ7Ii8kpE9kTEeuB/Y93944jIgTTDwIGI/GoX5wLgEzwCAMJnR0TOpPnmbT3j57FE5Bsi8ifSDAUAQoQ7AEC4fF1E9t/1grVK1fX6Rx+fdPpPLBH5jyJyKCL/8qmDAfAXAgAQDllpvknb6r94+4afz2VOvzycux35ua9mE4n+r4jIwN1LLv/2b//f9eLM6I/++H9+f/j2J38zIeIaCPbvfp1f6cH8ADxGAACCLysub/5rlarEYsbN35/68tlXvjw7LiLlDv99MZHoL37ly7PylS/Piohc/pfG73+yVqlWRdqCwN7d/xICgICjAwAEW1Y6vPnnc5nTf7q59X+/8uVZR0SKj/g5i//A/ofVX/6lr12amWTD5ZHBnoh8+OSJAfgCdwCAYHN9868tThx/Kf/z9Wf+3MWXy+vFH/zwu8ciUudOABAuBAAguD4U5c1/o1q7+ScvN39gGPHnvvl/7kv5n69vVNMnIlIlBADhwSMAIJh25Is3YBFpfvK/e/Of6PYvNmAWqxtV+6TD44Cdbv96AHqPAAAET1aUZ/BrlapsVO2TXrz5v/WOEPChdN5dEIBPEQCA4DmQljfct4W/AbPovsC/iwbMYjWfy5wqISB7NxOAACEAAMFiS3OL38/FYsZNvexMejVAvexMxmLGjXL5lbjsQQDAvwgAQLB8vfUHzcb/ZEO+2NTHCwO1xUm35YFfd3sxAH8iAADBsSfKnvzpVN9Ffmisa43/h8oPjdXTqb4L5bIjFAKBwCAAAMGQFZHXrRfWKlXZXK7e6hlHZHO5etvhLkDW+2kAPBYBAAiGfWk52W+tUhWrOHiSSPTbugZKJPptl0KgJe85jAiAPxAAAP+zRPn0H4sZN6W5iqVlmhb1slNwKQS+lucdQwzAAwQAwP/a1vwvTI+eyeP29++V4sL06FmHvQEA+BgBAPC3HVGKf7G4cWmNzDhuL9bBGplxYnHjUrnsiDI3AH8hAAD+1rbsb3vVudY1TCfbq841dwGAYCEAAP51IErxL5/LnOos/nWSSPTbLkcHW8IOgYBvEQAAf7JE2fFPpFm6836Uh3m5vD7kcvmVUAgEfIkAAPjTvfX0a5WqlGatI/FH8a+TYmnWOnI5J4AdAgEfIgAA/uOIsqPeXfFvXss0j2CNzMy7FAJ3hEIg4DsEAMB/2pb9bdWXrsTb/f6famCrvnTFOQGA/xEAAH/ZF6X4Z2aSjVQqV9Y20SOlUrmymUk2lMu2sEMg4CsEAMA/sqLs+CfSsVznaxu1lbTLXYDXwjkBgG8QAAD/OBSl+Dc9Pnws/i7+uTKM+MT0+PCxSyHwUMtAANoQAAB/cERkt/VCLGbcTL1YsLVM0wVTLxZsl3MCdoVCIOALBADAH9p2/Fuv2OcSjOJfJwPrFfu8w6MAAJoRAAD99qRZkvucmUk2TLPQ9s4ZNKZZqLoUAh1p/v8MQCMCAKBXVlw+/W/UVtJ6xum+1UpFOiwLzHo/DYC3CACAXgeiFP+s4uCJYcQntE3UZYlEv20VB09cCoEHWgYCICIEAEAnW5T9/mMx46Y0V5nVM07vlOYqsy6FwFeiPPoA4B0CAKBP263/2uJkQ4Jd/OtkoLY4qZ4WKMIOgYA2BABAjz1RlsOlU30X+aGxupZpPJAfGqunU30XymVHKAQCWhAAAO9lRVkKt1apyuZy9VbPON7ZXK7eskMg4A8EAMB7+6Ls928VB08SiX5b10Be6VAItIRzAgDPEQAAb1mifPq/K/5ZWqbRoDRXsVwKga+lJRQB6D0CAOCttqN+F6ZHzySA+/0/Q3FhevTM5VHAh24vBtAbBADAOzuiFP9icePSGplx3F4cZtbIjBOLG5fKZUeav0cAPEAAALzTtuxve9W51jWMbturzjXLAgF9CACANw5EKf7lc5nTKBT/Okkk+u18LnPqUgg80DIQEDEEAKD3LFF2/BMRqZedgvej+EuH34NXQiEQ6DkCANB79w6+WatUpTRrHUm0in+dFEuz1pHLOQE8CgB6jAAA9JYjSrHtrvg3r2UaH7JGZuZdCoE7ohQmAXQXAQDorbZlf1v1pSsJ537/TzWwVV+6Ylkg4C0CANA7+6IU/8xMspFK5craJvKpVCpXNjNJ9bAgS9ghEOgZAgDQG1lRdvwTEXm5vD7k/SjB0OH3hnMCgB4hAAC9cShK8W96fPhYKP69S3F6fPjYpRB4qGUaIOQIAED3OSKy23ohFjNupl4s2FqmCZCpFwu2yzkBu0IhEOg6AgDQfW07/q1X7HOh+PcQA+sV+5wdAoHeIwAA3bUvInbrBTOTbJhmoe0dDe5Ms1A1M8mGctkWkT3PhwFCjAAAdE9WlOLfWqUqG7WVtJ5xgmujtpLucBcg6/00QDgRAIDuORCX4p9hxCe0TRRQhhGfsIqDJy6FwAMtAwEhRAAAusMWZb9/in/PU5qrzLoUAl+J8ogFwNMQAIDuaCv+1RYnG0Lx7zkGaouT6uZAIhQCga4gAADPtyfKMrV0qu8iPzRW1zJNiOSHxurpVN+FctkRCoHAsxEAgOfJisun/83l6q2eccJnc7l663IXgB0CgWciAADPsy9K8c8qDp4kEv22roHCJpHot10KgZZwTgDwLAQA4OksUZb9xWLGTWmuMqtnnPAqzVUsl0Lga2k5bAnA4xAAgKdrO+p3YXr0TCj+9UJxYXr0jCODge4hAABPsyNK8S8WNy6tkRnH7cV4PmtkxonFjUvlsiPNPwsAj0QAAB4vKy7Fv+1V51rPONGxvepcsywQ6A4CAPB4+9Ly7HmtUpV8LnNK8a/3Eol+O5/LnLoUAg+0DAQEGAEAeBxLXHb8q5edgp5xoqfD7/UroRAIPAoBAHicewfStBT/itomip5iadY6cjkngEcBwCMQAICHc0QpnN0V/+a1TBNh1sjMvEshcEeUYiaAzggAwMO1Lfvbqi9dCcv+dBjYqi9dsSwQeDoCAPAwB6IU/8xMspFK5craJoq4VCpXNjNJ9bAgS9ghEHgQAgDwfllRin8iIi+X14e8HwWtOvwZcE4A8AAEAOD9DkUp/pVmrSOh+OcHxenx4WOXQuChlmmAACEAAO/miMhu64VYzLih+OcfUy8WbJdzAnaFQiDwTgQA4N3advxbr9jnQvHPTwbWK/Y5OwQCj0MAADrbFxG79YKZSTZMs9D2TgO9TLNQNTPJhnLZFpE9z4cBAoIAALjLinLU71qlKhu1lbSecfA+G7WVdIe7AFnvpwH8jwAAuDsQpfg3PT58bBjxCW0T4Z0MIz5hFQdPXAqBB1oGAnyOAAC0s8Vlv/+pFwu2lmnwYKW5yqxLIfCVKI9yABAAADdtxb/a4mRDKP4FwUBtcVLdHEiEQiDQhgAA3LcnyvKxdKrvIj80VtcyDR4tPzRWT6f6LpTLjlAIBO4hAABfyIrLp//N5eqtnnHwVJvL1VuXuwDsEAi0IAAAX9gXpfhnFQdPEol+W9dAeJpEot92KQRawjkBwOcIAECTJcqyv1jMuCnNVWb1jIPnKs1VLJdC4GtpOdQJiDICANDUdtTvwvTomVD8C7LiwvToGUcGA+4IAIDIjijFv1jcuLRGZhy3FyM4rJEZJxY3LpXLjjT/zIFIIwAg6rLiUvzbXnWu9YyDbtteda5ZFgi0IwAg6val5ZnwWqUq+VzmlOJfeCQS/XY+lzl1KQQeaBkI8AkCAKLMEpcd/+plp6BnHPRKhz/TV0IhEBFGAECU3TsopqX4V9Q2EXqlWJq1jlzOCeBRACKLAICockQpgt0V/+a1TIOes0Zm5l0KgTuiFECBqCAAIKralv1t1ZeuhGV/YTawVV+6Ylkg0EQAQBQdiFL8MzPJRiqVK2ubCJ5IpXJlM5NUDwuyhEIgIogAgKjJilL8ExF5ubw+5P0o0KHDn/Ur4ZwARAwBAFFzKErxrzRrHQnFvyjpVAg81DINoAkBAFHiiMhu64VYzLih+Bc91sjMvMs5AbtCIRARQgBAlLTt+Ldesc+F4l8UDaxX7HN2CESUEQAQFfsiYrdeMDPJhmkW2t4BEA2mWaiamWRDuWwLRwYjIggAiIKsKEf9rlWqslFbSesZB36xUVtJu9wFeC0UAhEBBABEwYEoxb/p8eFjw4hPaJsIvmAY8Ynp8eFjl0LggZaBAA8RABB2trjs9z/1YsHWMg18Z+rFgu1SCHwlyiMjIGwIAAi7tuJfbXGyIRT/8IWB2uKkujmQCIVAhBwBAGG2J8qyrnSq7yI/NFbXMg18Kz80Vk+n+i6Uy440/w4BoUQAQFhlxeXT/+Zy9VbPOPC7zeXqbYe7AFnvpwF6jwCAsDoQpfhnFQdPEol+W9dA8LdEot+2ioMnLoXAfS0DAT1GAEAYWeJS/CvNVWb1jIOgKM1VZl0Kga+l5fAoICwIAAijtqN+Kf7hgQYWpkfPODIYUUAAQNjsiFL8i8WNS4p/eChrZMaJxY1L5bIjzb9bQGgQABAmWXEp/m2vOtd6xkFQba861xQCEXYEAITJvrQ8q12rVCWfy5xS/MNjJRL9dj6XOVVCgCUUAhEiBACEhSXKfv+xmHFTLzsFPeMg6Oplp9Bhh0BLwzhA1xEAEBZtt/4XpkfPRKSoaR4EX9GlEJgVdghESBAAEAaOKAWtWNy4tEZmHB3DIDyskZl5l0LgjihFUyCICAAIg7Zlf1v1pStdwyBUBrbqS1csC0QYEQAQdAeiFP/MTLKRSuXK2iZCqKRSubKZSaqHBVnCkcEIOAIAgswSZcc/EZGXy+tD3o+CMOvwd+qVsCwQAZbQPQDwDAei7PdfmrWOJEDPZ7/57W/pHkGrX/6lr+ke4aGKb/9uffTxydtrWRE5FE4MREARABBUjojstl64K/7N6xnn6VreUCLF5bm6r1kjM/P/9Y+/dyP3t5TeFZFviMiRjpmA5+ARAIKqbdnf+gf2J8J+/+idgfWKfd5hh0AgcAgACKJ9EbFbL5iZZMM0C8H6SInAMc1C1cwkG8plW9ghEAFEAEDQZEXZ8W+tUpWN2kpazzjd9Sbk/4TBRm0l7XIX4LVQCETAEAAQNIeiFP+mx4ePDSM+oW0iRIphxCemx4ePXXYIPNAyEPBEBAAEiS1q8S9m3Ey9WLC1TIPImnqxYHc4J8DWMA7wJAQABEl78a9inwvFP3hvoLY4qW4OJEIhEAFCAEBQ7Imyvj+d6rug+Add8kNj9XSq70K57Aj7AiAgCAAIgqy4fPrfXK7e6hkHaNpcrt52uAuQ9X4a4HEIAAiCA1GKf1Zx8CSR6Ld1DQSIiCQS/bZVHDxxKQTuaxkIeAQCAPzOEmW//1jMuCnNVWb1jAPcV5qrzLoUAl9LyyFVgB8RAOB3bUf91hYnG0LxD/4xsDA9esaRwQgaAgD8bEeU4l8sblzmh8bqWqYBOrBGZpxY3LhULjvS/DsM+BIBAH6VFZfi3/aqc61nHODdtledawqBCBICAPxqX1qeoa5VqpLPZU4p/sGvEol+O5/LnCohwBIKgfApAgD8yBJlv/9YzLipl52CnnGAh6mXnUKHHQItDeMA70QAgB+13fpfmB49E5GipnmAhyq6FAKzwg6B8CECAPzGEaU4FYsbl9bIjKNjGOCxrJGZeZdC4I4ohVZANwIA/KZt2d9WfelK1zDAEwxs1ZeuWBYIvyMAwE8ORCn+mZlkI5XKlbVNBDxBKpUrm5mkeliQJRwZDB8hAMAvLFF2/BMRebm8PuT9KMDzdfi7+0pYFgifIADALw5E2e+/NGsdCcU/BFexNGsduRQCD7VMAygIAPADR0R2Wy/cFf/m9YwDdIc1MjPvsixwVygEwgcIAPCDtmV/6x/Ynwj7/SP4BtYr9nmHHQIBrQgA0G1fROzWC2Ym2TDNQtt3TCCITLNQNTPJhnLZFnYIhGYEAOiUFWXHv7VKVTZqK2k94wC9sVFbSbvcBXgtFAKhEQEAOh2KUvybHh8+Noz4hLaJgB4wjPjE9PjwMYVA+AkBALrYohb/YsbN1IsFW8s0QI9NvViwOxQCbQ3jAAQAaNNe/KvY50LxD+FFIRC+QgCADnuiLINKp/ouKP4h7EyzUE2n+i6Uy440vyYATxEA4LWsuHz631yu3uoZB/DW5nL1tsNdgKz30yDKCADw2oEoxT+rOHiSSPTbugYCvJRI9NtWcfDEpRB4oGUgRBYBAF6yRNnvPxYzbkpzlVk94wB6lOYqsy6FwFfSchgW0GsEAHip7ajf2uJkQyj+IXoGaouT6mmBIhwZDA8RAOCVHVGKf7G4cZkfGqtrmQbQLD80Vo/FjUvlsiPNrxWg5wgA8EJWXIp/26vOtZ5xAH/YXnWuKQRCFwIAvLAvLc821ypVyecypxT/EHWJRL+dz2VOlRBgCecEwAMEAPSaJcp+/7GYcVMvOwU94wD+Ui87BZdC4GuhEIgeIwCg19pu/S9Mj56JSFHTPIDfFBemR8/YIRBeIwCglxxRCk2xuHFpjcw4OoYB/MoamXFcCoE7ohRngW4iAKCX2pb9bdWXrnQNA/jZVn3pimWB8BIBAL1yIErxz8wkG6lUrqxtIsDHUqlc2cwk1b0BLGGHQPQIAQC9YImy45+IyMvl9SHvRwGCo8PXCDsEoicIAOiFe+uY1ypVKc1aR0LxD3ifYmnWOuKcAHiBAIBuc8S9+DevZRogYKyRmXmXQuCuUAhElxEA0G1ty/7uin/s9w88zMD6B/YnLAtErxEA0E37ImK3XqD4BzyeaRaqZibZUC7bwg6B6CICALolK8qOf2uVqmzUVtJ6xgGCbaO2kna5C/BaOCcAXUIAQLccilL8mx4fPjaM+IS2iYAAM4z4xPT48LFLIfBQy0AIHQIAusGRZknpc7GYcTP1YsHWMg0QElMvFmyXcwJ2RXnUBjwFAQDd0Hbrf71inwvFP+C5BtYr9jmFQPQCAQDPtSfK8iQzk2yYZqHtOxaAxzPNQjWd6rtQLjvS/NoDnowAgOfIisuyv9VKRc80QEhtLldvO9wFyHo/DcKCAIDnOBCl+GcVB08SiX5b10BAGCUS/bZVHDxhh0B0EwEAT2WLst9/LGbclOYqs3rGAcKtNFeZdSkEck4AnowAgKdqu/VfW5xsCMU/oFcGaouT6mmBIhwZjCciAOApdkQp/qVTfRf5obG6lmmAiMgPjdVdzglwRDl/A3gIAgAeKysun/43l6u3esYBomV71bmmEIhuIADgsfal5ZnjWqUq+VzmlOIf4I1Eot/O5zKnSgiwhHMC8EgEADyGJcqmP7GYcVMvOwU94wDRVC87BZdC4GuhEIhHIADgMe6VjdYqVVmYHj0TkaKmeYCoKi5Mj56xQyCegwCAh3JEKf7F4salNTLjuL0YQG9ZIzOOSyFwR5SvU6ATAgAequ3T//aqc61rGAAiW/WlK5YF4qkIAHiIA1GKf2Ym2aD4B+iVSuXKZiap7g1gCTsE4gEIAHgfS5Qd/0REXi6vD3k/CgBVh69FdgjEexEA8D731hevVapSmrWOhOIf4BfF0qx1xDkBeCwCAN7FEWWHsbvi37yWaQC4skZm5l0KgbtCIRDvQADAu7Tt+LdVX7oS9vsH/GZg/QP7E5YF4jEIAOhkX5on/n3OzCQbqVSurGUaAO9kmoWqmUk2lMu2sEMgOiAAwE1WlB3/1ipV2aitpPWMA+AhNmoraZe7AK+FcwLgggAAN4eiFP+mx4ePDSM+oW0iAO9lGPGJ6fHhY5dC4KGWgeBrBACoHGmWhz4Xixk3Uy8WbC3TAHiUqRcLtss5AbuiPNIDCABQtd36X6/Y50LxDwiKgfWKfU4hEO9DAECrPVGWDZmZZMM0C23fSQD4l2kWqulU34Vy2ZHm1zggIgQAfCErLsv+VisVPdMAeJbN5epth7sAWe+ngR8RAPDWgSjFP6s4eMJ+/0AwJRL9tlUcPGGHQHRCAIBIsxx0b7//WMy4Kc1VZvWMA6AbSnOVWZdC4CuhEAghAKCp7dZ/bXGyIRT/gKAbqC1OqqcFilAIhBAA0Nzr32m9kE71XeSHxupapgHQVfmhsXqHQuCO99PATwgA0ZYVl0//m8vVWz3jAOgFCoFwQwCItn1pOTN8rVKVfC5zSvEPCJdEot/O5zKnSgiwhHMCIo0AEF2WKJv+xGLGTb3sFPSMA6CX6mWn4FIIfC0tHwIQLQSA6Pqw9QdrlaosTI+eiUhR0zwAequ4MD165vIo4EO3FyP8CADR5IhS/IvFjUtrZMZxezGAcLBGZpxY3LhULjuifD9ANBAAoqnt0//2qnOtaxgA3tleda65CwARAkAUHYhS/DMzyQbFPyAaEol+28wk1b0BLGGHwMghAESLJcqOfyIiL5fXh7wfBYAuHb7mXwmFwEghAETLvXW/a5WqlGatI6H4B0RNsTRrHbmcE8AOgRFCAIgOR5Sdv+6Kf/NapgGglTUyM+9SCNwRCoGRQQCIjrYd/7bqS1fCfv9AVA1s1ZeuOCcguggA0bAvyulfZibZSKVyZS3TAPCFVCpXNjPJhnLZFnYIjAQCQPhlRdnxb61SlY3aSlrPOAD8ZKO2kna5C/BaOCcg9AgA4XcoSvFvenz42DDiE9omAuAbhhGfmB4fPnYpBB5qGQieIQCEmyMiu60XYjHjZurFgq1lGgC+NPViwXY5J2BXKASGGgEg3NqKf+sV+1wo/gG4b2C9Yp93eBSAkCIAhNeeuBT/TLPQ9hUOAKZZqLoUAh1pfi9BCBEAwikrLp/+Kf4BeJfVSkU6LAvMej8Neo0AEE4HohT/rOLgCcU/AO+SSPTbVnHwxKUQeKBlIPQUASB8bFH2+4/FjJvSXGVWzzgAgqQ0V5l1KQS+EuWRIoKPABA+bbf+a4uTDaH4B+BhBmqLk+ppgSLsEBg6BIBw2RNl2U461XeRHxqra5kGQCDlh8bq6VTfhXLZEeU8EQQbASA8suKy49/mcvVWzzgAgmxzuXpLITDcCADhsS8tZ3m/Lf4lEv22roEABFci0W/nc5lTJQRYwjkBoUEACAdLlE//d8U/S8s0AEKhXnYKLoXA19LyYQPBRQAIhw9bf7BWqcrC9OiZiBQ1zQMgHIoL06NnLo8CPnR7MYKFABB8O6IU/2Jx49IamXHcXgwAj2GNzDixuHGpXHaEcwICjwAQfG3L/rZXnWtdwwAIn+1V55q7AOFDAAi2A1GKf/lc5pTiH4BuSiT6bTOTVPcGsIQdAgONABBclig7/ok0SzvejwIg7F4urw+5XH4lFAIDiwAQXPfW465VqlKatY6E4h+A3iiWZq0jl3MC2CEwoAgAweSIsiPXXfFvXss0ACLBGpmZdykE7giFwEAiAART27K/rfrSlbDfP4DeGtiqL11xTkA4EACCZ1+U4p+ZSTZSqVxZ20QAIiOVypXNTLKhXLaFHQIDhwAQLFlRdvwT6VjOAYCe2KitpF3uArwWzgkIFAJAsByKUvybHh8+Fop/ADxkGPGJ6fHhY5dC4KGWgfAkBIDgcERkt/VCLGbcTL1YsLVMAyDSpl4s2C7nBOwKhcDAIAAER9uOf+sV+1wo/gHQY2C9Yp93eBSAACAABMOeNEs2nzMzyYZpFtq+8gDAK6ZZqLoUAh1pfs+CzxEA/C8rLp/+N2oraT3jAMAXVisV6bAsMOv9NHgMAoD/HYhS/LOKgyeGEZ/QNhEA3Ekk+m2rOHjiUgg80DIQHowA4G+2KPv9x2LGTWmuMqtnHABoV5qrzLoUAl+J8ugS/kIA8Le2W/+1xcmGUPwD4C8DtcVJ9bRAEXYI9DUCgH/tibKcJp3qu8gPjdW1TAMA75AfGqunU30XymVHlHNL4B8EAH/KirKUZq1Slc3l6q2ecQDg/TaXq7cUAoODAOBP+6Ls928VB08SiX5b10AA8D6JRL+dz2VOlRBgCecE+BIBwH8sUT793xX/LC3TAMAj1MtOwaUQ+FpaPtTAHwgA/tN21O/C9OiZsN8/gGAoLkyPnrk8CvjQ7cXQhwDgLzuiFP9icePSGplx3F4MAH5kjcw4sbhxqVx2hHMCfIUA4C9ty/62V51rXcMAwFNtrzrX3AXwNwKAfxyIUvzL5zKnFP8ABFEi0W+bmaS6N4Al7BDoGwQAf7BE2fFPpFmm8X4UAOiOl8vrQy6XXwmFQF8gAPjDvXWya5WqlGatI6H4ByDYiqVZ68jlnAB2CPQBAoB+jig7Zd0V/+a1TAMAXWSNzMy7FAJ3hEKgdgQA/dqW/W3Vl66E/f4BhMPAVn3pikKg/xAA9NoXpfhnZpKNVCpX1jYRAHRZKpUrdygE7msZCCJCANApK8qOfyIdSzMAEGgdvre9Fs4J0IYAoM+hKMW/6fHhY6H4ByCcitPjw8cuhcBDLdOAAKCJIyK7rRdiMeNm6sWCrWUaAPDA1IsF2+WcgF2hEKgFAUCPth3/1iv2uVD8AxBuA+sV+7zDkcHwGAHAe3siYrdeMDPJhmkW2r4iED1GyP8BTLNQNTPJhnLZlub3RniIAOCtrLh8+t+oraT1jAMA3tuoraQ73AXIej9NdBEAvHUgSvHPKg6eGEZ8QttEAOAxw4hPWMXBE5dC4IGWgSIqoXuACLFF2e8/FjNuSnOVWT3jwC9cPgkBoVeaq8z+7+//5o3c7z69EpFviEhDx0xRQwDwTtut/9riZENE6nrGgR/88i99TfcIgC4DtcXJ488+e1P/6OOT1utfF5Ff1DRTpPAIwBt7oixzSaf6LvJDY7z5A4is/NBYPZ3qu1AuO0Ih0BMEgN7Lisun/83l6q2ecQDAPzaXq7cuj8HYIdADBIDe2xeX4l8i0W/rGggA/CKR6LddCoGWcE5AzxEAessSZb9/in8AcF9prmK57BD4WloOS0P3EQB6q+2o34Xp0TNhxz8AaFVcmB4948hgbxEAemdHlOJfLG5cWiMzjtuLASDKrJEZJxY3LpXLjjS/l6IHCAC9kRWX4t/2qnOtZxwA8L/tVeeacwK8QwDojX1peXa1VqlKPpc5pfgHAJ0lEv12Ppc5dSkEHmgZKOQIAN1nicuOf/WyU9AzDgAER4fvla+EQmDXEQC6796BFi3Fv6K2iQAgOIqlWevI5ZwAHgV0GQGguxxRCit3xb95LdMAQABZIzPzLoXAHVGK1XgeAkB3tS3726ovXQnL/gDgMQa26ktXLAvsLQJA9xyIUvwzM8lGKpUra5sIAAIqlcqVzUyywQ6BvUMA6I6sKMU/EZGXy+tD3o8CAOHQ4Xso5wR0CQGgOw5FKf6VZq0jofgHAM9RnB4fPnYpBB5qmSZkCADP54jIbuuFWMy4ofgHAM839WLBdjknYFcoBD4bAeD52nb8W6/Y50LxDwC6YWC9Yp+zQ2D3EQCeZ19E7NYLZibZMM1C299UAMDTmGahamaSDeWyLSJ7ng8TIgSAp8uKctTvWqUqG7WVtJ5xACC8Nmor6Q53AbLeTxMOBICnOxCl+Dc9PnxsGPEJbRMBQEgZRnzCKg6euBQCD7QMFAIEgKexxWW//6kXC7aWaQAgAkpzlVmXQuArUR7F4mEIAE/TVvyrLU42hOIfAPTSQG1xUt0cSIRC4JMQAB5vT5TlJ+lU30V+aKyuZRoAiJD80Fg9neq7UC47QiHw0QgAj5MVl0//m8vVWz3jAED0bC5Xb13uArBD4CMRAB5nX5Tin1UcPEkk+m1dAwFA1CQS/bZLIdASzgl4FALAw1miLPuLxYyb0lxlVs84ABBdpbmK5VIIfC0th7Lh3QgAD9d21O/C9OiZUPwDAB2KC9OjZxwZ/HQEgIfZEaX4F4sbl9bIjOP2YgBA71kjM04sblwqlx1pfs/GexAA3i8rLsW/7VXnWs84AIC3tleda5YFPg0B4P32peWZ0lqlKvlc5pTiHwDol0j02/lc5tSlEHigZaAASegewOcscdnxr152CnrGQZh8++g7Hf/dZ2/evPe/jxlGN8e5/3O+56eOxe6/4F0vN1peayjXDBH5xaWVxw0JKOplp/DNb39LvfxKRL4hIp94PU9QEADe7d5BEy3FP0fXQAiPz968kX/3H/6j7jG0+mdf29A9AsKhWJq1jkTE+ejjk7fXstL8Hv6PNc3kezwC6MwRpUhyV/yb1zINAKAja2Rm3qUQuCN8YOuIANBZ27K/rfrSlbDsD93y/rv8offmM34T0DUDW/WlK5YFPhwBwN2BKMU/M5NspFK5sraJAADvlErlymYmqR4WZAk7BLoiALTLilL8ExF5ubw+5P0oAIDH6PC9mnMCXBAA2h2KUvy7K5cUNc0DhBYPANADxenx4WPlLkBWmt/b0YIAcJ8jIrutF2Ix44biH3qBNz+gN6ZeLNgu5wTsCoXAewgA97Xt+Ldesc+F4h8ABMnAesU+Z4fAdyMAfGFfROzWC2Ym2TDNQtvfIACAv5lmoWpmkg3lsi0UAj9HAGjKinLU71qlKhu1lbSecQAAz7VRW0m73AWgEHiHANB0IErxb3p8+Ngw4hPaJgIigH0A0EuGEZ/oUAg80DKQzxAAmreE2vb7n3qxYGuZBgDQNR0Kga9EeeQbRQQAl+JfbXGyIRT/0GNv3nymewQgCgZqi5Pq5kAiFAIjHwD2RFkWkk71XeSHxupapgEAdF1+aKyeTvVdKJcdab4HRFaUA0BWXD79by5Xb/WMAwDolc3l6m2HuwBZ76fxhygHgH1Rin9WcfAkkei3dQ0EAOiNRKLftoqDJy6FwH0tA/lAVAOAJcqyv1jMuCnNVWb1jAMA6LXSXGXWpRD4WloOf4uSqAaAtqN+F6ZHz4TiHwCE2cDC9OgZRwY3RTEA7IhS/IvFjUtrZMZxezEAIDyskRknFjculcuONN8bIiVqASArLsW/7VXnWs84AACvba861xQCoxcA9qXlWc9apSr5XOaU4h8AREci0W/nc5lTJQRYErFCYJQCgCUuO/7Vy05BzzgA2AgYutTLTqHDDoGWhnG0iFIAuHd7p6X4V9Q2EQBAl6JLITArEdohMCoBwBGl4HFX/JvXMg0AQDtrZGbepRC4I0pRPKyiEgDalv1t1ZeuhGV/ABBlA1v1pauoLguMQgA4EKX4Z2aSjVQqV9Y2ESDCA3DAB1KpXNnMJNXDgiyJwJHBYQ8AlijFPxGRl8vrQ96PAgDwow7vCa8k5MsCwx4ADkQp/pVmrSOh+AcA+EKxNGsduRQCD7VM45EwBwBHRHZbL1D8g5/wBADwD2tkZt5lWeCuhLgQGOYA0Lbj3/oH9idC8Q8A0G5gvWKfd9ghMJTCGgD2RcRuvWBmkg3TLLT9yQIAICJimoWqmUk2lMu2hHSHwDAGgKwoR/2uVaqyUVtJ6xkHQCeffcaDEPjLRm0l7XIX4LWEsBAYxgBwKErxb3p8+Ngw4hPaJgIABIJhxCemx4ePXQqBB1oG6qGwBQBb1OJfzLiZerFga5kGABA4Uy8W7A7nBNgaxumZsAWA9uJfxT4Xin8AgIcbqC1OqpsDiYSsEBimALAnynKNdKrvguIfAOCx8kNj9XSq70K57EjzvSYUwhIAsuLy6X9zuXqrZxwAQNBtLldvO9wFyHo/TfeFJQAciFL8s4qDJ4lEv61rIABAsCUS/bZVHDxxKQTuaxmoy8IQACxR9vuPxYyb0lxlVs84AICwKM1VZl0Kga+l5ZC5oApDAGg76re2ONkQin8AgOcbWJgePQvjkcFBDwA7ohT/YnHjMj80VtcyDQAgdKyRGScWNy6Vy44034MCK8gBICsuxb/tVedazzgAgLDaXnWuw1YIDHIA2JeWZzBrlarkc5lTin8AgG5LJPrtfC5zqoQASwJcCAxqALBE2e8/FjNu6mWnoGccAEDY1ctOocMOgZaGcZ4tqAGg7db/wvTomYgUNc0DAAi/okshMCsB3SEwiAHAEaV4EYsbl9bIjKNjGABAdFgjM/MuhcAdUQrpQRDEANC27G+rvnSlaxgAQKQMbNWXrsKwLDBoAeBAlOKfmUk2UqlcWdtEAIBISaVyZTOTVA8LsiRgRwYndA/wCJYoO/6JiLxcXh/yfhSgO7ac+1tWfPbZm0f/HLGY8aDXGW3/x8MYhvvnhLafxhCJGZ1/8phhPPrXBvzq5fL60De//S318isRORSRH3k9z1MEKQAciLLff2nWOpIAPncBRES21/6R7hEAPF3x7XvQRx+fvL2WlWYA2NMy0SMF5RGAIyK7rRfuin/zesYBAESdNTIz77IscFcC8sE0KAGgbdnf+gf2J8J+/wAAfQbWK/Z5hx0CfS8IAWBfROzWC2Ym2TDNQtvvOAAAXjLNQtXMJBvKZVsCsEOg3wNAVpQd/9YqVdmoraT1jAMAwH0btZW0y12A1+LzcwL8HgAORSn+TY8PHxtGfELbRAAAtDCM+MT0+PCxyw6BB1oGeiA/BwBb1OJfzLiZerFga5kGAIAOpl4s2B3OCbA1jPMgfg4A7cW/in0uFP8AAP4zUFucVDcHEvFxIdCvAWBPlGUU6VTfBcU/AIBf5YfG6ulU34Vy2RGf7gvgxwCQFZdP/5vL1Vs94wAA8DCby9XbDncBst5P825+DAAHohT/rOLgSSLRb+saCACAh0gk+m2rOHgShEKg3wKAJcp+/7GYcVOaq8zqGQcAgMcpzVVmOxQCLQ3jdOS3ANB21G9tcbIhFP8AAMHRqRDoqyOD/RQAdkQp/sXixmV+aKzu+moAAHwqPzRWj8WNS+WyI833Ol/wSwDIikvxb3vVudYzDgAAz7O96lz7uRDolwCwLy3PRtYqVcnnMqcU/wAAQZVI9Nv5XOZUCQGW+OScAD8EAEuU/f5jMeOmXnYKesYBAKA76mWn4FIIfC0+KAT6IQC03fpfmB49E5GipnkAAOiW4sL06JkfdwjUHQAcUQoRsbhxaY3MODqGAQCg26yRGcelELgjSvHda7oDQNuyv6360pWuYQAA6IWt+tKV35YF6gwAe6IU/8xMspFK5craJgIAoAdSqVzZzCTVvQEs0XhOgM4A8Fq98HJ5fUjHIAAA9FqH97i290Kv6AoAjiif/q3i4IlQ/AMAhFfR5ZwASzR1AXQFgD31QmmuYnk/BgAA3unwXrfn8Rgioi8AbLf+wMwkG8KnfwBA+BXv3vNabbu9sNd0BABblON+P7CnfqxhDgAAPPeBPfVjl+OCba/n0BEAHPWCaRY47hcAEAkd3vMcr+fQHgDSqb4L4bhfAEB0DNy997WyvR5CRwDItv7gq8WhH2iYAQAAbVze+yyvZ9ARAOqtP/jql7+S0jADAADaFL/0pbhy6Re8nkHrVsBrlar09aUIAACASOnv/9m/41IE9JTuswAkHv8Zz1MPAAA6xeM/Y+meQXsAAAAggrSX3wkAAABEEAEAAIAI8kEAePM/dE8AAICXfvrTv/pD3TNoDQAffXwin376/R/qnAEAAK/96ff/1//56OMTrTPoCAD3Us/Zf/9un4YZAADQ5uJP/iyrXDr2egYdAaDR+oMf/sWPyyJypWEOAAA899Of/tUffvrjv7aVy0dez6EjAPy6euH49OhSwxwAAHjuo9///Tcut/+PvJ5DVwD43tsffPTxifzwL35c/slP/vJUwywAAHjmkz/9oyOXT//HEpEAICKy3/qDjz4+kd88+s+TrAgAAITVp59enfzB+SeOy6f/Aw3jaAsAvy4iv9F64Tsnvzfwa7/17b9LCAAAhM1Pf/pXf/g7HzdmXd78/5Vo+PQvoncZ4J4oKwLehoBPP73SuzYCAIAu+fTTq5N/+9u/+wvfOfk9dfvfXxVNn/5FRBK6fmER+ZGIONJMPp8fCPSdk98b+OyzN9V87run9bLz90TE1DIdAADPc/Xb/+l3/vzTH/911eWT/7Eoj8O9pnsnwB9JMwTcuxPwthj4a7/1m28++dM/OhKWCQIAguPqD/7bxyff/Pa3Cp/++K/tDm/+O9J8D9RG5x2At34kLncC7n7DBj777I3zB+efSDrVdzHz84U/G/m5r/5sPP4zQyJS0DArAACqq5/85C8vf/Dn37/9o+9eDd/+5G8mRKTQYac/X7z5i/gjAIh8EQIORWS39V+0/AZO/PvflYm1StXLuQAAeJ+CdH7Db/Wr0uy/+YJfAoBIMwTsSXOFwDekw1nJuvdOBgDgkb4nzfe3I71j3Ke7A+Dm10XEkubSiO+985UAAPjX90TkV6T5nnakdRIXfroD0OpH0lwacSAitjSflzjS/E0c1TEQAADv8T1pnnfTkOaH2Ya+Ud7PePPmje4ZAACAx/z4CAAAAPQYAQAAgAgiAAAAEEEEAAAAIogAAABABBEAAACIIAIAAAARRAAAACCCCAAAAEQQAQAAgAgiAAAAEEEEAAAAIogAAABABBEAAACIIAIAAAARRAAAACCCCAAAAEQQAQAAgAgiAAAAEEEEAAAAIogAAABABBEAAACIIAIAAAARRAAAACCCCAAAAEQQAQAAgAgiAAAAEEEEAAAAIogAAABABBEAAACIIAIAAAARRAAAACCCCAAAAEQQAQAAgAgiAAAAEEEEAAAAIogAAABABBEAAACIIAIAAAARRAAAACCCCAAAAEQQAQAAgAgiAAAAEEEEAAAAIogAAABABBEAAACIIAIAAAARRAAAACCCCAAAAEQQAQAAgAgiAAAAEEEEAAAAIogAAABABBEAAACIIAIAAAARRAAAACCCCAAAAEQQAQAAgAgiAAAAEEH/H970oy1ICdKaAAAAAElFTkSuQmCC",icons.warning_yellow_dark="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAACXBIWXMAAAsTAAALEwEAmpwYAAA7sGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMwMTQgNzkuMTU2Nzk3LCAyMDE0LzA4LzIwLTA5OjUzOjAyICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNC0wNi0xNlQxMzowMzo0NCswNDowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE2LTA1LTAzVDE2OjQ0OjAzKzAzOjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxNi0wNS0wM1QxNjo0NDowMyswMzowMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDo1YWM2NjIyMC02OTRkLTQyYjQtODVjYi1iODNjNzM3YmUzNGE8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiZmE4Nzc5MS01MWJiLTExNzktOTQ3Zi1jY2U3N2JkMDFiNGQ8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDpjYzUzNjFlYS1jNzU4LTQxNDMtOGE4OC0xMzIxMWY2NDY0Y2Q8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6Y2M1MzYxZWEtYzc1OC00MTQzLThhODgtMTMyMTFmNjQ2NGNkPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE0LTA2LTE2VDEzOjAzOjQ0KzA0OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6NWJlMjQ0YTEtMmM3MS00MzE0LWIzZGUtOTdhNGVmNzc3YTkyPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE1LTA1LTAzVDE4OjUwOjIxKzAzOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6NWFjNjYyMjAtNjk0ZC00MmI0LTg1Y2ItYjgzYzczN2JlMzRhPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTA1LTAzVDE2OjQ0OjAzKzAzOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NTEyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjUxMjwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAg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",icons.warning_yellow_light="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAABN2lDQ1BBZG9iZSBSR0IgKDE5OTgpAAAokZWPv0rDUBSHvxtFxaFWCOLgcCdRUGzVwYxJW4ogWKtDkq1JQ5ViEm6uf/oQjm4dXNx9AidHwUHxCXwDxamDQ4QMBYvf9J3fORzOAaNi152GUYbzWKt205Gu58vZF2aYAoBOmKV2q3UAECdxxBjf7wiA10277jTG+38yH6ZKAyNguxtlIYgK0L/SqQYxBMygn2oQD4CpTto1EE9AqZf7G1AKcv8ASsr1fBBfgNlzPR+MOcAMcl8BTB1da4Bakg7UWe9Uy6plWdLuJkEkjweZjs4zuR+HiUoT1dFRF8jvA2AxH2w3HblWtay99X/+PRHX82Vun0cIQCw9F1lBeKEuf1UYO5PrYsdwGQ7vYXpUZLs3cLcBC7dFtlqF8hY8Dn8AwMZP/fNTP8gAAAAJcEhZcwAACxMAAAsTAQCanBgAAAamaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjQwMzYsIDIwMTkvMDgvMTMtMDE6MDY6NTcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE0IChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxNC0wNi0xNlQxMzowMzo0NCswNDowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTktMTEtMjZUMTE6NTI6MDIrMDM6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTktMTEtMjZUMTE6NTI6MDIrMDM6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjJiMzdhYjBiLWE5NDAtNGE4OS04YTdlLTg3MGRkNzFmZjYxOSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmJmYTg3NzkxLTUxYmItMTE3OS05NDdmLWNjZTc3YmQwMWI0ZCIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmNjNTM2MWVhLWM3NTgtNDE0My04YTg4LTEzMjExZjY0NjRjZCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6Y2M1MzYxZWEtYzc1OC00MTQzLThhODgtMTMyMTFmNjQ2NGNkIiBzdEV2dDp3aGVuPSIyMDE0LTA2LTE2VDEzOjAzOjQ0KzA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NWJlMjQ0YTEtMmM3MS00MzE0LWIzZGUtOTdhNGVmNzc3YTkyIiBzdEV2dDp3aGVuPSIyMDE1LTA1LTAzVDE4OjUwOjIxKzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0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",icons.warning_green_dark="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAABN2lDQ1BBZG9iZSBSR0IgKDE5OTgpAAAokZWPv0rDUBSHvxtFxaFWCOLgcCdRUGzVwYxJW4ogWKtDkq1JQ5ViEm6uf/oQjm4dXNx9AidHwUHxCXwDxamDQ4QMBYvf9J3fORzOAaNi152GUYbzWKt205Gu58vZF2aYAoBOmKV2q3UAECdxxBjf7wiA10277jTG+38yH6ZKAyNguxtlIYgK0L/SqQYxBMygn2oQD4CpTto1EE9AqZf7G1AKcv8ASsr1fBBfgNlzPR+MOcAMcl8BTB1da4Bakg7UWe9Uy6plWdLuJkEkjweZjs4zuR+HiUoT1dFRF8jvA2AxH2w3HblWtay99X/+PRHX82Vun0cIQCw9F1lBeKEuf1UYO5PrYsdwGQ7vYXpUZLs3cLcBC7dFtlqF8hY8Dn8AwMZP/fNTP8gAAAAJcEhZcwAACxMAAAsTAQCanBgAAAamaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjQwMzYsIDIwMTkvMDgvMTMtMDE6MDY6NTcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE0IChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxNC0wNi0xNlQxMzowMzo0NCswNDowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTktMTEtMjZUMTE6MTE6MzMrMDM6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTktMTEtMjZUMTE6MTE6MzMrMDM6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmFmNTViZmJlLTE4YzctNGUyOS05NTY3LTBmN2YxYjBmMzFiMSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmJmYTg3NzkxLTUxYmItMTE3OS05NDdmLWNjZTc3YmQwMWI0ZCIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmNjNTM2MWVhLWM3NTgtNDE0My04YTg4LTEzMjExZjY0NjRjZCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6Y2M1MzYxZWEtYzc1OC00MTQzLThhODgtMTMyMTFmNjQ2NGNkIiBzdEV2dDp3aGVuPSIyMDE0LTA2LTE2VDEzOjAzOjQ0KzA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NWJlMjQ0YTEtMmM3MS00MzE0LWIzZGUtOTdhNGVmNzc3YTkyIiBzdEV2dDp3aGVuPSIyMDE1LTA1LTAzVDE4OjUwOjIxKzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0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",icons.warning_green_light="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAABN2lDQ1BBZG9iZSBSR0IgKDE5OTgpAAAokZWPv0rDUBSHvxtFxaFWCOLgcCdRUGzVwYxJW4ogWKtDkq1JQ5ViEm6uf/oQjm4dXNx9AidHwUHxCXwDxamDQ4QMBYvf9J3fORzOAaNi152GUYbzWKt205Gu58vZF2aYAoBOmKV2q3UAECdxxBjf7wiA10277jTG+38yH6ZKAyNguxtlIYgK0L/SqQYxBMygn2oQD4CpTto1EE9AqZf7G1AKcv8ASsr1fBBfgNlzPR+MOcAMcl8BTB1da4Bakg7UWe9Uy6plWdLuJkEkjweZjs4zuR+HiUoT1dFRF8jvA2AxH2w3HblWtay99X/+PRHX82Vun0cIQCw9F1lBeKEuf1UYO5PrYsdwGQ7vYXpUZLs3cLcBC7dFtlqF8hY8Dn8AwMZP/fNTP8gAAAAJcEhZcwAACxMAAAsTAQCanBgAAAamaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0OCA3OS4xNjQwMzYsIDIwMTkvMDgvMTMtMDE6MDY6NTcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE0IChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxNC0wNi0xNlQxMzowMzo0NCswNDowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTktMTEtMjZUMTE6NDc6MjQrMDM6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTktMTEtMjZUMTE6NDc6MjQrMDM6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmVlM2IwNGU1LTYxNzgtNGM3Ny04YmJkLTgyZTgxY2YwZDM1MCIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmJmYTg3NzkxLTUxYmItMTE3OS05NDdmLWNjZTc3YmQwMWI0ZCIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmNjNTM2MWVhLWM3NTgtNDE0My04YTg4LTEzMjExZjY0NjRjZCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6Y2M1MzYxZWEtYzc1OC00MTQzLThhODgtMTMyMTFmNjQ2NGNkIiBzdEV2dDp3aGVuPSIyMDE0LTA2LTE2VDEzOjAzOjQ0KzA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NWJlMjQ0YTEtMmM3MS00MzE0LWIzZGUtOTdhNGVmNzc3YTkyIiBzdEV2dDp3aGVuPSIyMDE1LTA1LTAzVDE4OjUwOjIxKzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0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",icons.eraser="M15.6,5.9l-4.7-4.7c-0.3-0.3-0.7-0.4-1-0.4c-0.4,0-0.8,0.1-1,0.4L0.4,9.5C0.2,9.8,0,10.2,0,10.5c0,0.4,0.2,0.8,0.4,1l3.3,3.2C4,15.1,4.5,15.3,5,15.3h2.4c0.5,0,0.9-0.2,1.3-0.5l6.9-6.8c0.3-0.3,0.4-0.6,0.4-1C16,6.5,15.8,6.1,15.6,5.9z M7.7,13.7c-0.1,0.1-0.2,0.1-0.3,0.1H5c-0.1,0-0.2,0-0.3-0.1l-3.2-3.2l3.8-3.8l4.7,4.7L7.7,13.7z",icons.eraser="M23.4,8.8c0.8-0.8,0.8-2,0-2.8L18,0.6c-0.8-0.8-2-0.8-2.8,0L4.5,11.3l-3.9,3.9c-0.8,0.8-0.8,2,0,2.8L6,23.4C6.3,23.7,6.6,23.9,7,24c0,0,0.1,0,0.2,0h12.9c0.2,0,0.4-0.2,0.4-0.4s-0.2-0.4-0.4-0.4H9l0.8-0.8H18c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4h-7.4l0.8-0.8H18c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4h-5.8l0.5-0.5L23.4,8.8z M16.5,2.1C16.5,2.1,16.5,2.1,16.5,2.1c0.2-0.2,0.4-0.2,0.6,0c0,0,0,0,0,0l4.8,4.8c0.2,0.2,0.2,0.4,0,0.6c0,0,0,0,0,0c-0.2,0.2-0.4,0.2-0.6,0c0,0,0,0,0,0l-4.8-4.8C16.4,2.5,16.4,2.3,16.5,2.1z M8.2,22.8c-0.5,0.5-1.2,0.5-1.7,0l-5.4-5.4c-0.5-0.5-0.5-1.2,0-1.7l3.6-3.6l7.1,7.1L8.2,22.8z",icons.trash="M14.8,4.3h-1.2h-1.8V2.6c0-0.3-0.3-0.6-0.6-0.6H6.7C6.3,2,6.1,2.3,6.1,2.6v1.8H4.3H3.2c-0.3,0-0.6,0.3-0.6,0.6s0.3,0.6,0.6,0.6h0.6v8.8c0,1,0.8,1.8,1.8,1.8h7c1,0,1.8-0.8,1.8-1.8V5.5h0.6c0.3,0,0.6-0.3,0.6-0.6S15.2,4.3,14.8,4.3z M7.2,3.2h3.5v1.2H7.2V3.2z M13.1,14.2c0,0.3-0.3,0.6-0.6,0.6h-7c-0.3,0-0.6-0.3-0.6-0.6V5.5h1.8h4.7h1.8L13.1,14.2L13.1,14.2z M7.2,6.7c-0.3,0-0.6,0.3-0.6,0.6v5.2c0,0.3,0.3,0.6,0.6,0.6c0.3,0,0.6-0.3,0.6-0.6V7.2C7.8,6.9,7.6,6.7,7.2,6.7z M10.8,6.7c-0.3,0-0.6,0.3-0.6,0.6v5.2c0,0.3,0.3,0.6,0.6,0.6c0.3,0,0.6-0.3,0.6-0.6V7.2C11.3,6.9,11.1,6.7,10.8,6.7z",icons.hammer="M26.5,29.1c0.2,0.2,0.4,0.2,0.6,0l1.8-1.8c0.2-0.2,0.2-0.4,0-0.6L15.8,13.4l-2.4,2.4L26.5,29.1z M7.8,10.4l1.9-1.9L10.2,8L10,7.6c-0.1,0-0.2-0.1-0.3-0.1s-0.2,0-0.3,0.1L7.5,9.5c-0.2,0.2-0.2,0.4,0,0.6L7.8,10.4z M9.4,18.6l-4.3-4.2l9.2-9.2l4.3,4.3L9.4,18.6z",icons.hammer="M14.5,15.9c0.1,0.1,0.2,0.1,0.3,0l1-1c0.1-0.1,0.1-0.2,0-0.3L8.3,6.8L6.9,8.2L14.5,15.9z M3.6,5l1.1-1.1l0.3-0.3L4.9,3.4c-0.1-0.1-0.3-0.1-0.3,0L3.4,4.5c-0.1,0.1-0.1,0.2,0,0.3L3.6,5z M4.5,9.8L2,7.4L7.4,2l2.5,2.5L4.5,9.8z",icons.roller="M15,3.9h-1V3.1c0-0.6-0.5-1.1-1.1-1.1H4.4C3.8,2,3.3,2.5,3.3,3.1v0.8H3c-0.3,0-0.5,0.2-0.5,0.5S2.8,4.8,3,4.8h0.3v0.8c0,0.6,0.5,1.1,1.1,1.1h8.4c0.6,0,1.1-0.5,1.1-1.1V4.8h0.5v2.8H9c-0.3,0-0.5,0.2-0.5,0.5v1.8H8.5c-0.6,0-1.1,0.5-1.1,1.1v4c0,0.6,0.5,1.1,1.1,1.1h1.1c0.6,0,1.1-0.5,1.1-1.1v-4c0-0.6-0.5-1.1-1.1-1.1H9.5V8.5H15c0.3,0,0.5-0.2,0.5-0.5V4.3C15.4,4.1,15.2,3.9,15,3.9z M13,5.6c0,0.1-0.1,0.2-0.2,0.2H4.4c-0.1,0-0.2-0.1-0.2-0.2V3.1c0-0.1,0.1-0.2,0.2-0.2h8.4C12.9,2.9,13,3,13,3.1L13,5.6L13,5.6z M9.6,10.9v4c0,0.1-0.1,0.1-0.1,0.1H8.5c-0.1,0-0.1-0.1-0.1-0.1v-4c0-0.1,0.1-0.1,0.1-0.1h1.1C9.6,10.8,9.6,10.8,9.6,10.9z",icons.trowel="M2,2.9l3.3,10.3c0.1,0.2,0.3,0.4,0.5,0.5c0.1,0,0.1,0,0.2,0c0.2,0,0.4-0.1,0.5-0.2l3-3l1.3,1.3L10.7,12c-0.1,0.1-0.1,0.3,0,0.4l3.2,3.2c0.2,0.2,0.6,0.4,0.9,0.4c0.4,0,0.6-0.1,0.9-0.4c0.5-0.5,0.5-1.3,0-1.8l-3.2-3.2c-0.1-0.1-0.3-0.1-0.4,0l-0.2,0.2l-1.3-1.3l3-3c0.2-0.1,0.2-0.4,0.2-0.6s-0.2-0.5-0.5-0.5L2.9,2.1C2.7,1.9,2.4,2,2.2,2.2C1.9,2.4,1.9,2.7,2,2.9z M11.2,12.3l1-1l3,3c0.3,0.3,0.3,0.8,0,1c-0.3,0.3-0.8,0.3-1,0L11.2,12.3z M8.2,8.5c-0.1-0.1-0.1-0.2,0-0.3c0.1-0.1,0.2-0.1,0.3,0l3,3l-0.3,0.3L8.2,8.5z M2.5,2.6c0,0,0.1-0.1,0.2-0.1L13,5.8c0.1,0,0.1,0.1,0.1,0.1s0,0.1-0.1,0.2l-2.9,3L8.9,7.8c-0.3-0.3-0.8-0.3-1.1,0c-0.3,0.3-0.3,0.8,0,1.1l1.3,1.3l-3,3C6,13.2,6,13.2,5.9,13.2c0,0-0.1-0.1-0.1-0.1L2.5,2.8C2.5,2.7,2.5,2.6,2.5,2.6z",$("#background_bright_plus").on("click",function(){let e=project.background.$image;var t=e.attr("opacity");t<.99&&e.attr({opacity:t+.1}),console.log("bright+",t)}),$("#background_bright_minus").on("click",function(){let e=project.background.$image;var t=e.attr("opacity");.2<=t&&e.attr({opacity:t-.1}),console.log("bright-",t)}),$("#background_zoom_plus").on("click",function(){let e=project.background.$image;var t=e.width(),i=e.height();e.width(t+.1*t),e.height(i+.1*i),e.cx(canvas.width()/2),e.cy(canvas.height()/2)}),$("#background_zoom_minus").on("click",function(){let e=project.background.$image;var t=e.width(),i=e.height();e.width(t-.1*t),e.height(i-.1*i),e.cx(canvas.width()/2),e.cy(canvas.height()/2)}),$("#handlines_delete").on("click",function(){handlines.delete()}),CustomIcons={waterspot_cold:{group:function(){let e=layers.water.group();return e.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(4.5).cy(4.5).attr({"stroke-width":2,stroke:"#106fc6",fill:"#ffffff",type:"water_pipe"}),e},stroke:["#106fc6"],fill:["#ffffff"],"stroke-width":[2],type:["water_pipe"]},waterspot_hot:{group:function(){let e=layers.water.group();return e.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(4.5).cy(4.5).attr({"stroke-width":2,stroke:"#dc143c",fill:"#ffffff",type:"water_hot_pipe"}),e},stroke:["#dc143c"],fill:["#ffffff"],"stroke-width":[2],type:["water_hot_pipe"]},waterspot_drainage:{group:function(){let e=layers.water.group();return e.path("M-7.5,0a7.5,7.5 0 1,0 15,0a7.5,7.5 0 1,0 -15,0").cx(7.5).cy(7.5).attr({"stroke-width":2,stroke:"#000000",fill:"#ffffff",type:"drainage_pipe"}),e},stroke:["#000000"],fill:["#ffffff"],"stroke-width":[2],type:["drainage_pipe"]},waterspot_cold_hot:{group:function(e=!1){let t=layers.water.group();return t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(4.5).cy(4.5).attr({"stroke-width":2,stroke:e?"#dc143c":"#106fc6",fill:"#ffffff",type:e?"water_hot_pipe":"water_pipe"}),t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(12).cy(4.5).attr({"stroke-width":2,stroke:e?"#106fc6":"#dc143c",fill:"#ffffff",type:e?"water_pipe":"water_hot_pipe"}),t},stroke:["#106fc6","#dc143c"],fill:["#ffffff","#ffffff"],"stroke-width":[2,2],change_sequence_indexes:[0,1],type:["water_pipe","water_hot_pipe"]},waterspot_drainage_cold:{group:function(e=!1){let t=layers.water.group();return t.path("M-7.5,0a7.5,7.5 0 1,0 15,0a7.5,7.5 0 1,0 -15,0").cx(11.5).cy(7.5).attr({"stroke-width":2,stroke:"#000000",fill:"#ffffff",type:"drainage_pipe"}),t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(18.5).cy(10.5).attr({"stroke-width":e?0:2,stroke:e?"#ffffff":"#106fc6",fill:e?"transparent":"#ffffff",type:e?"":"water_pipe"}),t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(4.5).cy(10.5).attr({"stroke-width":e?2:0,stroke:e?"#106fc6":"#ffffff",fill:e?"#ffffff":"transparent",type:e?"water_pipe":""}),t},stroke:["#000000","#106fc6","#ffffff"],fill:["#ffffff","#ffffff","transparent"],"stroke-width":[2,2,0],change_sequence_indexes:[1,2],type:["drainage_pipe","water_pipe",""]},waterspot_drainage_hot:{group:function(e=!1){let t=layers.water.group();return t.path("M-7.5,0a7.5,7.5 0 1,0 15,0a7.5,7.5 0 1,0 -15,0").cx(11.5).cy(7.5).attr({"stroke-width":2,stroke:"#000000",fill:"#ffffff",type:"drainage_pipe"}),t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(18.5).cy(10.5).attr({"stroke-width":e?2:0,stroke:e?"#dc143c":"#ffffff",fill:e?"#ffffff":"transparent",type:e?"water_hot_pipe":""}),t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(4.5).cy(10.5).attr({"stroke-width":e?0:2,stroke:e?"#ffffff":"#dc143c",fill:e?"transparent":"#ffffff",type:e?"":"water_hot_pipe"}),t},stroke:["#000000","#ffffff","#dc143c"],fill:["#ffffff","transparent","#ffffff"],"stroke-width":[2,0,2],change_sequence_indexes:[1,2],type:["drainage_pipe","","water_hot_pipe"]},waterspot_drainage_cold_hot:{group:function(e=!1){let t=layers.water.group();return t.path("M-7.5,0a7.5,7.5 0 1,0 15,0a7.5,7.5 0 1,0 -15,0").cx(11.5).cy(7.5).attr({"stroke-width":2,stroke:"#000000",fill:"#ffffff",type:"drainage_pipe"}),t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(18.5).cy(10.5).attr({"stroke-width":2,stroke:e?"#dc143c":"#106fc6",fill:"#ffffff",type:e?"water_hot_pipe":"water_pipe"}),t.path("M-4.5,0a4.5,4.5 0 1,0 9,0a4.5,4.5 0 1,0 -9,0").cx(4.5).cy(10.5).attr({"stroke-width":2,stroke:e?"#106fc6":"#dc143c",fill:"#ffffff",type:e?"water_pipe":"water_hot_pipe"}),t},stroke:["#000000","#106fc6","#dc143c"],fill:["#ffffff","#ffffff","#ffffff"],"stroke-width":[2,2,2],change_sequence_indexes:[1,2],type:["drainage_pipe","water_pipe","water_hot_pipe"]},setAttr:function(t,i,n){if(void 0!==CustomIcons[i]&&t.node&&t.node.children)for(let e=0;e<t.node.children.length;e++)n.fill&&"transparent"===CustomIcons[i].fill[e]&&(n.fill="transparent"),n["stroke-width"]&&"transparent"===CustomIcons[i].fill[e]&&(n["stroke-width"]=0),$(t.node.children[e]).attr(n)},setDefaultColor:function(o,e,l){if(void 0!==CustomIcons[e]){let t=copy.object(CustomIcons[e].stroke),i=copy.object(CustomIcons[e].fill),n=copy.object(CustomIcons[e]["stroke-width"]),s=copy.object(CustomIcons[e].type);if(CustomIcons[e].change_sequence_indexes&&l&&l.props&&l.props.waterspots_change_sequence&&([t[CustomIcons[e].change_sequence_indexes[0]],t[CustomIcons[e].change_sequence_indexes[1]]]=[t[CustomIcons[e].change_sequence_indexes[1]],t[CustomIcons[e].change_sequence_indexes[0]]],[i[CustomIcons[e].change_sequence_indexes[0]],i[CustomIcons[e].change_sequence_indexes[1]]]=[i[CustomIcons[e].change_sequence_indexes[1]],i[CustomIcons[e].change_sequence_indexes[0]]],[n[CustomIcons[e].change_sequence_indexes[0]],n[CustomIcons[e].change_sequence_indexes[1]]]=[n[CustomIcons[e].change_sequence_indexes[1]],n[CustomIcons[e].change_sequence_indexes[0]]],[s[CustomIcons[e].change_sequence_indexes[0]],s[CustomIcons[e].change_sequence_indexes[1]]]=[s[CustomIcons[e].change_sequence_indexes[1]],s[CustomIcons[e].change_sequence_indexes[0]]]),o.node&&o.node.children)for(let e=0;e<o.node.children.length;e++)$(o.node.children[e]).attr({stroke:t[e]}),$(o.node.children[e]).attr({fill:i[e]}),$(o.node.children[e]).attr({"stroke-width":n[e]}),$(o.node.children[e]).attr({type:s[e]})}}}});class DebugParser{constructor(){this.errorsList=[],this.logList=[],this.debugTime=!1,this.debugConsole=!1,this.debugStep=!1,this.steps=[],this.stepSaveInnerLines=!0,this.stepSaveOuterLines=!0,this.stepSaveParserLines=!0}debug_time(e){this.debugTime&&console.time(e)}debug_time_end(e){this.debugTime&&console.timeEnd(e)}addLog(i){if(1===i.length)i=i[0];else{let t;try{t=JSON.parse(JSON.stringify(i))}catch(e){t=i}i=t}this.logList.push(i)}log(e){this.debugConsole&&console.log.apply(null,arguments),this.addLog(arguments)}l(){this.log(void 0!==arguments[0]?arguments[0]:arguments)}warn(){this.debugConsole&&console.warn.apply(null,arguments),this.addLog(arguments)}w(){this.warn(void 0!==arguments[0]?arguments[0]:arguments)}error(){this.debugConsole&&console.error.apply(null,arguments),this.addLog(arguments)}e(){this.error(void 0!==arguments[0]?arguments[0]:arguments)}errors(e){this.errorsList.push(e)}outputErrors(){let t=[];for(let e=0;e<this.errorsList.length;e++)t.push({message:this.errorsList[e].message,stack:this.errorsList[e].stack});return t}outputLogs(){let t=[];for(let e=0;e<this.logList.length;e++){var i=this.logList[e];try{JSON.stringify(i),t.push(i)}catch(e){t.push("fail JSON")}}return t}debugAfterParser(){console.log("подозрительные",plannerParser.suspicious),console.log("outerWalls",outerWalls),console.log("innerWalls",innerWalls),console.log("parserWalls",parserWalls),console.log("holes",holes);for(let e=0;e<plannerParser.suspicious.length;e++);for(var e in outerWalls.paintLines("orange"),innerWalls.lines)innerWalls.lines.hasOwnProperty(e)&&(!1===innerWalls.lines[e].isPillar&&innerWalls.lines[e].paint("red"),!0===innerWalls.lines[e].isPillar&&(innerWalls.lines[e].paint("green"),console.warn("Pillar",innerWalls.lines[e])),innerWalls.lines[e].length()<=plannerParser.length_microwall&&console.warn("code M",innerWalls.lines[e].length(),innerWalls.lines[e]));for(var t in innerWalls.points)innerWalls.points.hasOwnProperty(t)&&(innerWalls.points[t].paint("orange"),innerWalls.points[t].isConnected||innerWalls.points[t].paint("green"),innerWalls.points[t].isDock&&innerWalls.points[t].paint("purple"));for(var i in holes.lines)holes.lines.hasOwnProperty(i)&&holes.lines[i].paint("blue")}step(s){if(this.debugStep){let e=[],t=[],i=[],n=[];for(var o in outerWalls.lines)!outerWalls.lines.hasOwnProperty(o)||!this.stepSaveOuterLines&&outerWalls.lines[o].isParser||e.push({point_1:new Point(outerWalls.lines[o].point_1.x,outerWalls.lines[o].point_1.y),point_2:new Point(outerWalls.lines[o].point_2.x,outerWalls.lines[o].point_2.y)});if(this.stepSaveInnerLines){for(var l in innerWalls.lines)innerWalls.lines.hasOwnProperty(l)&&t.push({point_1:new Point(innerWalls.lines[l].point_1.x,innerWalls.lines[l].point_1.y),point_2:new Point(innerWalls.lines[l].point_2.x,innerWalls.lines[l].point_2.y),isPillar:innerWalls.lines[l].isPillar,point_1_isConnected:innerWalls.lines[l].point_1.isConnected,point_1_isDock:innerWalls.lines[l].point_1.isDock,point_2_isConnected:innerWalls.lines[l].point_2.isConnected,point_2_isDock:innerWalls.lines[l].point_2.isDock,innerDepth:innerWalls.lines[l].innerDepth,outerDepth:innerWalls.lines[l].outerDepth});for(var r in holes.lines)holes.lines.hasOwnProperty(r)&&i.push({point_1:new Point(holes.lines[r].point_1.x,holes.lines[r].point_1.y),point_2:new Point(holes.lines[r].point_2.x,holes.lines[r].point_2.y)})}if(this.stepSaveParserLines)for(var a in parserWalls.lines)parserWalls.lines.hasOwnProperty(a)&&n.push({point_1:new Point(parserWalls.lines[a].point_1.x,parserWalls.lines[a].point_1.y),point_2:new Point(parserWalls.lines[a].point_2.x,parserWalls.lines[a].point_2.y)});var s={name:s,outerLines:e,innerLines:t,holesLines:i,parserLines:n},h=CryptoJS.MD5(JSON.stringify(s)).toString();CryptoJS.MD5(JSON.stringify(this.steps[this.steps.length-1])).toString()!==h&&this.steps.push(s)}}showSteps(e=0){void 0===this.steps[e]?setTimeout(function(){this.showSteps(e)}.bind(this),100):(plannerCanvas.clear(),plannerCanvas.showImage(),this.paintStep(e),setTimeout(function(){this.showSteps(e+1)}.bind(this),100))}outputStepsOnPage(){let t="";for(let e=0;e<this.steps.length;e++)t+='<div data-index="'+e+'">'+e+" - "+this.steps[e].name+"</div>";let e=document.getElementById("steps"),i=(e.innerHTML=t,document.querySelector("#steps").addEventListener("click",t=>{if(t.toElement.attributes&&t.toElement.attributes["data-index"]){document.querySelector("#steps div.selected")&&document.querySelector("#steps div.selected").classList.remove("selected");var i=t.toElement.attributes["data-index"].value;t.toElement.classList.add("selected"),plannerCanvas.clear(),plannerCanvas.showImage(),__debugP.paintStep(i);let e=document.querySelector("#range_steps");e.value=i}}),document.querySelector("#range_steps")),n=(i.setAttribute("max",this.steps.length-1),i.addEventListener("input",e=>{document.querySelector("#steps div.selected")&&document.querySelector("#steps div.selected").classList.remove("selected");e=e.target.value;document.querySelector('#steps div[data-index="'+e+'"]').classList.add("selected"),$("#steps").scrollTo($("#steps").find("div.selected")),plannerCanvas.clear(),plannerCanvas.showImage(),__debugP.paintStep(e)}),document.querySelector("#range_zoom"));n.addEventListener("input",e=>{document.querySelector("#canvas_spec").style.zoom=e.target.value+"%"})}paintStep(e){var n=this.steps[e];for(let e=0;e<n.outerLines.length;e++)plannerCanvas.paintLine(n.outerLines[e].point_1,n.outerLines[e].point_2,"orange"),plannerCanvas.paintPoint(n.outerLines[e].point_1,"orange"),plannerCanvas.paintPoint(n.outerLines[e].point_2,"orange");for(let e=0;e<n.parserLines.length;e++)plannerCanvas.paintLine(n.parserLines[e].point_1,n.parserLines[e].point_2,"orange"),plannerCanvas.paintPoint(n.parserLines[e].point_1,"orange"),plannerCanvas.paintPoint(n.parserLines[e].point_2,"orange");for(let i=0;i<n.innerLines.length;i++){plannerCanvas.paintLine(n.innerLines[i].point_1,n.innerLines[i].point_2,!0===n.innerLines[i].isPillar?"green":"red");let e="orange",t=(n.innerLines[i].point_1_isDock?e="purple":n.innerLines[i].point_1_isConnected||(e="green"),"orange");n.innerLines[i].point_2_isDock?t="purple":n.innerLines[i].point_2_isConnected||(t="green"),plannerCanvas.paintPoint(n.innerLines[i].point_1,e),plannerCanvas.paintPoint(n.innerLines[i].point_2,t)}for(let e=0;e<n.holesLines.length;e++)plannerCanvas.paintLine(n.holesLines[e].point_1,n.holesLines[e].point_2,"blue")}}class PlannerCanvas{constructor(e,t){this.canvas=document.getElementById("canvas_spec"),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id="canvas_spec",this.canvas.style.display="none",document.querySelector("body").append(this.canvas)),this.context=this.canvas.getContext("2d"),this.canvas.height=e,this.canvas.width=t,this.height=this.canvas.height,this.width=this.canvas.width,this.pixels=[],this.wasUpContrast=!1,this.imgDataBeforeContrast=null,this.imgData=void 0,this.clear()}clear(){this.context.fillStyle="white",this.context.fillRect(0,0,this.width,this.height)}showImage(){this.context.putImageData(this.imgData,0,0)}setImage(e){var t=Math.min(this.width/e.width,this.height/e.height),i=this.width/2-e.width/2*t,n=this.height/2-e.height/2*t,i=(this.context.drawImage(e,i,n,e.width*t,e.height*t),this.context.getImageData(0,0,this.width,this.height));this.imgData=i,this.context.putImageData(i,0,0),this.pixels=i.data}upContrastImage(){var e;this.wasUpContrast||(e=this.context.getImageData(0,0,this.width,this.height),this.imgData=e,this.imgDataBeforeContrast=this.context.getImageData(0,0,this.width,this.height),this.contrastImage(e,10),this.context.putImageData(e,0,0),this.pixels=e.data,this.wasUpContrast=!0)}resetContrastImage(){var e;this.wasUpContrast&&(__debugP.warn("reset contrast"),e=this.imgDataBeforeContrast,this.imgData=e,this.context.putImageData(e,0,0),this.pixels=e.data,this.wasUpContrast=!1)}contrastImage(e,t){let i=e.data;var n=128*(1-(t=t/100+1));for(let e=0;e<i.length;e+=4)i[e]=i[e]*t+n,i[e+1]=i[e+1]*t+n,i[e+2]=i[e+2]*t+n;return e}initDebugEvent(){this.canvas.addEventListener("click",function(e){let t=new Point(e.offsetX,e.offsetY);for(var i in innerWalls.points)if(innerWalls.points.hasOwnProperty(i)&&t.equal(innerWalls.points[i],2))for(var n in console.log(i,innerWalls.points[i]),innerWalls.points[i].lines)if(innerWalls.points[i].lines.hasOwnProperty(n)){innerWalls.points[i].lines[n].paint("green");for(let e=0;e<innerWalls.points[i].lines[n].outerLines.length;e++)innerWalls.points[i].lines[n].outerLines[e].paint("blue")}for(var s in outerWalls.points)outerWalls.points.hasOwnProperty(s)&&t.equal(outerWalls.points[s],2)&&(console.log(outerWalls.points[s]),outerWalls.points[s].paintLines("blue"));console.log("click: "+e.offsetX+"/"+e.offsetY,0<plannerCanvas.pixels.length?plannerCanvas.getPixel(t.x,t.y):"")},!1)}initClickEvent(){this.canvas.addEventListener("click",function(e){var t=new Point(e.offsetX,e.offsetY);console.log("click: "+e.offsetX+"/"+e.offsetY,0<plannerCanvas.pixels.length?plannerCanvas.getPixel(t.x,t.y):""),parserClick.click(t)},!1)}paintPoint(e,t){this.context.strokeStyle=t,this.context.fillStyle=t,this.context.lineWidth=1,this.context.beginPath(),this.context.arc(e.x,e.y,2,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this.context.stroke()}paintLine(e,t,i){this.context.strokeStyle=i,this.context.lineWidth=2,this.context.beginPath(),this.context.moveTo(e.x,e.y),this.context.lineTo(t.x,t.y),this.context.closePath(),this.context.stroke()}paintRectByPoints(e,t){this.paintLine(e[0],e[1],t),this.paintLine(e[1],e[2],t),this.paintLine(e[2],e[3],t),this.paintLine(e[3],e[0],t)}getPixel(e,t){t=4*(t*this.width+e);return this.pixels[t]}randColor(){let e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),i=Math.floor(256*Math.random());return"#"+e.toString(16)+t.toString(16)+i.toString(16)}}class PlannerParser{constructor(){this.temp_array_rooms=[],this.array_lines=[],this.suspicious=[],this.count_use_function={},this.min_length_single_line=60,this.max_distance_between_walls=100,this.max_distance_between_old_and_new_holes=50,this.length_microwall=25,this.count_round=2}analyzePoints(e=!1){for(var a in outerWalls.clear(),innerWalls.clear(),holes.clear(),outerWallsFunctions.connect_line_counts=[],innerWallsFunctions.connect_line_counts=[],pillarsFunctions.connect_line_counts=[],outerWalls.fillWalls(this.array_lines.filter(e=>in_array(e[2],["wall","balcony"]))),__debugP.step("outerWalls.fillWalls"),__debugP.debug_time("_correctLinesAfterFilling"),outerWallsFunctions.correctLinesAfterFilling(),__debugP.debug_time_end("_correctLinesAfterFilling"),outerWalls.lines)if(outerWalls.lines.hasOwnProperty(a)){"916.95-741.33"!==outerWalls.lines[a].point_2.key&&outerWalls.lines[a].point_2.key;let e=outerWalls.lines[a].getParallel(0,3),n=e.getNormal();var h,i=e.length()/6;let s=[n,n.getParallel(i),n.getParallel(2*i),n.getParallel(3*i),n.getParallel(-i),n.getParallel(-2*i),n.getParallel(-3*i)];for(let e=0;e<s.length;e++);let t={};for(h in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(h)&&h!==a&&(outerWalls.lines[h].point_1.key,outerWalls.lines[a].isParallel(outerWalls.lines[h])&&!outerWalls.lines[a].isCommonPoint(outerWalls.lines[h]))){let i,n=0;for(let t=0;t<s.length;t++)if(i=s[t].intersection(outerWalls.lines[h])){let e=new Line(s[t].intersection(outerWalls.lines[a]),i);n=+e.length().toFixed(plannerParser.count_round);break}!1===i||n>plannerParser.max_distance_between_walls||(void 0===t[n]&&(t[n]=[]),t[n].push(outerWalls.lines[h]))}let o=null;let l=[];var g=Object.keys(t).sort((e,t)=>+e-+t);for(let e=0;e<g.length;e++)l.push({distance:+g[e],lines:t[g[e]]});let r={};for(let i=0;i<l.length;i++){null===o&&(o=l[i].distance);for(let t=0;t<l[i].lines.length;t++){let e=!1;if(2<l[i].distance-o)for(var _ in r)if(r.hasOwnProperty(_)&&r[_].isOverlay(l[i].lines[t])){var _=n.intersection(r[_]),d=n.intersection(l[i].lines[t]);if(!outerWalls.lines[a].intersection(new Line(_,d))){e=!0;break}}if(!e){let e=innerWalls.buildWall(outerWalls.lines[a],l[i].lines[t],l[i].distance);!1!==e&&(__debugP.step("innerWalls.buildWall"),r[e.key()]=e)}}}}let t=0;for(var n in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(n)){let e=!1;for(var s in outerWalls.points)if(outerWalls.points.hasOwnProperty(s)&&outerWalls.lines[n].isPointOnLine(outerWalls.points[s],.05)&&outerWalls.lines[n].center().equal(outerWalls.points[s],3)){e=!0;break}e||0===outerWalls.lines[n].countLines()&&outerWalls.lines[n].length()>this.min_length_single_line&&t++}return(3<=t||0<this.suspicious.length)&&!0!==e?(innerWallsFunctions.removeWallFromJoins2(),innerWallsFunctions.removeWallFromJoins9(),innerWallsFunctions.findsDock(),innerWallsFunctions.removeDock3(),innerWallsFunctions.removeDock4(),innerWallsFunctions.removeLittleLines(),-1):(innerWallsFunctions.connects(),!0)}fillArrayLinesFromParserWalls(){for(var e in this.array_lines=JSON.parse(JSON.stringify(this.temp_array_rooms)),parserWalls.lines)parserWalls.lines.hasOwnProperty(e)&&this.array_lines.push([{x:parserWalls.lines[e].point_1.x,y:parserWalls.lines[e].point_1.y},{x:parserWalls.lines[e].point_2.x,y:parserWalls.lines[e].point_2.y},parserWalls.lines[e].isBalcony?"balcony":"wall","parser"])}deleteSuspiciousLines(){for(let t=0;t<this.suspicious.length;t++){var i=this.suspicious[t].wall;let e=outerWalls.findLine(i);if(!1!==e&&0<e.countLines())return this.suspicious.splice(t,1),this.deleteSuspiciousLines(),!0}return!1}autoParserWalls(){try{__debugP.stepSaveInnerLines=!1,__debugP.stepSaveOuterLines=!1,this.temp_array_rooms=JSON.parse(JSON.stringify(this.array_lines));var t=autoParser.selectWallForAutoParserOuterWall(!1);let e;var i=autoParser.autoParserOuterWall(t,0),n=this.suspicious,s=(this.suspicious=[],plannerCanvas.upContrastImage(),autoParser.autoParserOuterWall(t,0));return Object.keys(s).length>=Object.keys(i).length?e=s:(plannerCanvas.resetContrastImage(),e=i,this.suspicious=n),parserWalls.fillWalls(t,e),parserWallsFunctions.cutIntersectionLines(),parserWallsFunctions.connectWalls(),parserWallsFunctions.connectFreeWallsRightAngles(),parserWallsFunctions.connectFreeWallsNoRightAngles(),parserWallsFunctions.unionWalls(),this.fillArrayLinesFromParserWalls(),this.analyzePoints(),this.deleteSuspiciousLines(),__debugP.log("подозрительные",this.suspicious),0<this.suspicious.length&&this.defineSuspicious(),parserWallsFunctions.fixDifferentLines1(t),parserWallsFunctions.fixDifferentLines2(),parserWallsFunctions.fixDifferentLines3(t),this.actionAfterFixSuspicious(),__debugP.stepSaveInnerLines=!0,__debugP.stepSaveOuterLines=!0,__debugP.stepSaveParserLines=!1,this.fillArrayLinesFromParserWalls(),this.analyzePoints(!0)}catch(e){__debugP.errors(e),__debugP.error("WARNING! x_autoParserWalls",e)}}actionAfterFixSuspicious(){try{parserWallsFunctions.connectWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.connectWalls()",e)}try{parserWallsFunctions.connectFreeWallsRightAngles()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.connectFreeWallsRightAngles()",e)}try{parserWallsFunctions.connectFreeWallsNoRightAngles()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.connectFreeWallsNoRightAngles()",e)}try{parserWallsFunctions.unionWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.unionWalls()",e)}try{this.deleteSuspiciousLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! this.deleteSuspiciousLines()",e)}__debugP.log("подозрительные",this.suspicious)}defineSuspicious(){let e=100;for(;0<e--;){var t=this.suspicious.length;try{parserWallsFunctions.fixSuspiciousLines1()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.fixSuspiciousLines1()",e)}if(this.actionAfterFixSuspicious(),0===this.suspicious.length)return;if(t>this.suspicious.length)this.fillArrayLinesFromParserWalls(),this.analyzePoints();else{try{parserWallsFunctions.fixSuspiciousLines2()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.fixSuspiciousLines2()",e)}if(this.actionAfterFixSuspicious(),0===this.suspicious.length)return;if(t>this.suspicious.length)this.fillArrayLinesFromParserWalls(),this.analyzePoints();else{try{parserWallsFunctions.fixSuspiciousLines3()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.fixSuspiciousLines3()",e)}if(this.actionAfterFixSuspicious(),0===this.suspicious.length)return;if(t>this.suspicious.length)this.fillArrayLinesFromParserWalls(),this.analyzePoints();else{try{parserWallsFunctions.fixSuspiciousLines4()}catch(e){__debugP.errors(e),__debugP.error("WARNING! parserWallsFunctions.fixSuspiciousLines4()",e)}if(this.actionAfterFixSuspicious(),0===this.suspicious.length)return;t>this.suspicious.length&&(this.fillArrayLinesFromParserWalls(),this.analyzePoints())}}}}}decreaseWallsGeneral(){try{parserWallsFunctions.decreaseParserWalls(1),parserWallsFunctions.decreaseParserWalls(2)}catch(e){__debugP.errors(e),__debugP.error("WARNING! decreaseParserWalls",e)}try{innerWallsFunctions.unionParallelLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! unionParallelLines",e)}try{innerWallsFunctions.movingAxisMicroWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! movingAxisMicroWalls",e)}try{innerWallsFunctions.unionMicroWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! unionMicroWalls",e)}}pillarsGeneral(){try{pillarsFunctions.findPillar()}catch(e){__debugP.errors(e),__debugP.error("WARNING! findPillar",e)}try{pillarsFunctions.pillarAxis(!0)}catch(e){__debugP.errors(e),__debugP.error("WARNING! pillarAxis",e)}try{pillarsFunctions.pillarAxis()}catch(e){__debugP.errors(e),__debugP.error("WARNING! pillarAxis",e)}try{pillarsFunctions.prepareWallsForPillar()}catch(e){__debugP.errors(e),__debugP.error("WARNING! prepareWallsForPillar",e)}}clearStartData(){outerWalls.clear(),innerWalls.clear(),parserWalls.clear(),holes.clear(),parserWallsFunctions.connect_line_counts=[],outerWallsFunctions.connect_line_counts=[],innerWallsFunctions.connect_line_counts=[],pillarsFunctions.connect_line_counts=[],innerWallsFunctions.connect_line_counts_91=0,this.suspicious=[]}generateResult(){let s=[];for(var o in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(o)){let e="wall",t=innerWalls.lines[o].center(),i=innerWalls.lines[o].depth,n=+innerWalls.lines[o].length().toFixed(1);innerWalls.lines[o].isPillar&&(e="pillar",t=innerWalls.lines[o].centerPillar,innerWalls.lines[o].isVertical()&&(i=+innerWalls.lines[o].length().toFixed(1),n=innerWalls.lines[o].depth)),innerWalls.lines[o].isBalcony&&(e="balcony"),s.push({s:{x:innerWalls.lines[o].point_1.x,y:innerWalls.lines[o].point_1.y},e:{x:innerWalls.lines[o].point_2.x,y:innerWalls.lines[o].point_2.y},depth:i,outer_depth:innerWalls.lines[o].outerDepth,inner_depth:innerWalls.lines[o].innerDepth,label:e,width:n,center:t})}for(var t in holes.lines)if(holes.lines.hasOwnProperty(t)){let e=holes.lines[t].type;"window"!==e&&"windoor"!==e&&(e=120<=holes.lines[t].length()?"door_double":"door");t={s:{x:holes.lines[t].point_1.x,y:holes.lines[t].point_1.y},e:{x:holes.lines[t].point_2.x,y:holes.lines[t].point_2.y},label:e,center:holes.lines[t].center(),width:+holes.lines[t].length().toFixed(1),windoor:"windoor"===e?holes.lines[t].windoor:{}};s.push(t)}return s}movingCoordinate(t){for(let e=0;e<this.array_lines.length;e++)this.array_lines[e][0].x+=-t.x,this.array_lines[e][0].y+=-t.y,this.array_lines[e][1].x+=-t.x,this.array_lines[e][1].y+=-t.y}restoreCoordinate(t){for(let e=0;e<this.array_lines.length;e++)this.array_lines[e][0].x-=-t.x,this.array_lines[e][0].y-=-t.y,this.array_lines[e][1].x-=-t.x,this.array_lines[e][1].y-=-t.y}}class AutoParser{selectWallForAutoParserOuterWall(t=!1){let i=[];for(var s in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(s)&&!(outerWalls.lines[s].length()<15))if(0===outerWalls.lines[s].countLines())t&&outerWalls.lines[s].paint("blue"),i.push(outerWalls.lines[s]);else{let e=0;var n,o=outerWalls.lines[s].length();for(n in outerWalls.lines[s].lines)outerWalls.lines[s].lines.hasOwnProperty(n)&&(e+=outerWalls.lines[s].lines[n].length());var l=e/o*100;if(!(80<l)&&!(o-e<25)&&0<outerWalls.lines[s].countLines()){let n=[outerWalls.lines[s]],e=outerWalls.lines[s].lines;for(var r in e)if(e.hasOwnProperty(r)){var a,h,g=outerWalls.lines[s].getPointProjection(e[r].point_1),_=outerWalls.lines[s].getPointProjection(e[r].point_2);let t=e[r].getNormal(),i=[];for(let e=0;e<n.length;e++)t.intersection(n[e])?(a=new Line(g,n[e].point_1).length()<new Line(_,n[e].point_1).length()?g:_,h=new Line(g,n[e].point_2).length()<new Line(_,n[e].point_2).length()?g:_,a=new OuterWall(a,n[e].point_1),h=new OuterWall(h,n[e].point_2),i.push(a),i.push(h)):i.push(n[e]);n=i}__debugP.warn("Разделение линии на "+n.length);for(let e=0;e<n.length;e++)t&&n[e].paint("blue"),50<n[e].length()&&i.push(n[e])}}return i}autoParserOuterWall(n,t=!1){let s={},o={};for(let t=0;t<n.length;t++){t;let i=this.autoParserOuterWallHorizontalLine(n,n[t]);if(!1!==i)if(4<n.length&&(i=this.tryParserHorizontal(n,n[t],i)),0===Object.keys(i).length)o[t]={hor:{},ver:{}};else{let e=!1;for(var l in i)if(i.hasOwnProperty(l)&&8<l){e=!0;break}if(e&&1<Object.keys(i).length)for(var r in i)i.hasOwnProperty(r)&&r<=8&&delete i[r];for(;;){let t=!1;var a=Object.keys(i);for(let e=0;e<a.length-1;e++)if(a[e+1]-a[e]<8){delete i[a[e]],t=!0;break}if(!1===t)break}for(;;){let t=!1;var h=Object.keys(i);for(let e=0;e<h.length-1;e++)if(this.isExistWall(i[h[e+1]],i[h[e]])){delete i[h[e]],t=!0;break}if(!1===t)break}if(2<Object.keys(i).length)o[t]={hor:i,ver:{}};else{var g=Object.keys(i)[0];if(1===Object.keys(i).length&&8<=g&&g<=70)s[t]=i[g],s[t].depth=g;else{if(2===Object.keys(i).length){var _=Object.keys(i)[1];if(g<=10&&10<=_&&_<=70){s[t]=i[_],s[t].depth=_;continue}}o[t]={hor:i,ver:{}}}}}}for(var e in o)if(o.hasOwnProperty(e)){e;let t=this.autoParserOuterWallVerticalLine(n,n[e]);if(!1!==t){if((0===Object.keys(t).length||getMinKey(t)>plannerParser.max_distance_between_walls)&&(t=this.autoParserOuterWallVerticalLine(n,n[e],{pixelValue:200,maxCount:getMinKey(t)})),(0===Object.keys(t).length||getMinKey(t)>plannerParser.max_distance_between_walls)&&(t=this.autoParserOuterWallVerticalLine(n,n[e],{pixelValue:240,maxCount:getMinKey(t)})),(0===Object.keys(t).length||getMinKey(t)>plannerParser.max_distance_between_walls)&&(t=this.autoParserOuterWallVerticalLine(n,n[e],{pixelValue:252,maxCount:getMinKey(t)})),0===Object.keys(o[e].ver).length&&0<Object.keys(t).length){let e=t[getMaxKey(t)];if(e.length()/Object.keys(t)[0]<=.2&&e.length()<70)continue}0!==Object.keys(t).length&&(o[e].ver=t)}}for(var i in o)if(o.hasOwnProperty(i)&&(0!==Object.keys(o[i].hor).length||0!==Object.keys(o[i].ver).length)){let e=o[i].hor[getMaxKey(o[i].hor)],t=o[i].ver[getMaxKey(o[i].ver)];(void 0!==e&&e.length()/getMaxKey(o[i].hor)<=.2&&e.length()<70||void 0!==t&&t.length()/getMaxKey(o[i].ver)<=.2&&t.length()<70)&&delete o[i]}var d,p,c,A,u,w,m,f,I,C,y,b;for(d in o)if(o.hasOwnProperty(d)&&0!==Object.keys(o[d].hor).length&&0!==Object.keys(o[d].ver).length){let t=!0;var v,x=Object.keys(o[d].ver);for(let e=0;e<x.length-1;e++)if(6<Math.abs(x[e]-x[e+1])){t=!1;break}if(!1!==(t=6<Math.abs(x[0]-x[x.length-1])?!1:t)){let t={};for(var B in o[d].hor)if(o[d].hor.hasOwnProperty(B))for(let e=0;e<x.length;e++)Math.abs(x[e]-B)<=6&&(t[B]=o[d].hor[B]);0===Object.keys(t).length||70<(v=getMaxKey(t))&&1!==Object.keys(o[d].hor).length&&!this.isExistWall(t[v],n[d])||v>plannerParser.max_distance_between_walls&&(!this.isExistWall(t[v],n[d])||!this.isExistWall2(t[v],n[d]))||(s[d]=t[v],s[d].depth=v,delete o[d])}}for(p in o)o.hasOwnProperty(p)&&0!==Object.keys(o[p].hor).length&&0!==Object.keys(o[p].ver).length&&2===Object.keys(o[p].hor).length&&(c=o[p].hor[Object.keys(o[p].hor)[0]],A=o[p].hor[Object.keys(o[p].hor)[1]],this.isExistWall(c,n[p])&&this.isNotExistWall(c,A)?(s[p]=c,s[p].depth=Object.keys(o[p].hor)[0],delete o[p]):!this.isNotExistWall(c,n[p])&&this.isNotExistWall(c,A)&&(s[p]=c,s[p].depth=Object.keys(o[p].hor)[1],delete o[p]));for(u in o)if(o.hasOwnProperty(u)&&0<Object.keys(o[u].hor).length&&0===Object.keys(o[u].ver).length){let e=0;for(var k in o[u].hor)!o[u].hor.hasOwnProperty(k)||40<o[u].hor[k].length()||this.isInWall(o[u].hor[k])&&e++;e===Object.keys(o[u].hor).length&&delete o[u]}for(w in s)!s.hasOwnProperty(w)||70<s[w].length()||(innerWalls.isNearLines(s[w])||this.isExistAfterWall(s[w],n[w],2)?delete s[w]:+s[w].length()>+s[w].depth||(this.isInWall2(s[w])||outerWalls.isExistOnLine(s[w])||this.isExistAfterWall(s[w],n[w],1))&&delete s[w]);for(m in o)if(o.hasOwnProperty(m)&&0!==Object.keys(o[m].hor).length&&0!==Object.keys(o[m].ver).length&&!(70<o[m].hor[Object.keys(o[m].hor)[0]].length())){for(var L in o[m].hor)o[m].hor.hasOwnProperty(L)&&(o[m].hor[L].depth=L,(this.isInWall2(o[m].hor[L])||outerWalls.isExistOnLine(o[m].hor[L])||innerWalls.isNearLines(o[m].hor[L])||this.isExistAfterWall(o[m].hor[L],n[m]))&&delete o[m].hor[L]);for(var E in o[m].ver)o[m].ver.hasOwnProperty(E)&&(o[m].ver[E].depth=E,(this.isInWall2(o[m].ver[E])||outerWalls.isExistOnLine(o[m].ver[E])||innerWalls.isNearLines(o[m].ver[E])||this.isExistAfterWall(o[m].ver[E],n[m]))&&delete o[m].ver[E]);0===Object.keys(o[m].hor).length&&0===Object.keys(o[m].ver).length&&delete o[m]}for(f in o)if(o.hasOwnProperty(f)&&0!==Object.keys(o[f].hor).length&&0!==Object.keys(o[f].ver).length&&!(o[f].hor[Object.keys(o[f].hor)[0]].length()<70)){for(var W in o[f].hor)o[f].hor.hasOwnProperty(W)&&(o[f].hor[W].depth=W,o[f].hor[W].depth<70||this.isNotExistWall(o[f].hor[W],n[f])&&delete o[f].hor[W]);for(var P in o[f].ver)o[f].ver.hasOwnProperty(P)&&(o[f].ver[P].depth=P,o[f].ver[P].depth<70||this.isNotExistWall(o[f].ver[P],n[f])&&delete o[f].ver[P])}for(I in s)!s.hasOwnProperty(I)||s[I].length()<70||s[I].depth<70||this.isNotExistWall(s[I],n[I])&&(delete s[I],o[I]={hor:{},ver:{}});for(C in s)s.hasOwnProperty(C)&&(s[C]=this.cutLine(s[C]),t&&s[C].paint("red"));for(y in o)if(o.hasOwnProperty(y)){let e=[];for(var Q in o[y].hor)o[y].hor.hasOwnProperty(Q)&&(t&&o[y].hor[Q].paint("blue"),e.push(o[y].hor[Q]));for(var M in o[y].ver)o[y].ver.hasOwnProperty(M)&&(t&&o[y].ver[M].paint("green"),e.push(o[y].ver[M]));0===Object.keys(o[y].hor).length&&0===Object.keys(o[y].ver).length&&(!1!==(b=this.staticParserOuterWallHorizontalLine(n,n[y]))&&(s[y]=b),t&&n[y].paint("orange")),0<e.length&&plannerParser.suspicious.push({wall:n[y],lines:e})}return __debugP.log("все что не нашли",o),s}autoParserOuterWallHorizontalLine(t,n,e={}){var i,s=new Line(new Point(0,0),new Point(plannerCanvas.width,0)),o=new Line(new Point(0,0),new Point(0,plannerCanvas.height)),l=new Line(new Point(0,plannerCanvas.height),new Point(plannerCanvas.width,plannerCanvas.height)),r=new Line(new Point(plannerCanvas.width,0),new Point(plannerCanvas.width,plannerCanvas.height));let a=!1;for(i in innerWalls.points)if(innerWalls.points.hasOwnProperty(i)&&n.isPointOnLine(innerWalls.points[i],.05)&&n.center().equal(innerWalls.points[i],3)){let e=innerWalls.points[i].line();var h=e.otherPoint(innerWalls.points[i]);a=!0;for(let e=0;e<t.length;e++)if(t[e].isPointOnLine(h,.05)&&t[e].center().equal(h,3)){t[e].paint(),a=!1;break}if(a&&n.point_1 instanceof PointOuterWall&&n.point_2 instanceof PointOuterWall&&2===n.point_1.countLines()&&2===n.point_2.countLines()){var g=n.getBigLineOne(100),_=new Line(n.point_2,n.point_1).getBigLineOne(100);if(!outerWalls.isIntersectionWall(g)||!outerWalls.isIntersectionWall(_)){let e=n.point_1.otherLines(n)[0],t=n.point_2.otherLines(n)[0];if(e.length()<n.length()||t.length()<n.length()){a=!1;continue}if((e.length()<50||t.length()<50)&&3<Math.max(e.length(),t.length())/Math.min(t.length(),t.length())){a=!1;continue}}}if(a)break}if(a)return!1;let d=n.getNormal();var c=n.center(),s=d.intersection(s),o=d.intersection(o),l=d.intersection(l),r=d.intersection(r);let p=new Line,A=new Line;if(!1!==s&&(p.isValid()?A.isValid()||(A=new Line(c,s)):p=new Line(c,s)),!1!==o&&(p.isValid()?A.isValid()||(A=new Line(c,o)):p=new Line(c,o)),!1!==l&&(p.isValid()?A.isValid()||(A=new Line(c,l)):p=new Line(c,l)),!1!==r&&(p.isValid()?A.isValid()||(A=new Line(c,r)):p=new Line(c,r)),!p.isValid()&&!A.isValid())return!1;let u=outerWalls.isIntersectionWall(p);var w,s=outerWalls.isIntersectionWall(A);if(u===s){let e=!1;if(!0===u&&50<n.length()&&(outerWalls.countIntersectionWall(p)%2!=0&&outerWalls.countIntersectionWall(A)%2!=0||(u=outerWalls.countIntersectionWall(p)%2!=0,e=!0)),!e)return!1}let m=u?A:p;if(innerWalls.isIntersectionWall(m)){let e=!1;if(!(e=50<n.length()&&outerWalls.countIntersectionWall(m)%2==0?!0:e))return!1}for(w in innerWalls.points)if(innerWalls.points.hasOwnProperty(w)&&m.isPointOnLine(innerWalls.points[w])){if(n.point_1 instanceof PointOuterWall&&n.point_2 instanceof PointOuterWall&&2===n.point_1.countLines()&&2===n.point_2.countLines()){var f=n.getBigLineOne(100),I=new Line(n.point_2,n.point_1).getBigLineOne(100);if(!outerWalls.isIntersectionWall(f)||!outerWalls.isIntersectionWall(I)){let e=n.point_1.otherLines(n)[0],t=n.point_2.otherLines(n)[0];if(e.length()<n.length()||t.length()<n.length())continue;if((e.length()<50||t.length()<50)&&3<Math.max(e.length(),t.length())/Math.min(t.length(),t.length()))continue}}a=!0;break}if(a)return!1;var C=e.maxCount&&0<e.maxCount?e.maxCount:200,y=plannerParser.max_distance_between_walls;let b=0;var v=e.pixelValue&&0<e.pixelValue?e.pixelValue:170,x=n.getParallel(-5).intersection(m)?"-":"+";let B={},k=!1;var L=n.length(),E=.2*L,W=.5*L,j=!0===e.rotate?-2:0,R=!0===e.rotate?2:0;for(let t=2;t<=C;t+=.5){let l=n.getParallel("-"==x?-t:t),r=0,a=0,h=0,g=0,_=0,d=0,p=0;for(let e=j;e<=R;e+=.5){let t=l.getRotation(l.center(),e),i=0,n=0,s=0,o=0;do{let e=t.pointOnLine(i);if(e.x=Math.round(e.x),e.y=Math.round(e.y),e.x>plannerCanvas.width||e.x<-0||e.y>plannerCanvas.height||e.y<-0)break;plannerCanvas.getPixel(e.x,e.y)<v&&(n++,i/L<.2&&s++,.8<i/L&&o++,i/L<.5&&d++,.5<i/L&&p++),i++}while(L>i);r=Math.max(r,n),a=Math.max(a,s),h=Math.max(h,o),g=Math.max(g,0),_=Math.max(_,0)}var P=.3<r/L,Q=.3<a/E&&.3<h/E;let i=!0;var M=.7<r/L,D=.9<a/E||.9<h/E,O=.9<d/W||.9<p/W;if(P&&Q||M&&D&&O){let e=new Line(l.point_2,l.pointOnLine(L+10)),t=new Line(l.point_1,l.pointOnLine(-10));var F=e.getCountPixelsOnLine(v),G=t.getCountPixelsOnLine(v);.5<F/e.length()||.5<G/t.length()||(i=!1)}if((P&&Q||M&&D&&O)&&i)k=!0,b=0;else{if(k){let e=n.getParallel("-"==x?.5-t:t-.5);B[Math.round(new Line(c,e.center()).length())]=e}k=!1,b++}if(b>=y&&0<Object.keys(B).length)break}return B}autoParserOuterWallVerticalLine(t,i,e={},n=!1){var s,o=new Line(new Point(0,0),new Point(plannerCanvas.width,0)),l=new Line(new Point(0,0),new Point(0,plannerCanvas.height)),r=new Line(new Point(0,plannerCanvas.height),new Point(plannerCanvas.width,plannerCanvas.height)),a=new Line(new Point(plannerCanvas.width,0),new Point(plannerCanvas.width,plannerCanvas.height));let h=!1;for(s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&i.isPointOnLine(innerWalls.points[s],.05)&&i.center().equal(innerWalls.points[s],3)){let e=innerWalls.points[s].line();var g=e.otherPoint(innerWalls.points[s]);h=!0;for(let e=0;e<t.length;e++)if(t[e].isPointOnLine(g,.05)&&t[e].center().equal(g,3)){h=!1;break}if(h)break}if(h)return!1;let _=i.getNormal();var d=i.center(),o=_.intersection(o),l=_.intersection(l),r=_.intersection(r),a=_.intersection(a);let p=new Line,c=new Line;if(!1!==o&&(p.isValid()?c.isValid()||(c=new Line(d,o)):p=new Line(d,o)),!1!==l&&(p.isValid()?c.isValid()||(c=new Line(d,l)):p=new Line(d,l)),!1!==r&&(p.isValid()?c.isValid()||(c=new Line(d,r)):p=new Line(d,r)),!1!==a&&(p.isValid()?c.isValid()||(c=new Line(d,a)):p=new Line(d,a)),!p.isValid()&&!c.isValid())return!1;o=outerWalls.isIntersectionWall(p);if(o===outerWalls.isIntersectionWall(c))return!1;let A=o?c:p;if(innerWalls.isIntersectionWall(A))return!1;if(innerWalls.isExistPointOnLine(A))return!1;l=i.length()/10;let u=[A,A.getParallel(l),A.getParallel(2*l),A.getParallel(3*l),A.getParallel(4*l),A.getParallel(5*l),A.getParallel(-l),A.getParallel(-2*l),A.getParallel(-3*l),A.getParallel(-4*l),A.getParallel(-5*l)],w=[];for(let e=0;e<u.length;e++)n&&u[e].paint("green");var m=e.maxCount&&0<e.maxCount?e.maxCount:200,f=plannerParser.max_distance_between_walls;let I=!1,C={};var y,b=e.pixelValue&&0<e.pixelValue?e.pixelValue:170;for(let s=.5;s<=5;s+=.2){I=!1;let i={},n=1;for(let e=0;e<u.length;e++)w[e]=0;do{for(let t=0;t<u.length;t++)if(!(w[t]>f)){let e=u[t].pointOnLine(n);u[t].isPointOnLine(e)?(e.x=Math.round(e.x),e.y=Math.round(e.y),e.x>plannerCanvas.width||e.x<0||e.y>plannerCanvas.height||e.y<0||(plannerCanvas.getPixel(e.x,e.y)<b?(i[t]=e,w[t]=0):w[t]+=s)):I=!0}}while(n+=s,!I&&m>n);for(var v in i)i.hasOwnProperty(v)&&(C[i[v].getKey()]=i[v])}for(y in C)C.hasOwnProperty(y)&&n&&C[y].paint("red");let x=2,B=null,k=null,L=null,E=i.getParallel(-5).intersection(A)?"-":"+",W={},P={},Q={},M=0,D=JSON.parse(JSON.stringify(C));var j=Object.keys(C).length;do{let e=i.getParallel("-"===E?-x:x),n=(x+=.5,0);for(var O in C)C.hasOwnProperty(O)&&e.isPointOnLine(C[O])&&(n++,""===E&&(E="-"),delete D[O]);if(M=0<n?0:M+.5,5<=n){B=e,P[n]=B;let t=0,i=0;var R=Math.round(B.length())+10;do{let e=B.pointOnLine(t);if(!B.isPointOnLine(e))break;e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<b&&i++,t++}while(R>t);Q[i]=B}}while(!(M>f&&Object.keys(D).length/j<.3)&&m>x);if(null!==B&&(W[Math.round(new Line(d,B.center()).length())]=B),0<Object.keys(P).length){let e=Object.keys(P);e.sort((e,t)=>e-t).reverse(),k=P[e[0]],W[Math.round(new Line(d,k.center()).length())]=k}if(0<Object.keys(Q).length){let e=Object.keys(Q);e.sort((e,t)=>e-t).reverse(),L=Q[e[0]],W[Math.round(new Line(d,L.center()).length())]=L}return W}staticParserOuterWallHorizontalLine(t,e,i=0){if(e.length()<50)return!1;var n,s=new Line(new Point(0,0),new Point(plannerCanvas.width,0)),o=new Line(new Point(0,0),new Point(0,plannerCanvas.height)),l=new Line(new Point(0,plannerCanvas.height),new Point(plannerCanvas.width,plannerCanvas.height)),r=new Line(new Point(plannerCanvas.width,0),new Point(plannerCanvas.width,plannerCanvas.height));let a=!1;for(n in innerWalls.points)if(innerWalls.points.hasOwnProperty(n)&&e.isPointOnLine(innerWalls.points[n],.05)&&e.center().equal(innerWalls.points[n],3)){let e=innerWalls.points[n].line();var h=e.otherPoint(innerWalls.points[n]);a=!0;for(let e=0;e<t.length;e++)if(t[e].isPointOnLine(h,.05)&&t[e].center().equal(h,3)){a=!1;break}if(a)break}if(a)return!1;let g=e.getNormal();var _=e.center(),s=g.intersection(s),o=g.intersection(o),l=g.intersection(l),r=g.intersection(r);let d=new Line,p=new Line;if(!1!==s&&(d.isValid()?p.isValid()||(p=new Line(_,s)):d=new Line(_,s)),!1!==o&&(d.isValid()?p.isValid()||(p=new Line(_,o)):d=new Line(_,o)),!1!==l&&(d.isValid()?p.isValid()||(p=new Line(_,l)):d=new Line(_,l)),!1!==r&&(d.isValid()?p.isValid()||(p=new Line(_,r)):d=new Line(_,r)),!d.isValid()&&!p.isValid())return!1;s=outerWalls.isIntersectionWall(d);if(s===outerWalls.isIntersectionWall(p))return!1;o=s?p:d;if(innerWalls.isIntersectionWall(o))return!1;if(innerWalls.isExistPointOnLine(o))return!1;l=e.getParallel(-5).intersection(o)?"-":"+";return e.getParallel("-"==l?-10:10)}tryParserHorizontal(e,t,i){if(1===Object.keys(i).length&&Object.keys(i)[0]>plannerParser.max_distance_between_walls){var n=i[Object.keys(i)[0]];if(this.isExistWall(n,t)&&this.isExistWall2(n,t))return i}return(0===Object.keys(i).length||getMinKey(i)>plannerParser.max_distance_between_walls||1===Object.keys(i).length&&Object.keys(i)[0]<8)&&(i=this.autoParserOuterWallHorizontalLine(e,t,{pixelValue:170,rotate:!0})),(0===Object.keys(i).length||getMinKey(i)>plannerParser.max_distance_between_walls||1===Object.keys(i).length&&Object.keys(i)[0]<8)&&(i=this.autoParserOuterWallHorizontalLine(e,t,{pixelValue:200})),(0===Object.keys(i).length||getMinKey(i)>plannerParser.max_distance_between_walls||1===Object.keys(i).length&&Object.keys(i)[0]<8)&&(i=this.autoParserOuterWallHorizontalLine(e,t,{pixelValue:200,rotate:!0})),(0===Object.keys(i).length||getMinKey(i)>plannerParser.max_distance_between_walls||1===Object.keys(i).length&&Object.keys(i)[0]<8)&&(i=this.autoParserOuterWallHorizontalLine(e,t,{pixelValue:240})),i=0===Object.keys(i).length||getMinKey(i)>plannerParser.max_distance_between_walls||1===Object.keys(i).length&&Object.keys(i)[0]<8?this.autoParserOuterWallHorizontalLine(e,t,{pixelValue:252}):i}cutLine(e){let s=[e,e.getParallel(-1,1),e.getParallel(1,1),e.getParallel(-2,1),e.getParallel(2,1)],o=[],r;for(let n=0;n<s.length;n++){let t=0;var l=s[n].length();let i=0;do{let e=s[n].pointOnLine(t);e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<50&&i++,t++}while(l>t);if(o[n]=i/t,1===o[n])break}let t=0,n;for(let e=0;e<o.length;e++)o[e]>t&&(t=o[e],n=s[e]);if(r=e,1===t){r.point_1=n.point_1,r.point_2=n.point_2;let s=new Line(r.point_1,r.point_2).getParallel(0,2),o=1;var i=s.length();let e=new Line(s.getParallel(-10).point_1,s.getParallel(10).point_1),l="+";e.getParallel(-5).intersection(s)&&(l="-");do{var a=e.length();let t=0,i=!1,n=e.getParallel("+"===l?o:-o);do{let e=n.pointOnLine(t);if(e.x=Math.round(e.x),e.y=Math.round(e.y),200<plannerCanvas.getPixel(e.x,e.y)||e.x>plannerCanvas.width||e.x<-0||e.y>plannerCanvas.height||e.y<-0){let e=s.pointOnLine(o-1);new Line(e,r.point_1).length()<100&&(e.x=Math.round(e.x),e.y=Math.round(e.y),r.point_1=e),i=!0;break}}while(a>++t);if(i)break}while(i>++o);o=1,s=new Line(r.point_2,r.point_1).getParallel(0,2),e=new Line(s.getParallel(-10).point_1,s.getParallel(10).point_1),l="+",e.getParallel(-5).intersection(s)&&(l="-");do{var h=e.length();let t=0,i=!1,n=e.getParallel("+"===l?o:-o);do{let e=n.pointOnLine(t);if(e.x=Math.round(e.x),e.y=Math.round(e.y),200<plannerCanvas.getPixel(e.x,e.y)||e.x>plannerCanvas.width||e.x<-0||e.y>plannerCanvas.height||e.y<-0){let e=s.pointOnLine(o-1);new Line(e,r.point_2).length()<100&&(e.x=Math.round(e.x),e.y=Math.round(e.y),r.point_2=e),i=!0;break}}while(h>++t);if(i)break}while(i>++o)}else if(.8<t){let t=new Line(n.point_1,n.point_2),i=0;var g=t.length();do{let e=t.pointOnLine(i);if(e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<50){r.point_1=e;break}}while(g>++i);i=0,t=new Line(n.point_2,n.point_1);do{let e=t.pointOnLine(i);if(e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<50){r.point_2=e;break}}while(g>++i)}return r}isExistWall(e,t){let i=new Line(new Line(e.point_1,t.point_1).center(),new Line(e.point_2,t.point_2).center());var s=new Line(e.point_1,t.point_1).length()-4,e=i.length()/10;let n=new Line(i.pointNearLineCenter(s/2,"inside"),i.pointNearLineCenter(s/2,"outside")),o=[n,n.getParallel(e),n.getParallel(2*e),n.getParallel(3*e),n.getParallel(4*e),n.getParallel(-e),n.getParallel(-2*e),n.getParallel(-3*e),n.getParallel(-4*e)];for(let e=0;e<o.length;e++);let l=0;for(let n=0;n<o.length;n++){let t=1,i=0;do{let e=o[n].pointOnLine(t);if(!o[n].isPointOnLine(e))break;e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<220&&i++,t++}while(s>t);.7<=i/s&&l++}return 7<=l}isInWall(e){let t=new Line(e.pointNearLineCenter(6,"inside"),e.pointNearLineCenter(6,"outside"));e=e.length()/10;let s=[t,t.getParallel(e),t.getParallel(2*e),t.getParallel(3*e),t.getParallel(4*e),t.getParallel(-e),t.getParallel(-2*e),t.getParallel(-3*e),t.getParallel(-4*e)];for(let e=0;e<s.length;e++);let o=0;for(let n=0;n<s.length;n++){let t=1,i=0;do{let e=s[n].pointOnLine(t);if(!s[n].isPointOnLine(e))break;e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<220&&i++,t++}while(t<12);.7<=i/12&&o++}return 7<=o}isInWall2(e){let t=new Line(e.pointNearLineCenter(6,"inside"),e.center());var i=e.length()/10;let s=[t,t.getParallel(i),t.getParallel(2*i),t.getParallel(3*i),t.getParallel(4*i),t.getParallel(-i),t.getParallel(-2*i),t.getParallel(-3*i),t.getParallel(-4*i)];for(let e=0;e<s.length;e++);let o=0;for(let n=0;n<s.length;n++){let t=1,i=0;do{let e=s[n].pointOnLine(t);if(!s[n].isPointOnLine(e))break;e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<220&&i++,t++}while(t<6);.5<=i/6&&o++}if(o<3)return!1;t=new Line(e.center(),e.pointNearLineCenter(6,"outside")),s=[t,t.getParallel(i),t.getParallel(2*i),t.getParallel(3*i),t.getParallel(4*i),t.getParallel(-i),t.getParallel(-2*i),t.getParallel(-3*i),t.getParallel(-4*i)];for(let e=0;e<s.length;e++);for(let n=o=0;n<s.length;n++){let t=1,i=0;do{let e=s[n].pointOnLine(t);if(!s[n].isPointOnLine(e))break;e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<220&&i++,t++}while(t<6);.5<=i/6&&o++}return 3<o}isExistAfterWall(e,t,i=1){var n=e.getParallel(8),s=e.getParallel(-8);let o=new Line(e.center(),t.center());e=o.intersection(n),t=o.intersection(s);return!(!e&&!t)&&(e?1===i?!this.isNotInWall(s):this.isInWall(s):t?1===i?!this.isNotInWall(n):this.isInWall(n):void 0)}isNotInWall(e){let t=new Line(e.pointNearLineCenter(6,"inside"),e.pointNearLineCenter(6,"outside"));e=e.length()/10;let s=[t,t.getParallel(e),t.getParallel(2*e),t.getParallel(3*e),t.getParallel(4*e),t.getParallel(-e),t.getParallel(-2*e),t.getParallel(-3*e),t.getParallel(-4*e)];for(let e=0;e<s.length;e++);let o=0;for(let n=0;n<s.length;n++){let t=1,i=0;do{let e=s[n].pointOnLine(t);if(!s[n].isPointOnLine(e))break;e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<220&&i++,t++}while(t<12);.2<=i/12&&o++}return o<3}isNotExistWall(e,t){let i=new Line(new Line(e.point_1,t.point_1).center(),new Line(e.point_2,t.point_2).center());var s=new Line(e.point_1,t.point_1).length()-4,e=i.length()/10;let n=new Line(i.pointNearLineCenter(s/2,"inside"),i.pointNearLineCenter(s/2,"outside")),o=[n,n.getParallel(e),n.getParallel(2*e),n.getParallel(3*e),n.getParallel(4*e),n.getParallel(-e),n.getParallel(-2*e),n.getParallel(-3*e),n.getParallel(-4*e)];for(let e=0;e<o.length;e++);let l=0;for(let n=0;n<o.length;n++){let t=1,i=0;do{let e=o[n].pointOnLine(t);if(!o[n].isPointOnLine(e))break;e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<200&&i++,t++}while(s>t);.2<=i/s&&l++}return l<3}isExistWall2(e,t){return this.isExistWall(new Line(e.point_1,t.point_1),new Line(e.point_2,t.point_2))}}class Point{constructor(e,t){this.x=e,this.y=t}equal(e,t=null){return null===t?this.x===e.x&&this.y===e.y:Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t}paint(e="red"){plannerCanvas.paintPoint(this,e)}red(){this.paint("red")}getKey(){return this.x+"-"+this.y}getCopy(){return new Point(this.x,this.y)}}class PointLine extends Point{constructor(e,t){super(e,t),this.key=this.getKey(),this.id=uuid().substr(0,13),this.lines={},this.isConnected=!1}paintLines(e="red"){for(var t in this.lines)this.lines.hasOwnProperty(t)&&this.lines[t].paint(e)}countLines(){return Object.keys(this.lines).length}linesArray(){return Object.values(this.lines)}line(e=0){return this.linesArray()[e]}otherLines(e){let t=[];for(var i in this.lines)this.lines.hasOwnProperty(i)&&e.id!==i&&t.push(this.lines[i]);return t}set(e){this.x=e.x,this.y=e.y,this.key=this.getKey(),this.update()}setX(e){this.x=e,this.key=this.getKey(),this.update()}setY(e){this.y=e,this.key=this.getKey(),this.update()}setLines(e){this.lines=e,this.isConnected=1<this.countLines()}addLine(e,t){this.lines[e.id]=e,t&&__debugP.l(this.countLines()),1<this.countLines()&&(this.isConnected=!0)}deleteLine(e){delete this.lines[e],this.countLines()<=1&&(this.isConnected=!1)}getCopy(){return new PointLine(this.x,this.y)}isOneLine(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)&&void 0!==e.lines[t])return!0;return!1}getCommonLine(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)&&void 0!==e.lines[t])return e.lines[t];return!1}update(){}}class PointOuterWall extends PointLine{getCopy(){return new PointOuterWall(this.x,this.y)}update(){for(var e in super.update(),outerWalls.updateKeys(),this.lines)this.lines.hasOwnProperty(e)&&void 0!==outerWalls.lines[e]&&(this.lines[e]=outerWalls.lines[e])}}class PointWall extends PointLine{constructor(e,t){super(e,t),this.pointsBorders=[],this.isDock=!1,this.dockLine=void 0}isNotAxis(){return(this.pointsBorders[0].x-this.x)*(this.pointsBorders[1].y-this.y)==(this.pointsBorders[1].x-this.x)*(this.pointsBorders[0].y-this.y)}getCopy(){return new PointWall(this.x,this.y)}update(){for(var e in super.update(),innerWalls.updateKeys(),this.lines)this.lines.hasOwnProperty(e)&&(this.lines[e]=innerWalls.lines[e])}getLineEqualDepth(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)&&e.isEqualDepth(this.lines[t]))return this.lines[t];return!1}getPerpendicularLine(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)&&t!==e.id&&e.isAlmostPerpendicular(this.lines[t]))return this.lines[t];return!1}getParallelLine(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)&&t!==e.id&&e.isParallel(this.lines[t]))return this.lines[t];return!1}getParallelLines(e){let t={};for(var i in this.lines)this.lines.hasOwnProperty(i)&&i!==e.id&&e.isParallel(this.lines[i])&&(t[i]=this.lines[i]);return t}}class PointParserWall extends PointLine{getCopy(){return new PointParserWall(this.x,this.y)}update(){for(var e in super.update(),parserWalls.updateKeys(),this.lines)this.lines.hasOwnProperty(e)&&(this.lines[e]=parserWalls.lines[e])}}class PointHole extends PointLine{getCopy(){return new PointHole(this.x,this.y)}update(){for(var e in super.update(),holes.updateKeys(),this.lines)this.lines.hasOwnProperty(e)&&(this.lines[e]=holes.lines[e])}}class Line{constructor(e=null,t=null){this.point_1=e,this.point_2=t,this.options={},this.id=void 0,this.keyLine=void 0}key(){return this.point_1.getKey()+":"+this.point_2.getKey()}equalPoints(e=null){return this.point_1.equal(this.point_2,e)}equalLines(e,t=null){return this.point_1.equal(e.point_1,t)&&this.point_2.equal(e.point_2,t)||this.point_1.equal(e.point_2,t)&&this.point_2.equal(e.point_1,t)}isCommonPoint(e,t=null){return this.point_1.equal(e.point_1,t)||this.point_2.equal(e.point_2,t)||this.point_1.equal(e.point_2,t)||this.point_2.equal(e.point_1,t)}paint(e="red"){plannerCanvas.paintLine(this.point_1,this.point_2,e)}paintEnd(e){plannerCanvas.paintPoint(this.pointOnLine(5),e)}paintPoints(e){plannerCanvas.paintPoint(this.point_1,e),plannerCanvas.paintPoint(this.point_2,e)}vector(){return{x:this.point_2.x-this.point_1.x,y:this.point_2.y-this.point_1.y}}scalar(e){return this.vector().x*e.vector().x+this.vector().y*e.vector().y}length(){return Math.sqrt(Math.pow(this.vector().x,2)+Math.pow(this.vector().y,2))}center(){return new Point(+((this.point_1.x+this.point_2.x)/2).toFixed(plannerParser.count_round),+((this.point_1.y+this.point_2.y)/2).toFixed(plannerParser.count_round))}angleBetween(e){const t=this.scalar(e)/(this.length()*e.length());return Math.acos(+t.toFixed(10))/Math.PI*180}angleBetween2(e){return this.point_1.equal(e.point_1)?this.angleBetween(e):(this.point_2.equal(e.point_2)?new Line(this.point_2,this.point_1):this).angleBetween(new Line(e.point_2,e.point_1))}isAlmostPerpendicular(e){e=this.angleBetween2(e);return 85<e&&e<95}isAlmost180Angle(e){e=this.angleBetween(e);return 176<=e||e<=3}isParallel(e,t=0){e=this.angleBetween(e);return 176<=e||e<=3}intersection(e){var t=(e.point_2.x-e.point_1.x)*(this.point_1.y-e.point_1.y)-(e.point_2.y-e.point_1.y)*(this.point_1.x-e.point_1.x),i=(this.point_2.x-this.point_1.x)*(this.point_1.y-e.point_1.y)-(this.point_2.y-this.point_1.y)*(this.point_1.x-e.point_1.x),e=(e.point_2.y-e.point_1.y)*(this.point_2.x-this.point_1.x)-(e.point_2.x-e.point_1.x)*(this.point_2.y-this.point_1.y);if(0==e)return!1;if(0==t&&0==e)return!1;if(0==i&&0==e)return!1;t/=e,i/=e;return 0<=t&&t<=1&&0<=i&&i<=1&&new Point(+(this.point_1.x+t*(this.point_2.x-this.point_1.x)).toFixed(plannerParser.count_round),+(this.point_1.y+t*(this.point_2.y-this.point_1.y)).toFixed(plannerParser.count_round))}intersectionBigLine(e){return this.getBigLine().intersection(e.getBigLine())}isOverlay(e,t=1,i){return!1!==this.getLengthOverlay(e,t,i)}isOverlayLines(e,t=1,i){for(var n in e)if(e.hasOwnProperty(n)&&(this.isOverlay(e[n],t,i)||e[n].isOverlay(this,t,i)))return!0;return!1}getLengthOverlay(t,e=1,i){let n=this.getParallel(0,e),s=n.getNormal();e=n.length()/6;let o=[s,s.getParallel(e),s.getParallel(2*e),s.getParallel(3*e),s.getParallel(-e),s.getParallel(-2*e),s.getParallel(-3*e)];if(i)for(let e=0;e<o.length;e++)o[e].paint("orange");let l,r;for(let e=0;e<o.length;e++)if(l=o[e].intersection(t)){r=new Line(o[e].intersection(t),l);break}return void 0!==r&&(i&&(r.paint("green"),l.paint("red")),parseInt(r.length(),10))}getBigLine(e){void 0!==e&&0!==e||(e=50);var t=new Line(new Point(this.point_1.x+e*(this.point_2.x-this.point_1.x),this.point_1.y+e*(this.point_2.y-this.point_1.y),""),new Point(this.point_1.x+-e*(this.point_2.x-this.point_1.x),this.point_1.y+-e*(this.point_2.y-this.point_1.y),""));return this.lineIsGoBorders(t)||100<=e?t:this.getBigLine(e+10)}lineIsGoBorders(e){return(e.point_1.x>plannerCanvas.width||e.point_1.x<-0||e.point_1.y>plannerCanvas.height||e.point_1.y<-0)&&(e.point_2.x>plannerCanvas.width||e.point_2.x<-0||e.point_2.y>plannerCanvas.height||e.point_2.y<-0)}getBigLineOne(e){void 0===e&&(e=50);let t=new Line(new Point(this.point_1.x,this.point_1.y,""),new Point(this.point_1.x+-e*(this.point_2.x-this.point_1.x),this.point_1.y+-e*(this.point_2.y-this.point_1.y),""));return t=!1===t.isPointOnLine(this.point_2)?new Line(new Point(this.point_1.x,this.point_1.y,""),new Point(this.point_1.x+e*(this.point_2.x-this.point_1.x),this.point_1.y+e*(this.point_2.y-this.point_1.y),"")):t}isHorizontal(e=null){if(this.point_1.x===this.point_2.x)return!1;e=null!==e?e:4;return Math.abs(this.point_1.y-this.point_2.y)<=e}isVertical(e=null){if(this.point_1.y===this.point_2.y)return!1;e=null!==e?e:4;return Math.abs(this.point_1.x-this.point_2.x)<=e}getType(){return this.isHorizontal()?"H":this.isVertical()?"V":"D"}getParallel(t=10,i=1){let n=this.center(),s=this.center(),e=1e4;for(;0<e--;){let e=new Line(this.point_1,n);if(e.length()<i){n=e.pointNearLineCenter(t,"inside");break}n=e.center()}for(e=100;0<e--;){let e=new Line(this.point_2,s);if(e.length()<i){s=e.pointNearLineCenter(t,"outside");break}s=e.center()}return new Line(n,s)}pointNearLineCenter(e=10,t="inside"){var i=this.length();return"inside"===t?new Point(+((this.point_1.x+this.point_2.x)/2+e*(this.point_1.y-this.point_2.y)/i).toFixed(plannerParser.count_round),+((this.point_1.y+this.point_2.y)/2-e*(this.point_1.x-this.point_2.x)/i).toFixed(plannerParser.count_round)):"outside"===t?new Point(+((this.point_1.x+this.point_2.x)/2-e*(this.point_1.y-this.point_2.y)/i).toFixed(plannerParser.count_round),+((this.point_1.y+this.point_2.y)/2+e*(this.point_1.x-this.point_2.x)/i).toFixed(plannerParser.count_round)):void 0}getNormal(e=1e3){var t=this.center();return new Line(new Point(t.x+(this.point_1.y-t.y)*e,t.y+(t.x-this.point_1.x)*e),new Point(t.x+(this.point_1.y-t.y)*-e,t.y+(t.x-this.point_1.x)*-e))}pointOnLine(e){e/=this.length();let t=this.point_1.x+(this.point_2.x-this.point_1.x)*e,i=this.point_1.y+(this.point_2.y-this.point_1.y)*e;return new Point(+t.toFixed(plannerParser.count_round),+i.toFixed(plannerParser.count_round))}isPointOnLine(e,t=.02){return Math.abs(new Line(this.point_1,e).length()+new Line(this.point_2,e).length()-this.length())<t}isPointOnStraight(e){return(this.point_1.x-e.x)*(this.point_2.y-e.y)==(this.point_2.x-e.x)*(this.point_1.y-e.y)}isLineOnLine(e,t=.001){return this.isPointOnLine(e.point_1,t)&&this.isPointOnLine(e.point_2,t)}isOneAxis(e,t=.001){let i=this.getBigLine();return i.isPointOnLine(e.point_1,t)&&i.isPointOnLine(e.point_2,t)}getPaddingPointOnLine(e){return Math.abs(new Line(this.point_1,e).length()+new Line(this.point_2,e).length()-this.length())}getPointProjection(e){var t=this.point_1,i=this.point_2,n=+(t.x+(i.x-t.x)*(((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)))).toFixed(plannerParser.count_round),e=+(t.y+(i.y-t.y)*(((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)))).toFixed(plannerParser.count_round);return new Point(n,e)}getRotation(e,t){t=t/180*Math.PI;var i=e.x+(this.point_1.x-e.x)*Math.cos(t)-(this.point_1.y-e.y)*Math.sin(t),n=e.y+(this.point_1.y-e.y)*Math.cos(t)-(this.point_1.x-e.x)*Math.sin(t),s=e.x+(this.point_2.x-e.x)*Math.cos(t)-(this.point_2.y-e.y)*Math.sin(t),e=e.y+(this.point_2.y-e.y)*Math.cos(t)-(this.point_2.x-e.x)*Math.sin(t);return new Line(new Point(i,n),new Point(s,e))}getPointPlace(e,t){e=(e.x-t.point_1.x)*(t.point_2.y-t.point_1.y)-(e.y-t.point_1.y)*(t.point_2.x-t.point_1.x);return 0==e?"axis":0<e?"outer":e<0?"inner":void 0}getPlaceByLine(e){var e=this.getNormal().intersection(e),t=new Line(this.center(),e).length(),e=this.getPointPlace(e,this);return t<1?"axis":e}getLengthBetweenLines(e){var t=this.getNormal().intersection(e);return!1===t?(this.getNormal().paint(),e.paint("blue"),!1):new Line(this.center(),t).length()}getCopy(){return new Line(this.point_1.getCopy(),this.point_2.getCopy())}getIncreaseLine(e){var t=this.length(),i=this.pointOnLine(t+e),t=new Line(this.point_2,this.point_1).pointOnLine(t+e);return new Line(i,t)}getCommonPoint(e){return this.point_1.equal(e.point_1)||this.point_1.equal(e.point_2)?this.point_1:(this.point_2.equal(e.point_2)||!!this.point_2.equal(e.point_1))&&this.point_2}getOtherPoint(e){return this.point_1.equal(e.point_1)||this.point_1.equal(e.point_2)?this.point_2:(this.point_2.equal(e.point_2)||!!this.point_2.equal(e.point_1))&&this.point_1}otherPoint(e){return this.point_1.equal(e)||this.point_2.equal(e)||(__debugP.e(e.key,this.point_1.key,this.point_2.key),__debugP.e("нет другой точки")),this.point_1.equal(e)?this.point_2:this.point_1}setPointById(e,t){this.point_1.id===e?(this.point_1.deleteLine(this.id),this.point_1=t,this.point_1.addLine(this)):(this.point_2.deleteLine(this.id),this.point_2=t,this.point_2.addLine(this))}getCountPixelsOnLine(t){let i=0;var e=this.length();let n=0;do{let e=this.pointOnLine(i);e.x=Math.round(e.x),e.y=Math.round(e.y),plannerCanvas.getPixel(e.x,e.y)<t&&n++,i++}while(e>i);return n}isValid(){return null!==this.point_1&&null!==this.point_2}calculateDepth(e){return+new Line(this.center(),this.getNormal().intersection(e.getBigLine())).length().toFixed(plannerParser.count_round)}hasEqualPoint(e,t=null){return this.point_1.equal(e,t)||this.point_2.equal(e,t)}hasPoint(e){return this.point_1.id===e.id||this.point_2.id===e.id}paddingAngle(e){"D"!==this.getType()&&e.getType();var t=this.length(),e=e.length();return t<20&&60<e||e<20&&60<t?3:40<t&&40<e?.7:30<t&&30<e?1:20<t&&20<e?1.5:2.5}}class Wall extends Line{constructor(e=null,t=null){super(e,t),this.type=void 0,this.outerLines=[],this.depth=void 0,this.outerDepth=void 0,this.innerDepth=void 0,this.holes={},this.isPillar=!1,this.isBalcony=!1,this.centerPillar=void 0,this.isArtificial=!1,this.isValid()&&(this.type=this.getType(),this.id=uuid().substr(0,13))}getOuterDepth(){return void 0!==this.outerDepth?this.outerDepth:+(this.depth/2).toFixed(1)}getInnerDepth(){return void 0!==this.innerDepth?this.innerDepth:+(this.depth/2).toFixed(1)}setDepth(e){(e=Math.ceil(+e))<9?e=8:e<11?e=10:e<12&&(e=12),this.depth=e}getCopy(){return new Wall(this.point_1.getCopy(),this.point_2.getCopy())}setPointById(e,t){super.setPointById(e,t),innerWalls.updateKeysLines()}addOuterLine(e){this.existOuterLine(e)||(this.outerLines.push(e),e.lines[this.id]=this)}addOuterLines(t){for(let e=0;e<t.length;e++)this.addOuterLine(t[e])}deleteOuterLine(t){this.outerLines=this.outerLines.filter(e=>e.id!==t)}existOuterLine(t){for(let e=0;e<this.outerLines.length;e++)if(this.outerLines[e].id===t.id)return!0;return!1}isCommonOuterLine(i){for(let t=0;t<this.outerLines.length;t++)for(let e=0;e<i.outerLines.length;e++)if(this.outerLines[t].id===i.outerLines[e].id)return!0;return!1}getCommonOuterLine(i){for(let t=0;t<this.outerLines.length;t++)for(let e=0;e<i.outerLines.length;e++)if(this.outerLines[t].id===i.outerLines[e].id)return this.outerLines[t];return!1}isParserOuterLine(){for(let e=0;e<this.outerLines.length;e++)if(this.outerLines[e].isParser)return!0;return!1}isEqualDepth(e){return Math.abs(this.depth-e.depth)<=this.paddingDepthWall(this.depth,e.depth)}paddingDepthWall(e,t){return 50<e&&50<t?8:40<e&&40<t?7:30<e&&30<t?6:20<e&&20<t?5:4}isOverlayOuterLines(i,n=!1){for(let t=0;t<this.outerLines.length;t++)for(var s in this.outerLines[t].lines)if(this.outerLines[t].lines.hasOwnProperty(s)&&s!==this.id){let e=this.outerLines[t].lines[s];if(i.isParallel(e)&&(i.isOverlay(e,5)||e.isOverlay(i,5)))return n&&(e.paint("green"),i.paint("blue")),!0}return!1}addHole(e){this.holes[e.id]=e}deleteHole(e){delete this.holes[e.id]}}class OuterWall extends Line{constructor(e=null,t=null){super(e,t),this.lines={},this.isParser=!1,this.isBalcony=!1,this.isValid()&&(this.id=uuid().substr(0,13))}getCopy(){return new OuterWall(this.point_1.getCopy(),this.point_2.getCopy())}setPointById(e,t){super.setPointById(e,t),outerWalls.updateKeysLines()}countLines(){return Object.keys(this.lines).length}linesArray(){return Object.values(this.lines)}line(e=0){return this.linesArray()[e]}deleteLine(e){delete this.lines[e]}updateLines(){for(var e in this.lines)this.lines.hasOwnProperty(e)&&(this.lines[e]=innerWalls.lines[e])}isOverlayInnerLines(e,t=[],i=!1){let n={};for(var s in t.forEach(function(e,t){n[e.id]=1}),this.lines)if(this.lines.hasOwnProperty(s)&&void 0===n[s]&&this.lines[s].isOverlay(e))return i&&e.paint(),!0;return!1}}class ParserWall extends Line{constructor(e=null,t=null){super(e,t),this.outerLines=[],this.depth=void 0,this.isBalcony=!1,this.isValid()&&(this.id=uuid().substr(0,13))}getCopy(){return new ParserWall(this.point_1.getCopy(),this.point_2.getCopy())}setPointById(e,t){super.setPointById(e,t),parserWalls.updateKeysLines()}addOuterLine(e){this.existOuterLine(e)||this.outerLines.push(e)}addOuterLines(t){for(let e=0;e<t.length;e++)this.addOuterLine(t[e])}existOuterLine(t){for(let e=0;e<this.outerLines.length;e++)if(this.outerLines[e].id===t.id)return!0;return!1}}class Hole extends Line{constructor(e=null,t=null){super(e,t),this.type=void 0,this.line=void 0,this.depth=void 0,this.windoor={window_width:0,door_width:0},this.isValid()&&(this.id=uuid().substr(0,13))}getCopy(){return new Hole(this.point_1.getCopy(),this.point_2.getCopy())}setInnerLine(e){(this.line=e).addHole(this)}}class ListLines{constructor(){this.points={},this.lines={},this.pointsKeys={},this.linesKeys={}}clear(){this.lines={},this.points={},this.linesKeys={},this.pointsKeys={}}addLine(e,t=!1){this.lines[e.id]=e,t&&__debugP.l(e.id,e.key(),this.lines[e.id]),this.lines[e.id].point_1.addLine(this.lines[e.id],t),this.lines[e.id].point_2.addLine(this.lines[e.id],t),this.updateKeysLines()}addPoint(e){this.points[e.id]=e,this.updateKeysPoints()}deletePoint(e){delete this.points[e],this.updateKeysPoints()}deleteLine(e){this.lines[e].point_1.deleteLine(e),this.lines[e].point_2.deleteLine(e),delete this.lines[e],this.updateKeysLines()}updateKeysLines(){for(var e in this.linesKeys={},this.lines)this.lines.hasOwnProperty(e)&&(this.lines[e].keyLine=this.lines[e].key(),this.linesKeys[this.lines[e].key()]=e)}updateKeysPoints(){for(var e in this.pointsKeys={},this.points)this.points.hasOwnProperty(e)&&(this.pointsKeys[this.points[e].key]=e)}updateKeys(){this.updateKeysLines(),this.updateKeysPoints()}findLine(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)){if(this.lines[t].point_1.equal(e.point_1)&&this.lines[t].point_2.equal(e.point_2))return this.lines[t];if(this.lines[t].point_1.equal(e.point_2)&&this.lines[t].point_2.equal(e.point_1))return this.lines[t]}return!1}findPoint(e,t=null,i=null){for(var n in this.points)if(this.points.hasOwnProperty(n)&&n!==e.id&&(null===i||i.id!==n)&&this.points[n].equal(e,t))return this.points[n];return!1}paintLines(e="red"){for(var t in this.lines)this.lines.hasOwnProperty(t)&&this.lines[t].paint(e)}paintPoints(e="red"){for(var t in this.points)this.points.hasOwnProperty(t)&&this.points[t].paint(e)}isPointOnLines(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)&&this.lines[t].isPointOnLine(e))return!0;return!1}isOverlayWall(t,e=[]){let i={};for(var n in e.forEach(function(e,t){i[e.id]=1}),this.lines)if(this.lines.hasOwnProperty(n)&&t.id!==n&&void 0===i[n]){let e=this.lines[n].length()>t.length()?t:this.lines[n];var s=this.lines[n].length()>t.length()?this.lines[n]:t,s=e.getNormal().intersection(s);if(s&&!(50<new Line(s,e.center()).length())&&(this.lines[n].isOverlay(t)||t.isOverlay(this.lines[n])))return!0}return!1}getWallPointOnLine(e,t=.02){for(var i in this.lines)if(this.lines.hasOwnProperty(i)&&this.lines[i].isPointOnLine(e,t))return this.lines[i];return!1}replacePoint(e,t){for(var i in innerWalls.points[e].lines)innerWalls.points[e].lines.hasOwnProperty(i)&&innerWalls.points[e].lines[i].setPointById(e,innerWalls.points[t]);innerWalls.deletePoint(e)}countLines(){return Object.keys(this.lines).length}countPoints(){return Object.keys(this.points).length}reverseWalls(e){let t={};for(var i in e)e.hasOwnProperty(i)&&(void 0===t[e[i].point_1.id]&&(t[e[i].point_1.id]=0),void 0===t[e[i].point_2.id]&&(t[e[i].point_2.id]=0),t[e[i].point_1.id]++,t[e[i].point_2.id]++);let n;for(var s in t)if(t.hasOwnProperty(s)&&1===t[s]){n=s;break}let o=Object.values(e),l={},r=100;for(;0<r;){let t=!1;for(let e=0;e<o.length;e++)if(void 0===l[o[e].id]&&(o[e].point_1.id===n||o[e].point_2.id===n)){var a;o[e].point_1.id!==n&&(a=o[e].point_1,o[e].point_1=o[e].point_2,o[e].point_2=a,a=o[e].innerDepth,o[e].innerDepth=o[e].outerDepth,o[e].outerDepth=a),n=o[e].point_2.id,l[o[e].id]="",t=!0;break}if(r--,!t)break}}}class OuterWalls extends ListLines{test1(){for(var e in outerWalls.points)if(outerWalls.points.hasOwnProperty(e))for(var t in outerWalls.points[e].lines)outerWalls.points[e].lines.hasOwnProperty(t)&&outerWalls.points[e].lines[t].point_1.id!==e&&outerWalls.points[e].lines[t].point_2.id!==e&&(outerWalls.points[e].paint("blue"),outerWalls.points[e].lines[t].paint("green"),__debugP.e(outerWalls.points[e]))}test2(){for(var e in outerWalls.points)if(outerWalls.points.hasOwnProperty(e))for(var t in outerWalls.points[e].lines)outerWalls.points[e].lines.hasOwnProperty(t)&&void 0===outerWalls.points[e].lines[t]&&(outerWalls.points[e].paint("blue"),__debugP.e(outerWalls.points[e],outerWalls.lines[t]))}test3(){for(var e in outerWalls.points)if(outerWalls.points.hasOwnProperty(e))for(var t in outerWalls.points[e].lines)outerWalls.points[e].lines.hasOwnProperty(t)&&void 0===outerWalls.lines[t]&&(outerWalls.points[e].paint("blue"),__debugP.e(outerWalls.points[e],outerWalls.lines[t]))}fillWalls(s){for(let n=0;n<s.length;n++){let t=new PointOuterWall(+s[n][0].x.toFixed(plannerParser.count_round),+s[n][0].y.toFixed(plannerParser.count_round)),i=new PointOuterWall(+s[n][1].x.toFixed(plannerParser.count_round),+s[n][1].y.toFixed(plannerParser.count_round));if(!t.equal(i)){this.findPoint(t)?t=this.findPoint(t):this.addPoint(t),this.findPoint(i)?i=this.findPoint(i):this.addPoint(i);let e=new OuterWall(t,i);e.equalPoints()||this.findLine(e)||("parser"===s[n][3]&&(e.isParser=!0),"balcony"===s[n][2]&&(e.isBalcony=!0),this.addLine(e))}}}isIntersectionWall(t,e=[],i=!1,n=!1){let s={};for(var o in e.forEach(function(e,t){s[e.id]=1}),this.lines)if(this.lines.hasOwnProperty(o)&&void 0===s[o]){let e=this.lines[o].intersection(t);if(e&&(i||!this.lines[o].isPointOnLine(t.point_1)&&!this.lines[o].isPointOnLine(t.point_2)&&!this.lines[o].point_1.equal(e,.5)&&!this.lines[o].point_2.equal(e,.5)))return n&&e.paint(),!0}return!1}countIntersectionWall(t,e=[],i=!1){let n={},s=(e.forEach(function(e,t){n[e.id]=1}),0);for(var o in this.lines)if(this.lines.hasOwnProperty(o)&&void 0===n[o]){let e=this.lines[o].intersection(t);!e||this.lines[o].isPointOnLine(t.point_1)||this.lines[o].isPointOnLine(t.point_2)||this.lines[o].point_1.equal(e,.5)||this.lines[o].point_2.equal(e,.5)||(i&&e.paint(),s++)}return s}deleteInnerWallFromOuterWalls(e){for(var t in this.lines)this.lines.hasOwnProperty(t)&&void 0!==this.lines[t].lines[e]&&this.lines[t].deleteLine(e);this.updateInnerLines()}updateInnerLines(){for(var e in this.lines)this.lines.hasOwnProperty(e)&&this.lines[e].updateLines()}isExistOnLine(e){if(e.length()>e.depth)return!1;for(var t in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(t)&&(outerWalls.lines[t].isPointOnLine(e.point_1)||outerWalls.lines[t].isPointOnLine(e.point_2)))return!0;return!1}deleteLine(e){for(var t in this.lines[e].lines)this.lines[e].lines.hasOwnProperty(t)&&this.lines[e].lines[t].deleteOuterLine(e);super.deleteLine(e)}deleteAloneLine(e){return this.deleteLine(e.id),0===e.point_1.countLines()&&this.deletePoint(e.point_1.id),0===e.point_2.countLines()&&this.deletePoint(e.point_2.id),!0}}class InnerWalls extends ListLines{constructor(){super(),this.foundsLines=[],this.intersectionPoints7={}}clear(){super.clear(),this.intersectionPoints7={}}deleteLine(t){for(let e=0;e<this.lines[t].outerLines.length;e++)void 0!==this.lines[t].outerLines[e].lines[t]&&this.lines[t].outerLines[e].deleteLine(t);super.deleteLine(t)}buildWall(n,e,t){let s=[];var i=n.getParallel(10,2),o=n.getParallel(0,2),l=e.getParallel(10,2),r=e.getParallel(0,2);let a=new Line(o.point_1,i.point_1).getBigLine(),h=new Line(o.point_2,i.point_2).getBigLine(),g=new Line(r.point_1,l.point_1).getBigLine(),_=new Line(r.point_2,l.point_2).getBigLine(),d;if(d=a.intersection(e)){let e=new PointWall(0,0);e.set(new Line(n.point_1,d).center()),e.pointsBorders=[n.point_1,d],s.push(e)}if(d=h.intersection(e)){let t=new PointWall(0,0),i=(t.set(new Line(n.point_2,d).center()),!(t.pointsBorders=[n.point_2,d]));for(let e=0;e<s.length;e++)if(s[e].equal(t,1)){i=!0;break}!1===i&&s.push(t)}if(d=g.intersection(n)){let t=new PointWall(0,0),i=(t.set(new Line(e.point_1,d).center()),!(t.pointsBorders=[e.point_1,d]));for(let e=0;e<s.length;e++)if(s[e].equal(t,1)){i=!0;break}!1===i&&s.push(t)}if(d=_.intersection(n)){let t=new PointWall(0,0),i=(t.set(new Line(e.point_2,d).center()),!(t.pointsBorders=[e.point_2,d]));for(let e=0;e<s.length;e++)if(s[e].equal(t,1)){i=!0;break}!1===i&&s.push(t)}for(let e=0;e<s.length;e++);if(s.length<2)return __debugP.warn("меньше двух точек",n,e),!1;2<s.length&&__debugP.warn("больше двух точек",n,e);let p,c,A,u=((p=this.findPoint(s[0]))||(p=this.findPoint(s[0],1))?c=this.points[p.id]:(c=s[0],this.addPoint(c)),(p=this.findPoint(s[1]))||(p=this.findPoint(s[1],1))?A=this.points[p.id]:(A=s[1],this.addPoint(A)),new Wall(c,A));return!u.equalPoints()&&(this.findLine(u)?this.findLine(u):(u.addOuterLine(n),u.addOuterLine(e),u.setDepth(t),u.outerDepth=u.getOuterDepth(),u.innerDepth=u.getInnerDepth(),u.isBalcony=n.isBalcony,this.addLine(u),u))}addFoundLines(){for(let s=0;s<this.foundsLines.length;s++){let e,t,i,n=((e=this.findPoint(this.foundsLines[s].point_1))||(e=this.findPoint(this.foundsLines[s].point_1,1))?t=this.points[e.id]:(t=new PointWall(this.foundsLines[s].point_1.x,this.foundsLines[s].point_1.y),this.addPoint(t)),(e=this.findPoint(this.foundsLines[s].point_2))||(e=this.findPoint(this.foundsLines[s].point_2,1))?i=this.points[e.id]:(i=new PointWall(this.foundsLines[s].point_2.x,this.foundsLines[s].point_2.y),this.addPoint(i)),new Wall(t,i));n.equalPoints()||this.findLine(n)||(n.setDepth(10),n.outerDepth=n.getOuterDepth(),n.innerDepth=n.getInnerDepth(),n.isArtificial=!0,this.addLine(n))}}isIntersectionWall(t,e=[],i=!1,n=!1){let s={};for(var o in e.forEach(function(e,t){s[e.id]=1}),this.lines)if(this.lines.hasOwnProperty(o)&&void 0===s[o]){let e=this.lines[o].intersection(t);if(e&&(i&&!t.point_1.equal(e)&&!t.point_2.equal(e)||!this.lines[o].point_1.equal(e)&&!this.lines[o].point_2.equal(e)))return n&&e.paint(),!0}return!1}deleteAloneLine(e){return this.deleteLine(e.id),0===e.point_1.countLines()&&this.deletePoint(e.point_1.id),0===e.point_2.countLines()&&this.deletePoint(e.point_2.id),outerWalls.deleteInnerWallFromOuterWalls(e.id),!0}isNearLines(e){for(var t in this.lines)if(this.lines.hasOwnProperty(t)&&(this.lines[t].point_1.equal(e.point_1,1)||this.lines[t].point_2.equal(e.point_1,1)||this.lines[t].point_1.equal(e.point_2,1)||this.lines[t].point_2.equal(e.point_2,1)))return!0;return!1}isExistPointOnLine(e){for(var t in this.points)if(this.points.hasOwnProperty(t)&&e.isPointOnLine(this.points[t]))return!0;return!1}isExistNearFreePoint(t){for(var i in this.points)if(this.points.hasOwnProperty(i)&&t.id!==i&&!this.points[i].isConnected&&!this.points[i].isDock){let e=new Line(this.points[i],t);if(!(e.length()>plannerParser.max_distance_between_walls/2||outerWalls.isIntersectionWall(e)||this.isIntersectionWall(e)))return!0}return!1}isNearWall(e,t,i=!1){let n=new Line(e.pointNearLineCenter(4,"inside"),e.pointNearLineCenter(4,"outside"));var s=Math.floor(e.length()/8),o=e.length()/s;let l=[n];for(let e=1;e<s/2;e++)l.push(n.getParallel(o*e)),l.push(n.getParallel(o*-e));if(i)for(let e=0;e<l.length;e++)l[e].paint("green");for(let e=0;e<l.length;e++)if(this.isIntersectionWall(l[e],[t]))return!0;return!1}}class ParserWalls extends ListLines{fillWalls(e,t){for(var i in t)t.hasOwnProperty(i)&&(this.addNewWall(e[i],t[i],{fix_depth:1}),__debugP.step("ParserWalls.fillWalls"))}addNewWall(i,n,s={}){let o=new PointParserWall(+n.point_1.x.toFixed(plannerParser.count_round),+n.point_1.y.toFixed(plannerParser.count_round)),l=new PointParserWall(+n.point_2.x.toFixed(plannerParser.count_round),+n.point_2.y.toFixed(plannerParser.count_round));if(void 0!==s.fix_depth){n=new Line(o,l);if(i.calculateDepth(n)<10){let e=i.getParallel(10);s=i.getParallel(-10);let t;t=new Line(i.center(),e.center()).intersection(n)?e:s,o=new PointParserWall(t.point_1.x,t.point_1.y),l=new PointParserWall(t.point_2.x,t.point_2.y)}}this.findPoint(o)?o=this.findPoint(o):this.addPoint(o),this.findPoint(l)?l=this.findPoint(l):this.addPoint(l);let e=new ParserWall(o,l);e.equalPoints()||this.findLine(e)||(e.depth=i.calculateDepth(e),e.addOuterLine(i),e.isBalcony=i.isBalcony,this.addLine(e))}deleteAloneLine(e){return this.deleteLine(e.id),0===e.point_1.countLines()&&this.deletePoint(e.point_1.id),0===e.point_2.countLines()&&this.deletePoint(e.point_2.id),!0}}class Holes extends ListLines{fillHoles(l){for(let o=0;o<l.length;o++){let i=new Line(new Point(l[o][0].x,l[o][0].y),new Point(l[o][1].x,l[o][1].y)),s=new Wall,e=1e8;for(var t in innerWalls.lines){var n;innerWalls.lines.hasOwnProperty(t)&&((0<=(n=i.angleBetween(innerWalls.lines[t]))&&n<=45||135<=n&&n<=225||325<=n&&n<=360)&&i.isOverlay(innerWalls.lines[t])&&(n=innerWalls.lines[t].getPointProjection(i.center()),(n=new Line(i.center(),n).length())<e&&(s=innerWalls.lines[t],e=n)))}if(s.isValid()){let e=s.getPointProjection(i.point_1),t=s.getPointProjection(i.point_2),n=(e=new PointHole(e.x,e.y),t=new PointHole(t.x,t.y),this.findPoint(e)?e=this.findPoint(e):this.addPoint(e),this.findPoint(t)?t=this.findPoint(t):this.addPoint(t),new Hole(e,t));if(!holes.findLine(n))if(new Line(i.center(),n.center()).length()>plannerParser.max_distance_between_old_and_new_holes)__debugP.warn("Окно далеко от стены");else{if(n.type=l[o][2],n.setInnerLine(s),n.depth=s.depth,n.type="doorway"===n.type?"door":n.type,"windoor"===n.type&&n.length()<100&&(n.type="window"),"door"===n.type){let i=Math.ceil(n.length());if(i<=65?i=60:i<75?i=70:i<85?i=80:i<95?i=90:i<=100&&(i=100),+n.length()!=i){var r=+(i/2).toFixed(1);let e=new Line(n.center(),n.point_1);var a=e.pointOnLine(r);let t=new Line(n.center(),n.point_2);r=t.pointOnLine(r);n.point_1.set(a),n.point_2.set(r)}}if("window"===n.type){a=10*Math.round(n.length()/10);if(+n.length()!=a){r=+(a/2).toFixed(1);let e=new Line(n.center(),n.point_1);var h=e.pointOnLine(r);let t=new Line(n.center(),n.point_2);var g=t.pointOnLine(r);n.point_1.set(h),n.point_2.set(g)}}if("windoor"===n.type){h=10*Math.round(n.length()/10);if(+n.length()!=h){g=+(h/2).toFixed(1);let e=new Line(n.center(),n.point_1);var _=e.pointOnLine(g);let t=new Line(n.center(),n.point_2);var d=t.pointOnLine(g);n.point_1.set(_),n.point_2.set(d)}100==h?(n.windoor.door_width=40,n.windoor.window_width=60):(n.windoor.door_width=60,n.windoor.window_width=h-n.windoor.door_width)}this.addLine(n),__debugP.step("Holes.fillHoles")}}}}deleteLine(e){this.line.deleteHole(this),super.deleteLine(e)}deleteAloneLine(e){return this.deleteLine(e.id),0===e.point_1.countLines()&&this.deletePoint(e.point_1.id),0===e.point_2.countLines()&&this.deletePoint(e.point_2.id),!0}}class OuterWallsFunctions{constructor(){this.count_use_function={}}correctLinesAfterFilling(){__debugP.debug_time("_alignmentWalls"),outerWallsFunctions.alignmentWalls(),__debugP.debug_time_end("_alignmentWalls"),__debugP.debug_time("_joinCloselyWalls"),outerWallsFunctions.joinCloselyWalls(),__debugP.debug_time_end("_joinCloselyWalls"),__debugP.debug_time("_unionWalls"),outerWallsFunctions.unionWalls(),__debugP.debug_time_end("_unionWalls"),__debugP.debug_time("_connectWalls"),outerWallsFunctions.connectWalls(),__debugP.debug_time_end("_connectWalls"),__debugP.debug_time("_splitLines"),outerWallsFunctions.splitLines(),__debugP.debug_time_end("_splitLines"),__debugP.debug_time("_connectFreeWallsRightAngles"),outerWallsFunctions.connectFreeWallsRightAngles(),__debugP.debug_time_end("_connectFreeWallsRightAngles"),__debugP.debug_time("_alignmentWalls"),outerWallsFunctions.alignmentWalls(),__debugP.debug_time_end("_alignmentWalls"),__debugP.debug_time("_alignmentWalls2"),outerWallsFunctions.alignmentWalls2(),__debugP.debug_time_end("_alignmentWalls2"),__debugP.debug_time("_joinCloselyWalls"),outerWallsFunctions.joinCloselyWalls(),__debugP.debug_time_end("_joinCloselyWalls"),__debugP.debug_time("_unionWalls"),outerWallsFunctions.unionWalls(),__debugP.debug_time_end("_unionWalls"),__debugP.debug_time("_connectWalls"),outerWallsFunctions.connectWalls(),__debugP.debug_time_end("_connectWalls")}alignmentWalls(){for(var e in outerWalls.lines){var t,i;outerWalls.lines.hasOwnProperty(e)&&("H"===outerWalls.lines[e].getType()&&outerWalls.lines[e].point_1.y!==outerWalls.lines[e].point_2.y&&((t=new Line(new PointWall(0,0),new PointWall(500,0)).angleBetween(outerWalls.lines[e]))<3||177<t)&&(__debugP.log("alignmentWalls выравнивание"),t=outerWalls.lines[e].center().y,outerWalls.lines[e].point_1.setY(t),outerWalls.lines[e].point_2.setY(t),__debugP.step("OuterWalls.alignmentWalls")),"V"===outerWalls.lines[e].getType()&&outerWalls.lines[e].point_1.x!==outerWalls.lines[e].point_2.x&&((t=new Line(new PointWall(0,0),new PointWall(0,550)).angleBetween(outerWalls.lines[e]))<3||177<t)&&(__debugP.log("alignmentWalls выравнивание"),i=outerWalls.lines[e].center().x,outerWalls.lines[e].point_1.setX(i),outerWalls.lines[e].point_2.setX(i),__debugP.step("OuterWalls.alignmentWalls")))}}alignmentWalls2(){if(void 0===this.count_use_function.x_alignmentOuterWall2&&(this.count_use_function.x_alignmentOuterWall2=0),500<this.count_use_function.x_alignmentOuterWall2++)return __debugP.error("MAX call x_alignmentOuterWall2"),!1;for(var n in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(n)&&"D"!==outerWalls.lines[n].getType()&&void 0===outerWalls.lines[n].options.alignmentOuterWall2Fix){outerWalls.lines[n].point_2.key;let e=this.findAlignmentOuterWall2(outerWalls.lines[n],outerWalls.lines[n].point_1),t=this.findAlignmentOuterWall2(outerWalls.lines[n],outerWalls.lines[n].point_2),i={};for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);for(var l in i)i.hasOwnProperty(l);this.alignmentOuterWall2Handler(i,outerWalls.lines[n].getType()),__debugP.step("OuterWalls.alignmentWalls2")}}findAlignmentOuterWall2(t,e,i={}){let n=t.getBigLine(),s=1e8,o=null,l=null;for(var r in outerWalls.points)if(outerWalls.points.hasOwnProperty(r)&&e.id!==outerWalls.points[r].id){var a=new Line(e,outerWalls.points[r]).length();if(!(a>plannerParser.max_distance_between_walls)){let e=null;for(var h in outerWalls.points[r].lines)if(outerWalls.points[r].lines.hasOwnProperty(h)&&t.isAlmost180Angle(outerWalls.points[r].lines[h])&&!t.isOverlay(outerWalls.points[r].lines[h])&&n.isPointOnLine(outerWalls.points[r].lines[h].point_1)&&n.isPointOnLine(outerWalls.points[r].lines[h].point_2)&&new Line(outerWalls.points[r].lines[h].center(),outerWalls.points[r].lines[h].getNormal().intersection(n)).length()<3.5){e=outerWalls.points[r].lines[h];break}a<s&&null!==e&&(o=e,s=a,l=outerWalls.points[r])}}return null!==o&&void 0===i[t.key()]?(i[t.key()]=t,i[o.key()]=o,this.findAlignmentOuterWall2(o,o.otherPoint(l),i)):i}alignmentOuterWall2Handler(n,s){if(0!==Object.keys(n).length)if(1===Object.keys(n).length)for(var e in n)n.hasOwnProperty(e)&&(n[e].options.alignmentOuterWall2Fix=!0);else{let e=1e6,t=0,i;if("H"===s){for(var o in n)n.hasOwnProperty(o)&&(e=Math.min(n[o].point_1.y,e),t=Math.max(n[o].point_1.y,t));var l=+((e+t)/2).toFixed(plannerParser.count_round);i=new Line(new PointWall(0,l),new PointWall(300,l)).getBigLine()}else if("V"===s){for(var r in n)n.hasOwnProperty(r)&&(e=Math.min(n[r].point_1.x,e),t=Math.max(n[r].point_1.x,t));l=+((e+t)/2).toFixed(plannerParser.count_round);i=new Line(new PointWall(l,0),new PointWall(l,300)).getBigLine()}if(e===t)for(var a in n)n.hasOwnProperty(a)&&(n[a].options.alignmentOuterWall2Fix=!0);else{for(var h in n){var g,_;n.hasOwnProperty(h)&&(g=i.getPointProjection(n[h].point_1),_=i.getPointProjection(n[h].point_2),n[h].point_1.set(g),n[h].point_2.set(_),n[h].options.alignmentOuterWall2Fix=!0)}__debugP.log("выравнивание линий")}}}joinCloselyWalls(){if(void 0===this.count_use_function.x_joinOuterWalls&&(this.count_use_function.x_joinOuterWalls=0),500<this.count_use_function.x_joinOuterWalls++)return __debugP.log("MAX call x_joinOuterWalls"),!1;for(var s in outerWalls.points)if(outerWalls.points.hasOwnProperty(s)&&(outerWalls.points[s].key,!outerWalls.points[s].isConnected)){let e=outerWalls.points[s].line(),t=new OuterWall,i=null,n=1e8;for(var o in outerWalls.points){var l;!outerWalls.points.hasOwnProperty(o)||s===o||outerWalls.points[o].isConnected||outerWalls.points[s].isOneLine(outerWalls.points[o])||(4<(l=new Line(outerWalls.points[s],outerWalls.points[o]).length())||l<n&&(t=outerWalls.points[o].line(),i=o,n=l))}if(null!==i){var r=e.getBigLine().intersection(t.getBigLine());if(!1!==r)return outerWalls.points[i].set(r),e.setPointById(s,outerWalls.points[i]),outerWalls.deletePoint(s),__debugP.step("OuterWalls.joinCloselyWalls"),this.joinCloselyWalls(),!0}}return!1}unionWalls(){if(void 0===this.count_use_function.x_unionWalls&&(this.count_use_function.x_unionWalls=0),500<this.count_use_function.x_unionWalls++)return __debugP.log("MAX call x_unionWalls"),!1;for(var n in outerWalls.points)if(outerWalls.points.hasOwnProperty(n)&&(outerWalls.points[n].key,2===outerWalls.points[n].countLines())){let t=outerWalls.points[n].line(0),i=outerWalls.points[n].line(1);if(t.isAlmost180Angle(i)){let e=new OuterWall(t.otherPoint(outerWalls.points[n]),i.otherPoint(outerWalls.points[n]));if(!e.equalPoints()&&!outerWalls.findLine(e))return outerWalls.deletePoint(n),outerWalls.deleteLine(t.id),outerWalls.deleteLine(i.id),outerWalls.addLine(e),__debugP.step("OuterWalls.unionWalls"),this.unionWalls(),!0}}return!1}connectWalls(){if(void 0===this.count_use_function.x_connectWalls&&(this.count_use_function.x_connectWalls=0),500<this.count_use_function.x_connectWalls++)return __debugP.error("MAX call x_connectWalls"),!1;for(var o in outerWalls.points)if(outerWalls.points.hasOwnProperty(o)&&!outerWalls.points[o].isConnected){outerWalls.points[o].key;let i=outerWalls.points[o].line(),n=new OuterWall,s=null,t=1e8;if(i.isParser){for(var l in outerWalls.points){var r,a,h;!outerWalls.points.hasOwnProperty(l)||o===l||outerWalls.points[l].isConnected||outerWalls.points[o].isOneLine(outerWalls.points[l])||((r=new Line(outerWalls.points[o],outerWalls.points[l]).length())>1.5*plannerParser.max_distance_between_walls||(a=outerWalls.points[l].line(),!i.isAlmost180Angle(a)||!1!==(h=i.getLengthOverlay(a))&&0<h||r<t&&(n=a,s=l,t=r)))}let e=null;if(t=1e8,null!==s)for(var g in outerWalls.points){var _,d;!outerWalls.points.hasOwnProperty(g)||s===g||outerWalls.points[g].isConnected||((_=new Line(outerWalls.points[o],outerWalls.points[g]).length())>1.5*plannerParser.max_distance_between_walls||(d=outerWalls.points[g].line(),!n.isAlmost180Angle(d)||!1!==(d=n.getLengthOverlay(d))&&0<d||_<t&&(e=g,t=_)))}if(null!==s&&null!==e&&e===o){var p=new Line(outerWalls.points[o],outerWalls.points[s]).center();let e=new Line(p,i.otherPoint(outerWalls.points[o])),t=new Line(p,n.otherPoint(outerWalls.points[s]));if(!(e.length()<i.length()||t.length()<n.length())){var c=e.angleBetween2(i);if(!(1<c||1<t.angleBetween2(n)))return outerWalls.points[s].set(p),i.setPointById(o,outerWalls.points[s]),outerWalls.deletePoint(o),__debugP.step("OuterWalls.connectWalls"),this.connectWalls(),!0}}}}return!1}splitLines(){if(void 0===this.count_use_function.x_splitOuterLines&&(this.count_use_function.x_splitOuterLines=0),500<this.count_use_function.x_splitOuterLines++)return __debugP.error("MAX call x_splitOuterLines"),!1;for(var i in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(i)){let o=[],l=[];for(var e in outerWalls.points)!outerWalls.points.hasOwnProperty(e)||outerWalls.points[e].equal(outerWalls.lines[i].point_1)||outerWalls.points[e].equal(outerWalls.lines[i].point_2)||outerWalls.lines[i].isPointOnLine(outerWalls.points[e])&&(o.push(outerWalls.points[e].line()),l.push(outerWalls.points[e]));if(!(o.length<2)){let e=o[0],n=l[0];let s=null,t=100;for(;0<t--;){e=o[0],n=l[0],s=null;let i=1e8;for(let t=1;t<o.length;t++)if(e.isAlmost180Angle(o[t])&&e.isOverlay(o[t])){let e=new Line(n,l[t]);e.length()<plannerParser.max_distance_between_walls&&e.length()<i&&(o[t],s=l[t],i=e.length())}if(null!==s)break;if(o.splice(0,1),l.splice(0,1),o.length<2)break}if(null!==s&&!(new Line(n,s).length()>=outerWalls.lines[i].length())){let e=new OuterWall;if(new Line(outerWalls.lines[i].point_1,n).length()<new Line(outerWalls.lines[i].point_1,s).length()?(e=new OuterWall(outerWalls.lines[i].point_2,s),outerWalls.lines[i].setPointById(outerWalls.lines[i].point_2.id,n)):(e=new OuterWall(outerWalls.lines[i].point_2,n),outerWalls.lines[i].setPointById(outerWalls.lines[i].point_2.id,s)),!outerWalls.findLine(e)&&!e.equalPoints())return outerWalls.addLine(e),__debugP.step("OuterWalls.splitLines"),this.splitLines(),!0}}}return!1}connectFreeWallsRightAngles(){if(void 0===this.count_use_function.x_connectOuterLinesRightAngles&&(this.count_use_function.x_connectOuterLinesRightAngles=0),500<this.count_use_function.x_connectOuterLinesRightAngles++)return __debugP.error("MAX call x_connectOuterLinesRightAngles"),!1;for(var o in outerWalls.points)if(outerWalls.points.hasOwnProperty(o)&&(outerWalls.points[o].key,!outerWalls.points[o].isConnected)){let i=outerWalls.points[o].line(),n=new OuterWall,s=null,e=1e8;for(var l in outerWalls.points){var r,a;!outerWalls.points.hasOwnProperty(l)||o===l||outerWalls.points[l].isConnected||((r=new Line(outerWalls.points[o],outerWalls.points[l]).length())>plannerParser.max_distance_between_walls||(a=outerWalls.points[l].line(),(50<i.depth||50<a.depth)&&(Math.min(i.depth,a.depth),Math.max(i.depth,a.depth)),i.isAlmostPerpendicular(a)&&r<e&&(n=a,s=l,e=r)))}let t=null;if(e=1e8,null!==s)for(var h in outerWalls.points){var g,_;!outerWalls.points.hasOwnProperty(h)||s===h||outerWalls.points[h].isConnected||((g=new Line(outerWalls.points[s],outerWalls.points[h]).length())>plannerParser.max_distance_between_walls||(_=outerWalls.points[h].line(),n.isAlmostPerpendicular(_)&&g<e&&(t=h,e=g)))}if(null!==s&&null!==t&&t===o){var d=i.getBigLine().intersection(n.getBigLine());if(!1!==d){let e=new OuterWall(d,i.otherPoint(outerWalls.points[o])),t=new OuterWall(d,n.otherPoint(outerWalls.points[s]));if(!e.equalPoints()&&!t.equalPoints()){var p=e.angleBetween2(i);if(!(p>e.paddingAngle(i)||t.angleBetween2(n)>t.paddingAngle(n)||outerWalls.isIntersectionWall(e,[i])||outerWalls.isIntersectionWall(t,[i])))return outerWalls.points[s].set(d),i.setPointById(o,outerWalls.points[s]),outerWalls.deletePoint(o),__debugP.step("OuterWalls.connectFreeWallsRightAngles"),this.connectFreeWallsRightAngles(),!0}}}}return!1}}class InnerWallsFunctions{constructor(){this.count_use_function={},this.connect_line_counts_91=0}connects(){innerWalls.addFoundLines();try{this.findsDock()}catch(e){__debugP.errors(e),__debugP.error("WARNING! findsDock",e)}try{this.removeDock1()}catch(e){__debugP.errors(e),__debugP.error("WARNING! removeDock1",e)}try{this.removeDock2()}catch(e){__debugP.errors(e),__debugP.error("WARNING! removeDock2",e)}try{this.removeDock3()}catch(e){__debugP.errors(e),__debugP.error("WARNING! removeDock3",e)}try{this.removeDock4()}catch(e){__debugP.errors(e),__debugP.error("WARNING! removeDock4",e)}try{this.removeLittleLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! removeLittleLines",e)}try{this.removeWallFromJoins()}catch(e){__debugP.errors(e),__debugP.error("WARNING! removeWallFromJoins",e)}try{this.connectLinesWithDoor_1()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectLinesWithDoor_1",e)}try{this.connectLinesWithDoor_2()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectLinesWithDoor_2",e)}try{this.connectFreeParallelLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreeParallelLines",e)}try{this.connectLinesJointT()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectLinesJointT",e)}try{this.connectFreeRightAnglesEqualDepth()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreeRightAnglesEqualDepth",e)}try{this.connectFreeRightAnglesNoEqualDepth()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreeRightAnglesNoEqualDepth",e)}try{this.connectTwoNoFreeRightAngles()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectTwoNoFreeRightAngles",e)}try{this.connectFreeNoRightAnglesEqualDepth()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreeNoRightAnglesEqualDepth",e)}try{this.connectFreeNoRightAnglesAnyDepth()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreeNoRightAnglesAnyDepth",e)}try{this.connectFreeDiagonal()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreeDiagonal",e)}try{this.connectFreePointWithJointWhereEqualDepth()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithJointWhereEqualDepth",e)}try{this.connectFreePointWithJointRightAngle()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithJointRightAngle",e)}try{this.connectTwoNoFreeRightAngles()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectTwoNoFreeRightAngles",e)}try{this.connectFreePointWithLine()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithLine",e)}try{this.connectFreePointWithPerpendicularLineOfJoint()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithPerpendicularLineOfJoint",e)}try{this.connectFreePointWithParallelLineOfJoint()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithParallelLineOfJoint",e)}try{this.unionParallelLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! unionParallelLines",e)}try{this.equalizationWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! equalizationWalls",e)}try{this.movingAxis()}catch(e){__debugP.errors(e),__debugP.error("WARNING! movingAxis",e)}try{this.connectFreePointWithLine()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithLine",e)}try{this.movingAxisMicroWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! movingAxisMicroWalls",e)}try{if(this.connectTwoNoJoinPointOnDifferentLines())return void plannerParser.analyzePoints(!0)}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectTwoNoJoinPointOnDifferentLines",e)}try{this.connectDiagonalWithLine()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectDiagonalWithLine",e)}try{this.connectTwoFreePointOfTwoParallelLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectTwoFreePointOfTwoParallelLines",e)}try{this.connectFreePointWithParallelLineOfJoint_2()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithParallelLineOfJoint_2",e)}try{this.movingAxis_2()}catch(e){__debugP.errors(e),__debugP.error("WARNING! movingAxis_2",e)}try{this.connectNoJoinLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectNoJoinLines",e)}try{this.unionParallelLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! unionParallelLines",e)}try{this.movingAxisMicroWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! movingAxisMicroWalls",e)}try{this.movingAxisMicroWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! movingAxisMicroWalls",e)}try{this.connectFreePointWithDock()}catch(e){__debugP.errors(e),__debugP.error("WARNING! connectFreePointWithDock",e)}try{this.deleteLinesFromOnePoint()}catch(e){__debugP.errors(e),__debugP.error("WARNING! deleteLinesFromOnePoint",e)}try{this.deleteMicroWalls()}catch(e){__debugP.errors(e),__debugP.error("WARNING! deleteMicroWalls",e)}try{this.deleteMicroWalls_2()}catch(e){__debugP.errors(e),__debugP.error("WARNING! deleteMicroWalls_2",e)}try{holes.fillHoles(plannerParser.array_lines.filter(e=>in_array(e[2],["doorway","door","window","windoor"])))}catch(e){__debugP.errors(e),__debugP.error("WARNING! holes.fillHoles",e)}try{holesFunctions.removeHoles()}catch(e){__debugP.errors(e),__debugP.error("WARNING! removeHoles",e)}try{holesFunctions.movingDoors(),holesFunctions.movingDoors()}catch(e){__debugP.errors(e),__debugP.error("WARNING! movingDoors",e)}try{this.deleteLinesFromOnePoint()}catch(e){__debugP.errors(e),__debugP.error("WARNING! deleteLinesFromOnePoint",e)}try{this.deleteShortLines()}catch(e){__debugP.errors(e),__debugP.error("WARNING! deleteShortLines",e)}}findsDock(){for(var n in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(n))for(var s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&outerWalls.lines[n].isPointOnLine(innerWalls.points[s],1)&&outerWalls.lines[n].center().equal(innerWalls.points[s],3)){let i=innerWalls.points[s].line();if(!i.isParallel(outerWalls.lines[n])){let e,t;for(var o in outerWalls.lines[n].point_1.lines)if(outerWalls.lines[n].point_1.lines.hasOwnProperty(o)&&o!==outerWalls.lines[n].id&&i.isOverlay(outerWalls.lines[n].point_1.lines[o])){e=outerWalls.lines[n].point_1.lines[o];break}for(var l in outerWalls.lines[n].point_2.lines)if(outerWalls.lines[n].point_2.lines.hasOwnProperty(l)&&l!==outerWalls.lines[n].id&&i.isOverlay(outerWalls.lines[n].point_2.lines[l])){t=outerWalls.lines[n].point_2.lines[l];break}void 0!==e&&void 0!==t&&(i.existOuterLine(e)||i.existOuterLine(t))&&e.isParallel(t)&&e.isOverlay(t)&&(innerWalls.points[s].isDock=!0,innerWalls.points[s].dockLine=outerWalls.lines[n],__debugP.step("InnerWalls.findsDock"))}}}removeDock1(){for(var t in innerWalls.points)if(innerWalls.points.hasOwnProperty(t)&&innerWalls.points[t].isDock&&!innerWalls.points[t].isConnected){let e=innerWalls.points[t].line();if(0!==innerWalls.points[t].dockLine.countLines())for(var i in innerWalls.points)if(innerWalls.points.hasOwnProperty(i)&&t!==i&&innerWalls.points[i].isDock&&!innerWalls.points[i].isConnected){var n=innerWalls.points[i].line();if(0!==innerWalls.points[i].dockLine.countLines())if(e.intersection(n))return i=e.depth>n.depth?e:n,innerWalls.deleteAloneLine(i),__debugP.step("InnerWalls.removeDock1"),this.removeDock1(),!0}}return!1}removeDock2(){for(var e in innerWalls.points)if(innerWalls.points.hasOwnProperty(e)&&innerWalls.points[e].isDock&&!innerWalls.points[e].isConnected){let i=innerWalls.points[e].line();if(0!==innerWalls.points[e].dockLine.countLines()){let t=!1;for(let e=0;e<i.outerLines.length;e++)if(0!==i.outerLines[e].countLines())for(var n in i.outerLines[e].lines)if(i.outerLines[e].lines.hasOwnProperty(n)&&n!==i.id&&!i.outerLines[e].lines[n].point_1.isDock&&!i.outerLines[e].lines[n].point_2.isDock&&i.outerLines[e].lines[n].isOverlay(i)){t=!0;break}if(t=!t&&i.point_1.isDock&&i.point_2.isDock&&0<i.point_1.dockLine.countLines()&&0<i.point_2.dockLine.countLines()?!0:t)return innerWalls.deleteAloneLine(i),__debugP.step("InnerWalls.removeDock2"),this.removeDock2(),!0}}return!1}removeDock3(){for(var t in innerWalls.points)if(innerWalls.points.hasOwnProperty(t)&&innerWalls.points[t].isDock&&!innerWalls.points[t].isConnected&&0!==innerWalls.points[t].dockLine.countLines()){let e=innerWalls.points[t].line();if(e.length()<15&&60<e.depth)return innerWalls.deleteAloneLine(e),__debugP.step("InnerWalls.removeDock3"),this.removeDock3(),!0}return!1}removeDock4(){for(var e in innerWalls.points)if(innerWalls.points.hasOwnProperty(e)&&innerWalls.points[e].isDock&&!innerWalls.points[e].isConnected){var n=innerWalls.points[e].line();if(!n.isArtificial&&2===n.outerLines.length){let e=n.outerLines[0],t=n.outerLines[1],i=!1;for(var s in e.point_1.lines)if(e.point_1.lines.hasOwnProperty(s))for(var o in e.point_1.lines[s].lines)if(e.point_1.lines[s].lines.hasOwnProperty(o)&&o!==n.id&&!(e.point_1.lines[s].lines[o].length()<10)&&e.point_1.lines[s].lines[o].getBigLine().intersection(n)&&!e.point_1.lines[s].lines[o].intersection(n)){i=!0;break}if(!1===i)for(var l in e.point_2.lines)if(e.point_2.lines.hasOwnProperty(l))for(var r in e.point_2.lines[l].lines)if(e.point_2.lines[l].lines.hasOwnProperty(r)&&r!==n.id&&!(e.point_2.lines[l].lines[r].length()<10)&&e.point_2.lines[l].lines[r].getBigLine().intersection(n)&&!e.point_2.lines[l].lines[r].intersection(n)){i=!0;break}if(!1===i)for(var a in t.point_1.lines)if(t.point_1.lines.hasOwnProperty(a))for(var h in t.point_1.lines[a].lines)if(t.point_1.lines[a].lines.hasOwnProperty(h)&&h!==n.id&&!(t.point_1.lines[a].lines[h].length()<10)&&t.point_1.lines[a].lines[h].getBigLine().intersection(n)&&!t.point_1.lines[a].lines[h].intersection(n)){i=!0;break}if(!1===i)for(var g in t.point_2.lines)if(t.point_2.lines.hasOwnProperty(g))for(var _ in t.point_2.lines[g].lines)if(t.point_2.lines[g].lines.hasOwnProperty(_)&&_!==n.id&&!(t.point_2.lines[g].lines[_].length()<10)&&t.point_2.lines[g].lines[_].getBigLine().intersection(n)&&!t.point_2.lines[g].lines[_].intersection(n)){i=!0;break}if(i)return innerWalls.deleteAloneLine(n),__debugP.step("InnerWalls.removeDock4"),this.removeDock4(),!0}}return!1}removeLittleLines(){for(var e in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(e)&&!(innerWalls.lines[e].point_1.isConnected||innerWalls.lines[e].point_2.isConnected||5<innerWalls.lines[e].length()))return innerWalls.deleteAloneLine(innerWalls.lines[e]),__debugP.step("InnerWalls.removeLittleLines"),this.removeLittleLines(),!0;return!1}removeWallFromJoins(){this.removeWallFromJoins1(),this.removeWallFromJoins2(),this.removeWallFromJoins3(),this.removeWallFromJoins4(),this.removeWallFromJoins5(),this.removeWallFromJoins6(),this.removeWallFromJoins7(),this.removeWallFromJoins8(),this.removeWallFromJoins10()}removeWallFromJoins1(){for(var s in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(s)&&!(outerWalls.lines[s].countLines()<2)){let i=[];for(var e in outerWalls.lines[s].lines)outerWalls.lines[s].lines.hasOwnProperty(e)&&i.push(outerWalls.lines[s].lines[e]);let n=!1;for(let e=0;e<i.length;e++)for(let t=e+1;t<i.length;t++)if(i[e].isOverlay(i[t]))for(let e=0;e<i[t].outerLines.length;e++)if(i[t].outerLines[e].id!==s&&!(i[t].outerLines[e].countLines()<2))for(var o in i[t].outerLines[e].lines)if(i[t].outerLines[e].lines.hasOwnProperty(o)&&o!==i[t].id&&i[t].outerLines[e].lines[o].isOverlay(i[t])){n=!0,innerWalls.deleteAloneLine(i[t]);break}if(n)return __debugP.step("InnerWalls.removeWallFromJoins1"),this.removeWallFromJoins1(),!0}return!1}removeWallFromJoins2(){for(var l in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(l)&&2===outerWalls.lines[l].countLines()){let o=outerWalls.lines[l].line(0);var r=outerWalls.lines[l].line(1);if(o.isOverlay(r)){let e=!1,t=!1,i=!1,n=!1,s=!1;for(var a in outerWalls.lines)outerWalls.lines.hasOwnProperty(a)&&(outerWalls.lines[a].isPointOnLine(o.point_1)&&(t=!0),outerWalls.lines[a].isPointOnLine(o.point_2)&&(i=!0),outerWalls.lines[a].isPointOnLine(r.point_1)&&(n=!0),outerWalls.lines[a].isPointOnLine(r.point_2)&&(s=!0));if((t||i)&&(n||s)&&(__debugP.warn("два тупика рядом"),t&&i||this.isExistConnectPoint(o,t?o.point_2:o.point_1)&&(t=!1,i=!1),n&&s||this.isExistConnectPoint(r,n?r.point_2:r.point_1)&&(n=!1,s=!1),(t||i)&&(n||s)&&(__debugP.warn("два тупика рядом 2"),(l=autoParser.isInWall(o))!==autoParser.isInWall(r)&&(l?(t=!1,i=!1):(n=!1,s=!1)))),(t||i)&&(innerWalls.deleteAloneLine(o),e=!0),(n||s)&&(innerWalls.deleteAloneLine(r),e=!0),e)return __debugP.step("InnerWalls.removeWallFromJoins2"),this.removeWallFromJoins2(),!0}}return!1}removeWallFromJoins3(){for(var s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&innerWalls.points[s].isDock&&!innerWalls.points[s].isConnected){let e=innerWalls.points[s].line(),t=innerWalls.points[s],i=!1,n;for(var o in innerWalls.lines){var l;!innerWalls.lines.hasOwnProperty(o)||e.id===o||!(l=e.intersection(innerWalls.lines[o]))||e.hasEqualPoint(l)&&innerWalls.lines[o].hasEqualPoint(l)||(n=e.length()<innerWalls.lines[o].length()?e:innerWalls.lines[o],l=e.id===n.id?innerWalls.lines[o]:e,outerWalls.isPointOnLines(l.point_1)&&outerWalls.isPointOnLines(l.point_2)&&(n=l))}if(void 0!==n&&(innerWalls.deleteAloneLine(n),i=!0),void 0===n||n.id!==e.id){for(var r in t.dockLine.lines)if(t.dockLine.lines.hasOwnProperty(r)&&((n=t.dockLine.lines[r]).point_1.isDock||n.point_2.isDock))return n=n.depth>e.depth?n:e,innerWalls.deleteAloneLine(n),__debugP.step("InnerWalls.removeWallFromJoins3"),this.removeWallFromJoins3(),!0;for(var a in t.dockLine.lines)t.dockLine.lines.hasOwnProperty(a)&&(innerWalls.deleteAloneLine(t.dockLine.lines[a]),i=!0)}if(i)return __debugP.step("InnerWalls.removeWallFromJoins3"),this.removeWallFromJoins3(),!0}return!1}removeWallFromJoins4(){for(var t in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(t)&&!innerWalls.lines[t].point_1.isConnected&&!innerWalls.lines[t].point_2.isConnected)for(var i in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(i)&&!innerWalls.lines[i].point_1.isConnected&&!innerWalls.lines[i].point_2.isConnected&&innerWalls.lines[t].intersection(innerWalls.lines[i])){let e=innerWalls.lines[t].depth>innerWalls.lines[i].depth?innerWalls.lines[t]:innerWalls.lines[i];i=innerWalls.lines[t].id===e.id?innerWalls.lines[i]:innerWalls.lines[t];return outerWalls.isPointOnLines(i.point_1)&&outerWalls.isPointOnLines(i.point_2)&&(e=i),innerWalls.deleteAloneLine(e),__debugP.step("InnerWalls.removeWallFromJoins4"),this.removeWallFromJoins4(),!0}return!1}removeWallFromJoins5(){for(var t in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(t)&&!innerWalls.lines[t].point_1.isConnected&&!innerWalls.lines[t].point_2.isConnected){var i=outerWalls.getWallPointOnLine(innerWalls.lines[t].point_1,.1),n=outerWalls.getWallPointOnLine(innerWalls.lines[t].point_2,.1);if(!(!1!==i&&!1!==n||!1===i&&!1===n)){let e=!1!==i?i:n;if(0!==e.countLines()){var s,o=innerWalls.lines[t].getBigLine();for(s in e.lines)if(e.lines.hasOwnProperty(s)&&e.lines[s].intersection(o))return innerWalls.deleteAloneLine(innerWalls.lines[t]),__debugP.step("InnerWalls.removeWallFromJoins5"),this.removeWallFromJoins5(),!0}}}return!1}removeWallFromJoins6(){for(var t in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(t)&&!(innerWalls.lines[t].point_1.isConnected||innerWalls.lines[t].point_2.isConnected||innerWalls.lines[t].isArtificial)){var i=innerWalls.lines[t].outerLines[0],n=innerWalls.lines[t].outerLines[1];let e=innerWalls.lines[t].getNormal();var s,o=e.intersection(i),l=e.intersection(n),r=new Line(o,l);for(s in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(s)&&s!==i.id&&s!==n.id&&outerWalls.lines[s].intersection(r))return innerWalls.deleteAloneLine(innerWalls.lines[t]),__debugP.step("InnerWalls.removeWallFromJoins6"),this.removeWallFromJoins6(),!0}return!1}removeWallFromJoins7(){for(var i in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(i)&&!(innerWalls.lines[i].point_1.isConnected||innerWalls.lines[i].point_2.isConnected||innerWalls.lines[i].isArtificial)){let e=innerWalls.lines[i].outerLines[0],t=innerWalls.lines[i].outerLines[1];if(1<e.countLines()&&1<t.countLines()&&innerWalls.lines[i].depth>4*innerWalls.lines[i].length())return innerWalls.deleteAloneLine(innerWalls.lines[i]),__debugP.step("InnerWalls.removeWallFromJoins7"),this.removeWallFromJoins7(),!0}return!1}removeWallFromJoins8(){for(var t in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(t)&&!innerWalls.lines[t].point_1.isConnected&&!innerWalls.lines[t].point_2.isConnected){var e=innerWalls.lines[t].length();if(!(8<e)){var i,n=innerWalls.lines[t].getIncreaseLine(5);for(i in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(i)&&t!==i&&innerWalls.lines[i].intersection(n))for(let e=0;e<innerWalls.lines[i].outerLines.length;e++)if(innerWalls.lines[i].outerLines[e].intersection(n))return innerWalls.deleteAloneLine(innerWalls.lines[t]),__debugP.step("InnerWalls.removeWallFromJoins8"),this.removeWallFromJoins8(),!0}}return!1}removeWallFromJoins9(){for(var n in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(n)&&!(outerWalls.lines[n].countLines()<2)){let t=new Line,i=!1;for(var s in outerWalls.lines[n].lines)if(outerWalls.lines[n].lines.hasOwnProperty(s)){for(var o in outerWalls.lines[n].lines)if(outerWalls.lines[n].lines.hasOwnProperty(o)&&s!==o&&outerWalls.lines[n].lines[s].isOverlay(outerWalls.lines[n].lines[o])){let e=new Line(outerWalls.lines[n].lines[s].center(),outerWalls.lines[n].lines[o].center());var l=e.intersection(outerWalls.lines[n]);if(l){var r=new Line(outerWalls.lines[n].lines[s].center(),l).length(),l=new Line(outerWalls.lines[n].lines[o].center(),l).length();t=l<r?outerWalls.lines[n].lines[s]:outerWalls.lines[n].lines[o],i=!0;break}}if(i)break}if(!1!==i)return __debugP.warn("removeWallFromJoins9 - "+t.key()),innerWalls.deleteAloneLine(t),__debugP.step("InnerWalls.removeWallFromJoins9"),this.removeWallFromJoins9(),!0}return!1}removeWallFromJoins10(){for(var e in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(e)&&!innerWalls.lines[e].point_1.isConnected&&!innerWalls.lines[e].point_2.isConnected){var t=innerWalls.lines[e].length();if(!(50<t)&&2===innerWalls.lines[e].outerLines.length&&innerWalls.lines[e].outerLines[0].isParser&&innerWalls.lines[e].outerLines[1].isParser)return __debugP.error("удалена парсерная стена"),innerWalls.deleteAloneLine(innerWalls.lines[e]),__debugP.step("InnerWalls.removeWallFromJoins10"),this.removeWallFromJoins10(),!0}return!1}connectFreeParallelLines(){if(void 0===this.count_use_function.x_connectFreeParallelLines&&(this.count_use_function.x_connectFreeParallelLines=0),500<this.count_use_function.x_connectFreeParallelLines++)return __debugP.error("MAX call x_connectFreeParallelLines"),!1;for(var l in innerWalls.points)if(innerWalls.points.hasOwnProperty(l)&&!innerWalls.points[l].isConnected&&!innerWalls.points[l].isDock){innerWalls.points[l].key;let n=innerWalls.points[l].line(),s=new Wall,o=null,e=1e8;for(var t in innerWalls.points){var i,r;!innerWalls.points.hasOwnProperty(t)||l===t||innerWalls.points[t].isConnected||innerWalls.points[t].isDock||innerWalls.points[l].isOneLine(innerWalls.points[t])||((i=new Line(innerWalls.points[l],innerWalls.points[t]).length())>plannerParser.max_distance_between_walls||(r=innerWalls.points[t].line(),n.isAlmost180Angle(r)&&!n.isOverlay(r)&&n.isEqualDepth(r)&&i<e&&(s=r,o=t,e=i)))}if(null!==o){var a=new Line(innerWalls.points[l],innerWalls.points[o]).center();let t=new Line(a,n.otherPoint(innerWalls.points[l])),i=new Line(a,s.otherPoint(innerWalls.points[o]));if(!(t.length()<n.length()||i.length()<s.length())){var h=t.angleBetween2(n);if(!(h>t.paddingAngle(n)||i.angleBetween2(s)>i.paddingAngle(s))){let e=n.getCommonOuterLine(s);if(!1!==e){if(e.isOverlayInnerLines(t,[n]))continue;if(e.isOverlayInnerLines(i,[s]))continue}if(!n.isOverlayOuterLines(t)&&!s.isOverlayOuterLines(i)){let e;return(e=innerWalls.findPoint(a,1))?(h=n.hasEqualPoint(e)||s.hasEqualPoint(e),n.setPointById(l,innerWalls.points[e.id]),s.setPointById(o,innerWalls.points[e.id]),!0===h?e.equal(innerWalls.points[o])?innerWalls.deletePoint(l):innerWalls.deletePoint(o):(innerWalls.deletePoint(l),innerWalls.deletePoint(o))):(innerWalls.points[o].set(a),n.setPointById(l,innerWalls.points[o]),innerWalls.deletePoint(l)),__debugP.step("InnerWalls.connectFreeParallelLines"),this.connectFreeParallelLines(),!0}}}}}return!1}connectLinesJointT(){if(void 0===this.count_use_function.x_connectLinesJointT&&(this.count_use_function.x_connectLinesJointT=0),500<this.count_use_function.x_connectLinesJointT++)return __debugP.error("MAX call x_connectLinesJointT"),!1;for(var s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&!innerWalls.points[s].isConnected&&!innerWalls.points[s].isDock){innerWalls.points[s].key;let i=innerWalls.points[s].line();var t,o,l;new Wall;let n=null,e=1e8;for(t in innerWalls.points)!innerWalls.points.hasOwnProperty(t)||s===t||!innerWalls.points[t].isConnected||innerWalls.points[t].isDock||(o=new Line(innerWalls.points[s],innerWalls.points[t]).length())>plannerParser.max_distance_between_walls||(l=innerWalls.points[t].line(),i.isAlmostPerpendicular(l)&&o<e&&(n=t,e=o));if(null!==n){let t=new Line(i.otherPoint(innerWalls.points[s]),innerWalls.points[n]);if(!(t.length()<i.length())){var r=t.angleBetween2(i);if(!(r>t.paddingAngle(i))){let e=i.otherPoint(innerWalls.points[s]);r=[i].concat(e.linesArray(),innerWalls.points[n].linesArray(),innerWalls.points[s].linesArray());if(!innerWalls.isIntersectionWall(t,r)&&!outerWalls.isIntersectionWall(t)&&!(i.isOverlayOuterLines(t)||2<innerWalls.points[n].countLines()&&t.isOverlayLines(innerWalls.points[n].getParallelLines(i),5)))return i.setPointById(s,innerWalls.points[n]),innerWalls.deletePoint(s),__debugP.step("InnerWalls.connectLinesJointT"),this.connectLinesJointT(),!0}}}}return!1}connectFreeRightAnglesEqualDepth(){if(void 0===this.count_use_function.x_connectFreeRightAnglesEqualDepth&&(this.count_use_function.x_connectFreeRightAnglesEqualDepth=0),500<this.count_use_function.x_connectFreeRightAnglesEqualDepth++)return __debugP.error("MAX call x_connectFreeRightAnglesEqualDepth"),!1;for(var o in innerWalls.points)if(innerWalls.points.hasOwnProperty(o)&&!innerWalls.points[o].isConnected&&!innerWalls.points[o].isDock){innerWalls.points[o].key;let i=innerWalls.points[o].line(),n=new Wall,s=null,t=1e8;for(var e in innerWalls.points){var l,r;!innerWalls.points.hasOwnProperty(e)||o===e||innerWalls.points[e].isConnected||innerWalls.points[e].isDock||innerWalls.points[o].isOneLine(innerWalls.points[e])||((l=new Line(innerWalls.points[o],innerWalls.points[e]).length())>plannerParser.max_distance_between_walls||(r=innerWalls.points[e].line(),i.isEqualDepth(r)&&l<t&&(n=r,s=e,t=l)))}if(null!==s){let e=null;for(var a in t=1e8,innerWalls.points){var h,g;!innerWalls.points.hasOwnProperty(a)||s===a||innerWalls.points[a].isConnected||innerWalls.points[a].isDock||innerWalls.points[s].isOneLine(innerWalls.points[a])||((h=new Line(innerWalls.points[s],innerWalls.points[a]).length())>plannerParser.max_distance_between_walls||(g=innerWalls.points[a].line(),n.isEqualDepth(g)&&h<t&&(e=a,t=h)))}if(null!==e&&e===o){var _=i.intersectionBigLine(n);if(!1!==_){let e=new Line(_,i.otherPoint(innerWalls.points[o])),t=new Line(_,n.otherPoint(innerWalls.points[s]));if(!(e.length()<i.length()||t.length()<n.length())){var d=e.angleBetween2(i);if(!(d>e.paddingAngle(i)||t.angleBetween2(n)>t.paddingAngle(n)||outerWalls.isIntersectionWall(e)||outerWalls.isIntersectionWall(t))){d=[i,n].concat(innerWalls.points[o].linesArray(),innerWalls.points[s].linesArray());if(!innerWalls.isIntersectionWall(e,d)&&!innerWalls.isIntersectionWall(t,d)&&!(i.isOverlayOuterLines(e)||n.isOverlayOuterLines(t)||innerWalls.isNearWall(e,i)||innerWalls.isNearWall(t,n)))return innerWalls.points[s].set(_),i.setPointById(o,innerWalls.points[s]),innerWalls.deletePoint(o),__debugP.step("InnerWalls.connectFreeRightAnglesEqualDepth"),this.connectFreeRightAnglesEqualDepth(),!0}}}}}}return!1}connectFreeRightAnglesNoEqualDepth(){if(void 0===this.count_use_function.x_connectFreeRightAnglesNoEqualDepth&&(this.count_use_function.x_connectFreeRightAnglesNoEqualDepth=0),500<this.count_use_function.x_connectFreeRightAnglesNoEqualDepth++)return __debugP.error("MAX call x_connectFreeRightAnglesNoEqualDepth"),!1;for(var o in innerWalls.points)if(innerWalls.points.hasOwnProperty(o)&&!innerWalls.points[o].isConnected&&!innerWalls.points[o].isDock){innerWalls.points[o].key;let i=innerWalls.points[o].line(),n=new Wall,s=null,t=1e8;for(var e in innerWalls.points){var l,r;!innerWalls.points.hasOwnProperty(e)||o===e||innerWalls.points[e].isConnected||innerWalls.points[e].isDock||innerWalls.points[o].isOneLine(innerWalls.points[e])||((l=new Line(innerWalls.points[o],innerWalls.points[e]).length())>plannerParser.max_distance_between_walls||(r=innerWalls.points[e].line(),i.isAlmostPerpendicular(r)&&l<t&&(n=r,s=e,t=l)))}if(null!==s){let e=null;for(var a in t=1e8,innerWalls.points){var h,g;!innerWalls.points.hasOwnProperty(a)||s===a||innerWalls.points[a].isConnected||innerWalls.points[a].isDock||innerWalls.points[s].isOneLine(innerWalls.points[a])||((h=new Line(innerWalls.points[s],innerWalls.points[a]).length())>plannerParser.max_distance_between_walls||(g=innerWalls.points[a].line(),n.isAlmostPerpendicular(g)&&h<t&&(e=a,t=h)))}if(null!==e&&e===o){var _=i.intersectionBigLine(n);if(!1!==_){let e=new Line(_,i.otherPoint(innerWalls.points[o])),t=new Line(_,n.otherPoint(innerWalls.points[s]));if(!(e.length()<i.length()||t.length()<n.length())){var d=e.angleBetween2(i);if(!(d>e.paddingAngle(i)||t.angleBetween2(n)>t.paddingAngle(n)||i.isOverlayOuterLines(e)||n.isOverlayOuterLines(t)||outerWalls.isIntersectionWall(e)||outerWalls.isIntersectionWall(t))){d=[i,n].concat(innerWalls.points[o].linesArray(),innerWalls.points[s].linesArray());if(!innerWalls.isIntersectionWall(e,d)&&!innerWalls.isIntersectionWall(t,d))return innerWalls.points[s].set(_),i.setPointById(o,innerWalls.points[s]),innerWalls.deletePoint(o),__debugP.step("InnerWalls.connectFreeRightAnglesNoEqualDepth"),this.connectFreeRightAnglesNoEqualDepth(),!0}}}}}}return!1}connectTwoNoFreeRightAngles(){if(void 0===this.count_use_function.x_connectTwoNoFreeRightAngles&&(this.count_use_function.x_connectTwoNoFreeRightAngles=0),500<this.count_use_function.x_connectTwoNoFreeRightAngles++)return __debugP.error("MAX call x_connectTwoNoFreeRightAngles"),!1;for(var e in innerWalls.points)if(innerWalls.points.hasOwnProperty(e)&&innerWalls.points[e].isConnected&&!innerWalls.points[e].isDock&&2===innerWalls.points[e].countLines()){innerWalls.points[e].key;let d=innerWalls.points[e].line(0),p=innerWalls.points[e].line(1);var c=d.angleBetween2(p);if(81<c&&c<99&&!innerWalls.isExistNearFreePoint(innerWalls.points[e])){let h=new Wall,g=new Wall,_=null,i=1e8;for(var n in innerWalls.points)if(innerWalls.points.hasOwnProperty(n)&&e!==n&&innerWalls.points[n].isConnected&&!innerWalls.points[n].isDock&&2===innerWalls.points[n].countLines()){var s=new Line(innerWalls.points[e],innerWalls.points[n]).length();if(!(s>plannerParser.max_distance_between_walls/2)){let e=innerWalls.points[n].line(0),t=innerWalls.points[n].line(1);var o=e.angleBetween2(t);81<o&&o<99&&(innerWalls.isExistNearFreePoint(innerWalls.points[n])||e.getNormal().intersection(d)||e.getNormal().intersection(p)||t.getNormal().intersection(d)||t.getNormal().intersection(p)||s<i&&(h=e,g=t,_=n,i=s))}}if(null!==_){let a=null;for(var t in i=1e8,innerWalls.points)if(innerWalls.points.hasOwnProperty(t)&&_!==t&&innerWalls.points[t].isConnected&&!innerWalls.points[t].isDock&&2===innerWalls.points[t].countLines()){var l=new Line(innerWalls.points[e],innerWalls.points[t]).length();if(!(l>plannerParser.max_distance_between_walls/2)){let e=innerWalls.points[t].line(0);var r=innerWalls.points[t].line(1),r=e.angleBetween2(r);81<r&&r<99&&l<i&&(a=t,i=l)}}if(null!==a&&a===e){c=new Line(innerWalls.points[a],innerWalls.points[_]);if(!outerWalls.isIntersectionWall(c)&&!innerWalls.isIntersectionWall(c))if(!(d.isOverlayOuterLines(c)||p.isOverlayOuterLines(c)||h.isOverlayOuterLines(c)||g.isOverlayOuterLines(c))){let n=!1,s=new Wall,e=new Wall,o;if((n=d.getBigLine().intersection(h))?(s=h,o=innerWalls.points[a],e=d):(n=d.getBigLine().intersection(g))?(s=g,o=innerWalls.points[a],e=d):(n=p.getBigLine().intersection(h))?(s=h,o=innerWalls.points[a],e=p):(n=p.getBigLine().intersection(g))?(s=g,o=innerWalls.points[a],e=p):(n=h.getBigLine().intersection(d))?(s=d,o=innerWalls.points[_],e=h):(n=h.getBigLine().intersection(p))?(s=p,o=innerWalls.points[_],e=h):(n=g.getBigLine().intersection(d))?(s=d,o=innerWalls.points[_],e=g):(n=g.getBigLine().intersection(p))&&(s=p,o=innerWalls.points[_],e=g),!1!==n){let e=new PointWall(n.x,n.y);if(d.hasEqualPoint(e)||p.hasEqualPoint(e)||h.hasEqualPoint(e)||g.hasEqualPoint(e))continue;(c=innerWalls.findPoint(e))?e=innerWalls.points[c.id]:innerWalls.addPoint(e);c=s.point_1;s.setPointById(s.point_1.id,e);let t=new Wall(c,e);if(!innerWalls.findLine(t)){if(t.equalPoints())continue;t.addOuterLines(s.outerLines),t.setDepth(s.depth),t.outerDepth=t.getOuterDepth(),t.innerDepth=t.getInnerDepth(),innerWalls.addLine(t)}let i=new Wall(o,e);if(!innerWalls.findLine(i)){if(i.equalPoints())continue;i.addOuterLines(s.outerLines),i.setDepth(s.depth),i.outerDepth=i.getOuterDepth(),i.innerDepth=i.getInnerDepth(),innerWalls.addLine(i)}return __debugP.step("InnerWalls.connectTwoNoFreeRightAngles"),this.connectTwoNoFreeRightAngles(),!0}let l,r;if((!d.isAlmost180Angle(h)&&(n=d.intersectionBigLine(h))||!d.isAlmost180Angle(g)&&(n=d.intersectionBigLine(g)))&&(l=n),(!p.isAlmost180Angle(h)&&(n=p.intersectionBigLine(h))||!p.isAlmost180Angle(g)&&(n=p.intersectionBigLine(g)))&&(r=n),void 0!==l&&void 0!==r){var c=new Line(l,innerWalls.points[a]),A=new Line(l,innerWalls.points[_]),u=new Line(r,innerWalls.points[a]),w=new Line(r,innerWalls.points[_]);let e=new Line,t=new Line,i;if(outerWalls.isIntersectionWall(c)||innerWalls.isIntersectionWall(c)||outerWalls.isIntersectionWall(A)||innerWalls.isIntersectionWall(A)?outerWalls.isIntersectionWall(u)||innerWalls.isIntersectionWall(w)||outerWalls.isIntersectionWall(u)||innerWalls.isIntersectionWall(w)||(e=u,t=w,i=r):(e=c,t=A,i=l),e.isValid()){u=new PointWall(i.x,i.y);(w=innerWalls.findPoint(u))?innerWalls.points[w.id]:innerWalls.addPoint(u);let e=new Wall(innerWalls.points[a],u);if(!innerWalls.findLine(e)){if(e.equalPoints())continue;c=e.isAlmost180Angle(d)?d:p;e.addOuterLines(c.outerLines),e.setDepth(c.depth),e.outerDepth=e.getOuterDepth(),e.innerDepth=e.getInnerDepth(),innerWalls.addLine(e)}let t=new Wall(innerWalls.points[_],u);if(!innerWalls.findLine(t)){if(t.equalPoints())continue;A=t.isAlmost180Angle(h)?h:g;t.addOuterLines(A.outerLines),t.setDepth(A.depth),t.outerDepth=t.getOuterDepth(),t.innerDepth=t.getInnerDepth(),innerWalls.addLine(t)}return __debugP.step("InnerWalls.connectTwoNoFreeRightAngles"),this.connectTwoNoFreeRightAngles(),!0}}}}}}}return!1}connectFreeNoRightAnglesEqualDepth(){if(void 0===this.count_use_function.x_connectFreeNoRightAnglesEqualDepth&&(this.count_use_function.x_connectFreeNoRightAnglesEqualDepth=0),500<this.count_use_function.x_connectFreeNoRightAnglesEqualDepth++)return __debugP.error("MAX call x_connectFreeNoRightAnglesEqualDepth"),!1;for(var o in innerWalls.points)if(innerWalls.points.hasOwnProperty(o)&&!innerWalls.points[o].isConnected&&!innerWalls.points[o].isDock){innerWalls.points[o].key;let i=innerWalls.points[o].line(),n=new Wall,s=null,e=1e8;for(var t in innerWalls.points){var l,r;!innerWalls.points.hasOwnProperty(t)||o===t||innerWalls.points[t].isConnected||innerWalls.points[t].isDock||(innerWalls.points[t].key,innerWalls.points[o].isOneLine(innerWalls.points[t])||((l=new Line(innerWalls.points[o],innerWalls.points[t]).length())>plannerParser.max_distance_between_walls||(r=innerWalls.points[t].line(),i.isAlmostPerpendicular(r)||i.isEqualDepth(r)&&l<e&&(n=r,s=t,e=l))))}if(null!==s){var a=i.intersectionBigLine(n);if(!1!==a){let e=new Line(a,i.otherPoint(innerWalls.points[o])),t=new Line(a,n.otherPoint(innerWalls.points[s]));if(!(e.length()<i.length()||t.length()<n.length())){var h=e.angleBetween2(i);if(!(h>e.paddingAngle(i)||t.angleBetween2(n)>t.paddingAngle(n)||i.isOverlayOuterLines(e)||n.isOverlayOuterLines(t))){h=[i,n].concat(innerWalls.points[o].linesArray(),innerWalls.points[s].linesArray());if(!innerWalls.isIntersectionWall(e,h)&&!outerWalls.isIntersectionWall(e)&&!outerWalls.isIntersectionWall(t))return innerWalls.points[s].set(a),i.setPointById(o,innerWalls.points[s]),innerWalls.deletePoint(o),__debugP.step("InnerWalls.connectFreeNoRightAnglesEqualDepth"),this.connectFreeNoRightAnglesEqualDepth(),!0}}}}}return!1}connectFreeNoRightAnglesAnyDepth(){if(void 0===this.count_use_function.x_connectFreeNoRightAnglesAnyDepth&&(this.count_use_function.x_connectFreeNoRightAnglesAnyDepth=0),500<this.count_use_function.x_connectFreeNoRightAnglesAnyDepth++)return __debugP.error("MAX call x_connectFreeNoRightAnglesAnyDepth"),!1;for(var o in innerWalls.points)if(innerWalls.points.hasOwnProperty(o)&&!innerWalls.points[o].isConnected&&!innerWalls.points[o].isDock){innerWalls.points[o].key;let i=innerWalls.points[o].line(),n=new Wall,s=null,t=1e8;for(var e in innerWalls.points){var l,r;!innerWalls.points.hasOwnProperty(e)||o===e||innerWalls.points[e].isConnected||innerWalls.points[e].isDock||innerWalls.points[o].isOneLine(innerWalls.points[e])||((l=new Line(innerWalls.points[o],innerWalls.points[e]).length())>plannerParser.max_distance_between_walls||(r=innerWalls.points[e].line(),i.isAlmostPerpendicular(r)||i.isAlmost180Angle(r)||l<t&&(n=r,s=e,t=l)))}if(null!==s){let e=null;for(var a in t=1e8,innerWalls.points){var h,g;!innerWalls.points.hasOwnProperty(a)||s===a||innerWalls.points[a].isConnected||innerWalls.points[a].isDock||innerWalls.points[s].isOneLine(innerWalls.points[a])||((h=new Line(innerWalls.points[s],innerWalls.points[a]).length())>plannerParser.max_distance_between_walls||(g=innerWalls.points[a].line(),n.isAlmostPerpendicular(g)||n.isAlmost180Angle(g)||h<t&&(e=a,t=h)))}if(null!==e&&e===o){var _=i.intersectionBigLine(n);if(!1!==_){let e=new Line(_,i.otherPoint(innerWalls.points[o])),t=new Line(_,n.otherPoint(innerWalls.points[s]));if(!(e.length()-i.length()<-3||t.length()-n.length()<-3||i.isOverlayOuterLines(e)||n.isOverlayOuterLines(t))){var d=e.angleBetween2(i);if(!(d>e.paddingAngle(i)))return innerWalls.points[s].set(_),i.setPointById(o,innerWalls.points[s]),innerWalls.deletePoint(o),__debugP.step("InnerWalls.connectFreeNoRightAnglesAnyDepth"),this.connectFreeNoRightAnglesAnyDepth(),!0}}}}}return!1}connectFreeDiagonal(){if(void 0===this.count_use_function.x_connectFreeDiagonal&&(this.count_use_function.x_connectFreeDiagonal=0),500<this.count_use_function.x_connectFreeDiagonal++)return __debugP.error("MAX call x_connectFreeDiagonal"),!1;for(var o in innerWalls.points)if(innerWalls.points.hasOwnProperty(o)&&!innerWalls.points[o].isConnected&&!innerWalls.points[o].isDock){innerWalls.points[o].key;let t=innerWalls.points[o].line(),i=new Wall,n=null,s=1e8;if("D"===t.type){for(var e in innerWalls.points){var l,r;!innerWalls.points.hasOwnProperty(e)||o===e||innerWalls.points[e].isDock||innerWalls.points[o].isOneLine(innerWalls.points[e])||((l=new Line(innerWalls.points[o],innerWalls.points[e]).length())>plannerParser.max_distance_between_walls||(r=innerWalls.points[e].line(),t.isAlmostPerpendicular(r)||t.isAlmost180Angle(r)||l<s&&(i=r,n=e,s=l)))}if(null!==n){let e=null;for(var a in s=1e8,innerWalls.points){var h,g;!innerWalls.points.hasOwnProperty(a)||n===a||innerWalls.points[a].isConnected||innerWalls.points[a].isDock||innerWalls.points[n].isOneLine(innerWalls.points[a])||((h=new Line(innerWalls.points[n],innerWalls.points[a]).length())>plannerParser.max_distance_between_walls||(g=innerWalls.points[a].line(),i.isAlmostPerpendicular(g)||i.isAlmost180Angle(g)||h<s&&(e=a,s=h)))}if(null!==e&&e===o){let e=new Line(innerWalls.points[n],t.otherPoint(innerWalls.points[o]));if(!(e.length()-t.length()<0)){var _=e.angleBetween2(t);if(!(1.5<_))return t.setPointById(o,innerWalls.points[n]),innerWalls.deletePoint(o),__debugP.step("InnerWalls.connectFreeDiagonal"),this.connectFreeDiagonal(),!0}}}}}return!1}connectFreePointWithJointWhereEqualDepth(){if(void 0===this.count_use_function.x_connectFreePointWithJointWhereEqualDepth&&(this.count_use_function.x_connectFreePointWithJointWhereEqualDepth=0),500<this.count_use_function.x_connectFreePointWithJointWhereEqualDepth++)return __debugP.error("MAX call x_connectFreePointWithJointWhereEqualDepth"),!1;for(var n in innerWalls.points)if(innerWalls.points.hasOwnProperty(n)&&!innerWalls.points[n].isConnected&&!innerWalls.points[n].isDock){innerWalls.points[n].key;let t=innerWalls.points[n].line();var s,o;new Wall;let i=null,e=1e8;for(s in innerWalls.points)!innerWalls.points.hasOwnProperty(s)||n===s||!innerWalls.points[s].isConnected||innerWalls.points[s].isDock||(o=new Line(innerWalls.points[n],innerWalls.points[s]).length())>plannerParser.max_distance_between_walls||!1!==innerWalls.points[s].getLineEqualDepth(t)&&o<e&&(i=s,e=o);if(null!==i){let e=new Line(t.otherPoint(innerWalls.points[n]),innerWalls.points[i]);if(!(e.length()<t.length())){var l=e.angleBetween2(t);if(!(l>e.paddingAngle(t)||t.isOverlayOuterLines(e)||outerWalls.isIntersectionWall(e)||e.isOverlayLines(innerWalls.points[i].getParallelLines(t),5)))return t.setPointById(n,innerWalls.points[i]),innerWalls.deletePoint(n),__debugP.step("InnerWalls.connectFreePointWithJointWhereEqualDepth"),this.connectFreePointWithJointWhereEqualDepth(),!0}}}return!1}connectFreePointWithJointRightAngle(){if(void 0===this.count_use_function.x_connectFreePointWithJointRightAngle&&(this.count_use_function.x_connectFreePointWithJointRightAngle=0),500<this.count_use_function.x_connectFreePointWithJointRightAngle++)return __debugP.error("MAX call x_connectFreePointWithJointRightAngle"),!1;for(var l in innerWalls.points)if(innerWalls.points.hasOwnProperty(l)&&!innerWalls.points[l].isConnected&&!innerWalls.points[l].isDock){innerWalls.points[l].key;let n=innerWalls.points[l].line(),s=new Wall,o=null,e=1e8;for(var t in innerWalls.points){var i,r;!innerWalls.points.hasOwnProperty(t)||l===t||!innerWalls.points[t].isConnected||innerWalls.points[t].isDock||(i=new Line(innerWalls.points[l],innerWalls.points[t]).length())>plannerParser.max_distance_between_walls||!1!==(r=innerWalls.points[t].getPerpendicularLine(n))&&i<e&&(s=r,o=t,e=i)}if(null!==o){let i=n.intersectionBigLine(s);if(!1!==i){var a=innerWalls.findPoint(i,1);a&&(i=a);let t=new Line(n.otherPoint(innerWalls.points[l]),i);if(!(t.length()<n.length())){var h=t.angleBetween2(n);if(!(h>t.paddingAngle(n))){let e=!1;for(var g in innerWalls.points[o].lines)if(innerWalls.points[o].lines.hasOwnProperty(g)){g=innerWalls.lines[g];if(t.isParallel(g)&&t.isOverlay(g)){e=!0;break}}if(!(e||n.isOverlayOuterLines(t)||outerWalls.isIntersectionWall(t)||innerWalls.isIntersectionWall(t))){if(innerWalls.intersectionPoints7[i.getKey()]="",a)return n.setPointById(l,innerWalls.points[i.id]),innerWalls.deletePoint(l),__debugP.step("InnerWalls.connectFreePointWithJointRightAngle"),this.connectFreePointWithJointRightAngle(),!0;innerWalls.points[l].set(i);let e;for(var _ in innerWalls.points[o].lines)if(innerWalls.points[o].lines.hasOwnProperty(_)&&innerWalls.lines[_].isPointOnLine(innerWalls.points[l])){e=innerWalls.lines[_];break}let t=new Wall(innerWalls.points[l],innerWalls.points[o]);if(!innerWalls.findLine(t)){if(t.equalPoints())continue;t.addOuterLines(s.outerLines),t.setDepth(s.depth),t.outerDepth=s.outerDepth,t.innerDepth=s.innerDepth,t.type=s.type,innerWalls.addLine(t)}if(void 0!==e&&(e.setPointById(o,innerWalls.points[l]),2===innerWalls.points[o].countLines())){let e=innerWalls.points[o].line(0),t=innerWalls.points[o].line(1);var h=e.angleBetween2(t);179<=h&&h<=181&&(a=e.otherPoint(innerWalls.points[o]),h=t.otherPoint(innerWalls.points[o]),void 0!==innerWalls.intersectionPoints7[a.key]&&void 0!==innerWalls.intersectionPoints7[h.key]&&(e.setPointById(o,h),innerWalls.deletePoint(o),innerWalls.deleteLine(t.id),outerWalls.deleteInnerWallFromOuterWalls(t.id)))}return __debugP.step("InnerWalls.connectFreePointWithJointRightAngle"),this.connectFreePointWithJointRightAngle(),!0}}}}}}return!1}connectFreePointWithLine(){if(void 0===this.count_use_function.x_connectFreePointWithLine&&(this.count_use_function.x_connectFreePointWithLine=0),500<this.count_use_function.x_connectFreePointWithLine++)return console.error("MAX call x_connectFreePointWithLine"),!1;for(var o in innerWalls.points)if(innerWalls.points.hasOwnProperty(o)&&!innerWalls.points[o].isConnected&&!innerWalls.points[o].isDock){"494.95-754.45"!==innerWalls.points[o].key&&innerWalls.points[o].key;let e=innerWalls.points[o].line(),i=new Wall,n=null,t=1e8,s=e.otherPoint(innerWalls.points[o]);e.type;var l,r,a,h=new Line(s,innerWalls.points[o]).getBigLineOne(5);for(l in innerWalls.lines)innerWalls.lines.hasOwnProperty(l)&&e.id!==l&&void 0===s.lines[l]&&(innerWalls.lines[l].type,!1===(r=innerWalls.lines[l].intersection(h))||(a=new Line(innerWalls.points[o],r).length())>plannerParser.max_distance_between_walls||a<t&&(n=r,i=innerWalls.lines[l],t=a));if(null!==n){let t=new Line(s,n);if(!s.isConnected){let e=new Line(innerWalls.points[o],n);if(e.length()>t.length())continue}if(!e.isOverlayOuterLines(t)){var g=[e,i].concat(s.linesArray());if(!innerWalls.isIntersectionWall(t,g)&&!outerWalls.isIntersectionWall(t)&&!innerWalls.isNearWall(t,e)){let e=o;innerWalls.points[o].set(n),(g=innerWalls.findPoint(innerWalls.points[o]))&&(innerWalls.replacePoint(o,g.id),e=g.id);let t=new Wall(i.point_1,innerWalls.points[e]);if(i.setPointById(i.point_1.id,innerWalls.points[e]),!innerWalls.findLine(t)){if(t.equalPoints())continue;t.addOuterLines(i.outerLines),t.setDepth(i.depth),t.outerDepth=i.outerDepth,t.innerDepth=i.innerDepth,t.type=i.type,innerWalls.addLine(t)}return(1===t.point_1.countLines()||1===t.point_2.countLines())&&t.length()<5?innerWalls.deleteAloneLine(t):(1===i.point_1.countLines()||1===i.point_2.countLines())&&i.length()<5&&innerWalls.deleteAloneLine(i),__debugP.step("InnerWalls.connectFreePointWithLine"),this.connectFreePointWithLine(),!0}}}}}connectFreePointWithPerpendicularLineOfJoint(){if(void 0===this.count_use_function.x_connectFreePointWithPerpendicularLineOfJoint&&(this.count_use_function.x_connectFreePointWithPerpendicularLineOfJoint=0),500<this.count_use_function.x_connectFreePointWithPerpendicularLineOfJoint++)return console.error("MAX call x_connectFreePointWithPerpendicularLineOfJoint"),!1;for(var s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&!innerWalls.points[s].isConnected&&!innerWalls.points[s].isDock){innerWalls.points[s].key;let t=innerWalls.points[s].line(),i=new Wall,n=null,e=1e8;var o,l,r,a=t.otherPoint(innerWalls.points[s]);for(o in innerWalls.points)!innerWalls.points.hasOwnProperty(o)||s===o||a.id===o||!innerWalls.points[o].isConnected||innerWalls.points[o].isDock||2!==innerWalls.points[o].countLines()||(l=new Line(innerWalls.points[s],innerWalls.points[o]).length())>plannerParser.max_distance_between_walls||!1!==(r=innerWalls.points[o].getPerpendicularLine(t))&&l<e&&(i=r,n=o,e=l);if(null!==n){var h=t.intersectionBigLine(i);if(!1!==h){let e=new Line(h,t.otherPoint(innerWalls.points[s]));var g=new Line(h,innerWalls.points[n]);if(!(e.length()<t.length())){var _=e.angleBetween2(t);if(!(_>e.paddingAngle(t)||outerWalls.isIntersectionWall(e,[],!0)||outerWalls.isIntersectionWall(g,[],!0)||innerWalls.isIntersectionWall(e,[],!0)||innerWalls.isIntersectionWall(g,[],!0)||innerWalls.isPointOnLines(new Line(h,innerWalls.points[s]).center())||innerWalls.isPointOnLines(new Line(h,innerWalls.points[n]).center())||t.isOverlayOuterLines(e)||i.isOverlayOuterLines(g)||e.isOverlayLines(innerWalls.points[n].lines)||innerWalls.isNearWall(e,t))){innerWalls.points[s].set(h);let e=new Wall(innerWalls.points[s],innerWalls.points[n]);if(!innerWalls.findLine(e)){if(e.equalPoints())continue;e.addOuterLines(i.outerLines),e.setDepth(i.depth),e.outerDepth=i.outerDepth,e.innerDepth=i.innerDepth,e.type=i.type,innerWalls.addLine(e)}return __debugP.step("InnerWalls.connectFreePointWithPerpendicularLineOfJoint"),this.connectFreePointWithPerpendicularLineOfJoint(),!0}}}}}return!1}connectFreePointWithParallelLineOfJoint(){if(void 0===this.count_use_function.x_connectFreePointWithParallelLineOfJoint&&(this.count_use_function.x_connectFreePointWithParallelLineOfJoint=0),500<this.count_use_function.x_connectFreePointWithParallelLineOfJoint++)return console.error("MAX call x_connectFreePointWithParallelLineOfJoint"),!1;for(var l in innerWalls.points)if(innerWalls.points.hasOwnProperty(l)&&!innerWalls.points[l].isConnected&&!innerWalls.points[l].isDock){innerWalls.points[l].key;let i=innerWalls.points[l].line(),s=new Wall,o=null,e=1e8;var t,n,r,a=i.otherPoint(innerWalls.points[l]);for(t in innerWalls.points)!innerWalls.points.hasOwnProperty(t)||l===t||a.id===t||!innerWalls.points[t].isConnected||innerWalls.points[t].isDock||2!==innerWalls.points[t].countLines()||(n=new Line(innerWalls.points[l],innerWalls.points[t]).length())>plannerParser.max_distance_between_walls||!1!==(r=innerWalls.points[t].getParallelLine(i))&&n<e&&(s=r,o=t,e=n);if(null!==o){var h=s.getBigLine().getPointProjection(innerWalls.points[l]);let e=new Line(innerWalls.points[l],h).getBigLine();h=e.intersection(s.getBigLine());if(!1!==h){let e=new Line(h,innerWalls.points[l]),t=new Line(h,innerWalls.points[o]);var g=new Line(innerWalls.points[l],innerWalls.points[o]);if(!(outerWalls.isIntersectionWall(e,[],!0)||outerWalls.isIntersectionWall(t,[],!0)||innerWalls.isIntersectionWall(e,[],!0)||innerWalls.isIntersectionWall(t,[],!0)||innerWalls.isPointOnLines(e.center())||innerWalls.isPointOnLines(t.center())||i.isOverlayOuterLines(e)||s.isOverlayOuterLines(t)||innerWalls.isIntersectionWall(g,[],!0))){let e=new PointWall(h.x,h.y);(g=innerWalls.findPoint(e))?e=innerWalls.points[g.id]:innerWalls.addPoint(e);let n=new Wall(innerWalls.points[l],e);if(!innerWalls.findLine(n)){if(n.equalPoints())continue;n.setDepth(10),n.getOuterDepth(),n.getInnerDepth(),n.isArtificial=!0;let e=n.getNormal();var _,d,p=e.getParallel(10),c=e.getParallel(-10);let t=null,i=1e5;for(_ in outerWalls.lines)outerWalls.lines.hasOwnProperty(_)&&((d=outerWalls.lines[_].intersection(e)||outerWalls.lines[_].intersection(p)||outerWalls.lines[_].intersection(c))&&(d=new Line(n.center(),d).length())<i&&d<n.depth+5&&(i=d,t=outerWalls.lines[_]));null!==t&&n.addOuterLine(t),innerWalls.addLine(n)}let t=new Wall(innerWalls.points[o],e);if(!innerWalls.findLine(t)){if(t.equalPoints())continue;t.addOuterLines(s.outerLines),t.setDepth(s.depth),t.type=s.type,t.outerDepth=s.outerDepth,t.innerDepth=s.innerDepth,innerWalls.addLine(t)}return __debugP.step("InnerWalls.connectFreePointWithParallelLineOfJoint"),this.connectFreePointWithParallelLineOfJoint(),!0}}}}return!1}connectLinesWithDoor_1(){if(void 0===this.count_use_function.x_connectLinesWithDoor_1&&(this.count_use_function.x_connectLinesWithDoor_1=0),500<this.count_use_function.x_connectLinesWithDoor_1++)return console.error("MAX call x_connectLinesWithDoor_1"),!1;var l,n,r,a=plannerParser.array_lines.filter(e=>in_array(e[2],["doorway","door","window","windoor"]));for(l in innerWalls.points)if(innerWalls.points.hasOwnProperty(l)&&!innerWalls.points[l].isConnected&&innerWalls.points[l].isDock){innerWalls.points[l].key;let s=innerWalls.points[l].line(),t=new Wall,o=null,e=1e8,i=new Line(s.otherPoint(innerWalls.points[l]),innerWalls.points[l]).getBigLineOne();for(var h in innerWalls.points)!innerWalls.points.hasOwnProperty(h)||l===h||innerWalls.points[h].isConnected||!innerWalls.points[h].isDock||innerWalls.points[l].isOneLine(innerWalls.points[h])||i.isPointOnLine(innerWalls.points[h],2)&&(n=new Line(innerWalls.points[l],innerWalls.points[h]).length(),r=innerWalls.points[h].line(),s.isCommonPoint(r)||s.isAlmost180Angle(r)&&s.isEqualDepth(r)&&n<e&&(t=r,o=h,e=n));if(null!==o){let i=!1,n=!1;for(let t=0;t<a.length&&(!i||!n);t++){a[t][0].x;let e=new Line(new Point(a[t][0].x,a[t][0].y),new Point(a[t][1].x,a[t][1].y));var g=e.angleBetween(s);(0<=g&&g<=45||135<=g&&g<=225||325<=g&&g<=360)&&(i||!e.point_1.equal(innerWalls.points[l],plannerParser.max_distance_between_old_and_new_holes)&&!e.point_2.equal(innerWalls.points[l],plannerParser.max_distance_between_old_and_new_holes)||(i=!0),n||!e.point_1.equal(innerWalls.points[o],plannerParser.max_distance_between_old_and_new_holes)&&!e.point_2.equal(innerWalls.points[o],plannerParser.max_distance_between_old_and_new_holes)||(n=!0))}if(i&&n){var _=new Line(innerWalls.points[l],innerWalls.points[o]);if(!innerWalls.isIntersectionWall(_,[s,t])&&!outerWalls.isIntersectionWall(_)){let e=new Wall(s.otherPoint(innerWalls.points[l]),t.otherPoint(innerWalls.points[o]));var _=s.outerLines[0].getCommonPoint(innerWalls.points[l].dockLine),d=s.outerLines[1].getCommonPoint(innerWalls.points[l].dockLine),p=t.outerLines[0].getOtherPoint(innerWalls.points[o].dockLine),c=t.outerLines[1].getOtherPoint(innerWalls.points[o].dockLine);if(outerWalls.deleteLine(innerWalls.points[l].dockLine.id),outerWalls.deleteLine(innerWalls.points[o].dockLine.id),!1===new Line(_,p).intersection(e)){for(var A in s.outerLines[0].setPointById(_.id,p),s.outerLines[1].setPointById(d.id,c),t.outerLines[0].lines)t.outerLines[0].lines.hasOwnProperty(A)&&t.outerLines[0].lines[A].addOuterLine(s.outerLines[0]);for(var u in t.outerLines[1].lines)t.outerLines[1].lines.hasOwnProperty(u)&&t.outerLines[1].lines[u].addOuterLine(s.outerLines[1])}else{for(var w in s.outerLines[0].setPointById(_.id,c),s.outerLines[1].setPointById(d.id,p),t.outerLines[0].lines)t.outerLines[0].lines.hasOwnProperty(w)&&t.outerLines[0].lines[w].addOuterLine(s.outerLines[1]);for(var m in t.outerLines[1].lines)t.outerLines[1].lines.hasOwnProperty(m)&&t.outerLines[1].lines[m].addOuterLine(s.outerLines[0])}if(outerWalls.deleteAloneLine(t.outerLines[1]),outerWalls.deleteAloneLine(t.outerLines[0]),outerWalls.deletePoint(_.id),outerWalls.deletePoint(d.id),!innerWalls.findLine(e)){if(e.equalPoints())continue;e.type=s.type,e.setDepth(s.depth),e.outerDepth=s.outerDepth,e.innerDepth=s.innerDepth,e.addOuterLines(s.outerLines),innerWalls.addLine(e)}return innerWalls.deleteAloneLine(s),innerWalls.deleteAloneLine(t),__debugP.step("InnerWalls.connectLinesWithDoor_1"),this.connectLinesWithDoor_1(),!0}}}}return!1}connectLinesWithDoor_2(){if(void 0===this.count_use_function.x_connectLinesWithDoor_2&&(this.count_use_function.x_connectLinesWithDoor_2=0),500<this.count_use_function.x_connectLinesWithDoor_2++)return console.error("MAX call x_connectLinesWithDoor_2"),!1;var a,n=plannerParser.array_lines.filter(e=>in_array(e[2],["doorway","door","window","windoor"]));for(a in innerWalls.points)if(innerWalls.points.hasOwnProperty(a)&&!innerWalls.points[a].isConnected&&innerWalls.points[a].isDock){innerWalls.points[a].key;let r=innerWalls.points[a].line(),i=new Hole;for(let t=0;t<n.length;t++){n[t][0].x;let e=new Line(new Point(n[t][0].x,n[t][0].y),new Point(n[t][1].x,n[t][1].y));var s=e.angleBetween(r);if((0<=s&&s<=45||135<=s&&s<=225||325<=s&&s<=360)&&(e.point_1.equal(innerWalls.points[a],10)||e.point_2.equal(innerWalls.points[a],10))){i=e;break}}if(i.isValid()){var t,o,h=i.getIncreaseLine(20);let l=new OuterWall,e=1e8;for(t in outerWalls.lines)outerWalls.lines.hasOwnProperty(t)&&innerWalls.points[a].dockLine.id!==t&&(o=outerWalls.lines[t].intersection(h))&&(o=new Line(innerWalls.points[a],o).length())<e&&(l=outerWalls.lines[t],e=o);if(l.isValid()){var g=r.outerLines[0].getCommonPoint(innerWalls.points[a].dockLine),_=r.outerLines[1].getCommonPoint(innerWalls.points[a].dockLine);let e=r.outerLines[0].getBigLine(),t=r.outerLines[1].getBigLine();var d=e.intersection(l),p=t.intersection(l);if(d&&p){let s=new PointOuterWall(d.x,d.y),o=new PointOuterWall(p.x,p.y),e=r.getBigLine().getPointProjection(s);var d=new OuterWall(r.outerLines[0].otherPoint(g),o),p=new OuterWall(r.outerLines[1].otherPoint(_),o),c=new Wall(r.otherPoint(innerWalls.points[a]),e);if(!innerWalls.isIntersectionWall(d,[r])&&!innerWalls.isIntersectionWall(p,[r])&&!(innerWalls.isIntersectionWall(c,[r])||outerWalls.isIntersectionWall(d,[l,innerWalls.points[a].dockLine])||outerWalls.isIntersectionWall(p,[l,innerWalls.points[a].dockLine])||outerWalls.isIntersectionWall(c,[l,innerWalls.points[a].dockLine]))){outerWalls.deleteLine(innerWalls.points[a].dockLine.id);let i=!1,n=(outerWalls.findPoint(s)?s=outerWalls.findPoint(s):outerWalls.findPoint(s,1)?s=outerWalls.findPoint(s,1):(outerWalls.addPoint(s),i=!0),r.outerLines[0].setPointById(g.id,s),!1);if(outerWalls.findPoint(o)?o=outerWalls.findPoint(o):outerWalls.findPoint(o,1)?o=outerWalls.findPoint(o,1):(outerWalls.addPoint(o),n=!0),r.outerLines[1].setPointById(_.id,o),i||n){let e=new OuterWall,t=new OuterWall;i&&(e=new OuterWall(l.point_1,s),l.setPointById(l.point_1.id,s),outerWalls.findLine(e)||e.equalPoints()||outerWalls.addLine(e)),n&&(e.isValid()&&r.outerLines[1].getBigLine().intersection(e)?(t=new OuterWall(e.point_1,o),e.setPointById(e.point_1.id,o)):(t=new OuterWall(l.point_1,o),l.setPointById(l.point_1.id,o)),outerWalls.findLine(t)||t.equalPoints()||outerWalls.addLine(t))}d=s.getCommonLine(o);return!1!==d&&outerWalls.deleteAloneLine(d),e=new PointWall(e.x,e.y),innerWalls.findPoint(e)?e=innerWalls.findPoint(e):innerWalls.addPoint(e),r.setPointById(a,e),innerWalls.deletePoint(a),__debugP.step("InnerWalls.connectLinesWithDoor_2"),this.connectLinesWithDoor_2(),!0}}}}}return!1}unionParallelLines(){if(void 0===this.count_use_function.x_unionParallelLines&&(this.count_use_function.x_unionParallelLines=0),500<this.count_use_function.x_unionParallelLines++)return console.error("MAX call x_unionParallelLines"),!1;for(var n in innerWalls.points)if(innerWalls.points.hasOwnProperty(n)&&(innerWalls.points[n].key,2===innerWalls.points[n].countLines())){let t=innerWalls.points[n].line(0),i=innerWalls.points[n].line(1);if(t.isAlmost180Angle(i)&&t.isEqualDepth(i)){let e=new Wall(t.otherPoint(innerWalls.points[n]),i.otherPoint(innerWalls.points[n]));if(!innerWalls.findLine(e)){if(e.equalPoints())continue;e.type=t.type,e.setDepth(t.depth),e.outerDepth=t.outerDepth,e.innerDepth=t.innerDepth,e.addOuterLines(t.outerLines),e.addOuterLines(i.outerLines),innerWalls.addLine(e)}return innerWalls.deleteAloneLine(t),innerWalls.deleteAloneLine(i),__debugP.step("InnerWalls.unionParallelLines"),this.unionParallelLines(),!0}}return!1}equalizationWalls(){if(void 0===this.count_use_function.x_equalizationWalls&&(this.count_use_function.x_equalizationWalls=0),500<this.count_use_function.x_equalizationWalls++)return console.error("MAX call x_equalizationWalls"),!1;for(var n in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(n)){innerWalls.lines[n].point_2.key;let e=this.findEqualizationWalls(innerWalls.lines[n],innerWalls.lines[n].point_1),t=this.findEqualizationWalls(innerWalls.lines[n],innerWalls.lines[n].point_2),i={};for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);this.equalizationWallsHandler(i),__debugP.step("InnerWalls.equalizationWalls")}}findEqualizationWalls(t,i,n={}){for(var s in i.lines)if(i.lines.hasOwnProperty(s)){let e=i.lines[s];if(t.id!==e.id&&(t.type,e.type,void 0===n[e.id])){s=t.angleBetween2(e);if(178<=s&&s<=182)if(!(7<Math.abs(t.depth-e.depth)))return t.getCommonOuterLine(e),n[t.id]=t,n[e.id]=e,this.findEqualizationWalls(e,e.otherPoint(i),n)}}return n}equalizationWallsHandler(r){if(0!==Object.keys(r).length){let e={},t=0;for(var a in r)r.hasOwnProperty(a)&&(void 0===e[r[a].depth]&&(e[r[a].depth]=0),e[r[a].depth]++,t+=r[a].depth);Object.keys(e).length;let i;if(Object.keys(e).length<Object.keys(r).length)for(var h in e)e.hasOwnProperty(h)&&1<e[h]&&(i=+h);else i=+(t/Object.keys(r).length).toFixed(plannerParser.count_round);var g,_,d,p,c,A=+((i=Math.ceil(+i))/2).toFixed(1),u=+(i-A).toFixed(1);for(g in r)r.hasOwnProperty(g)&&(r[g].setDepth(i),r[g].outerDepth=A,r[g].innerDepth=u);let n={};for(_ in r)r.hasOwnProperty(_)&&(void 0===n[r[_].point_1.id]&&(n[r[_].point_1.id]=0),void 0===n[r[_].point_2.id]&&(n[r[_].point_2.id]=0),n[r[_].point_1.id]++,n[r[_].point_2.id]++);let s,o;for(d in n)n.hasOwnProperty(d)&&1===n[d]&&(void 0===s?s=innerWalls.points[d]:void 0===o&&(o=innerWalls.points[d]));let l=new Line(s,o);for(p in n)if(n.hasOwnProperty(p)&&1<n[p]){let e=innerWalls.points[p];void 0===e?__debugP.warn("equalizationWallsHandler - not found point"):(c=l.getPointProjection(e),e.set(c))}}}movingAxis(){if(void 0===this.count_use_function.x_movingAxis&&(this.count_use_function.x_movingAxis=0),500<this.count_use_function.x_movingAxis++)return console.error("MAX call x_movingAxis"),!1;for(var n in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(n)&&("502.54-59.29"!==innerWalls.lines[n].point_2.key&&innerWalls.lines[n].point_2.key,!innerWalls.lines[n].point_1.isConnected&&!innerWalls.lines[n].point_1.isDock||!innerWalls.lines[n].point_2.isConnected&&!innerWalls.lines[n].point_2.isDock)){let e=this.findLinesForMovingAxis(innerWalls.lines[n],innerWalls.lines[n].point_1),t=this.findLinesForMovingAxis(innerWalls.lines[n],innerWalls.lines[n].point_2),i={};for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);this.movingAxisHandler(i),__debugP.step("InnerWalls.movingAxis")}}findLinesForMovingAxis(t,i,e={}){if(i.isDock)return e;let n=new Wall,s=null,o=1e8;for(var l in innerWalls.points)if(innerWalls.points.hasOwnProperty(l)&&i.id!==l&&!innerWalls.points[l].isConnected&&!innerWalls.points[l].isDock){var r=new Line(i,innerWalls.points[l]).length();if(!(r>plannerParser.max_distance_between_walls)){var a=innerWalls.points[l].line();if(t.id!==a.id&&t.type===a.type&&void 0===e[a.id]&&t.isParallel(a)&&!t.isOverlay(a)){if(10<r){let e=new Line(i,innerWalls.points[l]);var h=e.angleBetween(t.getNormal());if(!(175<=h||h<=5))continue}new Line(i,innerWalls.points[l]).length()>new Line(t.otherPoint(i),innerWalls.points[l]).length()||r<o&&(s=l,n=a,o=r)}}}if(null!==s)return e[t.id]=t,e[n.id]=n,this.findLinesForMovingAxis(n,n.otherPoint(innerWalls.points[s]),e);for(var g in i.lines)if(i.lines.hasOwnProperty(g)&&t.id!==g&&t.isAlmost180Angle(i.lines[g])&&void 0===e[g])return e[t.id]=t,e[g]=i.lines[g],this.findLinesForMovingAxis(i.lines[g],i.lines[g].otherPoint(i),e);return e}movingAxisHandler(n,e=0){if(0===Object.keys(n).length)return!1;let t=1e8,i;for(var s in n)n.hasOwnProperty(s)&&n[s].depth<t&&(t=n[s].depth,i=n[s]);delete n[i.id];let o=i.getBigLine();if(void 0===i.outerLines[1])return __debugP.warn("нет внешних стен - сдвиг оси"),!1;let l=i.outerLines[0].getBigLine(),r=i.outerLines[1].getBigLine(),a={},h=(a[i.id]=i,{});for(var g in n)if(n.hasOwnProperty(g)){var _=o.getPointProjection(n[g].point_1),d=o.getPointProjection(n[g].point_2);let e=n[g].point_1.lines,t=n[g].point_2.lines,i=new Line(_,d);h[g]={place:n[g].getPlaceByLine(o),lengthBetween:n[g].getLengthBetweenLines(o).toFixed(1),center:n[g].center()};var p,c,A=i.angleBetween(n[g]);if(!(A<2||178<A))return __debugP.warn("большой угол"),!1;if(!outerWalls.isIntersectionWall(n[g],[],!0)&&outerWalls.isIntersectionWall(i,[],!0))return __debugP.warn("пересечение линии 1"),!1;for(p in e)if(e.hasOwnProperty(p)&&e[p].isAlmostPerpendicular(n[g])){var u=new Line(e[p].otherPoint(n[g].point_1),_);if(!outerWalls.isIntersectionWall(e[p],[],!0)&&outerWalls.isIntersectionWall(u,[],!0))return __debugP.warn("пересечение линии 2"),!1}for(c in t)if(t.hasOwnProperty(c)&&t[c].isAlmostPerpendicular(n[g])){var w=new Line(t[c].otherPoint(n[g].point_2),d);if(!outerWalls.isIntersectionWall(t[c],[],!0)&&outerWalls.isIntersectionWall(w,[],!0))return __debugP.warn("пересечение линии 3"),!1}}for(var m in n)if(n.hasOwnProperty(m)){var f,I=o.getPointProjection(n[m].point_1),C=o.getPointProjection(n[m].point_2),y=innerWalls.findPoint(I,1,n[m].point_1),b=innerWalls.findPoint(C,1,n[m].point_2),v=h[m].place;let t=h[m].lengthBetween,e=(y&&n[m].point_1.id!==y.id?innerWalls.replacePoint(n[m].point_1.id,y.id):n[m].point_1.set(I),!1);for(f in n[m].point_1.lines)n[m].point_1.lines.hasOwnProperty(f)&&n[m].point_1.lines[f].equalPoints(2)&&(innerWalls.deleteAloneLine(n[m].point_1.lines[f]),m===f&&(e=!0));if(e)__debugP.warn("линия в одной точке 1");else{for(var x in b&&n[m].point_2.id!==b.id?innerWalls.replacePoint(n[m].point_2.id,b.id):n[m].point_2.set(C),n[m].point_2.lines)n[m].point_2.lines.hasOwnProperty(x)&&n[m].point_2.lines[x].equalPoints(2)&&(innerWalls.deleteAloneLine(n[m].point_2.lines[x]),m===x&&(e=!0));if(e)__debugP.warn("линия в одной точке 2");else if(a[m]=n[m],2<=n[m].outerLines.length&&i.innerDepth===i.outerDepth&&(l.isLineOnLine(n[m].outerLines[0])||l.isLineOnLine(n[m].outerLines[1])||r.isLineOnLine(n[m].outerLines[0])||r.isLineOnLine(n[m].outerLines[1]))){let e;l.isLineOnLine(n[m].outerLines[0])||l.isLineOnLine(n[m].outerLines[1])?e=n[m].getPlaceByLine(l):(r.isLineOnLine(n[m].outerLines[0])||r.isLineOnLine(n[m].outerLines[1]))&&(e=n[m].getPlaceByLine(r)),"outer"===e?(n[m].outerDepth=i.outerDepth,n[m].innerDepth=+(n[m].depth-n[m].outerDepth).toFixed(1)):"inner"===e&&(n[m].innerDepth=i.outerDepth,n[m].outerDepth=+(n[m].depth-n[m].innerDepth).toFixed(1))}else if(t<.5&&(t=0),"outer"===v){let e=+(n[m].outerDepth-t).toFixed(1);y=Math.floor(e),I=e-y;I<=.4?e=y:.7<=I?e=y+1:0<I&&(e=y+.5),n[m].outerDepth=e,n[m].innerDepth=+(n[m].depth-n[m].outerDepth).toFixed(1)}else if("inner"===v){let e=+(n[m].innerDepth-t).toFixed(1);b=Math.floor(e),C=e-b;C<=.4?e=b:.7<=C?e=b+1:0<C&&(e=b+.5),n[m].innerDepth=e,n[m].outerDepth=+(n[m].depth-n[m].innerDepth).toFixed(1)}}}return innerWalls.reverseWalls(a),!0}movingAxisMicroWalls(l=0){if(void 0===this.count_use_function.x_movingAxisMicroWalls&&(this.count_use_function.x_movingAxisMicroWalls=0),500<this.count_use_function.x_movingAxisMicroWalls++)return console.error("MAX call x_movingAxisMicroWalls"),!1;for(var r in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(r)&&("659.9-889.68"!==innerWalls.lines[r].point_1.key&&"1547.84-894.96"!==innerWalls.lines[r].point_2.key&&innerWalls.lines[r].point_2.key,!(!innerWalls.lines[r].point_1.isConnected||innerWalls.lines[r].point_1.isDock||!innerWalls.lines[r].point_2.isConnected||innerWalls.lines[r].point_2.isDock||innerWalls.lines[r].length()>plannerParser.length_microwall))){let s=innerWalls.lines[r].point_1.getPerpendicularLine(innerWalls.lines[r]),o=innerWalls.lines[r].point_2.getPerpendicularLine(innerWalls.lines[r]);if(!1!==s&&!1!==o&&!s.isOverlay(o,2)){let e={},t=(e[s.id]=s,e[o.id]=o,this.findLinesForMovingAxisMicroWalls(s,s.otherPoint(innerWalls.lines[r].point_1),e)),i=this.findLinesForMovingAxisMicroWalls(o,o.otherPoint(innerWalls.lines[r].point_2),e),n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]=t[a]);for(var h in i)i.hasOwnProperty(h)&&(n[h]=i[h]);if(this.movingAxisMicroWallsHandler(n))return __debugP.step("InnerWalls.movingAxisMicroWalls"),this.stripLines(),this.movingAxisMicroWalls(l+1),!0}}return!1}findLinesForMovingAxisMicroWalls(t,i,n={}){let s=i.lines;if(!i.isConnected||i.isDock)return n;for(var o in s)if(s.hasOwnProperty(o)){let e=s[o];if(t.id!==e.id&&(t.type,e.type,void 0===n[e.id])){o=t.angleBetween2(e);if(178<=o&&o<=182)return t.getCommonOuterLine(e),n[t.id]=t,n[e.id]=e,this.findLinesForMovingAxisMicroWalls(e,e.otherPoint(i),n)}}return n}movingAxisMicroWallsHandler(n){if(0===Object.keys(n).length)return!1;let e=1e8,i;for(var t in n)n.hasOwnProperty(t)&&n[t].depth<e&&(e=n[t].depth,i=n[t]);delete n[i.id];let s=i.getBigLine();if(void 0===i.outerLines[0])return __debugP.warn("нет внешних стен - м"),!1;if(void 0===i.outerLines[1])return __debugP.warn("нет внешних стен - м"),!1;let o=i.outerLines[0].getBigLine(),l=i.outerLines[1].getBigLine(),r={},a=(r[i.id]=i,{}),h=null;for(var g in n)if(n.hasOwnProperty(g)){var _=s.getPointProjection(n[g].point_1),d=s.getPointProjection(n[g].point_2);let t=n[g].point_1.lines,i=n[g].point_2.lines,e=new Line(_,d);var p,c,A,u=new Line(n[g].center(),e.center()),w=(a[g]={place:n[g].getPlaceByLine(s),lengthBetween:n[g].getLengthBetweenLines(s).toFixed(1),center:n[g].center()},e.angleBetween(n[g]));if(!(w<=1||179<=w))return __debugP.warn("большой угол - м"),!1;if(outerWalls.isIntersectionWall(u,[],!0))return __debugP.warn("пересечение линии 0 - м"),!1;if(!outerWalls.isPointOnLines(n[g].center())&&outerWalls.isPointOnLines(e.center()))return __debugP.warn("наезд на внешнюю линию 0 - м"),!1;if(!outerWalls.isIntersectionWall(n[g],[],!0)&&outerWalls.isIntersectionWall(e,[],!0))return __debugP.warn("пересечение линии 1 - м"),!1;for(p in t)if(t.hasOwnProperty(p)){let e=new Line(t[p].otherPoint(n[g].point_1),_);if(void 0===n[p]&&!e.equalPoints(1)){var m=t[p].angleBetween(e);if(!(m<2||178<m))return __debugP.warn("большой угол - м д",m),!1}if(t[p].isAlmostPerpendicular(n[g])&&!outerWalls.isIntersectionWall(t[p],[],!0)&&outerWalls.isIntersectionWall(e,[],!0))return __debugP.warn("пересечение линии 2 - м"),!1}for(c in i)if(i.hasOwnProperty(c)){let e=new Line(i[c].otherPoint(n[g].point_2),d);if(void 0===n[c]&&!e.equalPoints(1)){var f=i[c].angleBetween(e);if(!(f<2||178<f))return __debugP.warn("большой угол - м д",f),!1}if(i[c].isAlmostPerpendicular(n[g])&&!outerWalls.isIntersectionWall(i[c],[],!0)&&outerWalls.isIntersectionWall(e,[],!0))return __debugP.warn("пересечение линии 3 - м"),!1}for(A in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(A)&&void 0===n[A]&&e.isPointOnLine(innerWalls.lines[A].center()))return __debugP.warn("наезд на линию - м"),!1}for(var I in n)if(n.hasOwnProperty(I)){var C,y=s.getPointProjection(n[I].point_1),b=s.getPointProjection(n[I].point_2),v=innerWalls.findPoint(y,1.5,n[I].point_1),x=innerWalls.findPoint(b,1.5,n[I].point_2),B=a[I].place;let t=a[I].lengthBetween,e=(v&&n[I].point_1.id!==v.id?innerWalls.replacePoint(n[I].point_1.id,v.id):n[I].point_1.set(y),!1);for(C in n[I].point_1.lines)n[I].point_1.lines.hasOwnProperty(C)&&n[I].point_1.lines[C].equalPoints(2)&&(innerWalls.deleteAloneLine(n[I].point_1.lines[C]),I===C&&(e=!0));if(e)__debugP.warn("линия в одной точке 1 - м");else{for(var k in x&&n[I].point_2.id!==x.id?innerWalls.replacePoint(n[I].point_2.id,x.id):n[I].point_2.set(b),n[I].point_2.lines)n[I].point_2.lines.hasOwnProperty(k)&&n[I].point_2.lines[k].equalPoints(2)&&(innerWalls.deleteAloneLine(n[I].point_2.lines[k]),I===k&&(e=!0));if(e)__debugP.warn("линия в одной точке 2 - м");else{if(r[I]=n[I],2<=n[I].outerLines.length&&i.innerDepth===i.outerDepth&&(o.isLineOnLine(n[I].outerLines[0])||o.isLineOnLine(n[I].outerLines[1])||l.isLineOnLine(n[I].outerLines[0])||l.isLineOnLine(n[I].outerLines[1]))){let e;o.isLineOnLine(n[I].outerLines[0])||o.isLineOnLine(n[I].outerLines[1])?e=n[I].getPlaceByLine(o):(l.isLineOnLine(n[I].outerLines[0])||l.isLineOnLine(n[I].outerLines[1]))&&(e=n[I].getPlaceByLine(l)),"outer"===e?(n[I].outerDepth=i.outerDepth,n[I].innerDepth=+(n[I].depth-n[I].outerDepth).toFixed(1)):"inner"===e&&(n[I].innerDepth=i.outerDepth,n[I].outerDepth=+(n[I].depth-n[I].innerDepth).toFixed(1))}else{let i=!1;if(null!==h){let e=null,t=null;n[I].outerLines[0].isOneAxis(n[h].outerLines[0])?(e=n[I].outerLines[0],t=n[h].outerLines[0]):n[I].outerLines[0].isOneAxis(n[h].outerLines[1])?(e=n[I].outerLines[0],t=n[h].outerLines[1]):n[I].outerLines[1].isOneAxis(n[h].outerLines[1])?(e=n[I].outerLines[1],t=n[h].outerLines[1]):n[I].outerLines[1].isOneAxis(n[h].outerLines[0])&&(e=n[I].outerLines[1],t=n[h].outerLines[0]),null!==e&&(v=n[I].getPlaceByLine(e),y=n[h].getPlaceByLine(t),"inner"===v?(n[I].innerDepth="inner"===y?n[h].innerDepth:n[h].outerDepth,n[I].outerDepth=+(n[I].depth-n[I].innerDepth).toFixed(plannerParser.count_round),n[I].outerDepth,i=!0):"outer"===v&&(n[I].outerDepth="inner"===y?n[h].innerDepth:n[h].outerDepth,n[I].innerDepth=+(n[I].depth-n[I].outerDepth).toFixed(plannerParser.count_round),n[I].innerDepth,i=!0))}if(!i)if(t<.5&&(t=0),"outer"===B){let e=+(n[I].outerDepth-t).toFixed(1);x=Math.floor(e),b=e-x;b<=.4?e=x:.7<=b?e=x+1:0<b&&(e=x+.5),n[I].outerDepth=e,n[I].innerDepth=+(n[I].depth-n[I].outerDepth).toFixed(1)}else if("inner"===B){let e=+(n[I].innerDepth-t).toFixed(1);v=Math.floor(e),y=e-v;y<=.4?e=v:.7<=y?e=v+1:0<y&&(e=v+.5),n[I].innerDepth=e,n[I].outerDepth=+(n[I].depth-n[I].innerDepth).toFixed(1)}}h=I}}}return innerWalls.reverseWalls(r),!0}stripLines(){for(var i in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(i))for(var n in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(n)&&i!==n&&innerWalls.lines[i].isLineOnLine(innerWalls.lines[n])){let e=innerWalls.lines[i],t=innerWalls.lines[n];var s,n=e.getCommonPoint(t);if(!1!==n)return s=t.otherPoint(n),e.point_1.equal(n)?e.setPointById(e.point_1.id,s):e.setPointById(e.point_2.id,s),__debugP.step("InnerWalls.stripLines"),this.stripLines(),!1}return!0}connectTwoNoJoinPointOnDifferentLines(){if(10<this.connect_line_counts_91++)return console.error("MAX call x_connectTwoNoJoinPointOnDifferentLines"),!1;for(var n in innerWalls.points)if(innerWalls.points.hasOwnProperty(n)&&!innerWalls.points[n].isConnected&&!innerWalls.points[n].isDock){let i=innerWalls.points[n].line();for(var s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&n!==s&&!innerWalls.points[s].isConnected&&!innerWalls.points[s].isDock&&!innerWalls.points[n].isOneLine(innerWalls.points[s])){let t=innerWalls.points[s].line();if(i.isAlmost180Angle(t)){var o=new Line(i.otherPoint(innerWalls.points[n]),innerWalls.points[n]).pointOnLine(i.length()+5),s=new Line(t.otherPoint(innerWalls.points[s]),innerWalls.points[s]).pointOnLine(t.length()+5);let e=new Line(o,s);if(!(100<e.length())&&i.getNormal().isAlmost180Angle(e)&&!innerWalls.isIntersectionWall(e)&&!outerWalls.isIntersectionWall(e))return"H"===e.getType()?e.point_1.y=e.point_2.y:"V"===e.getType()&&(e.point_1.x=e.point_2.x),innerWalls.foundsLines.push(e),__debugP.warn("Нашли доп стену"),!0}}}return!1}connectDiagonalWithLine(){if(void 0===this.count_use_function.x_connectDiagonalWithLine&&(this.count_use_function.x_connectDiagonalWithLine=0),500<this.count_use_function.x_connectDiagonalWithLine++)return console.error("MAX call x_connectDiagonalWithLine"),!1;for(var l in innerWalls.points)if(innerWalls.points.hasOwnProperty(l)&&("1"!==innerWalls.points[l].key&&innerWalls.points[l].key,!innerWalls.points[l].isConnected&&!innerWalls.points[l].isDock)){let i=innerWalls.points[l].line();var n=i.otherPoint(innerWalls.points[l]);if("D"===i.type){var r,e=new Line(n,innerWalls.points[l]).getBigLineOne(5);let s=null,t=1e8,o=new Wall;for(r in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(r)&&i.id!==r&&!innerWalls.lines[r].hasPoint(n)){var a=innerWalls.lines[r].intersection(e);if(!1!==a){var h=new Line(innerWalls.points[l],a).length();if(!(h>plannerParser.max_distance_between_walls)){let e=new Line(n,a);e.length()-i.length()<-3||h<t&&(s=new PointWall(a.x,a.y),o=innerWalls.lines[r],t=h)}}}if(null!==s){var g=new Line(n,s);if(!i.isOverlayOuterLines(g)){let t=l;innerWalls.points[l].set(s),(g=innerWalls.findPoint(innerWalls.points[l]))&&(innerWalls.replacePoint(l,g.id),t=g.id);let i=!1,n=!1,e;if(2===o.point_1.countLines()){let e=o.point_1.line(0);g=o.point_1.line(1);e.isAlmost180Angle(g)&&(i=!0)}if(2===o.point_2.countLines()){let e=o.point_2.line(0);g=o.point_2.line(1);e.isAlmost180Angle(g)&&(n=!0)}if(i&&n?e=new Line(s,o.point_1).length()>new Line(s,o.point_2).length()?o.point_2:o.point_1:i?e=o.point_1:n&&(e=o.point_2),void 0!==e||o.point_1.isConnected&&o.point_2.isConnected||(!o.point_1.isConnected&&new Line(o.point_1,innerWalls.points[t]).length()<15?e=o.point_1:!o.point_2.isConnected&&new Line(o.point_2,innerWalls.points[t]).length()<15&&(e=o.point_2)),void 0!==e){for(var _ in e.lines)e.lines.hasOwnProperty(_)&&e.lines[_].setPointById(e.id,innerWalls.points[t]);0===e.countLines()&&innerWalls.deletePoint(e.id)}else{let e=new Wall(o.point_1,innerWalls.points[t]);if(o.setPointById(o.point_1.id,innerWalls.points[t]),!innerWalls.findLine(e)){if(e.equalPoints())continue;e.addOuterLines(o.outerLines),e.setDepth(o.depth),e.outerDepth=o.outerDepth,e.innerDepth=o.innerDepth,innerWalls.addLine(e)}}return __debugP.step("InnerWalls.connectDiagonalWithLine"),this.connectDiagonalWithLine(),!0}}}}return!1}connectTwoFreePointOfTwoParallelLines(){if(void 0===this.count_use_function.x_connectTwoFreePointOfTwoParallelLines&&(this.count_use_function.x_connectTwoFreePointOfTwoParallelLines=0),500<this.count_use_function.x_connectTwoFreePointOfTwoParallelLines++)return console.error("MAX call x_connectTwoFreePointOfTwoParallelLines"),!1;for(var l in innerWalls.points)if(innerWalls.points.hasOwnProperty(l)&&!innerWalls.points[l].isConnected&&!innerWalls.points[l].isDock){innerWalls.points[l].key;let n=innerWalls.points[l].line(),s=new Wall,o=null,e=1e8;for(var t in innerWalls.points){var i,r,a;!innerWalls.points.hasOwnProperty(t)||l===t||innerWalls.points[t].isConnected||innerWalls.points[t].isDock||((i=new Line(innerWalls.points[l],innerWalls.points[t]).length())>plannerParser.max_distance_between_walls||(r=innerWalls.points[t].line(),!n.isAlmost180Angle(r)||n.isOverlay(r)||(a=new Line(innerWalls.points[t],innerWalls.points[l]).angleBetween2(n))<.5||179.5<a||i<e&&(s=r,o=t,e=i)))}if(null!==o){var h=new Line(innerWalls.points[o],innerWalls.points[l]).center(),g=n.getBigLine().getPointProjection(h),h=new Line(h,g).getBigLine(),g=n.getBigLine().intersection(h),h=s.getBigLine().intersection(h),_=new Line(g,h);let e=new Line(g,n.otherPoint(innerWalls.points[l])),t=new Line(h,s.otherPoint(innerWalls.points[o]));if(!(e.length()<n.length()||t.length()<s.length()||outerWalls.isIntersectionWall(e)||outerWalls.isIntersectionWall(t)||outerWalls.isIntersectionWall(_)||innerWalls.isIntersectionWall(e)||innerWalls.isIntersectionWall(t)||innerWalls.isIntersectionWall(_)||n.isOverlayOuterLines(e)||s.isOverlayOuterLines(t))){innerWalls.points[l].set(g),innerWalls.points[o].set(h);let i=new Wall(innerWalls.points[l],innerWalls.points[o]);if(!innerWalls.findLine(i)){if(i.equalPoints())continue;i.setDepth(parseInt((n.depth+s.depth)/2)),i.outerDepth=i.getOuterDepth(),i.innerDepth=i.getInnerDepth(),i.isArtificial=!0,innerWalls.addLine(i);let e=i.getNormal();var d,p,c=e.getParallel(10),A=e.getParallel(-10);let t=1e5;for(d in outerWalls.lines)outerWalls.lines.hasOwnProperty(d)&&((p=outerWalls.lines[d].intersection(e)||outerWalls.lines[d].intersection(c)||outerWalls.lines[d].intersection(A))&&(p=new Line(i.center(),p).length())<t&&p<i.depth+5&&(t=p,i.outerLines[0]=outerWalls.lines[d]))}return __debugP.step("InnerWalls.connectTwoFreePointOfTwoParallelLines"),this.connectTwoFreePointOfTwoParallelLines(),!0}}}return!1}connectFreePointWithParallelLineOfJoint_2(){if(void 0===this.count_use_function.x_connectFreePointWithParallelLineOfJoint_2&&(this.count_use_function.x_connectFreePointWithParallelLineOfJoint_2=0),500<this.count_use_function.x_connectFreePointWithParallelLineOfJoint_2++)return console.error("MAX call x_connectFreePointWithParallelLineOfJoint_2"),!1;for(var n in innerWalls.points)if(innerWalls.points.hasOwnProperty(n)&&!innerWalls.points[n].isConnected&&!innerWalls.points[n].isDock){innerWalls.points[n].key;let t=innerWalls.points[n].line();new Wall;let i=null,e=1e8;var s,o,l=t.otherPoint(innerWalls.points[n]);for(s in innerWalls.points)!innerWalls.points.hasOwnProperty(s)||n===s||l.id===s||!innerWalls.points[s].isConnected||innerWalls.points[s].isDock||2!==innerWalls.points[s].countLines()||(o=new Line(innerWalls.points[n],innerWalls.points[s]).length())>plannerParser.max_distance_between_walls||!1!==innerWalls.points[s].getParallelLine(t)&&o<e&&(i=s,e=o);if(null!==i){let e=new Line(innerWalls.points[i],t.otherPoint(innerWalls.points[n]));if(!(outerWalls.isIntersectionWall(e,[],!0)||innerWalls.isIntersectionWall(e,[],!0)||e.length()<t.length())){var r=e.angleBetween2(t);if(!(r>e.paddingAngle(t)))if(!t.isOverlayOuterLines(e))return t.setPointById(n,innerWalls.points[i]),innerWalls.deletePoint(n),__debugP.step("InnerWalls.connectFreePointWithParallelLineOfJoint_2"),this.connectFreePointWithParallelLineOfJoint_2(),!0}}}return!1}movingAxis_2(){if(void 0===this.count_use_function.x_movingAxis_2&&(this.count_use_function.x_movingAxis_2=0),500<this.count_use_function.x_movingAxis_2++)return console.error("MAX call x_movingAxis_2"),!1;for(var n in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(n)&&("1725.06-696.16"!==innerWalls.lines[n].point_1.key&&innerWalls.lines[n].point_2.key,!innerWalls.lines[n].point_1.isConnected&&!innerWalls.lines[n].point_1.isDock||!innerWalls.lines[n].point_2.isConnected&&!innerWalls.lines[n].point_2.isDock)){var s=innerWalls.lines[n].point_1.isConnected?innerWalls.lines[n].point_2:innerWalls.lines[n].point_1;let t={},i=this.findLinesForMovingAxis_2(innerWalls.lines[n],s);if(0!==Object.keys(i).length){let e=this.findLinesForMovingAxis_2(innerWalls.lines[n],innerWalls.lines[n].otherPoint(s));for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o]);for(var l in e)e.hasOwnProperty(l)&&(t[l]=e[l]);this.movingAxisHandler(t,2)&&(__debugP.step("InnerWalls.movingAxis_2"),this.connectFreeParallelLines(),this.movingAxis_2_add_line(innerWalls.lines[n],s,t))}}}findLinesForMovingAxis_2(t,i,n={}){if(i.isDock)return n;let s=new Wall,o=null,l=1e8;for(var r in innerWalls.points)if(innerWalls.points.hasOwnProperty(r)&&i.id!==r&&!innerWalls.points[r].isDock){var a=new Line(i,innerWalls.points[r]).length();if(!(a>plannerParser.max_distance_between_walls)){let e=new Wall;for(var h in innerWalls.points[r].lines)if(innerWalls.points[r].lines.hasOwnProperty(h)&&t.isParallel(innerWalls.points[r].lines[h])&&!t.isOverlay(innerWalls.points[r].lines[h])){e=innerWalls.lines[h];break}null===e||t.id===e.id||t.type!==e.type||void 0!==n[e.id]||!t.isParallel(e)||t.isOverlay(e)||new Line(i,innerWalls.points[r]).length()>new Line(t.otherPoint(i),innerWalls.points[r]).length()||a<l&&(o=r,s=e,l=a)}}if(null!==o)return n[t.id]=t,n[s.id]=s,this.findLinesForMovingAxis_2(s,s.otherPoint(innerWalls.points[o]),n);for(var e in i.lines)if(i.lines.hasOwnProperty(e)&&t.id!==e&&t.isAlmost180Angle(i.lines[e])&&void 0===n[e])return n[t.id]=t,n[e]=i.lines[e],this.findLinesForMovingAxis_2(i.lines[e],i.lines[e].otherPoint(i),n);return n}movingAxis_2_add_line(s,o,l){if(0!==Object.keys(l).length){let t=new Wall,i=null,n=1e8;for(var r in l)if(l.hasOwnProperty(r)&&r!==s.id){var a=new Line(o,l[r].point_1).length(),h=new Line(o,l[r].point_2).length(),g=h<a?h:a,h=h<a?l[r].point_2:l[r].point_1;if(h.id!==o.id){let e=new Line(o,h);s.key()!==e.key()&&((a=s.angleBetween(e))<1||179<a)&&!s.isOverlayOuterLines(e)&&g<n&&(i=h.id,t=l[r],n=g)}}if(null!==i){let e=new Wall(o,innerWalls.points[i]);5<=e.length()?innerWalls.findLine(e)||(e.addOuterLines(t.outerLines),e.setDepth(t.depth),e.outerDepth=t.outerDepth,e.innerDepth=t.innerDepth,e.type=t.type,innerWalls.addLine(e)):(s.setPointById(o.id,innerWalls.points[i]),0===o.countLines()&&innerWalls.deletePoint(o.id,1)),__debugP.step("InnerWalls.movingAxis_2_add_line")}}}connectNoJoinLines(){if(void 0===this.count_use_function.x_connectNoJoinLines&&(this.count_use_function.x_connectNoJoinLines=0),500<this.count_use_function.x_connectNoJoinLines++)return console.error("MAX call x_connectNoJoinLines"),!1;for(var s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&!innerWalls.points[s].isConnected&&!innerWalls.points[s].isDock){let t=innerWalls.points[s].line(),i=new Wall,n=null,e=1e8;for(var o in innerWalls.points){var l,r;!innerWalls.points.hasOwnProperty(o)||s===o||innerWalls.points[o].isDock||innerWalls.points[s].isOneLine(innerWalls.points[o])||((l=new Line(innerWalls.points[s],innerWalls.points[o]).length())>plannerParser.max_distance_between_walls/3||(r=innerWalls.points[o].line(),l<e&&(i=r,n=o,e=l)))}if(null!==n){let e=new Wall(innerWalls.points[s],innerWalls.points[n]);var a=[t,i].concat(innerWalls.points[s].linesArray(),innerWalls.points[n].linesArray());if(!innerWalls.isIntersectionWall(e,a)&&!outerWalls.isIntersectionWall(e)){if(!innerWalls.findLine(e)){if(e.equalPoints())continue;e.addOuterLines(t.outerLines),e.setDepth(t.depth),e.outerDepth=t.outerDepth,e.innerDepth=t.innerDepth,innerWalls.addLine(e)}return __debugP.step("InnerWalls.connectNoJoinLines"),this.connectNoJoinLines(),!0}}}return!1}connectFreePointWithDock(){if(void 0===this.count_use_function.x_connectFreePointWithDock&&(this.count_use_function.x_connectFreePointWithDock=0),500<this.count_use_function.x_connectFreePointWithDock++)return console.error("MAX call x_connectFreePointWithDock"),!1;for(var s in innerWalls.points)if(innerWalls.points.hasOwnProperty(s)&&!innerWalls.points[s].isConnected&&!innerWalls.points[s].isDock){let t=innerWalls.points[s].line(),i=new Wall,n=null,e=1e8;for(var o in innerWalls.points){var l,r;!innerWalls.points.hasOwnProperty(o)||s===o||!innerWalls.points[o].isDock||(l=new Line(innerWalls.points[s],innerWalls.points[o]).length())>plannerParser.max_distance_between_walls/3||(r=innerWalls.points[o].line(),l<e&&(i=r,n=o,e=l))}if(null!==n){let e=new Wall(innerWalls.points[s],innerWalls.points[n]);if(!innerWalls.isIntersectionWall(e,[t,i])&&t.isAlmostPerpendicular(e)&&i.isAlmostPerpendicular(e)){if(!innerWalls.findLine(e)){if(e.equalPoints())continue;e.setDepth(10),e.outerDepth=e.getOuterDepth(),e.innerDepth=e.getInnerDepth(),innerWalls.addLine(e),innerWalls.points[n].isDock=!1}return __debugP.step("InnerWalls.connectFreePointWithDock"),this.connectFreePointWithDock(),!0}}}return!1}deleteLinesFromOnePoint(){for(var e in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(e)&&innerWalls.lines[e].equalPoints())return innerWalls.deleteAloneLine(innerWalls.lines[e]),__debugP.w("удаления линия в одной точке"),__debugP.step("InnerWalls.deleteLinesFromOnePoint"),void this.deleteLinesFromOnePoint()}deleteShortLines(){for(var e in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(e)&&!innerWalls.lines[e].point_1.isConnected&&!innerWalls.lines[e].point_2.isConnected&&innerWalls.lines[e].length()<10&&50<innerWalls.lines[e].depth)return innerWalls.deleteAloneLine(innerWalls.lines[e]),__debugP.w("удаления короткая линия"),__debugP.step("InnerWalls.deleteShortLines"),void this.deleteShortLines()}deleteMicroWalls(){if(void 0===this.count_use_function.x_deleteMicroWalls&&(this.count_use_function.x_deleteMicroWalls=0),500<this.count_use_function.x_deleteMicroWalls++)return console.error("MAX call x_deleteMicroWalls"),!1;for(var t in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(t)&&(!innerWalls.lines[t].point_1.isConnected||!innerWalls.lines[t].point_2.isConnected)){let e=null;if(null!==(e=innerWalls.lines[t].length()<=3||innerWalls.lines[t].length()<=10&&2===innerWalls.lines[t].outerLines.length&&(innerWalls.lines[t].outerLines[0].isParser||innerWalls.lines[t].outerLines[1].isParser)?innerWalls.lines[t]:e))return innerWalls.deleteAloneLine(e),__debugP.step("InnerWalls.deleteMicroWalls"),this.deleteMicroWalls(),!0}return!1}deleteMicroWalls_2(){if(void 0===this.count_use_function.x_deleteMicroWalls_2&&(this.count_use_function.x_deleteMicroWalls_2=0),500<this.count_use_function.x_deleteMicroWalls_2++)return console.error("MAX call x_deleteMicroWalls_2"),!1;for(var i in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(i)&&innerWalls.lines[i].length()<=4&&innerWalls.lines[i].point_1.isConnected&&innerWalls.lines[i].point_2.isConnected){let t=null;if(3===innerWalls.lines[i].point_1.countLines()){let e=innerWalls.lines[i].point_1.otherLines(innerWalls.lines[i]);var n=e[0].angleBetween2(e[1]);89.8<n&&n<90.2&&(t=innerWalls.lines[i].point_1)}if(null===t&&3===innerWalls.lines[i].point_2.countLines()){let e=innerWalls.lines[i].point_2.otherLines(innerWalls.lines[i]);n=e[0].angleBetween2(e[1]);89.8<n&&n<90.2&&(t=innerWalls.lines[i].point_2)}for(var e in null===t&&(t=innerWalls.lines[i].center()),innerWalls.lines[i].point_1.set(t),innerWalls.lines[i].point_2.set(t),innerWalls.lines[i].point_2.lines)innerWalls.lines[i].point_2.lines.hasOwnProperty(e)&&innerWalls.lines[i].point_1.addLine(innerWalls.lines[i].point_2.lines[e]);return innerWalls.deletePoint(innerWalls.lines[i].point_2.id),innerWalls.deleteLine(i),__debugP.w("удалена микростена меньше 4"),__debugP.step("InnerWalls.deleteMicroWalls_2"),this.deleteMicroWalls_2(),!1}return!0}unionMicroWalls(){if(void 0===this.count_use_function.x_unionMicroWalls&&(this.count_use_function.x_unionMicroWalls=0),500<this.count_use_function.x_unionMicroWalls++)return console.error("MAX call x_unionMicroWalls"),!1;for(var n in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(n)&&innerWalls.lines[n].length()<=4&&innerWalls.lines[n].point_1.isConnected&&innerWalls.lines[n].point_2.isConnected&&(2===innerWalls.lines[n].point_1.countLines()||2===innerWalls.lines[n].point_2.countLines())){let t=2===innerWalls.lines[n].point_1.countLines()?innerWalls.lines[n].point_1:innerWalls.lines[n].point_2,i=t.linesArray();if(i[0].isAlmost180Angle(i[1])){let e=i[0].key()===innerWalls.lines[n].key()?i[1]:i[0];var s=innerWalls.lines[n].otherPoint(t);return e.setPointById(t.id,s),innerWalls.deleteAloneLine(innerWalls.lines[n]),__debugP.w("was union Micro Walls"),__debugP.step("InnerWalls.unionMicroWalls"),this.unionMicroWalls(),!1}}return!0}isExistConnectPoint(t,i){for(var n in innerWalls.points)if(innerWalls.points.hasOwnProperty(n)&&i.id!==innerWalls.points[n].id&&!innerWalls.points[n].isConnected&&!innerWalls.points[n].isDock){let e=new Line(i,innerWalls.points[n]);var s=e.length();if(!(s>plannerParser.max_distance_between_walls)){s=innerWalls.points[n].line();if(s.id!==t.id&&!t.intersection(s)&&!outerWalls.isIntersectionWall(e)&&!innerWalls.isIntersectionWall(e,[t]))return!0}}return!1}}class ParserWallsFunctions{constructor(){this.count_use_function={}}cutIntersectionLines(n=!1){if(void 0===this.count_use_function.x_cutIntersectionLines&&(this.count_use_function.x_cutIntersectionLines=0),500<this.count_use_function.x_cutIntersectionLines++)return __debugP.log("MAX call x_cutIntersectionLines"),!1;for(var s in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(s))for(var o in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(o)&&s!==o){var l=parserWalls.lines[s].intersection(parserWalls.lines[o]);if(!(!1===l||parserWalls.lines[s].hasEqualPoint(l,1)&&parserWalls.lines[o].hasEqualPoint(l,1))){let e=outerWalls.isPointOnLines(parserWalls.lines[s].point_1),t=outerWalls.isPointOnLines(parserWalls.lines[s].point_2),i=!1;if(e||t){let t;if(t=(e?parserWalls.lines[s].point_1:parserWalls.lines[s].point_2).id,1<parserWalls.points[t].countLines()){let e=new PointParserWall(l.x,l.y);parserWalls.findPoint(e)?e=parserWalls.findPoint(e):parserWalls.addPoint(e),parserWalls.lines[s].setPointById(t,e)}else parserWalls.points[t].set(l),parserWalls.findPoint(parserWalls.points[t])&&(parserWalls.lines[s].setPointById(t,parserWalls.findPoint(parserWalls.points[t])),parserWalls.deletePoint(t));i=!0}if(e=outerWalls.isPointOnLines(parserWalls.lines[o].point_1),t=outerWalls.isPointOnLines(parserWalls.lines[o].point_2),e||t){let t;if(t=(e?parserWalls.lines[o].point_1:parserWalls.lines[o].point_2).id,1<parserWalls.points[t].countLines()){let e=new PointParserWall(l.x,l.y);parserWalls.findPoint(e)?e=parserWalls.findPoint(e):parserWalls.addPoint(e),parserWalls.lines[o].setPointById(t,e)}else parserWalls.points[t].set(l),parserWalls.findPoint(parserWalls.points[t])&&(parserWalls.lines[o].setPointById(t,parserWalls.findPoint(parserWalls.points[t])),parserWalls.deletePoint(t));i=!0}if(i)return __debugP.step("ParserWalls.cutIntersectionLines"),this.cutIntersectionLines(n),!0}}if(!n)for(var i in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(i))for(var r in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(r)&&i!==r){var a=parserWalls.lines[i].intersection(parserWalls.lines[r]);if(!(!1===a||parserWalls.lines[i].hasEqualPoint(a,1)&&parserWalls.lines[r].hasEqualPoint(a,1))){if(!parserWalls.lines[i].hasEqualPoint(a,1)){let t;var e=new Line(parserWalls.lines[i].point_1,a).length(),h=new Line(parserWalls.lines[i].point_2,a).length();if(t=e/h<.1?parserWalls.lines[i].point_1.id:h/e<.1?parserWalls.lines[i].point_2.id:(g=autoParser.isInWall(new Line(parserWalls.lines[i].point_1,a)),_=autoParser.isInWall(new Line(parserWalls.lines[i].point_2,a)),(g&&!_||!g&&_?g&&!_?parserWalls.lines[i].point_1:parserWalls.lines[i].point_2:e<h?parserWalls.lines[i].point_1:parserWalls.lines[i].point_2).id),1<parserWalls.points[t].countLines()){let e=new PointParserWall(a.x,a.y);parserWalls.findPoint(e)?e=parserWalls.findPoint(e):parserWalls.addPoint(e),parserWalls.lines[i].setPointById(t,e)}else parserWalls.points[t].set(a),parserWalls.findPoint(parserWalls.points[t])&&(parserWalls.lines[i].setPointById(t,parserWalls.findPoint(parserWalls.points[t])),parserWalls.deletePoint(t))}if(parserWalls.lines[r].hasEqualPoint(a,1)){let t;var g=new Line(parserWalls.lines[r].point_1,a).length(),_=new Line(parserWalls.lines[r].point_2,a).length();if(t=g/_<.1?parserWalls.lines[r].point_1.id:_/g<.1?parserWalls.lines[r].point_2.id:(e=autoParser.isInWall(new Line(parserWalls.lines[r].point_1,a)),h=autoParser.isInWall(new Line(parserWalls.lines[r].point_2,a)),(e&&!h||!e&&h?e&&!h?parserWalls.lines[r].point_1:parserWalls.lines[r].point_2:g<_?parserWalls.lines[r].point_1:parserWalls.lines[r].point_2).id),1<parserWalls.points[t].countLines()){let e=new PointParserWall(a.x,a.y);parserWalls.findPoint(e)?e=parserWalls.findPoint(e):parserWalls.addPoint(e),parserWalls.lines[r].setPointById(t,e)}else parserWalls.points[t].set(a),parserWalls.findPoint(parserWalls.points[t])&&(parserWalls.lines[r].setPointById(t,parserWalls.findPoint(parserWalls.points[t])),parserWalls.deletePoint(t))}return this.cutIntersectionLines(n),!0}}return!1}connectWalls(){if(void 0===this.count_use_function.x_connectWalls&&(this.count_use_function.x_connectWalls=0),500<this.count_use_function.x_connectWalls++)return __debugP.error("MAX call x_connectWalls"),!1;for(var o in parserWalls.points)if(parserWalls.points.hasOwnProperty(o)&&!parserWalls.points[o].isConnected){parserWalls.points[o].key;let i=parserWalls.points[o].line(),n=new ParserWall,s=null,e=1e8;for(var l in parserWalls.points){var r,a,h;!parserWalls.points.hasOwnProperty(l)||o===l||parserWalls.points[l].isConnected||((r=new Line(parserWalls.points[o],parserWalls.points[l]).length())>1.5*plannerParser.max_distance_between_walls||(a=parserWalls.points[l].line(),!i.isAlmost180Angle(a)||!1!==(h=i.getLengthOverlay(a))&&0<h||r<e&&(n=a,s=l,e=r)))}let t=null;if(e=1e8,null!==s)for(var g in parserWalls.points){var _,d;!parserWalls.points.hasOwnProperty(g)||s===g||parserWalls.points[g].isConnected||((_=new Line(parserWalls.points[o],parserWalls.points[g]).length())>1.5*plannerParser.max_distance_between_walls||(d=parserWalls.points[g].line(),!n.isAlmost180Angle(d)||!1!==(d=n.getLengthOverlay(d))&&0<d||_<e&&(t=g,e=_)))}if(null!==s&&null!==t&&t===o){var p=new Line(parserWalls.points[o],parserWalls.points[s]).center();let e=new Line(p,i.otherPoint(parserWalls.points[o])),t=new Line(p,n.otherPoint(parserWalls.points[s]));if(!(e.length()<i.length()-2||t.length()<n.length()-2)){var c=e.angleBetween2(i);if(!(1<c||1<t.angleBetween2(n)))return parserWalls.points[s].set(p),i.setPointById(o,parserWalls.points[s]),parserWalls.deletePoint(o),__debugP.step("ParserWalls.connectWalls"),this.connectWalls(),!0}}}return!1}connectFreeWallsRightAngles(){if(void 0===this.count_use_function.x_connectFreeWallsRightAngles&&(this.count_use_function.x_connectFreeWallsRightAngles=0),500<this.count_use_function.x_connectFreeWallsRightAngles++)return __debugP.error("MAX call x_connectFreeWallsRightAngles"),!1;for(var h in parserWalls.points)if(parserWalls.points.hasOwnProperty(h)&&!parserWalls.points[h].isConnected){parserWalls.points[h].key;let r=parserWalls.points[h].line(),e=new ParserWall,a=null,t=1e8;for(var n in parserWalls.points){var s,o;!parserWalls.points.hasOwnProperty(n)||h===n||parserWalls.points[n].isConnected||((s=new Line(parserWalls.points[h],parserWalls.points[n]).length())>1.5*plannerParser.max_distance_between_walls||(o=parserWalls.points[n].line(),r.isAlmostPerpendicular(o)&&s<t&&(e=o,a=n,t=s)))}let i=null;if(t=1e8,null!==a)for(var l in parserWalls.points){var g,_;!parserWalls.points.hasOwnProperty(l)||a===l||parserWalls.points[l].isConnected||((g=new Line(parserWalls.points[a],parserWalls.points[l]).length())>1.5*plannerParser.max_distance_between_walls||(_=parserWalls.points[l].line(),e.isAlmostPerpendicular(_)&&g<t&&(i=l,t=g)))}if(null!==a&&null!==i&&i===h){var d=r.getBigLine().intersection(e.getBigLine());if(!1!==d){let o=new Line(d,r.otherPoint(parserWalls.points[h])),l=new Line(d,e.otherPoint(parserWalls.points[a]));if(!o.equalPoints()&&!l.equalPoints()){if(r.isPointOnLine(d)||e.isPointOnLine(d)){let e=o.getRotation(d,45),t=o.getRotation(d,-45),i=l.getRotation(d,45),n=l.getRotation(d,-45),s=new Line;o.length()>l.length()&&(e=l.getRotation(d,45),t=l.getRotation(d,-45),i=o.getRotation(d,45),n=o.getRotation(d,-45)),i.isPointOnLine(e.otherPoint(d))?s=e:i.isPointOnLine(t.otherPoint(d))?s=t:n.isPointOnLine(e.otherPoint(d))?s=e:n.isPointOnLine(t.otherPoint(d))&&(s=t),s.isValid()?(p=new Line(d,s.otherPoint(d)).getBigLineOne(50),outerWalls.isIntersectionWall(p)&&(r.isPointOnLine(d)?o=new Line(d,parserWalls.points[h]):l=new Line(d,parserWalls.points[a]))):__debugP.e("diagonal null")}var p=o.angleBetween2(r);if(!(p>o.paddingAngle(r)||l.angleBetween2(e)>l.paddingAngle(e)||parserWalls.isOverlayWall(o,[r])||parserWalls.isOverlayWall(l,[e])))return parserWalls.points[a].set(d),r.setPointById(h,parserWalls.points[a]),parserWalls.deletePoint(h),__debugP.step("ParserWalls.connectFreeWallsRightAngles"),this.connectFreeWallsRightAngles(),!0}}}}return!1}connectFreeWallsNoRightAngles(){if(void 0===this.count_use_function.x_connectFreeWallsNoRightAngles&&(this.count_use_function.x_connectFreeWallsNoRightAngles=0),500<this.count_use_function.x_connectFreeWallsNoRightAngles++)return __debugP.error("MAX call x_connectFreeWallsNoRightAngles"),!1;for(var o in parserWalls.points)if(parserWalls.points.hasOwnProperty(o)&&!parserWalls.points[o].isConnected){parserWalls.points[o].key;let i=parserWalls.points[o].line(),n=new ParserWall,s=null,e=1e8;for(var l in parserWalls.points){var r,a;!parserWalls.points.hasOwnProperty(l)||o===l||parserWalls.points[l].isConnected||parserWalls.points[o].isOneLine(parserWalls.points[l])||((r=new Line(parserWalls.points[o],parserWalls.points[l]).length())>1.5*plannerParser.max_distance_between_walls||(a=parserWalls.points[l].line(),i.isAlmostPerpendicular(a)||r<e&&(n=a,s=l,e=r)))}let t=null;if(e=1e8,null!==s)for(var h in parserWalls.points){var g,_;!parserWalls.points.hasOwnProperty(h)||s===h||parserWalls.points[h].isConnected||parserWalls.points[s].isOneLine(parserWalls.points[h])||((g=new Line(parserWalls.points[s],parserWalls.points[h]).length())>1.5*plannerParser.max_distance_between_walls||(_=parserWalls.points[h].line(),i.isAlmostPerpendicular(_)||g<e&&(t=h,e=g)))}if(null!==s&&null!==t&&t===o){var d=i.getBigLine().intersection(n.getBigLine());if(!1!==d){let e=new Line(d,i.otherPoint(parserWalls.points[o])),t=new Line(d,n.otherPoint(parserWalls.points[s]));if(!1===i.intersection(n)){if(e.length()<i.length()&&e.length()/i.length()<.9)continue;if(t.length()<n.length()&&t.length()/n.length()<.9)continue}var p=e.angleBetween2(i);if(!(p>e.paddingAngle(i)||t.angleBetween2(n)>t.paddingAngle(n)))return parserWalls.points[s].set(d),i.setPointById(o,parserWalls.points[s]),parserWalls.deletePoint(o),__debugP.step("ParserWalls.connectFreeWallsNoRightAngles"),this.connectFreeWallsNoRightAngles(),!0}}}return!1}unionWalls(){if(void 0===this.count_use_function.x_unionWalls&&(this.count_use_function.x_unionWalls=0),500<this.count_use_function.x_unionWalls++)return __debugP.log("MAX call x_unionWalls"),!1;for(var n in parserWalls.points)if(parserWalls.points.hasOwnProperty(n)&&(parserWalls.points[n].key,2===parserWalls.points[n].countLines())){let t=parserWalls.points[n].line(0),i=parserWalls.points[n].line(1);if(t.isAlmost180Angle(i)){let e=new ParserWall(t.otherPoint(parserWalls.points[n]),i.otherPoint(parserWalls.points[n]));if(!e.equalPoints()&&!parserWalls.findLine(e))return e.depth=t.depth,e.addOuterLines(t.outerLines),e.addOuterLines(i.outerLines),parserWalls.deletePoint(n),parserWalls.deleteLine(t.id),parserWalls.deleteLine(i.id),parserWalls.addLine(e),__debugP.step("ParserWalls.unionWalls"),this.unionWalls(),!0}}return!1}fixDifferentLines1(l){let r={};for(let e=0;e<l.length;e++)r[l[e].key()]="";for(var a in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(a)&&!0!==parserWalls.lines[a].options.isFixDifferentLines1&&!parserWalls.lines[a].point_1.isConnected&&!parserWalls.lines[a].point_2.isConnected&&0!==parserWalls.lines[a].outerLines.length){let t=parserWalls.lines[a].outerLines[0];var h,g,e=t.point_1,_=t.point_2;let i=t.getBigLine(),n=1e8,s=new Line,o=new Line;for(h in outerWalls.points)if(outerWalls.points.hasOwnProperty(h)&&e.key!==outerWalls.points[h].key){var d=new Line(e,outerWalls.points[h]).length();if(!(d>plannerParser.max_distance_between_walls)){let e=null;for(var p in outerWalls.points[h].lines)if(outerWalls.points[h].lines.hasOwnProperty(p)&&void 0!==r[outerWalls.points[h].lines[p].key()]&&t.isAlmost180Angle(outerWalls.points[h].lines[p])&&!t.isOverlay(outerWalls.points[h].lines[p])&&i.isPointOnLine(outerWalls.points[h].lines[p].point_1)&&i.isPointOnLine(outerWalls.points[h].lines[p].point_2)){e=outerWalls.points[h].lines[p];break}d<n&&null!==e&&(s=e,n=d)}}for(g in n=1e8,outerWalls.points)if(outerWalls.points.hasOwnProperty(g)&&_.key!==outerWalls.points[g].key){var c=new Line(_,outerWalls.points[g]).length();if(!(c>plannerParser.max_distance_between_walls)){let e=null;for(var A in outerWalls.points[g].lines)if(outerWalls.points[g].lines.hasOwnProperty(A)&&void 0!==r[outerWalls.points[g].lines[A].key()]&&t.isAlmost180Angle(outerWalls.points[g].lines[A])&&!t.isOverlay(outerWalls.points[g].lines[A])&&i.isPointOnLine(outerWalls.points[g].lines[A].point_1)&&i.isPointOnLine(outerWalls.points[g].lines[A].point_2)){e=outerWalls.points[g].lines[A];break}c<n&&null!==e&&(o=e,n=c)}}if(s.isValid(),o.isValid(),s.isValid()&&o.isValid()){let i=new Line,n=new Line;for(var u in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(u)&&0!==parserWalls.lines[u].outerLines.length){let t=!1;for(let e=0;e<parserWalls.lines[u].outerLines.length;e++)if(parserWalls.lines[u].outerLines[e].key()===s.key()){i=parserWalls.lines[u],t=!0;break}if(t)break}for(var w in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(w)&&0!==parserWalls.lines[w].outerLines.length){let t=!1;for(let e=0;e<parserWalls.lines[w].outerLines.length;e++)if(parserWalls.lines[w].outerLines[e].key()===o.key()){n=parserWalls.lines[w],t=!0;break}if(t)break}if(i.isValid()&&n.isValid()){let e=i.getBigLine();var m=e.getPointProjection(parserWalls.lines[a].point_1),f=e.getPointProjection(parserWalls.lines[a].point_2);return parserWalls.lines[a].point_1.set(m),parserWalls.lines[a].point_2.set(f),parserWalls.lines[a].options.isFixDifferentLines1=!0,__debugP.step("ParserWalls.fixDifferentLines1"),this.fixDifferentLines1(l),!0}}}return!1}fixDifferentLines2(){if(void 0===this.count_use_function.x_fixDifferentLines2&&(this.count_use_function.x_fixDifferentLines2=0),500<this.count_use_function.x_fixDifferentLines2++)return __debugP.error("MAX call x_fixDifferentLines2"),!1;for(var s in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(s)&&!(parserWalls.lines[s].point_1.isConnected||parserWalls.lines[s].point_2.isConnected||100<parserWalls.lines[s].length())){var o,l=new Line(parserWalls.lines[s].center(),parserWalls.lines[s].point_1).getBigLineOne(100),r=new Line(parserWalls.lines[s].center(),parserWalls.lines[s].point_2).getBigLineOne(100),a=new Line(parserWalls.lines[s].center(),parserWalls.lines[s].pointNearLineCenter(20,"inside")).getBigLineOne(100),h=new Line(parserWalls.lines[s].center(),parserWalls.lines[s].pointNearLineCenter(20,"outside")).getBigLineOne(100);let e=!1,t=!1,i=!1,n=!1;for(o in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(o)){var g=outerWalls.lines[o].intersection(l);if(g&&!outerWalls.lines[o].isPointOnLine(parserWalls.lines[s].point_1)&&!outerWalls.lines[o].isPointOnLine(parserWalls.lines[s].point_2)&&!outerWalls.lines[o].point_1.equal(g,.5)&&!outerWalls.lines[o].point_2.equal(g,.5)){e=!0;break}}if(!e)for(var _ in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(_)){var d=parserWalls.lines[_].intersection(l);if(d&&!parserWalls.lines[_].isPointOnLine(parserWalls.lines[s].point_1)&&!parserWalls.lines[_].isPointOnLine(parserWalls.lines[s].point_2)&&!parserWalls.lines[_].point_1.equal(d,.5)&&!parserWalls.lines[_].point_2.equal(d,.5)){e=!0;break}}if(e){for(var p in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(p)){var c=outerWalls.lines[p].intersection(r);if(c&&!outerWalls.lines[p].isPointOnLine(parserWalls.lines[s].point_1)&&!outerWalls.lines[p].isPointOnLine(parserWalls.lines[s].point_2)&&!outerWalls.lines[p].point_1.equal(c,.5)&&!outerWalls.lines[p].point_2.equal(c,.5)){t=!0;break}}if(!t)for(var A in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(A)){var u=parserWalls.lines[A].intersection(r);if(u&&!parserWalls.lines[A].isPointOnLine(parserWalls.lines[s].point_1)&&!parserWalls.lines[A].isPointOnLine(parserWalls.lines[s].point_2)&&!parserWalls.lines[A].point_1.equal(u,.5)&&!parserWalls.lines[A].point_2.equal(u,.5)){t=!0;break}}if(t){for(var w in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(w)){var m=outerWalls.lines[w].intersection(a);if(m&&!outerWalls.lines[w].isPointOnLine(parserWalls.lines[s].point_1)&&!outerWalls.lines[w].isPointOnLine(parserWalls.lines[s].point_2)&&!outerWalls.lines[w].point_1.equal(m,.5)&&!outerWalls.lines[w].point_2.equal(m,.5)){i=!0;break}}if(!i)for(var f in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(f)){var I=parserWalls.lines[f].intersection(a);if(I&&!parserWalls.lines[f].isPointOnLine(parserWalls.lines[s].point_1)&&!parserWalls.lines[f].isPointOnLine(parserWalls.lines[s].point_2)&&!parserWalls.lines[f].point_1.equal(I,.5)&&!parserWalls.lines[f].point_2.equal(I,.5)){i=!0;break}}if(i){for(var C in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(C)){var y=outerWalls.lines[C].intersection(h);if(y&&!outerWalls.lines[C].isPointOnLine(parserWalls.lines[s].point_1)&&!outerWalls.lines[C].isPointOnLine(parserWalls.lines[s].point_2)&&!outerWalls.lines[C].point_1.equal(y,.5)&&!outerWalls.lines[C].point_2.equal(y,.5)){n=!0;break}}if(!n)for(var b in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(b)){var v=parserWalls.lines[b].intersection(h);if(v&&!parserWalls.lines[b].isPointOnLine(parserWalls.lines[s].point_1)&&!parserWalls.lines[b].isPointOnLine(parserWalls.lines[s].point_2)&&!parserWalls.lines[b].point_1.equal(v,.5)&&!parserWalls.lines[b].point_2.equal(v,.5)){n=!0;break}}if(n)return parserWalls.deleteAloneLine(parserWalls.lines[s]),__debugP.step("ParserWalls.fixDifferentLines2"),this.fixDifferentLines2(),!0}}}}return!1}fixDifferentLines3(o){if(void 0===this.count_use_function.x_fixDifferentLines3&&(this.count_use_function.x_fixDifferentLines3=0),500<this.count_use_function.x_fixDifferentLines3++)return __debugP.error("MAX call x_fixDifferentLines3"),!1;let l={};for(let e=0;e<o.length;e++)l[o[e].key()]="";for(var r in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(r)&&!0!==parserWalls.lines[r].options.isFixDifferentLines3&&!(parserWalls.lines[r].point_1.isConnected&&parserWalls.lines[r].point_2.isConnected||0===parserWalls.lines[r].outerLines.length)){let e=!1,t=(parserWalls.lines[r].point_1.isConnected?parserWalls.lines[r].point_1:parserWalls.lines[r].point_2).lines;for(var i in t)if(t.hasOwnProperty(i)&&i!==r&&!t[i].isAlmostPerpendicular(parserWalls.lines[r])){e=!0;break}if(!e){let n=parserWalls.lines[r].outerLines[0];var a,h,g,_=parserWalls.lines[r].point_1.isConnected?parserWalls.lines[r].point_2:parserWalls.lines[r].point_1;let t=n.getBigLine(),i=1e8,s=new Line;for(a in outerWalls.points)if(outerWalls.points.hasOwnProperty(a)&&_.key!==outerWalls.points[a].key){var d=new Line(_,outerWalls.points[a]).length();if(!(d>plannerParser.max_distance_between_walls)){let e=null;for(var p in outerWalls.points[a].lines)if(outerWalls.points[a].lines.hasOwnProperty(p)&&void 0!==l[outerWalls.points[a].lines[p].key()]&&n.isAlmost180Angle(outerWalls.points[a].lines[p])&&!n.isOverlay(outerWalls.points[a].lines[p])&&t.isPointOnLine(outerWalls.points[a].lines[p].point_1)&&t.isPointOnLine(outerWalls.points[a].lines[p].point_2)){e=outerWalls.points[a].lines[p];break}d<i&&null!==e&&(s=e,i=d)}}if(s.isValid()){let i=new Line;for(var c in parserWalls.lines)if(parserWalls.lines.hasOwnProperty(c)&&0!==parserWalls.lines[c].outerLines.length){let t=!1;for(let e=0;e<parserWalls.lines[c].outerLines.length;e++)if(parserWalls.lines[c].outerLines[e].key()===s.key()){i=parserWalls.lines[c],t=!0;break}if(t)break}if(i.isValid()&&(parserWalls.lines[r].options.isFixDifferentLines3=!0,!(i.depth>parserWalls.lines[r].depth))){let e=i.getBigLine(),t=n.calculateDepth(i);if(void 0!==parserWalls.lines[r].outerLines[1]&&8<=t&&(t=parserWalls.lines[r].outerLines[1].calculateDepth(i)),__debugP.error("новая толщина",t),!(t<8))return h=e.getPointProjection(parserWalls.lines[r].point_1),g=e.getPointProjection(parserWalls.lines[r].point_2),parserWalls.lines[r].point_1.set(h),parserWalls.lines[r].point_2.set(g),__debugP.error("fixDifferentLines3 !!!!"),__debugP.step("ParserWalls.fixDifferentLines3"),this.fixDifferentLines3(o),!0}}}}return!1}fixSuspiciousLines1(){for(let a=0;a<plannerParser.suspicious.length;a++){let t=plannerParser.suspicious[a].wall;var h,g,e=t.point_1,_=t.point_2;let i=t.getBigLine(),n=1e8,s=new OuterWall,o=new OuterWall;for(h in outerWalls.points)if(outerWalls.points.hasOwnProperty(h)&&e.id!==outerWalls.points[h].id){var d=new Line(e,outerWalls.points[h]).length();if(!(d>plannerParser.max_distance_between_walls)){let e=null;for(var p in outerWalls.points[h].lines)if(outerWalls.points[h].lines.hasOwnProperty(p)&&t.isAlmost180Angle(outerWalls.points[h].lines[p])&&!t.isOverlay(outerWalls.points[h].lines[p])&&i.isPointOnLine(outerWalls.points[h].lines[p].point_1)&&i.isPointOnLine(outerWalls.points[h].lines[p].point_2)){e=outerWalls.points[h].lines[p];break}d<n&&null!==e&&(s=e,n=d)}}for(g in n=1e8,outerWalls.points)if(outerWalls.points.hasOwnProperty(g)&&_.id!==outerWalls.points[g].id){var c=new Line(_,outerWalls.points[g]).length();if(!(c>plannerParser.max_distance_between_walls)){let e=null;for(var A in outerWalls.points[g].lines)if(outerWalls.points[g].lines.hasOwnProperty(A)&&t.isAlmost180Angle(outerWalls.points[g].lines[A])&&!t.isOverlay(outerWalls.points[g].lines[A])&&i.isPointOnLine(outerWalls.points[g].lines[A].point_1)&&i.isPointOnLine(outerWalls.points[g].lines[A].point_2)){e=outerWalls.points[g].lines[A];break}c<n&&null!==e&&(o=e,n=c)}}let l=new Line,r={};if(s.isValid())for(var u in s.lines)if(s.lines.hasOwnProperty(u))for(let i=0;i<s.lines[u].outerLines.length;i++)if(s.lines[u].outerLines[i].id!==s.id)for(let t=0;t<plannerParser.suspicious[a].lines.length;t++){let e=plannerParser.suspicious[a].lines[t].getBigLine();e.isPointOnLine(s.lines[u].outerLines[i].point_1,.001)&&e.isPointOnLine(s.lines[u].outerLines[i].point_2,.001)&&(r[e.getPaddingPointOnLine(s.lines[u].outerLines[i].point_1)+e.getPaddingPointOnLine(s.lines[u].outerLines[i].point_2)]=t)}if(o.isValid())for(var w in o.lines)if(o.lines.hasOwnProperty(w))for(let i=0;i<o.lines[w].outerLines.length;i++)if(o.lines[w].outerLines[i].id!==o.id)for(let t=0;t<plannerParser.suspicious[a].lines.length;t++){let e=plannerParser.suspicious[a].lines[t].getBigLine();e.isPointOnLine(o.lines[w].outerLines[i].point_1,.001)&&e.isPointOnLine(o.lines[w].outerLines[i].point_2,.001)&&(r[e.getPaddingPointOnLine(o.lines[w].outerLines[i].point_1)+e.getPaddingPointOnLine(o.lines[w].outerLines[i].point_2)]=t)}if(0<Object.keys(r).length){let e=Object.keys(r);e.sort((e,t)=>e-t),l=plannerParser.suspicious[a].lines[r[e[0]]]}if(l.isValid()){if(l.length()<=50){let e=!1;for(var m in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(m)&&!1===outerWalls.lines[m].isParser&&(outerWalls.lines[m].isPointOnLine(l.point_1)||outerWalls.lines[m].isPointOnLine(l.point_2))){e=!0;break}if(e)return plannerParser.suspicious.splice(a,1),this.fixSuspiciousLines1(),!0}return parserWalls.addNewWall(t,l),plannerParser.suspicious.splice(a,1),__debugP.step("ParserWalls.fixSuspiciousLines1"),this.fixSuspiciousLines1(),!0}}return!1}fixSuspiciousLines2(){for(let l=0;l<plannerParser.suspicious.length;l++){let t=plannerParser.suspicious[l].wall;var r,a,h=t.center(),e=t.point_1,g=t.point_2;let i=1e8,n=new OuterWall,s=new OuterWall;for(r in outerWalls.points)if(outerWalls.points.hasOwnProperty(r)){var _=new Line(e,outerWalls.points[r]).length();if(!(_>plannerParser.max_distance_between_walls)){let e=null;for(var d in outerWalls.points[r].lines)if(outerWalls.points[r].lines.hasOwnProperty(d)&&t.isAlmostPerpendicular(outerWalls.points[r].lines[d])){e=outerWalls.points[r].lines[d];break}_<i&&null!==e&&(n=e,i=_)}}for(a in i=1e8,outerWalls.points)if(outerWalls.points.hasOwnProperty(a)){var p=new Line(g,outerWalls.points[a]).length();if(!(p>plannerParser.max_distance_between_walls)){let e=null;for(var c in outerWalls.points[a].lines)if(outerWalls.points[a].lines.hasOwnProperty(c)&&t.isAlmostPerpendicular(outerWalls.points[a].lines[c])){e=outerWalls.points[a].lines[c];break}p<i&&null!==e&&(s=e,i=p)}}let o=new Line;if(n.isValid())for(var A in n.lines)if(n.lines.hasOwnProperty(A)){var u=n.lines[A].depth;let t={};for(let e=0;e<plannerParser.suspicious[l].lines.length;e++){var w=new Line(h,plannerParser.suspicious[l].lines[e].center()).length();Math.abs(u-w)<4&&(t[Math.abs(u-w)]=e)}if(0<Object.keys(t).length){let e=Object.keys(t);e.sort((e,t)=>e-t),o=plannerParser.suspicious[l].lines[t[e[0]]];break}}if(s.isValid()&&!o.isValid())for(var m in s.lines)if(s.lines.hasOwnProperty(m)){var f=s.lines[m].depth;let t={};for(let e=0;e<plannerParser.suspicious[l].lines.length;e++){var I=new Line(h,plannerParser.suspicious[l].lines[e].center()).length();Math.abs(f-I)<4&&(t[Math.abs(f-I)]=e)}if(0<Object.keys(t).length){let e=Object.keys(t);e.sort((e,t)=>e-t),o=plannerParser.suspicious[l].lines[t[e[0]]];break}}if(o.isValid()){if(o.length()<=50){let e=!1;for(var C in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(C)&&!1===outerWalls.lines[C].isParser&&(outerWalls.lines[C].isPointOnLine(o.point_1)||outerWalls.lines[C].isPointOnLine(o.point_2))){e=!0;break}if(e)return plannerParser.suspicious.splice(l,1),this.fixSuspiciousLines2(),!0}return parserWalls.addNewWall(t,o),plannerParser.suspicious.splice(l,1),__debugP.step("ParserWalls.fixSuspiciousLines2"),this.fixSuspiciousLines2(),!0}}return!1}fixSuspiciousLines3(){for(let s=0;s<plannerParser.suspicious.length;s++){let e=plannerParser.suspicious[s].wall;let t=new Line,i={},n={};for(var o in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(o)&&e.id!==o)for(let t=0;t<plannerParser.suspicious[s].lines.length;t++){let e=plannerParser.suspicious[s].lines[t].getBigLine();e.isPointOnLine(outerWalls.lines[o].point_1,.001)&&e.isPointOnLine(outerWalls.lines[o].point_2,.001)&&(i[e.getPaddingPointOnLine(outerWalls.lines[o].point_1)+e.getPaddingPointOnLine(outerWalls.lines[o].point_2)]=t,outerWalls.lines[o].isParser&&(n[e.getPaddingPointOnLine(outerWalls.lines[o].point_1)+e.getPaddingPointOnLine(outerWalls.lines[o].point_2)]=t))}if(0<Object.keys(n).length&&(i=n),0<Object.keys(i).length){let e=Object.keys(i);e.sort((e,t)=>e-t),t=plannerParser.suspicious[s].lines[i[e[0]]]}if(t.isValid()){if(t.length()<=50){let e=!1;for(var l in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(l)&&!1===outerWalls.lines[l].isParser&&(outerWalls.lines[l].isPointOnLine(t.point_1)||outerWalls.lines[l].isPointOnLine(t.point_2))){e=!0;break}if(e)return plannerParser.suspicious.splice(s,1),this.fixSuspiciousLines3(),!0}var r=e.calculateDepth(t);if(!(r>=plannerParser.max_distance_between_walls||r<5))return parserWalls.addNewWall(e,t),plannerParser.suspicious.splice(s,1),__debugP.step("ParserWalls.fixSuspiciousLines3"),this.fixSuspiciousLines3(),!0}}return!1}fixSuspiciousLines4(){if(0===parserWalls.countLines())return!1;let e=0;for(var t in parserWalls.lines)parserWalls.lines.hasOwnProperty(t)&&(e+=parserWalls.lines[t].depth);var o=+(e/parserWalls.countLines()).toFixed(plannerParser.count_round);for(let s=0;s<plannerParser.suspicious.length;s++){let e=plannerParser.suspicious[s].wall,t=e.getParallel(-o),i=e.getParallel(o);var l=new Line(plannerParser.suspicious[s].lines[0].center(),t.center()).length();let n=new Line(plannerParser.suspicious[s].lines[0].center(),i.center()).length()<l?i:t;if(n.length()<=50){let e=!1;for(var r in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(r)&&!1===outerWalls.lines[r].isParser&&(outerWalls.lines[r].isPointOnLine(n.point_1)||outerWalls.lines[r].isPointOnLine(n.point_2))){e=!0;break}if(e)return plannerParser.suspicious.splice(s,1),this.fixSuspiciousLines4(),!0}parserWalls.addNewWall(e,n),__debugP.step("ParserWalls.fixSuspiciousLines4")}return!(plannerParser.suspicious=[])}decreaseParserWalls(s){if(0!==parserWalls.countLines()){for(var o in outerWalls.lines)if(outerWalls.lines.hasOwnProperty(o)&&("74-192:74-2"!==outerWalls.lines[o].key()&&outerWalls.lines[o].key(),!1!==outerWalls.lines[o].isParser&&0!==outerWalls.lines[o].countLines())){let n=new Wall;for(var e in outerWalls.lines[o].lines)if(outerWalls.lines[o].lines.hasOwnProperty(e)&&void 0===outerWalls.lines[o].lines[e].options.decreaseParserWallsFix){n=outerWalls.lines[o].lines[e];break}if(n.isValid()){let t=this.findDecreaseParserWalls(n,n.point_1),i=this.findDecreaseParserWalls(n,n.point_2);if(!1===t||!1===i)n.options.decreaseParserWallsFix=!0;else{let e={};for(var l in e[n.id]=n,t)t.hasOwnProperty(l)&&(e[l]=t[l]);for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r]);for(var a in e)e.hasOwnProperty(a)&&(e[a].options.decreaseParserWallsFix=!0);this.decreaseParserWallsHandler(e,outerWalls.lines[o],s),__debugP.step("ParserWalls.decreaseParserWalls")}}}for(var h in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(h)&&!1!==innerWalls.lines[h].isArtificial){let s=innerWalls.lines[h];if(void 0===s.options.decreaseParserWallsFix&&1===s.outerLines.length){s.options.decreaseParserWallsFix=!0;let e=s.outerLines[0],t=e.getBigLine(),i=new Line(s.center(),s.getNormal().intersection(t));var h=t.getParallel(-5),g=t.getParallel(5);let n=null;var _,d,p,h=(n=i.intersection(h)?h:g).getPointProjection(s.point_1),g=n.getPointProjection(s.point_2);for(_ in s.point_1.set(h),s.point_2.set(g),s.outerDepth=5,s.innerDepth=5,s.depth=s.outerDepth+s.innerDepth,s.holes)s.holes.hasOwnProperty(_)&&(d=n.getPointProjection(s.holes[_].point_1),p=n.getPointProjection(s.holes[_].point_2),s.holes[_].point_1.set(d),s.holes[_].point_2.set(p));__debugP.step("ParserWalls.decreaseParserWalls")}}}}findDecreaseParserWalls(t,i,n={}){let s=i.lines;for(var o in s)if(s.hasOwnProperty(o)){let e=s[o];if(t.id!==e.id&&void 0===n[e.id]){o=t.angleBetween2(e);if(178.5<=o&&o<=181.5||0<=o&&o<=1.5)return!1===e.isParserOuterLine()?t.depth>e.depth&&(e.options.decreaseParserWallsIsInnerWall=!0,n[t.id]=t,n[e.id]=e,n):(n[t.id]=t,n[e.id]=e,this.findDecreaseParserWalls(e,e.otherPoint(i),n))}}return n}decreaseParserWallsHandler(h,g,_){if(0!==Object.keys(h).length){let i=new Wall;for(var e in h)if(h.hasOwnProperty(e)&&!0===h[e].options.decreaseParserWallsIsInnerWall){i=h[e];break}if(i.isValid()){delete h[i.id];var n,s=g.getBigLine();let e=null;for(n in g.lines)if(g.lines.hasOwnProperty(n)){var o=g.lines[n];if(e=o.outerLines[0].id===g.id?o.outerLines[1]:o.outerLines[0],void 0!==i.outerLines[e.id])break;e=null}if(null===e)for(var l in g.lines)if(g.lines.hasOwnProperty(l)){var l=g.lines[l],l=(e=l.outerLines[0].id===g.id?l.outerLines[1]:l.outerLines[0]).getBigLine(),r=(e=null,new Line(i.outerLines[0].center(),i.outerLines[0].getNormal().intersection(l)).length()),l=new Line(i.outerLines[1].center(),i.outerLines[1].getNormal().intersection(l)).length();if(!(1<r&&1<l)){e=r<l?i.outerLines[0]:i.outerLines[1];break}}if(null===e)return;let t=i.outerLines[0].id===e.id?i.outerLines[1]:i.outerLines[0];var a,d,p=t.getBigLine(),c=this.getPointDecreaseParserWall(g.point_1,p),p=this.getPointDecreaseParserWall(g.point_2,p),A=(g.point_1.set(c),g.point_2.set(p),i.depth);for(a in h)h.hasOwnProperty(a)&&("outer"===(d=h[a].getPlaceByLine(s))?h[a].outerDepth=+(A-h[a].innerDepth).toFixed(1):"inner"===d&&(h[a].innerDepth=+(A-h[a].outerDepth).toFixed(1)),h[a].depth=h[a].outerDepth+h[a].innerDepth)}else{let e=1e4,a;for(var t in h)h.hasOwnProperty(t)&&h[t].depth<e&&(e=h[t].depth,a=h[t]);if(1!==Object.keys(h).length||void 0===h[a.id]||10!==a.depth){var u=g.getBigLine();let e=a.outerLines[0].id===g.id?a.outerLines[1]:a.outerLines[0],t,i;var c=e.getParallel(-10),p=e.getParallel(10),w=e.getParallel(-5),m=e.getParallel(5);let n=new Line(e.center(),e.getNormal().intersection(u));i=n.intersection(w)?(t=c,w):(t=p,m);var f,I,C=t.getBigLine();let s=i.getBigLine(),o={},l={},r={};for(f in h)h.hasOwnProperty(f)&&(o[h[f].point_1.id]=1,o[h[f].point_2.id]=1);for(I in o)if(o.hasOwnProperty(I)){let t=innerWalls.points[I];var y,b=this.getPointDecreaseParserWall(t,s);l[I]=b;let i={};for(y in t.lines)t.lines.hasOwnProperty(y)&&!h.hasOwnProperty(y)&&(i[y]=t.lines[y]);if(0!==Object.keys(i).length)for(var v in i)if(i.hasOwnProperty(v)){let e=i[v].getCopy();if(e.point_1.key===t.key)e.point_1=b;else{if(e.point_2.key!==t.key)return void __debugP.error("Нет нужной точки");e.point_2=b}var x=e.angleBetween2(i[v]),v=e.paddingAngle(i[v]);if(!(x<=v||180-v<=x))return void __debugP.error("decreaseParserWallsHandler Большой угол смещения "+x)}}var B,k,L,E,W,P,c=this.getPointDecreaseParserWall(g.point_1,C),w=this.getPointDecreaseParserWall(g.point_2,C);if(!outerWalls.isIntersectionWall(g,[g])&&outerWalls.isIntersectionWall(new Line(c,w),[g])){if(__debugP.error("decreaseParserWallsHandler внешняя стена пересекает другую"),1===_)for(var Q in h)h.hasOwnProperty(Q)&&(h[Q].options.decreaseParserWallsFix=void 0)}else{for(var M in g.point_1.set(c),g.point_2.set(w),h)if(h.hasOwnProperty(M)&&(r[M]={place:h[M].getPlaceByLine(u)},!h[M].existOuterLine(g))){let t,i=new Line(h[M].center(),h[M].getNormal().intersection(u)).getBigLineOne();for(let e=0;e<h[M].outerLines.length;e++)if(i.intersection(h[M].outerLines[e])){t=h[M].outerLines[e];break}void 0!==t&&(B=this.getPointDecreaseParserWall(t.point_1,C),k=this.getPointDecreaseParserWall(t.point_2,C),t.point_1.set(B),t.point_2.set(k))}for(var D in h)if(h.hasOwnProperty(D)){let t=0;if(2===h[D].outerLines.length){let e=new Line(h[D].getNormal().intersection(h[D].outerLines[0]),h[D].getNormal().intersection(h[D].outerLines[1]));t=e.length()}for(E in h[D].outerDepth===h[D].innerDepth||9<t&&t<11?(h[D].outerDepth=5,h[D].innerDepth=5):"outer"===(L=r[D].place)?(h[D].outerDepth=5,h[D].depth=h[D].outerDepth+h[D].innerDepth,0<t&&2<Math.abs(t-h[D].depth)&&(h[D].innerDepth=Math.round(t-h[D].outerDepth))):"inner"===L&&(h[D].innerDepth=5,h[D].depth=h[D].outerDepth+h[D].innerDepth,0<t&&2<Math.abs(t-h[D].depth)&&(h[D].outerDepth=Math.round(t-h[D].innerDepth))),h[D].depth=h[D].outerDepth+h[D].innerDepth,h[D].holes)h[D].holes.hasOwnProperty(E)&&(W=s.getPointProjection(h[D].holes[E].point_1),P=s.getPointProjection(h[D].holes[E].point_2),h[D].holes[E].point_1.set(W),h[D].holes[E].point_2.set(P))}for(var O in l)l.hasOwnProperty(O)&&(void 0===innerWalls.points[O]?__debugP.error("decreaseParserWallsHandler - not found point 2"):innerWalls.points[O].set(l[O]))}}}}}getPointDecreaseParserWall(e,t){let i,n;for(var s in e.lines)if(e.lines.hasOwnProperty(s)){var o=e.lines[s].angleBetween2(t);if(Number.isNaN(o),!(178.5<=o&&o<=181.5||0<=o&&o<=1.5||88.5<=o&&o<=91.5)){n=e.lines[s];break}}return i=void 0!==n?t.intersection(n.getBigLine()):t.getPointProjection(e)}}class HolesFunctions{constructor(){this.count_use_function={}}removeHoles(){for(var e in holes.lines)if(holes.lines.hasOwnProperty(e)){let t=holes.lines[e];for(var i in holes.lines)if(holes.lines.hasOwnProperty(i)&&e!==i){let e=holes.lines[i];if(t.type===e.type&&(e.hasEqualPoint(t.point_1),e.hasEqualPoint(t.point_1,2)&&e.hasEqualPoint(t.point_2,2)&&t.isParallel(e)&&t.isOverlay(e)))return holes.deleteAloneLine(e),__debugP.step("Holes.removeHoles"),this.removeHoles(),!0}}return!1}movingDoors(){for(var i in holes.lines)if(holes.lines.hasOwnProperty(i)&&"door"===holes.lines[i].type){var n,s,o,l,r,a,h,g=holes.lines[i].isPointOnLine(holes.lines[i].line.point_1,7),_=holes.lines[i].isPointOnLine(holes.lines[i].line.point_2,7);let e=!1,t=!1;for(o in(g||_)&&(n=holes.lines[i].center(),g&&(s=this.getDepthWall(holes.lines[i].line,holes.lines[i].line.point_1,holes.lines[i].isPointOnLine(holes.lines[i].line.point_1)),1===this.movingDoor(holes.lines[i],holes.lines[i].line,holes.lines[i].line.point_1,n,s,e,t)?e=!0:t=!0,_||holes.lines[i].isPointOnLine(holes.lines[i].line.point_2,7)&&(s=this.getDepthWall(holes.lines[i].line,holes.lines[i].line.point_2,holes.lines[i].isPointOnLine(holes.lines[i].line.point_2)),1===this.movingDoor(holes.lines[i],holes.lines[i].line,holes.lines[i].line.point_2,n,s,e,t)?e=!0:t=!0)),_&&(s=this.getDepthWall(holes.lines[i].line,holes.lines[i].line.point_2,holes.lines[i].isPointOnLine(holes.lines[i].line.point_2)),1===this.movingDoor(holes.lines[i],holes.lines[i].line,holes.lines[i].line.point_2,n,s,e,t)?e=!0:t=!0,g||holes.lines[i].isPointOnLine(holes.lines[i].line.point_1,7)&&(_=this.getDepthWall(holes.lines[i].line,holes.lines[i].line.point_1,holes.lines[i].isPointOnLine(holes.lines[i].line.point_1)),1===this.movingDoor(holes.lines[i],holes.lines[i].line,holes.lines[i].line.point_1,n,_,e,t)?e=!0:t=!0))),holes.lines)holes.lines.hasOwnProperty(o)&&i!==o&&"window"===holes.lines[o].type&&holes.lines[i].isParallel(holes.lines[o])&&(l=holes.lines[i].isPointOnLine(holes.lines[o].point_1,5),r=holes.lines[i].isPointOnLine(holes.lines[o].point_2,5),a=holes.lines[o],h=holes.lines[i].center(),l&&(1===this.movingDoor(holes.lines[i],holes.lines[i].line,a.point_1,h,4,e,t)?e=!0:t=!0),r&&(1===this.movingDoor(holes.lines[i],holes.lines[i].line,a.point_2,h,4,e,t)?e=!0:t=!0))}}getDepthWall(e,t,i){let n=5;for(var s in t.lines)if(t.lines.hasOwnProperty(s)&&s!==e.id&&t.lines[s].isAlmostPerpendicular(e)){n=t.lines[s].depth;break}return Math.ceil(n/2)+(i?2:-3)}movingDoor(i,e,n,s,o=5,l,r,t){let a=new Line(n,i.point_1),h=new Line(n,i.point_2),g;if(a.length()>h.length()){let e=new Line(s,i.point_2);n=e.pointOnLine(e.length()-h.length()-o);let t=new Line(s,i.point_1);var _=t.pointOnLine(t.length()+h.length()+o);i.point_2.set(n),l||i.point_1.set(_),g=2}else{let e=new Line(s,i.point_1);n=e.pointOnLine(e.length()-a.length()-o);let t=new Line(s,i.point_2);l=t.pointOnLine(t.length()+a.length()+o);i.point_1.set(n),r||i.point_2.set(l),g=1}return __debugP.step("Holes.movingDoor"),g}}class PillarsFunctions{constructor(){this.count_use_function={}}findPillar(){for(var n in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(n)&&!innerWalls.lines[n].isBalcony)if(innerWalls.lines[n].length()<=120&&20<=innerWalls.lines[n].length()&&20<=innerWalls.lines[n].depth&&!1===innerWalls.lines[n].point_1.isConnected&&!1===innerWalls.lines[n].point_2.isConnected)innerWalls.lines[n].isPillar=!0;else if(innerWalls.lines[n].length()<=120&&20<=innerWalls.lines[n].length()&&20<=innerWalls.lines[n].depth){if(innerWalls.lines[n].depth<40)if(1.5<Math.max(innerWalls.lines[n].depth,innerWalls.lines[n].length())/Math.min(innerWalls.lines[n].depth,innerWalls.lines[n].length()))continue;if("D"===innerWalls.lines[n].type)__debugP.warn("Pillar D",innerWalls.lines[n]);else{let e=!0,t=!0,i=!1;for(var s in innerWalls.lines[n].point_1.lines)if(innerWalls.lines[n].point_1.lines.hasOwnProperty(s)&&s!==n){if(innerWalls.lines[n].point_1.lines[s].isPillar){i=!0;break}if(innerWalls.lines[n].point_1.lines[s].type===innerWalls.lines[n].type&&Math.abs(innerWalls.lines[n].depth-innerWalls.lines[n].point_1.lines[s].depth)<8){e=!1;break}if(!innerWalls.lines[n].isParallel(innerWalls.lines[n].point_1.lines[s])&&!innerWalls.lines[n].isAlmostPerpendicular(innerWalls.lines[n].point_1.lines[s])){e=!1;break}}for(var o in innerWalls.lines[n].point_2.lines)if(innerWalls.lines[n].point_2.lines.hasOwnProperty(o)&&o!==n){if(innerWalls.lines[n].point_2.lines[o].isPillar){i=!0;break}if(innerWalls.lines[n].point_2.lines[o].type===innerWalls.lines[n].type&&Math.abs(innerWalls.lines[n].depth-innerWalls.lines[n].point_2.lines[o].depth)<8){t=!1;break}if(!innerWalls.lines[n].isParallel(innerWalls.lines[n].point_2.lines[o])&&!innerWalls.lines[n].isAlmostPerpendicular(innerWalls.lines[n].point_2.lines[o])){t=!1;break}}i||e&&t&&(innerWalls.lines[n].isPillar=!0,__debugP.step("Pillars.findPillar"))}}}pillarAxis(a){if(void 0===this.count_use_function.x_pillarAxis&&(this.count_use_function.x_pillarAxis=0),500<this.count_use_function.x_pillarAxis++)return __debugP.error("MAX call x_pillarAxis"),!1;for(var h in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(h)&&innerWalls.lines[h].isPillar){let o=[],l=new OuterWall;for(var e in innerWalls.lines[h].point_1.lines)if(innerWalls.lines[h].point_1.lines.hasOwnProperty(e)&&e!==h&&innerWalls.lines[h].point_1.lines[e].isAlmost180Angle(innerWalls.lines[h])&&!1!==(l=innerWalls.lines[h].point_1.lines[e].getCommonOuterLine(innerWalls.lines[h]))){o=this.findWallsForPillarAxis(innerWalls.lines[h],innerWalls.lines[h].point_1);break}let r=[];for(var t in innerWalls.lines[h].point_2.lines)if(innerWalls.lines[h].point_2.lines.hasOwnProperty(t)&&t!==h&&innerWalls.lines[h].point_2.lines[t].isAlmost180Angle(innerWalls.lines[h])&&!1!==(l=innerWalls.lines[h].point_2.lines[t].getCommonOuterLine(innerWalls.lines[h]))){r=this.findWallsForPillarAxis(innerWalls.lines[h],innerWalls.lines[h].point_2);break}if(!1!==l&&l.isValid()){var g=innerWalls.lines[h].getNormal();let e=new Line(l.intersection(g),innerWalls.lines[h].intersection(g));var _,d,g=e.pointOnLine(5);let t=l.getParallel(5),i=l.getParallel(-5),n,s=(n=(t.isPointOnLine(g)?t:i).getBigLine(),{});for(_ in s[h]=innerWalls.lines[h],o)o.hasOwnProperty(_)&&(s[_]=o[_]);for(d in r)r.hasOwnProperty(d)&&(s[d]=r[d]);this.connectionWallsPillarAxis(s,n,5,a)||(innerWalls.lines[h].isPillar=!1),a&&__debugP.step("Pillars.pillarAxis")}}this.pillarAxis1(a),this.pillarAxis2(a)}pillarAxis1(h){if(void 0===this.count_use_function.x_pillarAxis1&&(this.count_use_function.x_pillarAxis1=0),500<this.count_use_function.x_pillarAxis1++)return __debugP.error("MAX call x_pillarAxis1"),!1;for(var g in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(g)&&innerWalls.lines[g].isPillar){let r=new Wall,a=new OuterWall;for(var e in innerWalls.lines[g].point_1.lines)if(innerWalls.lines[g].point_1.lines.hasOwnProperty(e)&&e!==g&&!(r=innerWalls.lines[g].point_1.lines[e]).isAlmost180Angle(innerWalls.lines[g])){for(let i=0;i<r.outerLines.length;i++){let t=!1;for(let e=0;e<innerWalls.lines[g].outerLines.length;e++)if(r.outerLines[i].isCommonPoint(innerWalls.lines[g].outerLines[e])){t=!0;break}if(!t){a=r.outerLines[i];break}}if(!a.isValid())for(let e=0;e<r.outerLines.length;e++)if(innerWalls.lines[g].getBigLine().intersection(r.outerLines[e])){a=r.outerLines[e];break}break}if(a.isValid()){let e=this.findWallsForPillarAxis(r,r.point_1),t=this.findWallsForPillarAxis(r,r.point_2);var _=r.getNormal();let i=new Line(a.intersection(_),r.intersection(_));var d,p,_=i.pointOnLine(5);let n=a.getParallel(5),s=a.getParallel(-5),o,l=(o=(n.isPointOnLine(_)?n:s).getBigLine(),{});for(d in l[r.id]=r,e)e.hasOwnProperty(d)&&(l[d]=e[d]);for(p in t)t.hasOwnProperty(p)&&(l[p]=t[p]);this.connectionWallsPillarAxis(l,o,5,h)||(innerWalls.lines[g].isPillar=!1),__debugP.step("Pillars.pillarAxis1")}}}pillarAxis2(h){if(void 0===this.count_use_function.x_pillarAxis2&&(this.count_use_function.x_pillarAxis2=0),500<this.count_use_function.x_pillarAxis2++)return __debugP.error("MAX call x_pillarAxis2"),!1;for(var g in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(g)&&innerWalls.lines[g].isPillar){let r=new Wall,a=new OuterWall;for(var e in innerWalls.lines[g].point_2.lines)if(innerWalls.lines[g].point_2.lines.hasOwnProperty(e)&&e!==g&&!(r=innerWalls.lines[g].point_2.lines[e]).isAlmost180Angle(innerWalls.lines[g])){for(let i=0;i<r.outerLines.length;i++){let t=!1;for(let e=0;e<innerWalls.lines[g].outerLines.length;e++)r.outerLines[i].isCommonPoint(innerWalls.lines[g].outerLines[e])&&(t=!0);if(!t){a=r.outerLines[i];break}}if(!a.isValid())for(let e=0;e<r.outerLines.length;e++)if(innerWalls.lines[g].getBigLine().intersection(r.outerLines[e])){a=r.outerLines[e];break}break}if(a.isValid()){let e=this.findWallsForPillarAxis(r,r.point_1),t=this.findWallsForPillarAxis(r,r.point_2);var _=r.getNormal();let i=new Line(a.intersection(_),r.intersection(_));var d,p,_=i.pointOnLine(5);let n=a.getParallel(5),s=a.getParallel(-5),o,l=(o=(n.isPointOnLine(_)?n:s).getBigLine(),{});for(d in l[r.id]=r,e)e.hasOwnProperty(d)&&(l[d]=e[d]);for(p in t)t.hasOwnProperty(p)&&(l[p]=t[p]);this.connectionWallsPillarAxis(l,o,5,h)||(innerWalls.lines[g].isPillar=!1),__debugP.step("Pillars.pillarAxis2")}}}findWallsForPillarAxis(t,i,n={}){let s=i.lines;if(!i.isConnected||i.isDock)return n;for(var o in s)if(s.hasOwnProperty(o)){let e=s[o];if(t.id!==e.id&&(t.type,e.type,void 0===n[e.id])){o=t.angleBetween2(e);if((o<2||180<o)&&__debugP.e("!!!!! "+o),178<=o&&o<=182)return t.getCommonOuterLine(e),n[t.id]=t,n[e.id]=e,this.findWallsForPillarAxis(e,e.otherPoint(i),n)}}return n}connectionWallsPillarAxis(o,l,t,e=!1){if(0===Object.keys(o).length)return!0;let i={},r={},a=0;for(var h in o)if(o.hasOwnProperty(h)){let t=l.getPointProjection(o[h].point_1),i=l.getPointProjection(o[h].point_2),n=o[h].point_1.lines,s=o[h].point_2.lines,e=new Line(t,i);var g,_,d,p=new Line(o[h].center(),e.center()),c=(r[h]=[t,i],t.equal(o[h].point_1,1)&&i.equal(o[h].point_2,1)&&a++,new Line(t,i).angleBetween(o[h]));if(!(c<2||178<c))return __debugP.warn("большой угол - pillar"),!1;if(outerWalls.isIntersectionWall(p,[],!0))return __debugP.warn("пересечение линии 0 - pillar"),!1;if(!outerWalls.isIntersectionWall(o[h],[],!0)&&outerWalls.isIntersectionWall(e,[],!0))return __debugP.warn("пересечение линии 1 - pillar"),!1;for(g in n)if(n.hasOwnProperty(g)){let e=new Line(n[g].otherPoint(o[h].point_1),t);if(void 0===o[g]&&!e.equalPoints(1)){var A=n[g].angleBetween(e);if(!(A<2||178<A))return __debugP.warn("большой угол - pillar д",A),!1}if(n[g].isAlmostPerpendicular(o[h]),!outerWalls.isIntersectionWall(n[g],[],!0)&&outerWalls.isIntersectionWall(e,[],!0))return __debugP.warn("пересечение линии 2 - pillar"),!1}for(_ in s)if(s.hasOwnProperty(_)){let e=new Line(s[_].otherPoint(o[h].point_2),i);if(void 0===o[_]&&!e.equalPoints(1)){var u=s[_].angleBetween(e);if(!(u<2||178<u))return __debugP.warn("большой угол - pillar д",u),!1}if(s[_].isAlmostPerpendicular(o[h]),!outerWalls.isIntersectionWall(s[_],[],!0)&&outerWalls.isIntersectionWall(e,[],!0))return __debugP.warn("пересечение линии 3 - pillar"),!1}for(d in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(d)&&void 0===o[d]&&e.isPointOnLine(innerWalls.lines[d].center()))return __debugP.warn("наезд на линию - pillar"),!1}if(!0===e)return!0;for(var n in a,Object.keys(o).length,o)if(o.hasOwnProperty(n)){var s,w,m,f=r[n][0],I=r[n][1],C=innerWalls.findPoint(f,.5,r[n][0]),y=innerWalls.findPoint(I,.5,r[n][1]),b=o[n].getPlaceByLine(l);C&&o[n].point_1.id!==C.id?innerWalls.replacePoint(o[n].point_1.id,C.id):o[n].point_1.set(f);let e=!1;for(s in o[n].point_1.lines)o[n].point_1.lines.hasOwnProperty(s)&&o[n].point_1.lines[s].equalPoints(2)&&(innerWalls.deleteAloneLine(o[n].point_1.lines[s]),n===s&&(e=!0));if(e)__debugP.warn("линия в одной точке 1 - pillar");else{for(var v in y&&o[n].point_2.id!==y.id?innerWalls.replacePoint(o[n].point_2.id,y.id):o[n].point_2.set(I),o[n].point_2.lines)o[n].point_2.lines.hasOwnProperty(v)&&o[n].point_2.lines[v].equalPoints(2)&&(innerWalls.deleteAloneLine(o[n].point_2.lines[v]),n===v&&(e=!0));if(e)__debugP.warn("линия в одной точке 2 - pillar");else for(var x in i[n]=o[n],"outer"===b?(o[n].outerDepth=t,o[n].innerDepth=+(o[n].depth-o[n].outerDepth).toFixed(plannerParser.count_round)):"inner"===b&&(o[n].innerDepth=t,o[n].outerDepth=+(o[n].depth-o[n].innerDepth).toFixed(plannerParser.count_round)),o[n].holes)o[n].holes.hasOwnProperty(x)&&(w=l.getPointProjection(o[n].holes[x].point_1),m=l.getPointProjection(o[n].holes[x].point_2),o[n].holes[x].point_1.set(w),o[n].holes[x].point_2.set(m))}}return innerWalls.reverseWalls(i),!0}prepareWallsForPillar(){let s={};for(var a in innerWalls.lines)if(innerWalls.lines.hasOwnProperty(a)&&innerWalls.lines[a].isPillar){let r=!1,l=!1;for(var o in innerWalls.lines[a].point_1.lines)if(innerWalls.lines[a].point_1.lines.hasOwnProperty(o)&&o!==a&&2===innerWalls.lines[a].outerLines.length&&!innerWalls.lines[a].point_1.lines[o].isAlmost180Angle(innerWalls.lines[a])){let t=innerWalls.lines[a].outerLines[0].getBigLine(),i=innerWalls.lines[a].outerLines[1].getBigLine(),n=t.intersection(innerWalls.lines[a].point_1.lines[o]);if(n=n||i.intersection(innerWalls.lines[a].point_1.lines[o])){let e=new Line(innerWalls.lines[a].point_1.lines[o].otherPoint(innerWalls.lines[a].point_1),n);if(e.equalPoints()){let l;if(l=innerWalls.lines[a].point_1.lines[o].point_1.equal(innerWalls.lines[a].point_1)?innerWalls.lines[a].point_1.lines[o].point_2:innerWalls.lines[a].point_1.lines[o].point_1,s[o]=1,innerWalls.lines[o].point_1.deleteLine(o),innerWalls.lines[o].point_2.deleteLine(o),1!==l.countLines())continue;{let e=l.line();if(e.isAlmost180Angle(innerWalls.lines[a]))continue;let t=innerWalls.lines[a].outerLines[0].getBigLine(),i=innerWalls.lines[a].outerLines[1].getBigLine(),n=t.intersection(e);if(!(n=n||i.intersection(e)))continue;let s=new Line(e.otherPoint(l),n);if(s.equalPoints())continue;let o=s.pointOnLine(s.length()+5);r=!0,innerWalls.findPoint(o)?(o=new PointWall(o.x,o.y),innerWalls.addPoint(o),innerWalls.replacePoint(l.id,o.id),__debugP.error("case 1")):l.set(o),__debugP.step("Pillars.prepareWallsForPillar")}}else{r=!0;var h=e.pointOnLine(e.length()+5),h=new PointWall(h.x,h.y);if(!innerWalls.findPoint(h)){if(innerWalls.addPoint(h),innerWalls.lines[a].point_1.lines[o].setPointById(innerWalls.lines[a].point_1.id,h),innerWalls.lines[o].length()<10){let e=new Wall;(e=(innerWalls.lines[o].point_1.isConnected?innerWalls.lines[o].point_1:innerWalls.lines[o].point_2).getParallelLine(innerWalls.lines[o])).isValid()&&e.depth<innerWalls.lines[o].depth&&(innerWalls.lines[o].depth=e.depth,innerWalls.lines[o].innerDepth=e.innerDepth,innerWalls.lines[o].outerDepth=e.outerDepth)}__debugP.step("Pillars.prepareWallsForPillar")}}}else{h=innerWalls.lines[a].point_1.lines[o].getIncreaseLine(10);if(t.intersection(h)&&i.intersection(h)){var g=new Line(t.intersection(h),i.intersection(h)),_=innerWalls.lines[a].point_1.lines[o].otherPoint(innerWalls.lines[a].point_1),d=new Line(g.point_1,_).length(),p=new Line(g.point_2,_).length();let e;if(e=(d<p?new Line(g.point_1,_):new Line(g.point_2,_)).pointOnLine(5),r=!0,e=new PointWall(e.x,e.y),innerWalls.findPoint(e))continue;innerWalls.addPoint(e),innerWalls.lines[a].point_1.lines[o].setPointById(innerWalls.lines[a].point_1.id,e),__debugP.w("сдвинута стена в колонне 1"),__debugP.step("Pillars.prepareWallsForPillar")}}}for(var c in innerWalls.lines[a].point_2.lines)if(innerWalls.lines[a].point_2.lines.hasOwnProperty(c)&&c!==a&&2===innerWalls.lines[a].outerLines.length&&!innerWalls.lines[a].point_2.lines[c].isAlmost180Angle(innerWalls.lines[a])){let t=innerWalls.lines[a].outerLines[0].getBigLine(),i=innerWalls.lines[a].outerLines[1].getBigLine(),n=t.intersection(innerWalls.lines[a].point_2.lines[c]);if(n=n||i.intersection(innerWalls.lines[a].point_2.lines[c])){let e=new Line(innerWalls.lines[a].point_2.lines[c].otherPoint(innerWalls.lines[a].point_2),n);if(e.equalPoints()){let o;if(o=innerWalls.lines[a].point_2.lines[c].point_1.equal(innerWalls.lines[a].point_2)?innerWalls.lines[a].point_2.lines[c].point_2:innerWalls.lines[a].point_2.lines[c].point_1,s[c]=1,innerWalls.lines[c].point_1.deleteLine(c),innerWalls.lines[c].point_2.deleteLine(c),1!==o.countLines())continue;{let e=o.line();if(e.isAlmost180Angle(innerWalls.lines[a]))continue;let t=innerWalls.lines[a].outerLines[0].getBigLine(),i=innerWalls.lines[a].outerLines[1].getBigLine(),n=t.intersection(e);if(!(n=n||i.intersection(e)))continue;let s=new Line(e.otherPoint(o),n);if(s.equalPoints())continue;var A=s.pointOnLine(s.length()+5);l=!0,o.set(A),innerWalls.findPoint(o)&&(innerWalls.replacePoint(o.id,innerWalls.findPoint(o).id),__debugP.error("case 1")),__debugP.step("Pillars.prepareWallsForPillar")}}else{l=!0;A=e.pointOnLine(e.length()+5),A=new PointWall(A.x,A.y);if(!innerWalls.findPoint(A)){if(innerWalls.addPoint(A),innerWalls.lines[a].point_2.lines[c].setPointById(innerWalls.lines[a].point_2.id,A),innerWalls.lines[c].length()<10){let e=new Wall;(e=(innerWalls.lines[c].point_1.isConnected?innerWalls.lines[c].point_1:innerWalls.lines[c].point_2).getParallelLine(innerWalls.lines[c])).isValid()&&e.depth<innerWalls.lines[c].depth&&(innerWalls.lines[c].depth=e.depth,innerWalls.lines[c].innerDepth=e.innerDepth,innerWalls.lines[c].outerDepth=e.outerDepth)}__debugP.step("Pillars.prepareWallsForPillar")}}}else{var u=innerWalls.lines[a].point_2.lines[c].getIncreaseLine(10);if(t.intersection(u)&&i.intersection(u)){var u=new Line(t.intersection(u),i.intersection(u)),w=innerWalls.lines[a].point_2.lines[c].otherPoint(innerWalls.lines[a].point_2),m=new Line(u.point_1,w).length(),f=new Line(u.point_2,w).length();let e;if(e=(m<f?new Line(u.point_1,w):new Line(u.point_2,w)).pointOnLine(5),l=!0,e=new PointWall(e.x,e.y),innerWalls.findPoint(e))continue;innerWalls.addPoint(e),innerWalls.lines[a].point_2.lines[c].setPointById(innerWalls.lines[a].point_2.id,e),__debugP.w("сдвинута стена в колонне 2"),__debugP.step("Pillars.prepareWallsForPillar")}}}if(r){if(1===innerWalls.lines[a].point_1.countLines()){let e=new Line(innerWalls.lines[a].point_2,innerWalls.lines[a].point_1);var t=e.pointOnLine(e.length()+5);innerWalls.lines[a].point_1.set(t),innerWalls.findPoint(innerWalls.lines[a].point_1)&&(innerWalls.replacePoint(innerWalls.lines[a].point_1.id,innerWalls.findPoint(innerWalls.lines[a].point_1).id),__debugP.error("case 2"))}else{let e=new Line(innerWalls.lines[a].point_2,innerWalls.lines[a].point_1),t=e.pointOnLine(e.length()+5);t=new PointWall(t.x,t.y),innerWalls.findPoint(t)?t=innerWalls.findPoint(t):innerWalls.addPoint(t),innerWalls.lines[a].setPointById(innerWalls.lines[a].point_1.id,t)}__debugP.step("Pillars.prepareWallsForPillar")}if(l){if(1===Object.keys(innerWalls.lines[a].point_2.lines).length){let e=new Line(innerWalls.lines[a].point_1,innerWalls.lines[a].point_2);t=e.pointOnLine(e.length()+5);innerWalls.lines[a].point_2.set(t),innerWalls.findPoint(innerWalls.lines[a].point_2)&&(innerWalls.replacePoint(innerWalls.lines[a].point_2.id,innerWalls.findPoint(innerWalls.lines[a].point_2).id),__debugP.error("case 2"))}else{let e=new Line(innerWalls.lines[a].point_1,innerWalls.lines[a].point_2),t=e.pointOnLine(e.length()+5);t=new PointWall(t.x,t.y),innerWalls.findPoint(t)?t=innerWalls.findPoint(t):innerWalls.addPoint(t),innerWalls.lines[a].setPointById(innerWalls.lines[a].point_2.id,t)}__debugP.step("Pillars.prepareWallsForPillar")}for(var i in innerWalls.lines[a].point_1.lines)if(innerWalls.lines[a].point_1.lines.hasOwnProperty(i)&&i!==a&&innerWalls.lines[a].point_1.lines[i].isAlmost180Angle(innerWalls.lines[a])){let e=new Line(innerWalls.lines[a].point_1.lines[i].otherPoint(innerWalls.lines[a].point_1),innerWalls.lines[a].point_1);var n=e.pointOnLine(e.length()+5);let t=new PointWall(n.x,n.y);innerWalls.findPoint(t)?t=innerWalls.findPoint(t):innerWalls.addPoint(t),innerWalls.lines[a].point_1.lines[i].setPointById(innerWalls.lines[a].point_1.id,t),__debugP.step("Pillars.prepareWallsForPillar")}for(var I in innerWalls.lines[a].point_2.lines)if(innerWalls.lines[a].point_2.lines.hasOwnProperty(I)&&I!==a&&innerWalls.lines[a].point_2.lines[I].isAlmost180Angle(innerWalls.lines[a])){let e=new Line(innerWalls.lines[a].point_2.lines[I].otherPoint(innerWalls.lines[a].point_2),innerWalls.lines[a].point_2);var C=e.pointOnLine(e.length()+5);let t=new PointWall(C.x,C.y);innerWalls.findPoint(t)?t=innerWalls.findPoint(t):innerWalls.addPoint(t),innerWalls.lines[a].point_2.lines[I].setPointById(innerWalls.lines[a].point_2.id,t),__debugP.step("Pillars.prepareWallsForPillar")}innerWalls.lines[a].centerPillar=innerWalls.lines[a].center();var y=innerWalls.lines[a].getNormal();if(2===innerWalls.lines[a].outerLines.length){let e=new Line(innerWalls.lines[a].outerLines[0].getBigLine().intersection(y),innerWalls.lines[a].outerLines[1].getBigLine().intersection(y));__debugP.error("толщина",Math.round(e.length()),innerWalls.lines[a].length(),innerWalls.lines[a].depth),innerWalls.lines[a].depth=Math.round(e.length()),5==innerWalls.lines[a].innerDepth?innerWalls.lines[a].outerDepth=innerWalls.lines[a].depth-innerWalls.lines[a].innerDepth:5==innerWalls.lines[a].outerDepth&&(innerWalls.lines[a].innerDepth=innerWalls.lines[a].depth-innerWalls.lines[a].outerDepth);y=e.center();isNaN(y.x)||isNaN(y.y)||(innerWalls.lines[a].centerPillar=e.center())}}for(var e in s)s.hasOwnProperty(e)&&(__debugP.error("удалённая линия",s[e]),innerWalls.deleteLine(e),__debugP.step("Pillars.prepareWallsForPillar"))}}let innerWalls=new InnerWalls,innerWallsFunctions=new InnerWallsFunctions,outerWalls=new OuterWalls,outerWallsFunctions=new OuterWallsFunctions,holes=new Holes,holesFunctions=new HolesFunctions,parserWalls=new ParserWalls,parserWallsFunctions=new ParserWallsFunctions,pillarsFunctions=new PillarsFunctions,autoParser=new AutoParser,plannerCanvas,plannerParser,parserClick;var __debugP=new DebugParser;function toDataURL(e,t){let i=new XMLHttpRequest;i.onload=function(){let e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(i.response)},i.open("GET",e),i.responseType="blob",i.send()}const uuid=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16));function in_array(e,t,i=!1){let n=!1;for(var s in i=!!i,t)if(t.hasOwnProperty(s)&&(i&&t[s]===e||!i&&t[s]==e)){n=!0;break}return n}function getMaxKey(e){let t=Object.keys(e);return t.sort((e,t)=>e-t).reverse(),0<t.length?t[0]:0}function getMinKey(e){let t=Object.keys(e);return t.sort((e,t)=>e-t),0<t.length?t[0]:0}function send_saveload_error(e,t,i,n,s){let o={};o.is_load="load"==n?1:0,o.attempts_count=s,o.object_id=e,o.error_code=t.status,o.error_text=JSON.stringify(t),o.json_data=i||"",o.session=window.global_session,o.version=window.global_version,o.save_id=window.save_counter,$.ajax({url:"/setup/api/saveload_error/",cache:!1,dataType:"html",timeout:15e3,data:JSON.stringify(o),contentType:"application/json",dataType:"json",type:"POST",complete:function(e,t){}})}function send_warning_signal(e,t,i=null,n=null,s=0,o=""){try{n=n||$("body").attr("data-object-id"),i=null!==i?i:1,$.ajax({url:"/setup/api/warning_signal/",timeout:15e3,data:{object_id:n,text:t,type:e,level:i,save_plan:s,session:window.global_session,version:window.global_version,save_id:window.save_counter,trace:o.join("\n")},type:"POST"})}catch(e){}}function send_warning_signal_after_saving_project(e,t,i=null,n=null,s=0,o=""){try{windows.warning_signals_after_saving=windows.warning_signals_after_saving||{},windows.warning_signals_after_saving[CryptoJS.MD5(t)]={object_id:n||$("body").attr("data-object-id"),text:t,type:e,level:i,save_plan:s,trace:o||convert_trace((new Error).stack,1)}}catch(e){}}function save_warning_signal_after_saving_project(){try{if(windows.warning_signals_after_saving)for(var e in windows.warning_signals_after_saving){var t;windows.warning_signals_after_saving.hasOwnProperty(e)&&(send_warning_signal((t=windows.warning_signals_after_saving[e]).type,t.text,t.level,t.object_id,t.save_plan,t.trace),delete windows.warning_signals_after_saving[e])}}catch(e){}}function send_warning_signals(t,i,n,s=null,o=0,l=1){try{let e=convert_trace((new Error).stack,1);windows.warning_signals=windows.warning_signals||{},windows.warning_signals_timers=windows.warning_signals_timers||{},windows.warning_signals[i]=windows.warning_signals[i]||[],n&&windows.warning_signals[i].push(n),windows.warning_signals_timers[i]&&(clearTimeout(windows.warning_signals_timers[i]),delete windows.warning_signals_timers[i]),windows.warning_signals_timers[i]=setTimeout(function(){2===l?send_warning_signal_after_saving_project(t,i+windows.warning_signals[i].join(", "),s,null,o,e):1===l&&send_warning_signal(t,i+windows.warning_signals[i].join(", "),s,null,o,e),delete windows.warning_signals[i],delete windows.warning_signals_timers[i]},3e3)}catch(e){}}window.project={},window.disable_autosave=!1,window.load_attempts_count=0,window.load_timeout=15,window.save_timeout=30,window.l10n||(window.l10n={}),$(document).ready(function(e){project.load=function(e,t,i,n){var s;"server"===e&&($("#fog").show(),$("#fog_message").text(l10n.uploading_project),$.ajax({type:"GET",cache:!1,url:"/setup/api/planner/?object_id="+$("body").attr("data-object-id"),data:"",contentType:"application/json",dataType:"json",success:function(e){if(console.warn("Project loaded successfully"),tools=window.global_tools,save_counter=e.save_id,console.log("Loaded with save_id "+save_counter),LogItems.bad_item_removed=[],""!==e.data){try{var t=JSON.parse(e.data);window.log_plan.wall1=t&&t.walls&&t.walls?t.walls.length:0,window.log_plan.items1=t&&t.items&&t.items?t.items.length:0}catch(e){window.log_plan.break_json=1}project.JSON=e.data,project.restore(JSON.parse(e.data)),project.focus(!1,!0),project.draw()}try{window.log_plan.wall2=walls&&walls.db&&walls.db.length?walls.db.length:0,window.log_plan.items2=items&&items.db&&items.db.length?items.db.length:0}catch(e){}LogItems.start(),project_loaded=!0,$("#fog").hide(),$("#fog_message").text(""),1==e.chat_new_messages&&$("#jivo_custom_widget").length&&planner_chat_open(),e.direct&&$("#planner_ui_direct").length&&planner_direct_init(e.direct),project.localSave(),"init"===plan&&0===walls.db.length&&($("#plannertool_wall").addClass("active"),tool="wall",tool_group="walls")},error:function(e){$("#fog").hide(),$("#fog_message").text(""),console.log(e),send_saveload_error($("body").attr("data-object-id"),e,!1,"load",load_attempts_count),0==load_attempts_count||1==load_attempts_count?(load_attempts_count++,window.load_timeout=window.load_timeout+15,project.load("server")):load_v2_modal_from_id("data_not_loaded")},timeout:1e3*window.load_timeout})),"local"===e&&(console.warn("--- Local Load "+copy_counter+" ---"),(e=JSON.parse(storage[copy_counter]))&&e.walls&&0<e.walls.length&&(project.delete("partially"),s=plan=e.plan,s=rename_plan(s),plan_group=e.plan_group,project.restore(e,!0),e=e.viewbox,svg.viewbox({x:e.x,y:e.y,width:e.width,height:e.height,zoom:e.zoom}),click_on_navi_group(s),change_group(s),grid.update(),LogItems.save_action("",i+" - "+copy_counter,storage[n]),t&&t()))};let a=0;function n(e=""){var e={plan:project.copy(),visual:e},e=JSON.stringify(e),t=get_current_date(),i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download","Remplanner #"+$("body").attr("data-object-id")+" "+t+".plan"),document.createEvent?((e=document.createEvent("MouseEvents")).initEvent("click",!0,!0),i.dispatchEvent(e)):i.click()}project.save=function(e,n,s,o){if(console.warn("--- Global Save ---"),save_icon_clicked=0,2===n&&(n=!0,save_icon_clicked=1),income_params=e,income_is_forced=n,!$("body").attr("data-authkey")||$("#save_v2_plan").hasClass("guest_mode")||!0===disable_autosave&&!0!==n)return e&&!0===e.exit&&(window.location=e.url),!0;if($("#save_v2_plan").hasClass("loading"))return!0;$("#save_v2_plan").addClass("loading"),!0===n&&(console.log("show fog before ajax for forced save"),$("#fog").show(),$("#fog_message").show(),window.disable_autosave=!1),s&&$("#fog_message").text(s);var t,s=plan;plan="build",project.draw(),rooms2.get_walls_info();for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.isEntrance()}let l=JSON.stringify(project.copy("server"));for(t in project.errors)project.errors[t]=0;if(plan=s,project.draw(),project.JSON!==l||!0===n){try{JSON.parse(l)}catch(e){send_warning_signals(signal_types[13],"Сломанный текущий json: ",e.message,1,0)}try{JSON.parse(project.JSON)}catch(e){s=1===window.log_plan.break_json?" (изначально он был сломан)":"";send_warning_signals(signal_types[13],"Сломанный прошлый json"+s+" ("+window.log_plan.counter_saving_one_session+"): ",e.message,1,0)}let t=copy.object(project.JSON),i=(project.JSON=l,console.warn("starting save proccess..."),current_save_timeout=window.save_timeout,1!=a&&!0!==n||(current_save_timeout*=2),convert_trace((new Error).stack));s=copy.object(l);try{let t=JSON.parse(s);var r=["walls","pillars","sectors","rooms2","windows","doors","items","led_strips","cables","pipes","pipes_conditioner","cables_conditioner","pipes_heat","cables_socket","cables_warm_floor","comments","rulers","questions","freelines","drawings","total_height","errors","drawing","session","version","log_plan","final","borders"];let i=[];for(let e=0;e<r.length;e++)t.hasOwnProperty(r[e])||i.push(r[e]);0<i.length&&send_warning_signals(signal_types[19],"Неполный JSON "+$("body").attr("data-object-id")+": ",JSON.stringify(i),1,1)}catch(e){send_warning_signals(signal_types[13],"Сломанный текущий json 2: ",e.message,1,0)}$.ajax({type:"POST",url:"/setup/api/planner/save/?object_id="+$("body").attr("data-object-id")+"&plan="+plan+"&authkey="+$("body").attr("data-authkey")+"&save_id="+save_counter+"&is_resave="+a+"&is_forced="+save_icon_clicked,data:{plan_length:l.length,session:window.global_session,version:window.global_version,save_id:window.save_counter,visual_data:o,plan_data:l},dataType:"json",success:function(e){console.log("save success method, save_id from "+save_counter+" to "+e.save_id),LogItems.send_to_server(t,l,save_counter,e.save_id,i),window.log_plan.counter_saving_one_session++,save_counter=e.save_id,LogItems.start(),setTimeout(function(){a=0,$("#save_v2_plan").removeClass("loading").removeClass("alert"),$("#save_v2_plan").addClass("active"),"success"==e.result?(console.warn("Проект сохранен"),1==e.chat_new_messages&&$("#jivo_custom_widget").length&&planner_chat_open(),e.direct&&$("#planner_ui_direct").length&&planner_direct_init(e.direct),e.is_failed&&warning.show("red","<b>"+l10n.not_save_empty_plan+"</b><br>"+l10n.draw_least_one_wall)):e.html_code?(console.warn("Системное уведомление при сохранении"),$("#fog").show(),$("#fog").addClass("done"),$("#fog").append(e.html_code)):(console.warn("Не обработанное сохранение"),console.log(e))},250)},beforeSend:function(){console.log("save beforeSend method with timeout "+current_save_timeout),e&&!0===e.exit||($("#fog").hide(),$("#fog_message").text(""),console.log("hiding fog before ajax..."))},complete:function(){if(console.log("save complete method"),$("#save_v2_plan").removeClass("loading"),e&&!0===e.exit)return window.location=e.url,!0},error:function(e){$("#save_v2_plan").removeClass("loading"),console.log("save error method"),console.log(e),a=1,send_saveload_error($("body").attr("data-object-id"),e,l,"save",0)},timeout:1e3*current_save_timeout}),save_warning_signal_after_saving_project()}else console.warn("Проект уже был сохранен"),e&&!0===e.exit&&(window.location=e.url),$("#save_v2_plan").removeClass("loading").removeClass("alert"),$("#save_v2_plan").addClass("active"),$("#fog").hasClass("sticky")||($("#fog").hide(),$("#fog_message").text(""));window.seconds_since_last_save=0,walls.get_axis_lines(),$("#furniture_switch").addClass("active"),$("#sockets_switch").removeClass("active")},project.save_as_file=function(){console.log("save as file start..."),$.ajax({type:"GET",url:"/setup/api/planner/load_visual/",data:{object_id:$("body").attr("data-object-id"),authkey:$("body").attr("data-authkey")},dataType:"json",success:function(e){n(e),console.log("save 2d & 3d as file end...")},error:function(e,t,i){n(),console.log("save 2d as file end...")},timeout:1e4})},$("#saveload_ext").click(function(e){$(this).toggleClass("active")}),$("#planner_ui_functions").mouseleave(function(e){$("#saveload_ext").removeClass("active")}),$("#save_as_file").click(function(e){$("#saveload_ext").removeClass("active"),$("#saveload_ext").addClass("loading"),project.save_as_file(),setTimeout(function(){$("#saveload_ext").removeClass("loading")},100)}),$("#load_from_file").on("click",function(){$("#load_from_file_input input").click()}),$("#load_from_file_input input").on("change",function(){$("#saveload_ext").addClass("loading"),setTimeout(function(){var e=$("#load_from_file_input input")[0].files[0],t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=function(e){let t="";try{t=JSON.parse(e.target.result),console.warn(t)}catch(e){warning.show("red",l10n.this_file_not_load,3e3),t=!1,$("#saveload_ext").removeClass("loading")}var i;t&&(e=void 0!==t.plan?t.plan:t,i=void 0!==t.visual?t.visual:"",LogItems.bad_item_removed=[],project.delete(),project.restore(e),project.draw(),LogItems.start(),LogItems.was_file_load=!0,project.focus(),project.save("","","",i?JSON.stringify(i):""),project.localSave()),$("#saveload_ext").removeClass("loading")},t.onerror=function(e){warning.show("red",l10n.failed_load_file,3e3),$("#saveload_ext").removeClass("loading")}},100)})}),window.walls={},window.plan="none",window.plan_group="none",window.plan_previous=void 0,window.tool="none",window.tool2="none",window.tool_group="none",window.tool_save=null,window.tools={},window.scale_recognition_rect_tool=null,window.scale_recognition_line_tool=null,window.image_rotate=0,window.baselines={},window.tmp={},window.signs={},window.layers={},window.window_custom_options=!1,window.door_custom_options=!1,window.seconds_since_last_save=0,window.magnet_distance=15,window.item_resizing=!1,window.save_counter=0,window.background_image_loaded=!1,window.rename_plan=function(e){return"break_walls"===e?"break":"break"===e?"break_walls":"create_walls"===e?"build":"build"===e?"create_walls":"waterplan"===e?"water":"water"===e?"waterplan":"shtukaturka"===e?"plaster":"plaster"===e?"shtukaturka":"styazhka"===e?"floor_cap":"floor_cap"===e?"styazhka":e},window.selected={};const page_formats={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]},plan_names=[{ru:"Исходный план",sys:"init",print:!1},{ru:"Демонтаж",sys:"break",print:!1},{ru:"Перегородки",sys:"build",print:!1},{ru:"Помещения",sys:"rooms",print:!1},{ru:"Отопление",sys:"radiators",print:!1},{ru:"Мебель",sys:"furniture",print:!1},{ru:"Сантехника",sys:"santeh",print:!1},{ru:"Водоснабжение",sys:"water",print:!1},{ru:"Розетки",sys:"sockets",print:!1},{ru:"Освещение",sys:"light",print:!1},{ru:"Выключатели",sys:"light_connections",print:!1},{ru:"Теплые полы",sys:"warm_floor",print:!1},{ru:"Кондиционеры",sys:"conditioners",print:!1},{ru:"Электропроводка",sys:"cables",print:!1},{ru:"Напольные покрытия",sys:"floor",print:!1},{ru:"Отделка стен",sys:"walls",print:!1},{ru:"Потолки",sys:"ceiling",print:!1},{ru:"Гидроизоляция",sys:"hydroisolation",print:!1},{ru:"Звукоизоляция",sys:"isolation",print:!1},{ru:"Штукатурка",sys:"plaster",print:!1},{ru:"Стяжка",sys:"floor_cap",print:!1}],outer_room_items=($(document).ready(function(e){plan_names.forEach(e=>{let t=$('.groups_navi_item[data-plan="'+rename_plan(e.sys)+'"]');var i=t.text().trim();i&&(e.ru=i)})}),window.plansForFurniture=["init","build","radiators","santeh","sockets","light","light_connections","warm_floor","conditioners","cables"],window.plansForSockets=["light","furniture","santeh","build","radiators"],["conditioner_engine","external_block_multisplit","porch"]);let something={selected:!(window.objectIndexById=function(t,i){for(let e=0;e<t.length;e++)if(t[e].id===i)return e}),moving:!1},sub_plan,material,cursor,cursor_group,helpers,arrow,walls,pillars,sectors,windows,doors,rooms;window.items={},window.comments={},window.s_size=void 0,window.socketsSwitch={},window.furnitureSwitch={},window.dimensionsSwitch={};let reset,hide,visibility,selected,allow,s_stop,e_stop,income_is_forced,income_params,params={total_height:270},defs={wall:{min_length:20,max_length:5e3,height:270,depth:10,min_depth:8,max_depth:100,material:"bricks"},sector:{min_length:8},room:{min_height:270,height:270},pillar:{width:20,height:20,min_width:15,min_height:15,max_width:2e3,max_height:600},pillar_air:{width:30,height:30,min_width:15,min_height:15,max_width:200,max_height:200},pillar_water:{width:20,height:20,min_width:15,min_height:15,max_width:20,max_height:20},gypsum_box:{min_width:10,width:70,max_width:500,min_height:10,height:20,max_height:500},window:{width:120,min_width:40,max_width:600,height:150,floor_height:85,depth:6,slopes:20},windoor:{door:{width_min:50,width_max:120},window:{width_min:50,width_max:400},window_width:100,window_height:150,door_width:80,door_min_width:60,door_height:210,depth:6,slopes:20},door:{width:80,min_width:50,max_width:600,height:210,depth:4},door_double:{width:120,min_width:100,max_width:600,height:210,depth:4},door_coupe:{width:80,min_width:50,max_width:600,height:210,depth:4},door_penal:{width:80,min_width:50,max_width:600,height:210,depth:4},doorway:{width:80,min_width:50,max_width:600,height:210,depth:4},socket:{height:30},ceiling_niche:{depth:20},complex_ceiling:{offset:40,radius:10},cable:{},pipe:{}};function compare_distance(e,t){return e.distance-t.distance}function get_point_near_line_end(e,t,i,n){var s=get_distance(e,t);return"R"===n?{x:t.x-(t.y-e.y)*i/s,y:t.y+(t.x-e.x)*i/s}:"L"===n?{x:t.x+(t.y-e.y)*i/s,y:t.y-(t.x-e.x)*i/s}:void 0}function are_points_equal(e,t,i=.5){return Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i}function are_lines_equal(e,t){var i=are_points_equal(e.s,t.s)&&are_points_equal(e.e,t.e),e=are_points_equal(e.s,t.e)&&are_points_equal(e.e,t.s);return i||e}function sort_points_by_distance(t,i){for(let e=0;e<i.length;e++){var n=i[e],s=get_distance(n,t);i[e]={xy:n,distance:s}}i.sort(compare_distance);for(let e=0;e<i.length-1;e++)0===get_distance(i[e].xy,i[e+1].xy)&&(i.splice(e,1),e--);for(let e=0;e<i.length;e++)i[e]=i[e].xy;return i}function get_wall_index(t){for(let e=0;e<walls.db.length;e++)if(walls.db[e].id===t)return e}function are_lines_connected(e,t){return!!are_points_equal(e.s,t.s)||(!!are_points_equal(e.s,t.e)||(!!are_points_equal(e.e,t.s)||!!are_points_equal(e.e,t.e)))}function get_print_position(e,t){let i=1;(e.width>t.width||e.height>t.height)&&(n=t.width/e.width,s=t.height/e.height,i=n<s?n:s);var n=-e.center.x*i,s=-e.center.y*i;return{xOffset:n+t.center.x,yOffset:s+t.center.y,scale:i}}function preplan_scale___(e){if(console.log(e),1==e&&(scale_recognition_rect_tool.fire("delete"),scale_recognition_line_tool.fire("delete")),4==e){if($("#preplan_scale").hasClass("show_step3")){if(""==$("#preplan_scale .step3 input").val())return!1}else if(""==$("#preplan_scale .step2 input").val())return!1;scale_recognition_rect_tool.fire("delete"),scale_recognition_line_tool.fire("delete");var t=$("#preplan_scale .step2 input").val();scale_recognition_rect_tool.fire("recognize",{value:t})}if(5==e){if($("#preplan_scale").hasClass("show_step3")){if(""==$("#preplan_scale .step3 input").val())return!1}else if(""==$("#preplan_scale .step2 input").val())return!1;scale_recognition_rect_tool.fire("delete"),scale_recognition_line_tool.fire("delete");t=$("#preplan_scale .step3 input").val();scale_recognition_line_tool.fire("recognize",{value:t})}if($("#preplan_scale").removeClass("show_step2").removeClass("show_step3").removeClass("show_step4"),4==e&&2==$("#preplan_scale").prop("data-type"))return open_help_window("init_instructions");1<e&&$("#preplan_scale").addClass("show_step"+e),1===e&&project.background.fire("reset"),2===e&&scale_recognition_rect_tool.fire("init"),3===e&&scale_recognition_line_tool.fire("init")}function preplan_scale(e){if(1==e&&(scale_recognition_rect_tool.fire("delete"),scale_recognition_line_tool.fire("delete"),project.background.fire("reset")),2===e&&scale_recognition_rect_tool.fire("init"),3===e&&scale_recognition_line_tool.fire("init"),4==e&&$("#preplan_scale").hasClass("show_step2")){var t=$("#preplan_scale .step2 input").val();if(""==t)return!1;scale_recognition_rect_tool.fire("recognize",{value:t})}if(5==e&&$("#preplan_scale").hasClass("show_step3")){t=$("#preplan_scale .step3 input").val();if(""==t)return!1;scale_recognition_line_tool.fire("recognize",{value:t})}if($("#preplan_scale").removeClass("show_step2").removeClass("show_step3").removeClass("show_step4"),4<=e&&2==$("#preplan_scale").prop("data-type"))return $("#canvas_v2_wrapper").addClass("background_mode_active"),background_mode_signal(),close_help_window();1<e&&$("#preplan_scale").addClass("show_step"+e),4!=e&&5!=e||$("#preplan_scale").addClass("show_step4")}function preplan_scale_close(){$("#preplan_scale").removeClass("active").removeClass("show_step4")}function load_preplan_image(){$("#footer_bar_content .footer_bar_banner_start_button").addClass("loading"),$("#footer_bar_content .footer_bar_banner_start_button").removeClass("loading"),$("#footer_bar_content .footer_bar_banner_start_button").addClass("active")}function clear_preplan_image(){$("#footer_bar_content .footer_bar_banner_start_button").removeClass("active"),$("#footer_bar_content .footer_bar_banner_start_button").addClass("loading"),$("#footer_bar_content .footer_bar_banner_start_button").removeClass("loading")}function start_preplan_step(e){if(!$("#footer_bar_content .footer_bar_banner_start_button").hasClass("active"))return $("#footer_bar_content .step_"+e+"_error").addClass("expandUp"),!1;if($("#footer_bar_content .step_1_error, #footer_bar_content .step_1_error").removeClass("expandUp"),1==e)open_help_window("preplan_scale"),close_footer_bar();else{if(2!=e)return!0;$("#preplan_scale").prop("data-type","2"),open_help_window("preplan_scale"),close_footer_bar()}}$(document).ready(function(d){function e(t,i,e){return e&&1!==e?2===e?svg.pattern(8,8,function(e){e.rect(8,8).attr({fill:"transparent"}),e.path("M-1,1 l2,-2 M0,8 l8,-8 M7,9 l2,-2").attr({"stroke-width":.2,stroke:t})}).addClass("Pattern"):"bar"===e?svg.pattern(10,10,function(e){e.path("M7.5,9.5h-5v-9h5V9.5z").attr({"stroke-width":1,stroke:t,fill:"none"})}).addClass("Pattern"):void 0:svg.pattern(4,4,function(e){e.rect(4,4).attr({fill:i}),e.path("M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr({"stroke-width":.6,stroke:t})}).addClass("Pattern")}window.images={delimiters:{},ventHoles:{},roomDimensions:{},rooms:{}},window.sysCursor=function(e){return LIB.point(e.clientX,e.clientY,"svg")},$(document).keydown(function(e){function t(){"wall"===selectedObject&&id.wall&&$('#wall-contextmenu [action="delete"]').trigger("click"),"pillar"===selectedObject&&id.pillar&&$('#pillar_contextmenu [action="delete"]').trigger("click"),"item"===selectedObject&&selected.item&&$('#furniture-contextmenu [action="delete"]').trigger("click"),"ruler"===selectedObject&&id.ruler&&$('#ruler_contextmenu [action="delete"]').trigger("click"),"comment"===selectedObject&&isContextmenuHidden()&&id.comment&&$('#comment_contextmenu [action="delete"]').trigger("click"),"ventHole"===selectedObject&&isContextmenuHidden()&&id.ventHole&&($('#vent_hole_contextmenu [action="delete"]').trigger("click"),r={}),selectedObject=!1}if(e.ctrlKey||e.metaKey){if(83==e.which)return e.preventDefault(),e.stopPropagation(),0!==copy_counter&&(console.warn("save, CMD+S"),$("#save_v2_plan").trigger("click")),!1;if(90==e.which)return e.shiftKey?(e.preventDefault(),e.stopPropagation(),copy_counter!==copy_counter_max_value&&(console.warn("redo, CMD+SHIFT+Z"),$("#redo").trigger("click"))):(e.preventDefault(),e.stopPropagation(),0<copy_counter&&($("#undo").trigger("click"),console.warn("undo, CMD+Z"))),!1;var i;67==e.which&&(console.warn("copy, CMD+C, Ctrl+C"),"furniture"!==plan&&"santeh"!==plan||id.item&&($('#furniture-contextmenu [action="copy"]').trigger("click"),i=items.db[items.db.length-1],id.item=i.props.id)),isContextmenuHidden()&&8==e.which&&(console.warn("WORKING"),t())}isContextmenuHidden()&&46==e.which&&t()}),window.hatch={},hatch.grey=e("#a5a5a5","#ffffff"),hatch.pillar=e("#222222","#f4f4f4"),hatch.green=e("#148515","#ffffff"),hatch.blue=e("#106fc6","#ffffff"),hatch.crimson=e("#dc143c","#ffffff"),hatch.crimson_2=e("#dc143c","#ffffff",2),hatch.yellow=e("yellow","#ffffff"),hatch.orange=e("#e48423","#ffffff"),hatch.pgb=e("#106fc6","#ffffff"),hatch.block=e("#32a28b","#ffffff"),hatch.brick=e("#fd7951","#ffffff"),hatch.gypsum=e("#ba70cd","#ffffff"),hatch.glass=e("#4290FF","#EDF9FD"),hatch.bar=e("brown","none","bar"),window.oldHide=function(){if($("body").css("cursor","default"),$(".contextmenu").hide(50),warning.hide(),console.warn("selectedObject",selectedObject),project.paint(),selectedObject=!1,console.warn("selectedVentHole",r),r.wall){let e=r.wall;var t=r.index;delete e.ventHoles[t].selected,e.draw()}if(o_sign.fire("hide"),s_size.fire("hide"),e_size.fire("hide"),selected.wallPoint=null,id.item=null,pointJoystick.fire("off"),pillarControls.fire("off"),itemControls.fire("off"),"wall_split"===tool&&(tool="none"),close_footer_bar(),items.paint(),manager_lining.paint(),wallControls.fire("off"),doorControl.fire("off"),windowControl.fire("off"),P(),layers.upper.clear(),selected.wallPoint=null,z.stop.hide(),me.hide(),fe.hide(),pillarGuidlines.fire("off"),"build"===plan&&id.room){let e=get_object(rooms2.data,id.room);e&&e.draw()}M={},"moving"===tool&&(tool="none"),rooms2.draw()},window.newHide=function(){if($("body").css("cursor","default"),$(".contextmenu").hide(50),warning.hide(),project.paint(),selectedObject=!1,r.wall){let e=r.wall;var t=r.index;t&&(delete e.ventHoles[t].selected,e.draw())}manager_lining.paint(),freelines.paint(),rooms2.draw(),wallControls.fire("off"),pillarControls.fire("off"),doorControl.fire("off"),windowControl.fire("off"),itemControls.fire("off"),freelineControl.fire("off"),pointJoystick.fire("off"),layers.upper.clear(),selected.wallPoint=null,"moving"===tool&&(tool="none")},window.hide2={contextmenu:function(){$(".contextmenu").hide(50),allow.pan=!0,mode="free"}},window.joystick=$("#joystick").on("mouseover",function(){wall_magnet.hide()}),window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser."),$("body").on("contextmenu",function(){if($("body").css("cursor","default"),z.crosshair.clear(),isContextmenuHidden()&&cursors.own.fire("off"),"floor"===plan)for(let e=0;e<rooms2.data.length;e++){let t=rooms2.data[e];for(let e=0;e<t.floorMoldings.length;e++){var i=t.floorMoldings[e];!0===i.exist?t.demolines[e].IMAGE.attr({stroke:i.color,"stroke-dasharray":"none"}):t.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}}if("walls"===plan)for(let e=0;e<rooms2.data.length;e++){let t=rooms2.data[e];for(let e=0;e<t.decor.length;e++){var n=t.decor[e];!0===n.exist?t.demolines[e].IMAGE.attr({stroke:n.color,"stroke-dasharray":"none"}):t.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}}if("isolation"===plan)for(let e=0;e<rooms2.data.length;e++){let t=rooms2.data[e];for(let e=0;e<t.isolation.length;e++){var s=t.isolation[e];!0===s.exist?t.demolines[e].IMAGE.attr({stroke:s.color,"stroke-dasharray":"none"}):t.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}}if("plaster"===plan)for(let e=0;e<rooms2.data.length;e++){let t=rooms2.data[e];for(let e=0;e<t.plaster.length;e++)!0===t.plaster[e].exist?t.demolines[e].IMAGE.attr({stroke:t.plaster[e].color,"stroke-dasharray":"none"}):t.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}if(null!==f){let e=f.room,t=e.ceilings[f.ceiling];!0===t.niches[f.niche].temp&&(t.niches[f.niche].exist=!1),f=null,e.draw()}if(ne.fire("remove"),"build"===plan&&cursors.door.door){let e=cursors.door.door;e.rollback()}return!1});let I=new Event("mouseup"),C=($(document).on("mouseout",function(){document.dispatchEvent(I)}),!0),y,b,Z=!1;function v(){for(let t=0;t<doors.db.length;t++){let e=doors.db[t];var i,n,s;e.plan===plan&&e.id_wall&&(i=get_object(walls.db,e.id_wall))&&(n=LIB.pointOnLine(e.e,e.s,-3),s=LIB.pointOnLine(e.s,e.e,-3),n=is_point_inside_polygon(n,i.polygon),s=is_point_inside_polygon(s,i.polygon),n&&s||(e.erase(),doors.db.splice(t,1),t--))}for(let t=0;t<windows.db.length;t++){let e=windows.db[t];var o,l;!e.id_wall||(l=get_object(windows.db,e.id_wall))&&(o=is_point_inside_polygon(e.s,l.polygon),l=is_point_inside_polygon(e.e,l.polygon),o&&l||(e.erase(),windows.db.splice(t,1),t--))}}function s(i,n){if("wall"===i&&null!==selected.wallPoint){let t=get_object(walls.db,id.wall);if(!t)return;if(Z=!0,Ae.save(),("s"===selected.wallPoint||"c"===selected.wallPoint)&&"build"===t.label&&0<t.walls_s.length)for(let e=0;e<t.walls_s.length;e++){var s=t.walls_s[0].wall;if("init"===walls.db[s].label)return void warning.show("red",l10n.move_impossible)}if(("e"===selected.wallPoint||"c"===selected.wallPoint)&&"build"===t.label&&0<t.walls_e.length)for(let e=0;e<t.walls_e.length;e++){var o=t.walls_e[0].wall;if("init"===walls.db[o].label)return void warning.show("red",l10n.move_impossible)}if(y||"s"===selected.wallPoint&&(y=copy.point(t.s)),b||"e"===selected.wallPoint&&(b=copy.point(t.e)),warning.hide(),t.get_orientation(),t.collectItems(),t.delete_rooms(),C&&(console.warn("Определяем связанные объекты"),t.get_linked_walls(),t.get_linked_pillars(),t.get_linked_windows(),t.get_linked_doors(),C=!1),"s"===selected.wallPoint&&(t.get_moving_limits("S"),"L"===n&&--t.s.x,"R"===n&&(t.s.x+=1),"U"===n&&--t.s.y,"D"===n&&(t.s.y+=1),t.calc()),"c"===selected.wallPoint){if(("L"===n||"R"===n)&&"H"===t.orientation)return;if(("U"===n||"D"===n)&&"V"===t.orientation)return;t.get_moving_limits("C"),"L"===n&&(--t.s.x,--t.e.x,t.s.x<t.x_min&&(warning.show("yellow",l10n.move_left_impossible),t.s.x=t.x_min,t.e.x=t.x_min)),"R"===n&&(t.s.x+=1,t.e.x+=1,t.s.x>t.x_max&&(warning.show("yellow",l10n.move_right_impossible),t.s.x=t.x_max,t.e.x=t.x_max)),"U"===n&&(--t.s.y,--t.e.y,t.s.y<t.y_min&&(warning.show("yellow",l10n.move_up_impossible),t.s.y=t.y_min,t.e.y=t.y_min)),"D"===n&&(t.s.y+=1,t.e.y+=1,t.s.y>t.y_max&&(warning.show("yellow",l10n.move_down_impossible),t.s.y=t.y_max,t.e.y=t.y_max)),t.calc(),t.move_linked_walls(t.c)}"e"===selected.wallPoint&&(t.get_moving_limits("E"),"L"===n&&--t.e.x,"R"===n&&(t.e.x+=1),"U"===n&&--t.e.y,"D"===n&&(t.e.y+=1),t.calc()),t.draw(),t.paint(),t.move_linked_windows(),t.move_linked_doors(),wallControls.fire("dragmove"),t.paint("orange"),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){if(function(t){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if(i.id!==t.id&&"init_copy"!==i.label){var n=null!==i.links.s&&i.links.s.id===t.id,s=null!==i.links.e&&i.links.e.id===t.id;if(!n&&!s){var n=is_point_on_line(t.s,i.axis),s=is_point_on_line(t.e,i.axis),o=line_and_line_intersection(t.axis,i.EdgeO),l=line_and_line_intersection(t.axis,i.EdgeI),r=line_and_line_intersection(i.axis,t.EdgeO),a=line_and_line_intersection(i.axis,t.EdgeI);if(!n&&!s&&o&&l&&r&&a){if("init"===t.label){if("init"===i.label)return!0;if("break"===i.label)return!0;if("build"===i.label)return!0}if("build"===t.label){if("init"===i.label)return!0;if("build"===i.label)return!0}}}}}for(let e=0;e<walls.db.length;e++){var h=walls.db[e];if(h.id!==t.id&&("init_copy"!==h.label&&("init"!==plan||"build"!==h.label)&&("build"!==plan||"break"!==h.label)&&is_line_over_line(h.axis,t.axis)))return!0}return!1}(t))warning.show("red",l10n.wall_not_up_other_wall),wallControls.fire("off"),"s"===selected.wallPoint&&(t.s=copy.point(y)),"e"===selected.wallPoint&&(t.e=copy.point(b)),t.calc(),pillars.draw(),walls.draw(),y=void 0,b=void 0,t.paint("orange");else{"s"===selected.wallPoint&&(t.move_linked_walls(t.s),t.force_connection("s")),"e"===selected.wallPoint&&(t.move_linked_walls(t.e),t.force_connection("e")),t.move_linked_pillars();for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.wallItems&&e.moveItems()}C=!0,v(),project.draw(),project.localSave(),wallControls.fire("dragend"),t.paint("orange"),pointJoystick.active&&("s"===selected.wallPoint&&pointJoystick.fire("on",{wall:t,center:t.s,zone:"s",orientation:t.orientation}),"c"===selected.wallPoint&&pointJoystick.fire("on",{wall:t,center:t.c,zone:"c",orientation:t.orientation}),"e"===selected.wallPoint&&pointJoystick.fire("on",{wall:t,center:t.e,zone:"e",orientation:t.orientation}))}Z=!1},1e3)}if("pillar"===i){pillarGuidlines.fire("on");let e=pillars.db[selected.pillar];"L"===n&&--e.center.x,"R"===n&&(e.center.x+=1),"U"===n&&--e.center.y,"D"===n&&(e.center.y+=1),e.draw(),walls.draw(),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){project.localSave()},1e3)}if("item"===i){layers.upper.clear();let e=get_item(id.item);e&&("L"===n&&(--e.props.center.x,e.draw(),e.updateComment(),e.paint("orange"),e.selected=!0),"R"===n&&(e.props.center.x+=1,e.draw(),e.updateComment(),e.paint("orange"),e.selected=!0),"U"===n&&(--e.props.center.y,e.draw(),e.updateComment(),e.paint("orange"),e.selected=!0),"D"===n&&(e.props.center.y+=1,e.draw(),e.updateComment(),e.paint("orange"),e.selected=!0),"light"===plan&&in_array(e.props.name,light_reference_lines.tools)&&items.build_dimensions())}if("canvas"===i){let e=svg.viewbox().x,t=svg.viewbox().y;var i=svg.viewbox().width,l=svg.viewbox().height,r=svg.viewbox().zoom;"L"===n&&(e-=100),"R"===n&&(e+=100),"U"===n&&(t-=100),"D"===n&&(t+=100),svg.viewbox(e,t,i,l,r),grid.update(),tool_events.hasOwnProperty("canvas_move")?tool_events.canvas_move++:tool_events.canvas_move=1}}window.isContextmenuHidden=function(){return!$(".contextmenu").is(":visible")},$("#navigate_left").on("click",function(){s("canvas","L")}),$("#navigate_right").on("click",function(){s("canvas","R")}),$("#navigate_top").on("click",function(){s("canvas","U")}),$("#navigate_bottom").on("click",function(){s("canvas","D")}),$(document).on("keyup",function(e){if(pointJoystick.fire("off"),"none"===tool){if(in_array(M.name,["electric_shield","door_remote","wifi_router"]))return;if(("wall"===M.anchor||M.need_show_baseline)&&in_array(M.group,["waterspots","sockets","wires","lights","switches"]))return}if("Escape"===e.key){if($("body").css("cursor","default"),z.crosshair.clear(),cursors.own.fire("off"),$(".contextmenu").hide(),walls.paint(),windows.paint(),doors.paint(),items.paint(),manager_lining.key_escape(),z.crosshair.clear(),$("body").css("cursor","default"),$(".options_preset").hide(),$(".tools_item.active").removeClass("active"),$(".footer_bar_tool").removeClass("active"),delete_empty_comment(),cursors.hide(),zoneDelimiter.fire("off"),cursors.own.fire("off"),z.stop.hide(),tool="none",tool_group="none",z.reset(),magnets2.hide(),ne.fire("remove"),cursors.own.edge&&baselines.db[cursors.own.edge]&&baselines.db[cursors.own.edge].draw(),null!==S.window&&(windows.db[S.window].delete(),S.window=null),null!==S.door&&(doors.db[S.door].delete(),S.door=null),cursors.door.door){let e=cursors.door.door;e.rollback()}create_rooms(),pillarGuidlines.fire("off")}if("ArrowUp"===e.key)switch(console.warn(tool),tool){case"none":if(!0===$(".contextmenu").is(":visible"))return;null!==id.item?s("item","U"):s("canvas","U");break;case"moving":if(!0===$(".contextmenu").is(":visible"))return;null!==selected.wallPoint&&s("wall","U");break;case"ai_wall":let e=handlines.db[handlines.db.length-1];--e.e.y,e.draw();break;case"move_pillar":s("pillar","U")}if("ArrowDown"===e.key)switch(tool){case"none":if(!0===$(".contextmenu").is(":visible"))return;null!==id.item?s("item","D"):s("canvas","D");break;case"moving":if(!0===$(".contextmenu").is(":visible"))return;null!==selected.wallPoint&&s("wall","D");break;case"ai_wall":let e=handlines.db[handlines.db.length-1];e.e.y+=1,e.draw();break;case"move_pillar":s("pillar","D")}if("ArrowLeft"===e.key)switch(tool){case"none":if(!0===$(".contextmenu").is(":visible"))return;null!==id.item?s("item","L"):s("canvas","L");break;case"moving":if(!0===$(".contextmenu").is(":visible"))return;null!==selected.wallPoint&&s("wall","L");break;case"ai_wall":let e=handlines.db[handlines.db.length-1];--e.e.x,e.draw();break;case"move_pillar":s("pillar","L")}if("ArrowRight"===e.key)switch(tool){case"none":if(!0===$(".contextmenu").is(":visible"))return;null!==id.item?s("item","R"):s("canvas","R");break;case"moving":if(!0===$(".contextmenu").is(":visible"))return;null!==selected.wallPoint&&s("wall","R");break;case"ai_wall":let e=handlines.db[handlines.db.length-1];e.e.x+=1,e.draw();break;case"move_pillar":s("pillar","R")}}),$(document).on("mouseleave",function(){}),$(document).on("click","a[href]",function(e){$("#fog").show(),e.preventDefault();e=$(this).attr("href");console.log("Переход по ссылке"),project.save({exit:!0,url:e})}),window.addEventListener("resize",function(){window.resize_timeout = setTimeout(function () {
            
		 if (pdfprint != 1) {
            pdfprint = 1;
		} else {
            svg.size(canvas.width(), canvas.height())			
            let viewbox = svg.viewbox();
            let x = viewbox.x;
            let y = viewbox.y;
            let w = canvas.width();
            let h = canvas.height();
            let z = viewbox.zoom;
            svg.viewbox(x, y, w, h, z);
            project.focus();
            project.draw(); // включая grid.update()
            console.warn("Window resize") 
			}
        }, 100);
    }),jsPDF.API.events.push(["addFonts",function(){this.addFileToVFS("Arial-normal.ttf","AAEAAAAQAQAABAAATFRTSJlrl8IAAAEMAAAA5E9TLzIh3pRuAAAB8AAAAE5WRE1Ye8pwVwAAAkAAAAXyY21hcHWdwwIAAAg0AAAC0mN2dCCM82QWAAALCAAABJhmcGdttBP6jgAAD6AAAAXIZ2x5ZibS2k8AABVoAACYjGhkbXjktaT+AACt9AAAG6RoZWFktY/44QAAyZgAAAA2aGhlYQ9qB4EAAMnQAAAAJGhtdHj0PVFQAADJ9AAAA3xsb2NhEao6xgAAzXAAAAHAbWF4cAPxBnMAAM8wAAAAIG5hbWX6YlnVAADPUAAABWpwb3N0BaXpjwAA1LwAAAiEcHJlcIjfhGUAAN1AAAAF2wAAAN8BAQEB/wEBAQEBAQEBFwEBAQEBAQEBAQEBAQEBAQEBAQEBAQEwAQEBAQEBAa8BAQEBAQEBAQEBEgFKMxEmAQEBAQEBAQEBAQEBAQEB398B3zsBAQEBASINAWNFEl0SAQEBATABAQEBARgBAQEBAQEBAQEBAUhOHBEYARgUAQEBAQEBAQEBAQH/ICABAQEBAQHfAQEBAa+0AQEBAd8BAQEBAQEBAQEMIgEBAQEBAQFOXRgBAQEBAQESAQEBAScBAQEMAQ0BAQEBARRdIBIOARgUEQEBAQEBAQEBAQEBAQEBAAAAA4gBkAAFAAAFmgUzAAABGwWaBTMAAAPRAGYCEggFAgsGBAICAgICBAAAAAAAAAAAAAAAAAAAAABNVAAAzEAAICIZBdP+UQEzBz4BsgAAAAAAAQAEAQQDAwEFAwMBAgEBAQAAAAAeAB4AHgAeAPgI/wAIAAj//gAJAAn//QAKAAr//QALAAv//QAMAAz//QANAA3//QAOAA3//QAPAA7//QAQAA///QARAA///AASABH//AATABL//AAUABP//AAVABP/+wAWABT/+wAXABX/+wAYABX/+gAZABf/+wAaABn/+gAbABr/+gAcABr/+gAdABv/+gAeABz/+QAfABz/+QAgAB3/+QAhAB//+QAiACD/+QAjACD/+AAkACH/+AAlACL/+AAmACL/9wAnACP/9wAoACT/9wApACb/9wAqACb/9wArACf/9gAsACj/9gAtACj/9gAuACr/9gAvACv/9gAwAC3/9gAxAC3/9QAyAC7/9QAzAC//9QA0ADD/9AA1ADD/9AA2ADH/9AA3ADP/9AA4ADT/8wA5ADT/8wA6ADX/8wA7ADX/8wA8ADb/8wA9ADf/8wA+ADj/8wA/ADn/8gBAADr/8gBBADv/8gBCADz/8gBDADz/8QBEAD3/8QBFAD7/8QBGAD//8ABHAED/8ABIAEH/8ABJAEL/8ABKAEL/8ABLAEP/8ABMAET/8ABNAEb/7wBOAEb/7wBPAEf/7wBQAEj/7wBRAEn/7gBSAEn/7gBTAEr/7gBUAEv/7QBVAE3/7QBWAE3/7QBXAE7/7QBYAE//7ABZAFD/7ABaAFD/7QBbAFH/7ABcAFP/7ABdAFT/7ABeAFT/7ABfAFX/6wBgAFb/6wBhAFf/6wBiAFf/6gBjAFn/6gBkAFr/6gBlAFv/6gBmAFz/6QBnAFz/6QBoAF3/6QBpAF7/6ABqAGD/6QBrAGD/6QBsAGH/6QBtAGL/6ABuAGP/6ABvAGP/6ABwAGT/5wBxAGX/5wByAGf/5wBzAGf/5wB0AGj/5wB1AGn/5gB2AGr/5gB3AGr/5gB4AGv/5QB5AG3/5QB6AG7/5QB7AG7/5QB8AG//5QB9AHD/5AB+AHH/5AB/AHL/5ACAAHP/5ACBAHT/5ACCAHX/4wCDAHb/4wCEAHb/4wCFAHf/4wCGAHj/4wCHAHn/4gCIAHr/4gCJAHv/4gCKAHz/4gCLAH3/4gCMAH3/4gCNAH7/4gCOAH//4gCPAIH/4QCQAIH/4QCRAIL/4ACSAIP/4ACTAIT/4ACUAIT/4ACVAIX/4ACWAIf/3wCXAIj/4ACYAIj/3wCZAIn/3wCaAIr/3gCbAIv/3gCcAIz/3gCdAIz/3gCeAI7/3gCfAI//3gCgAJD/3gChAJD/3QCiAJH/3QCjAJL/3QCkAJP/3QClAJT/3ACmAJX/2wCnAJb/2wCoAJf/2wCpAJf/2wCqAJj/2wCrAJn/2wCsAJv/2wCtAJv/2wCuAJz/2wCvAJ3/2wCwAJ7/2wCxAJ7/2gCyAJ//2gCzAKD/2gC0AKL/2QC1AKP/2AC2AKP/2AC3AKT/2AC4AKX/2AC5AKb/2AC6AKb/2AC7AKj/2AC8AKn/1wC9AKr/1wC+AKr/1wC/AKv/1wDAAKz/1wDBAK3/1wDCAK7/1wDDAK//1gDEALD/1gDFALH/1QDGALH/1QDHALL/1ADIALP/1ADJALT/1ADKALX/1ADLALb/1ADMALf/1ADNALj/1ADO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AwMDBAYGCgcCBAQEBgMEAwMGBgYGBgYGBgYGAwMGBgYGCwcHCAgHBwkIAwYHBgkICQcJCAcHCAcJBwcHAwMDBQYEBgYGBgYDBgYCAgYCCAYGBgYEBgMGBggFBgYEAwQGBwcHBgcHCgcICAYHCQgJCAcIBwcJBwcHCwoJCgcICwgGBAYEBgMICAsKBgYEBgIGBggGAwIMCgsJAgcGBgYLAwkGBgYGBgsEBAICBAcHCAYMBwYGBgYGBAYGCAUGBgYGCAYGBgYGBgYKBQYGCAkHCAYGCAYDBAQCBgsEBAMAAAAMDQkAAwMDBAcHCwgCBAQFBwMEAwMHBwcHBwcHBwcHAwMHBwcHDAcICQkIBwkJAwYIBwoJCQgJCQgHCQcLBwcHAwMDBgcEBwcGBwcDBwcDAwYDCwcHBwcEBgQHBQkGBQYEAwQHBwgIBwgICwcJCQcICgkJCQgJBwcJBwkICwsKCwgJDAkHBQcEBgMJCQwKBwcEBwMHBgkGAwMNCwwKAwgHBwcMAwoHBwUGBwwEBAMDBAcFCQcNCAcHBwcGBAcHCQYHBwUHCQcHBwcGBQULBgcGCQkICQYGCQcDBQQDBwwEBAMAAAANDgoABAQDBQcHDAkCBAQFCAQEBAQHBwcHBwcHBwcHBAQICAgHDQkJCQkJCAoJAwcJBwsJCgkKCQkHCQkLCQkIBAQEBgcEBwcHBwcEBwcDAwcDCwcHBwcEBwQHBwkHBwcEAwQICQkJBwkJCwgJCQgJCwkKCQkJBwcLCQoJCwsKDAkJDQkHBQcFBwMKCg0LBwcFCAMHBwkHAwMODA0LAwkIBwcNBAsHCAYHBw0EBAMDBAcHCQcOCQcHBwcHBQgHCQYHBwYICQcHBwcHBQcLBwYHCwsICQcHCgcDBQQDBw0EBAQAAAAODwsABAQDBQgIDAkDBQUFCAQFBAQICAgICAgICAgIBAQICAgIDgkJCgoJCQsKAwcJCAwKCwkLCgkJCgkNCQkJBAQEBwgFCAgHCAgECAgDAwcDDQgICAgFBwQIBwkHBwcFBAUICQkJCAkJDQgKCggJDAoLCgkKCQkLCQoJDQ0LDAkKDgoIBggFCAMKCg4MCAgFCAMIBwoHAwMPDQ4LAwkICAgOBAwICAYHCA4FBQMDBQkHCggPCQgICAgHBQgICQYICAYICggICAgHBgcLBwgHCwsJCgcHCwgEBgUDCA4FBQQAAAAPEAsABAQEBQgIDQoDBQUGCQQFBAQICAgICAgICAgIBAQJCQkIDwoKCwsKCQwLBAgKCA0LDAoMCwoJCwoOCgoJBAQEBwgFCAgICAgECAgDAwgDDQgICAgFCAQIBwsIBwgFBAUJCgoKCAoKDgkLCwkKDQsMCwoLCQoLCgsKDg4MDQoLDwsIBggFCAQLCw8NCAgFCQMICAsIBAMQDg8MAwoJCAgPBA0ICQcICA8FBQMDBQoHCwgQCggICAkIBQkICQcICAcJCggICAgIBwcNCAkICwwJCwgICwgEBgUDCA8FBQQAAAAQEQwABAQEBgkJDgsDBQUGCQQFBAQJCQkJCQkJCQkJBAQJCQkJEAoLDAwLCgwMBAgLCQ0MDAsMDAsKDAoODAoKBAQECAkFCQkICQkECQkEBAgEDgkJCQkFCAQJCAwICAcFBAUJCgsLCQsLDgoMDAkLDQwMDAsMCgoMDAwLDg4NDgsMEAwJBgkGCQQMDBAOCQkGCQQJCAwIBAQRDxANBAsJCQkQBA4JCQcICRAFBQQEBQoIDAkRCwkJCQkJBgkJCgcJCQcJCwkJCQkIBggOCAkIDAwJDAgIDAkEBgUECRAFBQQAAAAREg0ABQUFBgkJDwsDBgYHCgUGBQUJCQkJCQkJCQkJBQUKCgoJEQsLDAwLCg0MBQkLCQ4MDQsNDAsJDAsPCwsKBQUFCAkGCQkJCQkFCQkEBAkEDgkJCQkGCQUJCAwICAgGBAYKCwsLCQwLDwoMDAoLDgwNDAsMCQsNCw0LDw8NDwsMEQwJBwkGCQUMDBEPCQkGCgQKCQwJBQQSDxEOBAsKCQkRBQ8JCgcJCREGBgQEBgsICwkSCwkJCQkJBgoJCwgKCgcKDAkJCQkJCAgOCAoJDg4LDAkJDQkEBwYECREGBgUAAAASEw4ABQUFBgoKEAwDBgYHCwUGBQUKCgoKCgoKCgoKBQULCwsKEgwMDQ0MCw4NBQkMCg8NDgwODQwLDQwQDAsLBQUFCAoGCgoJCgoFCgoEBAkEDgoKCgoGCQUKCQ0JCQkGBQYLDAwMCgwMEQsNDQoMDw0ODQwNCwoODA0MEREOEAwNEg0KBwoGCgUNDRIQCgoHCwQKCQ0JBQQTEBIPBAwLCgoSBQ8KCggJChIGBgQEBgoJDQoTDAoKCgoKBwsKDAgKCggLDAoKCgoJCAkQCQoJDg8LDQkJDgoFBwYEChIGBgUAAAATFA4ABQUFBwsLEQ0EBgYHCwUGBQULCwsLCwsLCwsLBQULCwsLEwwNDg4NDA8OBQoNCxAODw0PDg0MDgwSDQ0MBQUFCQsGCwsKCwsFCwsEBAoEEAsLCwsGCgULCQ0KCQoGBQYLDAwNCg0NEgsODgsMEA4PDg0ODAwODQ4NEREPEQwOEw4LCAsHCgUODhMQCwoHCwQLCg4KBQQUERMPBA0LCwsTBRALCwgKCxMGBgQEBgwJDgsUDQsKCwsKBwsLDgkLCwgLDQsLCgsKCAkQCgsKDg8MDgoKDgsFCAYECxMGBgUAAAAUFQ8ABgYFBwsLEg0EBwcIDAYHBgYLCwsLCwsLCwsLBgYMDAwLFAwNDg4NDBAOBQoNCxEOEA0QDg0MDgwSDQ0MBgYGCQsHCwsKCwsGCwsEBAoEEAsLCwsHCgYLCQ0KCQoHBQcMDA0NCw4NEgwODgwNEQ4QDg0ODAwPDQ8NExMQEg0OFA4LCAsHCwUPDxQRCwsHDAQLCg4KBQQVEhQQBA0MCwsUBhELDAkKCxQHBwQEBwwJDgsVDQsLCwsLBwwLDQkLCwkMDgsLCwsKCQkQCgsKEBANDgoKDwsFCAcFCxQHBwYAAAAVFxAABgYGBwwMEw4EBwcIDAYHBgYMDAwMDAwMDAwMBgYMDAwMFQ0ODw8ODRAPBgsODBIPEA4QDw4NDw0TDg4NBgYGCgwHDAwLDAwGDAwEBAsEEgwMDAwHCwYMCw8LCwsHBQcMDQ4OCw4OEw0PDwwOEg8QDw4PDQ0QDhAOEhQREw4PFQ8MCAwHCwYPDxUSDAsIDAQMCw8LBgQWExURBA4MDAwVBhIMDAkLDBUHBwUFBw0LDwwXDgwLDAwLCAwMDgoMDAkMDgwMCwwLCgsQCwwLEBENDwsLEAwFCQcFDBUHBwYAAAAWGBEABgYGCAwMFA8EBwcIDQYHBgYMDAwMDAwMDAwMBgYNDQ0MFg8PEBAPDREQBgsPDBIQEQ8REA8NEA8VDw8NBgYGCgwHDAwLDAwGDAwEBAsEEgwMDAwHCwYMCw8LCwsHBgcNDw4PDA8PFA0QEA0OEhAREA8QDQ0QDxAPFBUREw4QFhAMCQwIDAYQEBYTDAwIDQQMCxALBgQXFBYSBA8NDAwWBhMMDQoLDBYHBwUFBw0LEAwYDwwMDA0MCA0MDwoMDAoN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AHIAdgBlAGQAQQByAGkAYQBsACAAQwB5AHIAUgBlAGcAdQBsAGEAcgBNAG8AbgBvAHQAeQBwAGUAIAAtACAAQQByAGkAYQBsACAAQwB5AHIAaQBsAGwAaQBjACAAUgBlAGcAdQBsAGEAcgBBAHIAaQBhAGwAIABDAHkAcgBWAGUAcgBzAGkAbwBuACAAMQAuADEAIAAtACAATgBvAHYAZQBtAGIAZQByACAAMQA5ADkAMgBBAHIAaQBhAGwAQwB5AHIATQBUAEEAcgBpAGEAbACuACAAVAByAGEAZABlAG0AYQByAGsAIABvAGYAIABUAGgAZQAgAE0AbwBuAG8AdAB5AHAAZQAgAEMAbwByAHAAbwByAGEAdABpAG8AbgAgAHAAbABjACAAcgBlAGcAaQBzAHQAZQByAGUAZAAgAGkAbgAgAHQAaABlACAAVQBTACAAUABhAHQAIAAmACAAVABNACAATwBmAGYALgAgAGEAbgBkACAAZQBsAHMAZQB3AGgAZQByAGUALgBOAG8AcgBtAOEAbABBAHIAaQBhAGwAIABDAHkAcgBOAG8AcgBtAGEAbABuAHkAQQByAGkAYQBsACAAQwB5AHIAAAACAAAAAAAA/ycAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAN8AAAAAAAABAgEDAQQBBQEGAQcBCAEJAQoBCwEMAQ0BDgEPARABEQESARMBFAEVARYBFwEYARkBGgEbARwBHQEeAR8BIAEhASIBIwEkASUBJgEnASgBKQEqASsBLAEtAS4BLwEwATEBMgEzATQBNQE2ATcBOAE5AToBOwE8AT0BPgE/AUABQQFCAUMBRAFFAUYBRwFIAUkBSgFLAUwBTQFOAU8BUAFRAVIBUwFUAVUBVgFXAVgBWQFaAVsBXAFdAV4BXwFgAWEBYgFjAWQBZQFmAWcBaAFpAWoBawFsAW0BbgFvAXABcQFyAXMBdAF1AXYBdwF4AXkBegF7AXwBfQF+AX8BgAGBAYIBgwGEAYUBhgGHAYgBiQGKAYsBjAGNAY4BjwGQAZEBkgGTAZQBlQGWAZcBmAGZAZoBmwGcAZ0BngGfAaABoQGiAaMBpAGlAaYBpwGoAakBqgGrAawBrQGuAa8BsAGxAbIBswG0AbUBtgG3AbgBuQG6AbsBvAG9Ab4BvwHAAcEBwgHDAcQBxQHGAccByAHJAcoBywHMAc0BzgHPAdAB0QHSAdMB1AHVAdYB1wHYAdkB2gHbAdwB3QVzcGFjZQZleGNsYW0IcXVvdGVkYmwKbnVtYmVyc2lnbgZkb2xsYXIHcGVyY2VudAlhbXBlcnNhbmQLcXVvdGVzaW5nbGUJcGFyZW5sZWZ0CnBhcmVucmlnaHQIYXN0ZXJpc2sEcGx1cwVjb21tYQZoeXBoZW4GcGVyaW9kBXNsYXNoBHplcm8Db25lA3R3bwV0aHJlZQRmb3VyBGZpdmUDc2l4BXNldmVuBWVpZ2h0BG5pbmUFY29sb24Jc2VtaWNvbG9uBGxlc3MFZXF1YWwHZ3JlYXRlcghxdWVzdGlvbgJhdAFBAUIBQwFEAUUBRgFHAUgBSQFKAUsBTAFNAU4BTwFQAVEBUgFTAVQBVQFWAVcBWAFZAVoLYnJhY2tldGxlZnQJYmFja3NsYXNoDGJyYWNrZXRyaWdodAthc2NpaWNpcmN1bQp1bmRlcnNjb3JlBWdyYXZlAWEBYgFjAWQBZQFmAWcBaAFpAWoBawFsAW0BbgFvAXABcQFyAXMBdAF1AXYBdwF4AXkBeglicmFjZWxlZnQDYmFyCmJyYWNlcmlnaHQKYXNjaWl0aWxkZQlhZmlpMTAwMTcJYWZpaTEwMDE4CWFmaWkxMDAxOQlhZmlpMTAwMjAJYWZpaTEwMDIxCWFmaWkxMDAyMglhZmlpMTAwMjQJYWZpaTEwMDI1CWFmaWkxMDAyNglhZmlpMTAwMjcJYWZpaTEwMDI4CWFmaWkxMDAyOQlhZmlpMTAwMzAJYWZpaTEwMDMxCWFmaWkxMDAzMglhZmlpMTAwMzMJYWZpaTEwMDM0CWFmaWkxMDAzNQlhZmlpMTAwMzYJYWZpaTEwMDM3CWFmaWkxMDAzOAlhZmlpMTAwMzkJYWZpaTEwMDQwCWFmaWkxMDA0MQlhZmlpMTAwNDIJYWZpaTEwMDQzCWFmaWkxMDA0NAlhZmlpMTAwNDUJYWZpaTEwMDQ2CWFmaWkxMDA0NwlhZmlpMTAwNDgJYWZpaTEwMDQ5BmRhZ2dlcgZkZWdyZWUHc2VjdGlvbgZidWxsZXQJcGFyYWdyYXBoCWFmaWkxMDA1NQpyZWdpc3RlcmVkCWNvcHlyaWdodAl0cmFkZW1hcmsJYWZpaTEwMDUxCWFmaWkxMDA5OQlhZmlpMTAwNTIJYWZpaTEwMTAwCXBsdXNtaW51cwlhZmlpMTAxMDMCbXUJYWZpaTEwMDU3CWFmaWkxMDA1MwlhZmlpMTAxMDEJYWZpaTEwMDU2CWFmaWkxMDEwNAlhZmlpMTAwNTgIYWZpaTEwMTYJYWZpaTEwMDU5CWFmaWkxMDEwNwlhZmlpMTAxMDUJYWZpaTEwMDU0CmxvZ2ljYWxub3QNZ3VpbGxlbW90bGVmdA5ndWlsbGVtb3RyaWdodAhlbGxpcHNpcwduYnNwYWNlCWFmaWkxMDA2MAlhZmlpMTAxMDgJYWZpaTEwMDYxCWFmaWkxMDEwOQlhZmlpMTAxMDIGZW5kYXNoBmVtZGFzaAxxdW90ZWRibGxlZnQNcXVvdGVkYmxyaWdodAlxdW90ZWxlZnQKcXVvdGVyaWdodAxxdW90ZWRibGJhc2UJYWZpaTEwMDYyCWFmaWkxMDExMAlhZmlpMTAxNDUJYWZpaTEwMTkzCWFmaWk2MTM1MglhZmlpMTAwMjMJYWZpaTEwMDcxCWFmaWkxMDA5NwlhZmlpMTAwNjUJYWZpaTEwMDY2CWFmaWkxMDA2NwlhZmlpMTAwNjgJYWZpaTEwMDY5CWFmaWkxMDA3MAlhZmlpMTAwNzIJYWZpaTEwMDczCWFmaWkxMDA3NAlhZmlpMTAwNzUJYWZpaTEwMDc2CWFmaWkxMDA3NwlhZmlpMTAwNzgJYWZpaTEwMDc5CWFmaWkxMDA4MAlhZmlpMTAwODEJYWZpaTEwMDgyCWFmaWkxMDA4MwlhZmlpMTAwODQJYWZpaTEwMDg1CWFmaWkxMDA4NglhZmlpMTAwODcJYWZpaTEwMDg4CWFmaWkxMDA4OQlhZmlpMTAwOTAJYWZpaTEwMDkxCWFmaWkxMDA5MglhZmlpMTAwOTMJYWZpaTEwMDk0CWFmaWkxMDA5NQlhZmlpMTAwOTYIY3VycmVuY3kJYnJva2VuYmFyCWFmaWkxMDA1MAlhZmlpMTAwOTgOcXVvdGVzaW5nbGJhc2UMZG91YmxlZGFnZ2VyC3BlcnRob3VzYW5kDWd1aWxzaW5nbGxlZnQPZ3VpbGxzaW5nbHJpZ2h0DnBlcmlvZGNlbnRlcmVkQAoARkYAAAASEQhAuAHrtBEJEQmQuwFcAAcAkAFJQBcHkMQHkGwHkGUHkGEHkF0HkFwHkFsHx0EMAgYAHgAfAjsCBQBJAB8CSgH9AB4AHwI9sm0rH7gBLbNXKx+QuAIHsj8fj7gCBLI/H3a4AfyyHh+puAIDsmQf6bgB/7IeH4a8Af0AZAAfAYcCBrI8H3m7AgMAPAAfAhGyVjwfuQGLAf+yZB/buAH8shQf1bgCALJkH364AgayZB+quAIDsmQfmrgCALIKH5q4AgayZB+HuAH9sgofh7gCA7JkH324AgayZB94uAIDsmQftbgCB7JkH2dBCQIEAGQAHwFyAgUAZAAfAS4CArJkH3W4AgWyZB9WuAICsmQfbrgCALJkH2K4Af2yZB9tuAH/smQfV7gB/EAXZB8AgxCDkIOggwRAg1CD8IMDkIOggwK9AgcAFggAAEACAwIGshYXP0EJAgMCBgAXAD4CAwIGADwCAgIFshY+T0ERAgUAXwIFALACAgADAgICBQBYAgkAPQIBABQIAABAAf0CALIUFT9BCQH9AgAAFQA+Af0CAAA8AfwB/7IUPs9BDwH/AN8B/wACAfwB/wBVAggAPQAvAgIA3wICAAICKLdZlh+XipYfzkENAksAKQAfAScBKQArAB8BIAEpAB0AHwIaASlAEGQfaoqWH2lVlh9kVZYfcIu4CABADh+LYDYfYFiWHzeKXpYfuAErQAtZSh9fWZYfq4WWH7gBkEAMWpYf3FWWH3telh9ZuAH5spYfXrgB+LKWH1q7AfgAlgAfAkuyVUMfuAI1smsSH7gCIbZVHx+Fa5YfuAIMslhCH7kBKQHtspYfhLgB7bKWH1W4Ae2ylh9juAHtspYfWLgB7LKWH2u4Aeyzlh8JT0EmAfgATwH5AF8B+ABfAfkAbwH4AG8B+QB/AfgAfwH5AI8B+QCfAfkArwH5AAsADwH5AJ8B+ACfAfkArwH4AK8B+QC/AfkAzwH5AN8B+bIIOQ9BFgH4AB8B+AAvAfgALwH5AD8B+QDfAfgA3wH5AO8B+ADvAfkA/wH5AAoA/wH4sgEJX7wB7QCvAewAvwHssgM5r78B7QABAfsB9wAyAB8B+gH3sjIfN0ESAfkB9gAoAB8B+AH2ACgAHwHtAesAMgAfAewB6wAyAB8B9wH1sigfN70B9gH1ACgAHwHrAfVAmygfD7AfsC+wP7BPsF+wb7B/sI+wn7AKJAgiCCAIHggcCBoIGAgWCBQIEggQCA4IDAgKCAgIEAKWHwUCMh8EAjIfAQOWHwAClh8GCAQIAggACABABn8GAi8GYAagBgMQBu8GAgkPAwAJEAkvAyAJBToPAj8CbwJ/AgQfAi8CXwKPAp8CzwL/AgcPAj8CTwJvAn8CrwK/Au8CCFA4AUuwwGMAS2IgsPZTI7gBClFasAUjQgGwEksAS1RCGLATA0sCS1NCsDgrS7gIAFKwNytLsAlQW1ixAQGOWbA4K7ACiLgBAFRYuAEZsQEBjoUbsBJDWLkAAQEihY0buQABAf+FjVlZKx2wZEtTWLBwHVmwMktTWLCQHVkAc3R1XnNec3R1FisrK3wrKysrKysYKysrKysrKysrKysrKysrGHSzAgsKEkNYYBshWUIBKwArKysBKysAKysrKysBdV5zXgB0dV5zdF4BKysrKysrKysrKysAKysrKysrKysrKysrKysrKysrKysrACsBKwF0AStzKysrKysrcysrKysrc3R1KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysBS1B5uQAfAT22Bx/fBx9mBysrK0tTebkAkAE9tgeQ3weQZgcrKysYAUVpU0IBS1BYsQgAQllDXFixCABCWRYQcD6wEkNYuTshGH4bugQAAagACytZsAwjQrANI0KwEkNYuS1BLUEbugQABAAACytZsA4jQrAPI0KwEkNYuRh+OyEbugGoBAAACytZsBAjQrARI0IA"),this.addFont("Arial-normal.ttf","Arial","normal")}]);let x=canvas.offset().left+20,B=canvas.offset().top+20,k=canvas.offset().left+canvas.width()-20,L=canvas.offset().top+canvas.height()-20,E={size:10,family:"Arial","stroke-width":.2,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"};function R(e,t=2){return parseFloat(e.toFixed(t))}function W(){let t=[],i=[];for(let e=0;e<walls.db.length;e++){var n=walls.db[e];is_point_exists(n.s)&&(Math.abs(n.s.x)<5e4&&t.push(Math.ceil(n.s.x)),Math.abs(n.s.y)<5e4&&i.push(Math.ceil(n.s.y))),is_point_exists(n.e)&&(Math.abs(n.e.x)<5e4&&t.push(Math.ceil(n.e.x)),Math.abs(n.e.y)<5e4&&i.push(Math.ceil(n.e.y)))}for(let e=0;e<pillars.db.length;e++){var s=pillars.db[e];is_point_exists(s.center)&&(is_point_exists(s.p1)&&(Math.abs(s.p1.x)<5e4&&t.push(Math.ceil(s.p1.x)),Math.abs(s.p1.y)<5e4&&i.push(Math.ceil(s.p1.y))),is_point_exists(s.p2)&&(Math.abs(s.p2.x)<5e4&&t.push(Math.ceil(s.p2.x)),Math.abs(s.p2.y)<5e4&&i.push(Math.ceil(s.p2.y))),is_point_exists(s.p3)&&(Math.abs(s.p3.x)<5e4&&t.push(Math.ceil(s.p3.x)),Math.abs(s.p3.y)<5e4&&i.push(Math.ceil(s.p3.y))),is_point_exists(s.p4)&&(Math.abs(s.p4.x)<5e4&&t.push(Math.ceil(s.p4.x)),Math.abs(s.p4.y)<5e4&&i.push(Math.ceil(s.p4.y))))}var e=Math.min.apply(null,t),o=Math.max.apply(null,t),l=Math.min.apply(null,i),r=Math.max.apply(null,i),a=(e+o)/2,h=(l+r)/2;return{x_min:e,x_max:o,y_min:l,y_max:r,cx:a,cy:h,center:{x:a,y:h},tl_point:{x:e,y:l},br_point:{x:o,y:r},width:o-e,height:r-l}}function p(e,t,i,n,s){function o(e,t,i){return["M",e.x,e.y,"A",i,i,0,0,1,t.x,t.y].join(" ")}let l=[],r;var a,h,g,_;return"inner_left"===s&&(h=point_near_line_end(t,a=e,i,"L"),g=point_near_line_end(a,h,n,"L"),_=point_near_line_end(h,g,i,"L"),l.push(a,h,g,_),r=o(t,h,i)),"inner_right"===s&&(g=point_near_line_end(e,a=t,i,"R"),_=point_near_line_end(a,g,n,"R"),h=point_near_line_end(g,_,i,"R"),l.push(a,g,_,h),r=o(g,e,i)),"outer_left"===s&&(_=point_near_line_end(t,a=e,i,"R"),h=point_near_line_end(a,_,n,"R"),g=point_near_line_end(_,h,i,"R"),l.push(a,_,h,g),r=o(_,t,i)),"outer_right"===s&&(h=point_near_line_end(e,a=t,i,"L"),g=point_near_line_end(a,h,n,"L"),_=point_near_line_end(h,g,i,"L"),l.push(a,h,g,_),r=o(e,h,i)),{polygon:l,path:r}}function c(e,t,i,n,s){let o=[];var l,r,a,h;return"inner_left"===s&&(l=point_near_line_end(t,e,2,"L"),r=point_near_line_end(t,e,n+2,"L"),a=point_near_line_end(l,r,i,"R"),h=point_near_line_end(r,a,n,"R"),o.push(l,r,a,h)),"inner_right"===s&&(l=point_near_line_end(e,t,2,"R"),r=point_near_line_end(e,t,n+2,"R"),a=point_near_line_end(l,r,i,"L"),h=point_near_line_end(r,a,n,"L"),o.push(l,r,a,h)),"outer_left"===s&&(l=point_near_line_end(t,e,2,"R"),r=point_near_line_end(t,e,n+2,"R"),a=point_near_line_end(l,r,i,"L"),h=point_near_line_end(r,a,n,"L"),o.push(l,r,a,h)),"outer_right"===s&&(l=point_near_line_end(e,t,2,"L"),r=point_near_line_end(e,t,n+2,"L"),a=point_near_line_end(l,r,i,"R"),h=point_near_line_end(r,a,n,"R"),o.push(l,r,a,h)),{polygon:o}}function P(){Q(),z.reset(),magnets2.hide(),signs.reset()}window.index={room:null,warm_floor:null,reset:function(){this.room=null,this.warm_floor=null}},window.object_id=null,window.id_room=null,window.id_niche=null,window.id={wall:null,window:null,door:null,sector:null,item:null,warm_floor:null,reset:function(){for(var e in this)"reset"!==e&&(this[e]=null)}},window.mode="free",window.get_current_date=function(){let e=new Date,t=e.getDate(),i=e.getMonth()+1;var n=e.getFullYear();let s=e.getHours(),o=e.getMinutes();return 1===t.toString().length&&(t="0"+t),1===i.toString().length&&(i="0"+i),1===s.toString().length&&(s="0"+s),1===o.toString().length&&(o="0"+o),n+"-"+i+"-"+t+" "+s+"."+o},window.project_loaded=!1,window.tool_reset=function(){$("#planner_ui_options").removeClass("active"),$(".tools_item").removeClass("active"),$("body").css("cursor","default"),SVG.select("#custom_cursor").hide(),tool="none",tool_group="none",manager_lining.hide_temporary_line(),wall_magnet.hide(),pillarGuidlines.fire("off")},window.deactivate_tool=function(){$("#planner_ui_options").removeClass("active"),$("body").css("cursor","default"),SVG.select("#custom_cursor").hide(),manager_lining.hide_temporary_line(),wall_magnet.hide(),pillarGuidlines.fire("off")},window.tool_deactivate=function(){$("#planner_ui_options").removeClass("active"),$(".tools_item").removeClass("active"),$("body").css("cursor","default"),SVG.select("#custom_cursor").hide(),tool="none",tool_group="none",manager_lining.hide_temporary_line(),wall_magnet.hide(),customCursor.fire("off"),pillarControls.fire("off"),zoneDelimiter.fire("off")},window.get_wall=function(t){t=t||id.wall;for(let e=0;e<walls.db.length;e++)if(walls.db[e].id===t)return walls.db[e]},window.get_room=function(t){t=t||id.room;for(let e=0;e<rooms2.data.length;e++)if(rooms2.data[e].id===t)return rooms2.data[e]},window.get_item=function(t){t=t||id.item;for(let e=0;e<items.db.length;e++)if(items.db[e].props.id===t)return items.db[e]},window.get_led_strip=function(t){for(let e=0;e<led_strips.db.length;e++)if(led_strips.db[e].id===t)return led_strips.db[e]},window.get_line_strip=function(t){for(let e=0;e<line_strips.db.length;e++)if(line_strips.db[e].id===t)return line_strips.db[e]},window.get_cable=function(t){for(let e=0;e<cables.db.length;e++)if(cables.db[e].id===t)return cables.db[e]},window.get_pipe=function(t){for(let e=0;e<pipes.db.length;e++)if(pipes.db[e].id===t)return pipes.db[e]},window.get_pipe_conditioner=function(t){for(let e=0;e<pipes_conditioner.db.length;e++)if(pipes_conditioner.db[e].id===t)return pipes_conditioner.db[e]},window.get_cable_conditioner=function(t){for(let e=0;e<cables_conditioner.db.length;e++)if(cables_conditioner.db[e].id===t)return cables_conditioner.db[e]},window.get_pipe_heat=function(t){for(let e=0;e<pipes_heat.db.length;e++)if(pipes_heat.db[e].id===t)return pipes_heat.db[e]},window.get_cable_socket=function(t){for(let e=0;e<cables_socket.db.length;e++)if(cables_socket.db[e].id===t)return cables_socket.db[e]},window.get_cable_warm_floor=function(t){for(let e=0;e<cables_warm_floor.db.length;e++)if(cables_warm_floor.db[e].id===t)return cables_warm_floor.db[e]},window.get_stripe_light=function(t){for(let e=0;e<stripes_light.db.length;e++)if(stripes_light.db[e].id===t)return stripes_light.db[e]},window.get_freeline=function(t){for(let e=0;e<freelines.db.length;e++)if(freelines.db[e].id===t)return freelines.db[e]},window.get_warm_floor=function(i,n=!1){for(let t=0;t<rooms2.data.length;t++)if(rooms2.data[t].warm_floors)for(let e=0;e<rooms2.data[t].warm_floors.length;e++)if(rooms2.data[t].warm_floors[e].id===i)return n?rooms2.data[t].warm_floors[e]:(rooms2.data[t].warm_floors[e].props&&!rooms2.data[t].warm_floors[e].props.point_connection&&(rooms2.data[t].warm_floors[e].props.point_connection=rooms2.data[t].warm_floors[e].polygon[0]),rooms2.data[t].warm_floors[e].props&&!rooms2.data[t].warm_floors[e].props.name&&(rooms2.data[t].warm_floors[e].props.name="warm_floor"),{props:rooms2.data[t].warm_floors[e].props||{name:"warm_floor",point_connection:rooms2.data[t].warm_floors[e].polygon[0]},id:rooms2.data[t].warm_floors[e].id,id_room:rooms2.data[t].warm_floors[e].id_room,paint:function(){}})},window.get_pillar=function(t){t=t||id.pillar;for(let e=0;e<pillars.db.length;e++)if(pillars.db[e].id===t)return pillars.db[e]},window.delete_empty_comment=function(){if(hide2.contextmenu(),0<comments.db.length){let e=comments.db[comments.db.length-1];"..."===e.text&&e.delete()}};let Q=function(){for(let e=0;e<walls.db.length;e++){let i=walls.db[e];for(let t=0;t<i.ventHoles.length;t++){let e=i.ventHoles[t];e.selected&&!0===e.selected&&(delete e.selected,i.draw())}}};window.showContextmenu=function(e,t,i,n){n=n||0;let s=$(e);var o=s.width(),l=s.height(),r=canvas.height()-l-20;canvas.width()-o-20<t&&(t-=o),r<i&&(i-=l),$(e).finish().toggle(100).css({top:i-n+"px",left:t+"px"}),tool_events.hasOwnProperty("contextmenu")?tool_events.contextmenu++:tool_events.contextmenu=1},window.warning={visible:!1,icon:$("#warning-icon").on("click",function(){warning.hide()}).on("mouseover",function(){wall_magnet.hide(),a_line.fire("hide")}),text:$("#warning-text").on("click",function(){warning.hide()}).on("mouseover",function(){wall_magnet.hide(),a_line.fire("hide")}),show:function(e,t){t=t||"",this.visible=!0;let i=this,n=(this.text.removeClass("warning-green"),this.text.removeClass("warning-yellow"),this.text.removeClass("warning-red"),this.text.removeClass("expandOpenNew"),window.input_timeout&&clearTimeout(window.input_timeout),"green"===e&&this.text.addClass("warning-green"),"yellow"===e&&this.text.addClass("warning-yellow"),"red"===e&&this.text.addClass("warning-red"),this.text.addClass("expandOpenNew"),this.text.html(t),parseInt(100*t.length));(n=n<3e3?3e3:n)&&(window.input_timeout=setTimeout(function(){i.text.removeClass("expandOpenNew")},n))},hide:function(){this.visible=!1,this.text.removeClass("expandOpenNew")}},hide=function(){$("#floor_cap").hide(),items.paint(),manager_lining.paint(),signs.reset()},window.copy.wall=function(e){walls.db.push(new j({id:e.id,s:copy.point(e.s),e:copy.point(e.e),depth:e.depth,outer_depth:e.outer_depth,inner_depth:e.inner_depth,label:"init_copy",pillar:e.pillar,role:e.role,material:e.material,ventHoles:e.ventHoles.slice()}));let t=walls.db[walls.db.length-1];t.erase()},window.show={point:function(e,t,i){return void 0===t&&(t=1),void 0===i&&(i="red"),svg.circle(3).cx(e.x).cy(e.y).attr({stroke:i,"stroke-width":t,fill:i}).draggable()},index:function(e,t){let i=serviceLayer.group().draggable();i.add(svg.circle(12).attr({stroke:"#000000","stroke-width":.2,fill:colors.yellow}).cx(e.x).cy(e.y)),i.add(svg.text(t.toString()).font({family:"Arial",size:8,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(e.x).cy(e.y))},line:function(e,t,i){return void 0===i&&(i="red"),void 0===t&&(t=.4),svg.line(e.s.x,e.s.y,e.e.x,e.e.y).attr({stroke:i,"stroke-width":t})},polygon:function(t,i=4,n="crimson"){if(t)for(let e=0;e<t.length;e++){var s=t[e];svg.circle(i).cx(s.x).cy(s.y).attr({stroke:n,fill:n})}}},allow={sector:!1,pan:!0,magnet:!0,magnet_before:!1,handline_magnet:!0,contextmenu:!0,crosshair:!0,item:!0};let S={wall:null,id_wall:null,sector:null,window:null,door:null,doorway:null,item:null,room:null,warm_floor:null,ruler:null,handline:null,reset:function(){this.wall=null,this.id_wall=null,this.sector=null,this.window=null,this.door=null,this.doorway=null,this.item=null,this.wall=null,this.room=null,this.warm_floor=null,this.ruler=null,this.handline=null}},r=(selected={wall:null,part:null,sector:null,window:null,door:null,doorway:null,item:null,room:null,warm_floor:null,edge:null,something:!1,wallPoint:null,reset:function(){this.wall=null,this.wallPoint=null,this.sector=null,this.window=null,this.door=null,this.doorway=null,this.wall=null,this.room=null,this.warm_floor=null,this.edge=null,this.something=!1}},window.selectedObject=!1,{}),M={},N={swall1:null,swall1index:null,swall1s:null,swall1e:null,eWall:!(visibility={sockets:!1,furniture:!1,contextmenu:!1,set:function(e){this.sockets=in_array(e,["sockets","light","light_connections"]),void 0!==socketsSwitch[e]&&(this.sockets=socketsSwitch[e]),this.furniture=in_array(e,["build","furniture","santeh","sockets","light","light_connections","warm_floor","conditioners"]),void 0!==furnitureSwitch[e]&&(this.furniture=furnitureSwitch[e])}}),ewall1index:null,ewall1s:null,ewall1e:null,ePillarIndex:null,eConnection:!1,part_polygon:[],viewbox:null,collect_wall_points:function(){this.wall_points=[],walls.db.forEach(function(e,t){"init"!==plan||"init"!==e.label&&"break"!==e.label||(N.wall_points.push({wall:t,point:e.s,type:"s",distance:e.depth/2}),N.wall_points.push({wall:t,point:e.e,type:"e",distance:e.depth/2})),"build"!==plan||"init"!==e.label&&"build"!==e.label||(N.wall_points.push({wall:t,point:e.s,type:"s",distance:e.depth/2}),N.wall_points.push({wall:t,point:e.e,type:"e",distance:e.depth/2})),N.wall_points=function(t){let i=[];e:for(let e=0;e<t.length;e++){var n=t[e];for(let e=0;e<i.length;e++)if(are_points_equal(i[e].point,n.point))continue e;i.push(n)}return i}(N.wall_points)})},reset:function(){this.swall1=null,this.swall1index=null,this.swall1s=null,this.swall1e=null,this.eWall=!1,this.ewall1index=null,this.ewall1s=null,this.ewall1e=null,this.ePillarIndex=null,this.eConnection=!1}},X=(window.copy_counter=-1,window.copy_counter_max_value=copy_counter,window.panning=!1,window.drawing=!1,window.drawings=[],{}),q={};function ee(i,n=!0){let s=[];for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if((!n||!0!==t.inside_room)&&t.isAvailable()){if(!1===t.patch){for(let e=0;e<t.borders.o.length;e++){var o=t.borders.o[e],l=copy.point(o.s),o=copy.point(o.e);s.push({s:l,e:o,parent:"wall"})}for(let e=0;e<t.borders.i.length;e++){var r=t.borders.i[e],a=copy.point(r.s),r=copy.point(r.e);s.push({s:a,e:r,parent:"wall"})}for(let e=0;e<t.borders.s.length;e++){var h=t.borders.s[e],g=copy.point(h.s),h=copy.point(h.e);s.push({s:g,e:h,parent:"wall"})}for(let e=0;e<t.borders.e.length;e++){var _=t.borders.e[e],d=copy.point(_.s),_=copy.point(_.e);s.push({s:d,e:_,parent:"wall"})}}!0===t.patch&&(t.parts_points.push({xy:copy_point(t.s),parent:"wall"}),t.parts_points.push({xy:copy_point(t.e),parent:"wall"}))}}for(let e=0;e<pillars.db.length;e++){var t=pillars.db[e];if(!0!==t.remove&&((!n||!0!==t.inside_room)&&("init"!==i||"pillar"===t.role)&&("build"!==i||"pillar"===t.role||"gypsum"===t.role)&&t.borders))for(let e=0;e<t.borders.length;e++){var p=t.borders[e];s.push({s:copy.point(p.s),e:copy.point(p.e),parent:"pillar",parent_role:t.role,parent_anchor:t.anchor})}}var c=function(){let n=[];for(let e=0;e<walls.db.length;e++){let i=walls.db[e];if(i.isAvailable()){if(0!==i.walls_s.length)for(let e=0;e<i.walls_s.length;e++){var s=i.walls_s[e].wall,o=i.walls_s[e].type,s=walls.db[s];if(is_line_on_line(i.axis,s.axis)){let e=null,t=null;"s"===o&&(e={s:i.r1,e:s.l1},t={s:i.l1,e:s.r1}),"e"===o&&(e={s:i.r1,e:s.r2},t={s:i.l1,e:s.l2}),null!==e&&0<LIB.lineLength(e)&&are_lines_perpendicular(e,i.axis)&&n.push(e),null!==t&&0<LIB.lineLength(t)&&are_lines_perpendicular(t,i.axis)&&n.push(t)}}if(0!==i.walls_e.length)for(let e=0;e<i.walls_e.length;e++){var l=i.walls_e[e].wall,r=i.walls_e[e].type,l=walls.db[l];if(is_line_on_line(i.axis,l.axis)){let e=null,t=null;"s"===r&&(e={s:i.l2,e:l.l1},t={s:i.r2,e:l.r1}),"e"===r&&(e={s:i.l2,e:l.r2},t={s:i.r2,e:l.l2}),null!==e&&0<LIB.lineLength(e)&&are_lines_perpendicular(e,i.axis)&&n.push(e),null!==t&&0<LIB.lineLength(t)&&are_lines_perpendicular(t,i.axis)&&n.push(t)}}}}n=function(i){let n=[];e:for(let t=0;t<i.length;t++){for(let e=0;e<n.length;e++){if(are_lines_equal(n[e],i[t]))continue e;if(LIB.lineLength(i[t])<1)continue e}n.push(i[t])}return n}(n);for(let e=0;e<n.length;e++)LIB.lineLength(n[e])<.5&&(n.splice(e,1),e--);for(let e=0;e<n.length;e++)n[e].size="micro";return n}();for(let e=0;e<c.length;e++)s.push(c[e]);s=function(i){let n=[];e:for(let t=0;t<i.length;t++){for(let e=0;e<n.length;e++){if(are_lines_equal(n[e],i[t]))continue e;if(LIB.lineLength(i[t])<.2)continue e}n.push(i[t])}return n}(s);for(let e=0;e<s.length;e++){let t=s[e];if("wall"===t.parent){t.c=get_line_center(t);for(let e=0;e<pillars.db.length;e++){var A=pillars.db[e],u="init"===i&&"pillar"===A.role,w="build"===i&&("pillar"===A.role||"gypsum"===A.role);if(u||w){if(is_line_over_line(t,A.edge_t,.05)){t.remove=!0;break}if(is_line_over_line(t,A.edge_r,.05)){t.remove=!0;break}if(is_line_over_line(t,A.edge_b,.05)){t.remove=!0;break}if(is_line_over_line(t,A.edge_l,.05)){t.remove=!0;break}}}}}for(let e=0;e<s.length;e++)!0===s[e].remove&&(s.splice(e,1),e--);return s}walls={db:[],bind:function(t){for(let e=0;e<walls.db.length;e++)walls.db[e].bind(t)},calc:function(){for(let e=0;e<walls.db.length;e++)walls.db[e].calc()},init:function(){walls.erase();for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.isAvailable()&&e.init()}},draw:function(i){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.isAvailable()&&e.draw(i)}},redraw:function(){if("init"===plan||"break"===plan)for(let e=0;e<walls.db.length;e++)"init"===walls.db[e].label&&walls.db[e].redraw();if("build"===plan||"B"===plan_group)for(let e=0;e<walls.db.length;e++)walls.db[e].redraw()},copy:function(){let i=[];for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if(is_point_exists(t.s)&&is_point_exists(t.e)){let e={};if(t.links)for(var n in t.links)t.links.hasOwnProperty(n)&&t.links[n]&&t.links[n].id&&(e[t.links[n].id]=t.links[n].object);i.push({s:copy.point(t.s),e:copy.point(t.e),s_bak:t.s_bak,e_bak:t.e_bak,pos_s:t.pos_s,pos_e:t.pos_e,s_outer:copy.point(t.l1),s_inner:copy.point(t.r1),e_outer:copy.point(t.l2),e_inner:copy.point(t.r2),depth:t.depth,outer_depth:t.outer_depth,inner_depth:t.inner_depth,height:t.height,material:t.material,label:t.label,role:t.role,patch:t.patch,part:t.part,sector_id:t.sector_id,pillar:t.pillar,id:t.id,area:t.area,ventHoles:t.ventHoles,links:e})}}return i},paint:function(){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.selected=!1,e.paint()}},erase:function(){for(let e=0;e<walls.db.length;e++)walls.db[e].erase()},repair:function(){if("init"===plan)for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var i,n,s;"init"===e.label&&e.free.s&&e.free.e&&(i=is_point_exists(e.s),n=is_point_exists(e.e),s=e.length<e.depth/2,i||(console.warn("Стена",t," - Нет точки s"),project.errors.wallNoPointS++),n||(console.warn("Стена",t,"- Нет точки e"),project.errors.wallNoPointE++),s&&(console.warn("Стена",t,"- Слишком короткая"),project.errors.wallTooShort++),i&&n&&!s||(e.delete(),t--))}if("build"===plan)for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"build"===e.label&&e.length<e.depth/2&&(project.errors.wallTooShort++,e.delete(),t--)}if("build"===plan)for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if("build"===t.label){for(let e=0;e<walls.db.length;e++){var o=walls.db[e];"init"===o.label&&is_point_inside_polygon(t.c,o.polygon)&&(console.warn("wall_over_wall"),t.to_remove=!0,project.wallOverWall++)}for(let e=0;e<pillars.db.length;e++){var l=pillars.db[e];"pillar"===l.role&&is_point_inside_polygon(t.c,l.polygon)&&(t.to_remove=!0,project.wallOverWall++)}}}for(let e=0;e<walls.db.length;e++){var r,a,h=walls.db[e];if("init"===h.label)for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"build"===e.label&&(is_point_on_line(e.s,h.EdgeO)?(r=line_and_line_intersection(get_big_line(e),h))&&(e.s=copy.point(r)):is_point_on_line(e.s,h.EdgeI)&&(r=line_and_line_intersection(get_big_line(e),h))&&(e.s=copy.point(r)),is_point_on_line(e.e,h.EdgeO)?(a=line_and_line_intersection(get_big_line(e),h))&&(e.e=copy.point(a)):is_point_on_line(e.e,h.EdgeI)&&(a=line_and_line_intersection(get_big_line(e),h))&&(e.e=copy.point(a)))}}for(let e=0;e<walls.db.length;e++){let t=walls.db[e];for(let e=0;e<walls.db.length;e++){var g=walls.db[e];t.id!==g.id&&t.label===g.label&&is_line_over_line(t,g)&&(project.wallOverWall++,t.to_remove=!0)}}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];!0===e.to_remove&&(e.delete(),t--)}},define_inside_rooms_BAK:function(n){var s=ee(n);for(let e=0;e<s.length;e++){let i=s[e];i.sConnects=0;for(let t=i.eConnects=0;t<s.length;t++)if(t!==e){var o=s[t];let e=.5;"pillar"===i.parent&&(e=1),get_distance(i.s,o.s)<e?(i.slink={index:t,end:"S"},i.sConnects++):get_distance(i.s,o.e)<e&&(i.slink={index:t,end:"E"},i.sConnects++),get_distance(i.e,o.s)<e?(i.elink={index:t,end:"S"},i.eConnects++):get_distance(i.e,o.e)<e&&(i.elink={index:t,end:"E"},i.eConnects++)}}let i=[];for(let e=0;e<s.length;e++){var t=s[e];t.passed||(t=je(t,s))&&i.push(t)}for(let t=0;t<i.length;t++){let e=i[t];e.area=get_polygon_area(e)}function l(e,t){return e.area>t.area?-1:e.area<t.area?1:0}i.sort(l);var r,a=i[0];function e(t,i){let n=[];for(let e=0;e<t.length;e++){var s=t[e];s.area===i.area||is_point_inside_polygon(s[0],i)||(n.push(s),n.sort(l))}return 0<n.length&&n}drawings=[a];let h=e(i,a);for(;!1!==h;)drawings.push(h[0]),h=e(h,h[0]);for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.inside_room=!1}for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];e.inside_room=!1}if(a){for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if("init_copy"!==t.label&&!("init"===n&&"build"===t.label||"build"===n&&"break"===t.label)){let e=0;is_point_inside_polygon(t.l1,a)&&e++,is_point_inside_polygon(t.l2,a)&&e++,is_point_inside_polygon(t.r1,a)&&e++,is_point_inside_polygon(t.r2,a)&&e++,4===e&&(t.inside_room=!0)}}for(let i=0;i<pillars.db.length;i++){let e=pillars.db[i],t=0;is_point_inside_polygon(e.p1,a)&&t++,is_point_inside_polygon(e.p2,a)&&t++,is_point_inside_polygon(e.p3,a)&&t++,is_point_inside_polygon(e.p4,a)&&t++,4===t&&(e.inside_room=!0)}for(let e=0;e<11;e++){for(let e=0;e<walls.db.length;e++){let i=walls.db[e];if(!0===i.inside_room){if("init_copy"===i.label)continue;if("init"===n&&"build"===i.label)continue;if("build"===n&&"break"===i.label)continue;0<i.walls_s.length&&(!1===walls.db[i.walls_s[0].wall].inside_room&&(i.inside_room=!1),2===i.walls_s.length&&!1===walls.db[i.walls_s[1].wall].inside_room&&(i.inside_room=!1)),0<i.walls_e.length&&(!1===walls.db[i.walls_e[0].wall].inside_room&&(i.inside_room=!1),2===i.walls_e.length&&!1===walls.db[i.walls_e[1].wall].inside_room&&(i.inside_room=!1)),i.links.s&&("wall"===i.links.s.object&&!1===walls.db[i.links.s.index].inside_room&&(i.inside_room=!1),"pillar"===i.links.s.object&&("wall"===(r=pillars.db[i.links.s.index]).anchor&&(i.inside_room=!1),!1===r.inside_room&&(i.inside_room=!1))),i.links.e&&("wall"===i.links.e.object&&!1===walls.db[i.links.e.index].inside_room&&(i.inside_room=!1),"pillar"===i.links.e.object&&("wall"===(r=pillars.db[i.links.e.index]).anchor&&(i.inside_room=!1),!1===r.inside_room&&(i.inside_room=!1)));for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id===i.id||"init_copy"===e.label||"init"===i.label&&"build"===e.label||"init"===n&&"build"===e.label||"build"===n&&"break"===e.label||(e.links.s&&e.links.s.id===i.id&&!1===e.inside_room&&(i.inside_room=!1),e.links.e&&e.links.e.id===i.id&&!1===e.inside_room&&(i.inside_room=!1),(is_point_on_line(e.s,i.EdgeO)||is_point_on_line(e.s,i.EdgeI))&&(e.inside_room=!1),(is_point_on_line(e.e,i.EdgeO)||is_point_on_line(e.e,i.EdgeI))&&(e.inside_room=!1))}for(let e=0;e<pillars.db.length;e++){var g,_,d,p=pillars.db[e];!1===p.inside_room&&(g=get_point_near_line_center(i.l1,i.l2,3,"L"),_=get_point_near_line_center(i.r1,i.r2,3,"R"),is_point_inside_polygon(g,p.polygon)&&(i.inside_room=!1),is_point_inside_polygon(_,p.polygon)&&(i.inside_room=!1),g=get_point_near_line_center(p.p1,p.p2,3,"L"),_=get_point_near_line_center(p.p2,p.p3,3,"L"),d=get_point_near_line_center(p.p3,p.p4,3,"L"),p=get_point_near_line_center(p.p4,p.p1,3,"L"),(is_point_inside_polygon(g,i.polygon)||is_point_inside_polygon(_,i.polygon)||is_point_inside_polygon(d,i.polygon)||is_point_inside_polygon(p,i.polygon))&&(i.inside_room=!1))}}if(!1===i.inside_room)for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id!==i.id&&(e.links.s&&e.links.s.id===i.id&&(e.inside_room=!1),e.links.e&&e.links.e.id===i.id&&(e.inside_room=!1),(is_point_on_line(e.s,i.EdgeO)||is_point_on_line(e.s,i.EdgeI))&&(e.inside_room=!1),(is_point_on_line(e.e,i.EdgeO)||is_point_on_line(e.e,i.EdgeI))&&(e.inside_room=!1))}}for(let e=0;e<pillars.db.length;e++){let i=pillars.db[e];if(!0===i.inside_room){var c=get_point_near_line_center(i.p1,i.p2,3,"L"),A=get_point_near_line_center(i.p2,i.p3,3,"L"),u=get_point_near_line_center(i.p3,i.p4,3,"L"),w=get_point_near_line_center(i.p4,i.p1,3,"L");for(let e=0;e<walls.db.length;e++){var m=walls.db[e];!1!==m.inside_room||"init_copy"===m.label||"init"===n&&"build"===m.label||"build"===n&&"break"===m.label||(m.links.s&&"pillar"===m.links.s.object&&m.links.s.id===i.id&&(i.inside_room=!1),m.links.e&&"pillar"===m.links.e.object&&m.links.e.id===i.id&&(i.inside_room=!1),(is_point_inside_polygon(c,m.polygon)||is_point_inside_polygon(A,m.polygon)||is_point_inside_polygon(u,m.polygon)||is_point_inside_polygon(w,m.polygon))&&(i.inside_room=!1))}for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];!1===e.inside_room&&(is_point_inside_polygon(c,e.polygon)||is_point_inside_polygon(A,e.polygon)||is_point_inside_polygon(u,e.polygon)||is_point_inside_polygon(w,e.polygon))&&(i.inside_room=!1),!1===i.inside_room&&(is_point_inside_polygon(c,e.polygon)||is_point_inside_polygon(A,e.polygon)||is_point_inside_polygon(u,e.polygon)||is_point_inside_polygon(w,e.polygon))&&(e.inside_room=!1)}}}}}},define_inside_rooms:function(c){var n=ee(c,!1);for(let e=0;e<n.length;e++){let i=n[e];i.sConnects=0;for(let t=i.eConnects=0;t<n.length;t++)if(t!==e){var s=n[t];let e=.5;"pillar"===i.parent&&(e=1),get_distance(i.s,s.s)<e?(i.slink={index:t,end:"S"},i.sConnects++):get_distance(i.s,s.e)<e&&(i.slink={index:t,end:"E"},i.sConnects++),get_distance(i.e,s.s)<e?(i.elink={index:t,end:"S"},i.eConnects++):get_distance(i.e,s.e)<e&&(i.elink={index:t,end:"E"},i.eConnects++)}}let i=[];for(let e=0;e<n.length;e++){var t=n[e];t.passed||(t=je(t,n))&&i.push(t)}for(let t=0;t<i.length;t++){let e=i[t];e.area=get_polygon_area(e)}function o(e,t){return e.area>t.area?-1:e.area<t.area?1:0}i.sort(o);var l=i[0];function r(t,i){let n=[];for(let e=0;e<t.length;e++){var s=t[e];s.area===i.area||is_point_inside_polygon(s[0],i)||(n.push(s),n.sort(o))}return 0<n.length&&n}if(l){drawings=[l];let e=r(i,l);for(;!1!==e;)drawings.push(e[0]),e=r(e,e[0]);for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.inside_room=!0}for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];e.inside_room=!0}for(let e=0;e<drawings.length;e++){var a,h,g,_,d=get_polygon_edges(drawings[e]);for(let e=0;e<d.length;e++){let i=d[e];i.center=get_line_center(i);for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init_copy"===e.label||"init"===c&&"build"===e.label||"build"===c&&"break"===e.label||(is_point_on_line(i.center,e.EdgeO)||is_point_on_line(i.center,e.EdgeI))&&(e.inside_room=!1)}for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];"pillar_air"!==e.role&&"pillar_water"!==e.role&&(a=get_line_center(e.edge_t),h=get_line_center(e.edge_r),g=get_line_center(e.edge_b),_=get_line_center(e.edge_l),(is_point_on_line(a,i)||is_point_on_line(h,i)||is_point_on_line(g,i)||is_point_on_line(_,i))&&(e.inside_room=!1))}}}function p(){for(let e=0;e<10;e++)for(let e=0;e<walls.db.length;e++){let i=walls.db[e];if("init_copy"!==i.label&&!("init"===c&&"build"===i.label||"build"===c&&"break"===i.label)){var n,s,o,l,r,a,h=LIB.pointOnLine(i.e,i.s,3),g=LIB.pointOnLine(i.s,i.e,3);if(!1===i.inside_room){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"===c&&"build"===e.label||"build"===c&&"break"===e.label||!0===e.inside_room&&(is_point_on_line(e.s,i)&&(e.inside_room=!1),is_point_on_line(e.e,i)&&(e.inside_room=!1),!0===e.inside_room&&(n=LIB.pointOnLine(i.e,i.s,4),s=LIB.pointOnLine(i.s,i.e,4),is_point_inside_polygon(n,e.polygon)&&(e.inside_room=!1),is_point_inside_polygon(s,e.polygon)&&(e.inside_room=!1)),!0===e.inside_room&&(n=get_point_near_line_center(e.l1,e.l2,2,"L"),s=get_point_near_line_center(e.r1,e.r2,2,"R"),is_point_inside_polygon(n,i.polygon)&&(e.inside_room=!1),is_point_inside_polygon(s,i.polygon)&&(e.inside_room=!1)))}for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];!0===e.inside_room&&(o=get_point_near_line_center(e.p1,e.p2,5,"L"),l=get_point_near_line_center(e.p2,e.p3,5,"L"),r=get_point_near_line_center(e.p3,e.p4,5,"L"),a=get_point_near_line_center(e.p4,e.p1,5,"L"),(is_point_inside_polygon(o,i.polygon)||is_point_inside_polygon(l,i.polygon)||is_point_inside_polygon(r,i.polygon)||is_point_inside_polygon(a,i.polygon))&&(e.inside_room=!1),(is_point_inside_polygon(h,e.polygon)||is_point_inside_polygon(g,e.polygon))&&(e.inside_room=!1),!0===e.inside_room&&(is_point_on_line(e.p1,i.EdgeO)||is_point_on_line(e.p2,i.EdgeO)||is_point_on_line(e.p3,i.EdgeO)||is_point_on_line(e.p4,i.EdgeO))&&(e.inside_room=!1),!0===e.inside_room&&(is_point_on_line(e.p1,i.EdgeI)||is_point_on_line(e.p2,i.EdgeI)||is_point_on_line(e.p3,i.EdgeI)||is_point_on_line(e.p4,i.EdgeI))&&(e.inside_room=!1))}}if(!0===i.inside_room){for(let e=0;e<walls.db.length;e++){var t,_,d=walls.db[e];"init_copy"===d.label||"init"===c&&"build"===d.label||"build"===c&&"break"===d.label||d.id!==i.id&&(!1===d.inside_room&&(is_point_on_line(d.s,i)&&(i.inside_room=!1),is_point_on_line(d.e,i)&&(i.inside_room=!1)),!1===d.inside_room&&(t=LIB.pointOnLine(i.e,i.s,4),_=LIB.pointOnLine(i.s,i.e,4),is_point_inside_polygon(t,d.polygon)&&(i.inside_room=!1),is_point_inside_polygon(_,d.polygon)&&(i.inside_room=!1)),!1===d.inside_room&&(t=get_point_near_line_center(d.l1,d.l2,2,"L"),_=get_point_near_line_center(d.r1,d.r2,2,"R"),is_point_inside_polygon(t,i.polygon)&&(i.inside_room=!1),is_point_inside_polygon(_,i.polygon)&&(i.inside_room=!1)))}for(let e=0;e<pillars.db.length;e++){var p=pillars.db[e];"pillar"!==p.role&&"gypsum"!==p.role||!1===p.inside_room&&(is_point_inside_polygon(h,p.polygon)||is_point_inside_polygon(g,p.polygon))&&(i.inside_room=!1)}}}}}p();for(let e=0;e<2;e++)e:for(let e=0;e<pillars.db.length;e++){let i=pillars.db[e];if(("init"!==c||"pillar"===i.role)&&("build"!==c||"pillar_water"!==i.role&&"pillar_air"!==i.role)){var A=get_point_near_line_center(i.p1,i.p2,3,"L"),u=get_point_near_line_center(i.p2,i.p3,3,"L"),w=get_point_near_line_center(i.p3,i.p4,3,"L"),m=get_point_near_line_center(i.p4,i.p1,3,"L"),f=LIB.pointOnLine(i.p3,i.p1,3,"L"),I=LIB.pointOnLine(i.p4,i.p2,3,"L"),C=LIB.pointOnLine(i.p1,i.p3,3,"L"),y=LIB.pointOnLine(i.p2,i.p4,3,"L");if(!0===i.inside_room)for(let e=0;e<pillars.db.length;e++){var b=pillars.db[e];if(!1===b.inside_room&&((is_point_inside_polygon(A,b.polygon)||is_point_inside_polygon(u,b.polygon)||is_point_inside_polygon(w,b.polygon)||is_point_inside_polygon(m,b.polygon))&&(i.inside_room=!1),!1===i.inside_room))continue e}if(!1===i.inside_room){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if(!0===e.inside_room&&((is_point_inside_polygon(A,e.polygon)||is_point_inside_polygon(u,e.polygon)||is_point_inside_polygon(w,e.polygon)||is_point_inside_polygon(m,e.polygon))&&(e.inside_room=!1),!1===e.inside_room))continue e}for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];if(!0===e.inside_room&&((is_point_inside_polygon(A,e.polygon)||is_point_inside_polygon(u,e.polygon)||is_point_inside_polygon(w,e.polygon)||is_point_inside_polygon(m,e.polygon))&&(e.inside_room=!1),!0===e.inside_room&&(is_point_inside_polygon(f,e.polygon)||is_point_inside_polygon(I,e.polygon)||is_point_inside_polygon(C,e.polygon)||is_point_inside_polygon(y,e.polygon))&&(e.inside_room=!1),!1===i.inside_room))continue e}}}}p()}},get_axis_lines:function(){layers.temp_images.clear();for(let e=0;e<walls.db.length;e++)walls.db[e].get_axis_lines()},delete:function(){walls.erase(),walls.db=[]},JSON:{before:"",after:"",make:function(){let t=[];for(let e=0;e<walls.db.length;e++){var i=walls.db[e];"init"===i.label&&t.push(i.id)}return JSON.stringify(t)}},connect:function(){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if(i.id!==t.id){var n,s=is_point_on_line(t.s,i.EdgeO);let e=is_point_on_line(t.s,i.EdgeI);!s&&!e||(n=LIB.projection(t.s,i.axis))&&(t.s=n,t.s_bak=void 0),s=is_point_on_line(t.e,i.EdgeO),e=is_point_on_line(t.e,i.EdgeI),!s&&!e||(n=LIB.projection(t.e,i.axis))&&(t.e=n,t.e_bak=void 0)}}}walls.draw()},restore:function(t){walls.db=[];for(let e=0;e<t.length;e++){var i=t[e];in_array(i.label,["init","init_copy","break","build"])&&walls.db.push(new j(i))}}},pillars={db:[],borders:[],draw:function(){for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];e.erase(),("init"!==plan&&"break"!==plan||"build"!==e.plan)&&e.draw()}pillars.borders=[];for(let i=0;i<pillars.db.length;i++){var n=pillars.db[i];if("pillar"===n.role)for(let t=0;t<n.borders.length;t++){let e=n.borders[t];e.pillar_index=i,pillars.borders.push(e)}}},bind:function(){for(let e=0;e<pillars.db.length;e++)pillars.db[e].bind()},get:function(i){for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];e.get(i)}},copy:function(){let i=[];for(let t=0;t<pillars.db.length;t++){var n=pillars.db[t];let e=[];"gypsum"===n.role&&"wall"===n.anchor&&!0===n.edge_b__on_wall&&!1===n.edge_t__on_wall&&(!1===n.edge_l__on_wall&&e.push(n.edge_l),e.push(n.edge_t),!1===n.edge_r__on_wall&&e.push(n.edge_r)),i[t]={plan:n.plan,role:n.role,background:n.background,center:copy_point(n.center),bp:n.bp,width:n.width,height:n.height,anchor:n.anchor,angle:n.angle,id:n.id,id_room:n.id_room,inside_room:n.inside_room,p1:n.p1,p2:n.p2,p3:n.p3,p4:n.p4,props:n.props||{},edges:e}}return i},paint:function(){for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];e.selected=!1,e.paint(!1)}},erase:function(){for(let e=0;e<pillars.db.length;e++)pillars.db[e].erase()},delete:function(){pillars.erase(),pillars.db=[]},restore:function(t){pillars.db=[];for(let e=0;e<t.length;e++){var i=t[e].center,n=t[e].width,s=t[e].height,o=Math.max(n,s);!is_point_exists(i)||t[e].p1&&!is_point_exists(t[e].p1)||0===s||0===n||Math.abs(i.x)>1e5-o||Math.abs(i.y)>1e5-o||pillars.db.push(new H(t[e],!1))}}},sectors={db:[],bind:function(){for(let e=0;e<sectors.db.length;e++)sectors.db[e].bind("wall"),sectors.db[e].bind("sectors")},draw:function(t){for(let e=0;e<sectors.db.length;e++)sectors.db[e].draw(t)},copy:function(){let t=[];for(let e=0;e<sectors.db.length;e++){var i=sectors.db[e];t.push({id:i.id,s:copy.point(i.s),e:copy.point(i.e),height:i.height,id_wall:i.id_wall,wall_index:i.wall_index,like_wall:i.like_wall,area:i.area})}return t},erase:function(){for(let e=0;e<sectors.db.length;e++)sectors.db[e].erase},delete:function(){sectors.erase(),sectors.db=[]},JSON:{before:"",after:"",make:function(){let t=[];for(let e=0;e<sectors.db.length;e++){var i=sectors.db[e];t.push(i.s,i.e,i.id)}return JSON.stringify(t)}}},windows={db:[],expand:function(){for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.expand()}},bind:function(){for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.bind()}},draw:function(){for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.erase(),"init"!==plan&&"break"!==plan||(e.draw(),e.DIMENSION.show()),"build"!==plan&&"B"!==plan_group||!1===e.demount&&(e.draw(),e.DIMENSION.show()),"B"===plan_group&&e.DIMENSION.hide()}},hide:function(e){if(!e)for(let e=0;e<windows.db.length;e++)windows.db[e].hide();if(e&&"dimensions"===e)for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.DIMENSION.hide()}},show:function(){for(let e=0;e<windows.db.length;e++)windows.db[e].show()},copy:function(){let t=[];for(let e=0;e<windows.db.length;e++){var i=windows.db[e];t[e]={center:copy.point(i.center),s:copy.point(i.s),e:copy.point(i.e),width:i.width,height:i.height,demount:i.demount,floor_height:i.floor_height,angle:i.angle,type:i.type,opening:i.opening,window_width:i.window_width,window_height:i.window_height,door_width:i.door_width,door_height:i.door_height,door_position:i.door_position,slopes:i.slopes,label:i.label,plan:i.plan,id:i.id,id_wall:i.id_wall,room_o:i.room_o,room_i:i.room_i,break:i.break,area:i.area,custom_options:i.custom_options,values:i.values},i.l1&&(t[e].s_outer=i.l1),i.l2&&(t[e].e_outer=i.l2),i.r1&&(t[e].s_inner=i.r1),i.r2&&(t[e].e_inner=i.r2)}return t},restore:function(i){windows.db=[];for(let t=0;t<i.length;t++){let e=i[t];e&&(e.l1&&(e.l1=LIB.copyPoint(e.l1),delete e.l1),e.l2&&(e.l2=LIB.copyPoint(e.l2),delete e.l2),e.r1&&(e.r1=LIB.copyPoint(e.r1),delete e.r1),e.r2&&(e.r2=LIB.copyPoint(e.r2),delete e.r2),windows.db.push(new u(e)))}},paint:function(){for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.selected=!1,e.paint()}},erase:function(){for(let e=0;e<windows.db.length;e++)windows.db[e].erase()},delete:function(){windows.erase(),windows.db=[]}},doors={db:[],draw:function(){if("init"===plan||"break"===plan)for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.erase(),"init"===e.plan&&e.draw()}if("build"===plan||"B"===plan_group)for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.erase(),e.hasReplacement||e.demount||e.draw()}},expand:function(){for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.expand()}},hide:function(){for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.hide()}},show:function(){for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.show()}},copy:function(){let t=[];for(let e=0;e<doors.db.length;e++){var i=doors.db[e];t[e]={center:copy.point(i.center),s:copy.point(i.s),e:copy.point(i.e),width:i.width,height:i.height,angle:i.angle,type:i.type,opening:i.opening,plan:i.plan,id:i.id,id_wall:i.id_wall,room_o:i.room_o,room_i:i.room_i,area:i.area,entrance:i.entrance,demount:i.demount,hasReplacement:i.hasReplacement,replacement:i.replacement,values:i.values},i.l1&&(t[e].s_outer=i.l1),i.l2&&(t[e].e_outer=i.l2),i.r1&&(t[e].s_inner=i.r1),i.r2&&(t[e].e_inner=i.r2)}return t},restore:function(i){doors.db=[];for(let t=0;t<i.length;t++){let e=i[t];e&&(e.l1&&(e.l1=LIB.copyPoint(e.l1),delete e.l1),e.l2&&(e.l2=LIB.copyPoint(e.l2),delete e.l2),e.r1&&(e.r1=LIB.copyPoint(e.r1),delete e.r1),e.r2&&(e.r2=LIB.copyPoint(e.r2),delete e.r2),e.demount||(!0===e.remove&&(e.demount=!0),!0===e.break&&(e.demount=!0)),doors.db[t]=new w(e))}},paint:function(){for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.selected=!1,e.paint()}},erase:function(){for(let e=0;e<doors.db.length;e++)doors.db[e].erase()},delete:function(){doors.erase(),doors.db=[]}},items={db:[],draw:function(){console.warn("items.draw()");for(let t=0;t<items.db.length;t++){let e=items.db[t];e.erase(),("init"!==plan&&"break"!==plan||"build"!==e.plan)&&e.draw()}},setParents:function(){for(let t=0;t<items.db.length;t++){let e=items.db[t];e.get("parentRoom"),e.get("parentWall"),e.get("parentPillar")}},setLayers:function(e){for(let t=0;t<items.db.length;t++){let e=items.db[t];e.setLayers()}},copy:function(){let t=[];for(let e=0;e<items.db.length;e++)items.db[e].props.tp&&delete items.db[e].props.tp,items.db[e].props.bp&&delete items.db[e].props.bp,items.db[e].props.lp&&delete items.db[e].props.lp,items.db[e].props.rp&&delete items.db[e].props.rp,t[e]=Object.assign({},items.db[e].props);for(let e=0;e<t.length;e++)delete t[e].settings.path;return t},restore:function(n){items.db=[];for(let i=0;i<n.length;i++){let t=n[i];if("ceiling"===t.settings.anchor&&(t.dimensions.display=!0),in_array(t.name,["ruler","moving"]))for(var s in tools)if(tools[s].id===t.settings.id){let e=t.name;t.name=s,send_warning_signals(signal_types[7],"Исправление предметов с некорректным названием: ",t.id+" '"+t.name+"' "+e.substr(0,3),1,0);break}let e="";var o=Math.abs(t.width,t.height);!1===t.center&&"electrospot_node"===t.name&&(e="node center false"),Math.abs(t.center.x)>1e5-o&&(e="x > 100000"),Math.abs(t.center.y)>1e5-o&&(e="y > 100000"),0===t.center.x&&0===t.center.y&&(e="xy = 0"),""!==(e=null===t.center.x&&null===t.center.y?"xy = null":e)&&(send_warning_signals(signal_types[6],"Удаление бракованных предметов: ",t.id+" ("+t.name+") '"+e+"'",1,1),LogItems.remove_bad(t.id,t.name,e),console.warn(i,"Bad item deleted"),n.splice(i,1),i--)}for(let t=0;t<n.length;t++)try{items.db.push(new _(n[t]))}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e),send_warning_signals(signal_types[17],"Пропал item после ошибки: ",n[t].id,1,1)}},paint:function(){for(let t=0;t<items.db.length;t++){let e=items.db[t];e.paint()}},hide:function(){for(let e=0;e<items.db.length;e++)items.db[e].hide()},show:function(t){for(let e=0;e<items.db.length;e++)items.db[e].show(t)},erase:function(){for(let e=0;e<items.db.length;e++)items.db[e].erase()},delete:function(){items.erase(),items.db=[]},build_dimensions:function(){if("light"===plan)for(let e=0;e<items.db.length;e++)in_array(items.db[e].props.name,light_reference_lines.tools)&&(items.db[e].lines.clear(),items.db[e].build("XDimensions"))}},comments={db:[],isAvailable:function(e){return e.plan===plan||!(!in_array(e.name_item,["electric_shield","electric_shield_internal","electric_shield_old"])||!in_array(plan,["sockets","cables"]))&&("electric_shield_old"!==e.name_item||(e=get_item(e.id_item))&&e.props&&!1===e.props.demount)},draw:function(){for(let t=0;t<comments.db.length;t++){let e=comments.db[t];var i=this.isAvailable(e);i&&(e.draw(),e.show()),i||e.hide()}for(let t=0;t<comments.db.length;t++){let e=comments.db[t];this.isAvailable(e)&&(e.draw(),e.show())}},copy:function(i){let n=[];for(let t=0;t<comments.db.length;t++){let e=comments.db[t];i&&"server"===i&&(e.text=e.text.replace(/'/g,"`"),e.text=e.text.replace(/"/g,"``")),n[t]={s:copy.point(e.s),center:copy.point(e.center),text:e.text,label:e.label,plan:e.plan,id:e.id,id_item:e.id_item,name_item:e.name_item||"",color:e.color||"#000000"}}return n},restore:function(t){comments.db=[];for(let e=0;e<t.length;e++)t[e].text=t[e].text.replace(/`/g,"'"),t[e].text=t[e].text.replace(/``/g,'"'),comments.db[e]=new Comment(t[e])},show:function(e){if(!e)for(let e=0;e<comments.db.length;e++)comments.db[e].show();if(e)for(let e=0;e<comments.db.length;e++)this.isAvailable(comments.db[e])&&comments.db[e].show()},hide:function(){for(let e=0;e<comments.db.length;e++)comments.db[e].hide()},erase:function(){for(let e=0;e<comments.db.length;e++)comments.db[e].erase()},delete:function(){comments.erase(),comments.db=[]}},window.rulers={db:[],draw:function(){for(let t=0;t<rulers.db.length;t++){let e=rulers.db[t];e.plan===plan&&e.draw()}},copy:function(){let t=[];for(let e=0;e<rulers.db.length;e++)t[e]={s:copy.point(rulers.db[e].s),e:copy.point(rulers.db[e].e),plan:rulers.db[e].plan,id:rulers.db[e].id};return t},show:function(t){if(!t)for(let e=0;e<rulers.db.length;e++)rulers.db[e].show();if(t)for(let e=0;e<rulers.db.length;e++)rulers.db[e].plan===t&&rulers.db[e].show()},hide:function(){for(let e=0;e<rulers.db.length;e++)rulers.db[e].hide()},erase:function(){for(let e=0;e<rulers.db.length;e++)rulers.db[e].erase()},delete:function(){rulers.erase(),rulers.db=[]},restore:function(t){rulers.db=[];for(let e=0;e<t.length;e++)rulers.db[e]=new U(t[e])}},window.questions={db:[],bind:function(){for(let e=0;e<questions.db.length;e++)questions.db[e].bind()},copy:function(){let t=[];for(let e=0;e<questions.db.length;e++){var i=questions.db[e];t[e]={s:i.s,e:i.e,center:i.center,s_wall:i.s_wall,e_wall:i.e_wall,plan:i.plan,id:i.id}}return t},erase:function(){for(let e=0;e<questions.db.length;e++)questions.db[e].erase()},update:function(){for(let t=0;t<questions.db.length;t++){let e=questions.db[t];e.erase(),e.plan===plan&&e.update()}},restore:function(t){questions.db=[];for(let e=0;e<t.length;e++)questions.db[e]=new J(t[e])},delete:function(){questions.erase(),questions.db=[]}},window.led_strips={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(i,n){if(this.db=[],i)for(let t=0;t<i.length;t++)if(this.db[t]=new LedStrip(i[t]),i[t].s&&i[t].e){var s,o=striping_led.add_node_item(this.db[t].type,i[t].s,i[t].id_room),l=this.db[t].addNode(o,o.props.id,{center:i[t].e,id_room:i[t].id_room});if(this.db[t].updateData(),i[t].cable_id)for(let e=0;e<n.length;e++)if(n[e].id===i[t].cable_id&&n[e].led_strips_connections)for(var r in n[e].led_strips_connections)n[e].led_strips_connections.hasOwnProperty(r)&&((s=r.split("-"))[0]===this.db[t].id?"s"===n[e].led_strips_connections[r][0]?n[e].led_strips_connections[r][0]=o.props.id:"e"===n[e].led_strips_connections[r][0]&&(n[e].led_strips_connections[r][0]=l.props.id):s[1]===this.db[t].id&&("s"===n[e].led_strips_connections[r][1]?n[e].led_strips_connections[r][1]=o.props.id:"e"===n[e].led_strips_connections[r][1]&&(n[e].led_strips_connections[r][1]=l.props.id)))}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.line_strips={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t,e){if(this.db=[],t)for(let e=0;e<t.length;e++)this.db[e]=new LineStrip(t[e])},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.cables={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t){for(let e=0;e<t.length;e++)void 0===t[e].v&&(t[e].v=1),this.db[e]=new Cable(t[e]);for(let e=this.db.length-1;0<=e;e--)this.db[e].checkValid();for(let i=0;i<items.db.length;i++)if("socket_group"===items.db[i].props.name&&items.db[i].props.cables&&items.db[i].props.socket_group&&1===items.db[i].props.socket_group.length&&cabling.switches_list[items.db[i].props.socket_group[0].name]){items.db[i].props.socket_group[0].cables=items.db[i].props.cables,delete items.db[i].props.cables;for(let t=0;t<items.db[i].props.socket_group[0].cables.length;t++){let e=get_cable(items.db[i].props.socket_group[0].cables[t]);e&&(e.socket_group_ids[items.db[i].props.id]=items.db[i].props.socket_group[0].id)}}for(let l=0;l<this.db.length;l++)if(1===this.db[l].v){let e=this.db[l],t=JSON.stringify(e.connections),i=JSON.stringify(e.points_connections),n=JSON.stringify(e.items),s=JSON.stringify(e.switches),o=JSON.stringify(e.strips_connections);for(var r in e.socket_group_ids){var a;e.socket_group_ids.hasOwnProperty(r)&&(a=e.socket_group_ids[r],t=t.replace(r,r+"|s|"+a),i=i.replace(r,r+"|s|"+a),n=n.replace(r,r+"|s|"+a),s=s.replace(r,r+"|s|"+a),o=o.replace(r,r+"|s|"+a))}e.connections=JSON.parse(t),e.points_connections=JSON.parse(i),e.items=JSON.parse(n),e.switches=JSON.parse(s),e.strips_connections=JSON.parse(o),e.v=2,e.draw()}}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.pipes={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t){for(let e=0;e<t.length;e++)this.db[e]=new Pipe(t[e]);for(let e=this.db.length-1;0<=e;e--)this.db[e].checkValid()}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.cables_socket={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t){for(let e=0;e<t.length;e++)void 0===t[e].v&&(t[e].v=1),this.db[e]=new CableSocket(t[e]);for(let e=this.db.length-1;0<=e;e--)this.db[e].checkValid();for(let n=0;n<items.db.length;n++)if("socket_group"===items.db[n].props.name&&items.db[n].props.cables_socket&&items.db[n].props.socket_group){for(var s in items.db[n].props.cables_socket)if(items.db[n].props.cables_socket.hasOwnProperty(s)){var o=array_flip(cabling_socket.names_line_id_by_tool)[s];let t=0,i="";if(o){var l=!in_array(o,cabling_socket.tools_lowcurrent);for(let e=0;e<items.db[n].props.socket_group.length;e++){if(l&&cabling_socket.sockets_power_in_group[items.db[n].props.socket_group[e].name]){t=e,i=items.db[n].props.socket_group[e].id;break}if(!l&&cabling_socket.sockets_lowcurrent_in_group[items.db[n].props.socket_group[e].name]){t=e,i=items.db[n].props.socket_group[e].id;break}}}items.db[n].props.socket_group[t].cables_socket||(items.db[n].props.socket_group[t].cables_socket={}),items.db[n].props.socket_group[t].cables_socket[s]=items.db[n].props.cables_socket[s];let e=get_cable_socket(items.db[n].props.cables_socket[s]);e&&(e.socket_group_ids[items.db[n].props.id]=i)}delete items.db[n].props.cables_socket}for(let s=0;s<this.db.length;s++)if(1===this.db[s].v){let e=this.db[s],t=JSON.stringify(e.connections),i=JSON.stringify(e.points_connections),n=JSON.stringify(e.items);for(var r in e.socket_group_ids){var a;e.socket_group_ids.hasOwnProperty(r)&&(a=e.socket_group_ids[r],t=t.replace(r,r+"|s|"+a),i=i.replace(r,r+"|s|"+a),n=n.replace(r,r+"|s|"+a))}e.connections=JSON.parse(t),e.points_connections=JSON.parse(i),e.items=JSON.parse(n),e.v=2,e.draw()}}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.cables_warm_floor={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t){for(let e=0;e<t.length;e++)this.db[e]=new CableWarnFloor(t[e]);for(let e=this.db.length-1;0<=e;e--)this.db[e].checkValid()}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.pipes_conditioner={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t){for(let e=0;e<t.length;e++)this.db[e]=new PipeConditioner(t[e]);for(let e=this.db.length-1;0<=e;e--)this.db[e].checkValid()}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.cables_conditioner={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t){for(let e=0;e<t.length;e++)this.db[e]=new CableConditioner(t[e]);for(let e=this.db.length-1;0<=e;e--)this.db[e].checkValid()}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.pipes_heat={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t){for(let e=0;e<t.length;e++)this.db[e]=new PipeHeat(t[e]);for(let e=this.db.length-1;0<=e;e--)this.db[e].checkValid()}},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}},window.stripes_light={db:[],draw:function(){for(let e=0;e<this.db.length;e++)this.db[e].draw()},show:function(){for(let e=0;e<this.db.length;e++)this.db[e].show()},hide:function(){for(let e=0;e<this.db.length;e++)this.db[e].hide()},erase:function(){for(let e=0;e<this.db.length;e++)this.db[e].erase()},copy:function(){let t=[];for(let e=0;e<this.db.length;e++)t[e]=this.db[e].serialize();return t},restore:function(t){if(this.db=[],t)for(let e=0;e<t.length;e++)this.db[e]=new StripLight(t[e])},delete:function(){this.erase(),this.db=[]},paint:function(){for(let e=0;e<this.db.length;e++)this.db[e].paint()},update_length:function(){for(let e=0;e<this.db.length;e++)this.db[e].updateLength()}};let te=[],ie=[];function se(d){if(project.print_mode=!0,0===walls.db.length&&0===pillars.db.length)warning.show("yellow",l10n.pdf_project_empty);else{background.remove(),$("#fog").show(),$("#fog_message").html(l10n.pdf_prepare_file).show(),item_plus.hide(),item_minus.hide(),z.reset(),N.plan=plan,plan_names.forEach(e=>{e.print=!1});for(let e=0;e<walls.db.length;e++)if("init"===walls.db[e].label){plan_names.forEach(e=>{"init"===e.sys&&(e.print=!0)});break}for(let e=0;e<pillars.db.length;e++)if("pillar"===pillars.db[e].role){plan_names.forEach(e=>{"init"===e.sys&&(e.print=!0)});break}0<sectors.db.length&&plan_names.forEach(e=>{"break"===e.sys&&(e.print=!0),"build"===e.sys&&(e.print=!0)});for(let e=0;e<walls.db.length;e++)if("break"===walls.db[e].label){plan_names.forEach(e=>{"break"===e.sys&&(e.print=!0)});break}for(let e=0;e<doors.db.length;e++)if(!0===doors.db[e].demount){plan_names.forEach(e=>{"break"===e.sys&&(e.print=!0)});break}for(let e=0;e<doors.db.length;e++)if("build"===doors.db[e].plan){plan_names.forEach(e=>{"build"===e.sys&&(e.print=!0)});break}for(let e=0;e<windows.db.length;e++)if(!0===windows.db[e].demount){plan_names.forEach(e=>{"break"===e.sys&&(e.print=!0)});break}for(let e=0;e<walls.db.length;e++)if("build"===walls.db[e].label){plan_names.forEach(e=>{"build"===e.sys&&(e.print=!0)});break}for(let e=0;e<pillars.db.length;e++)if("gypsum"===pillars.db[e].role){plan_names.forEach(e=>{"build"===e.sys&&(e.print=!0)});break}for(let e=0;e<comments.db.length;e++){let t=comments.db[e];"free"===t.label&&plan_names.forEach(e=>{e.sys===t.plan&&(e.print=!0)})}for(let e=0;e<freelines.db.length;e++){let t=freelines.db[e];plan_names.forEach(e=>{e.sys===t.plan&&(e.print=!0)})}for(let e=0;e<rulers.db.length;e++){let t=rulers.db[e];plan_names.forEach(e=>{e.sys===t.plan&&(e.print=!0)})}for(let t=0;t<items.db.length;t++){let e=items.db[t];e.model.plan.hasOwnProperty("radiators")&&plan_names.forEach(e=>{"radiators"===e.sys&&(e.print=!0)})}for(let t=0;t<items.db.length;t++){let e=items.db[t];e.model.plan.hasOwnProperty("furniture")&&plan_names.forEach(e=>{"furniture"===e.sys&&(e.print=!0)})}0<led_strips.db.length&&plan_names.forEach(e=>{"light"===e.sys&&(e.print=!0)}),0<line_strips.db.length&&plan_names.forEach(e=>{"light"===e.sys&&(e.print=!0)}),0<stripes_light.db.length&&plan_names.forEach(e=>{"light"===e.sys&&(e.print=!0)}),0<pipes.db.length&&plan_names.forEach(e=>{"water"===e.sys&&(e.print=!0)}),0<cables_socket.db.length&&plan_names.forEach(e=>{"cables"===e.sys&&(e.print=!0)}),0<pipes_conditioner.db.length&&plan_names.forEach(e=>{"conditioners"===e.sys&&(e.print=!0)}),0<cables_conditioner.db.length&&plan_names.forEach(e=>{"conditioners"===e.sys&&(e.print=!0)}),0<cables_warm_floor.db.length&&plan_names.forEach(e=>{"warm_floor"===e.sys&&(e.print=!0)}),0<pipes_heat.db.length&&plan_names.forEach(e=>{"radiators"===e.sys&&(e.print=!0)});for(let t=0;t<items.db.length;t++){let e=items.db[t];e.model.plan.hasOwnProperty("santeh")&&plan_names.forEach(e=>{"santeh"===e.sys&&(e.print=!0)}),e.model.plan.hasOwnProperty("sockets")&&plan_names.forEach(e=>{"sockets"===e.sys&&(e.print=!0)}),e.model.plan.hasOwnProperty("water")&&plan_names.forEach(e=>{"water"===e.sys&&(e.print=!0)}),"lights"!==e.model.group&&!e.model.plan.hasOwnProperty("light")||plan_names.forEach(e=>{"light"===e.sys&&(e.print=!0),"light_connections"===e.sys&&(e.print=!0)}),"switches"!==e.model.group&&!e.model.plan.hasOwnProperty("light_connections")||plan_names.forEach(e=>{"light_connections"===e.sys&&(e.print=!0)}),in_array(e.props.name,["conditioner","conditioner_engine","fan","floor_conditioner","duct_indoor_block","cassette_indoor_block","external_block_multisplit","breezer","inflow_valve","recuperator"])&&plan_names.forEach(e=>{"conditioners"===e.sys&&(e.print=!0)}),e.model.plan.hasOwnProperty("cables")&&plan_names.forEach(e=>{"cables"===e.sys&&(e.print=!0)}),!0===e.props.demount&&plan_names.forEach(e=>{"break"===e.sys&&(e.print=!0)})}for(let e=0;e<rooms2.data.length;e++){var p=rooms2.data[e];for(let e=0;e<p.zones.length;e++)if("none"!==p.zones[e].name){plan_names.forEach(e=>{"rooms"===e.sys&&(e.print=!0)});break}for(let e=0;e<p.delimiters.length;e++)if("zone"===p.delimiters[e].type){plan_names.forEach(e=>{"build"===e.sys&&(e.print=!0)});break}0<p.warm_floors.length&&plan_names.forEach(e=>{"warm_floor"===e.sys&&(e.print=!0)});for(let e=0;e<p.floors.length;e++)!0===p.floors[e].exist&&plan_names.forEach(e=>{"floor"===e.sys&&(e.print=!0)});for(let e=0;e<p.decor.length;e++)!0===p.decor[e].exist&&plan_names.forEach(e=>{"walls"===e.sys&&(e.print=!0)});for(let e=0;e<p.ceilings.length;e++)!0===p.ceilings[e].exist&&plan_names.forEach(e=>{"ceiling"===e.sys&&(e.print=!0)});for(let e=0;e<p.isolation.length;e++)!0===p.isolation[e].exist&&plan_names.forEach(e=>{"isolation"===e.sys&&(e.print=!0)});for(let e=0;e<p.hydroisolation.length;e++)!0===p.hydroisolation[e].exist&&plan_names.forEach(e=>{"hydroisolation"===e.sys&&(e.print=!0)});for(let e=0;e<p.plaster.length;e++)!0===p.plaster[e].exist&&plan_names.forEach(e=>{"plaster"===e.sys&&(e.print=!0)});"none"!==p.cap&&plan_names.forEach(e=>{"floor_cap"===e.sys&&(e.print=!0)})}project.font="big";let n=plan_names.slice();for(let e=0;e<n.length;e++)!1===n[e].print&&(n.splice(e,1),e--);console.warn(n),$("#fog_message").html(l10n.pdf_prepare_file+"<br>"+l10n.pdf_page_from.replace("[x]",n.length));let t;"A3"===d&&(t={width:page_formats.a3[1],height:page_formats.a3[0]}),"A4"===d&&(t={width:page_formats.a4[1],height:page_formats.a4[0]});d=W();let i=LIB.point(t.width/2,t.height/2);var c=d.center,A=d.width,d=d.height;let s={lOffset:25,tOffset:10,rOffset:10,bOffset:10},e=(s.x1=s.lOffset,s.y1=s.tOffset,s.x2=t.width-s.lOffset-s.rOffset,s.y2=t.height-s.tOffset-s.bOffset,{}),o=(e.lOffset=s.lOffset+20,e.tOffset=s.tOffset+20,e.rOffset=s.rOffset+20,e.bOffset=s.bOffset+60,e.x1=e.lOffset,e.y1=e.tOffset,e.x2=t.width-e.lOffset-e.rOffset,e.y2=t.height-e.tOffset-e.bOffset,e.width=e.x2,e.height=e.y2,svg.viewbox()),l=i.x-c.x+s.lOffset/2,r=i.y-c.y-e.bOffset/2;i.x-=l,i.y-=r;c=e.width/A,A=e.height/d;let a=Math.min(c,A);1<=a&&(a=1),grid.remove(),serviceLayer.hide();let h,g=new PDFUploader,_=new jsPDF("l","pt",[t.height,t.width]);function u(e){plan=n[e-1].sys,plan_group="init"===plan||"break"===plan||"build"===plan?"A":"B",visibility.set(plan),project.draw(),svg.viewbox({x:0-l,y:0-r,width:canvas.width(),height:canvas.height()}),svg.zoom(a,i),stamp.clear(),stamp=function(e){let t=svg_for_stamp.group();return t.rect(420,80).stroke("#000").fill("#ffffff"),t.line(240,20,420,20).stroke("#000"),t.line(240,40,420,40).stroke("#000"),t.line(240,0,240,80).stroke("#000"),t.line(300,0,300,40).stroke("#000"),t.line(360,0,360,40).stroke("#000"),t.text(e.plan).stroke("#000").font({family:"Arial","stroke-width":0,size:20}).cx(120).cy(40),t.text(e.studio).stroke("#000").font({family:"Arial","stroke-width":0,size:16,stroke:"#b21841",fill:"#b21841"}).cx(330).cy(60),t.text(l10n.pdf_title_stage).stroke("#000").font({family:"Arial","stroke-width":0,size:14}).cx(270).cy(10),t.text(l10n.pdf_stage).stroke("#000").font({family:"Arial","stroke-width":0,size:14}).cx(270).cy(30),t.text(l10n.pdf_title_page).stroke("#000").font({family:"Arial","stroke-width":0,size:14}).cx(330).cy(10),t.text(e.page.toString()).stroke("#000").font({family:"Arial","stroke-width":0,size:14}).cx(330).cy(30),t.text(l10n.pdf_title_pages).stroke("#000").font({family:"Arial","stroke-width":0,size:14}).cx(390).cy(10),t.text(e.pages.toString()).stroke("#000").font({family:"Arial","stroke-width":0,size:14}).cx(390).cy(30),t}({plan:n[e-1].ru,page:e,pages:n.length.toString(),studio:"RemPlanner"}),_.addPage(),_.rect(s.x1,s.y1,s.x2,s.y2,"S"),svg2pdf(document.getElementById("main_svg"),_,{xOffset:0,yOffset:0,scale:1}),svg2pdf(document.getElementById("svg_for_stamp"),_,{xOffset:t.width-262,yOffset:t.height-58,scale:.6}),svg.viewbox({x:o.x,y:o.y,width:o.width,height:o.height}),svg.zoom(o.zoom)}_.setDrawColor(0,0,0),_.setFont("Arial").setFontSize(12),n.forEach(function(e,i){setTimeout(function(){$("#fog").show();let e=i+1;if(e>n.length&&(e=n.length),$("#fog_message").show().html(l10n.pdf_prepare_file+"<br>"+l10n.pdf_page.replace("[x1]",e).replace("[x2]",n.length)),console.log("Page",i,"-",n.length,n[i-1].sys),i===n.length){u(i),_.deletePage(1),_.setProperties({title:"Remplanner #"+$("body").attr("data-object-id")+" "+get_current_date()});let s=function(){$("#fog").hide(),$("#fog_message").hide(),stamp.clear(),plan=N.plan,plan_group=function(){let e=getCookie("active_plan_name");return"init"===(e="create_walls"===(e="break_walls"===e?"break":e)?"build":e)||"break"===e||"build"===e?"A":"B"}(),URL.revokeObjectURL(h),h=null,g=null,project.patternScale=1,project.font="normal",project.print_mode=!1,visibility.set(plan),project.draw(),svg.viewbox({x:o.x,y:o.y,width:o.width,height:o.height}),svg.zoom(o.zoom),grid.init(),grid.update(),serviceLayer.show()};if(h=_.output("blob"),g.isCompatible())return console.log("start file api compressed pdf"),g.callback_error=function(){console.log("error file api compressed pdf"),saveAs(h,"Plan "+get_current_date()+".pdf"),s()},g.callback_success=function(){var e=Math.floor(g.total_size/1024/1024);let t=Math.floor(.22*e);var n=setInterval(function(){$("#fog_message").html(l10n.pdf_compressed+"<br>"+l10n.pdf_wait_time+" - "+t+" "+l10n.time_s),0<t&&t--},1e3);$.ajax({type:"GET",url:"/setup/api/planner/pdf_download/",data:{object_id:$("body").attr("data-object-id"),authkey:$("body").attr("data-authkey"),file:g.file_name},dataType:"binary",xhrFields:{responseType:"blob"},success:function(e){n&&clearInterval(n),console.log("success file api compressed pdf"),saveAs(e,"Plan "+get_current_date()+".pdf"),s()},error:function(e,t,i){n&&clearInterval(n),saveAs(h,"Plan "+get_current_date()+".pdf"),s()},timeout:3e5})},g.files.push(h),g.file_name=parseInt((new Date).getTime()/1e3),void g.upload();if(209715200<h.size)return console.log("without compressed pdf"),saveAs(h,"Plan "+get_current_date()+".pdf"),void s();var t=new FormData;return t.append("file",h),void $.ajax({type:"POST",url:"/setup/api/planner/pdf/?object_id="+$("body").attr("data-object-id")+"&authkey="+$("body").attr("data-authkey"),data:t,processData:!1,contentType:!1,dataType:"binary",xhrFields:{responseType:"blob"},success:function(e){console.log("success compressed pdf"),saveAs(e,"Plan "+get_current_date()+".pdf"),s()},error:function(e){console.log("error compressed pdf"),saveAs(h,"Plan "+get_current_date()+".pdf"),s()},timeout:3e5})}u(i)},1e3*++i)})}}window.checkSVG=function(e){if(e&&"before"===e)for(var t in te=[],layers){var i=layers[t].children().length;te.push({key:t,val:i})}if(e&&"after"===e){for(var n in ie=[],layers){var s=layers[n].children().length;ie.push({key:n,val:s})}let t=[];for(let e=0;e<te.length;e++){var o=te[e],l=ie[e];o.key===l.key&&o.val!==l.val&&t.push(o.key,o.val,l.val)}let e=0;for(var r in layers){r=layers[r].children().length;0<r&&(e+=r)}0===t.length&&console.warn("[- Changes -]","NO"),0!==t.length&&console.warn("[- Changes -]",t),console.warn("[- Total -]",e)}if(!e){let e=0;for(var a in layers){a=layers[a].children().length;0<a&&(e+=a)}console.warn("------------"),console.warn("svg only",svg.children().length),console.warn("layers",e),console.warn("custom layer",layers.itemsDimensions.children().length),console.warn("serviceLayer",serviceLayer.children().length),console.warn("------------")}},window.toPoint=function(e){var t=canvas.width()/2,i=(canvas.height()-48)/2,t=t-e.x,i=i-e.y,e=(svg.viewbox({x:0,y:0,width:canvas.width(),height:canvas.height()}),svg.viewbox());svg.viewbox({x:e.x-t,y:e.y-i,width:e.width,height:e.height}),grid.update()},window.toWallCenter=function(e){var e=walls.db[e],t=canvas.width()/2,i=(canvas.height()-48)/2,t=t-e.c.x,i=i-e.c.y,e=(svg.viewbox({x:0,y:0,width:canvas.width(),height:canvas.height()}),svg.viewbox());svg.viewbox({x:e.x-t,y:e.y-i,width:e.width,height:e.height}),grid.update()},window.toPillarCenter=function(e){var e=pillars.db[e],t=canvas.width()/2,i=(canvas.height()-48)/2,t=t-e.center.x,i=i-e.center.y,e=(svg.viewbox({x:0,y:0,width:canvas.width(),height:canvas.height()}),svg.viewbox());svg.viewbox({x:e.x-t,y:e.y-i,width:e.width,height:e.height}),grid.update()},window.draw={},window.storage=[],project.background=svg.group().on("init",function(e){e=e.detail.src;let t=this;this.IMAGE=this.image(),this.IMAGE.load(e).loaded(function(e){t.original_width=e.width,t.original_height=e.height,this.size(e.width/2,e.height/2),this.cx(canvas.width()/2),this.cy(canvas.height()/2),this.attr({opacity:.5})}),layers.background.add(this)}).on("reset",function(){this.IMAGE.width(this.original_width/2),this.IMAGE.height(this.original_height/2),this.IMAGE.cx(canvas.width()/2),this.IMAGE.cy(canvas.height()/2)}).on("delete",function(e){this.clear()}),project.borders=[],project.prepare_for_printing=function(e,t){var i=e.center,n=t.center,s=n.x-i.x,n=n.y-i.y;let o=1;(e.width>t.width||e.height>t.height)&&(i=t.width/e.width,e=t.height/e.height,o=i<e?i:e),svg.zoom(o,t.center);i=svg.viewbox();svg.viewbox({x:i.x-s,y:i.y-n,width:i.width,height:i.height}),grid.update()},project.pan_zoom_reset=function(){svg.viewbox({x:0,y:0,width:canvas.width(),height:canvas.height()}),grid.update()},project.viewbox_reset=function(){svg.viewbox(0,0,canvas.width(),canvas.height())},project.reset=function(){cursors.hide(),signs.reset(),walls.paint(),items.paint(),manager_lining.paint(),layers.upper.clear(),break_line.hide(),arrow.hide(),cursors.hide(),tool_group="none",P(),pillarGuidlines.fire("off",d),$(".contextmenu").hide(50),$(".options_preset").hide(),ne.fire("remove"),SVG.select("#custom_cursor").hide(),cursors.own.fire("remove"),$(".footer_bar_tool").removeClass("active")},project.errors={roomRebuild:0,wallWrongLabel:0,wallTooShort:0,wallOverWall:0,wallNoPointS:0,wallNoPointE:0},project.JSON="",project.prev_plan="",project.font="normal",project.print_mode=!1,project.draw=function(e){if($("#box_cables_socket_wrapper").hide(),layers.walls.clear(),layers.wallsDimensions.clear(),layers.wallsDimensions.show(),layers.pillarsDimensions.show(),layers.doorsDimensions.show(),layers.windowsDimensions.show(),item_plus.hide(),item_minus.hide(),$("body").css("cursor","default"),project.erase(),doors.erase(),windows.erase(),rulers.erase(),manager_lining.hide(),"init"===plan||"break"===plan){pillars.draw();for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"build"===e.label&&e.erase()}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.part&&(e.delete(),t--)}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init_copy"===e.label&&(e.label="init")}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"build"!==e.label&&(e.s_bak&&(e.s=copy.point(e.s_bak),e.s_bak=void 0),e.e_bak&&(e.e=copy.point(e.e_bak),e.e_bak=void 0))}walls.calc(),pillars.draw();for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"!==e.label&&"break"!==e.label||e.init()}"break"===plan&&sectors.draw(),windows.draw(),doors.draw(),rooms1.create(),get_borders_links()}if("build"===plan){for(let e=0;e<pillars.db.length;e++)pillars.db[e].draw();for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"build"!==e.label&&(e.s_bak||(e.s_bak=copy.point(e.s)),e.e_bak||(e.e_bak=copy.point(e.e)))}for(let t=0;t<sectors.db.length;t++){let e=sectors.db[t];e.like_wall||e.split("wall")}for(let t=0;t<doors.db.length;t++){let e=doors.db[t];!0===e.demount&&e.split("wall")}for(let t=0;t<windows.db.length;t++){let e=windows.db[t];!0===e.demount&&e.split("wall")}walls.calc();for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if("init"===t.label){if(0===t.walls_s.length){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];"break"!==i.label||is_line_on_line(i,t)||(are_points_equal(i.s,t.s)||are_points_equal(i.e,t.s))&&(t.sShifter=i)}for(let e=0;e<sectors.db.length;e++){var n=sectors.db[e];is_line_on_line(n,t)||(are_points_equal(n.s,t.s)||are_points_equal(n.e,t.s))&&(t.sShifter=n)}for(let e=0;e<doors.db.length;e++){var s=doors.db[e];"init"!==s.plan||!1===s.demount||is_line_on_line(s,t)||(get_distance(s.s,t.s)<=t.depth/2||get_distance(s.e,t.s)<=t.depth/2)&&(t.sShifter=s)}"5sk6vok"===t.id&&console.warn(t.sShifter)}if(0===t.walls_e.length){for(let e=0;e<walls.db.length;e++){var o=walls.db[e];"break"!==o.label||is_line_on_line(o,t)||(are_points_equal(o.s,t.e)||are_points_equal(o.e,t.e))&&(t.eShifter=o)}for(let e=0;e<sectors.db.length;e++){var l=sectors.db[e];is_line_on_line(l,t)||(are_points_equal(l.s,t.e)||are_points_equal(l.e,t.e))&&(t.eShifter=l)}for(let e=0;e<doors.db.length;e++){var r=doors.db[e];"init"!==r.plan||!1===r.demount||is_line_on_line(r,t)||(get_distance(r.s,t.e)<=t.depth/2||get_distance(r.e,t.e)<=t.depth/2)&&(t.eShifter=r)}}}}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"===e.label&&(e.sShifter&&(e.movePoint("s",e.sShifter),e.sShifter=!1),e.eShifter&&(e.movePoint("e",e.eShifter),e.eShifter=!1))}walls.calc();for(let e=0;e<walls.db.length;e++){let i=walls.db[e];if(!(i.length<=5)&&"init"===i.label)for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var a;e.calc(),"init"!==e.label||e.length<=5||(a=line_and_line_intersection(extendLine(i,e.depth/2,e.depth/2),extendLine(e,i.depth/2,i.depth/2)))&&(1==i.free.s&&get_distance(i.s,a)<=i.depth/2+1&&(i.s=copy.point(a)),1==i.free.e&&get_distance(i.e,a)<=i.depth/2+1&&(i.e=copy.point(a)),1==e.free.s&&get_distance(e.s,a)<=e.depth/2+1&&(e.s=copy.point(a)),1==e.free.e&&0===e.walls_e.length&&get_distance(e.e,a)<=e.depth/2+1&&(e.e=copy.point(a)))}}for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if("init"===t.label)for(let e=0;e<walls.db.length;e++){var h,g=walls.db[e];"build"!==g.label||is_line_on_line(t,g)||(h=extendLine(t,g.depth,g.depth),is_point_on_line(g.s,h)?(get_distance(t.s,g.s)<=g.depth/2+.1&&(t.s=copy.point(g.s)),get_distance(t.e,g.s)<=g.depth/2+.1&&(t.e=copy.point(g.s))):is_point_on_line(g.e,h)&&(get_distance(t.s,g.e)<=g.depth/2+.1&&(t.s=copy.point(g.e)),get_distance(t.e,g.e)<=g.depth/2+.1&&(t.e=copy.point(g.e))))}}for(let e=0;e<walls.db.length;e++){let t=walls.db[e];if("init"===t.label)for(let e=0;e<sectors.db.length;e++){var _,d,p,c=sectors.db[e];c.id_wall!==t.id&&t.axis&&c.axis&&(is_line_on_line(t.axis,c.axis)||(0===t.walls_s.length&&null===t.links.s&&is_point_between_line_points(t.s,c.axis)&&("R"===(d=get_point_place(t.e,c.axis))&&(_=get_line(c.r1,c.r2),t.s=line_and_line_intersection(t.axis,_)),"L"===d&&(_=get_line(c.l1,c.l2),t.s=line_and_line_intersection(t.axis,_))),0===t.walls_e.length&&null===t.links.e&&is_point_between_line_points(t.e,c.axis)&&("R"===(d=get_point_place(t.s,c.axis))&&(p=get_line(c.r1,c.r2),t.e=line_and_line_intersection(t.axis,p)),"L"===d&&(p=get_line(c.l1,c.l2),t.e=line_and_line_intersection(t.axis,p)))))}}walls.calc(),doors.draw(),windows.draw(),walls.init(),pillars.draw(),walls.draw(),rooms2.create(),items.setParents,"init"===plan&&get_borders_links(),project.borders=[];for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if("init_copy"!==t.label&&"break"!==t.label){for(let e=0;e<t.borders.o.length;e++){var A=t.borders.o[e];project.borders.push({s:A.s,e:A.e,face:"l",parent:{type:"wall",id:t.id}})}for(let e=0;e<t.borders.i.length;e++){var u=t.borders.i[e];project.borders.push({s:u.s,e:u.e,face:"r",parent:{type:"wall",id:t.id}})}for(let e=0;e<t.borders.s.length;e++){var w=t.borders.s[e];project.borders.push({s:w.s,e:w.e,face:"r",parent:{type:"wall",id:t.id}})}for(let e=0;e<t.borders.e.length;e++){var m=t.borders.e[e];project.borders.push({s:m.s,e:m.e,face:"l",parent:{type:"wall",id:t.id}})}}}for(let e=0;e<pillars.db.length;e++){var f=pillars.db[e];if("pillar"===f.role||"gypsum"===f.role)for(let e=0;e<f.borders.length;e++){var I=f.borders[e];project.borders.push({s:I.s,e:I.e,face:"l",parent:{type:"pillar",id:f.id}})}}for(let e=0;e<project.borders.length;e++){let t=project.borders[e];t.roomId=!1;var C=LIB.pointAtLineCenter(t.s,t.e,5,t.face.toUpperCase());for(let e=0;e<rooms2.data.length;e++){var y=rooms2.data[e];LIB.isPointInsidePolygon(C,y.polygon)&&(t.roomId=y.id)}}for(let e=0;e<project.borders.length;e++){let t=project.borders[e];t.holes=[];for(let e=0;e<windows.db.length;e++){var b=windows.db[e];if(!0!==b.demount){var v=LIB.line(b.l1,b.l2);if(LIB.isPointOnLine(v.c,t)){if("window"===b.type&&t.holes.push({s:b.l1,e:b.l2,type:b.type,id:b.id}),"windoor"===b.type){let e;"left"===b.props.door_position&&(e=!0),"right"===b.props.door_position&&(e=!1),t.holes.push({s:b.l1,e:b.l2,type:b.type,id:b.id,doorFirst:e})}}else if(v=LIB.line(b.r1,b.r2),LIB.isPointOnLine(v.c,t)&&("window"===b.type&&t.holes.push({s:b.r1,e:b.r2,type:b.type,id:b.id}),"windoor"===b.type)){let e;"left"===b.props.door_position&&(e=!0),"right"===b.props.door_position&&(e=!1),t.holes.push({s:b.r1,e:b.r2,type:b.type,id:b.id,doorFirst:e})}}}for(let e=0;e<doors.db.length;e++){var x,B=doors.db[e];!0!==B.demount&&(x=LIB.line(B.l1,B.l2),LIB.isPointOnLine(x.c,t)?t.holes.push({s:B.l1,e:B.l2,type:"door",id:B.id}):(x=LIB.line(B.r1,B.r2),LIB.isPointOnLine(x.c,t)&&t.holes.push({s:B.r1,e:B.r2,type:"door",id:B.id})))}}for(let e=0;e<project.borders.length;e++){let t=project.borders[e];t.items=[];for(let e=0;e<items.db.length;e++){var k=items.db[e];LIB.isPointOnLine(k.bp,t)&&t.items.push({id:k.props.id})}}}if("B"===plan_group){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.erase()}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"!==e.label&&"build"!==e.label||e.init()}doors.draw(),rooms2.draw(),items.setParents,pillars.paint()}void 0!==dimensionsSwitch[plan]?dimensionsSwitch[plan]?layers.pillarsDimensions.show():layers.pillarsDimensions.hide():"A"===plan_group?layers.pillarsDimensions.show():"B"===plan_group&&layers.pillarsDimensions.hide();for(let t=0;t<items.db.length;t++){let e=items.db[t];e.hide_dimensions(),"stairs"===e.model.group&&(e.hide(),e.hide_dimensions(),e.model.plan={},"walls"!==plan&&"ceiling"!==plan&&"isolation"!==plan&&"plaster"!==plan&&("init"===e.props.plan&&(e.show(),"A"===plan_group&&e.showDimensions()),"build"===e.props.plan&&("build"!==plan&&"B"!==plan_group||(e.show(),e.paint()),"build"===plan&&e.showDimensions())))}for(let t=0;t<items.db.length;t++){let e=items.db[t];e.draw()}if(manager_lining.project_draw(),rulers.draw(),walls.calc(),grid.update(),draw.doors_questions(),plan_previous=plan,windows.draw(),comments.draw(),"light"===plan)for(let t=0;t<items.db.length;t++){let e=items.db[t];"lights"===e.model.group&&e.draw()}pillars.get("parents"),freelines.update(),questions.update(),walls.repair(),items.setLayers(),void 0!==dimensionsSwitch[plan]?dimensionsSwitch[plan]?layers.wallsDimensions.show():layers.wallsDimensions.hide():"A"===plan_group?layers.wallsDimensions.show():"B"===plan_group&&layers.wallsDimensions.hide()},project.erase=function(){rooms1.erase(),rooms2.erase(),cursors.hide(),layers.sectors.clear(),items.hide(),comments.hide(),me.hide(),fe.hide()},project.focus=function(t,i=!1){var n=W();if((t=t||n.center).x&&t.y){var e=canvas.width()/2,s=(canvas.height()-48)/2,e=e-t.x,s=s-t.y;if(svg.viewbox({x:0,y:0,width:canvas.width(),height:canvas.height()}),i){t=(canvas.width()-100)/n.width,i=(canvas.height()-100)/n.height;let e=Math.min(t,i);1<=e&&(e=1),svg.zoom(e)}n=svg.viewbox();svg.viewbox({x:n.x-e,y:n.y-s,width:n.width,height:n.height}),grid.update()}},project.get_drawing_state=function(){for(var e in hatch)svg.add(hatch[e]);for(var t in layers)svg.add(layers[t]);serviceLayer.show().front()},project.svg={hatch:{},layers:{},clone:function(){for(var e in project.svg.hatch={},project.svg.layers={},hatch)"clear"!==e&&(project.svg.hatch[e]=hatch[e].clone());for(var t in layers)"clear"!==t&&(project.svg.layers[t]=layers[t].clone())},restore:function(){for(var e in project.svg.hatch)"clear"!==e&&(hatch[e]=project.svg.hatch[e].clone());for(var t in project.svg.layers)layers[t].clear()}},project.copy=function(e){let t={};return t.walls=walls.copy(),t.pillars=pillars.copy(),t.sectors=sectors.copy(),t.rooms2=rooms2.copy(),t.windows=windows.copy(),t.doors=doors.copy(),t.items=items.copy(),t.led_strips=led_strips.copy(),t.line_strips=line_strips.copy(),t.cables=cables.copy(),t.pipes=pipes.copy(),t.pipes_conditioner=pipes_conditioner.copy(),t.cables_conditioner=cables_conditioner.copy(),t.pipes_heat=pipes_heat.copy(),t.cables_socket=cables_socket.copy(),t.cables_warm_floor=cables_warm_floor.copy(),t.stripes_light=stripes_light.copy(),t.comments=comments.copy(e),t.rulers=rulers.copy(),t.questions=questions.copy(),t.freelines=freelines.copy(),t.drawings=drawings,t.total_height=params.total_height,t.errors=project.errors,t.is_forced=income_is_forced,t.params=income_params,t.drawing=W(),t.session=window.global_session,t.version=window.global_version,t.log_plan=window.log_plan,t.final=!0,t.borders=project.borders,t},project.localCopy=function(){let e={};return e.viewbox=svg.viewbox(),e.plan=plan,e.plan_group=plan_group,e.walls=walls.copy(),e.pillars=pillars.copy(),e.sectors=sectors.copy(),e.rooms2=rooms2.copy(),e.windows=windows.copy(),e.doors=doors.copy(),e.items=items.copy(),e.led_strips=led_strips.copy(),e.line_strips=line_strips.copy(),e.cables=cables.copy(),e.pipes=pipes.copy(),e.pipes_conditioner=pipes_conditioner.copy(),e.cables_conditioner=cables_conditioner.copy(),e.pipes_heat=pipes_heat.copy(),e.cables_socket=cables_socket.copy(),e.cables_warm_floor=cables_warm_floor.copy(),e.stripes_light=stripes_light.copy(),e.comments=comments.copy(),e.rulers=rulers.copy(),e.questions=questions.copy(),e.freelines=freelines.copy(),e.total_height=params.total_height,e.errors=project.errors,e.params=params,e.final=!0,e},project.localSave=function(e=!0){!0!==window.no_local_save&&e&&(LogItems.save_action((new Error).stack,null,storage[copy_counter]),copy_counter++,console.warn("--- Local Save "+copy_counter+" ---"),copy_counter_max_value=copy_counter,e=project.localCopy(),storage[copy_counter]=JSON.stringify(e),0<copy_counter&&$(".footer_bar_tool.undo").addClass("available"),copy_counter===copy_counter_max_value&&$(".footer_bar_tool.redo").removeClass("available"),rooms2.draw())},project.restore=function(i,e=!1){for(var t in layers)!0===e&&"background"===t||layers[t].clear();i.total_height&&(params.total_height=i.total_height),i.pillars&&pillars.restore(i.pillars);for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];e.get("borders")}if(i.walls&&(walls.restore(i.walls),walls.calc(),walls.repair()),i.sectors){for(let t=0;t<i.sectors.length;t++){i.sectors[t].remove=!0;for(let e=0;e<walls.db.length;e++)if(i.sectors[t].id_wall===walls.db[e].id){i.sectors[t].remove=!1;break}}for(let e=0;e<i.sectors.length;e++)!0===i.sectors[e].remove&&(i.sectors.splice(e,1),e--);sectors.db=[];for(let e=0;e<i.sectors.length;e++)sectors.db[e]=new F(i.sectors[e])}if(i.windows&&windows.restore(i.windows),i.doors&&doors.restore(i.doors),i.rooms2){rooms2.data=[];for(let e=0;e<i.rooms2.length;e++)rooms2.data[e]=new G(i.rooms2[e])}if(i.comments&&comments.restore(i.comments),i.items&&items.restore(i.items),manager_lining.project_restore(i),manager_lining.project_update_length(),i.rulers&&rulers.restore(i.rulers),i.freelines&&freelines.restore(i.freelines),i.comments)for(let e=0;e<comments.db.length;e++){var n;comments.db[e].plan&&"light"===comments.db[e].plan&&comments.db[e].id_item&&((n=get_item(comments.db[e].id_item))&&"switches"===n.props.settings.group&&n.props.settings.plan.light_connections&&(comments.db[e].plan="light_connections"))}if(i.questions&&questions.restore(i.questions),N.plan=plan,"B"===plan_group){plan="build",rooms2.erase();for(let e=0;e<i.rooms2.length;e++)rooms2.data[e]=new G(i.rooms2[e]);project.draw(),plan=N.plan}items.setParents;for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.area<=.1&&(e.erase(),rooms2.data.splice(t,1),t--)}i.drawings&&console.warn("Планов: ",i.drawings.length),rooms2.draw(),grid.init()},project.localRestore=function(i,e){i.total_height&&(params.total_height=i.total_height),pillars.db=[];for(let e=0;e<i.pillars.length;e++)pillars.db.push(new H(i.pillars[e],!1));walls.db=[];for(let e=0;e<i.walls.length;e++)walls.db[e]=new j(i.walls[e]);for(let e=0;e<walls.db.length;e++)walls.db[e].calc();walls.repair();for(let t=0;t<i.sectors.length;t++){i.sectors[t].remove=!0;for(let e=0;e<walls.db.length;e++)if(i.sectors[t].id_wall===walls.db[e].id){i.sectors[t].remove=!1;break}}for(let e=0;e<i.sectors.length;e++)!0===i.sectors[e].remove&&(i.sectors.splice(e,1),e--);sectors.db=[];for(let e=0;e<i.sectors.length;e++)sectors.db[e]=new F(i.sectors[e]);windows.restore(i.windows),doors.restore(i.doors),rooms2.data=[];for(let e=0;e<i.rooms2.length;e++)rooms2.data[e]=new G(i.rooms2[e]);"B"===plan_group&&(N.plan=plan,plan="build",project.draw(),plan=N.plan);for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.area<=.1&&(e.erase(),rooms2.data.splice(t,1),t--)}},project.paint=function(){switch(selectedObject){case"wall":walls.paint();break;case"pillar":pillars.paint();break;case"window":windows.paint();break;case"door":doors.paint();break;case"item":items.paint()}},project.delete=function(e="fully"){project.erase(),tool="none",tool_group="none",pillarGuidlines.fire("off"),"fully"===e&&(storage=[],hide(),arrow.hide(),cursors.hide(),z.reset(),magnets2.hide(),$(".footer_bar_tool.undo").removeClass("available"),$(".footer_bar_tool.redo").removeClass("available"),copy_counter=-1,$(".options_preset").hide(),$(".tools_item.active").removeClass("active"),$("#planner_ui_options").removeClass("active"),walls.delete(),sectors.delete(),windows.delete(),doors.delete(),rooms1.remove(),rooms2.remove(),pillars.delete(),items.delete(),baselines.delete(),comments.delete(),rulers.delete(),manager_lining.project_delete(),questions.delete(),handlines.delete(),freelines.remove(),svg.viewbox(0,0,canvas.width(),canvas.height()),grid.update(),change_group("init"),project.background.fire("delete"),scale_recognition_rect_tool.fire("delete"),scale_recognition_line_tool.fire("delete"),preplan_scale_close(),console.warn("full delete")),"partially"===e&&(hide(),arrow.hide(),cursors.hide(),z.reset(),magnets2.hide(),$(".options_preset").hide(),$(".tools_item.active").removeClass("active"),$("#planner_ui_options").removeClass("active"),walls.delete(),sectors.delete(),windows.delete(),doors.delete(),rooms1.remove(),rooms2.remove(),pillars.delete(),items.delete(),baselines.delete(),comments.delete(),rulers.delete(),manager_lining.project_delete(),questions.delete(),handlines.delete(),freelines.remove(),svg.viewbox(0,0,canvas.width(),canvas.height()),grid.update(),scale_recognition_rect_tool.fire("delete"),scale_recognition_line_tool.fire("delete"),preplan_scale_close())},window.layers={grid:svg.group(),background:svg.group(),rooms:svg.group(),stairs1:svg.group(),stairs2:svg.group(),furniture0:svg.group(),furniture1:svg.group(),furniture1_1:svg.group(),furniture2:svg.group(),furniture3:svg.group(),furniture4:svg.group(),rooms_edges_dimensions:svg.group(),cables_socket:svg.group(),floors:svg.group(),ceilings:svg.group(),niches:svg.group(),delimiters:svg.group(),windows:svg.group(),doors:svg.group(),demolines:svg.group(),items0:svg.group(),items1:svg.group(),items2:svg.group(),items3:svg.group(),items4:svg.group(),items5:svg.group(),sockets:svg.group(),pipes_heat:svg.group(),gypsum_boxes:svg.group(),walls:svg.group(),furniture_up_walls:svg.group(),furniture5:svg.group(),furniture6:svg.group(),furniture_up:svg.group(),sockets_up:svg.group(),penalDoors:svg.group(),sectors:svg.group(),hammers:svg.group(),wallsDimensions:svg.group(),ventHoles:svg.group(),itemsDimensions:svg.group(),pillars:svg.group(),furniture_up_pillars:svg.group(),cables:svg.group(),cables_conditioner:svg.group(),pipes_conditioner:svg.group(),pipes:svg.group(),reference_lines:svg.group(),pillars_water:svg.group(),water:svg.group(),connect_point_line:svg.group(),warm_floors:svg.group(),cables_warm_floor:svg.group(),stripes_light:svg.group(),led_strips:svg.group(),line_strips:svg.group(),trees_nodes:svg.group(),stripes_light_track_line_spots:svg.group(),stripes_light_sizes:svg.group(),track_spots:svg.group(),graph:svg.group(),pillarsDimensions:svg.group(),doorsDimensions:svg.group(),windowsDimensions:svg.group(),risers:svg.group(),caps:svg.group(),doors_penal:svg.group(),doors_questions:svg.group(),rulers:svg.group(),comments:svg.group(),signs:svg.group(),zones:svg.group(),demounts:svg.group(),freelines:svg.group(),questions:svg.group(),temp_images:svg.group(),upper:svg.group()},window.serviceLayer=svg.group(),window.grid={init:function(){layers.grid.clear(),grid.rect=layers.grid.rect().size("100%","100%").on("mousedown",function(e){Q(),1===e.which&&"floor_elements"===tool_group?warning.show("yellow",l10n.floor_full_white):Z||(delete_empty_comment(),layers.temp_images.clear(),warning.hide(),"comment"===tool&&(tool="none"),1===e.which&&newHide(),3===e.which&&oldHide())}).on("mouseup",function(){Z||$("body").css("cursor","default")}),grid.pattern=layers.grid.pattern(100,100,function(t){let i=0,n=0;for(let e=0;e<11;e++){var s=e%10==0?"#000000":"#a5a5a5",o=e%10==0?.22:.2;t.line(i,n,i,n+100).attr({stroke:s,"stroke-width":o}).addClass("GRID_LINE"),i+=10}i=0;for(let e=n=0;e<11;e++){var l=e%10==0?"#000000":"#a5a5a5",r=e%10==0?.22:.2;t.line(i,n,i+100,n).attr({stroke:l,"stroke-width":r}).addClass("GRID_LINE"),n+=10}}),this.rect.fill(this.pattern)},show:function(){this.rect.show()},hide:function(){this.rect.hide()},remove:function(){this.rect.remove()},update:function(){var e=svg.viewbox().x,t=svg.viewbox().y;this.rect.move(e,t)}},grid.init(),window.magnets2={x_closing:serviceLayer.line().attr({stroke:"#dc143c","stroke-width":1.6,"stroke-dasharray":4}).id("X_CLOSING").hide(),y_closing:serviceLayer.line().attr({stroke:"#dc143c","stroke-width":1.6,"stroke-dasharray":4}).id("Y_CLOSING").hide(),hide:function(){this.x_closing.animate(150).attr({stroke:"#fafafa"}).after(function(){this.attr({stroke:"#dc143c"}),this.hide()}),this.y_closing.animate(150).attr({stroke:"#fafafa"}).after(function(){this.attr({stroke:"#dc143c"}),this.hide()})}},window.StopSign=serviceLayer.group().add(svg.circle(14).attr({"stroke-width":2,stroke:"#fafafa",fill:"#dc143c"})).add(svg.line(3,7,11,7).attr({"stroke-width":2,stroke:"#fafafa"})).on("contextmenu",function(){this.hide()}).id("SIGN_STOP").hide(),window.wall_magnet=serviceLayer.circle(8).attr({"stroke-width":2,stroke:"#777777",fill:"none"}).id("WALL_MAGNET").front(),window.break_line=serviceLayer.line().attr({stroke:"crimson","stroke-width":4,"stroke-linecap":"round",opacity:.3}).hide(),window.paths={lock:"M5.2,3V2.1C5.2,1,4.2,0,3,0S0.8,1,0.8,2.1V3C0.4,3.1,0,3.5,0,4v2.9C0,7.5,0.4,8,1,8h4c0.5,0,1-0.5,1-1.1V4C6,3.5,5.6,3.1,5.2,3z M1.1,2.1c0-1,0.9-1.9,1.9-1.9s1.9,0.8,1.9,1.9V3H1.1V2.1z M5.7,6.9c0,0.4-0.3,0.8-0.7,0.8H1c-0.4,0-0.7-0.3-0.7-0.8V4c0-0.4,0.3-0.8,0.7-0.8h4c0.4,0,0.7,0.3,0.7,0.8V6.9zM3,4.1c-0.3,0-0.5,0.3-0.5,0.6v0.9C2.5,6,2.7,6.2,3,6.2S3.5,6,3.5,5.6V4.7C3.5,4.4,3.3,4.1,3,4.1z M3.3,5.6c0,0.2-0.1,0.3-0.3,0.3c-0.2,0-0.3-0.1-0.3-0.3V4.7c0-0.2,0.1-0.3,0.3-0.3c0.2,0,0.3,0.1,0.3,0.3V5.6z"},window.zoneDelimiter=serviceLayer.group().on("on",function(){this.LINE=this.line().attr({"stroke-width":.8,"stroke-dasharray":4,stroke:"crimson",fill:"#fafafa"}).hide(),this.E=this.circle(8).attr({"stroke-width":2,stroke:"crimson",fill:"#fafafa"}).hide(),this.S=this.circle(8).attr({"stroke-width":2,stroke:"crimson",fill:"#fafafa"}).hide()}).on("move",function(e){e.detail.s,e.detail.e}).on("off",function(){zoneDelimiter.LINE.hide(),zoneDelimiter.S.hide(),zoneDelimiter.E.hide(),zoneDelimiter.S.room=null,zoneDelimiter.S.edge=null,zoneDelimiter.E.room=null,zoneDelimiter.E.edge=null}),window.o_sign=serviceLayer.group().on("show",function(e){this.clear();var t=e.detail.center;let i=e.detail.active?"#dc143c":"#777777";this.circle(8).attr({stroke:i,"stroke-width":2,fill:"#fafafa"}).cx(t.x).cy(t.y),this.show()}).on("hide",function(e){this.clear()}),window.s_size=serviceLayer.group().on("show",function(e){this.clear();var t=e.detail.center;let i=e.detail.length;this.rect(22,12).radius(2).attr({stroke:"#000000","stroke-width":.2,fill:colors.yellow}).cx(t.x).cy(t.y),this.plain(i.toString()).font({family:"Arial",size:8,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(t.x).cy(t.y),this.show()}).on("hide",function(e){this.clear()}),window.e_size=serviceLayer.group().on("show",function(e){this.clear();var t=e.detail.center;let i=e.detail.length;this.rect(22,12).radius(2).attr({stroke:"#000000","stroke-width":.2,fill:colors.yellow}).cx(t.x).cy(t.y),this.plain(i.toString()).font({family:"Arial",size:8,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(t.x).cy(t.y),this.show()}).on("hide",function(e){this.clear()}),window.s_size_2=serviceLayer.group().on("show",function(e){this.clear();var t=e.detail.center;let i=e.detail.length;this.rect(22,12).radius(2).attr({stroke:"#000000","stroke-width":.2,fill:colors.yellow}).cx(t.x).cy(t.y),this.plain(i.toString()).font({family:"Arial",size:8,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(t.x).cy(t.y),this.show()}).on("hide",function(e){this.clear()}),window.e_size_2=serviceLayer.group().on("show",function(e){this.clear();var t=e.detail.center;let i=e.detail.length;this.rect(22,12).radius(2).attr({stroke:"#000000","stroke-width":.2,fill:colors.yellow}).cx(t.x).cy(t.y),this.plain(i.toString()).font({family:"Arial",size:8,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(t.x).cy(t.y),this.show()}).on("hide",function(e){this.clear()}),window.a_line=serviceLayer.group().on("init",function(){let e=0,t=0,i=1,n=1;this.line=this.line(e,t,i,n).attr({stroke:"#dc143c","stroke-width":1.4,"stroke-dasharray":4}).hide(),this.background=this.rect(22,12).radius(2).attr({stroke:"#000000","stroke-width":.2,fill:colors.yellow}).hide(),this.value=this.plain("").font({family:"Arial",size:8,stroke:"#000000","stroke-width":.4,fill:"#000000"}).hide()}).on("show",function(e){var t=e.detail.s,e=e.detail.e,i=get_center(t,e);let n=get_distance(t,e).toFixed(0);this.line.plot(t.x,t.y,e.x,e.y).show(),20<=n&&(this.background.cx(i.x).cy(i.y).show(),this.value.plain(n.toString()).cx(i.x).cy(i.y).show()),this.show()}).on("hide",function(){this.line&&this.line.hide(),this.background.hide(),this.value.plain("")}),draw.doors_questions=function(){if(layers.doors_questions.clear(),"build"===plan)for(let e=0;e<doors.db.length;e++){var t=doors.db[e];!0===t.props.destroy&&!1===t.props.destroyed&&layers.doors_questions.add(new Ye({ps:t.s,pe:t.e,pc:t.center,id_door:t.id}))}},window.customCursor=serviceLayer.group().hide().on("on",function(e){$("body").css("cursor","default"),this.clear(),this.cursor=get_svg_point({x:e.detail.clientX,y:e.detail.clientY}),this.rect(18,18).radius(4).attr({stroke:"#ffffff","stroke-width":0,fill:"#ffffff"}),this.cx(this.cursor.x),this.cy(this.cursor.y),this.overObject=!1,this.defaultColor="#666666",this.customColor="#666666",this.strokeWidth=.1,this.x_min=20,this.x_max=canvas.width()-20,this.y_min=canvas.offset().top+20,this.y_max=canvas.offset().top+canvas.height()-100,"eraser"===tool?(this.ICON=this.path(icons.trash),this.customColor="crimson"):"demount"===tool_group?(this.ICON=this.path(icons.hammer),this.customColor="crimson"):"floor_elements"===tool_group||"molding"===tool_group?(this.ICON=this.path(icons.hammer),this.customColor="orange"):"ceiling_elements"===tool_group?(this.ICON=this.path(icons.hammer),this.customColor="orange",this.strokeWidth=.2):"wall_elements"===tool_group&&("walls"!==plan&&"ceiling"!==plan||(this.ICON=this.path(icons.roller),this.customColor="orange",this.strokeWidth=.2),"isolation"===plan&&(this.ICON=this.path(icons.hammer),this.customColor="orange",this.strokeWidth=1),"plaster"===plan&&(this.ICON=this.path(icons.trowel),this.customColor="orange",this.strokeWidth=1)),this.ICON.attr({stroke:this.defaultColor,"stroke-width":this.strokeWidth,fill:this.defaultColor}),this.activated=!0,this.show()}).on("move",function(e){if(this.activated){this.cursor=get_svg_point({x:e.detail.clientX,y:e.detail.clientY}),this.cx(this.cursor.x+22),this.cy(this.cursor.y+20),this.ICON.fill(this.defaultColor),this.overObject&&this.ICON.fill(this.customColor),this.ICON.stroke(this.defaultColor);for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.resetSurfaceColoring()}this.room=!1;for(let e=0;e<rooms2.data.length;e++){var t=rooms2.data[e];is_point_inside_polygon(this.cursor,t.polygon)&&(this.room=t)}if(this.room){let i=this.room;if("eraser"===tool){if("isolation"===plan)for(let e=0;e<i.isolation.length;e++)!0===i.isolation[e].exist&&(i.demolines[e].IMAGE.attr({stroke:"crimson","stroke-width":2}),this.ICON.fill(this.customColor),this.ICON.stroke(this.customColor));if("plaster"===plan)for(let e=0;e<i.plaster.length;e++)!0===i.plaster[e].exist&&(i.demolines[e].IMAGE.attr({stroke:"crimson","stroke-width":2}),this.ICON.fill(this.customColor),this.ICON.stroke(this.customColor))}if("floor_elements"===tool_group&&"floor"===plan&&this.overObject&&this.ICON.fill(this.customColor),"molding"===tool_group&&"floor"===plan){this.surface=!1;let t=0;for(let e=0;e<i.demolines.length;e++){var n=i.demolines[e],s=i.floorMoldings[e],s=(s.name===tool&&!0===s.exist&&t++,LIB.projection(this.cursor,n));s&&get_distance(this.cursor,s)<40&&(this.surface=n,this.surface.index=e)}if(this.fullMolding=!1,t===i.demolines.length&&(this.fullMolding=!0),!this.surface)for(let e=0;e<i.floorMoldings.length;e++)this.fullMolding||(i.demolines[e].IMAGE.attr({stroke:this.settings.stroke_color,"stroke-dasharray":4}),this.ICON.fill(this.settings.stroke_color),this.ICON.stroke(this.settings.stroke_color));this.surface&&i.floorMoldings[this.surface.index].name!==tool&&(this.surface.IMAGE.attr({stroke:this.settings.stroke_color,"stroke-dasharray":4}),this.ICON.fill(this.settings.stroke_color),this.ICON.stroke(this.settings.stroke_color))}if("wall_elements"===tool_group){if("isolation"===plan){this.surface=!1;let t=0;for(let e=0;e<i.demolines.length;e++){var o=i.demolines[e],l=i.isolation[e],l=(l.name===tool&&!0===l.exist&&t++,LIB.projection(this.cursor,o));l&&get_distance(this.cursor,l)<40&&(this.surface=o,this.surface.index=e)}if(this.fullIsolation=!1,t===i.demolines.length&&(this.fullIsolation=!0),!this.surface)for(let e=0;e<i.isolation.length;e++)this.fullIsolation||(i.demolines[e].IMAGE.attr({stroke:this.settings.stroke_color,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling));!this.surface||(h=i.isolation[this.surface.index])&&h.name!==tool&&(this.surface.IMAGE.attr({stroke:this.settings.filling,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling))}if("plaster"===plan){this.surface=!1;let t=0;for(let e=0;e<i.demolines.length;e++){var r=i.demolines[e],a=i.plaster[e],a=(a.name===tool&&!0===a.exist&&t++,LIB.projection(this.cursor,r));a&&get_distance(this.cursor,a)<40&&(this.surface=r,this.surface.index=e)}if(this.fullPlaster=!1,t===i.demolines.length&&(this.fullPlaster=!0),"plaster_visual"===tool||"plaster_full"===tool){if(!this.surface)for(let e=0;e<i.plaster.length;e++)this.fullPlaster||(i.demolines[e].IMAGE.attr({stroke:this.settings.stroke_color,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling));!this.surface||(h=i.plaster[this.surface.index])&&h.name!==tool&&(this.surface.IMAGE.attr({stroke:this.settings.filling,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling))}}}}if("ceiling"===plan){if("ceiling_niche"===tool&&null!==f){let e=f.room,t=e.ceilings[f.ceiling];var h=t.niches[f.niche];h&&!0===h.temp&&(t.niches[f.niche].exist=!1),f=null,e.draw()}if(("ceiling_elements"===tool_group||"ceiling_niche"===tool)&&this.room){let n=this.room;for(let e=0;e<n.ceilings.length;e++){var i=n.ceilings[e];if(is_point_inside_polygon(this.cursor,i.polygon)&&("ceiling_elements"===tool_group&&(i.exist||this.ICON.fill(this.settings.filling),i.exist&&i.material!==tool&&this.ICON.fill(this.settings.filling)),"ceiling_niche"===tool)){if(null!==f){let e=f.room,t=e.ceilings[f.ceiling];i=t.niches[f.niche];i&&!0===i.temp&&(t.niches[f.niche].exist=!1),f=null,e.draw()}for(let e=0;e<n.ceilings.length;e++){let i=n.ceilings[e];if("paint_ceiling"!==i.material&&("whitewash_ceiling"!==i.material&&is_point_inside_polygon(mouse.end,i.polygon))){if(!0!==i.exist)return;{let t=null;for(let e=0;e<i.edges.length;e++){var g=i.edges[e],g=LIB.projection(mouse.end,g);if(g&&get_distance(mouse.end,g)<defs.ceiling_niche.depth){t=e;break}}null!==t&&(f={room:this.room,ceiling:e,niche:t},i.niches[t]&&!1===i.niches[t].exist&&(i.niches[t].exist=!0,i.niches[t].temp=!0),n.draw())}}}}}}if("ceiling_molding"===tool){for(let e=0;e<rooms2.data.length;e++){var _=rooms2.data[e];for(let t=0;t<_.ceilingMoldings.length;t++){var d=_.ceilingMoldings[t];let e=_.demolines[t];!1===d.exist&&e.IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"}),!0===d.exist&&e.IMAGE.attr({stroke:d.stroke,"stroke-dasharray":"none"})}}if(this.room){let t=this.room,i=(this.demoline=!1,this.molding=null,this.moldingIndex=null,0);for(let e=0;e<t.demolines.length;e++){var p=t.demolines[e],c=t.ceilingMoldings[e],A=(!0===c.exist&&i++,LIB.projection(this.cursor,p));A&&get_distance(this.cursor,A)<40&&(this.demoline=p,this.molding=c,this.moldingIndex=e)}if(this.totalMolding=!1,i===t.demolines.length&&(this.totalMolding=!0),!this.demoline)for(let e=0;e<t.ceilingMoldings.length;e++)this.totalMolding||!1===t.ceilingMoldings[e].exist&&(t.demolines[e].IMAGE.attr({stroke:this.settings.stroke_color,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling));this.demoline&&(!1===this.molding.exist?(this.demoline.IMAGE.attr({stroke:this.settings.filling,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling)):(this.ICON.fill(this.defaultColor),this.ICON.stroke(this.defaultColor))),1==this.totalMolding&&(this.ICON.fill(this.defaultColor),this.ICON.stroke(this.defaultColor))}}tool}if("walls"===plan){if("wall_elements"===tool_group&&this.room){let t=this.room,i=(this.surface=!1,0);for(let e=0;e<t.demolines.length;e++){var u=t.demolines[e],w=t.decor[e],w=(w.name===tool&&!0===w.exist&&i++,LIB.projection(this.cursor,u));w&&get_distance(this.cursor,w)<40&&(this.surface=u,this.surface.index=e)}if(this.fullDecor=!1,i===t.demolines.length&&(this.fullDecor=!0),!this.surface)for(let e=0;e<t.decor.length;e++)this.fullDecor||(t.demolines[e].IMAGE.attr({stroke:this.settings.stroke_color,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling));this.surface&&t.decor[this.surface.index].name!==tool&&(this.surface.IMAGE.attr({stroke:this.settings.filling,"stroke-dasharray":4}),this.ICON.fill(this.settings.filling),this.ICON.stroke(this.settings.filling))}if("eraser"===tool&&this.room){let t=this.room;for(let e=0;e<t.decor.length;e++)!0===t.decor[e].exist&&(t.demolines[e].IMAGE.attr({stroke:"crimson","stroke-width":2}),this.ICON.fill(this.customColor),this.ICON.stroke(this.customColor))}}if("demount"===tool_group&&this.overObject&&this.ICON.fill(this.customColor),e.detail.pageX<this.x_min||e.detail.pageX>this.x_max||e.detail.pageY<this.y_min||e.detail.pageY>this.y_max?customCursor.hide():customCursor.show(),"eraser"===tool&&this.room){var m=this.room;let t=!1;if("floor"===plan)for(let e=0;e<m.floorMoldings.length;e++)if(!0===m.floorMoldings[e].exist){t=!0;break}if("walls"===plan)for(let e=0;e<m.decor.length;e++)if(!0===m.decor[e].exist){t=!0;break}if(!0===t)for(let t=0;t<m.floorMoldings.length;t++){let e=m.demolines[t].IMAGE;e.attr({stroke:"crimson","stroke-dasharray":"none"}),this.ICON.fill("crimson"),this.ICON.stroke("crimson")}}}}).on("click",function(t){var e;if("floor"===plan&&this.room){let i=this.room;if("eraser"===tool)customCursor.fire("eraserReaction",t),i.removeFloorMoldings();else{this.floor=!1;for(let e=0;e<this.room.floors.length;e++)if(is_point_inside_polygon(this.cursor,this.room.floors[e].polygon)){this.floor=this.room.floors[e];break}if(this.floor&&("floor_elements"===tool_group&&tool!==this.floor.cover&&(this.floor.exist=!0,this.floor.cover=tool,this.room.draw(),customCursor.fire("knock"),project.localSave()),"eraser"===tool&&!0===this.floor.exist&&(this.floor.exist=!1,delete this.floor.cover,this.overObject=!1,customCursor.fire("knock"),this.room.draw(),project.localSave())),"molding"===tool_group){if(!this.surface){let t=0;for(let e=0;e<i.floorMoldings.length;e++)i.floorMoldings[e].color===this.settings.stroke_color&&t++;if(t===i.floorMoldings.length)return void this.fire("click");for(let e=0;e<i.floorMoldings.length;e++){var n=i.demolines[e];i.floorMoldings[e]={exist:!0,name:tool,color:this.settings.stroke_color,width:n.width,height:n.height,area:n.area,area_doors:n.area_doors,area_windows:n.area_windows}}customCursor.fire("knock"),i.draw(),project.localSave()}this.surface&&(e=this.surface,i.floorMoldings[this.surface.index]={exist:!0,name:tool,color:this.settings.stroke_color,width:e.width},customCursor.fire("knock"),i.draw(),project.localSave())}}}if("hydroisolation"===plan&&this.room){this.hydroisolation=!1;for(let e=0;e<this.room.hydroisolation.length;e++)if(is_point_inside_polygon(this.cursor,this.room.hydroisolation[e].polygon)){this.hydroisolation=this.room.hydroisolation[e];break}this.hydroisolation&&("floor_elements"===tool_group&&tool!==this.hydroisolation.cover&&(this.hydroisolation.exist=!0,this.hydroisolation.cover=tool,this.room.draw(),customCursor.fire("knock"),project.localSave()),"eraser"===tool&&!0===this.hydroisolation.exist&&(this.hydroisolation.exist=!1,delete this.hydroisolation.cover,this.overObject=!1,customCursor.fire("knock"),this.room.draw(),project.localSave()))}if("walls"===plan&&this.room){let i=this.room;if("wall_elements"===tool_group){if(!this.surface){let t=!1;for(let e=0;e<i.decor.length;e++){var s=i.decor[e],o=!1===s.exist,s=!0===s.exist&&s.name!==tool;if(o||s){t=!0;break}}if(t){for(let e=0;e<i.decor.length;e++){var l=i.demolines[e];i.decor[e]={exist:!0,name:tool,color:this.settings.stroke_color,surface:l.surface,width:l.width,height:l.height,area:l.area,area_doors:l.area_doors,area_windows:l.area_windows}}customCursor.fire("knock"),i.draw(),project.localSave()}}this.surface&&(e=this.surface,i.decor[this.surface.index].name!==tool&&0==i.decor[this.surface.index].exist&&(i.decor[this.surface.index]={exist:!0,name:tool,color:this.settings.stroke_color,surface:e.surface,width:e.width,height:e.height,area:e.area,area_doors:e.area_doors,area_windows:e.area_windows},customCursor.fire("knock"),i.draw(),project.localSave()))}if("eraser"===tool)for(let e=0;e<i.decor.length;e++)if(!0===i.decor[e].exist){for(let e=0;e<i.decor.length;e++)i.decor[e]={exist:!1},i.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"});customCursor.fire("eraserReaction",t),customCursor.fire("knock"),i.draw(),project.localSave();break}}if("ceiling"===plan&&this.room){let i=this.room;for(let e=0;e<i.ceilings.length;e++){let n=i.ceilings[e];if(is_point_inside_polygon(this.cursor,n.polygon)){if(in_array(tool,["stretch_ceiling","paint_ceiling","gypsum_ceiling","rack_ceiling","plastic_panels_ceiling","whitewash_ceiling"])&&tool!==n.material){if(n.exist=!0,n.complex=!1,n.filling=this.settings.filling,n.material=tool,n.offset&&delete n.offset,n.radius&&delete n.radius,"paint_ceiling"===tool||"whitewash_ceiling"===tool){for(let i=0;i<comments.db.length;i++){let t=comments.db[i];for(let e=0;e<n.niches.length;e++){var r=n.niches[e];t.id_item===r.id&&(t.delete(),i--)}}n.niches=[]}customCursor.fire("knock"),i.draw(),project.localSave()}if("complex_ceiling"===tool&&!n.complex){if(console.warn("точек потолка",n.polygon,"площадь потолка",n.area),n.area<4)return void warning.show("yellow",l10n.ceiling_not_inst_complex+"<br>"+l10n.ceiling_reason_1.replace("[x]","4 кв.м."));if(8<n.polygon.length)return void warning.show("yellow",l10n.ceiling_not_inst_complex+"<br>"+l10n.ceiling_reason_2);if(!function(t,i){let n=[],s=[],o=[];try{t.edges||(t.edges=get_polygon_edges(t.polygon));for(let e=0;e<t.edges.length;e++){var l=t.edges[e];s[e]={s:l.s,e:l.e,offset:0}}if(s)for(let e=0;e<2;e++)for(let e=0;e<s.length;e++)LIB.mergeLines(s[e],e,s);for(let e=0;e<s.length;e++){var r=s[e],a=get_point_near_line_center(r.s,r.e,10+r.offset,"L"),h=get_point_near_line_center(r.s,r.e,10+r.offset,"R");is_point_inside_polygon(a,t.polygon)&&(n[e]=get_parallel(r.s,r.e,i,"L")),is_point_inside_polygon(h,t.polygon)&&(n[e]=get_parallel(r.s,r.e,i,"R"))}for(let i=0;i<n.length;i++){let e,t;t=0===i?(e=n.length-1,1):i===n.length-1?(e=n.length-2,0):(e=i-1,i+1);var g=n[e],_=n[i],d=n[t],p=line_and_line_intersection(_,g),c=line_and_line_intersection(_,d);o[i]={},c&&(o[i].s=p),p&&(o[i].e=c)}for(let e=0;e<o.length;e++)n[e].s=copy.point(o[e].s),n[e].e=copy.point(o[e].e);return 1}catch(e){return}}(n,defs.complex_ceiling.offset))return void warning.show("yellow",l10n.ceiling_not_inst_complex+"<br>"+l10n.ceiling_reason_3);n.exist=!0,n.complex=!0,n.offset=defs.complex_ceiling.offset,n.radius=defs.complex_ceiling.radius,customCursor.fire("reset"),i.draw(),project.localSave()}if("ceiling_niche"===tool){if(!0!==n.exist)return void warning.show("yellow",l10n.ceiling_add_first);if("paint_ceiling"===n.material)return void warning.show("yellow",l10n.ceiling_niche_not_allow);if("whitewash_ceiling"===n.material)return void warning.show("yellow",l10n.ceiling_niche_not_allow);null!==f&&(n.niches[f.niche]={exist:!0,id:LIB.id(),comment_exist:!1,comment:this.settings.comment,temp:!1},i.draw(),f=null),customCursor.fire("knock"),i.draw(),project.localSave(),customCursor.fire("knock")}if("ceiling_molding"===tool){let e=!1;if(!this.demoline){let t=0;for(let e=0;e<i.ceilingMoldings.length;e++)!0===i.ceilingMoldings[e].exist&&t++;if(t!==i.ceilingMoldings.length){for(let e=0;e<i.ceilingMoldings.length;e++)i.ceilingMoldings[e]={exist:!0,stroke:this.settings.stroke_color};e=!0}}this.demoline&&0==i.ceilingMoldings[this.moldingIndex].exist&&(i.ceilingMoldings[this.moldingIndex]={exist:!0,stroke:this.settings.stroke_color},e=!0),e&&(customCursor.fire("knock"),i.draw(),project.localSave())}if("eraser"===tool){let t=!1;for(let e=0;e<i.ceilingMoldings.length;e++)if(!0===i.ceilingMoldings[e].exist){for(let e=0;e<i.ceilingMoldings.length;e++)i.ceilingMoldings[e]={exist:!1};t=!0;break}if(!0===n.exist){for(let e=0;e<n.niches.length;e++){var a=n.niches[e];for(let t=0;t<comments.db.length;t++){let e=comments.db[t];e.id_item===a.id&&(e.delete(),t--)}}n.niches=[];for(let e=0;e<i.ceilingMoldings.length;e++)i.ceilingMoldings[e]={exist:!1};n.exist=!1,n.complex=!1,delete n.material,t=!0}t&&(customCursor.fire("knock"),i.draw(),project.localSave())}}}}if("isolation"===plan&&this.room){let i=this.room;if("wall_elements"===tool_group){if(!this.surface){let t=0;for(let e=0;e<i.isolation.length;e++)i.isolation[e].color===this.settings.stroke_color&&t++;if(t===i.isolation.length)return;for(let e=0;e<i.isolation.length;e++){var h=i.demolines[e];i.isolation[e]={exist:!0,name:tool,color:this.settings.stroke_color,width:h.width,height:h.height,area:h.area,area_doors:h.area_doors,area_windows:h.area_windows}}customCursor.fire("knock"),i.draw(),project.localSave()}this.surface&&(e=this.surface,0==i.isolation[this.surface.index].exist&&(i.isolation[this.surface.index]={exist:!0,name:tool,color:this.settings.stroke_color,width:e.width,height:e.height,area:e.area,area_doors:e.area_doors,area_windows:e.area_windows},customCursor.fire("knock"),i.draw(),project.localSave()))}if("eraser"===tool)for(let e=0;e<i.isolation.length;e++)if(!0===i.isolation[e].exist){for(let e=0;e<i.isolation.length;e++)i.isolation[e]={exist:!1},i.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"});customCursor.fire("knock"),i.draw(),project.localSave();break}}if("plaster"===plan&&this.room){let i=this.room;if("wall_elements"===tool_group){if(!this.surface){let t=0;for(let e=0;e<i.plaster.length;e++)i.plaster[e].color===this.settings.stroke_color&&t++;if(t===i.plaster.length)return;for(let e=0;e<i.plaster.length;e++){var g=i.demolines[e];i.plaster[e]={exist:!0,name:tool,color:this.settings.stroke_color,width:g.width,height:g.height,area:g.area,area_doors:g.area_doors,area_windows:g.area_windows}}customCursor.fire("knock"),i.draw(),project.localSave()}this.surface&&(e=this.surface,0==i.plaster[this.surface.index].exist&&(i.plaster[this.surface.index]={exist:!0,name:tool,color:this.settings.stroke_color,width:e.width,height:e.height,area:e.area,area_doors:e.area_doors,area_windows:e.area_windows},customCursor.fire("knock"),i.draw(),project.localSave()))}if("eraser"===tool)for(let e=0;e<i.plaster.length;e++)if(!0===i.plaster[e].exist){for(let e=0;e<i.plaster.length;e++)i.plaster[e]={exist:!1},i.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"});customCursor.fire("knock"),i.draw(),project.localSave();break}}}).on("reset",function(e){customCursor.overObject=!1,this.ICON&&this.ICON.fill(this.defaultColor)}).on("knock",function(e){let t=this;"demount"!==tool_group&&"wall_elements"!==tool_group||(this.ICON.rotate(-45),setTimeout(function(){t.ICON.untransform(),t.ICON.fill(t.defaultColor),t.overObject=!1},200)),"eraser"===tool||"floor"!==plan&&"hydroisolation"!==plan&&"ceiling"!==plan||(this.ICON.rotate(-45),setTimeout(function(){t.ICON.untransform(),t.ICON.fill(t.defaultColor),t.overObject=!1},200)),"eraser"===tool&&(this.CIRCLE=serviceLayer.circle(24).attr({stroke:"crimson","stroke-width":2,fill:"none"}).cx(this.cursor.x).cy(this.cursor.y).animate(300).attr({r:2,opacity:0}).after(function(){this.remove()}),this.fire("reset")),customCursor.overObject=!1,this.ICON&&(this.ICON.fill(this.defaultColor),this.ICON.stroke(this.defaultColor))}).on("eraserReaction",function(e){this.CIRCLE=serviceLayer.circle(24).attr({stroke:"crimson","stroke-width":2,fill:"none"}).cx(this.cursor.x).cy(this.cursor.y),this.CIRCLE.animate(300).attr({r:2,opacity:0}).after(function(){this.remove()}),this.ICON&&(this.ICON.fill(this.defaultColor),this.ICON.stroke(this.defaultColor))}).on("hide",function(e){this.activated=!1,this.hide()}).on("off",function(e){this.activated=!1,this.hide(),"none"===tool&&(this.activated=!1,this.hide())}),window.sCircle=serviceLayer.circle(8).attr({"stroke-width":2,stroke:"crimson",fill:"#fafafa"}).hide(),window.eCircle=serviceLayer.circle(8).attr({"stroke-width":2,stroke:"crimson",fill:"#fafafa"}).hide(),window.undo_redo_process=!1,$(".footer_bar_tool.undo").on("click",function(){!1===undo_redo_process&&$(this).hasClass("available")&&0<=copy_counter&&(hide(),copy_counter--,undo_redo_process=!0,project.load("local",null,"undo",copy_counter+1),0===copy_counter&&$(".footer_bar_tool.undo").removeClass("available"),0<copy_counter_max_value&&$(".footer_bar_tool.redo").addClass("available"),setTimeout(function(){undo_redo_process=!1},500))}),$(".footer_bar_tool.redo").on("click",function(){!1===undo_redo_process&&$(this).hasClass("available")&&(console.warn(copy_counter,copy_counter_max_value),copy_counter<copy_counter_max_value&&(hide(),copy_counter++,undo_redo_process=!0,project.load("local",null,"redo",copy_counter-1),copy_counter===copy_counter_max_value&&$(".footer_bar_tool.redo").removeClass("available"),0<copy_counter&&$(".footer_bar_tool.undo").addClass("available"),setTimeout(function(){undo_redo_process=!1},500)))}),$("#printA3").on("click",function(){se("A3")}),$("#printA4, #print").on("click",function(){se("A4")});function t(){this.image=serviceLayer.group(),this.m_line=this.image.line().attr({stroke:"#000000","stroke-width":.4}),this.s_dash=this.image.line().attr({stroke:"#000000","stroke-width":.4}),this.e_dash=this.image.line().attr({stroke:"#000000","stroke-width":.4}),this.bg=this.image.rect(22,12).radius(1).attr({stroke:"#555555","stroke-width":.2,fill:"#edf5ff"});let e=8,t=.4;"big"===project.font&&(e=12,t=.6),this.length=this.image.plain("").font({family:"Arial",size:e,stroke:"#000000","stroke-width":t,fill:"#000000"})}t.prototype.update=function(e,t){this.m_line.plot(e.x,e.y,t.x,t.y);var i=point_near_line_end(t,e,3,"L"),n=point_near_line_end(t,e,3,"R"),i=(this.s_dash.plot(i.x,i.y,n.x,n.y).untransform().rotate(45),point_near_line_end(e,t,3,"L")),n=point_near_line_end(e,t,3,"R"),i=(this.e_dash.plot(i.x,i.y,n.x,n.y).untransform().rotate(45),get_center(e,t));let s=get_distance(e,t).toFixed(0);this.bg.cx(i.x).cy(i.y),this.length.plain(s.toString()).cx(i.x).cy(i.y)},t.prototype.hide=function(){this.image.hide()},t.prototype.show=function(){this.image.show()},t.prototype.erase=function(){this.image.clear()};let ne=serviceLayer.group();function oe(){let e=serviceLayer.group();return e.circle(30).fill("transparent"),e.circle(8).cx(15).cy(15).attr({"stroke-width":2,stroke:"#dc143c",fill:"#fafafa"}).on("mouseover",function(){$("body").css("cursor","move")}).on("mouseleave",function(){$("body").css("cursor","default")}),e}function le(e,t,i){let n=z.crosshairs.line().attr({stroke:"orange","stroke-width":.6}),s=z.crosshairs.line().attr({stroke:"orange","stroke-width":.6}),o=z.crosshairs.line().attr({stroke:"orange","stroke-width":.4}),l=z.crosshairs.line().attr({stroke:"orange","stroke-width":.4});var r,a=t.x,h=svg.viewbox().y,g=svg.viewbox().y+svg.viewbox().height,h=(n.plot(a,h,a,g),t.y),a=svg.viewbox().x,g=svg.viewbox().x+svg.viewbox().width;s.plot(a,h,g,h),!0===i&&(a=svg.viewbox().width,g={x:t.x-a,y:t.y},h={x:t.x+a,y:t.y},i=get_point_near_line_end(t,g,a,"R"),r=get_point_near_line_end(t,h,a,"R"),o.plot(i.x,i.y,r.x,r.y),D.diagonal1={s:i,e:r},i=get_point_near_line_end(t,g,a,"L"),r=get_point_near_line_end(t,h,a,"L"),l.plot(i.x,i.y,r.x,r.y),D.diagonal2={s:i,e:r})}ne.on("init",function(e){this.t=new t,this.b=new t,this.l=new t,this.r=new t}),ne.on("update",function(e){var t=e.detail.label,i=e.detail.s,e=e.detail.e;"t"===t&&(this.t.update(i,e),this.t.show()),"b"===t&&(this.b.update(i,e),this.b.show()),"r"===t&&(this.r.update(i,e),this.r.show()),"l"===t&&(this.l.update(i,e),this.l.show())}),ne.on("hide",function(){this.t&&this.t.hide(),this.b&&this.b.hide(),this.l&&this.l.hide(),this.r&&this.r.hide()}),ne.on("show",function(){this.t&&this.t.show(),this.b&&this.b.show(),this.l&&this.l.show(),this.r&&this.r.show()}),ne.on("remove",function(){this.t&&this.t.erase(),this.b&&this.b.erase(),this.l&&this.l.erase(),this.r&&this.r.erase()});function re(i){if(i&&i.axis){var n=get_big_line(i.axis),s=LIB.projection(i.l1,n),o=LIB.projection(i.r1,n),l=LIB.projection(i.l2,n),n=LIB.projection(i.r2,n),i=get_line_center(i.axis),r=get_distance(i,s),a=get_distance(i,o),h=get_distance(i,l),i=get_distance(i,n);let e,t;if(e=r<=a?copy.point(s):copy.point(o),t=h<=i?copy.point(l):copy.point(n),e&&t)return get_line(e,t)}}window.crosshair4={mode:"A",wall:null,connection:"",point:{},vl:serviceLayer.line().attr({stroke:"orange","stroke-width":.6}).hide(),hl:serviceLayer.line().attr({stroke:"orange","stroke-width":.6}).hide(),d1:serviceLayer.line().attr({stroke:"orange","stroke-width":.6}).hide(),d2:serviceLayer.line().attr({stroke:"orange","stroke-width":.6}).hide(),draw:function(e){var t=walls.db[S.wall],t=!are_points_equal(t.s,this.point),i="axis"===this.connection;(t||i)&&("s"===this.connection&&(this.point=this.wall.s),"e"===this.connection&&(this.point=this.wall.e),this.vl.plot(this.point.x,-1e5,this.point.x,1e5).show(),this.hl.plot(-1e5,this.point.y,1e5,this.point.y).show(),!0===e&&(t=Math.abs(this.wall.s.x-this.wall.e.x)<.5,i=Math.abs(this.wall.s.y-this.wall.e.y)<.5,"A"===this.mode&&this.draw_way_1(),"B"===this.mode&&(t||i?this.draw_way_1():this.draw_way_2())))},draw_way_1:function(){var e=svg.viewbox().width,t={x:this.point.x-e,y:this.point.y},i={x:this.point.x+e,y:this.point.y},n=get_point_near_line_end(this.point,t,e,"R"),s=get_point_near_line_end(this.point,i,e,"R"),n=(this.d1.plot(n.x,n.y,s.x,s.y).show(),D.diagonal1={s:n,e:s},get_point_near_line_end(this.point,t,e,"L")),s=get_point_near_line_end(this.point,i,e,"L");this.d2.plot(n.x,n.y,s.x,s.y).show(),D.diagonal2={s:n,e:s}},draw_way_2:function(){let e,t;"axis"===this.connection&&(e=get_point_near_line_end(this.wall.s,this.point,1e4,"L"),t=get_point_near_line_end(this.wall.s,this.point,1e4,"R")),"s"===this.connection&&(e=get_point_near_line_end(this.wall.e,this.wall.s,1e4,"L"),t=get_point_near_line_end(this.wall.e,this.wall.s,1e4,"R")),"e"===this.connection&&(e=get_point_near_line_end(this.wall.s,this.wall.e,1e4,"L"),t=get_point_near_line_end(this.wall.s,this.wall.e,1e4,"R")),this.d1.plot(this.point.x,this.point.y,e.x,e.y).show(),D.diagonal1={s:this.point,e:e},this.d2.plot(this.point.x,this.point.y,t.x,t.y).show(),D.diagonal2={s:this.point,e:t}},hide:function(){this.vl.hide(),this.hl.hide(),this.d1.hide(),this.d2.hide()}},window.mouse={start:null,end:null,delta:null,min_delta:1.5*defs.wall.depth,projection_search:function(e){if("wall"===e)for(let t=0;t<walls.db.length;t++)for(let e=0;e<walls.db[t].parts.length;e++){var i,n,s=walls.db[t],o=walls.db[t].parts[e],l="init_copy"===s.label,r="build"===s.label,s="break"===s.label;l&&r&&s&&"wall"===o.role&&(l={s:o.s,e:o.e},r=get_point_projection(mouse.end,l),s=get_distance(mouse.end,r)<10,i=is_point_on_line(r,l),s&&i&&(this.wall=t,this.part=e,this.point=copy_point(r),get_distance(mouse.end,o.s)<10&&(this.point={x:o.s.x,y:o.s.y}),get_distance(mouse.end,o.e)<10&&(this.point={x:o.e.x,y:o.e.y}),this.connection="axis",(s=get_distance(o.l1,o.l2))<=(i=get_distance(o.r1,o.r2))&&(n=point_near_line_end_point(o.s,r,o.wall.outer_depth,"L"),this.length_a=Math.round(get_distance(o.l1,n)),this.length_b=Math.round(get_distance(n,o.l2))),i<s&&(n=point_near_line_end_point(o.e,r,o.wall.inner_depth,"L"),this.length_a=Math.round(get_distance(o.r1,n)),this.length_b=Math.round(get_distance(n,o.r2))),this.center_a=get_center(o.s,r),this.center_b=get_center(r,o.e),this.axis=l))}},down:{axis:null,connection:null,free_point:null,length_a:null,length_b:null,center_a:null,center_b:null,node:!1,object:null,over_pillar:null,over_wall:null,part:null,point:null,sector:null,side:!1,pos_s:null,epos:null,wall:null,search:function(e){this.reset(),this.over_wall=null,this.over_pillar=null;var i=get_svg_point({x:e.clientX,y:e.clientY});let n=null;if("init"===plan&&(n="build"),"break"===plan&&(n="build"),"build"===plan&&(n="break"),"wall"===tool||"balcony"===tool){if(a_line.fire("hide"),allow.magnet){let t=[],i=!0;for(let e=0;e<walls.db.length;e++){var s,o=walls.db[e];"init_copy"!==o.label&&o.label!==n&&(s=get_big_line(o.axis),get_distance(s=get_point_projection(mouse.end,s),mouse.end)<10&&(t.push({xy:o.s,wall:e,type:"s",distance:get_distance(o.s,mouse.end)}),t.push({xy:o.e,wall:e,type:"e",distance:get_distance(o.e,mouse.end)}),is_point_on_line(s,o.axis)&&(i=!1)))}(t=function(i){let n=[];e:for(let t=0;t<i.length;t++){for(let e=0;e<n.length;e++)if(are_points_equal(n[e].xy,i[t].xy))continue e;n.push(i[t])}return n}(t)).sort(compare_distance);var l,r,e=t[0];e&&i&&(r=get_big_line((l=walls.db[e.wall]).axis),(r=get_point_projection(mouse.end,r))&&get_distance(mouse.end,r)<l.depth/2&&30<get_distance(r,e.xy)&&(is_point_on_line(r,l.axis)||(mouse.end=r,mouse.down.free_point=r,drawing||panning||"wall"!==tool&&"balcony"!==tool||null===this.over_wall&&null===this.over_pillar&&(o_sign.fire("show",{center:mouse.end,active:!0}),a_line.fire("show",{s:e.xy,e:mouse.end})))))}for(let e=0;e<pillars.db.length;e++){var t=pillars.db[e];"pillar"===t.role&&is_point_inside_polygon(i,t.polygon)&&(this.over_pillar=e)}for(let t=0;t<walls.db.length;t++)if(t!==S.wall){var a=walls.db[t];if("init"===plan){if("build"===a.label)continue;if("init_copy"===a.label)continue}if("build"===plan){if("break"===a.label)continue;if("init_copy"===a.label)continue}is_point_inside_polygon(i,a.polygon)&&(this.over_wall=t);var h={s:LIB.pointOnLine(a.e,a.s,defs.wall.depth),e:LIB.pointOnLine(a.s,a.e,defs.wall.depth)},g=LIB.projection(mouse.end,h),h=get_point_place(mouse.end,h),g=get_distance(mouse.end,g);if(mouse.down.node=!1,"L"===h&&g<20+a.outer_depth)for(let e=0;e<a.borders.o.length;e++){var _=a.borders.o[e];if(d=LIB.projection(mouse.end,_)){var d,p=defs.wall.depth/2,p=get_point_near_line_point(_,d=ge(0,_,d,p,defs.wall.depth),p,"L");if(mouse.end=copy.point(p),mouse.down.object="wall",mouse.down.wall=t,mouse.down.point=copy.point(p),get_distance(d,(mouse.down.border=_).s)<=defs.wall.depth/2&&(mouse.down.pos_s={object:t,index:t,pos:"SO"},mouse.down.border=_),get_distance(d,_.e)<=defs.wall.depth/2&&(mouse.down.pos_s={object:t,index:t,pos:"EO"},mouse.down.border=_),!(drawing||panning||"wall"!==tool&&"balcony"!==tool||null!==this.over_wall||null!==this.over_pillar)){let e=0,t=0;!1===mouse.down.node&&(e=get_distance(_.s,d)-defs.wall.depth/2,t=get_distance(_.e,d)-defs.wall.depth/2);p=get_point_near_line_end(d,mouse.end,24,"L"),_=get_point_near_line_end(d,mouse.end,24,"R");o_sign.fire("show",{center:mouse.end,active:!0}),s_size.fire("show",{center:p,length:e.toFixed()}),e_size.fire("show",{center:_,length:t.toFixed()})}}}if("R"===h&&g<20+a.inner_depth)for(let e=0;e<a.borders.i.length;e++){var c=a.borders.i[e];if(A=LIB.projection(mouse.end,c)){var A,u=defs.wall.depth/2,u=get_point_near_line_point(c,A=ge(0,c,A,u,defs.wall.depth),u,"R");if(mouse.end=copy.point(u),mouse.down.object="wall",mouse.down.wall=t,mouse.down.point=copy.point(u),get_distance(A,c.s)<=defs.wall.depth/2&&(mouse.down.pos_s={object:t,index:t,pos:"SI"}),get_distance(A,c.e)<=defs.wall.depth/2&&(mouse.down.pos_s={object:t,index:t,pos:"EI"}),!(drawing||panning||"wall"!==tool&&"balcony"!==tool||null!==this.over_wall||null!==this.over_pillar)){let e=0,t=0;!1===mouse.down.node&&(e=get_distance(c.s,A)-defs.wall.depth/2,t=get_distance(c.e,A)-defs.wall.depth/2);u=get_point_near_line_end(A,mouse.end,24,"R"),c=get_point_near_line_end(A,mouse.end,24,"L");o_sign.fire("show",{center:mouse.end,active:!0}),s_size.fire("show",{center:u,length:e.toFixed()}),e_size.fire("show",{center:c,length:t.toFixed()})}}}null===a.links.s&&0===a.walls_s.length&&(h={s:a.s,e:LIB.pointOnLine(a.e,a.s,defs.wall.depth+10)},(g=LIB.projection(mouse.end,h))&&is_point_between_line_points(g,h)&&get_distance(mouse.end,g)<20&&(h=LIB.pointOnLine(a.e,a.s,defs.wall.depth/2),mouse.end=copy.point(h),mouse.down.object="wall",mouse.down.wall=t,mouse.down.point=copy.point(h),mouse.down.connection="sO",drawing||panning||"wall"!==tool&&"balcony"!==tool||null===this.over_wall&&null===this.over_pillar&&o_sign.fire("show",{center:mouse.end,active:!0}))),null===a.links.e&&0===a.walls_e.length&&(g={s:a.e,e:LIB.pointOnLine(a.s,a.e,defs.wall.depth+10)},(h=LIB.projection(mouse.end,g))&&get_distance(mouse.end,h)<20&&(g=LIB.pointOnLine(a.s,a.e,defs.wall.depth/2),mouse.end=copy.point(g),mouse.down.object="wall",mouse.down.wall=t,mouse.down.point=copy.point(g),mouse.down.connection="eO",drawing||panning||"wall"!==tool&&"balcony"!==tool||null===this.over_wall&&null===this.over_pillar&&o_sign.fire("show",{center:mouse.end,active:!0})))}for(let t=0;t<pillars.db.length;t++){var w=pillars.db[t];if("pillar"===w.role&&w.borders)for(let e=0;e<w.borders.length;e++){var m=w.borders[e],f=Math.max(w.width/2,w.height/2);if(get_distance(mouse.end,w.center)<2*f){f=defs.wall.depth/2;let i=LIB.projection(mouse.end,m);if(i&&get_distance(mouse.end,i)<20&&(i=function(e,t,i,n){get_distance(t,e.s)<i+n&&(t=LIB.pointOnLine(e.e,e.s,-i));get_distance(t,e.e)<i+n&&(t=LIB.pointOnLine(e.s,e.e,-i));return t}(m,i,f,1),this.object="pillar",this.index=t,this.point=get_point_near_line_point(m,i,f,"L"),mouse.end=this.point,this.edge=m,this.side=m.side,this.connection="pillar",!(drawing||panning||"wall"!==tool&&"balcony"!==tool||null!==this.over_pillar))){let e=get_distance(m.s,i)-defs.wall.depth/2,t=get_distance(m.e,i)-defs.wall.depth/2;f=get_point_near_line_end(i,mouse.end,24,"L"),m=get_point_near_line_end(i,mouse.end,24,"R");o_sign.fire("show",{center:this.point,active:!0}),s_size.fire("show",{center:f,length:e.toFixed()}),e_size.fire("show",{center:m,length:t.toFixed()})}}}}}if("break_part"===tool){this.visible=!0,break_line.hide();for(let t=0;t<walls.db.length;t++){var I=walls.db[t];if("init_copy"!==I.label&&(I.label!==n&&"wall"===I.role))for(let e=0;e<walls.db[t].axis_lines.length;e++){var C=walls.db[t].axis_lines[e],y=LIB.projection(mouse.end,C);if(y&&get_distance(mouse.end,y)<10){this.wall=t,this.part=e,this.point=copy_point(y),get_distance(mouse.end,C.s)<10&&(this.point=copy.point(C.s),this.visible=!1),get_distance(mouse.end,C.e)<10&&(this.point=copy.point(C.e),this.visible=!1),this.connection="axis";var b,v=get_distance(C.s,C.e),x=get_distance(C.s,C.e);if(v<=x&&(b=point_near_line_end_point(C.s,y,I.outer_depth,"L"),this.length_a=Math.round(get_distance(C.s,b)),this.length_b=Math.round(get_distance(b,C.e))),x<v&&(b=point_near_line_end_point(C.e,y,I.inner_depth,"L"),this.length_a=Math.round(get_distance(C.s,b)),this.length_b=Math.round(get_distance(b,C.e))),this.axis=C,o_sign.fire("show",{center:this.point,active:!0}),this.visible&&!drawing&&!panning&&"break_part"===tool){x={s:LIB.pointOnLine(C.e,C.s,30),e:LIB.pointOnLine(C.s,C.e,30)},v=LIB.projection(this.point,x);if(v){break_line.plot(C.s.x,C.s.y,C.e.x,C.e.y).show();y=LIB.pointOnLine(x.s,v,-24),x=LIB.pointOnLine(x.e,v,-24);let e=get_distance(C.s,v),t=get_distance(C.e,v);s_size.fire("show",{center:y,length:e.toFixed()}),e_size.fire("show",{center:x,length:t.toFixed()})}}}}}for(let e=0;e<sectors.db.length;e++){var B=sectors.db[e];if(is_point_inside_polygon(mouse.end,B.polygon)){mouse.down.sector=e;break}}}},reset:function(){this.axis=null,this.connection=null,this.free_point=null,this.length_a=null,this.length_b=null,this.center_a=null,this.center_b=null,this.node=!1,this.object=null,this.over_pillar=null,this.over_wall=null,this.part=null,this.point=null,this.sector=null,this.side=!1,this.pos_s=null,this.epos=null,this.wall=null}},up:{object:null,wall:null,inside_wall:null,sector:null,sector_type:null,point:null,type:null,part_role:null,search:function(e){if(this.reset(),!0===allow.magnet){var n=walls.db[S.wall];for(let i=0;i<walls.db.length;i++){var s=walls.db[i];if((!n||s.id!==n.id)&&!(Y&&s.id===Y.id||Be&&s.id===Be.id||"init_copy"===s.label||"init"===plan&&"build"===s.label||"build"===plan&&"break"===s.label)){var o=s.length/2,l=Math.abs(s.s.x-n.e.x)<o&&Math.abs(s.s.y-n.e.y)<o,o=Math.abs(s.e.x-n.e.x)<o&&Math.abs(s.e.y-n.e.y)<o;if(l||o){let t;l=get_point_place(mouse.end,s.axis);let e=s.outer_depth;"R"===l&&(e=s.inner_depth),t=allow.magnet?e+15:e/2;var o={s:LIB.pointOnLine(s.e,s.s,-defs.wall.depth),e:LIB.pointOnLine(s.s,s.e,-defs.wall.depth)},l=LIB.projection(mouse.end,o);l&&get_distance(mouse.end,l)<t&&(30<(o=get_angle(n.s,l,o.s))&&o<150&&(this.object="wall",this.wall=i,this.point={x:l.x,y:l.y},this.type="axis"));for(let e=0;e<s.parts.length;e++){var r=s.parts[e],r=LIB.projection(mouse.end,r.axis);r&&get_distance(mouse.end,r)<t&&(this.part_role=s.parts[e].role)}null===s.links.s&&get_distance(mouse.end,s.s)<t&&(null!==s.s_node&&get_distance(mouse.end,s.s_node)<t&&(this.object="wall",this.wall=i,this.point={x:s.s_node.x,y:s.s_node.y},this.type="snode",this.part_role="wall"),null===s.s_node&&(o=LIB.pointOnLine(s.e,s.s,defs.wall.depth/2),l=LIB.pointOnLine(s.e,s.s,-defs.wall.depth/2),get_distance(mouse.end,o)<t&&(this.object="wall",this.wall=i,this.point={x:o.x,y:o.y},this.type="sO",this.part_role="wall"),get_distance(mouse.end,l)<t&&(this.object="wall",this.wall=i,this.point={x:l.x,y:l.y},this.type="sI",this.part_role="wall"))),null===s.links.e&&get_distance(mouse.end,s.e)<t&&(null!==s.e_node&&get_distance(mouse.end,s.e_node)<t&&(this.object="wall",this.wall=i,this.point={x:s.e_node.x,y:s.e_node.y},this.type="enode",this.part_role="wall"),null===s.e_node&&(o=LIB.pointOnLine(s.s,s.e,defs.wall.depth/2),l=LIB.pointOnLine(s.s,s.e,-defs.wall.depth/2),get_distance(mouse.end,o)<t&&(this.object="wall",this.wall=i,this.point={x:o.x,y:o.y},this.type="eO",this.part_role="wall"),get_distance(mouse.end,l)<t&&(this.object="wall",this.wall=i,this.point={x:l.x,y:l.y},this.type="eI",this.part_role="wall")))}}}for(let t=0;t<pillars.borders.length;t++){var i=pillars.borders[t],a=LIB.lineLength(i)/2;Math.abs(i.s.x-n.e.x)<a&&Math.abs(i.s.y-n.e.y),Math.abs(i.e.x-n.e.x)<a&&Math.abs(i.e.y-n.e.y);let e=LIB.projection(mouse.end,i);e&&get_distance(mouse.end,e)<20&&(45<=(a=get_angle(n.s,e,i.s))&&a<=135&&(a=get_big_line(i),a=get_distance(line_and_line_intersection(n.straight_o,a),line_and_line_intersection(n.straight_i,a))/2,get_distance(e,i.s)<3+a&&(e=LIB.pointOnLine(i.e,i.s,-a)),get_distance(e,i.e)<3+a&&(e=LIB.pointOnLine(i.s,i.e,-a)),this.object="pillar",this.index=i.pillar_index,this.point=e,this.edge=i))}}if(!1===allow.magnet)for(let e=0;e<walls.db.length;e++){var t,h,g=walls.db[e];"init_copy"===g.label||"init"===plan&&"build"===g.label||"build"===plan&&"break"===g.label||e!==S.wall&&e!==mouse.down.wall&&(h=LIB.pointOnLine(g.e,g.s,defs.wall.depth/2),LIB.pointOnLine(g.e,g.s,-defs.wall.depth/2),t=LIB.pointOnLine(g.s,g.e,defs.wall.depth/2),LIB.pointOnLine(g.s,g.e,-defs.wall.depth/2),is_point_on_line(mouse.end,g.axis)||(null!==g.s_node&&get_distance(mouse.end,g.s_node)<10&&(this.wall=e,this.point={x:g.s_node.x,y:g.s_node.y},this.type="snode"),null===g.s_node&&get_distance(mouse.end,h)<10&&(this.wall=e,this.point={x:h.x,y:h.y},this.type="sO"),null!==g.e_node&&get_distance(mouse.end,g.e_node)<10&&(this.wall=e,this.point={x:g.e_node.x,y:g.e_node.y},this.type="enode"),null===g.e_node&&get_distance(mouse.end,t)<10&&(this.wall=e,this.point={x:t.x,y:t.y},this.type="eO")),h=get_point_projection(mouse.end,g.axis),get_distance(mouse.end,h)<10&&is_point_on_line(h,g.axis)&&(this.wall=e,this.point={x:h.x,y:h.y},this.type="axis"))}},reset:function(){this.object=null,this.wall=null,this.part_role=null,this.inside_wall=null,this.sector=null,this.sector_type=null,this.point=null,this.type=null}},over:{wall:null,pillar:null,room:null,window:!1,door:!1,doorway:!1,search:function(e){if(mouse.over.room=null,mouse.over.pillar=null,"room"===e){if(mouse.over.ROOM=!1,"init"===plan||"break"===plan)for(let e=0;e<rooms1.data.length;e++){var t=rooms1.data[e];is_point_inside_polygon(mouse.end,t.polygon)&&(mouse.over.room=e,mouse.over.id_room=t.id,mouse.over.ROOM=t)}if("build"===plan||"B"===plan_group)for(let e=0;e<rooms2.data.length;e++){var i=rooms2.data[e];is_point_inside_polygon(mouse.end,i.polygon)&&(mouse.over.room=e,mouse.over.id_room=i.id,mouse.over.ROOM=i)}}if("pillar"===e)for(let e=0;e<pillars.db.length;e++)is_point_inside_polygon(mouse.end,pillars.db[e].polygon)&&(mouse.over.pillar=e,mouse.over.pillars_id=pillars.db[e].id);if("pillar"===tool||"pillar_air"===tool||"pillar_water"===tool){mouse.over.room=null;for(let e=0;e<rooms1.data.length;e++)rooms1.data[e].in_pillar||is_point_inside_polygon(mouse.end,rooms1.data[e].points)&&(mouse.over.room=e)}}},reset:function(){this.start={},this.end={},this.delta=null,this.down.reset(),this.up.reset()}};let ae=serviceLayer.group().hide().on("mousedown",function(){this.hide(),console.log(this.parent),this.parent,this.parent,this.parent=!1}),A=(ae.add(svg.circle(28,28).attr({stroke:"#3e3e3e","stroke-width":.4,fill:"#fafafa"})),ae.add(svg.path("M21.5,7.9l-1.4-1.4c-0.7-0.7-1.7-0.7-2.4,0C17,7.1,7.5,16.6,6.9,17.3c-0.1,0.1-0.1,0.2-0.1,0.2L6,21.4c0,0.2,0,0.3,0.1,0.4C6.2,22,6.4,22,6.6,22l3.9-0.7c0.1,0,0.2-0.1,0.2-0.1l10.8-10.8C22.2,9.7,22.2,8.6,21.5,7.9z M7.1,20.9l0.4-2.4l1.9,1.9L7.1,20.9z M10.4,20.1l-2.5-2.5l9.2-9.2l2.5,2.5L10.4,20.1z M20.8,9.7l-0.6,0.6l-2.5-2.5l0.6-0.6c0.3-0.3,0.8-0.3,1.1,0l1.4,1.4C21.1,8.9,21.1,9.4,20.8,9.7z").attr({stroke:"#555555","stroke-width":.4,fill:"#555555"})),{motion_line:null,part:!(window.showContextmenuIcon=function(e){ae.hide();var t=LIB.point(e.clientX,e.clientY,"svg");if("free"===mode&&"none"===tool){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if("init"===plan&&"init"===i.label)for(let e=0;e<i.parts.length;e++){var n=i.parts[e];is_point_inside_polygon(t,n.polygon)&&(ae.show().cx(n.c.x).cy(n.c.y),ae.parent="wall")}}if("init"===plan)for(let e=0;e<pillars.db.length;e++){var s=pillars.db[e];"pillar"===s.role&&is_point_inside_polygon(t,s.polygon)&&(ae.show().cx(s.center.x).cy(s.center.y),ae.parent="pillar")}}})});function he(){let e=serviceLayer.group().attr({cursor:"pointer"});return e.rect(12,14).radius(2).attr({stroke:colors.crimson,"stroke-width":1.4,fill:"#ffb2c1"}),e.path("M0,2.6L3,0L6,2.6M3,8L3,0").attr({stroke:"#dc143c","stroke-width":1.2,"stroke-linecap":"round",fill:"transparent"}).x(3).y(8),e}let f=null;svg.circle(32).attr({stroke:"green",fill:"green",opacity:.2}).hide();function ge(e,t,i,n,s){var o=t.s,l=t.e;return mouse.down.node=!1,get_distance(i,o)<n+s&&(i=LIB.pointOnLine(l,o,-n),t.link_s&&t.on_line_s&&(i=t.s,mouse.down.node=!0)),get_distance(i,l)<n+s&&(i=LIB.pointOnLine(o,l,-n),t.link_e&&t.on_line_e&&(i=t.e,mouse.down.node=!0)),i}manager_lining.init_temporary_line(),window.closest={edge:null,edge_r:null,socket:null};let _e,de;function pe(e,t,i,n){return get_distance(e,t.s)<=i+n?LIB.pointOnLine(t.e,t.s,-i):get_distance(e,t.e)<=i+n?LIB.pointOnLine(t.s,t.e,-i):e}function ce(){let e=serviceLayer.group().on("mouseover",function(){$("body").css("cursor","pointer")}).on("mouseleave",function(){$("body").css("cursor","default")});return e.add(serviceLayer.circle(28).attr({"stroke-width":.2,stroke:"#555555","stroke-linecap":"round",fill:"#f8f8f8"})),e.add(serviceLayer.path("M19,16.1c0-0.1-0.1-0.3-0.2-0.4l-4.4-4.5C14.3,11.1,14.2,11,14,11h0c-0.1,0-0.3,0.1-0.4,0.2l-4.5,4.5c-0.2,0.2-0.2,0.6,0,0.8l0.3,0.3C9.6,16.9,9.7,17,9.9,17c0.1,0,0.3-0.1,0.4-0.2l3.7-3.7l3.7,3.7c0.1,0.1,0.2,0.2,0.4,0.2c0.1,0,0.3-0.1,0.4-0.2l0.3-0.3C18.9,16.4,19,16.2,19,16.1z").attr({"stroke-width":0,fill:"#dc143c"})),e}let i=!1,Ae=(window.cursors={},cursors.changed=!0,cursors.own=serviceLayer.group().on("init",function(e){"wall"!==tool&&(this.clear(),this.activated=!0,$("body").css("cursor","default"),in_array(tool_group,["sockets","lights"])&&$("body").css("cursor","none"),this.hidden=!1,this.changed=!1,this.settings=e.detail.settings,this.settings&&(""===this.settings.path&&(this.settings.path=get_pseudo_tool_path(this.settings.width,this.settings.height)),this.settings.width=parseInt(this.settings.width,10),this.settings.height=parseInt(this.settings.height,10)),this.settings.hasOwnProperty("width_changed")||(this.settings.width_changed=this.settings.width),this.settings.hasOwnProperty("height_changed")||(this.settings.height_changed=this.settings.height),"break"!==tool&&"break_door"!==tool||(this.settings.path=hammer,this.settings.stroke_color="black",this.settings.stroke_width=.6,this.settings.filling="crimson"),"plaster_visual"!==tool&&"plaster_full"!==tool&&"remove_plaster"!==tool||(this.settings.path=hammer,this.settings.stroke_color="black",this.settings.stroke_width=.6),"ceiling_elements"===tool_group&&(this.settings.stroke_color="black"),"wall_elements"===tool_group&&(this.settings.stroke_color="black"),"remove_flooring"===tool&&(this.settings.filling="crimson"),"isolation_thermo"===tool&&(this.settings.stroke_color=this.settings.filling),"isolation_sound"===tool&&(this.settings.stroke_color=this.settings.filling),"plaster_visual"===tool&&(this.settings.stroke_color=this.settings.filling),"plaster_full"===tool&&(this.settings.stroke_color=this.settings.filling),"wall_elements"===tool_group&&"walls"===plan&&(this.settings.stroke_color=this.settings.filling),"fire_detector"===tool&&(this.settings.stroke_color="red"),"radiator_old"===tool&&(this.settings.stroke_color="black"),"electric_shield_old"===tool&&(this.settings.stroke_color="black"),void 0!==CustomIcons[tool]?this.image=CustomIcons[tool].group().cx(-1e5).cy(-1e5).id("custom_cursor"):socketsGroup.is_allow(tool)?this.image=socketsGroup.get_image([{name:tool}]).cx(-1e5).cy(-1e5).id("custom_cursor"):("gas_pipe"===tool?this.image=svg.circle(8).attr({stroke:"#000000","stroke-width":1.4,fill:"yellow"}):"heat_pipe"===tool?this.image=svg.circle(8).attr({stroke:"#000000","stroke-width":1.4,fill:"red"}):"fire_detector"===tool?this.image=svg.path(this.settings.path).attr({stroke:"red","stroke-width":1.4,fill:"transparent"}):"radiator_old"===tool?this.image=svg.path(this.settings.path).attr({stroke:"black","stroke-width":1.4,fill:"transparent"}):(this.bg=svg.circle(10).attr({fill:"transparent"}).cx(-1e5).cy(-1e5),this.image=svg.path(this.settings.path).attr({stroke:this.settings.stroke_color,"stroke-width":this.settings.stroke_width,fill:this.settings.filling})),this.image.cx(-1e5).cy(-1e5).id("custom_cursor")),e=this.image.bbox(svg),this.settings.width_k=parseFloat((e.w/this.settings.width).toFixed(2)),this.settings.height_k=parseFloat((e.h/this.settings.height).toFixed(2)),"stairs"!==tool_group&&"furniture"!==tool_group||(this.image.width(this.settings.width_changed*this.settings.width_k).height(this.settings.height_changed*this.settings.height_k),this.width_long=this.settings.width_changed*this.settings.width_k,this.height_long=this.settings.height_changed*this.settings.height_k),"waterspots"===tool_group&&(this.width_long=this.settings.width_changed,this.height_long=this.settings.height_changed),serviceLayer.add(this.image),ne.fire("remove"),ne.fire("init"),ne.fire("hide"),"light"===plan&&in_array(tool,light_reference_lines.tools)&&light_reference_lines.build())}).on("init2",function(e){console.warn("cursors.own init2");var t=e.detail.target;"ventHole"===t&&(this.activated=!0,this.w=20,this.clear(),this.settings=e.detail.settings,this.settings.stroke_color="#1d95da",this.settings.stroke_width=1.4,this.settings.filling="#fafafa",this.image=svg.rect(this.w,10).attr({stroke:"#1d95da","stroke-width":1.4,fill:"#fafafa"}).on("mousedown",function(e){3===e.which&&(cursors.own.fire("remove"),cursors.own.fire("off"))}),this.arrow1=svg.path("M5.6,8.5c0,0,0-0.1,0-0.1l0-6.3l0.1,0.1C5.8,2.3,5.9,2.4,6,2.5l1.8,1.8C8,4.5,8.3,4.6,8.6,4.4c0.3-0.2,0.3-0.6,0.1-0.9c0,0,0,0-0.1-0.1L5.5,0.2c-0.3-0.3-0.7-0.3-0.9,0c0,0,0,0,0,0L1.3,3.4c-0.3,0.3-0.3,0.7,0,0.9c0,0,0,0,0.1,0.1C1.7,4.6,2,4.5,2.2,4.3L4,2.5c0.1-0.1,0.2-0.2,0.2-0.3L4.4,2l0,6.3c0,0.3,0.2,0.6,0.5,0.7C5.2,9,5.6,8.8,5.6,8.5z").attr({stroke:"#1d95da","stroke-width":.6,fill:"#1d95da"}),this.arrow2=svg.path("M5.6,8.5c0,0,0-0.1,0-0.1l0-6.3l0.1,0.1C5.8,2.3,5.9,2.4,6,2.5l1.8,1.8C8,4.5,8.3,4.6,8.6,4.4c0.3-0.2,0.3-0.6,0.1-0.9c0,0,0,0-0.1-0.1L5.5,0.2c-0.3-0.3-0.7-0.3-0.9,0c0,0,0,0,0,0L1.3,3.4c-0.3,0.3-0.3,0.7,0,0.9c0,0,0,0,0.1,0.1C1.7,4.6,2,4.5,2.2,4.3L4,2.5c0.1-0.1,0.2-0.2,0.2-0.3L4.4,2l0,6.3c0,0.3,0.2,0.6,0.5,0.7C5.2,9,5.6,8.8,5.6,8.5z").attr({stroke:"#1d95da","stroke-width":.6,fill:"#1d95da"})),"electricShieldA"===t&&(this.settings=e.detail.settings,this.image=svg.path(this.settings.path).attr({stroke:this.settings.stroke_color,"stroke-width":this.settings.stroke_width,fill:this.settings.filling}).cx(-1e5).cy(-1e5).id("custom_cursor"))}).on("update",function(e){var t,i;"ventilation_hole"===tool?(this.w=e.detail.width,this.image.width(this.w),t=LIB.point(this.c0.x+this.w/2,this.c0.y-5),i=LIB.point(this.c0.x+this.w/2,this.c0.y+15),this.arrow1.cx(t.x).cy(t.y),this.arrow2.untransform(),this.arrow2.cx(i.x).cy(i.y).rotate(180)):(this.settings.width_changed=e.detail.width,this.settings.height_changed=e.detail.height,this.image.width(this.settings.width_changed*this.settings.width_k).height(this.settings.height_changed*this.settings.height_k),this.width_long=this.settings.width_changed*this.settings.width_k,this.height_long=this.settings.height_changed*this.settings.height_k,ne.fire("remove"),ne.fire("init"),ne.fire("hide"))}).on("park",function(){var e,t;this.c0=get_svg_point({x:258,y:141}),this.image.move(this.c0.x,this.c0.y),"ventilation_hole"===tool&&(e=LIB.point(this.c0.x+this.w/2,this.c0.y-5),t=LIB.point(this.c0.x+this.w/2,this.c0.y+15),this.arrow1.cx(e.x).cy(e.y),this.arrow2.untransform(),this.arrow2.cx(t.x).cy(t.y).rotate(180))}).on("move",function(n){if("wall"!==tool){if("fire_detector"===tool&&ne.fire("hide"),this.image.untransform(),this.angle=0,this.projection=null,this.edge=null,this.line_index=null,mouse.over.search("room"),this.room=mouse.over.room,(allow.item=!0)===this.changed&&(this.image.plot(this.settings.path).attr({stroke:this.settings.stroke_color,"stroke-width":this.settings.stroke_width,fill:this.settings.filling}),this.changed=!1),this.image.cx(mouse.end.x).cy(mouse.end.y),"break"!==tool&&"break_door"!==tool||this.image.cx(mouse.end.x+10).cy(mouse.end.y+10),"water"===plan&&groupWaterSpots.is_source(tool)){let i=!1;for(let e=0;e<items.db.length;e++){let t=items.db[e];if((t.props.id_wall||t.props.id_pillar)&&groupWaterSpots.is_target(tool,t.props.name))if(get_distance(mouse.end,t.props.center)<(in_array(t.props.name,piping.water_items)?20:17)){if(t.hide(),groupWaterSpots.target_id&&groupWaterSpots.target_id!==t.props.id)break;if(!groupWaterSpots.target_id){try{this.image.clear()}catch(e){}if(this.image.remove(),groupWaterSpots.target_id=t.props.id,groupWaterSpots.name_item=groupWaterSpots.get_group_name(tool,t.props.name),this.image=CustomIcons[groupWaterSpots.name_item].group(t.props.waterspots_change_sequence).id("custom_cursor"),null!==closest.edge)closest.edge.draw("color"),closest.edge=null;else if(null!==this.room){let e=rooms2.data[this.room];e.draw_("border_dimensions",{remove:!1})}}let e=t.props.center;return"waterspot_drainage"===tool&&(e=LIB.pointOnLine(t.bp,t.props.projection,3)),this.image.cx(e.x).cy(e.y),this.angle=t.props.angle,this.image.rotate(this.angle),void(i=!0)}}if(!i&&groupWaterSpots.target_id){try{this.image.clear()}catch(e){}this.image.remove();let e=get_item(groupWaterSpots.target_id);e.show(),groupWaterSpots.target_id=null,this.image=CustomIcons[tool].group().id("custom_cursor")}}if(in_array(plan,["sockets","light_connections"])&&socketsGroup.is_allow(tool)){socketsGroup.block_cursor&&(socketsGroup.setDefaultColor(this.image,tool),socketsGroup.block_cursor=!1,null!==closest.edge&&(closest.edge.draw("color"),closest.edge=null));let i=!1;for(let e=0;e<items.db.length;e++){let t=items.db[e];if("socket_group"===t.props.name)if(t.pairing_line){var s=LIB.projection(mouse.end,t.pairing_line);if(s)if(get_distance(mouse.end,s)<20)if(get_point_place(mouse.end,t.pairing_line)===get_point_place(t.props.center,t.pairing_line)){if(socketsGroup.target_id&&socketsGroup.target_id!==t.props.id)break;if(6<=t.props.socket_group.length){if(socketsGroup.setAttr(this.image,tool,{stroke:"#dc143c","stroke-width":1.5*this.settings.stroke_width}),socketsGroup.block_cursor=!0,this.angle=t.props.angle,this.image.rotate(this.angle),socketsGroup.reset_cursor){try{this.image.clear()}catch(e){}this.image.remove(),this.image=socketsGroup.get_image([{name:tool}]).id("custom_cursor"),serviceLayer.add(this.image),socketsGroup.reset_cursor=!1}return}t.hide();s=socketsGroup.point||t.props.center;if(!socketsGroup.target_id||socketsGroup.reset_cursor){try{this.image.clear()}catch(e){}this.image.remove(),socketsGroup.target_id=t.props.id,socketsGroup.name_item=tool,socketsGroup.reset_cursor=!1,socketsGroup.block_cursor=!1;let e=copy.object(t.props.socket_group);var R=get_perpendicular_line(t.pairing_line,t.props.center,20),R=(socketsGroup.cursor_side=get_point_place(mouse.end,R),"R"===socketsGroup.cursor_side?e.push({name:tool}):e.unshift({name:tool}),this.image=socketsGroup.get_image(e).id("custom_cursor"),socketsGroup.setDefaultColor(this.image,t.props.name,t),socketsGroup.get_max_height(e));if(socketsGroup.point=LIB.pointOnLine(t.props.projection,t.props.center,R/2-get_distance(t.props.projection,t.props.center)),null!==closest.edge)closest.edge.draw("color"),closest.edge=null;else if(null!==this.room){let e=rooms2.data[this.room];e.draw_("border_dimensions",{remove:!1})}}return this.image.cx(s.x).cy(s.y),this.angle=t.props.angle,this.image.rotate(this.angle),void(i=!0)}}else send_warning_signals(signal_types[5],"Ошибка розетки при группировки.","",1,0)}if(!i&&(socketsGroup.target_id||socketsGroup.reset_cursor)){try{this.image.clear()}catch(e){}this.image.remove();let e=get_item(socketsGroup.target_id);e&&e.show(),socketsGroup.target_id=null,socketsGroup.point=null,this.image=socketsGroup.get_image([{name:tool}]).id("custom_cursor"),serviceLayer.add(this.image),socketsGroup.reset_cursor=!1,socketsGroup.block_cursor=!1}}if("light"===plan&&in_array(tool,striping_light.track_spots)){this.image.attr({stroke:"#ff3636"}),this.image.rotate(0);let e,t;striping_light.selected_strip_light&&(e=get_stripe_light(striping_light.selected_strip_light.id),t=striping_light.selected_strip_light.line_id),striping_light.selected_strip_light=null,e&&e.drawLineSizeByLine(t);let i;for(let t=0;t<stripes_light.db.length;t++)for(let e=0;e<stripes_light.db[t].lines.length;e++){var F=stripes_light.db[t].lines[e],G=LIB.projection(mouse.end,F.line);G&&get_distance(mouse.end,G)<10&&(i={projection:G,graph_line:F,strip_light:stripes_light.db[t]})}if(i){mouse.end=copy.point(i.projection),this.image.cx(mouse.end.x).cy(mouse.end.y),this.image.attr({stroke:striping_light.get_color_by_type()});var a=Math.round(get_line_angle(i.graph_line.line));this.image.rotate(a+180);try{striping_light.selected_strip_light={id:i.strip_light.id,line_id:i.graph_line.line_id,d:+(get_distance(i.graph_line.line.s,mouse.end)/get_distance(i.graph_line.line.s,i.graph_line.line.e)).toFixed(4),angle:a+180,point:copy.point(i.projection)},i.strip_light.drawLineSizeByLine(i.graph_line.line_id)}catch(n){send_error_js(n.name,n.message,n.stack),console.error(n)}}}if("light"===plan&&"track_line_spot"===tool&&("pointer"!==$("body").css("cursor")&&$("body").css("cursor","pointer"),!striping_light.selected_strip_light_line||!striping_light.selected_strip_light_line.point_1)){let i;striping_light.temporary_line_track_line.IMAGE.clear();for(let t=0;t<stripes_light.db.length;t++)for(let e=0;e<stripes_light.db[t].lines.length;e++){var S=stripes_light.db[t].lines[e],N=LIB.projection(mouse.end,S.line);N&&get_distance(mouse.end,N)<10&&(i={projection:N,graph_line:S,strip_light:stripes_light.db[t]})}if(i){mouse.end=copy.point(i.projection),striping_light.temporary_line_track_line.IMAGE.circle(5).attr({fill:"#ffdc00"}).cx(mouse.end.x).cy(mouse.end.y),striping_light.temporary_line_track_line.IMAGE.show();try{striping_light.selected_strip_light_line={id:i.strip_light.id,line_id:i.graph_line.line_id,point:copy.point(i.projection)}}catch(n){send_error_js(n.name,n.message,n.stack),console.error(n)}}}if("light"===plan&&in_array(tool,light_reference_lines.tools)&&(mouse.end=light_reference_lines.show(mouse.end),this.image.cx(mouse.end.x).cy(mouse.end.y)),"ceiling"===this.settings.anchor&&this.settings.dimensions&&(ne.fire("hide"),in_array(tool,[...striping_light.tools,...striping_led.tools,...striping_line.tools])&&(null!==this.room&&"none"!==$("body").css("cursor")?$("body").css("cursor","none"):null===this.room&&"pointer"!==$("body").css("cursor")&&$("body").css("cursor","pointer")),null!==this.room)){var t=rooms2.data[this.room];for(let t=0;t<items.db.length;t++){let e=items.db[t];if(e.model.plan.hasOwnProperty(plan)){var z=[e.p1,e.p2,e.p3,e.p4];if("up"===e.spot_node_size&&(in_array(tool,striping_light.tools)&&striping_light.is_node(e)&&!striping_light.source_id||in_array(tool,striping_led.tools)&&striping_led.is_node(e)&&!striping_led.source_id||in_array(tool,striping_line.tools)&&striping_line.is_node(e)&&!striping_line.source_id)&&e.mouseleave(n),is_point_inside_polygon(mouse.end,z)){if(in_array(tool,[...striping_light.tools,...striping_light.track_spots])&&striping_light.is_node(e)||in_array(tool,striping_led.tools)&&striping_led.is_node(e)||in_array(tool,striping_line.tools)&&striping_line.is_node(e)){e.mouseover(n);break}if(in_array(tool,[...striping_light.tools,...striping_light.track_spots,...striping_led.tools,...striping_line.tools]))break;return allow.item=!1,void(e.props.id!==this.item_id_last_added&&!1===this.changed&&(this.image.plot(paths.sign_stop).attr({stroke:"#ff3636",fill:"#ff3636"}).cx(e.props.center.x).cy(e.props.center.y),this.changed=!0))}}}this.item_id_last_added="",allow.magnet&&t.center&&in_array(tool,["chandelier","ceiling_chandelier_shades","ceiling_chandelier_led","hanging_chandelier_shades","hanging_chandelier_led","cascading_chandelier","crystal_chandelier"])&&(get_distance(mouse.end,t.center)<20?(mouse.end=copy.point(t.center),this.image.cx(mouse.end.x).cy(mouse.end.y),light_reference_lines.build_center_room(t)):light_reference_lines.erase());let s={s:mouse.end,e:{x:mouse.end.x,y:mouse.end.y-1e6}},o={s:mouse.end,e:{x:mouse.end.x-1e6,y:mouse.end.y}},l={s:mouse.end,e:{x:mouse.end.x,y:mouse.end.y+1e6}},r={s:mouse.end,e:{x:mouse.end.x+1e6,y:mouse.end.y}};for(let e=0;e<t.edges.length;e++){var i=t.edges[e],h=line_and_line_intersection(s,i),h=(h&&(s.e=h),line_and_line_intersection(l,i)),h=(h&&(l.e=h),line_and_line_intersection(o,i)),h=(h&&(o.e=h),line_and_line_intersection(r,i));h&&(r.e=h)}if("light"===plan&&in_array(tool,light_reference_lines.tools)){let e={s:mouse.end,e:{x:mouse.end.x,y:mouse.end.y-1e6}},t={s:mouse.end,e:{x:mouse.end.x-1e6,y:mouse.end.y}},i={s:mouse.end,e:{x:mouse.end.x,y:mouse.end.y+1e6}},n={s:mouse.end,e:{x:mouse.end.x+1e6,y:mouse.end.y}};var a=light_reference_lines.get_close_item_point(e),g=light_reference_lines.get_close_item_point(t),_=light_reference_lines.get_close_item_point(i),d=light_reference_lines.get_close_item_point(n);a&&(e.e=a,LIB.lineLength(e)<=LIB.lineLength(s)&&(s.e=a)),g&&(t.e=g,LIB.lineLength(t)<=LIB.lineLength(o)&&(o.e=g)),_&&(i.e=_,LIB.lineLength(i)<=LIB.lineLength(l)&&(l.e=_)),d&&(n.e=d,LIB.lineLength(n)<=LIB.lineLength(r)&&(r.e=d))}1<LIB.lineLength(s)&&ne.fire("update",{label:"t",s:s.s,e:s.e}),1<LIB.lineLength(l)&&ne.fire("update",{label:"b",s:l.s,e:l.e}),1<LIB.lineLength(o)&&ne.fire("update",{label:"l",s:o.s,e:o.e}),1<LIB.lineLength(r)&&ne.fire("update",{label:"r",s:r.s,e:r.e})}if("wall"===this.settings.anchor)if("init"===plan){if(null!==closest.edge&&(closest.edge=null),this.room=mouse.over.ROOM,this.room){var Y=this.room;let i=20;if("width"===this.settings.pairing&&(i=this.settings.height_changed*this.settings.height_k/2+10),"height"===this.settings.pairing&&(i=this.settings.width_changed*this.settings.width_k/2+10),allow.magnet)for(let t=0;t<Y.edges.length;t++){var o=Y.edges[t];let e=LIB.projection(mouse.end,o);if(e){var l=get_distance(mouse.end,e),r=get_distance(e,o.s),p=get_distance(e,o.e);if(l<i){if("L"===o.room_side&&"L"===get_point_place(mouse.end,o)){var l=in_array(tool_group,["sockets","wires","lights","switches","waterspots"],!0),c=this.settings.offset;l?this.center=point_near_line_end(o.s,e,this.image.bbox().h/2-c,"L"):(this.center=point_near_line_end(o.s,e,this.height_long/2-c,"L"),r<p&&r<=this.width_long/2+20&&(e=LIB.pointOnLine(o.e,o.s,-this.width_long/2),this.center=point_near_line_end(o.s,e,this.height_long/2-c,"L")),p<r&&p<=this.width_long/2+20&&(e=LIB.pointOnLine(o.s,o.e,-this.width_long/2),this.center=point_near_line_end(o.s,e,this.height_long/2-c,"L"))),this.angle=get_line_angle(o),360===this.angle&&(this.angle=0),this.projection=e,this.edge=t,this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),closest.edge=o;break}if("R"===o.room_side&&"R"===get_point_place(mouse.end,o)){l=in_array(tool_group,["sockets","wires","lights","switches","waterspots"],!0),c=this.settings.offset;l?this.center=point_near_line_end(o.s,e,this.image.bbox().h/2-c,"R"):(this.center=point_near_line_end(o.s,e,this.height_long/2-c,"R"),r<p&&r<=this.width_long/2+20&&(e=LIB.pointOnLine(o.e,o.s,-this.width_long/2),this.center=point_near_line_end(o.s,e,this.height_long/2-c,"R")),p<r&&p<=this.width_long/2+20&&(e=LIB.pointOnLine(o.s,o.e,-this.width_long/2),this.center=point_near_line_end(o.s,e,this.height_long/2-c,"R"))),this.angle=get_line_angle(o)+180,360===this.angle&&(this.angle=0),this.projection=e,this.edge=t,this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),closest.edge=o;break}}}}}}else if("electric_shield_old"!==tool&&null!==closest.edge&&(closest.edge.draw("color"),closest.edge=null),null!==this.room){var A=rooms2.data[this.room];let n=20;if("width"===this.settings.pairing&&(n=this.settings.height_changed*this.settings.height_k/2+10),"height"===this.settings.pairing&&(n=this.settings.width_changed*this.settings.width_k/2+10),allow.magnet)if("electric_shield_old"===tool)for(let t=0;t<A.edges.length;t++){var u=A.edges[t];let e=LIB.projection(mouse.end,u);if(e){var w=get_distance(mouse.end,e),m=get_distance(e,u.s),f=get_distance(e,u.e);if(w<n){if("L"===u.room_side&&"L"===get_point_place(mouse.end,u)){var w=in_array(tool_group,["sockets","wires","lights","switches","waterspots"],!0),I=this.settings.offset;w?this.center=point_near_line_end(u.s,e,this.image.bbox().h/2-I,"L"):(this.center=point_near_line_end(u.s,e,this.height_long/2-I,"L"),m<f&&m<=this.width_long/2+20&&(e=LIB.pointOnLine(u.e,u.s,-this.width_long/2),this.center=point_near_line_end(u.s,e,this.height_long/2-I,"L")),f<m&&f<=this.width_long/2+20&&(e=LIB.pointOnLine(u.s,u.e,-this.width_long/2),this.center=point_near_line_end(u.s,e,this.height_long/2-I,"L"))),this.angle=get_line_angle(u),360===this.angle&&(this.angle=0),this.projection=e,this.edge=t,this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),closest.edge=u;break}if("R"===u.room_side&&"R"===get_point_place(mouse.end,u)){w=in_array(tool_group,["sockets","wires","lights","switches","waterspots"],!0),I=this.settings.offset;w?this.center=point_near_line_end(u.s,e,this.image.bbox().h/2-I,"R"):(this.center=point_near_line_end(u.s,e,this.height_long/2-I,"R"),m<f&&m<=this.width_long/2+20&&(e=LIB.pointOnLine(u.e,u.s,-this.width_long/2),this.center=point_near_line_end(u.s,e,this.height_long/2-I,"R")),f<m&&f<=this.width_long/2+20&&(e=LIB.pointOnLine(u.s,u.e,-this.width_long/2),this.center=point_near_line_end(u.s,e,this.height_long/2-I,"R"))),this.angle=get_line_angle(u)+180,360===this.angle&&(this.angle=0),this.projection=e,this.edge=t,this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),closest.edge=u;break}}}}else for(let i=0;i<A.border_dimensions.length;i++){let e=A.border_dimensions[i],t=LIB.projection(mouse.end,e);if(t){var T=get_distance(mouse.end,t),C=get_distance(t,e.s),y=get_distance(t,e.e);if(T<n){if("L"===e.room_side&&"L"===get_point_place(mouse.end,e)){var T=in_array(tool_group,["sockets","wires","lights","switches","waterspots"],!0),b=this.settings.offset;T?this.center=point_near_line_end(e.s,t,this.image.bbox().h/2-b,"L"):(this.center=point_near_line_end(e.s,t,this.height_long/2-b,"L"),C<y&&C<=this.width_long/2+20&&(t=LIB.pointOnLine(e.e,e.s,-this.width_long/2),this.center=point_near_line_end(e.s,t,this.height_long/2-b,"L")),y<C&&y<=this.width_long/2+20&&(t=LIB.pointOnLine(e.s,e.e,-this.width_long/2),this.center=point_near_line_end(e.s,t,this.height_long/2-b,"L"))),this.angle=get_line_angle(e),360===this.angle&&(this.angle=0),this.projection=t,this.edge=i,this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),e.draw("color"),closest.edge=e;break}if("R"===e.room_side&&"R"===get_point_place(mouse.end,e)){T=in_array(tool_group,["sockets","wires","lights","switches","waterspots"],!0),b=this.settings.offset;T?this.center=point_near_line_end(e.s,t,this.image.bbox().h/2-b,"R"):(this.center=point_near_line_end(e.s,t,this.height_long/2-b,"R"),C<y&&C<=this.width_long/2+20&&(t=LIB.pointOnLine(e.e,e.s,-this.width_long/2),this.center=point_near_line_end(e.s,t,this.height_long/2-b,"R")),y<C&&y<=this.width_long/2+20&&(t=LIB.pointOnLine(e.s,e.e,-this.width_long/2),this.center=point_near_line_end(e.s,t,this.height_long/2-b,"R"))),this.angle=get_line_angle(e)+180,360===this.angle&&(this.angle=0),this.projection=t,this.edge=i,this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),e.draw("color"),closest.edge=e;break}}}}}if("free"===this.settings.anchor){null!==closest.edge&&(closest.edge.draw("color"),closest.edge=null);let e=20;"width"===this.settings.pairing&&(e=this.settings.height_changed*this.settings.height_k/2+10),"height"===this.settings.pairing&&(e=this.settings.width_changed*this.settings.width_k/2+10);a=in_array(tool,outer_room_items);if(!a&&allow.magnet&&null!==this.room){var v=mouse.over.ROOM;this.edge=!1;let t=e;for(let e=0;e<v.edges.length;e++){var H=v.edges[e],U=LIB.projection(mouse.end,H);!U||(U=get_distance(mouse.end,U))<t&&(this.edge=H,"waterspot_drainage"===tool&&(t=U))}if(this.edge){g=get_point_place(mouse.end,this.edge);if(this.projection=LIB.projection(mouse.end,this.edge),this.projection){_=get_distance(this.projection,this.edge.s),d=get_distance(this.projection,this.edge.e);if("L"===this.edge.room_side&&"L"===g){if(!0===this.settings.is_magnetized){var x=this.height_long/2-this.settings.offset,B=(this.center=point_near_line_end(this.edge.s,this.projection,x,"L"),get_svg_point({x:n.detail.clientX,y:n.detail.clientY}));if("waterspot_drainage"!==tool)for(let e=0;e<items.db.length;e++){var k=items.db[e];if("sockets"!==k.model.group&&"lights"!==k.model.group){var L,E=get_line(k.pbp,k.ptp);let e=!1;0===k.model.offset&&(e=is_point_on_line(k.pbp,this.edge)),(e=0!==k.model.offset?line_and_line_intersection(E,this.edge):e)&&((L=get_point_projection(B,E=get_line(k.pp4,k.pp1)))&&"L"===get_point_place(B,E)&&get_distance(B,L)<this.width_long/2+7&&(E=this.height_long/2-parseInt(this.settings.offset),L=LIB.pointOnLine(k.pp3,k.pp4,this.width_long/2),this.center=get_point_near_line_point(this.edge,L,-E,"R")),(E=get_point_projection(B,L=get_line(k.pp2,k.pp3)))&&"L"===get_point_place(B,L)&&get_distance(B,E)<this.width_long/2+7&&(L=this.height_long/2-parseInt(this.settings.offset),E=LIB.pointOnLine(k.pp4,k.pp3,this.width_long/2),this.center=get_point_near_line_point(this.edge,E,-L,"R")))}}_<d&&_<=this.width_long/2+10&&(this.projection=LIB.pointOnLine(this.edge.e,this.edge.s,-this.width_long/2),this.center=point_near_line_end(this.edge.s,this.projection,x,"L")),d<_&&d<=this.width_long/2+10&&(this.projection=LIB.pointOnLine(this.edge.s,this.edge.e,-this.width_long/2),this.center=point_near_line_end(this.edge.s,this.projection,x,"L")),this.image.cx(this.center.x).cy(this.center.y)}this.angle=get_line_angle(this.edge),360===this.angle&&(this.angle=0),this.image.rotate(this.angle)}if("R"===this.edge.room_side&&"R"===g){if(!0===this.settings.is_magnetized){var x=this.height_long/2-this.settings.offset,W=(this.center=point_near_line_end(this.edge.s,this.projection,x,"R"),get_svg_point({x:n.detail.clientX,y:n.detail.clientY}));if("waterspot_drainage"!==tool)for(let e=0;e<items.db.length;e++){var P=items.db[e];if("sockets"!==P.model.group&&"lights"!==P.model.group){var Q,M=get_line(P.pbp,P.ptp);let e=!1;0===P.model.offset&&(e=is_point_on_line(P.pbp,this.edge)),(e=0!==P.model.offset?line_and_line_intersection(M,this.edge):e)&&((Q=get_point_projection(W,M=get_line(P.pp4,P.pp1)))&&"L"===get_point_place(W,M)&&get_distance(W,Q)<this.width_long/2+7&&(M=this.height_long/2-parseInt(this.settings.offset),Q=LIB.pointOnLine(P.pp3,P.pp4,this.width_long/2),this.center=get_point_near_line_point(this.edge,Q,-M,"L")),(M=get_point_projection(W,Q=get_line(P.pp2,P.pp3)))&&"L"===get_point_place(W,Q)&&get_distance(W,M)<this.width_long/2+7&&(Q=this.height_long/2-parseInt(this.settings.offset),M=LIB.pointOnLine(P.pp4,P.pp3,this.width_long/2),this.center=get_point_near_line_point(this.edge,M,-Q,"L")))}}_<d&&_<=this.width_long/2+10&&(this.projection=LIB.pointOnLine(this.edge.e,this.edge.s,-this.width_long/2),this.center=point_near_line_end(this.edge.s,this.projection,x,"R")),d<_&&d<=this.width_long/2+10&&(this.projection=LIB.pointOnLine(this.edge.s,this.edge.e,-this.width_long/2),this.center=point_near_line_end(this.edge.s,this.projection,x,"R")),this.image.cx(this.center.x).cy(this.center.y)}this.angle=get_line_angle(this.edge)+180,360===this.angle&&(this.angle=0),this.image.rotate(this.angle)}}}if(v&&"fire_detector"===tool){for(let t=0;t<items.db.length;t++){let e=items.db[t];if(e.model.plan.hasOwnProperty(plan)){var J=[e.p1,e.p2,e.p3,e.p4];if(is_point_inside_polygon(mouse.end,J))return(allow.item=!1)===this.changed&&(this.image.plot(paths.stop_sign).attr({stroke:"#ff3636",fill:"#ff3636"}).cx(e.props.center.x).cy(e.props.center.y),this.changed=!0),void ne.fire("hide")}}get_distance(mouse.end,v.center)<10&&(mouse.end=copy.point(v.center),this.image.cx(mouse.end.x).cy(mouse.end.y));let t={s:mouse.end,e:{x:mouse.end.x,y:mouse.end.y-1e6}},i={s:mouse.end,e:{x:mouse.end.x-1e6,y:mouse.end.y}},n={s:mouse.end,e:{x:mouse.end.x,y:mouse.end.y+1e6}},s={s:mouse.end,e:{x:mouse.end.x+1e6,y:mouse.end.y}};for(let e=0;e<v.edges.length;e++){var K=v.edges[e],D=line_and_line_intersection(t,K),D=(D&&(t.e=D),line_and_line_intersection(n,K)),D=(D&&(n.e=D),line_and_line_intersection(i,K)),D=(D&&(i.e=D),line_and_line_intersection(s,K));D&&(s.e=D)}1<LIB.lineLength(t)&&ne.fire("update",{label:"t",s:t.s,e:t.e}),1<LIB.lineLength(n)&&ne.fire("update",{label:"b",s:n.s,e:n.e}),1<LIB.lineLength(i)&&ne.fire("update",{label:"l",s:i.s,e:i.e}),1<LIB.lineLength(s)&&ne.fire("update",{label:"r",s:s.s,e:s.e})}if("waterspot_drainage"===tool)for(let t=0;t<v.border_dimensions.length;t++){let e=v.border_dimensions[t];var V,Z=LIB.projection(mouse.end,e);Z&&(Z=get_distance(mouse.end,Z),V=get_point_place(mouse.end,e),Z<this.settings.width_changed+4.5&&("L"===e.room_side&&"L"===V||"R"===e.room_side&&"R"===V)&&(e.draw("color"),closest.edge=e))}}if(a&&allow.magnet)for(let e=0;e<baselines.db.length;e++){var O=baselines.db[e],j=LIB.projection(mouse.end,O);if(j&&get_distance(mouse.end,j)<20){this.projection=j;var X=get_point_place(mouse.end,O),q=get_distance(this.projection,O.s),ee=get_distance(this.projection,O.e);if("L"===O.label&&"L"===X){this.center=point_near_line_end(O.s,j,this.height_long/2,"L"),this.angle=get_line_angle(O),360!==this.angle&&-360!==this.angle||(this.angle=0),q<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(O.e,O.s,-this.width_long/2),this.center=point_near_line_end(O.s,this.projection,this.height_long/2,"L")),ee<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(O.s,O.e,-this.width_long/2),this.center=point_near_line_end(O.s,this.projection,this.height_long/2,"L")),this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),this.edge=e;break}if("R"===O.label&&"R"===X){this.center=point_near_line_end(O.s,this.projection,this.height_long/2,"R"),this.angle=get_line_angle(O)+180,360!==this.angle&&-360!==this.angle||(this.angle=0),get_distance(j,O.s)<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(O.e,O.s,-this.width_long/2),this.center=point_near_line_end(O.s,this.projection,this.height_long/2,"R")),get_distance(j,O.e)<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(O.s,O.e,-this.width_long/2),this.center=point_near_line_end(O.s,this.projection,this.height_long/2,"R")),this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),this.edge=e;break}}}let t;"waterspot_drainage"===tool&&this.edge&&(t=copy.point(this.center)),this.center={x:this.image.cx(),y:this.image.cy()},t&&(this.center=t)}if("break"!==tool&&"break_door"!==tool&&"B"===plan_group&&null!==this.room){g=rooms2.data[this.room];if(g.demolines){var te=g.demolines;for(let e=0;e<te.length;e++){var ie=LIB.projection(mouse.end,te[e]);if(ie&&get_distance(mouse.end,ie)<40){this.line_index=e;break}}}}void 0===CustomIcons[tool]&&this.bg&&this.bg.cx(this.image.cx()).cy(this.image.cy())}}).on("move_ventHole",function(e){var t;e.detail;this.image.untransform(),this.arrow1.untransform(),this.arrow2.untransform(),this.angle=0,this.projection=null,this.wall=!1,this.projection=!1;for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if(("init"!==plan||"init"===i.label||"break"===i.label)&&("build"!==plan||"init"===i.label||"build"===i.label))for(let e=0;e<i.parts.length;e++){var n,s=i.parts[e];"wall"!==s.role||(n=LIB.projection(mouse.end,s))&&get_distance(mouse.end,n)<30&&(this.wall=i,this.projection=n,this.angle=get_line_angle(s))}}this.projection||(this.image.cx(mouse.end.x).cy(mouse.end.y),e=LIB.point(mouse.end.x,mouse.end.y-5-5),t=LIB.point(mouse.end.x,mouse.end.y+5+5),this.arrow1.cx(e.x).cy(e.y),this.arrow2.cx(t.x).cy(t.y).rotate(180)),this.projection&&(this.image.cx(this.projection.x).cy(this.projection.y),this.image.rotate(this.angle),e=get_point_near_line_end(this.wall.s,this.projection,this.wall.depth/2+5,"L"),t=get_point_near_line_end(this.wall.s,this.projection,this.wall.depth/2+5,"R"),this.arrow1.cx(e.x).cy(e.y).rotate(this.angle),this.arrow2.cx(t.x).cy(t.y).rotate(this.angle+180))}).on("move_electricShieldA",function(e){this.image.untransform(),this.center=!1,this.angle=0,this.projection=!1;let t;"init"===plan&&(t=rooms1.data),"build"===plan&&(t=rooms2.data),console.warn(t),this.room=!1;for(let e=0;e<t.length;e++){var i=t[e];if(is_point_inside_polygon(mouse.end,i.polygon)){this.room=i;break}}if(this.room)for(let t=0;t<this.room.edges.length;t++){var n,s=this.room.edges[t];let e=LIB.projection(mouse.end,s);e&&get_distance(mouse.end,e)<this.settings.height&&("L"===s.room_side&&"L"===get_point_place(mouse.end,s)&&(n=get_distance(e,s.s),get_distance(e=n<=this.settings.width/2+3?LIB.pointOnLine(s.e,s.s,-this.settings.width/2):e,s.e)<=this.settings.width/2+3&&(e=LIB.pointOnLine(s.s,s.e,-this.settings.width/2)),this.center=point_near_line_end(s.s,e,this.settings.height/2,"L"),closest.edge=s,this.angle=get_line_angle(s),360===this.angle&&(this.angle=0)),"R"===s.room_side&&"R"===get_point_place(mouse.end,s)&&(n=get_distance(e,s.s),get_distance(e=n<=this.settings.width/2+3?LIB.pointOnLine(s.e,s.s,-this.settings.width/2):e,s.e)<=this.settings.width/2+3&&(e=LIB.pointOnLine(s.s,s.e,-this.settings.width/2)),this.center=point_near_line_end(s.s,e,this.settings.height/2,"R"),closest.edge=s,this.angle=get_line_angle(s)+180,360===this.angle&&(this.angle=0)))}this.center||this.image.cx(mouse.end.x).cy(mouse.end.y),this.center&&(this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle))}).on("move_stair",function(e){if(this.image.untransform(),this.angle=0,this.projection=null,this.image.cx(mouse.end.x).cy(mouse.end.y),this.room=!1,"init"===plan)for(let e=0;e<rooms1.data.length;e++){var t=rooms1.data[e];is_point_inside_polygon(mouse.end,t.polygon)&&(this.room=t)}if("build"===plan)for(let e=0;e<rooms2.data.length;e++){var i=rooms2.data[e];is_point_inside_polygon(mouse.end,i.polygon)&&(this.room=i)}if(this.room){var n,s,o,l,r=this.room;let t=20;"width"===this.settings.pairing&&(t=this.settings.height_changed*this.settings.height_k/2+10),"height"===this.settings.pairing&&(t=this.settings.width_changed*this.settings.width_k/2+10),this.baseline=null;for(let e=0;e<r.edges.length;e++){var a,h=r.edges[e],g=LIB.projection(mouse.end,h);g&&get_distance(mouse.end,g)<t&&(g=get_point_near_line_center(h.s,h.e,3,"L"),a=get_point_near_line_center(h.s,h.e,3,"R"),is_point_inside_polygon(g,r.polygon)&&(this.baseline=h,this.baseline.room="L"),is_point_inside_polygon(a,r.polygon)&&(this.baseline=h,this.baseline.room="R"))}null!==this.baseline&&(n=get_point_place(mouse.end,this.baseline),this.projection=LIB.projection(mouse.end,this.baseline),this.projection&&(s=get_distance(mouse.end,this.projection),o=get_distance(this.projection,this.baseline.s),l=get_distance(this.projection,this.baseline.e),s<t&&("L"===this.baseline.room&&"L"===n&&(this.center=point_near_line_end(this.baseline.s,this.projection,this.height_long/2,"L"),get_svg_point({x:e.detail.clientX,y:e.detail.clientY}),this.angle=get_line_angle(this.baseline),360===this.angle&&(this.angle=0),o<l&&o<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(this.baseline.e,this.baseline.s,-this.width_long/2),this.center=point_near_line_end(this.baseline.s,this.projection,this.height_long/2,"L")),l<o&&l<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(this.baseline.s,this.baseline.e,-this.width_long/2),this.center=point_near_line_end(this.baseline.s,this.projection,this.height_long/2,"L")),this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle)),"R"===this.baseline.room&&"R"===n&&(this.center=point_near_line_end(this.baseline.s,this.projection,this.height_long/2,"R"),get_svg_point({x:e.detail.clientX,y:e.detail.clientY}),this.angle=get_line_angle(this.baseline)+180,360===this.angle&&(this.angle=0),o<l&&o<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(this.baseline.e,this.baseline.s,-this.width_long/2),this.center=point_near_line_end(this.baseline.s,this.projection,this.height_long/2,"R")),l<o&&l<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(this.baseline.s,this.baseline.e,-this.width_long/2),this.center=point_near_line_end(this.baseline.s,this.projection,this.height_long/2,"R")),this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle)))))}if(this.center={x:this.image.cx(),y:this.image.cy()},"porch"===tool&&allow.magnet)for(let e=0;e<baselines.db.length;e++){var _=baselines.db[e],d=LIB.projection(mouse.end,_);if(d&&get_distance(mouse.end,d)<20){this.projection=d;var p=get_point_place(mouse.end,_),c=get_distance(this.projection,_.s),A=get_distance(this.projection,_.e);if("L"===_.label&&"L"===p){this.center=point_near_line_end(_.s,d,this.height_long/2,"L"),this.angle=get_line_angle(_),360!==this.angle&&-360!==this.angle||(this.angle=0),c<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(_.e,_.s,-this.width_long/2),this.center=point_near_line_end(_.s,this.projection,this.height_long/2,"L")),A<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(_.s,_.e,-this.width_long/2),this.center=point_near_line_end(_.s,this.projection,this.height_long/2,"L")),this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),this.edge=e;break}if("R"===_.label&&"R"===p){this.center=point_near_line_end(_.s,this.projection,this.height_long/2,"R"),this.angle=get_line_angle(_)+180,360!==this.angle&&-360!==this.angle||(this.angle=0),get_distance(d,_.s)<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(_.e,_.s,-this.width_long/2),this.center=point_near_line_end(_.s,this.projection,this.height_long/2,"R")),get_distance(d,_.e)<=this.width_long/2+20&&(this.projection=LIB.pointOnLine(_.s,_.e,-this.width_long/2),this.center=point_near_line_end(_.s,this.projection,this.height_long/2,"R")),this.image.cx(this.center.x).cy(this.center.y),this.image.rotate(this.angle),this.edge=e;break}}}}).on("getPolygon",function(){var e=this.center,t=this.settings.width_changed,i=this.settings.height_changed,t=t*this.settings.width_k,n=i*this.settings.height_k,s=n-i;this.bp={x:e.x+n/2*Math.cos((this.angle+90)*Math.PI/180),y:e.y+n/2*Math.sin((this.angle+90)*Math.PI/180)},this.tp=LIB.pointOnLine(this.bp,e,i/2-s/2),this.p1=get_point_near_line_end(this.bp,this.tp,t/2,"L"),this.p2=get_point_near_line_end(this.bp,this.tp,t/2,"R"),this.p3=get_point_near_line_end(this.tp,this.bp,t/2,"L"),this.p4=get_point_near_line_end(this.tp,this.bp,t/2,"R"),this.lp=get_center(this.p1,this.p4),this.rp=get_center(this.p2,this.p3)}).on("create",function(){if(console.warn(tool),!in_array(tool,["wall","ruler","moving","comment","freeline"])){"fire_detector"===tool&&ne.fire("hide"),closest.edge=null;var e="furniture"===tool_group||"santeh"===tool_group,t=!in_array(tool,outer_room_items);if(e&&t){if(console.warn(e&&t,"wall"===this.settings.anchor),allow.item&&"wall"===this.settings.anchor){if(null===this.edge)return void cursors.own.fire("blink",{action:"cancel"});for(let e=0;e<items.db.length;e++){var i=items.db[e];if(i.model.group===this.settings.group&&"wall"===i.anchor){let e;"width"===this.settings.pairing&&(e=parseInt(this.settings.width)),"height"===this.settings.pairing&&(e=parseInt(this.settings.height));var n=get_distance(this.projection,i.pairing_line.s),i=get_distance(this.projection,i.pairing_line.e);if(n<e/2||i<e/2)return void cursors.own.fire("blink",{action:"cancel"})}}is_point_exists(this.center)&&items.db.push(new _({settings:this.settings,name:tool,edge:this.edge,length:1,center:this.center,angle:this.angle,projection:this.projection,height:null,plan:plan}));let e=items.db[items.db.length-1];e.blink("ok"),"sockets"!==tool_group&&this.fire("off")}if(allow.item&&"free"===this.settings.anchor&&is_point_exists(this.center)){items.db.push(new _({settings:this.settings,name:tool,edge:null,length:1,center:this.center,angle:this.angle,projection:this.projection,height:null,plan:plan}));let e=items.db[items.db.length-1];e.blink("ok")}this.settings.path||(this.settings.path=get_tool_settings(tool).path),this.fire("off"),this.settings.dimensions&&ne.fire("hide"),project.localSave()}else{if(closest.edge=null,mouse.over.search("room"),this.room=mouse.over.room,null===this.room&&groupWaterSpots.is_source(tool)&&"icons"===cursor_group&&groupWaterSpots.target_id){var s=get_item(groupWaterSpots.target_id);if(s&&s.props&&s.props.id_room)for(let e=0;e<rooms2.data.length;e++)if(rooms2.data[e].id===s.props.id_room){this.room=e;break}}let n=!1;if(null!==this.room&&rooms2.data[mouse.over.room],in_array(tool,outer_room_items)){if(null===this.edge)return void cursors.own.fire("blink",{action:"cancel"});if(null!==this.edge&&is_point_exists(this.center)){items.db.push(new _({settings:this.settings,name:tool,edge:null,length:1,center:this.center,angle:this.angle,projection:this.projection,height:null,plan:plan}));let e=items.db[items.db.length-1];e.blink("ok"),this.fire("off"),n=!0}}else{if(manager_lining.cursor_create(this.room))return;if(null===this.room)return cursors.own.fire("blink",{action:"cancel"}),void("socket"===tool||"socket_ip44"===tool?(warning.show("yellow",l10n.cabling_socket_not_install),$("#planner_ui_options").removeClass("active"),$("#planner_ui_options .options_preset").removeClass("slideFastLeft")):"furniture"!==tool_group&&"santeh"!==tool_group&&(warning.show("yellow",l10n.item_not_install),$("#planner_ui_options").removeClass("active"),$("#planner_ui_options .options_preset").addClass("slideFastLeft")));if(null!==this.room){if("light"===plan&&in_array(tool,striping_light.track_spots)&&null===striping_light.selected_strip_light)return void warning.show("yellow",l10n.spot_not_install);if("socket"===tool||"socket_ip44"===tool)for(let e=0;e<pillars.db.length;e++){var o=pillars.db[e];if(is_point_inside_polygon(this.center,o.polygon))return warning.show("yellow",l10n.cabling_socket_not_install),cursors.own.fire("blink",{action:"cancel"}),$("#planner_ui_options").removeClass("active"),void $("#planner_ui_options .options_preset").removeClass("slideFastLeft")}let i=rooms2.data[this.room];if("lines"===cursor_group){if(in_array(tool,["laminate","linoleum","fitted_carpet","floor_tile","parquet_board","wood_board","remove_flooring"])){let t=null;for(let e=0;e<i.floors.length;e++)if(is_point_inside_polygon(mouse.end,i.floors[e].polygon)){t=i.floors[e],e;break}if(null!==t&&("remove_flooring"!==tool&&tool!==t.cover&&(t.exist=!0,t.cover=tool,i.draw(),n=!0),"remove_flooring"===tool)){if(!1===t.exist)return void this.fire("knock");t.exist=!1,i.draw(),n=!0}}if("wall_elements"===tool_group&&"walls"===plan){if("wall_cover_remove"!==tool){if(null===this.line_index){let t=!1;for(let e=0;e<i.decor.length;e++)if(!1===i.decor[e].exist){t=!0;break}if(t){for(let e=0;e<i.decor.length;e++){var l=i.demolines[e];i.decor[e]={exist:!0,name:tool,color:this.settings.stroke_color,surface:l.surface,width:l.width,height:l.height,area:l.area,area_doors:l.area_doors,area_windows:l.area_windows}}i.draw(),n=!0}}null!==this.line_index&&(e=i.demolines[this.line_index],i.decor[this.line_index]={exist:!0,name:tool,color:this.settings.stroke_color,surface:e.surface,width:e.width,height:e.height,area:e.area,area_doors:e.area_doors,area_windows:e.area_windows},i.draw(),n=!0)}if("wall_cover_remove"===tool)for(let e=0;e<i.decor.length;e++)if(!0===i.decor[e].exist){this.fire("knock");for(let e=0;e<i.decor.length;e++)i.decor[e]={exist:!1};i.draw(),n=!0;break}}if("isolation_thermo"===tool||"isolation_sound"===tool){if(null===this.line_index){let t=0;for(let e=0;e<i.isolation.length;e++)i.isolation[e].color===this.settings.stroke_color&&t++;if(t===i.isolation.length)return void this.fire("knock");for(let e=0;e<i.isolation.length;e++){var r=i.demolines[e];i.isolation[e]={exist:!0,name:tool,color:this.settings.stroke_color,width:r.width,height:r.height,area:r.area,area_doors:r.area_doors,area_windows:r.area_windows}}i.draw(),n=!0}null!==this.line_index&&(t=i.demolines[this.line_index],i.isolation[this.line_index]={exist:!0,name:tool,color:this.settings.stroke_color,width:t.width,height:t.height,area:t.area,area_doors:t.area_doors,area_windows:t.area_windows},i.draw(),n=!0)}if("remove_isolation"===tool)for(let e=0;e<i.isolation.length;e++)if(!0===i.isolation[e].exist){this.fire("knock");for(let e=0;e<i.isolation.length;e++)i.isolation[e]={exist:!1};i.draw(),n=!0;break}if("plaster_visual"===tool||"plaster_full"===tool){if(null===this.line_index){let t=0;for(let e=0;e<i.plaster.length;e++)i.plaster[e].color===this.settings.stroke_color&&t++;if(t===i.plaster.length)return void this.fire("knock");for(let e=0;e<i.plaster.length;e++){var a=i.demolines[e];i.plaster[e]={exist:!0,name:tool,color:this.settings.stroke_color,width:a.width,height:a.height,area:a.area,area_doors:a.area_doors,area_windows:a.area_windows}}i.draw(),n=!0}null!==this.line_index&&(e=i.demolines[this.line_index],i.plaster[this.line_index]={exist:!0,name:tool,color:this.settings.stroke_color,width:e.width,height:e.height,area:e.area,area_doors:e.area_doors,area_windows:e.area_windows},i.draw(),n=!0)}if("remove_plaster"===tool)for(let e=0;e<i.plaster.length;e++)if(!0===i.plaster[e].exist){this.fire("knock");for(let e=0;e<i.plaster.length;e++)i.plaster[e]={exist:!1};i.draw(),n=!0;break}}if("icons"===cursor_group){if(groupWaterSpots.target_id){let t=get_item(groupWaterSpots.target_id);t.findComment(),"waterspot_drainage"===t.props.name&&t.model.need_show_baseline&&delete t.model.need_show_baseline,t.props.name=groupWaterSpots.name_item,"waterspot_drainage"===tool&&(t.props.center=LIB.pointOnLine(t.bp,t.props.projection,3),t.updateComment()),t.props.height=tools[t.props.name].height,t.props.width=tools[t.props.name].width,t.props.settings.anchor=tools[t.props.name].anchor,t.props.settings.filling=tools[t.props.name].filling,t.props.settings.filling_after=tools[t.props.name].filling_after,t.props.settings.height=tools[t.props.name].height,t.props.settings.height_changed=tools[t.props.name].height,t.props.settings.width=tools[t.props.name].width,t.props.settings.width_changed=tools[t.props.name].width,t.props.settings.stroke_after=tools[t.props.name].stroke_after,t.props.settings.stroke_color=tools[t.props.name].stroke_color,t.props.settings.stroke_width=tools[t.props.name].stroke_width;for(let e=0;e<items.db.length;e++)if(items.db[e].props.id===groupWaterSpots.target_id){items.db[e].erase(),items.db[e]=new _(t.props);break}return this.fire("off"),groupWaterSpots.target_id=null,void project.localSave()}if(socketsGroup.target_id&&!socketsGroup.reset_cursor){let t=get_item(socketsGroup.target_id);if(t.findComment(),t.props.socket_group.length<6){"R"===socketsGroup.cursor_side?t.props.socket_group.push({name:socketsGroup.name_item,id:LIB.id()}):t.props.socket_group.unshift({name:socketsGroup.name_item,id:LIB.id()}),t.props.center=socketsGroup.point,t.updateComment(),t.model.plan[socketsGroup.types[socketsGroup.name_item].plan]=1;for(let e=0;e<items.db.length;e++)if(items.db[e].props.id===socketsGroup.target_id){items.db[e].erase(),items.db[e]=new _(t.props);break}project.localSave()}return void(socketsGroup.reset_cursor=!0)}if(socketsGroup.is_allow(tool))for(let e=0;e<items.db.length;e++){let t=items.db[e];if("socket_group"===t.props.name)if(get_distance(mouse.end,t.props.center)<10){if(6<=t.props.socket_group.length)return void warning.show("yellow",l10n.socket_group_max_items.replace("[x]",6));t.props.socket_group.push({name:tool,id:LIB.id()}),t.model.plan[socketsGroup.types[tool].plan]=1;for(let e=0;e<items.db.length;e++)if(items.db[e].props.id===t.props.id){items.db[e].erase(),items.db[e]=new _(t.props);break}return void project.localSave()}}if(allow.item&&"wall"===this.settings.anchor){if(null===this.edge)return cursors.own.fire("blink",{action:"cancel"}),void(socketsGroup.block_cursor?warning.show("yellow",l10n.socket_group_max_items.replace("[x]",6)):warning.show("yellow",l10n.item_install_only_wall));for(let e=0;e<items.db.length;e++){var h=items.db[e];if(h.model.group===this.settings.group&&"wall"===h.anchor){let e;"width"===this.settings.pairing&&(e=parseInt(this.settings.width)),"height"===this.settings.pairing&&(e=parseInt(this.settings.height));var g=get_distance(this.projection,h.pairing_line.s),h=get_distance(this.projection,h.pairing_line.e);if(g<e/2||h<e/2)return void cursors.own.fire("blink",{action:"cancel"})}}is_point_exists(this.center)&&items.db.push(new _({settings:this.settings,name:tool,edge:this.edge,length:1,center:this.center,angle:this.angle,projection:this.projection,height:null,id_room:i.id,plan:plan}));let e=items.db[items.db.length-1];e.blink("ok"),in_array(tool_group,["sockets","switches"])||this.fire("off"),n=!0}if(allow.item&&"ceiling"===this.settings.anchor&&(t=items.db.length,is_point_exists(e={x:this.image.cx(),y:this.image.cy()})&&(items.db[t]=new _({settings:this.settings,name:tool,center:e,room:this.room,grid:rooms2.data[this.room].edges,id_room:i.id}),n=!0,this.item_id_last_added=items.db[items.db.length-1].props.id)),allow.item&&"free"===this.settings.anchor&&is_point_exists(this.center)){items.db.push(new _({settings:this.settings,name:tool,edge:null,length:1,center:this.center,angle:this.angle,projection:this.projection,height:null,id_room:i.id,plan:plan}));let e=items.db[items.db.length-1];e.blink("ok"),n=!0}}this.settings&&!this.settings.path&&(this.settings.path=get_tool_settings(tool).path),in_array(tool_group,["wall_elements","sockets","switches","floor_elements","ceiling_elements"])||(in_array(tool,[...light_reference_lines.tools,...striping_light.track_spots])||this.fire("off"),this.settings&&this.settings.dimensions&&ne.fire("hide"),ne.fire("hide"))}}!0===n&&project.localSave(),!in_array(tool,[...light_reference_lines.tools,...striping_light.track_spots])&&"floor_socket"!==tool||(this.settings.path=get_tool_settings(tool).path),"light"===plan&&in_array(tool,light_reference_lines.tools)&&(light_reference_lines.build(),items.build_dimensions())}}}).on("create2",function(e){var t,e=e.detail;if("stair"===e){if(closest.edge=null,"wall"===this.settings.anchor){if(!this.projection)return cursors.own.fire("blink",{action:"cancel"}),warning.show("yellow",l10n.stair_install_only_wall),$("#planner_ui_options").addClass("active"),void $("#planner_ui_options .options_preset").addClass("slideFastLeft");if(is_point_exists(this.center)){items.db.push(new _({settings:this.settings,name:tool,edge:null,length:1,center:this.center,angle:this.angle,projection:this.projection,height:null,plan:plan}));let e=items.db[items.db.length-1];e.blink("ok"),project.localSave()}}if("free"===this.settings.anchor&&is_point_exists(this.center)){items.db.push(new _({settings:this.settings,name:tool,edge:null,length:1,center:this.center,angle:this.angle,height:null,plan:plan}));let e=items.db[items.db.length-1];e.blink("ok"),project.localSave()}this.settings.path||(this.settings.path=get_tool_settings(tool).path),cursors.own.hidden=!1,tool_deactivate(),this.clear()}"ventHole"===e&&(this.projection&&(t=get_distance(this.wall.s,this.projection),console.warn(this.w),this.wall.ventHoles.push({id:LIB.id(),sdistance:t,width:this.w}),this.wall.draw(),warning.hide(),cursors.own.fire("blink",{action:"ok"})),this.projection||(cursors.own.fire("blink",{action:"cancel"}),"init"===plan&&warning.show("red",l10n.venthole_must_to_wall0),"build"===plan&&warning.show("red",l10n.venthole_must_to_wall1))),"electricShieldA"===e&&(this.center&&(items.db.push(new _({plan:plan,settings:this.settings,name:tool,center:this.center,angle:this.angle})),warning.hide(),cursors.own.fire("blink",{action:"ok"})),this.center||(cursors.own.fire("blink",{action:"cancel"}),warning.show("red",l10n.electric_must_to_wall))),"fireDetector"===e&&console.warn("fireDetector")}).on("blink",function(e){var t=e.detail.action;let i,n,s=("cancel"===t&&(i="#dc143c",n=1.5*this.settings.stroke_width),"ok"===t&&(i=this.settings.stroke_color,n=1.5*this.settings.stroke_width),this.image.attr({stroke:i,"stroke-width":n}),this.arrow1&&this.arrow1.attr({stroke:i,"stroke-width":n}),this.arrow2&&this.arrow2.attr({stroke:i,"stroke-width":n}),CustomIcons.setAttr(this.image,groupWaterSpots.target_id?groupWaterSpots.name_item:tool,{stroke:i,"stroke-width":n}),socketsGroup.setAttr(this.image,tool,{stroke:i,"stroke-width":n}),this);setTimeout(function(){s.image.attr({stroke:s.settings.stroke_color,"stroke-width":s.settings.stroke_width}),s.arrow1&&s.arrow1.attr({stroke:s.settings.stroke_color,"stroke-width":.6}),s.arrow2&&s.arrow2.attr({stroke:s.settings.stroke_color,"stroke-width":.6}),CustomIcons.setDefaultColor(s.image,groupWaterSpots.target_id?groupWaterSpots.name_item:tool,groupWaterSpots.target_id?get_item(groupWaterSpots.target_id):null),socketsGroup.setDefaultColor(s.image,socketsGroup.target_id?socketsGroup.name_item:tool,socketsGroup.target_id?get_item(socketsGroup.target_id):null)},e.detail.timeout||100)}).on("knock",function(e){let t=mouse.end.x,i=mouse.end.y;"break"!==tool&&"break_door"!==tool||(t+=10,i+=10,cursors.own.image&&cursors.own.image.plot(hammer_after).cx(t).cy(i)),setTimeout(function(){cursors.own.image.plot(hammer).cx(t).cy(i)},200)}).on("show",function(e){this.image&&this.image.show(),this.arrow1&&this.arrow1.show(),this.arrow2&&this.arrow2.show()}).on("hide",function(e){this.bg&&this.bg.hide(),this.image&&this.image.hide(),this.arrow1&&this.arrow1.hide(),this.arrow2&&this.arrow2.hide()}).on("remove",function(){!0===this.activated&&(this.bg&&this.bg.remove(),this.image&&this.image.remove(),this.arrow1&&this.arrow1.remove(),this.arrow2&&this.arrow2.remove())}).on("off",function(){if(cursors.own.hidden=!1,this.fire("remove"),this.clear(),this.activated=!1,this.projection=!1,tool_deactivate(),item_plus.hide(),item_minus.hide(),socketsGroup.target_id){let e=get_item(socketsGroup.target_id);e&&e.show(),socketsGroup.target_id=null,socketsGroup.point=null,socketsGroup.reset_cursor=!1,socketsGroup.block_cursor=!1}"init"!==plan&&this.room&&(is_a_number(this.room)?rooms2.data[this.room]&&rooms2.data[this.room].draw():"build"===this.room.plan&&this.room.draw()),"B"===plan_group&&rooms2.draw()}),cursors.window=serviceLayer.group().hide().on("init",function(e){this.clear(),this.type=tool,null!==e.detail&&(this.settings=e.detail.settings),"window"===tool&&(this.WIDTH=defs.window.width,this.rect(defs.window.width,defs.window.depth).attr({stroke:"black","stroke-width":1.4,fill:"#ffffff"})),"windoor"===tool&&(this.window_width=defs.windoor.window_width,this.door_width=defs.windoor.door_width,this.WIDTH=defs.windoor.window_width+defs.windoor.door_width,this.door_position=$("#windoor_position").val(),"left"===this.door_position&&(this.opening="inner_left"),"right"===this.door_position&&(this.opening="inner_right"),e=defs.windoor.depth,"left"===this.door_position&&(this.rect(this.door_width,e).attr({stroke:"black","stroke-width":1.4,fill:"#fafafa"}),this.rect(this.window_width,e).attr({stroke:"black","stroke-width":1.4,fill:"#fafafa"}).x(this.door_width).y(0),this.line(0,0,0,e+4).attr({stroke:"black","stroke-width":1.4,fill:"#fafafa"}).x(this.door_width).y(-2)),"right"===this.door_position&&(this.rect(this.window_width,defs.windoor.depth).attr({stroke:"black","stroke-width":1.4,fill:"#fafafa",cursor:"pointer"}),this.rect(this.door_width,defs.windoor.depth).attr({stroke:"black","stroke-width":1.4,fill:"#fafafa",cursor:"pointer"}).x(this.window_width).y(0),this.line(0,0,0,e+4).attr({stroke:"black","stroke-width":1.4,fill:"#fafafa",cursor:"pointer"}).x(this.window_width).y(-2)))}).on("park",function(){var e=get_svg_point({x:260,y:141});this.move(e.x,e.y)}).on("move",function(){if($("body").css("cursor","default"),this.show(),this.untransform(),this.cx(mouse.end.x).cy(mouse.end.y),"init"===plan){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if("init"===i.label&&"wall"===i.role){var n,s,o,l,r,a,h,g,t=get_short_line(i.axis,i.depth),t=LIB.projection(mouse.end,t);t&&get_distance(mouse.end,t)<30&&(this.angle=get_line_angle(i.axis),this.rotate(this.angle));for(let t=0;t<i.parts.length;t++){let e=i.parts[t];if("wall"===e.role&&e.polygon&&is_point_inside_polygon(mouse.end,e.polygon)){"break"===i.label&&($("body").css("cursor","not-allowed"),warning.show("yellow",l10n.wall_selected_for_delete)),"init"===i.label&&($("body").css("cursor","default"),warning.hide(),this.WIDTH<=LIB.lineLength(e.axis)&&0===N.part_polygon.length&&(N.wall=i,N.part=Object.assign({},e),N.part_polygon=e.polygon.slice(),g=get_center(N.part.s,N.part.e),l=get_big_line(get_line(N.part.s,N.part.e)),n=LIB.projection(N.part.l1,l),s=LIB.projection(N.part.r1,l),o=LIB.projection(N.part.l2,l),l=LIB.projection(N.part.r2,l),r=get_distance(g,n),a=get_distance(g,s),h=get_distance(g,o),g=get_distance(g,l),_e=a<=r?s:n,de=g<=h?l:o));break}}}}for(let e=0;e<sectors.db.length;e++){var _=sectors.db[e],d=LIB.projection(mouse.end,_);if(d){if(get_distance(mouse.end,d)<30&&is_point_inside_polygon(mouse.end,_.polygon)&&!1===warning.visible){warning.show("red",l10n.wall_sector_break_not_install),N.part_polygon=[];break}}else warning.hide()}}if(0<N.part_polygon.length){var e=is_point_inside_polygon(mouse.end,N.part_polygon);if(!0===e&&get_distance(_e,de)+.5>=this.WIDTH){let t=!(A.motion_line={s:LIB.pointOnLine(de,_e,-this.WIDTH/2),e:LIB.pointOnLine(_e,de,-this.WIDTH/2)});if(!1!==(t=1<=LIB.lineLength(A.motion_line)?LIB.projection(mouse.end,A.motion_line):get_line_center(A.motion_line))&&(this.hide(),null===S.window&&("window"===this.type&&windows.db.push(new u({id_wall:N.wall.id,type:this.type,center:copy.point(t),width:defs.window.width,opening:"R",custom_options:this.settings.custom_options,label:plan,plan:plan})),"windoor"===this.type&&windows.db.push(new u({id_wall:N.wall.id,type:this.type,center:copy.point(t),width:this.WIDTH,window_width:this.window_width,door_width:this.door_width,opening:this.opening,door_position:this.door_position,custom_options:this.settings.custom_options,label:plan,plan:plan})),S.window=windows.db.length-1,N.wall.init()),null!==S.window)){let e=windows.db[S.window];!0===this.stuck&&(e.center=copy.point(t),e.draw(),N.wall.init(),this.stuck=!1),allow.magnet&&get_distance(t,A.motion_line.s)<3?(t=copy.point(A.motion_line.s),e.center=copy.point(t),e.draw(),N.wall.init(),this.stuck=!0):allow.magnet&&get_distance(t,A.motion_line.e)<3?(t=copy.point(A.motion_line.e),e.center=copy.point(t),e.draw(),N.wall.init(),this.stuck=!0):(e.center=copy.point(t),e.draw(),N.wall.UPDATE())}if(!1===t&&null!==S.window){let e=windows.db[S.window];e.delete(),S.window=null,N.wall.UPDATE()}}if(!1===e){if(this.show(),null!==S.window){let e=windows.db[S.window];e.delete(),S.window=null}N.part_polygon=[]}}}).on("create",function(){null!==S.window&&(selected.wall=null,S.window=null,N.part_polygon=[],project.localSave())}),cursors.door=serviceLayer.group().attr({stroke:"black","stroke-width":1.4,fill:"#ffffff"}).hide().on("init",function(e){i=!0,$("body").css("cursor","default"),warning.hide(),this.clear(),null!==e.detail&&(this.settings=e.detail.settings),"doorway"===tool&&(this.RECT=this.rect(defs.doorway.width,defs.doorway.depth),this.type="doorway",this.width=defs.doorway.width),"door"===tool&&(this.RECT=this.rect(defs.door.width,defs.door.depth),this.type="single",this.width=defs.door.width),"door_double"===tool&&(this.RECT=this.rect(defs.door_double.width,defs.door_double.depth),this.type="double",this.width=defs.door_double.width),"door_coupe"===tool&&(this.RECT=this.rect(defs.door_coupe.width,defs.door_coupe.depth),this.type="door_coupe",this.width=defs.door_coupe.width),"door_penal"===tool&&(this.RECT=this.rect(defs.door_penal.width,defs.door_penal.depth),this.type="door_penal",this.width=defs.door_penal.width),this.move(-1e4,-1e4).show()}).on("park",function(){var e=get_svg_point({x:188,y:141});this.move(e.x,e.y)}).on("move",function(){$("body").css("cursor","default"),this.show(),this.untransform();let e;switch(this.type){case"doorway":e=defs.doorway.width;break;case"single":e=defs.door.width;break;case"double":e=defs.door_double.width;break;case"door_coupe":e=defs.door_coupe.width;break;case"door_penal":e=defs.door_penal.width}this.RECT.width(e),this.cx(mouse.end.x).cy(mouse.end.y);let i={};for(let e=0;e<walls.db.length;e++){var t=walls.db[e],n=LIB.projection(mouse.end,t.axis);if(n)if(get_distance(mouse.end,n)<30){if("init"===plan){if("break"===t.label){this.angle=get_line_angle(t.axis),this.rotate(this.angle),is_point_inside_polygon(mouse.end,t.polygon)&&!1===warning.visible&&warning.show("red",l10n.wall_break_not_install);break}if("init"===t.label){this.angle=get_line_angle(t.axis),this.rotate(this.angle),i=t;break}}"build"!==plan||"init"!==t.label&&"build"!==t.label||(this.angle=get_line_angle(t.axis),this.rotate(this.angle),i=t)}else warning.hide()}if("init"===plan)for(let e=0;e<sectors.db.length;e++){var s=sectors.db[e],o=LIB.projection(mouse.end,s);if(o){if(get_distance(mouse.end,o)<30&&is_point_inside_polygon(mouse.end,s.polygon)&&!1===warning.visible){warning.show("red",l10n.wall_sector_break_not_install),i={};break}}else warning.hide()}if(i.id){for(let t=0;t<i.parts.length;t++){let e=i.parts[t];if("wall"===e.role&&e.polygon&&is_point_inside_polygon(mouse.end,e.polygon)&&($("body").css("cursor","default"),0===N.part_polygon.length)){N.wall=i,N.part=Object.assign({},e),N.part_polygon=e.polygon.slice();break}}is_point_inside_polygon(mouse.end,i.polygon)||(N.part_polygon=[])}else{if(this.show(),null!==S.door){let e=doors.db[S.door];e&&e.delete(),S.door=null}N.part_polygon=[]}if(0<N.part_polygon.length){var l=get_center(N.part.s,N.part.e),r=get_big_line(get_line(N.part.s,N.part.e)),a=LIB.projection(N.part.l1,r),h=LIB.projection(N.part.r1,r),g=LIB.projection(N.part.l2,r),r=LIB.projection(N.part.r2,r),_=get_distance(l,a),d=get_distance(l,h),p=get_distance(l,g),l=get_distance(l,r);let e,i;if(e=d<=_?h:a,i=l<=p?r:g,parseInt(get_distance(e,i).toFixed(0))>=this.width){let t=!(A.motion_line={s:LIB.pointOnLine(i,e,-this.width/2),e:LIB.pointOnLine(e,i,-this.width/2)});if(!1!==(t=1<=LIB.lineLength(A.motion_line)?LIB.projection(mouse.end,A.motion_line):get_line_center(A.motion_line))&&(this.hide(),null===S.door&&(doors.db.push(new w({id_wall:N.wall.id,center:t,width:this.width,type:this.type,custom_options:this.settings.custom_options,plan:plan})),S.door=doors.db.length-1,N.wall.init()),null!==S.door)){let e=doors.db[S.door];!0===this.stuck&&(e.center=copy.point(t),e.draw(),N.wall.init(),this.stuck=!1),allow.magnet&&get_distance(t,A.motion_line.s)<3?(t=copy.point(A.motion_line.s),e.center=copy.point(t),e.draw(),N.wall.init(),this.stuck=!0):allow.magnet&&get_distance(t,A.motion_line.e)<3?(t=copy.point(A.motion_line.e),e.center=copy.point(t),e.draw(),N.wall.init(),this.stuck=!0):(e.center=copy.point(t),e.draw(),N.wall.UPDATE())}if(!1===t&&null!==S.door){let e=doors.db[S.door];e.delete(),S.door=null}}}else{if(this.show(),null!==S.door){let e=doors.db[S.door];e.delete(),S.door=null}N.part_polygon=[]}this.overDoor=!1;for(let e=0;e<doors.db.length;e++){var c=doors.db[e];e!==S.door&&"build"!==c.plan&&1!=c.replacement&&1!=c.hasReplacement&&!1===c.demount&&is_point_inside_polygon(mouse.end,c.polygon)&&(this.overDoor=!0,this.door=c,this.hide())}if(!0!==this.overDoor||this.door.typeBak||this.type!==this.overDoor.type&&(this.door.typeBak=this.door.type,this.door.openingBak=this.door.opening,this.door.type=this.type,this.door.setOpening(),this.door.draw()),!1===this.overDoor&&this.door){this.door.rollback(),this.door=null;for(let t=0;t<doors.db.length;t++){let e=doors.db[t];1==e.replacement&&e.draw(),1==e.hasReplacement&&e.erase()}}}).on("create",function(){if(!0===this.overDoor){if("init"===plan&&this.door&&this.door.typeBak)return delete this.door.typeBak,delete this.door.openingBak,void project.localSave();if("build"===plan){for(let e=0;e<doors.db.length;e++){var t=doors.db[e];if(1==t.replacement&&is_point_inside_polygon(this.door.center,t.polygon))return}if(this.door&&this.door.typeBak&&this.type!==this.door.typeBak)return this.door.type=this.door.typeBak,this.door.opening=this.door.openingBak,this.door.hasReplacement=!0,this.door.draw(),delete this.door.typeBak,delete this.door.openingBak,doors.db.push(new w({id_wall:this.door.id_wall,center:this.door.center,width:this.door.width,type:this.type,custom_options:this.settings.custom_options,replacement:!0,plan:plan})),doors.draw(),void project.localSave()}}if(null!==S.door){this.hide();let t=doors.db[S.door],i=!0;if("init"===plan)for(let e=0;e<doors.db.length;e++){var n,s,o=doors.db[e];o.id!==t.id&&(n=is_point_inside_polygon(t.center,o.polygon),s=is_point_inside_polygon(t.s,o.polygon),o=is_point_inside_polygon(t.e,o.polygon),(n||s||o)&&(t.delete(),i=!1,warning.show("red",l10n.door_already_plan_build)))}selected.wall=null,S.door=null,N.part_polygon=[],i&&project.localSave()}}),window.pillarGuidlines=serviceLayer.group().on("on",function(e){this.db=[],this.clear();var s={stroke:"orange","stroke-width":.6};for(let e=0;e<pillars.db.length;e++){var o=pillars.db[e];if("pillar"===o.role){var t=0===o.angle||90===o.angle||180===o.angle||270===o.angle||360===o.angle;if(0!=t){let e=get_big_line(o.edge_t),t=get_big_line(o.edge_r),i=get_big_line(o.edge_b),n=get_big_line(o.edge_l);e.orientation=get_line_orientation(e),t.orientation=get_line_orientation(t),i.orientation=get_line_orientation(i),n.orientation=get_line_orientation(n),this.line(e.s.x,e.s.y,e.e.x,e.e.y).attr(s),this.line(t.s.x,t.s.y,t.e.x,t.e.y).attr(s),this.line(i.s.x,i.s.y,i.e.x,i.e.y).attr(s),this.line(n.s.x,n.s.y,n.e.x,n.e.y).attr(s),this.db.push(e),this.db.push(t),this.db.push(i),this.db.push(n)}}}}).on("off",function(e){this.db=[],this.clear()}),cursors.pillar_BAK=serviceLayer.group().draggable().hide().on("init",function(e){i=!0,this.clear(),e.detail&&e.detail.backup&&(this.backup=e.detail.backup),this.w=defs.pillar.width,this.h=defs.pillar.height;let t={stroke:"black","stroke-width":1.4,fill:hatch.pillar,cursor:"pointer"};"pillarMovement"===tool2&&(t={stroke:"orange","stroke-width":1.4,fill:hatch.orange,cursor:"pointer"}),this.rect(this.w,this.h).attr(t),this.cx(-1e6),this.cy(-1e6),this.center_before=LIB.point(this.cx(),this.cy()),this.center=LIB.point(this.cx(),this.cy()),this.show(),this.pillarGuidlinesActive=!1,ne.fire("remove"),ne.fire("init"),ne.fire("hide"),this.movingDistance=0}).on("park",function(){ne.fire("hide");var e=get_svg_point({x:188,y:141});this.move(e.x,e.y)}).on("move",function(e){this.show(),StopSign.hide();let t=!0;this.CENTER=null;var i=get_svg_point({x:e.detail.clientX,y:e.detail.clientY});ne.fire("hide"),this.cx(mouse.end.x).cy(mouse.end.y);let o={x:this.cx(),y:this.cy()};this.center={x:this.cx(),y:this.cy()};var l=get_distance(this.center_before,o);this.movingDistance+=l,allow.magnet&&3<l&&!1===this.pillarGuidlinesActive&&(pillarGuidlines.fire("on",e),this.pillarGuidlinesActive=!0);for(let e=0;e<pillars.db.length;e++){var n=pillars.db[e];is_point_inside_polygon(o,n.polygon)&&(this.hide(),StopSign.cx(n.center.x).cy(n.center.y).show(),t=!1)}if(mouse.over.search(),allow.magnet&&(this.closestWall=!1,!(this.CLOSEST_EDGE=!1)===t))for(let e=0;e<walls.db.length;e++){var s=walls.db[e];if("init"===s.label||"break"===s.label){var r=LIB.projection(o,s.axis);if(r){var a,h=get_point_place(o,s.axis);let e,t;Math.abs(o.y-r.y)<.5&&(0<(a=Math.abs(o.x-r.x))&&("R"===h&&a<(t=this.w/2+s.inner_depth)+20&&(e=get_point_near_line_end(s.s,r,t,"R"),this.cx(e.x),this.closestWall=s,this.CENTER=copy.point(e)),"L"===h&&a<(t=this.w/2+s.outer_depth)+20&&(e=get_point_near_line_end(s.s,r,t,"L"),this.cx(e.x),this.closestWall=s,this.CENTER=copy.point(e)))),Math.abs(o.x-r.x)<.5&&(0<(a=Math.abs(o.y-r.y))&&("R"===h&&a<(t=this.h/2+s.inner_depth)+20&&(e=get_point_near_line_end(s.s,r,t,"R"),this.cy(e.y),this.closestWall=s,this.CENTER=copy.point(e)),"L"===h&&a<(t=this.h/2+s.outer_depth)+20&&(e=get_point_near_line_end(s.s,r,t,"L"),this.CENTER=copy.point(e),this.closestWall=s,this.cy(e.y))))}}}if(allow.magnet&&!0===t){for(let e=0;e<pillarGuidlines.db.length;e++){var g,_=pillarGuidlines.db[e],d=LIB.projection(i,_),p=get_point_place(i,_);get_distance(i,d)<5&&("L"===p&&("V"===_.orientation&&(g=get_point_near_line_point(_,d,this.w/2,"L"),this.cx(g.x)),"H"===_.orientation&&(g=get_point_near_line_point(_,d,this.h/2,"L"),this.cy(g.y))),"R"===p&&("V"===_.orientation&&(p=get_point_near_line_point(_,d,this.w/2,"R"),this.cx(p.x)),"H"===_.orientation&&(p=get_point_near_line_point(_,d,this.h/2,"R"),this.cy(p.y))))}for(let e=0;e<walls.db.length;e++){var c=walls.db[e];if("init"===c.label&&"pillar"!==c.role){if(0===c.links.s&&0===c.walls_s.length){var A,u,w=LIB.pointOnLine(c.e,c.s,20);let e;get_distance(o,c.l1)<20&&(w.x===c.s.x&&(A=LIB.pointOnLine(c.r2,c.r1,this.h/2),e=point_near_line_end(c.r2,A,this.w/2,"R")),w.y===c.s.y&&(A=LIB.pointOnLine(c.r2,c.r1,this.w/2),e=point_near_line_end(c.r2,A,this.h/2,"R")),this.cx(e.x).cy(e.y),mouse.end=copy_point(e)),get_distance(o,c.r1)<20&&(w.x===c.s.x&&(u=LIB.pointOnLine(c.l2,c.l1,this.h/2),e=point_near_line_end(c.l2,u,this.w/2,"L")),w.y===c.s.y&&(u=LIB.pointOnLine(c.l2,c.l1,this.w/2),e=point_near_line_end(c.l2,u,this.h/2,"L")),this.cx(e.x).cy(e.y),mouse.end=copy_point(e))}if(0===c.links.e&&0===c.walls_e.length){var m,f,w=LIB.pointOnLine(c.s,c.e,20);let e;get_distance(o,c.l2)<20&&(w.x===c.e.x&&(m=LIB.pointOnLine(c.r1,c.r2,this.h/2),e=point_near_line_end(c.r1,m,this.w/2,"L")),w.y===c.e.y&&(m=LIB.pointOnLine(c.r1,c.r2,this.w/2),e=point_near_line_end(c.r1,m,this.h/2,"L")),this.cx(e.x).cy(e.y),mouse.end=copy_point(e)),get_distance(o,c.r2)<20&&(w.x===c.e.x&&(f=LIB.pointOnLine(c.l1,c.l2,this.h/2),e=point_near_line_end(c.l1,f,this.w/2,"R")),w.y===c.e.y&&(f=LIB.pointOnLine(c.l1,c.l2,this.w/2),e=point_near_line_end(c.l1,f,this.h/2,"R")),this.cx(e.x).cy(e.y),mouse.end=copy_point(e))}}}}if(!0===t){if(null!==mouse.over.room){var j=rooms1.data[mouse.over.room],I=(o={x:this.cx(),y:this.cy()},p1={x:o.x,y:o.y-this.h/2},p2={x:o.x+this.w/2,y:o.y},p3={x:o.x,y:o.y+this.h/2},p4={x:o.x-this.w/2,y:o.y},{s:{x:p1.x,y:p1.y},e:{x:p1.x,y:p1.y-1e4}}),C={s:{x:p4.x,y:p4.y},e:{x:p4.x-1e4,y:p4.y}},y={s:{x:p3.x,y:p3.y},e:{x:p3.x,y:p3.y+1e4}},R={s:{x:p2.x,y:p2.y},e:{x:p2.x+1e4,y:p2.y}};let t=[],i=[],n=[],s=[];for(let e=0;e<j.edges.length;e++){var b,v,x,B=j.edges[e];"gypsum"!==B.parent&&(b=line_and_line_intersection(I,B),v=line_and_line_intersection(C,B),x=line_and_line_intersection(y,B),B=line_and_line_intersection(R,B),b&&t.push({point:b,distance:get_distance(I.s,b)}),x&&n.push({point:x,distance:get_distance(y.s,x)}),v&&i.push({point:v,distance:get_distance(C.s,v)}),B&&s.push({point:B,distance:get_distance(R.s,B)}))}1<t.length&&t.sort(compare_distance),1<n.length&&n.sort(compare_distance),1<i.length&&i.sort(compare_distance),1<s.length&&s.sort(compare_distance),0<t.length&&(.1<get_distance(l=I.s,e=t[0].point)&&ne.fire("update",{label:"t",s:l,e:e})),0<n.length&&(.1<get_distance(l=y.s,e=n[0].point)&&ne.fire("update",{label:"b",s:l,e:e})),0<i.length&&(.1<get_distance(l=C.s,e=i[0].point)&&ne.fire("update",{label:"l",s:l,e:e})),0<s.length&&(.1<get_distance(l=R.s,e=s[0].point)&&ne.fire("update",{label:"r",s:l,e:e}))}if(null===mouse.over.room){o={x:this.cx(),y:this.cy()},p1={x:o.x,y:o.y-this.h/2},p2={x:o.x+this.w/2,y:o.y},p3={x:o.x,y:o.y+this.h/2},p4={x:o.x-this.w/2,y:o.y};var k={s:{x:p1.x,y:p1.y},e:{x:p1.x,y:p1.y-1e4}},L={s:{x:p4.x,y:p4.y},e:{x:p4.x-1e4,y:p4.y}},E={s:{x:p3.x,y:p3.y},e:{x:p3.x,y:p3.y+1e4}},W={s:{x:p2.x,y:p2.y},e:{x:p2.x+1e4,y:p2.y}};let t=[],i=[],n=[],s=[];for(let e=0;e<pillars.db.length;e++){var P,Q,M,D,O=pillars.db[e];"pillar"===O.role&&(P=line_and_line_intersection(k,O.edge_t),Q=line_and_line_intersection(k,O.edge_r),M=line_and_line_intersection(k,O.edge_b),D=line_and_line_intersection(k,O.edge_l),P&&t.push({point:P,distance:get_distance(k.s,P)}),Q&&t.push({point:Q,distance:get_distance(k.s,Q)}),M&&t.push({point:M,distance:get_distance(k.s,M)}),D&&t.push({point:D,distance:get_distance(k.s,D)}),P=line_and_line_intersection(W,O.edge_t),Q=line_and_line_intersection(W,O.edge_r),M=line_and_line_intersection(W,O.edge_b),D=line_and_line_intersection(W,O.edge_l),P&&s.push({point:P,distance:get_distance(W.s,P)}),Q&&s.push({point:Q,distance:get_distance(W.s,Q)}),M&&s.push({point:M,distance:get_distance(W.s,M)}),D&&s.push({point:D,distance:get_distance(W.s,D)}),P=line_and_line_intersection(E,O.edge_t),Q=line_and_line_intersection(E,O.edge_r),M=line_and_line_intersection(E,O.edge_b),D=line_and_line_intersection(E,O.edge_l),P&&n.push({point:P,distance:get_distance(E.s,P)}),Q&&n.push({point:Q,distance:get_distance(E.s,Q)}),M&&n.push({point:M,distance:get_distance(E.s,M)}),D&&n.push({point:D,distance:get_distance(E.s,D)}),P=line_and_line_intersection(L,O.edge_t),Q=line_and_line_intersection(L,O.edge_r),M=line_and_line_intersection(L,O.edge_b),D=line_and_line_intersection(L,O.edge_l),P&&i.push({point:P,distance:get_distance(L.s,P)}),Q&&i.push({point:Q,distance:get_distance(L.s,Q)}),M&&i.push({point:M,distance:get_distance(L.s,M)}),D&&i.push({point:D,distance:get_distance(L.s,D)}))}1<t.length&&t.sort(compare_distance),1<n.length&&n.sort(compare_distance),1<i.length&&i.sort(compare_distance),1<s.length&&s.sort(compare_distance),0<t.length&&(.1<get_distance(l=k.s,e=t[0].point)&&ne.fire("update",{label:"t",s:l,e:e})),0<n.length&&(.1<get_distance(l=E.s,e=n[0].point)&&ne.fire("update",{label:"b",s:l,e:e})),0<i.length&&(.1<get_distance(l=L.s,e=i[0].point)&&ne.fire("update",{label:"l",s:l,e:e})),0<s.length&&(.1<get_distance(l=W.s,e=s[0].point)&&ne.fire("update",{label:"r",s:l,e:e}))}}this.center=copy.point(o)}).on("create",function(e){let o=this.center;get_distance(this.center_before,this.center);if(0<this.movingDistance&&!(o.x<-49999&&o.y<-49999))if(is_a_number(defs.pillar.width)&&is_a_number(defs.pillar.height)){var l={x:o.x-this.w/2,y:o.y-this.h/2},r={x:o.x+this.w/2,y:o.y-this.h/2},a={x:o.x+this.w/2,y:o.y+this.h/2},h={x:o.x-this.w/2,y:o.y+this.h/2},g=LIB.point(o.x,o.y-this.h/2),_=LIB.point(o.x+this.w/2,o.y),d=LIB.point(o.x,o.y+this.h/2),p=LIB.point(o.x-this.w/2,o.y),c=o,A=get_point_near_line_center(l,r,2,"R"),u=get_point_near_line_center(r,a,2,"R"),w=get_point_near_line_center(a,h,2,"R"),m=get_point_near_line_center(h,l,2,"R");for(let e=0;e<pillars.db.length;e++){var f=pillars.db[e];if("gypsum"!==f.role){var I=is_point_inside_polygon(c,f.polygon),C=is_point_inside_polygon(A,f.polygon),y=is_point_inside_polygon(u,f.polygon),b=is_point_inside_polygon(w,f.polygon),f=is_point_inside_polygon(m,f.polygon);if(I||C||y||b||f){StopSign.hide();let e=l10n.pillar_not_install_to_pillar;return"pillarMovement"===tool2&&(e=l10n.pillar_move_to_pillar,this.backup&&this.fire("rollback")),void warning.show("yellow",e)}}}var v=get_line(l,a),x=get_line(r,h),B=[l,r,a,h];for(let e=0;e<walls.db.length;e++){var k=walls.db[e],L=line_and_line_intersection(k.axis,v),E=line_and_line_intersection(k.axis,x),W=is_point_inside_polygon(k.s,B),P=is_point_inside_polygon(k.e,B),k=is_point_inside_polygon(k.c,B);if(L||E||W||P||k){let e=l10n.wall_already_any_plan_not_install;return"pillarMovement"===tool2&&(e=l10n.wall_already_any_plan_not_move),warning.show("yellow",e),this.backup&&this.fire("rollback"),void this.fire("off")}}var N={s:l,e:r},z={s:r,e:a},Y={s:a,e:h},T={s:h,e:l};let t=[],i=[],n=[],s=[];for(let e=0;e<walls.db.length;e++){var Q=walls.db[e];t=G(Q,e,N,t),i=G(Q,e,z,i),n=G(Q,e,Y,n),s=G(Q,e,T,s)}let e=!0;if(2===t.length&&(e=S(t)),2===i.length&&(e=S(i)),2===n.length&&(e=S(n)),!1===(e=2===s.length?S(s):e))warning.show("red",l10n.pillar_not_install_here);else{let t=!1;if(null!==mouse.over.room){var M=rooms1.data[mouse.over.room];for(let e=0;e<M.edges.length;e++){var D=M.edges[e],O=LIB.projection(o,D);O&&get_distance(o,O)===Math.min(defs.pillar.width/2,defs.pillar.height/2)&&(is_point_on_line(g,D)||is_point_on_line(_,D)||is_point_on_line(d,D)||is_point_on_line(p,D))&&(t=D)}}t&&(r=LIB.lineLength(t),Math.abs(r-defs.pillar.width)<=3&&("L"===(a=get_point_place(o,t))&&(o=get_point_near_line_center(t.s,t.e,this.h/2,"L")),"R"===a&&(o=get_point_near_line_center(t.s,t.e,this.h/2,"R")),defs.pillar.width=r),Math.abs(r-defs.pillar.height)<=3&&("L"===(h=get_point_place(o,t))&&(o=get_point_near_line_center(t.s,t.e,this.w/2,"L")),"R"===h&&(o=get_point_near_line_center(t.s,t.e,this.w/2,"R")),defs.pillar.height=r));var j=defs.pillar.width/2,R=defs.pillar.height/2;for(let e=0;e<pillars.db.length;e++){var F=pillars.db[e];if("init"!==plan||"pillar"===F.role||"gypsum"===F.role){let e=LIB.projection(o,F.edge_t);e&&get_distance(o,e)<=5+R&&(e=pe(e,F.edge_t,j,3),o=get_point_near_line_point(F.edge_t,e,R,"L"));let t=LIB.projection(o,F.edge_b),i=(t&&get_distance(o,t)<=5+R&&(t=pe(t,F.edge_b,j,3),o=get_point_near_line_point(F.edge_b,t,R,"L")),LIB.projection(o,F.edge_r)),n=(i&&get_distance(o,i)<=5+j&&(i=pe(i,F.edge_r,R,3),o=get_point_near_line_point(F.edge_r,i,j,"L")),LIB.projection(o,F.edge_l));n&&get_distance(o,n)<=5+j&&(n=pe(n,F.edge_l,R,3),o=get_point_near_line_point(F.edge_l,n,j,"L"))}}pillars.db.push(new H({role:"pillar",id:this.backup&&this.backup.id?this.backup.id:void 0,center:o,width:defs.pillar.width,height:defs.pillar.height})),walls.draw();let e=pillars.db[pillars.db.length-1];"pillarMovement"===tool2&&(e.selected=!0),pillars.draw(),"wall"===e.anchor&&(e.delete({target:"rooms"}),create_rooms()),"floor"===e.anchor&&create_rooms(),deactivate_tool(),this.hide(),ne.fire("hide"),$(".options_preset").hide(),"move_pillar"!==tool&&allow.magnet&&pillarGuidlines.fire("on"),3<get_distance(o,this.center_before)&&project.localSave()}function G(e,t,i,n){return is_point_on_line(e.l1,i)&&n.push(t),is_point_on_line(e.r1,i)&&n.push(t),is_point_on_line(e.l2,i)&&n.push(t),is_point_on_line(e.r2,i)&&n.push(t),n}function S(e){if(e[0]!==e[1]){var t=walls.db[e[0]],e=walls.db[e[1]];if(is_line_on_line(t.axis,e.axis))return!1}}}else warning.show("yellow",l10n.pillar_check_size)}).on("rollback",function(){pillars.db.push(new H({role:"pillar",id:this.backup.id,center:this.backup.center,width:this.backup.width,height:this.backup.height,angle:this.backup.angle,anchor:this.backup.anchor})),pillars.draw(),walls.draw(),this.fire("off")}).on("off",function(){ne.fire("remove"),delete this.backup,this.hide(),StopSign.hide(),pillarGuidlines.fire("off"),i=!1}),cursors.pillar=serviceLayer.group().on("init",function(e){i=!0,StopSign.hide(),this.clear(),e.detail&&e.detail.backup&&(this.backup=e.detail.backup);let t;"pillar"===tool&&(this.w=defs.pillar.width,this.h=defs.pillar.height,t={stroke:"black","stroke-width":1.4,fill:hatch.pillar,cursor:"pointer"},"pillarMovement"===tool2&&(t={stroke:"orange","stroke-width":1.4,fill:hatch.orange,cursor:"pointer"})),"gypsum_box"===tool&&(this.w=defs.gypsum_box.width,this.h=defs.gypsum_box.height,t={stroke:"#000000","stroke-width":1.4,fill:colors.yellow,cursor:"pointer"},"pillarMovement"===tool2&&(t={stroke:"orange","stroke-width":1.4,fill:hatch.orange,cursor:"pointer"})),this.rect(this.w,this.h).attr(t),this.move(-1e6,-1e6),this.show(),ne.fire("remove"),ne.fire("init"),"pillar"===tool&&allow.magnet&&pillarGuidlines.fire("on")}).on("park",function(){var e;"pillar"===tool&&(ne.fire("hide"),e=get_svg_point({x:188,y:141}),this.move(e.x,e.y)),"gypsum_box"===tool&&(ne.fire("hide"),e=get_svg_point({x:188,y:141}),this.move(e.x,e.y))}).on("move",function(){this.untransform(),this.show(),this.cx(mouse.end.x).cy(mouse.end.y),ne.fire("hide");if(this.angle=0,this.center=null,this.closest_edge=null,this.room=!1,"pillar"===tool)for(let e=0;e<rooms1.data.length;e++){var t=rooms1.data[e];if(is_point_inside_polygon(mouse.end,t.polygon)){this.room=t;break}}if("gypsum_box"===tool)for(let e=0;e<rooms2.data.length;e++){var i=rooms2.data[e];if(is_point_inside_polygon(mouse.end,i.polygon)){this.room=i;break}}if(this.room){var o=Math.min(this.w,this.h)/2+10,n=this.room;let t=[];for(let e=0;e<n.edges.length;e++){var s=n.edges[e],s=LIB.projection(mouse.end,s);s&&(s=get_distance(mouse.end,s),t.push({edge:e,distance:s}))}if(t.sort(compare_distance),t[0].distance<=o&&(this.closest_edge=t[0].edge),null!==this.closest_edge){var l=n.edges[this.closest_edge],r=get_point_place(mouse.end,l);let e=LIB.projection(mouse.end,l);e&&(c=get_distance(mouse.end,e),d=get_distance(e,l.s),p=get_distance(e,l.e),c<o&&("L"===r&&(mouse.end=point_near_line_end(l.s,e,this.h/2,"L"),this.angle=get_line_angle(l),d<p&&d<=this.w/2+20&&(e=LIB.pointOnLine(l.e,l.s,-this.w/2),mouse.end=point_near_line_end(l.s,e,this.h/2,"L")),p<d&&p<=this.w/2+20&&(e=LIB.pointOnLine(l.s,l.e,-this.w/2),mouse.end=point_near_line_end(l.s,e,this.h/2,"L"))),"R"===r&&(mouse.end=point_near_line_end(l.s,e,this.h/2,"R"),this.angle=get_line_angle(l)+180,d<p&&d<=this.w/2+20&&(e=LIB.pointOnLine(l.e,l.s,-this.w/2),mouse.end=point_near_line_end(l.s,e,this.h/2,"R")),p<d&&p<=this.w/2+20&&(e=LIB.pointOnLine(l.s,l.e,-this.w/2),mouse.end=point_near_line_end(l.s,e,this.h/2,"R")))))}null===this.closest_edge&&(this.angle=0),this.cx(mouse.end.x).cy(mouse.end.y),this.center=mouse.end}if("pillar"===tool&&allow.magnet&&1==(0===this.angle||90===this.angle||180===this.angle||270===this.angle||360===this.angle))for(let e=0;e<pillarGuidlines.db.length;e++){var a=pillarGuidlines.db[e],h=LIB.projection(mouse.end,a),g=get_point_place(mouse.end,a);if(get_distance(mouse.end,h)<5){let e=!1;"L"===g&&(e=get_point_near_line_point(a,h,this.w/2,"L")),(e="R"===g?get_point_near_line_point(a,h,this.w/2,"R"):e)&&("V"===a.orientation&&(mouse.end.x=e.x,this.cx(e.x)),"H"===a.orientation&&(mouse.end.y=e.y,this.cy(e.y)))}}if(this.room){var _=this.room;if(this.angle=parseInt(this.angle.toFixed(0)),0===this.angle||90===this.angle||180===this.angle||270===this.angle||360===this.angle){p4=0===this.angle||180===this.angle||360===this.angle?(p1={x:mouse.end.x,y:mouse.end.y-this.h/2},p2={x:mouse.end.x+this.w/2,y:mouse.end.y},p3={x:mouse.end.x,y:mouse.end.y+this.h/2},{x:mouse.end.x-this.w/2,y:mouse.end.y}):(p1={x:mouse.end.x,y:mouse.end.y-this.w/2},p2={x:mouse.end.x+this.h/2,y:mouse.end.y},p3={x:mouse.end.x,y:mouse.end.y+this.w/2},{x:mouse.end.x-this.h/2,y:mouse.end.y});var d,p,c,A={s:{x:p1.x,y:p1.y},e:{x:p1.x,y:p1.y-1e6}},u={s:{x:p4.x,y:p4.y},e:{x:p4.x-1e6,y:p4.y}},w={s:{x:p3.x,y:p3.y},e:{x:p3.x,y:p3.y+1e4}},m={s:{x:p2.x,y:p2.y},e:{x:p2.x+1e4,y:p2.y}};let t=[],i=[],n=[],s=[];for(let e=0;e<_.edges.length;e++){var f=_.edges[e],I=line_and_line_intersection(A,f),C=line_and_line_intersection(u,f),y=line_and_line_intersection(w,f),f=line_and_line_intersection(m,f);I&&t.push({point:I,distance:get_distance(A.s,I)}),y&&n.push({point:y,distance:get_distance(w.s,y)}),C&&i.push({point:C,distance:get_distance(u.s,C)}),f&&s.push({point:f,distance:get_distance(m.s,f)})}1<t.length&&t.sort(compare_distance),1<n.length&&n.sort(compare_distance),1<i.length&&i.sort(compare_distance),1<s.length&&s.sort(compare_distance),0<t.length&&(0<get_distance(c=A.s,o=t[0].point)&&ne.fire("update",{label:"t",s:c,e:o})),0<n.length&&(0<get_distance(r=w.s,d=n[0].point)&&ne.fire("update",{label:"b",s:r,e:d})),0<i.length&&(0<get_distance(p=u.s,l=i[0].point)&&ne.fire("update",{label:"l",s:p,e:l})),0<s.length&&(0<get_distance(c=m.s,o=s[0].point)&&ne.fire("update",{label:"r",s:c,e:o}))}}this.rotate(this.angle)}).on("create",function(){let e=this.center;e=e||LIB.point(this.cx(),this.cy());var r=9e5<Math.abs(e.x),a=9e5<Math.abs(e.y);if(r||a)return warning.show("red",l10n.pillar_try_again),tool_deactivate(),void this.hide();if(is_a_number(defs.pillar.width)&&is_a_number(defs.pillar.height)){var r={x:e.x+this.h/2*Math.cos((this.angle+90)*Math.PI/180),y:e.y+this.h/2*Math.sin((this.angle+90)*Math.PI/180)},a=LIB.pointOnLine(r,e,this.h/2),h=point_near_line_end(r,e,this.w/2,"R"),g=point_near_line_end(r,e,this.w/2,"L"),i=get_line(g,h),n=get_line(r,a),s=get_point_near_line_point(n,a,this.w/2,"L"),o=get_point_near_line_point(n,a,this.w/2,"R"),l=get_point_near_line_point(n,r,this.w/2,"R"),_=get_point_near_line_point(n,r,this.w/2,"L"),d=get_center(r,a),p=LIB.pointOnLine(r,a,-3),c=LIB.pointOnLine(g,h,-3),A=LIB.pointOnLine(a,r,-3),u=LIB.pointOnLine(h,g,-3);let t=!0;for(let e=0;e<walls.db.length;e++){var w=walls.db[e];if("init_copy"!==w.label&&(("build"!==plan||"break"!==w.label)&&!1===(t=line_and_line_intersection(w.axis,i)||line_and_line_intersection(w.axis,n)?!1:t)))break}if(!1===t)return warning.show("yellow",l10n.wall_already_any_plan_not_install),this.backup&&this.fire("rollback"),void this.fire("off");t=!0;for(let e=0;e<pillars.db.length;e++){var m=pillars.db[e];if("pillar_water"!==m.role&&!1===(t=is_point_inside_polygon(d,m.polygon)||is_point_inside_polygon(p,m.polygon)||is_point_inside_polygon(c,m.polygon)||is_point_inside_polygon(A,m.polygon)||is_point_inside_polygon(u,m.polygon)||is_point_inside_polygon(s,m.polygon)||is_point_inside_polygon(o,m.polygon)||is_point_inside_polygon(l,m.polygon)||is_point_inside_polygon(_,m.polygon)?!1:t))break}if(!1===t)return warning.show("red",l10n.pillar_not_install_to_box),this.backup&&(pillars.draw(),walls.draw(),create_rooms(),this.fire("rollback")),void this.fire("off");if("gypsum_box"===tool&&!1===this.room)return warning.show("red",l10n.pillar_not_install_out_room),this.backup&&(pillars.draw(),walls.draw(),create_rooms(),this.fire("rollback")),void this.fire("off");if("pillar"===tool){var f=this.room;if(null!==this.closest_edge){a=f.edges[this.closest_edge];"wall"===a.type&&(r=LIB.lineLength(a),Math.abs(r-this.w)<=3&&("L"===(h=get_point_place(e,a))&&(e=get_point_near_line_center(a.s,a.e,this.h/2,"L")),"R"===h&&(e=get_point_near_line_center(a.s,a.e,this.h/2,"R")),this.w=r));let t={x:e.x-this.w/2,y:e.y},i={x:e.x+this.w/2,y:e.y},n={x:e.x,y:e.y-this.h/2},s={x:e.x,y:e.y+this.h/2},o=!1,l=!1;for(let e=0;e<f.edges.length;e++){var I=f.edges[e];"wall"===I.type&&(is_vertical(I)&&(Math.abs(t.x-I.s.x)<=5&&(t.x=I.s.x,o=!0),Math.abs(i.x-I.s.x)<=5&&(i.x=I.s.x,o=!0)),is_horizontal(I)&&(Math.abs(n.y-I.s.y)<=5&&(n.y=I.s.y,l=!0),Math.abs(s.y-I.s.y)<=5&&(s.y=I.s.y,l=!0)))}o&&(e=get_center(t,i),this.w=get_distance(t,i)),l&&(e=get_center(n,s),this.h=get_distance(n,s)),rooms1.create(),pillars.db.push(new H({role:"pillar",id:this.backup&&this.backup.id?this.backup.id:void 0,center:copy.point(e),width:this.w,height:this.h,angle:this.angle,anchor:"wall"}))}if(null===this.closest_edge){let t={x:e.x-this.w/2,y:e.y},i={x:e.x+this.w/2,y:e.y},n={x:e.x,y:e.y-this.h/2},s={x:e.x,y:e.y+this.h/2},o=!1,l=!1;if(this.room)for(let e=0;e<f.edges.length;e++){var C=f.edges[e];"wall"===C.type&&(is_vertical(C)&&(Math.abs(t.x-C.s.x)<=5&&(t.x=C.s.x,o=!0),Math.abs(i.x-C.s.x)<=5&&(i.x=C.s.x,o=!0)),is_horizontal(C)&&(Math.abs(n.y-C.s.y)<=5&&(n.y=C.s.y,l=!0),Math.abs(s.y-C.s.y)<=5&&(s.y=C.s.y,l=!0)))}o&&(e=get_center(t,i),this.w=get_distance(t,i)),l&&(e=get_center(n,s),this.h=get_distance(n,s)),pillars.db.push(new H({role:"pillar",id:this.backup&&this.backup.id?this.backup.id:void 0,center:copy.point(e),width:this.w,height:this.h,angle:this.angle,anchor:"floor"}))}if(tool_deactivate(),this.hide(),ne.fire("hide"),pillarGuidlines.fire("off"),$(".options_preset").hide(),pillars.draw(),walls.draw(),create_rooms(),project.localSave(),"pillarMovement"===tool2)tool="none",tool2="none",defs.pillar.width=20,defs.pillar.height=20;else if(20===defs.pillar.width&&20===defs.pillar.height){let e=pillars.db[pillars.db.length-1];e.selected=!0,selected.pillar=e,id.pillar=e.id,selectedObject="pillar",e.paint("orange"),pillarControls.fire("on")}}if("gypsum_box"===tool&&this.room){let r=this.room;if(null!==this.closest_edge){g=r.edges[this.closest_edge];"wall"===g.type&&(h=LIB.lineLength(g),Math.abs(h-this.w)<=3&&("L"===(a=get_point_place(e,g))&&(e=get_point_near_line_center(g.s,g.e,this.h/2,"L")),"R"===a&&(e=get_point_near_line_center(g.s,g.e,this.h/2,"R")),this.w=h));let t={x:e.x-this.w/2,y:e.y},i={x:e.x+this.w/2,y:e.y},n={x:e.x,y:e.y-this.h/2},s={x:e.x,y:e.y+this.h/2},o=!1,l=!1;for(let e=0;e<r.edges.length;e++){var y=r.edges[e];"wall"===y.type&&(is_vertical(y)&&(Math.abs(t.x-y.s.x)<=5&&(t.x=y.s.x,o=!0),Math.abs(i.x-y.s.x)<=5&&(i.x=y.s.x,o=!0)),is_horizontal(y)&&(Math.abs(n.y-y.s.y)<=5&&(n.y=y.s.y,l=!0),Math.abs(s.y-y.s.y)<=5&&(s.y=y.s.y,l=!0)))}o&&(e=get_center(t,i),this.w=get_distance(t,i)),l&&(e=get_center(n,s),this.h=get_distance(n,s)),r.delete(),pillars.db.push(new H({role:"gypsum",id:this.backup&&this.backup.id?this.backup.id:void 0,center:copy.point(e),width:this.w,height:this.h,angle:this.angle,anchor:"wall"}))}if(null===this.closest_edge){let t={x:e.x-this.w/2,y:e.y},i={x:e.x+this.w/2,y:e.y},n={x:e.x,y:e.y-this.h/2},s={x:e.x,y:e.y+this.h/2},o=!1,l=!1;for(let e=0;e<r.edges.length;e++){var b=r.edges[e];"wall"===b.type&&(is_vertical(b)&&(Math.abs(t.x-b.s.x)<=5&&(t.x=b.s.x,o=!0),Math.abs(i.x-b.s.x)<=5&&(i.x=b.s.x,o=!0)),is_horizontal(b)&&(Math.abs(n.y-b.s.y)<=5&&(n.y=b.s.y,l=!0),Math.abs(s.y-b.s.y)<=5&&(s.y=b.s.y,l=!0)))}o&&(e=get_center(t,i),this.w=get_distance(t,i)),l&&(e=get_center(n,s),this.h=get_distance(n,s)),pillars.db.push(new H({role:"gypsum",id:this.backup&&this.backup.id?this.backup.id:void 0,center:copy.point(e),width:this.w,height:this.h,angle:this.angle,anchor:"floor"})),r.draw()}tool_deactivate(),this.hide(),ne.fire("hide"),$(".options_preset").hide(),pillars.draw(),walls.draw(),create_rooms(),project.localSave()}this.backup&&delete this.backup,pillars.get("parents")}else warning.show("yellow",l10n.pillar_check_size)}).on("rollback",function(){StopSign.hide(),ne.fire("remove"),"pillar"===tool&&pillars.db.push(new H({role:"pillar",id:this.backup.id,center:this.backup.center,width:this.backup.width,height:this.backup.height,angle:this.backup.angle,anchor:this.backup.anchor})),"gypsum_box"===tool&&pillars.db.push(new H({role:"gypsum",id:this.backup.id,center:this.backup.center,width:this.backup.width,height:this.backup.height,angle:this.backup.angle,anchor:this.backup.anchor})),pillars.draw(),walls.draw(),this.backup&&delete this.backup}).on("off",function(){"pillar"!==tool&&"gypsum_box"!==tool||(delete this.backup,this.hide(),i=!1,this.backup&&delete this.backup)}),cursors.pillar_air=serviceLayer.group().on("init",function(e){i=!0,this.clear(),e.detail&&e.detail.backup&&(this.backup=e.detail.backup),this.fire("update",{width:defs.pillar_air.width,height:defs.pillar_air.height}),this.move(-1e4,-1e4),this.show(),ne.fire("remove"),ne.fire("init")}).on("update",function(e){this.clear(),this.w=e.detail.width,this.h=e.detail.height;let t=colors.grey;"build"===plan&&(t=colors.blue),this.background=this.rect(this.w,this.h).attr({stroke:t,"stroke-width":1.4,fill:"#ffffff"});let i=this.bbox().cx,n=this.bbox().cy;var e={x:i-2,y:n-2},s={x:i-this.w/2,y:n-this.h/2},o={x:i+this.w/2,y:n-this.h/2},l={x:i-this.w/2,y:n+this.h/2};this.line(e.x,e.y,s.x,s.y).attr({stroke:t,"stroke-width":1.4}),this.line(e.x,e.y,o.x,o.y).attr({stroke:t,"stroke-width":1.4}),this.line(e.x,e.y,l.x,l.y).attr({stroke:t,"stroke-width":1.4})}).on("park",function(){ne.fire("hide");var e=get_svg_point({x:188,y:141});this.move(e.x,e.y)}).on("move",function(){this.untransform(),this.show(),StopSign.hide();let e=!0,n=(ne.fire("hide"),this.angle=0,this.cx(mouse.end.x).cy(mouse.end.y),{x:this.cx(),y:this.cy()}),l={x:n.x,y:n.y-this.h/2},r={x:n.x+this.w/2,y:n.y},a={x:n.x,y:n.y+this.h/2},h={x:n.x-this.w/2,y:n.y};this.p1_={x:n.x-this.w/2,y:n.y-this.h/2},this.p2_={x:n.x+this.w/2,y:n.y-this.h/2},this.p3_={x:n.x+this.w/2,y:n.y+this.h/2},this.p4_={x:n.x-this.w/2,y:n.y+this.h/2},this.PILLAR=null,this.CENTER=null,this.SET_IN_PILLAR=!1;for(let e=0;e<pillars.db.length;e++){var t=pillars.db[e];is_point_inside_polygon(l,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(r,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(a,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(h,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(n,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(this.p1_,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(this.p2_,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(this.p3_,t.polygon)&&(this.PILLAR=e),is_point_inside_polygon(this.p4_,t.polygon)&&(this.PILLAR=e)}if(null!==this.PILLAR&&(e=!1,g=pillars.db[this.PILLAR],this.cx(g.center.x).cy(g.center.y),"pillar"===g.role&&40<=g.width&&40<=g.height&&(this.SET_IN_PILLAR=!0,this.CENTER=g.center,this.WIDTH=g.width-20,this.HEIGHT=g.height-20),"pillar"!==g.role&&(this.SET_IN_PILLAR=!1,this.CENTER=null,this.WIDTH=null,this.HEIGHT=null),!0===this.SET_IN_PILLAR&&($("body").css("cursor","pointer"),e=!1,this.fire("update",{width:this.WIDTH,height:this.HEIGHT}),this.cx(this.CENTER.x).cy(this.CENTER.y)),!1===this.SET_IN_PILLAR&&(this.hide(),this.CENTER=null,StopSign.cx(g.center.x).cy(g.center.y).show())),null===this.PILLAR&&(e=!0,this.CENTER=null,this.fire("update",{width:defs.pillar_air.width,height:defs.pillar_air.height}),this.cx(mouse.end.x).cy(mouse.end.y)),this.ROOM=null,this.SET_IN_ROOM=!1,this.SET_IN_MICRO_ROOM=!1,"init"===plan){for(let e=0;e<rooms1.data.length;e++){var i=rooms1.data[e];is_point_inside_polygon(n,i.polygon)&&(this.ROOM=e,(.5<i.area||4<i.edges.length)&&(this.SET_IN_ROOM=!0),i.area<=.5&&4===i.edges.length&&(this.SET_IN_MICRO_ROOM=!0))}null!==this.ROOM&&!0===this.SET_IN_MICRO_ROOM&&(g=rooms1.data[this.ROOM],e=!1,d=get_polygon_dimensions(g.polygon),this.CENTER=g.center,this.WIDTH=d.width,this.HEIGHT=d.height,this.fire("update",{width:this.WIDTH,height:this.HEIGHT}),this.cx(g.center.x).cy(g.center.y))}if("build"===plan){for(let e=0;e<rooms2.data.length;e++){var s=rooms2.data[e];is_point_inside_polygon(n,s.polygon)&&(this.ROOM=e,(.5<s.area||4<s.edges.length)&&(this.SET_IN_ROOM=!0),s.area<=.5&&4===s.edges.length&&(this.SET_IN_MICRO_ROOM=!0))}null!==this.ROOM&&!0===this.SET_IN_MICRO_ROOM&&(d=rooms2.data[this.ROOM],e=!1,g=get_polygon_dimensions(d.polygon),this.CENTER=d.center,this.WIDTH=g.width,this.HEIGHT=g.height,this.fire("update",{width:this.WIDTH,height:this.HEIGHT}),this.cx(d.center.x).cy(d.center.y))}if(null===this.PILLAR&&null!==this.ROOM&&!1===this.SET_IN_MICRO_ROOM){let o;"init"===plan&&(o=rooms1.data[this.ROOM]),"build"===plan&&(o=rooms2.data[this.ROOM]);var g=this.h/2+10;let t=null,i=[];for(let e=0;e<o.edges.length;e++){var _=o.edges[e];"gypsum"===_.parent||(_=LIB.projection(n,_))&&(_=get_distance(n,_),i.push({edge:e,distance:_}))}if(i.sort(compare_distance),null!==(t=i[0].distance<=g?i[0].edge:t)){var d=o.edges[t],p=get_point_place(n,d);let e=LIB.projection(n,d);e&&(u=get_distance(n,e),c=get_distance(e,d.s),A=get_distance(e,d.e),u<g&&("L"===p&&(n=point_near_line_end(d.s,e,this.h/2,"L"),this.angle=get_line_angle(d),c<A&&c<=this.w/2+20&&(e=LIB.pointOnLine(d.e,d.s,-this.w/2),n=point_near_line_end(d.s,e,this.h/2,"L")),A<c&&A<=this.w/2+20&&(e=LIB.pointOnLine(d.s,d.e,-this.w/2),n=point_near_line_end(d.s,e,this.h/2,"L"))),"R"===p&&(n=point_near_line_end(d.s,e,this.h/2,"R"),this.angle=get_line_angle(d)+180,c<A&&c<=this.w/2+20&&(e=LIB.pointOnLine(d.e,d.s,-this.w/2),n=point_near_line_end(d.s,e,this.h/2,"R")),A<c&&A<=this.w/2+20&&(e=LIB.pointOnLine(d.s,d.e,-this.w/2),n=point_near_line_end(d.s,e,this.h/2,"R")))))}if(null===t&&(this.angle=0),this.cx(n.x).cy(n.y),mouse.end=copy_point(n),this.CENTER=n,!0===e&&(this.angle=parseInt(this.angle.toFixed(0)),this.angle=Math.abs(this.angle),0===this.angle||90===this.angle||180===this.angle||270===this.angle||360===this.angle)){var c,A,u={x:mouse.end.x,y:mouse.end.y},w=(h=0===this.angle||180===this.angle||360===this.angle?(l={x:u.x,y:u.y-this.h/2},r={x:u.x+this.w/2,y:u.y},a={x:u.x,y:u.y+this.h/2},{x:u.x-this.w/2,y:u.y}):(l={x:u.x,y:u.y-this.w/2},r={x:u.x+this.h/2,y:u.y},a={x:u.x,y:u.y+this.w/2},{x:u.x-this.h/2,y:u.y}),{s:{x:l.x,y:l.y},e:{x:l.x,y:l.y-1e4}}),m={s:{x:h.x,y:h.y},e:{x:h.x-1e4,y:h.y}},f={s:{x:a.x,y:a.y},e:{x:a.x,y:a.y+1e4}},I={s:{x:r.x,y:r.y},e:{x:r.x+1e4,y:r.y}};let t=[],i=[],n=[],s=[];for(let e=0;e<o.edges.length;e++){var C,y,b,v=o.edges[e];"gypsum"!==v.parent&&(C=line_and_line_intersection(w,v),y=line_and_line_intersection(m,v),b=line_and_line_intersection(f,v),v=line_and_line_intersection(I,v),C&&t.push({point:C,distance:get_distance(w.s,C)}),b&&n.push({point:b,distance:get_distance(f.s,b)}),y&&i.push({point:y,distance:get_distance(m.s,y)}),v&&s.push({point:v,distance:get_distance(I.s,v)}))}1<t.length&&t.sort(compare_distance),1<n.length&&n.sort(compare_distance),1<i.length&&i.sort(compare_distance),1<s.length&&s.sort(compare_distance),0<t.length&&(0<get_distance(g=w.s,p=t[0].point)&&ne.fire("update",{label:"t",s:g,e:p})),0<n.length&&(0<get_distance(c=f.s,A=n[0].point)&&ne.fire("update",{label:"b",s:c,e:A})),0<i.length&&(0<get_distance(d=m.s,u=i[0].point)&&ne.fire("update",{label:"l",s:d,e:u})),0<s.length&&(0<get_distance(g=I.s,p=s[0].point)&&ne.fire("update",{label:"r",s:g,e:p}))}}this.rotate(this.angle),$("body").css("cursor","default"),null===this.CENTER&&$("body").css("cursor","default"),null!==this.CENTER&&$("body").css("cursor","pointer"),null!==this.PILLAR&&!1===this.SET_IN_PILLAR&&$("body").css("cursor","default")}).on("create",function(){if(is_a_number(defs.pillar_air.width)&&is_a_number(defs.pillar_air.height)){let e=this.cx(),t=this.cy();var i=-10001<e&&e<-9999,n=-10001<t&&t<-9999;if(!i||!n){var s=[this.p1_,this.p2_,this.p3_,this.p4_];for(let e=0;e<items.db.length;e++){var o=items.db[e];if("init"===o.props.plan&&LIB.isPointInsidePolygon(o.props.center,s))return void warning.show("red",l10n.pillar_not_install_here_2)}if(null===this.ROOM&&null===this.PILLAR)return"pillarMovement"===tool2&&this.fire("rollback"),warning.show("red",l10n.pillar_install_communications),void this.fire("blink");if(null!==this.PILLAR){i=pillars.db[this.PILLAR];if(!1===this.SET_IN_PILLAR)return"pillar"===i.role&&"pillarMovement"===tool2&&(warning.show("red",l10n.pillar_air_not_install_in_pillar),this.fire("rollback")),"pillar_air"===i.role&&warning.show("red",l10n.pillar_air_already_exist),"pillar_water"===i.role&&warning.show("red",l10n.pillar_air_stop_pillar_water),void this.fire("blink");!0===this.SET_IN_PILLAR&&(pillars.db.push(new H({role:"pillar_air",plan:plan,id:this.backup&&this.backup.id?this.backup.id:void 0,background:!0,center:this.CENTER,width:this.WIDTH,height:this.HEIGHT,angle:0})),this.fire("reset"),project.localSave())}null!==this.ROOM&&null===this.PILLAR&&(null!==this.CENTER&&(this.SET_IN_ROOM&&(pillars.db.push(new H({role:"pillar_air",plan:plan,id:this.backup&&this.backup.id?this.backup.id:void 0,background:!1,center:this.CENTER,width:this.w,height:this.h,angle:this.angle})),create_rooms(),this.fire("reset"),project.localSave()),this.SET_IN_MICRO_ROOM&&(pillars.db.push(new H({role:"pillar_air",plan:plan,id:this.backup&&this.backup.id?this.backup.id:void 0,background:!0,center:this.CENTER,width:this.WIDTH,height:this.HEIGHT,angle:0})),create_rooms(),this.fire("reset"),project.localSave())),null===this.CENTER&&this.fire("blink")),$(".tools_item").removeClass("active"),tool="none",pillars.get("parents")}}else warning.show("yellow",l10n.pillar_box_check_size)}).on("reset",function(e){this.clear(),deactivate_tool(),ne.fire("hide"),$(".options_preset").hide(),i=!1,delete this.p1_,delete this.p2_,delete this.p3_,delete this.p4_}).on("rollback",function(){StopSign.hide(),ne.fire("remove"),console.warn(this.backup),pillars.db.push(new H({role:"pillar_air",plan:plan,id:this.backup.id,center:this.backup.center,width:this.backup.width,height:this.backup.height,angle:this.backup.angle,anchor:this.backup.anchor})),pillars.draw(),walls.draw(),this.fire("reset")}).on("blink",function(e){this.background.fill("red");let t=this;setTimeout(function(){t.background.fill("transparent")},100)}),cursors.pillar_water=serviceLayer.group().on("init",function(e){i=!0,e.detail&&e.detail.backup&&(this.backup=e.detail.backup),this.clear(),this.fire("update",{width:defs.pillar_water.width,height:defs.pillar_water.height}),this.move(-1e4,-1e4),this.show(),ne.fire("remove")}).on("update",function(e){this.clear(),this.w=e.detail.width,this.h=e.detail.height,1===e.detail.mode&&(this.background=this.rect(this.w,this.h).attr({stroke:"#000000","stroke-width":0,fill:"transparent"})),2===e.detail.mode&&(this.background=this.rect(this.w,this.h).attr({stroke:"#000000","stroke-width":1.4,fill:"#ffffff"}));e={x:this.bbox().cx,y:this.bbox().cy};this.circle(7).cx(e.x).cy(e.y-3).attr({stroke:"#000000","stroke-width":1,fill:"#fafafa"}),this.circle(5).cx(e.x-4).cy(e.y+4).attr({stroke:"#000000","stroke-width":.4,fill:"blue"}),this.circle(5).cx(e.x+4).cy(e.y+4).attr({stroke:"#000000","stroke-width":.4,fill:"red"})}).on("park",function(){ne.fire("hide");var e=get_svg_point({x:188,y:141});this.move(e.x,e.y)}).on("move",function(){this.untransform(),this.show(),StopSign.hide(),this.angle=0,this.cx(mouse.end.x).cy(mouse.end.y);let s={x:this.cx(),y:this.cy()};var t={x:s.x,y:s.y-this.h/2},i={x:s.x+this.w/2,y:s.y},n={x:s.x,y:s.y+this.h/2},o={x:s.x-this.w/2,y:s.y},l={x:s.x-this.w/2,y:s.y-this.h/2},r={x:s.x+this.w/2,y:s.y-this.h/2},a={x:s.x+this.w/2,y:s.y+this.h/2},h={x:s.x-this.w/2,y:s.y+this.h/2};this.PILLAR=null,this.CENTER=null,this.SET_IN_PILLAR=!1;for(let e=0;e<pillars.db.length;e++){var g=pillars.db[e];is_point_inside_polygon(t,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(i,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(n,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(o,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(s,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(l,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(r,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(a,g.polygon)&&(this.PILLAR=e),is_point_inside_polygon(h,g.polygon)&&(this.PILLAR=e)}if(null!==this.PILLAR&&(p=pillars.db[this.PILLAR],this.cx(p.center.x).cy(p.center.y),"pillar"===p.role&&40<=p.width&&40<=p.height&&(this.SET_IN_PILLAR=!0,this.CENTER=p.center,this.WIDTH=p.width-20,this.HEIGHT=p.height-20),"pillar"!==p.role&&(this.SET_IN_PILLAR=!1,this.CENTER=null,this.WIDTH=null,this.HEIGHT=null),!0===this.SET_IN_PILLAR&&($("body").css("cursor","pointer"),this.fire("update",{mode:2,width:this.WIDTH,height:this.HEIGHT}),this.cx(this.CENTER.x).cy(this.CENTER.y)),!1===this.SET_IN_PILLAR&&(this.hide(),this.CENTER=null,StopSign.cx(p.center.x).cy(p.center.y).show())),null===this.PILLAR&&(this.CENTER=null,this.fire("update",{mode:1,width:defs.pillar_water.width,height:defs.pillar_water.height}),this.cx(mouse.end.x).cy(mouse.end.y)),this.ROOM=null,this.SET_IN_ROOM=!1,this.SET_IN_MICRO_ROOM=!1,"init"===plan){for(let e=0;e<rooms1.data.length;e++){var _=rooms1.data[e];is_point_inside_polygon(s,_.polygon)&&(this.ROOM=e,.5<_.area&&(this.SET_IN_ROOM=!0),_.area<=.5&&4===_.edges.length&&(this.SET_IN_MICRO_ROOM=!0))}null!==this.ROOM&&!0===this.SET_IN_MICRO_ROOM&&(m=get_polygon_dimensions((p=rooms1.data[this.ROOM]).polygon),this.CENTER=p.center,this.WIDTH=m.width,this.HEIGHT=m.height,this.fire("update",{mode:2,width:this.WIDTH,height:this.HEIGHT}),this.cx(p.center.x).cy(p.center.y))}if("build"===plan){for(let e=0;e<rooms2.data.length;e++){var d=rooms2.data[e];is_point_inside_polygon(s,d.polygon)&&(this.ROOM=e,.5<d.area&&(this.SET_IN_ROOM=!0),d.area<=.5&&4===d.edges.length&&(this.SET_IN_MICRO_ROOM=!0))}null!==this.ROOM&&!0===this.SET_IN_MICRO_ROOM&&(p=get_polygon_dimensions((m=rooms2.data[this.ROOM]).polygon),this.CENTER=m.center,this.WIDTH=p.width,this.HEIGHT=p.height,this.fire("update",{mode:2,width:this.WIDTH,height:this.HEIGHT}),this.cx(m.center.x).cy(m.center.y))}if(null===this.PILLAR&&null!==this.ROOM&&!1===this.SET_IN_MICRO_ROOM){let t;"init"===plan&&(t=rooms1.data[this.ROOM]),"build"===plan&&(t=rooms2.data[this.ROOM]);var p=this.h/2+10;let i=null,n=[];for(let e=0;e<t.edges.length;e++){var c=t.edges[e];"gypsum"===c.parent||(c=LIB.projection(s,c))&&(c=get_distance(s,c),n.push({edge:e,distance:c}))}if(n.sort(compare_distance),null!==(i=n[0].distance<=p?n[0].edge:i)){var A,u,w,m=t.edges[i],f=get_point_place(s,m);let e=LIB.projection(s,m);e&&(A=get_distance(s,e),u=get_distance(e,m.s),w=get_distance(e,m.e),A<p&&("L"===m.room_side&&"L"===f&&(s=point_near_line_end(m.s,e,this.h/2,"L"),this.angle=get_line_angle(m),u<w&&u<=this.w/2+20&&(e=LIB.pointOnLine(m.e,m.s,-this.w/2),s=point_near_line_end(m.s,e,this.h/2,"L")),w<u&&w<=this.w/2+20&&(e=LIB.pointOnLine(m.s,m.e,-this.w/2),s=point_near_line_end(m.s,e,this.h/2,"L"))),"R"===m.room_side&&"R"===f&&(s=point_near_line_end(m.s,e,this.h/2,"R"),this.angle=get_line_angle(m)+180,u<w&&u<=this.w/2+20&&(e=LIB.pointOnLine(m.e,m.s,-this.w/2),s=point_near_line_end(m.s,e,this.h/2,"R")),w<u&&w<=this.w/2+20&&(e=LIB.pointOnLine(m.s,m.e,-this.w/2),s=point_near_line_end(m.s,e,this.h/2,"R")))))}null===i&&(this.angle=0),this.cx(s.x).cy(s.y),mouse.end=copy_point(s),this.CENTER=s}this.rotate(this.angle),$("body").css("cursor","default"),null===this.CENTER&&$("body").css("cursor","default"),null!==this.CENTER&&$("body").css("cursor","pointer"),null!==this.PILLAR&&!1===this.SET_IN_PILLAR&&$("body").css("cursor","default")}).on("create",function(){let e=this.cx(),t=this.cy();var i=-10001<e&&e<-9999,n=-10001<t&&t<-9999;if(!i||!n){if(null===this.ROOM&&null===this.PILLAR)return"pillarMovement"===tool2&&this.fire("rollback"),warning.show("red",l10n.pillar_install_communications),void this.fire("blink");if(null!==this.PILLAR){i=pillars.db[this.PILLAR];if(!1===this.SET_IN_PILLAR)return"pillar"===i.role&&"pillarMovement"===tool2&&(warning.show("red",l10n.pillar_water_not_install_in_pillar),this.fire("rollback")),"pillar_water"===i.role&&warning.show("red",l10n.pillar_water_already_exist),"pillar_air"===i.role&&warning.show("red",l10n.pillar_water_stop_pillar_air),void this.fire("blink");!0===this.SET_IN_PILLAR&&(pillars.db.push(new H({plan:plan,role:"pillar_water",id:this.backup&&this.backup.id?this.backup.id:void 0,background:!0,center:this.CENTER,width:this.WIDTH,height:this.HEIGHT,angle:0,props:this.backup&&this.backup.props?this.backup.props:{}})),this.fire("reset"),project.localSave())}null!==this.ROOM&&null===this.PILLAR&&(null!==this.CENTER&&(this.SET_IN_ROOM&&(pillars.db.push(new H({plan:plan,role:"pillar_water",id:this.backup&&this.backup.id?this.backup.id:void 0,background:!1,center:this.CENTER,width:this.w,height:this.h,angle:this.angle,props:this.backup&&this.backup.props?this.backup.props:{}})),this.fire("reset"),project.localSave()),this.SET_IN_MICRO_ROOM&&(pillars.db.push(new H({plan:plan,role:"pillar_water",id:this.backup&&this.backup.id?this.backup.id:void 0,background:!0,center:this.CENTER,width:this.WIDTH,height:this.HEIGHT,angle:0,props:this.backup&&this.backup.props?this.backup.props:{}})),this.fire("reset"),project.localSave())),null===this.CENTER&&this.fire("blink")),$(".tools_item").removeClass("active"),tool="none",pillars.get("parents")}}).on("reset",function(e){this.clear(),deactivate_tool(),ne.fire("hide"),$(".options_preset").hide(),i=!1}).on("rollback",function(){StopSign.hide(),ne.fire("remove"),pillars.db.push(new H({role:"pillar_water",id:this.backup.id,center:this.backup.center,width:this.backup.width,height:this.backup.height,angle:this.backup.angle,anchor:this.backup.anchor,props:this.backup.props||{}})),pillars.draw(),walls.draw(),this.fire("reset")}).on("blink",function(e){this.background.fill("red");let t=this;setTimeout(function(){t.background.fill("transparent")},100)}),cursors.show=function(){this.hide(),"window"!==tool&&"windoor"!==tool||this.window.show(),"doorway"!==tool&&"door"!==tool&&"door_double"!==tool||this.door.show()},cursors.hide=function(){this.own.hide(),this.window.hide(),this.door.hide(),this.pillar.hide(),this.pillar_air.hide(),this.pillar_water.hide()},{db:[],save:function(){this.db=[];for(let e=0;e<rooms2.data.length;e++){var t=rooms2.data[e];for(let e=0;e<t.zones.length;e++){var i=t.zones[e];"none"!==i.name&&this.db.push({name:i.name,center:i.center})}}},restore:function(){for(let e=0;e<rooms2.data.length;e++){var i=rooms2.data[e];for(let e=0;e<i.zones.length;e++){let t=i.zones[e];for(let e=0;e<this.db.length;e++){var n=this.db[e].center,s=this.db[e].name;is_point_inside_polygon(n,t.polygon)&&(t.name=s)}}}this.db=[]}}),ue=!1,D=(window.pointJoystick=serviceLayer.group().on("on",function(e){let t=this;this.wall=e.detail.wall,this.center=e.detail.center,this.zone=e.detail.zone,this.orientation=e.detail.orientation,selected.wallPoint=e.detail.zone,this.offset=40,this.fire("off");var e="c"===this.zone&&"V"===this.orientation,i="c"===this.zone&&"H"===this.orientation,n="s"===this.zone||"e"===this.zone;(e||n)&&(this.rBtn=(new ce).on("mousedown",function(){s("wall","R"),t.center.x+=1,t.fire("move"),t.wall.paint("orange")}),this.lBtn=(new ce).on("mousedown",function(){s("wall","L"),--t.center.x,t.fire("move"),t.wall.paint("orange")})),(i||n)&&(this.uBtn=(new ce).on("mousedown",function(){s("wall","U"),--t.center.y,t.fire("move"),t.wall.paint("orange")}),this.dBtn=(new ce).on("mousedown",function(){s("wall","D"),t.center.y+=1,t.fire("move"),t.wall.paint("orange")})),this.fire("move"),this.active=!0}).on("move",function(){var e="c"===this.zone&&"V"===this.orientation,t="c"===this.zone&&"H"===this.orientation,i="s"===this.zone||"e"===this.zone;(e||i)&&(this.rBtn.untransform(),this.rBtn.cx(this.center.x+this.offset).cy(this.center.y).rotate(90),this.lBtn.untransform(),this.lBtn.cx(this.center.x-this.offset).cy(this.center.y).rotate(270)),(t||i)&&(this.uBtn.untransform(),this.uBtn.cx(this.center.x).cy(this.center.y-this.offset),this.dBtn.untransform(),this.dBtn.cx(this.center.x).cy(this.center.y+this.offset).rotate(180))}).on("off",function(){this.uBtn&&this.uBtn.remove(),this.rBtn&&this.rBtn.remove(),this.dBtn&&this.dBtn.remove(),this.lBtn&&this.lBtn.remove(),this.active=!1}),window.wallControls=serviceLayer.group().on("on",function(e){tool="moving",this.clear(),selected.wallPoint=e.detail.wallPoint;let t=this,i={"stroke-width":2,stroke:"#e48423",fill:"transparent"},n={"stroke-width":2,stroke:"crimson",fill:"transparent"};this.wall=ue,this.start=this.circle(8).draggable().attr(i).cx(this.wall.s.x).cy(this.wall.s.y).show().on("mousedown",function(){selected.wallPoint="s",this.attr(n),t.center.attr(i),t.end.attr(i)}).on("dblclick",function(e){var t=get_object(walls.db,id.wall);t&&(this.wall=t,this.wall.paint("orange"),pointJoystick.fire("on",{wall:this.wall,center:this.wall.s,zone:"s",orientation:this.wall.orientation}))}).on("dragstart",function(){var e=get_object(walls.db,id.wall);if(e){console.warn("Wall zone: 'S'"),this.selected=!0,$("body").css("cursor","move"),pointJoystick.fire("off"),me.hide(),fe.hide(),this.wall=e,this.wall.collectItems();let i=this.wall;if(this.start_position=copy.point(i.s),"build"===i.label&&0<i.walls_s.length)for(let e=0;e<i.walls_s.length;e++){var n=i.walls_s[0].wall;if("init"===walls.db[n].label)return warning.show("red",l10n.move_impossible),void(this.moving=!1)}if(i.get_linked_walls(),i.get_linked_pillars(),i.get_linked_windows(),i.get_linked_doors(),i.get_moving_limits("S"),"init"===i.label){let t=!1;for(let e=0;e<walls.db.length;e++){var s=walls.db[e];if("build"===s.label){if(is_point_inside_polygon(s.s,i.polygon)){t=!0;break}if(is_point_inside_polygon(s.e,i.polygon)){t=!0;break}}}if(t)return void warning.show("red",l10n.window_break_not_move)}this.moving=!0;let t=[];for(let e=0;e<i.parts_points.length;e++){var o=i.parts_points[e].xy;are_points_equal(i.s,o)||(o=get_distance(i.s,o),t.push({index:e,distance:o}))}t.sort(compare_distance),this.stop_part_point_index=t[0].index,this.start={x:this.cx(),y:this.cy()},this.s=copy_point(i.s),this.e=copy_point(i.e),le(i,i.s,!1),le(i,i.e,!1),selected.wallPoint="s",this.walls_to_move=[];for(let e=0;e<walls.db.length;e++){var l=walls.db[e];are_points_equal(i.s,l.s)&&this.walls_to_move.push({index:e,end:"s"}),are_points_equal(i.s,l.e)&&this.walls_to_move.push({index:e,end:"e"})}this.wallsToInit=[];for(let e=0;e<walls.db.length;e++){var r=walls.db[e],a=are_points_equal(i.s,r.s),h=are_points_equal(i.s,r.e);(a||h)&&this.wallsToInit.push(r)}this.stop_points=[];for(let e=0;e<walls.db.length;e++){var g=walls.db[e];are_points_equal(g.s,i.e)||this.stop_points.push(g.s),are_points_equal(g.e,i.e)||this.stop_points.push(g.e)}i.get_adjacent_rooms(),Ae.save()}}).on("dragmove",function(i){if(i.preventDefault(),!0===this.moving){let e=this.wall,t=LIB.pointSVG(i.detail.event.clientX,i.detail.event.clientY);this.delta=get_distance(t,this.start_position),9<this.delta&&(20<e.length&&(t.x<e.x_min&&(t.x=e.x_min),t.x>e.x_max&&(t.x=e.x_max),t.y<e.y_min&&(t.y=e.y_min),t.y>e.y_max&&(t.y=e.y_max),t.x<this.wall.e.x+10&&t.x>this.wall.e.x-10&&(t.x=this.wall.e.x),t.y<this.wall.e.y+10&&t.y>this.wall.e.y-10&&(t.y=this.wall.e.y)),i=e.parts_points[this.stop_part_point_index].xy,get_distance(e.e,t)<get_distance(e.e,i)+10&&(t=LIB.pointOnLine(e.e,i,10)),e.s=copy.point(t),e.draw(!0),e.move_linked_walls(e.e),e.move_linked_pillars(),e.move_linked_windows(),e.move_linked_doors(),wallControls.fire("dragmove"),e.paint("orange"))}}).on("dragend",function(){if(!(this.selected=!1)===this.moving){z.crosshairs.clear(),this.selected=!1;let e=this.wall;if(9<this.delta){if(e.get_orientation(),this.walls_to_move)for(let t=0;t<this.walls_to_move.length;t++){var i=this.walls_to_move[t].index;let e=walls.db[i];e.draw(),e.drawConnectedWalls("all")}e.force_connection("s"),e.draw(),e.moveItems(),walls.draw(),pillars.draw(),create_rooms(),v();for(let t=0;t<this.wallsToInit.length;t++){let e=this.wallsToInit[t];e.init()}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.wallItems&&e.moveItems()}items.setParents,project.draw(),project.localSave(),wallControls.fire("dragend"),e.paint("orange")}}}),this.center=this.circle(8).draggable().attr(i).cx(this.wall.c.x).cy(this.wall.c.y).show().on("mousedown",function(){selected.wallPoint="c",t.start.attr(i),this.attr(n),t.end.attr(i)}).on("dblclick",function(e){var t=get_object(walls.db,id.wall);t&&(this.wall=t,this.wall.paint("orange"),pointJoystick.fire("on",{wall:this.wall,center:this.wall.c,zone:"c",orientation:this.wall.orientation}))}).on("dragstart",function(){var e,i,n,s=get_object(walls.db,id.wall);if(s){console.warn("Wall zone: 'C'"),pointJoystick.fire("off"),this.moving=!0,this.wall=s;let t=this.wall;t.collectItems(),t.get_orientation(),this.start_position=copy.point(t.c),this.swalls=[],this.ewalls=[];for(let e=0;e<walls.db.length;e++){var o=walls.db[e];o.id!==t.id&&"init_copy"!==o.label&&(null===t.links.s&&(are_points_equal(t.s,o.s)&&this.swalls.push({index:e,end:"s"}),are_points_equal(t.s,o.e)&&this.swalls.push({index:e,end:"e"})),null===t.links.e&&(are_points_equal(t.e,o.s)&&this.ewalls.push({index:e,end:"s"}),are_points_equal(t.e,o.e)&&this.ewalls.push({index:e,end:"e"})))}if("build"===t.label){if(0<t.walls_s.length)for(let e=0;e<t.walls_s.length;e++){var l=t.walls_s[0].wall;if("init"===walls.db[l].label)return warning.show("red",l10n.move_impossible),void(this.moving=!1)}if(0<t.walls_e.length)for(let e=0;e<t.walls_e.length;e++){var r=t.walls_e[0].wall;if("init"===walls.db[r].label)return warning.show("red",l10n.move_impossible),void(this.moving=!1)}}me.show(),fe.show(),selected.wallPoint="c",this.selected=!0,this.sGuideline={},this.eGuideline={},1===t.walls_s.length&&(s=t.walls_s[0].wall,s=walls.db[s],this.sGuideline=get_big_line(s.axis)),1===t.walls_e.length&&(s=t.walls_e[0].wall,s=walls.db[s],this.eGuideline=get_big_line(s.axis)),2===t.walls_s.length&&(s=t.walls_s[0].wall,e=t.walls_s[1].wall,n=t.walls_s[0].type,i=t.walls_s[1].type,s=walls.db[s],e=walls.db[e],is_line_on_line(s.axis,e.axis)&&("s"===n&&(this.sGuideline.s=copy.point(s.e)),"e"===n&&(this.sGuideline.s=copy.point(s.s)),"s"===i&&(this.sGuideline.e=copy.point(e.e)),"e"===i&&(this.sGuideline.e=copy.point(e.s)))),2===t.walls_e.length&&(n=t.walls_e[0].wall,s=t.walls_e[1].wall,i=t.walls_e[0].type,e=t.walls_e[1].type,n=walls.db[n],s=walls.db[s],is_line_on_line(n.axis,s.axis)&&("s"===i&&(this.eGuideline.s=copy.point(n.e)),"e"===i&&(this.eGuideline.s=copy.point(n.s)),"s"===e&&(this.eGuideline.e=copy.point(s.e)),"e"===e&&(this.eGuideline.e=copy.point(s.s)))),null!==t.links.s&&"wall"===t.links.s.object&&(i=walls.db[t.links.s.index],this.sGuideline=i.axis),null!==t.links.e&&"wall"===t.links.e.object&&(n=walls.db[t.links.e.index],this.eGuideline=n.axis),t.get_linked_walls(),t.get_linked_pillars(),t.get_linked_windows(),t.get_linked_doors(),t.get_moving_limits("C"),this.cx(t.c.x).cy(t.c.y).stroke("#dc143c").show(),this.start={x:this.cx(),y:this.cy()},this.walls_to_move=[];for(let e=0;e<walls.db.length;e++){var a=walls.db[e];are_points_equal(t.s,a.s)&&this.walls_to_move.push({index:e,end:"s"}),are_points_equal(t.s,a.e)&&this.walls_to_move.push({index:e,end:"e"}),are_points_equal(t.e,a.s)&&this.walls_to_move.push({index:e,end:"s"}),are_points_equal(t.e,a.e)&&this.walls_to_move.push({index:e,end:"e"})}t.get_adjacent_rooms(),this.links=Object.assign({},t.links),Ae.save()}}).on("dragmove",function(t){if(!0===this.selected&&(t.preventDefault(),!0===this.moving)){let i=this.wall,e=LIB.pointSVG(t.detail.event.clientX,t.detail.event.clientY);if(this.delta=get_distance(e,this.start_position),9<this.delta){if(pointJoystick.fire("off"),"V"===i.orientation){e.x>i.x_max&&(e.x=i.x_max),e.x<i.x_min&&(e.x=i.x_min),i.s.x=e.x,i.e.x=e.x,i.links.s&&"wall"===i.links.s.object&&(t=walls.db[i.links.s.index],(t=line_and_line_intersection(get_big_line(i.axis),t.axis))&&(i.s.x=t.x,i.s.y=t.y)),i.links.e&&"wall"===i.links.e.object&&(t=walls.db[i.links.e.index],(t=line_and_line_intersection(get_big_line(i.axis),t.axis))&&(i.e.x=t.x,i.e.y=t.y)),i.calc();for(let t=0;t<this.swalls.length;t++){var n=this.swalls[t].index,s=this.swalls[t].end;let e=walls.db[n];"s"===s&&(e.s.x=i.s.x),"e"===s&&(e.e.x=i.s.x),e.draw()}for(let t=0;t<this.ewalls.length;t++){var o=this.ewalls[t].index,l=this.ewalls[t].end;let e=walls.db[o];"s"===l&&(e.s.x=i.e.x),"e"===l&&(e.e.x=i.e.x),e.draw()}}if("H"===i.orientation){e.y>i.y_max&&(e.y=i.y_max),e.y<i.y_min&&(e.y=i.y_min),i.s.y=e.y,i.e.y=e.y,i.links.s&&"wall"===i.links.s.object&&(t=walls.db[i.links.s.index],(t=line_and_line_intersection(get_big_line(i.axis),t.axis))&&(i.s.x=t.x,i.s.y=t.y)),i.links.e&&"wall"===i.links.e.object&&(t=walls.db[i.links.e.index],(t=line_and_line_intersection(get_big_line(i.axis),t.axis))&&(i.e.x=t.x,i.e.y=t.y)),i.calc();for(let t=0;t<this.swalls.length;t++){var r=this.swalls[t].index,a=this.swalls[t].end;let e=walls.db[r];"s"===a&&(e.s.y=i.s.y),"e"===a&&(e.e.y=i.s.y),e.draw()}for(let t=0;t<this.ewalls.length;t++){var h=this.ewalls[t].index,g=this.ewalls[t].end;let e=walls.db[h];"s"===g&&(e.s.y=i.e.y),"e"===g&&(e.e.y=i.e.y),e.draw()}}i.draw(),i.move_linked_walls(),i.move_linked_pillars(),i.move_linked_windows(),i.move_linked_doors(),wallControls.fire("dragmove"),i.paint("orange")}}}).on("dragend",function(){if(!0===this.selected&&!0===this.moving){this.selected=!1;let e=this.wall;if(this.delta=get_distance(this.start,{x:this.cx(),y:this.cy()}),9<this.delta){e.moveItems(),walls.draw(),pillars.draw(),create_rooms(),v();for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.wallItems&&e.moveItems()}items.setParents,project.draw(),project.localSave(),wallControls.fire("dragend"),e.paint("orange")}}}),this.end=this.circle(8).draggable().attr(i).cx(this.wall.e.x).cy(this.wall.e.y).show().on("mousedown",function(){selected.wallPoint="e",t.start.attr(i),t.center.attr(i),this.attr(n)}).on("dblclick",function(e){var t=get_object(walls.db,id.wall);t&&(this.wall=t,this.wall.paint("orange"),pointJoystick.fire("on",{wall:this.wall,center:this.wall.e,zone:"e",orientation:this.wall.orientation}))}).on("dragstart",function(e){var n=get_object(walls.db,id.wall);if(n){console.warn("wall point: 'e'"),this.selected=!0,$("body").css("cursor","move"),pointJoystick.fire("off"),me.hide(),fe.hide(),this.wall=n,this.wall.collectItems(),this.moving=!0;let i=this.wall;if(this.start_position=copy.point(i.e),"build"===i.label&&0<i.walls_e.length)for(let e=0;e<i.walls_e.length;e++){var s=i.walls_e[0].wall;if("init"===walls.db[s].label)return warning.show("red",l10n.move_impossible),void(this.moving=!1)}if(i.get_linked_walls(),i.get_linked_pillars(),i.get_linked_windows(),i.get_linked_doors(),i.get_moving_limits("E"),"init"===i.label){let t=!1;for(let e=0;e<walls.db.length;e++){var o=walls.db[e];if("build"===o.label){if(is_point_inside_polygon(o.s,i.polygon)){t=!0;break}if(is_point_inside_polygon(o.e,i.polygon)){t=!0;break}}}if(t)return void warning.show("red",l10n.window_break_not_move)}if("build"===i.label)for(let e=0;e<walls.db.length;e++){var l=walls.db[e];if("init"===l.label){var r=are_points_equal(i.e,l.s),l=are_points_equal(i.e,l.e);if(r||l)return warning.show("yellow",l10n.node_not_move),this.selected=!1,void(this.moving=!1)}}let t=[];for(let e=0;e<i.parts_points.length;e++){var a=i.parts_points[e].xy;are_points_equal(i.e,a)||(a=get_distance(i.e,a),t.push({index:e,distance:a}))}t.sort(compare_distance),this.stop_part_point_index=t[0].index,this.start={x:this.cx(),y:this.cy()},this.s=copy_point(i.s),this.e=copy_point(i.e),le(i,i.s,!1),le(i,i.e,!1),selected.wallPoint="e",this.wallsToInit=[];for(let e=0;e<walls.db.length;e++){var h=walls.db[e],g=are_points_equal(i.e,h.s),_=are_points_equal(i.e,h.e);(g||_)&&this.wallsToInit.push(h)}this.stop_points=[];for(let e=0;e<walls.db.length;e++){var d=walls.db[e];are_points_equal(d.s,i.e)||this.stop_points.push(d.s),are_points_equal(d.e,i.e)||this.stop_points.push(d.e)}i.get_adjacent_rooms(),Ae.save()}}).on("dragmove",function(i){if(i.preventDefault(),!0===this.moving){let e=this.wall,t=LIB.pointSVG(i.detail.event.clientX,i.detail.event.clientY);this.delta=get_distance(t,this.start_position),9<this.delta&&(t.x<e.x_min&&(t.x=e.x_min),t.x>e.x_max&&(t.x=e.x_max),t.y<e.y_min&&(t.y=e.y_min),t.y>e.y_max&&(t.y=e.y_max),20<e.length&&(t.x<e.s.x+10&&t.x>e.s.x-10&&(t.x=e.s.x),t.y<e.s.y+10&&t.y>e.s.y-10&&(t.y=e.s.y),i=e.parts_points[this.stop_part_point_index].xy,get_distance(e.s,t)<get_distance(e.s,i)+10&&(t=LIB.pointOnLine(e.s,i,10))),e.e=copy.point(t),e.draw(!0),e.move_linked_walls(e.e),e.move_linked_pillars(),e.move_linked_windows(),e.move_linked_doors(),this.cx(e.e.x).cy(e.e.y),wallControls.fire("dragmove"),e.paint("orange"))}}).on("dragend",function(){if(!0===this.moving){z.crosshairs.clear(),this.selected=!1;let e=this.wall;if(9<this.delta){if(this.walls_to_move)for(let t=0;t<this.walls_to_move.length;t++){var i=this.walls_to_move[t].index;let e=walls.db[i];e.draw(),e.drawConnectedWalls("all")}e.force_connection("e"),e.draw(),e.moveItems(),pillars.draw(),walls.draw(),create_rooms(),v();for(let t=0;t<this.wallsToInit.length;t++){let e=this.wallsToInit[t];e.init()}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.wallItems&&e.moveItems()}items.setParents,project.draw(),project.localSave(),wallControls.fire("dragend"),e.paint("orange")}}}),this.wall.get_orientation(),selected.wallPoint||(selected.wallPoint="c"),"V"!==this.wall.orientation&&"H"!==this.wall.orientation&&("c"===selected.wallPoint&&(selected.wallPoint=null),this.center.hide()),"s"===selected.wallPoint&&this.start.attr(n),"c"===selected.wallPoint&&this.center.attr(n),"e"===selected.wallPoint&&this.end.attr(n),this.wall.paint("orange")}).on("dragmove",function(){this.start.cx(this.wall.s.x).cy(this.wall.s.y),this.center.cx(this.wall.c.x).cy(this.wall.c.y),this.end.cx(this.wall.e.x).cy(this.wall.e.y),"s"!==selected.wallPoint&&"e"!==selected.wallPoint||this.center.hide()}).on("dragend",function(){this.start.cx(this.wall.s.x).cy(this.wall.s.y),this.center.cx(this.wall.c.x).cy(this.wall.c.y),this.end.cx(this.wall.e.x).cy(this.wall.e.y),this.wall.get_orientation(),"V"!==this.wall.orientation&&"H"!==this.wall.orientation?this.center.hide():this.center.show()}).on("off",function(){this.clear(),this.wall=!1}),window.windowControl=(new oe).draggable().hide().on("on",function(){tool="moving",drawing=!1,panning=!1,mode="free";var e=get_object(walls.db,id.wall),t=get_object(windows.db,id.window);e&&t&&(this.wall=e,this.window=t,this.window.DIMENSION.hide(),this.window.paint("orange"),this.untransform(),this.move(this.window.center.x-15,this.window.center.y-15),this.rotate(get_line_angle(this.window)),this.show(),this.wall.get_stops(this.window),this.supportLine={s:LIB.pointOnLine(s_stop,e_stop,-this.window.width/2-1),e:LIB.pointOnLine(e_stop,s_stop,-this.window.width/2-1)})}).on("dragmove",function(e){var t;e.preventDefault(),2<LIB.lineLength(this.supportLine)&&(e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),(t=LIB.projection(e,this.supportLine))?this.window.center=t:((t=LIB.distance(e,this.supportLine.s))<(e=LIB.distance(e,this.supportLine.e))&&(this.window.center=this.supportLine.s),e<t&&(this.window.center=this.supportLine.e)),this.window.draw(),this.wall.init(!1),this.window.paint("orange"),this.untransform(),this.move(this.window.center.x-15,this.window.center.y-15),this.rotate(get_line_angle(this.window)))}).on("dragend",function(){this.wall.init(),this.window.paint("orange"),setTimeout(function(){project.localSave()},1e3)}).on("off",function(){this.hide(),this.window&&this.window.DIMENSION.show()}),window.doorControl=(new oe).draggable().hide().on("on",function(){tool="moving",drawing=!1,panning=!1,mode="free";var e=get_object(walls.db,id.wall),t=get_object(doors.db,id.door);e&&t&&(this.wall=e,this.door=t,this.door.DIMENSION.hide(),this.door.paint("orange"),this.untransform(),this.move(this.door.center.x-15,this.door.center.y-15),this.rotate(get_line_angle(this.door)),this.show(),this.wall.get_stops(this.door),this.supportLine={s:LIB.pointOnLine(s_stop,e_stop,-this.door.width/2-1),e:LIB.pointOnLine(e_stop,s_stop,-this.door.width/2-1)})}).on("dragmove",function(e){var t;e.preventDefault(),2<LIB.lineLength(this.supportLine)&&(e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),(t=LIB.projection(e,this.supportLine))?this.door.center=t:((t=LIB.distance(e,this.supportLine.s))<(e=LIB.distance(e,this.supportLine.e))&&(this.door.center=this.supportLine.s),e<t&&(this.door.center=this.supportLine.e)),this.door.draw(),this.wall.init(!1),this.door.paint("orange"),this.untransform(),this.move(this.door.center.x-15,this.door.center.y-15),this.rotate(get_line_angle(this.door)))}).on("dragend",function(){this.wall.init(),this.door.paint("orange"),setTimeout(function(){project.localSave()},1e3)}).on("off",function(){this.hide(),this.door&&this.door.DIMENSION.show()}),window.pillarControls=serviceLayer.group().hide().on("on",function(e){let i=this;this.clear();var t=get_object(pillars.db,id.pillar);t&&(this.pillar=t,this.offset=24,this.t_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.center0=i.pillar.center,this.width0=i.pillar.width,this.height0=i.pillar.height,this.bp=get_center(i.pillar.p3,i.pillar.p4),this.tp=get_center(i.pillar.p1,i.pillar.p2),this.line=get_big_line(get_line(this.bp,this.tp));var t=get_point_near_line_center(i.pillar.p1,i.pillar.p2,i.offset,"L");this.d0=get_distance(this.bp,t),this.delta=0,this.actions=!1}).on("dragmove",function(e){e.preventDefault();var t,e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),e=LIB.projection(e,this.line);this.delta=get_distance(this.bp,e)-this.d0,3<Math.abs(this.delta)&&(this.actions=!0),this.actions&&(warning.hide(),(t=this.height0+this.delta)<=defs.pillar.min_height||(this.cx(e.x).cy(e.y),i.pillar.height=t,i.pillar.center=LIB.pointOnLine(e,this.bp,-i.pillar.height/2),i.pillar.draw(),i.fire("draw")))}).on("dragend",function(e){this.actions?(i.pillar.fillSpace("t"),i.pillar.draw(),i.fire("draw"),i.pillar.isOver("pillar")&&(console.warn(i),i.pillar.center=copy.point(this.center0),i.pillar.width=this.width0,i.pillar.height=this.height0,i.pillar.draw(),i.fire("draw")),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){walls.draw(),pillars.draw(),create_rooms(),project.localSave(),this.delta=0},1e3)):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.t_sign.add(svg.rect(10,16).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.t_sign.add(svg.path("M1.4,10.4L5,14l3.6-3.6 M8.6,5.6L5,2L1.4,5.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.b_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.center0=i.pillar.center,this.width0=i.pillar.width,this.height0=i.pillar.height,this.bp=get_center(i.pillar.p3,i.pillar.p4),this.tp=get_center(i.pillar.p1,i.pillar.p2),this.line=get_big_line(get_line(this.bp,this.tp));var t=get_point_near_line_center(i.pillar.p3,i.pillar.p4,i.offset,"L");this.d0=get_distance(this.tp,t),this.delta=0,this.actions=!1}).on("dragmove",function(e){e.preventDefault();var t,e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),e=LIB.projection(e,this.line);this.delta=get_distance(this.tp,e)-this.d0,3<Math.abs(this.delta)&&(this.actions=!0),this.actions&&(warning.hide(),(t=this.height0+this.delta)<=defs.pillar.min_height||(this.cx(e.x).cy(e.y),i.pillar.height=t,i.pillar.center=LIB.pointOnLine(e,this.tp,-i.pillar.height/2),i.pillar.draw(),i.fire("draw")))}).on("dragend",function(e){this.actions?(i.pillar.fillSpace("b"),i.pillar.draw(),i.fire("draw"),i.pillar.isOver("pillar")&&(console.warn(i),i.pillar.center=copy.point(this.center0),i.pillar.width=this.width0,i.pillar.height=this.height0,i.pillar.draw(),i.fire("draw")),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){walls.draw(),pillars.draw(),create_rooms(),project.localSave(),this.delta=0},1e3)):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.b_sign.add(svg.rect(10,16).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.b_sign.add(svg.path("M1.4,10.4L5,14l3.6-3.6 M8.6,5.6L5,2L1.4,5.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.l_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.center0=i.pillar.center,this.width0=i.pillar.width,this.height0=i.pillar.height,this.lp=get_center(i.pillar.p4,i.pillar.p1),this.rp=get_center(i.pillar.p2,i.pillar.p3),this.line=get_big_line(get_line(this.lp,this.rp));var t=get_point_near_line_center(i.pillar.p4,i.pillar.p1,i.offset,"L");this.d0=get_distance(this.rp,t),this.delta=0,this.actions=!1}).on("dragmove",function(e){e.preventDefault();var t,e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),e=LIB.projection(e,this.line);this.delta=get_distance(this.rp,e)-this.d0,3<Math.abs(this.delta)&&(this.actions=!0),this.actions&&(warning.hide(),(t=this.width0+this.delta)<=defs.pillar.min_width||(this.cx(e.x).cy(e.y),i.pillar.width=t,i.pillar.center=LIB.pointOnLine(e,this.rp,-i.pillar.width/2),i.pillar.draw(),i.fire("draw")))}).on("dragend",function(e){this.actions?(i.pillar.fillSpace("l"),i.pillar.draw(),i.fire("draw"),i.pillar.isOver("pillar")&&(console.warn(i),i.pillar.center=copy.point(this.center0),i.pillar.width=this.width0,i.pillar.height=this.height0,i.pillar.draw(),i.fire("draw")),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){pillars.draw(),walls.draw(),create_rooms(),project.localSave(),this.delta2=0},1e3)):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.l_sign.add(svg.rect(16,10).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.l_sign.add(svg.path("M5.6,1.4L2,5l3.6,3.6 M10.4,8.6L14,5l-3.6-3.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.r_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.center0=i.pillar.center,this.width0=i.pillar.width,this.height0=i.pillar.height,this.lp=get_center(i.pillar.p4,i.pillar.p1),this.rp=get_center(i.pillar.p2,i.pillar.p3),this.line=get_big_line(get_line(this.lp,this.rp));var t=get_point_near_line_center(i.pillar.p2,i.pillar.p3,i.offset,"L");this.d0=get_distance(this.lp,t),this.delta=0,this.actions=!1}).on("dragmove",function(e){e.preventDefault();var t,e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),e=LIB.projection(e,this.line);this.delta=get_distance(this.lp,e)-this.d0,3<Math.abs(this.delta)&&(this.actions=!0),this.actions&&(warning.hide(),(t=this.width0+this.delta)<=defs.pillar.min_width||(this.cx(e.x).cy(e.y),i.pillar.width=t,i.pillar.center=LIB.pointOnLine(e,this.lp,-i.pillar.width/2),i.pillar.draw(),i.fire("draw")))}).on("dragend",function(e){this.actions?(i.pillar.fillSpace("r"),i.pillar.draw(),i.fire("draw"),i.pillar.isOver("pillar")&&(console.warn(i),i.pillar.center=copy.point(this.center0),i.pillar.width=this.width0,i.pillar.height=this.height0,i.pillar.draw(),i.fire("draw")),window.timer&&clearTimeout(timer),window.timer=setTimeout(function(){walls.draw(),pillars.draw(),create_rooms(),project.localSave(),this.delta=0},1e3)):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.r_sign.add(svg.rect(16,10).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.r_sign.add(svg.path("M5.6,1.4L2,5l3.6,3.6 M10.4,8.6L14,5l-3.6-3.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.fire("draw"),this.show(),item_resizing=!0)}).on("draw",function(){var e=this.pillar,t=get_point_near_line_center(e.p1,e.p2,this.offset,"L"),i=get_point_near_line_center(e.p2,e.p3,this.offset,"L"),n=get_point_near_line_center(e.p3,e.p4,this.offset,"L"),e=get_point_near_line_center(e.p4,e.p1,this.offset,"L");this.t_sign.untransform().cx(t.x).cy(t.y).rotate(this.pillar.angle),this.b_sign.untransform().cx(n.x).cy(n.y).rotate(this.pillar.angle),this.l_sign.untransform().cx(e.x).cy(e.y).rotate(this.pillar.angle+180),this.r_sign.untransform().cx(i.x).cy(i.y).rotate(this.pillar.angle+180)}).on("off",function(){this.clear(),this.pillar&&(this.pillar.selected=!1,this.pillar.draw(),this.pillar=!1),item_resizing=!1}),window.itemControls=serviceLayer.group().on("on",function(e){let s=this,t=e.detail;this.item=e.detail,this.clear(),this.o_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.cursor_before=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY);let t=s.item;e=get_distance(t.op,t.cp),e={x:t.cp.x+e/2,y:t.cp.y};this.angle_before=get_angle(t.op,t.cp,e),this.item_angle_before=t.props.angle,t.op.y<t.cp.y&&(this.angle_before=-this.angle_before),t.op.y>t.cp.y&&(this.angle_before=Math.abs(this.angle_before)),t.findComment(),console.warn("angle_before",this.angle_before)}).on("dragmove",function(t){t.preventDefault();let i=s.item;t=LIB.pointSVG(t.detail.event.clientX,t.detail.event.clientY);if(this.delta=LIB.distance(t,this.cursor_before),3<this.delta){warning.hide();var n=get_distance(t,i.cp),n={x:i.cp.x+n/2,y:i.cp.y};let e=get_angle(t,i.cp,n);t.y<s.item.cp.y&&(e=this.item_angle_before-e-this.angle_before),t.y>s.item.cp.y&&(e=this.item_angle_before+Math.abs(e)-this.angle_before),360<(e=parseFloat(e.toFixed(2)))&&(e-=360),350<=e||0<=e&&e<=10||-10<=e&&e<=0?e=0:80<=e&&e<=100?e=90:-100<=e&&e<=-80?e=-90:170<=e&&e<=190||-190<=e&&e<=-170?e=180:260<=e&&e<=280?e=270:-280<=e&&e<=-260&&(e=-270),i.props.angle=e,i.draw("orange"),i.updateComment(),s.fire("draw")}}).on("dragend",function(e){3<this.delta?(this.item_angle_before!==t.props.angle&&(s.item.props.rotated=!0),0===t.props.angle&&(s.item.props.rotated=!1),s.item.updateComment(),0!==t.props.angle&&(s.item.props.rotated_manually=!0),s.item.draw("orange"),project.localSave()):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.o_sign.add(svg.circle(16).attr({"stroke-width":0,fill:"#ffffff"})),this.o_sign.add(svg.path("M12.2,12.2c-2.3,2.3-6.1,2.3-8.5,0s-2.3-6.1,0-8.5s6.1-2.3,8.5,0C13.3,4.9,14,6.4,14,8h-1.5c0-2.5-2-4.5-4.5-4.5c-2.5,0-4.5,2-4.5,4.5c0,2.5,2,4.5,4.5,4.5c1.2,0,2.3-0.5,3.2-1.3L12.2,12.2z M10.2,8h6l-3,3L10.2,8z").attr({stroke:"crimson","stroke-width":.6,fill:"crimson"})),this.t_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.cursor_before=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY);e=s.item;this.tp_before=e.tp,this.cp_before=e.cp,this.bp_before=e.bp,this.line=get_big_line({s:this.tp_before,e:this.cp_before}),s.dimensions.show(),s.item.findComment()}).on("dragmove",function(t){t.preventDefault();t=LIB.pointSVG(t.detail.event.clientX,t.detail.event.clientY);if(this.delta=LIB.distance(t,this.cursor_before),3<this.delta){warning.hide();t=get_point_projection(t,this.line);let e=s.item;e.model.height_changed=get_distance(t,this.bp_before);var i=e.model.height_changed*e.model.height_k,i=(e.image.height(i),e.h_delta=i-e.model.height_changed,LIB.pointOnLine(this.bp_before,t,e.h_delta)),t=get_center(i,this.bp_before);is_point_exists(t)&&(e.props.center=copy.point(t)),e.draw("orange"),e.updateComment(),s.fire("draw")}}).on("dragend",function(e){s.dimensions.hide(),3<this.delta?(s.item.draw("orange"),s.item.updateComment(),project.localSave()):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.t_sign.add(svg.rect(10,16).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.t_sign.add(svg.path("M1.4,10.4L5,14l3.6-3.6 M8.6,5.6L5,2L1.4,5.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.b_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.cursor_before=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY);e=s.item;this.tp_before=e.tp,this.cp_before=e.cp,this.bp_before=e.bp,this.tp0_before=LIB.pointOnLine(e.bp,e.tp,e.h_delta),this.line=get_big_line({s:this.tp_before,e:this.cp_before}),s.dimensions.show(),s.item.findComment()}).on("dragmove",function(t){t.preventDefault();t=LIB.pointSVG(t.detail.event.clientX,t.detail.event.clientY);if(this.delta=LIB.distance(t,this.cursor_before),3<this.delta){warning.hide();t=get_point_projection(t,this.line);let e=s.item;e.model.height_changed=get_distance(t,this.tp_before);var i=e.model.height_changed*e.model.height_k,i=(e.image.height(i),e.h_delta=i-e.model.height_changed,get_center(t,this.tp0_before));is_point_exists(i)&&(e.props.center=copy.point(i)),e.draw("orange"),e.updateComment(),s.fire("draw")}}).on("dragend",function(e){s.dimensions.hide(),3<this.delta?(s.item.draw("orange"),s.item.updateComment(),project.localSave()):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.b_sign.add(svg.rect(10,16).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.b_sign.add(svg.path("M1.4,10.4L5,14l3.6-3.6 M8.6,5.6L5,2L1.4,5.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.l_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.cursor_before=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.lp_before=s.item.lp,this.cp_before=s.item.cp,this.rp_before=s.item.rp,this.line=get_big_line({s:this.lp_before,e:this.cp_before}),s.dimensions.show(),s.item.findComment()}).on("dragmove",function(t){t.preventDefault();t=LIB.pointSVG(t.detail.event.clientX,t.detail.event.clientY);if(this.delta=LIB.distance(t,this.cursor_before),3<this.delta){warning.hide();t=get_point_projection(t,this.line);let e=s.item;e.model.width_changed=get_distance(t,this.rp_before);var i=e.model.width_changed*e.model.width_k,n=e.model.height_changed*e.model.height_k-e.model.height_changed,i=(e.image.width(i),e.image.untransform(),get_point_near_line_center(t,this.rp_before,n/2,"L"));is_point_exists(i)&&(e.props.center=copy.point(i)),e.draw("orange"),e.updateComment(),s.fire("draw")}}).on("dragend",function(e){s.dimensions.hide(),3<this.delta?(s.item.draw("orange"),s.item.updateComment(),project.localSave()):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.l_sign.add(svg.rect(16,10).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.l_sign.add(svg.path("M5.6,1.4L2,5l3.6,3.6 M10.4,8.6L14,5l-3.6-3.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.r_sign=this.group().attr({cursor:"pointer"}).draggable().on("dragstart",function(e){this.cursor_before=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.rp_before=s.item.rp,this.cp_before=s.item.cp,this.lp_before=s.item.lp,this.line=get_big_line({s:this.rp_before,e:this.cp_before}),s.dimensions.show(),s.item.findComment()}).on("dragmove",function(t){t.preventDefault();t=LIB.pointSVG(t.detail.event.clientX,t.detail.event.clientY);if(this.delta=LIB.distance(t,this.cursor_before),3<this.delta){warning.hide();t=get_point_projection(t,this.line);let e=s.item;e.model.width_changed=get_distance(t,this.lp_before);var i=e.model.width_changed*e.model.width_k,n=e.model.height_changed*e.model.height_k-e.model.height_changed,i=(e.image.width(i),e.image.untransform(),get_point_near_line_center(this.lp_before,t,n/2,"L"));is_point_exists(i)&&(e.props.center=copy.point(i)),e.draw("orange"),e.updateComment(),s.fire("draw")}}).on("dragend",function(e){s.dimensions.hide(),3<this.delta?(s.item.draw("orange"),s.item.updateComment(),project.localSave()):warning.show("yellow",l10n.move_slider_clamp_left_button)}),this.r_sign.add(svg.rect(16,10).radius(2).attr({"stroke-width":0,fill:"#ffffff"})),this.r_sign.add(svg.path("M5.6,1.4L2,5l3.6,3.6 M10.4,8.6L14,5l-3.6-3.6").attr({stroke:"crimson","stroke-width":2,"stroke-linecap":"round",fill:"none"})),this.dimensions=serviceLayer.group().hide(),this.bg=this.dimensions.rect(70,20).radius(2).attr({stroke:"#000000","stroke-width":.2,fill:"#fcf8e3"}),this.text=this.dimensions.plain("").font({family:"Arial",size:9,stroke:"#161616","stroke-width":.4,fill:"#161616"}),this.activated=!0,item_resizing=!0,this.fire("draw"),this.show()}).on("draw",function(){let e=this.item;var t=parseInt(e.model.width_changed),i=parseInt(e.model.height_changed),n=(e.props.width=t,e.props.height=i,e.props.angle),s=e.cp,o=e.tp,l=e.bp,r=e.rp,a=e.lp,h=e.op;this.t_sign.untransform(),this.b_sign.untransform(),this.l_sign.untransform(),this.r_sign.untransform(),this.o_sign.untransform(),"wall"===e.model.anchor&&this.o_sign.hide(),this.t_sign.cx(o.x).cy(o.y).rotate(n),this.b_sign.cx(l.x).cy(l.y).rotate(n),this.l_sign.cx(a.x).cy(a.y).rotate(n),this.r_sign.cx(r.x).cy(r.y).rotate(n),this.o_sign.cx(h.x).cy(h.y),this.bg.cx(s.x).cy(s.y),this.text.plain("Ш: "+t+", Г: "+i).cx(s.x).cy(s.y)}).on("off",function(){this.activated=!1,item_resizing=!1,this.clear()}),window.freelineControl=serviceLayer.circle(10).attr({stroke:"orange","stroke-width":1.4,fill:"#fafafa"}).draggable().hide().on("on",function(e){if(!this.activated){this.activated=!0,this.center=e.detail.center,this.freelines=[];for(let t=0;t<freelines.db.length;t++){let e=freelines.db[t];selected.freeline&&e.id===selected.freeline.id||e.plan===plan&&(are_points_equal(this.center,e.s)&&(this.freelines.push({freeline:e,end:"s",end2:"e"}),e.paint("orange")),are_points_equal(this.center,e.e)&&(this.freelines.push({freeline:e,end:"e",end2:"s"}),e.paint("orange")))}this.cx(this.center.x),this.cy(this.center.y),this.show()}}).on("dragstart",function(e){this.selected=!0}).on("dragmove",function(e){e.preventDefault(),this.cx(mouse.end.x),this.cy(mouse.end.y);for(let t=0;t<this.freelines.length;t++){let e=this.freelines[t].freeline;var i=this.freelines[t].end;e&&i&&(e[i]=copy.point(mouse.end),e.update(),e.paint("orange"))}}).on("dragend",function(e){this.selected=!1}).on("off",function(e){if(!this.selected){if(this.hide(),this.freelines){for(let t=0;t<this.freelines.length;t++){let e=this.freelines[t].freeline;e.update(),e.paint()}this.freelines=[],delete this.freelines}this.activated=!1}}),window.freelineControlS=serviceLayer.circle(8).attr({stroke:"green","stroke-width":1.4,fill:"transparent"}).hide().on("on",function(e){this.cx(e.detail.center.x),this.cy(e.detail.center.y),this.show()}).on("off",function(e){this.animate(150).attr({r:0}).after(function(){this.attr({r:4}),this.hide()})}),window.freelineControlE=serviceLayer.circle(8).attr({stroke:"green","stroke-width":1.4,fill:"transparent"}).hide().on("on",function(e){this.activated=!0,this.cx(e.detail.center.x),this.cy(e.detail.center.y),this.show()}).on("off",function(e){delete this.activated,this.animate(150).attr({r:0}).after(function(){this.attr({r:4}),this.hide()})}),signs={align_outer_line:svg.line().attr({stroke:"#dc143c","stroke-width":.8,"stroke-dasharray":4}).hide(),align_inner_line:svg.line().attr({stroke:"#dc143c","stroke-width":.8,"stroke-dasharray":4}).hide(),align_outer_a:(new he).on("mousedown",function(){let e=get_object(walls.db,id.wall);e&&(e.inner_depth=e.depth/2,e.outer_depth=e.depth/2,e.redraw(),e.aligned="center",e.dimensions.show(),signs.reset(),project.draw(),project.localSave())}).hide(),align_outer_b:(new he).on("mousedown",function(){let e=get_object(walls.db,id.wall);e&&(8===e.depth&&(e.inner_depth=3,e.outer_depth=5),10<=e.depth&&(e.inner_depth=5,e.outer_depth=e.depth-e.inner_depth),e.redraw(),e.aligned="L",e.dimensions.show(),signs.reset(),project.draw(),project.localSave())}).hide(),align_center:svg.circle(12).attr({stroke:colors.crimson,"stroke-width":1.4,fill:"#ffb2c1"}).on("mousedown",function(){let e=get_object(walls.db,id.wall);e&&(e.inner_depth=e.depth/2,e.outer_depth=e.depth/2,e.redraw(),e.aligned="center",e.dimensions.show(),signs.reset(),project.draw(),project.localSave())}).hide(),align_inner_a:(new he).on("mousedown",function(){let e=get_object(walls.db,id.wall);e&&(e.inner_depth=e.depth/2,e.outer_depth=e.depth/2,e.redraw(),e.aligned="center",e.dimensions.show(),signs.reset(),project.draw(),project.localSave())}).hide(),align_inner_b:(new he).on("mousedown",function(){let e=get_object(walls.db,id.wall);e&&(8===e.depth&&(e.inner_depth=5,e.outer_depth=3),10<=e.depth&&(e.outer_depth=(defs.wall.min_depth+2)/2,e.inner_depth=e.depth-e.outer_depth),e.redraw(),e.aligned="R",e.dimensions.show(),signs.reset(),project.draw(),project.localSave())}).hide(),reset:function(){this.align_outer_line.hide(),this.align_inner_line.hide(),this.align_outer_a.hide(),this.align_outer_b.hide(),this.align_center.hide(),this.align_inner_a.hide(),this.align_inner_b.hide()}},{diagonal1:{}}),z={stop:layers.upper.path("M8,0C3.6,0,0,3.6,0,8s3.6,8,8,8s8-3.6,8-8S12.4,0,8,0z M1.9,8c0-3.4,2.7-6.1,6.1-6.1c1.3,0,2.5,0.4,3.5,1.1L8,6.6l-5,5C2.3,10.5,1.9,9.3,1.9,8z M8,14.1c-1.3,0-2.5-0.4-3.5-1.1L13,4.5c0.7,1,1.1,2.3,1.1,3.5C14.1,11.4,11.4,14.1,8,14.1z").attr({stroke:"crimson","stroke-width":1.2,fill:"crimson"}).on("contextmenu",function(){this.hide()}),magnet:svg.circle(8).attr({"stroke-width":2,stroke:"#777777",fill:"none"}).hide(),lock:svg.path("M5.2,3V2.1C5.2,1,4.2,0,3,0S0.8,1,0.8,2.1V3C0.4,3.1,0,3.5,0,4v2.9C0,7.5,0.4,8,1,8h4c0.5,0,1-0.5,1-1.1V4C6,3.5,5.6,3.1,5.2,3z M1.1,2.1c0-1,0.9-1.9,1.9-1.9s1.9,0.8,1.9,1.9V3H1.1V2.1z M5.7,6.9c0,0.4-0.3,0.8-0.7,0.8H1c-0.4,0-0.7-0.3-0.7-0.8V4c0-0.4,0.3-0.8,0.7-0.8h4c0.4,0,0.7,0.3,0.7,0.8V6.9zM3,4.1c-0.3,0-0.5,0.3-0.5,0.6v0.9C2.5,6,2.7,6.2,3,6.2S3.5,6,3.5,5.6V4.7C3.5,4.4,3.3,4.1,3,4.1z M3.3,5.6c0,0.2-0.1,0.3-0.3,0.3c-0.2,0-0.3-0.1-0.3-0.3V4.7c0-0.2,0.1-0.3,0.3-0.3c0.2,0,0.3,0.1,0.3,0.3V5.6z").attr({stroke:"#000000","stroke-width":.6,opacity:.8}).hide(),lock_line:svg.line().attr({stroke:"#dc143c","stroke-width":1,"stroke-dasharray":4,opacity:.6}).hide(),crosshair:serviceLayer.group(),crosshairs:serviceLayer.group(),magnet_value_a:serviceLayer.group(),magnet_value_b:serviceLayer.group(),reset:function(){this.stop.hide(),this.crosshairs.clear(),this.magnet.hide(),this.lock.animate(100).attr({opacity:0}).after(function(){this.hide(),this.attr({opacity:1})}),this.lock_line.animate(100).attr({opacity:0}).after(function(){this.hide(),this.attr({opacity:.8})})}};arrow={wall:null,point_type:null,image:svg.polygon().attr({fill:"#dc143c"}).hide(),update:function(){let e,t;"s"===this.point_type&&(e=walls.db[this.wall].e,t=walls.db[this.wall].s),"e"===this.point_type&&(e=walls.db[this.wall].s,t=walls.db[this.wall].e);var i=LIB.pointOnLine(e,t,-6),n=LIB.pointOnLine(e,t,8),s=point_near_line_end_point(e,i,4,"R"),o=LIB.pointOnLine(e,t,-4),i=point_near_line_end_point(e,i,4,"L");this.image.plot([[n.x,n.y],[s.x,s.y],[o.x,o.y],[i.x,i.y]])},show:function(){this.image.show()},hide:function(){this.image.hide()}};var we={stroke:"red","stroke-width":.6,"stroke-dasharray":4};let me=svg.line().attr(we).front().hide(),fe=svg.line().attr(we).front().hide(),Ie;window.create_comment=function(e){console.warn("create_comment"),comments.db.push(new Comment({s:e,text:"...",label:"free",plan:plan}));var e=comments.db[comments.db.length-1],t=(selected.comment=objectIndexById(comments.db,e.id),get_screen_point(e.center));showContextmenu("#comment_contextmenu",t.x,t.y,canvas.position().top),$("#comment_input").val("").focus(),open_color_wrapper("#comment_contextmenu",e.color)};let Ce={start:null,end:null},O,ye=!1,be=!1;function ve(e){LIB.point(e.clientX,e.clientY,"svg");index.room=null,index.warm_floor=null;for(let e=0;e<rooms2.data.length;e++){var t=rooms2.data[e];if(is_point_inside_polygon(mouse.start,t.points)){index.room=e;break}}if(null!==index.room){var i=rooms2.data[index.room];for(let e=0;e<i.warm_floors.length;e++)if(is_point_inside_polygon(mouse.start,i.warm_floors[e].polygon)){index.warm_floor=e;break}}}function xe(){allow.draw=!1;let n;if(index.room&&rooms2.data[index.room]?n=rooms2.data[index.room]:(mouse.over.search("room"),null!==mouse.over.room&&rooms2.data[mouse.over.room]&&(n=rooms2.data[mouse.over.room])),!n||!n.warm_floors)return index.room=null,index.warm_floor=null,void(S.warm_floor=null);let s=n.warm_floors[S.warm_floor];for(let i=0;i<n.warm_floors.length;i++){var o=n.warm_floors[i];if(o.id!==s.id){var l=is_point_inside_polygon(s.s,o.polygon),r=is_point_inside_polygon(s.s2,o.polygon),a=is_point_inside_polygon(s.e,o.polygon),h=is_point_inside_polygon(s.e2,o.polygon);if(l||r||a||h){let e=[],t=(e.push(s.s.x,s.s2.x,s.e.x,s.e2.x),e.push(o.s.x,o.s2.x,o.e.x,o.e2.x),[]);t.push(s.s.y,s.s2.y,s.e.y,s.e2.y),t.push(o.s.y,o.s2.y,o.e.y,o.e2.y);l=Math.min.apply(null,e),r=Math.max.apply(null,e),a=Math.min.apply(null,t),h=Math.max.apply(null,t);s.s={x:l,y:a},s.e={x:r,y:h},cabling_warm_floor.delete_lines(get_warm_floor(o.id)),n.warm_floors.splice(i,1),n.draw()}}}for(let e=0;e<n.warm_floors.length;e++){var t,i,g,_,d=n.warm_floors[e];e!==S.warm_floor&&(t=is_point_inside_polygon(d.s,s.polygon),i=is_point_inside_polygon(d.s2,s.polygon),g=is_point_inside_polygon(d.e,s.polygon),_=is_point_inside_polygon(d.e2,s.polygon),t&&i&&g&&_&&(console.warn("delete"),cabling_warm_floor.delete_lines(get_warm_floor(d.id)),n.warm_floors.splice(e,1),e--,n.draw()))}s.height<30&&(warning.show("red",l10n.warm_floor_length_less.replace("[x]","30 см")),S.warm_floor&&(n.warm_floors.splice(S.warm_floor,1),n.draw()),project.localSave()),s.width<30&&(warning.show("red",l10n.warm_floor_width_less.replace("[x]","30 см")),S.warm_floor&&(n.warm_floors.splice(S.warm_floor,1),n.draw()),project.localSave()),index.room=null,index.warm_floor=null,S.warm_floor=null}let Y=!(window.get_borders_links=function(){function t(t,i){i.link_s=!1,i.link_e=!1,i.on_line_s=!1,i.on_line_e=!1;for(let e=0;e<t.length;e++){var n=t[e],s=are_points_equal(i.s,n.s),o=are_points_equal(i.e,n.e),l=is_line_on_line(i,n);s&&o||(s&&(i.link_s=!0,l&&(i.on_line_s=!0)),are_points_equal(i.s,n.e)&&(i.link_s=!0,l&&(i.on_line_s=!0)),are_points_equal(i.e,n.s)&&(i.link_e=!0,l&&(i.on_line_e=!0)),o&&(i.link_e=!0,l&&(i.on_line_e=!0)))}return i}let i=[];for(let e=0;e<walls.db.length;e++){var n=walls.db[e];if("init"===plan){if("init_copy"===n.label)continue;if("build"===n.label)continue}if("build"===plan){if("init_copy"===n.label)continue;if("break"===n.label)continue}for(let e=0;e<n.borders.o.length;e++){var s=n.borders.o[e];i.push(s)}for(let e=0;e<n.borders.i.length;e++){var o=n.borders.i[e];i.push(o)}}for(let e=0;e<walls.db.length;e++){var l=walls.db[e];for(let e=0;e<l.borders.o.length;e++){var r=l.borders.o[e];t(i,r)}for(let e=0;e<l.borders.i.length;e++){var a=l.borders.i[e];t(i,a)}}}),Be=!1,T=!1,ke=!1,Le=!1;function Ee(e,t,i){let n=svg.group(),s="#000000",o=.2;"#ffffff"===i&&(s="none",o=0);var l={1:10,2:14,3:18}[t.toString().length||3]||22;n.add(svg.rect(l,12).radius(2).attr({stroke:s,"stroke-width":o,fill:i,opacity:.9}).cx(e.x).cy(e.y));let r=8;return"big"===project.font&&(r=12),n.add(svg.plain(t.toString()).attr({x:e.x,y:e.y}).font({family:"Arial",size:r,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(e.x).cy(e.y)),n}function We(e,t,i,n,s){s=s||8;var o={stroke:"#000000","stroke-width":.4};let l,r,a,h,g=svg.group();"line"===i&&(l=point_near_line_end(t,e,0,"R"),a=point_near_line_end(e,t,0,"L"),g.add(svg.line(l.x,l.y,a.x,a.y).attr(o))),"L"===i&&(l=point_near_line_end(t,e,s,"R"),a=point_near_line_end(e,t,s,"L"),r=point_near_line_end(t,e,s+4,"R"),h=point_near_line_end(e,t,s+4,"L")),"R"===i&&(l=point_near_line_end(t,e,s,"L"),a=point_near_line_end(e,t,s,"R"),r=point_near_line_end(t,e,s+4,"L"),h=point_near_line_end(e,t,s+4,"R")),"L"!==i&&"R"!==i||(g.add(svg.line(l.x,l.y,a.x,a.y).attr(o)),g.add(svg.line(e.x,e.y,r.x,r.y).attr(o)),g.add(svg.line(t.x,t.y,h.x,h.y).attr(o)));s={s:point_near_line_end(a,l,3,"L"),e:point_near_line_end(a,l,3,"R")},g.add(svg.line(s.s.x,s.s.y,s.e.x,s.e.y).attr(o).rotate(45)),i={s:point_near_line_end(l,a,3,"L"),e:point_near_line_end(l,a,3,"R")},g.add(svg.line(i.s.x,i.s.y,i.e.x,i.e.y).attr(o).rotate(45)),s=get_center(l,a),i=new Ee(s,Math.round(get_distance(e,t)),n);return{lines:g,size:i}}svg.on("mousemove",function(i){if("drawing"===mode&&("wall"===tool||"balcony"===tool)){let e=i.pageX,t=i.pageY;var i=svg.viewbox(),n=canvas.width()-100,s=canvas.offset().top+100,o=canvas.offset().top+canvas.height()-100;e<100&&(svg.viewbox(i.x-4,i.y,i.width,i.height),grid.update()),e>n&&(svg.viewbox(i.x+4,i.y,i.width,i.height),grid.update()),t<s&&(svg.viewbox(i.x,i.y-4,i.width,i.height),grid.update()),t>o&&(svg.viewbox(i.x,i.y+4,i.width,i.height),grid.update())}}),svg.on("mousedown",function(e){if(!Z){3===e.which&&(N.tool=tool,N.tool_group=tool_group,pillarGuidlines.fire("off")),N.viewbox=svg.viewbox(),a_line.fire("hide"),o_sign.fire("hide"),s_size.fire("hide"),e_size.fire("hide"),s_size_2.fire("hide"),e_size_2.fire("hide"),break_line.hide(),1===e.which&&("window"===tool&&null===S.window&&warning.show("yellow",l10n.window_install_up_wall),"windoor"===tool&&null===S.window&&warning.show("yellow",l10n.windoor_install_up_wall),!1===cursors.door.overDoor&&("doorway"===tool&&null===S.door&&("init"===plan&&warning.show("yellow",l10n.doorway_install_up_wall),"build"===plan&&warning.show("yellow",l10n.doorway_install_up_wall_sector)),"door"!==tool&&"door_double"!==tool&&"door_coupe"!==tool&&"door_penal"!==tool||null!==S.door||("init"===plan&&warning.show("yellow",l10n.door_install_up_wall),"build"===plan&&warning.show("yellow",l10n.door_install_up_wall_sector))));var t={x:e.clientX,y:e.clientY};if(mouse.start=copy_point(get_svg_point(t)),mouse.end=copy_point(get_svg_point(t)),1===e.which){if("none"!==tool){if(mode="drawing",drawing=!0,panning=!1,"none"===tool||"wall"===tool||"balcony"===tool)for(let e=0;e<sectors.db.length;e++){var i=sectors.db[e];is_point_inside_polygon(mouse.start,i.polygon)&&(i.like_wall,i.like_wall)}if("comment"===tool){var n=LIB.point(e.clientX,e.clientY,"svg");let i=!0;for(let t=0;t<items.db.length;t++){let e=items.db[t];var s=[e.p1,e.p2,e.p3,e.p4];if(e.isAvailable()&&LIB.isPointInsidePolygon(n,s)){i=!1;break}}i&&(id.reset(),$(".contextmenu").hide(),$("#comments").removeClass("active"),$("body").css("cursor","default"),i.pan=!1,create_comment(n))}if("ruler"===tool&&$("body").css("cursor","crosshair"),"none"!==tool){if("moving"!==tool&&signs.reset(),N.collect_wall_points(),mouse.delta=null,mouse.down.search(e),null!==mouse.down.over_pillar)return void warning.show("yellow",l10n.wall_install_from_pillar);if(null!==mouse.down.wall&&(mouse.start=copy.point(mouse.down.point)),null===mouse.down.point&&(null!==mouse.down.free_point?mouse.start=mouse.down.free_point:mouse.start=get_svg_point({x:e.clientX,y:e.clientY})),"wall"!==tool&&"balcony"!==tool||(sCircle.cx(mouse.start.x).cy(mouse.start.y).show().front(),null!==mouse.down.wall&&sCircle.fill("#ffb2c1"),"pillar"===mouse.down.object&&(mouse.start=LIB.projection(mouse.down.point,mouse.down.edge),sCircle.cx(mouse.down.point.x).cy(mouse.down.point.y))),"delimiter"===tool){var t=zoneDelimiter.S.edge===zoneDelimiter.E.edge,o=null===zoneDelimiter.S.room;if(t||o)return void warning.show("yellow",l10n.delimiter_install_in_room);null!==zoneDelimiter.S.room&&(t=LIB.point(zoneDelimiter.S.cx(),zoneDelimiter.S.cy()),zoneDelimiter.E.cx(t.x).cy(t.y).show(),zoneDelimiter.LINE.plot(t.x,t.y,t.x,t.y).show())}if("break_part"===tool&&(null!==mouse.down.wall&&"init"===(o=walls.db[mouse.down.wall]).label&&"wall"===o.role&&(allow.sector=!0),!0===allow.sector&&(O=copy.line(mouse.down.axis),walls.db[mouse.down.wall],null!==mouse.down.sector&&(t=sectors.db[mouse.down.sector],o=get_point_projection(mouse.start,t.axis),z.stop.cx(o.x),z.stop.cy(o.y),z.stop.show()))),"break"===tool){let t=null;for(let e=0;e<walls.db.length;e++){var l=walls.db[e];if("init"===l.label&&"wall"===l.role&&is_point_over_polygon(mouse.start,l.polygon)){t=e;break}}if(null!==t){let i=walls.db[t];for(let t=0;t<sectors.db.length;t++){let e=sectors.db[t];is_point_over_polygon(get_center(e.s,e.e),i.polygon)&&(e.erase(),sectors.db.splice(t,1),t--)}i.label="break",i.init();for(let t=0;t<windows.db.length;t++){let e=windows.db[t];is_point_inside_polygon(get_center(e.s,e.e),i.polygon)&&(e.demount=!0,e.draw())}for(let t=0;t<doors.db.length;t++){let e=doors.db[t];"init"===e.plan&&is_point_inside_polygon(get_center(e.s,e.e),i.polygon)&&(e.demount=!0,e.draw(),e.delete_rooms2())}i.delete_rooms2();for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.demount&&e.draw()}i.draw(),project.localSave()}}if("warm_floor"===tool&&ve(e),"ai_wall"===tool||"ai_balcony"===tool){if("ai_wall"===tool&&(K.label="wall"),"ai_balcony"===tool&&(K.label="balcony"),mouse.start=get_svg_point({x:e.clientX,y:e.clientY}),mouse.start_position=null,allow.handline_magnet)for(let e=0;e<handlines.db.length;e++){var r=handlines.db[e];get_distance(mouse.start,r.s)<4&&(mouse.start.x=r.s.x,mouse.start.y=r.s.y,mouse.start_handline=e,mouse.start_position="s"),get_distance(mouse.start,r.e)<4&&(mouse.start.x=r.e.x,mouse.start.y=r.e.y,mouse.start_handline=e,mouse.start_position="e")}z.lock.animate(100).attr({opacity:0}).after(function(){this.hide(),this.attr({opacity:1})})}allow.draw=!0,allow.pan=!1}"led_strip"===tool&&null===mouse.over.room&&warning.show("yellow",l10n.led_strip_install_in_room),"freeline"===tool&&freelines.add_new_line(),manager_lining.svg_mousedown()}"none"===tool&&(mode="panning")}3===e.which&&(ne.fire("remove"),a_line.fire("hide"),$(".options_preset").hide(),$(".tools_item.active").removeClass("active"),$(".footer_bar_tool").removeClass("active"),panning=!0,drawing=!1,tool="none",tool_group="none",z.crosshair.clear(),z.crosshairs.clear(),cursors.hide(),allow.draw=!1,allow.pan=!0,temporary_wire__s_item=null,temporary_wire__e_item=null,zoneDelimiter.fire("off")),allow.magnet_before||(allow.magnet_before=allow.magnet),svg.zoom(),svg.zoom(),3===e.which&&null!==S.window&&(windows.db[S.window].delete(),S.window=null),3===e.which&&null!==S.door&&(doors.db[S.door].delete(),S.door=null),Ce.start={x:e.clientX,y:e.clientY}}}),svg.on("mousemove",function(t){let e=!1;if("remove_plaster"===tool&&(e=!0),"sockets"===tool_group&&(e=!0),"furniture"===tool_group&&(e=!0),"floor_elements"===tool_group&&(e=!0),"ceiling_elements"===tool_group&&(e=!0),e="wall_elements"===tool_group?!0:e){let e=!1;t.clientX<x&&(e=!0),t.clientX>k&&(e=!0),t.clientY<B&&(e=!0),(e=t.clientY>L?!0:e)&&!cursors.own.hidden&&(console.log("hide cursor"),$("body").css("cursor","default"),cursors.own.activated&&(cursors.own.fire("hide"),cursors.own.hidden=!0)),!e&&cursors.own.hidden&&(console.log("show cursor"),$("body").css("cursor","none"),cursors.own.activated&&(cursors.own.fire("show"),cursors.own.hidden=!1))}drawing||panning||("comment"===tool&&$("body").css("cursor","crosshair"),"eraser"===tool&&customCursor.fire("move",t))}),svg.on("mousemove",function(t){var n={x:t.clientX,y:t.clientY};if(q=n,mouse.end=copy.point(get_svg_point(n)),"free"===mode){if(o_sign.fire("hide"),s_size.fire("hide"),e_size.fire("hide"),s_size_2.fire("hide"),e_size_2.fire("hide"),$("#cursor_coords").html("x: "+mouse.end.x.toFixed()+" y: "+mouse.end.y.toFixed()),"wall"!==tool&&"balcony"!==tool||null===mouse.down.over_wall&&null===mouse.down.over_pillar&&(l=(n=svg.viewbox()).x+43,c=n.x+n.width-40,f=n.y+40,n=n.y+n.height-80,mouse.end.x>l&&mouse.end.x<c&&mouse.end.y>f&&mouse.end.y<n&&o_sign.fire("show",{center:mouse.end,active:!1})),"wall"!==tool&&"balcony"!==tool&&"break_part"!==tool||mouse.down.search(t),"delimiter"===tool){var e=LIB.point(t.clientX,t.clientY,"svg");zoneDelimiter.S.attr({r:4,stroke:"crimson",fill:"#fafafa"}).cx(e.x).cy(e.y).show(),zoneDelimiter.S.room=null,zoneDelimiter.S.edge=null;for(let l=0;l<rooms2.data.length;l++){var i=rooms2.data[l];if(is_point_inside_polygon(e,i.polygon))for(let o=0;o<i.edges.length;o++){var r=i.edges[o];if(!r.inside_room||!0!==r.inside_room){let s=LIB.projection(e,r);var a=get_point_place(e,r);if(a===r.room_side)if(s)if(get_distance(e,s)<=20){var a=get_distance(s,r.s),h=get_distance(s,r.e);a<3&&(s=copy.point(r.s)),h<3&&(s=copy.point(r.e)),zoneDelimiter.S.attr({r:6,stroke:"green",fill:"#d4f9d4"}).cx(s.x).cy(s.y),zoneDelimiter.S.room=l,zoneDelimiter.S.edge=o;let e=LIB.pointOnLine(r.e,s,24),t=LIB.pointOnLine(r.s,s,24),i=(a<3&&(e=LIB.pointOnLine(r.e,r.s,24),t=LIB.pointOnLine(r.e,r.s,-24)),h<3&&(t=LIB.pointOnLine(r.s,r.e,24),e=LIB.pointOnLine(r.s,r.e,-24)),get_distance(r.s,s)),n=get_distance(r.e,s);s_size.fire("show",{center:e,length:i.toFixed()}),e_size.fire("show",{center:t,length:n.toFixed()})}}}}}if("none"===tool){freelineControl.fire("off");for(let e=0;e<freelines.db.length;e++){var s=freelines.db[e];s.plan===plan&&(get_distance(mouse.end,s.s)<4&&freelineControl.fire("on",{center:s.s}),get_distance(mouse.end,s.e)<4&&freelineControl.fire("on",{center:s.e}))}}if("freeline"===tool){freelineControlS.hide();for(let e=0;e<freelines.db.length;e++){var o=freelines.db[e];o.plan===plan&&(get_distance(mouse.end,o.s)<4&&freelineControlS.fire("on",{center:o.s}),get_distance(mouse.end,o.e)<4&&freelineControlS.fire("on",{center:o.e}))}}}if(allow.draw){if(sCircle.hide(),mouse.delta=get_distance(mouse.start,mouse.end),"delimiter"===tool&&(s_size.fire("hide"),e_size.fire("hide"),null!==zoneDelimiter.S.room)){var l=LIB.point(zoneDelimiter.S.cx(),zoneDelimiter.S.cy());let e=LIB.point(t.clientX,t.clientY,"svg");Math.abs(e.x-l.x)<10&&(e.x=l.x),Math.abs(e.y-l.y)<10&&(e.y=l.y),zoneDelimiter.E.attr({r:4,stroke:"crimson",fill:"#fafafa"}).cx(e.x).cy(e.y),zoneDelimiter.E.room=null,zoneDelimiter.E.edge=null;var g=rooms2.data[zoneDelimiter.S.room];for(let o=0;o<g.edges.length;o++)if(o!==zoneDelimiter.S.edge){var _=g.edges[o];if(!_.inside_room||!0!==_.inside_room){let s=LIB.projection(e,_);if(s)if(get_distance(e,s)<=20){var d=get_distance(s,_.s),p=get_distance(s,_.e);d<3&&(s=copy.point(_.s)),p<3&&(s=copy.point(_.e)),zoneDelimiter.E.attr({r:6,stroke:"green",fill:"#d4f9d4"}).cx(s.x).cy(s.y),zoneDelimiter.E.room=zoneDelimiter.S.room,zoneDelimiter.E.edge=o;let e=LIB.pointOnLine(_.e,s,24),t=LIB.pointOnLine(_.s,s,24),i=(d<3&&(e=LIB.pointOnLine(_.e,_.s,24),t=LIB.pointOnLine(_.e,_.s,-24)),p<3&&(t=LIB.pointOnLine(_.s,_.e,24),e=LIB.pointOnLine(_.s,_.e,-24)),get_distance(_.s,s)),n=get_distance(_.e,s);s_size.fire("show",{center:e,length:i.toFixed()}),e_size.fire("show",{center:t,length:n.toFixed()})}}}var c=LIB.point(zoneDelimiter.E.cx(),zoneDelimiter.E.cy());zoneDelimiter.LINE.plot(l.x,l.y,c.x,c.y)}if(("ai_wall"===tool||"ai_balcony"===tool)&&(null===S.handline&&(handlines.db.push(new V({s:mouse.start,e:mouse.end,label:K.label})),S.handline=handlines.db.length-1),null!==S.handline)){z.lock.hide(),z.lock_line.hide();let t=handlines.db[S.handline];allow.handline_magnet&&(mouse.end.x<mouse.start.x+4&&mouse.end.x>mouse.start.x-4&&(mouse.end.x=mouse.start.x),mouse.end.y<mouse.start.y+4&&mouse.end.y>mouse.start.y-4&&(mouse.end.y=mouse.start.y));for(let e=0;e<handlines.db.length;e++){var A,u=handlines.db[e];t.id!==u.id&&t.label===u.label&&(allow.handline_magnet&&(get_distance(mouse.end,u.s)<4&&(mouse.end.x=u.s.x,mouse.end.y=u.s.y,z.lock.move(u.s.x-9,u.s.y-11).show()),get_distance(mouse.end,u.e)<4&&(mouse.end.x=u.e.x,mouse.end.y=u.e.y,z.lock.move(u.e.x-9,u.e.y-11).show())),mouse.start_handline!==e&&(A=mouse.end.x===t.s.x,mouse.end.y===t.s.y&&(Math.abs(mouse.end.x-u.s.x)<4&&(mouse.end.x=u.s.x,z.lock_line.plot(mouse.end.x,mouse.end.y,u.s.x,u.s.y).show()),Math.abs(mouse.end.x-u.e.x)<4&&(mouse.end.x=u.e.x,z.lock_line.plot(mouse.end.x,mouse.end.y,u.e.x,u.e.y).show())),A&&(Math.abs(mouse.end.y-u.s.y)<4&&(mouse.end.y=u.s.y,z.lock_line.plot(mouse.end.x,mouse.end.y,u.s.x,u.s.y).show()),Math.abs(mouse.end.y-u.e.y)<4&&(mouse.end.y=u.e.y,z.lock_line.plot(mouse.end.x,mouse.end.y,u.e.x,u.e.y).show()))))}t.e=mouse.end,t.draw()}if("ai_window"===tool&&(null===S.handline&&(handlines.db.push(new V({s:mouse.start,e:mouse.end,label:"window"})),S.handline=handlines.db.length-1),null!==S.handline)){let e=handlines.db[S.handline];e.e=mouse.end,e.draw()}if("ai_window_balcony"===tool&&(null===S.handline&&(handlines.db.push(new V({s:mouse.start,e:mouse.end,label:"windoor"})),S.handline=handlines.db.length-1),null!==S.handline)){let e=handlines.db[S.handline];e.e=mouse.end,e.draw()}if("ai_doorway"===tool&&(null===S.handline&&(handlines.db.push(new V({s:mouse.start,e:mouse.end,label:"doorway"})),S.handline=handlines.db.length-1),null!==S.handline)){let e=handlines.db[S.handline];e.e=mouse.end,e.draw()}if("ai_door"===tool&&(null===S.handline&&(handlines.db.push(new V({s:mouse.start,e:mouse.end,label:"door"})),S.handline=handlines.db.length-1),null!==S.handline)){let e=handlines.db[S.handline];e.e=mouse.end,e.draw()}if("warm_floor"===tool&&3<mouse.delta&&(z.crosshair.clear(),null!==index.room)){let t=rooms2.data[index.room];if(null===index.warm_floor&&(null===S.warm_floor&&(t.warm_floors.push({s:{x:mouse.start.x,y:mouse.start.y},e:mouse.end,id:LIB.id(),id_room:t.id,props:{name:"warm_floor"}}),t.draw(),S.warm_floor=t.warm_floors.length-1),null!==S.warm_floor)){let e=t.warm_floors[S.warm_floor];e&&is_point_inside_polygon(mouse.end,t.polygon)&&(e.e=mouse.end,t.draw())}}}if("drawing"===mode){if("wall"===tool||"balcony"===tool){if(mouse.delta>mouse.min_delta&&null===S.wall){if(null===mouse.down.object){let t;for(let e=0;e<walls.db.length;e++){var w=walls.db[e];if(is_point_over_polygon(mouse.start,w.polygon)){t=w;break}}!t||(f=LIB.projection(mouse.start,t))&&(n=get_distance(f,t.s),l=get_distance(f,t.e),n<=t.depth/2?mouse.start=copy.point(t.s):l<=t.depth/2?mouse.start=copy.point(t.e):mouse.start=copy.point(f))}if("wall"===mouse.down.object){Y=walls.db[mouse.down.wall],N.swall1=Object.assign({},Y),N.swall1s=copy.point(Y.s),N.swall1e=copy.point(Y.e),N.swall1index=mouse.down.wall;var m,c=defs.wall.depth/2+1,n=Y.depth/2+defs.wall.depth,l=LIB.pointOnLine(Y.e,Y.s,c),f=LIB.pointOnLine(Y.s,Y.e,c),I=LIB.pointOnLine(Y.e,Y.s,-c),C=LIB.pointOnLine(Y.s,Y.e,-c),y=get_line(l,f),b=get_point_place(mouse.start,y),v=LIB.projection(mouse.down.point,y);let e;v&&(are_points_equal(v,Y.s)?e="s":are_points_equal(v,Y.e)?e="e":(m=get_distance(v,Y.s),B=get_distance(v,Y.e),m<=c?(B>Y.length&&(e="sO"),B<Y.length&&(e="sI")):B<=c?(m>Y.length&&(e="eO"),m<Y.length&&(e="eI")):e="axis")),"axis"===e&&(mouse.down.connection="axis",mouse.start=copy.point(v),"axis"!==b&&(mouse.end=get_point_near_line_point(y,mouse.start,n,b))),"s"===e&&(mouse.down.connection="snode",mouse.start=copy.point(Y.s)),"e"===e&&(mouse.down.connection="enode",mouse.start=copy.point(Y.e)),"sO"===e&&(Y.free.s?(mouse.down.connection="sO",mouse.start=copy.point(Y.s),mouse.end=LIB.pointOnLine(Y.e,Y.s,defs.wall.depth)):(mouse.start=copy.point(Y.s),mouse.end="axis"!==b?get_point_near_line_point(y,mouse.start,n,b):copy.point(l))),"eO"===e&&(Y.free.e?(mouse.down.connection="eO",mouse.start=copy.point(Y.e),mouse.end=LIB.pointOnLine(Y.s,Y.e,defs.wall.depth)):(mouse.start=copy.point(Y.e),mouse.end="axis"!==b?get_point_near_line_point(y,mouse.start,n,b):copy.point(f))),"sI"===e&&(Y.free.s?(mouse.down.connection="sI",mouse.start=copy.point(I),mouse.end="axis"!==b?get_point_near_line_point(y,mouse.start,n,b):copy.point(I),Y.s=copy.point(I)):(mouse.start=copy.point(Y.s),mouse.end="axis"!==b?get_point_near_line_point(y,mouse.start,n,b):copy.point(I))),"eI"===e&&(Y.free.e?(mouse.down.connection="eI",mouse.start=copy.point(C),mouse.end="axis"!==b?get_point_near_line_point(y,mouse.start,n,b):copy.point(C),Y.e=copy.point(C)):(mouse.start=copy.point(Y.e),mouse.end="axis"!==b?get_point_near_line_point(y,mouse.start,n,b):copy.point(C))),e||(B=extendLine(Y,1e4,1e4),is_point_on_line(c=LIB.projection(mouse.start,B),Y)||((m=get_distance(c,Y.s))<(v=get_distance(c,Y.e))?(mouse.start=copy.point(Y.s),mouse.end=get_point_near_line_point(y,mouse.start,n,b)):v<m&&(mouse.start=copy.point(Y.e),mouse.end=get_point_near_line_point(y,mouse.start,n,b))))}if(walls.db.push(new j({s:copy.point(mouse.start),e:copy.point(mouse.end),depth:defs.wall.depth,label:plan,role:tool,material:material,pos_s:mouse.down.pos_s})),S.wall=walls.db.length-1,nwall=walls.db[S.wall],S.id_wall=nwall.id,nwall.draw(),Y&&Y.draw(),"wall"===mouse.down.object&&(crosshair4.mode="B",crosshair4.wall=walls.db[mouse.down.wall],"axis"===(l=mouse.down.connection)&&(crosshair4.connection="axis",crosshair4.point=mouse.down.point),"s"!==l&&"snode"!==l&&"sI"!==l&&"sO"!==l||(crosshair4.connection="s"),"e"!==l&&"enode"!==l&&"eI"!==l&&"eO"!==l||(crosshair4.connection="e"),l&&crosshair4.draw(!0),eCircle.cx(nwall.e.x).cy(nwall.e.y).front().show(),nwall.draw(),0<nwall.walls_s.length&&(f=nwall.walls_s[0].wall,(Y=walls.db[f]).draw(),2===nwall.walls_s.length&&(I=nwall.walls_s[1].wall,(Be=walls.db[I]).draw()))),null===mouse.down.wall&&(crosshair4.mode="A",crosshair4.wall=nwall,crosshair4.connection="s",crosshair4.draw(!0)),"pillar"===mouse.down.object){nwall.draw();var C=mouse.down.index;let e=pillars.db[C];e.draw(),nwall.draw()}}if(mouse.delta>mouse.min_delta&&null!==S.wall){let i=walls.db[S.wall];if(null!==N.swall1index){let e=walls.db[N.swall1index];if(is_point_inside_polygon(i.e,e.polygon))return crosshair4.hide(),i.delete(),N.swall1s&&(e.s=copy.point(N.swall1s),N.swall1s=null),N.swall1e&&(e.e=copy.point(N.swall1e),N.swall1e=null),e.draw(),N.swall1=null,S.wall=null,N.ewall1index=null,void eCircle.hide();if(2===i.walls_s.length)for(let e=0;e<i.walls_s.length;e++){var x=walls.db[i.walls_s[e].wall];if(is_point_inside_polygon(i.e,x.polygon))return crosshair4.hide(),i.delete(),N.swall1=null,S.wall=null,N.ewall1index=null,walls.draw(),void eCircle.hide()}}if(null!==mouse.down.wall){var B=mouse.down.connection;if(null===N.swall1&&(i.s_birthplace=B,null===i.links.s&&("snode"!==B&&"sO"!==B&&"sI"!==B||(Y.s=copy.point(mouse.down.point)),"enode"!==B&&"eO"!==B&&"eI"!==B||(Y.e=copy.point(mouse.down.point)))),null===i.links.s){if(!1===is_line_on_line(Y,i))switch(B){case"sO":Y.s=LIB.pointOnLine(N.swall1e,N.swall1s,i.depth/2),i.s=copy.point(Y.s);break;case"sI":Y.s=LIB.pointOnLine(N.swall1e,N.swall1s,-i.depth/2),i.s=copy.point(Y.s);break;case"eO":Y.e=LIB.pointOnLine(N.swall1s,N.swall1e,i.depth/2),i.s=copy.point(Y.e);break;case"eI":Y.e=LIB.pointOnLine(N.swall1s,N.swall1e,-i.depth/2),i.s=copy.point(Y.e)}else switch(B){case"sO":case"sI":Y.s=copy.point(N.swall1s),i.s=copy.point(N.swall1s);break;case"eO":case"eI":Y.e=copy.point(N.swall1e),i.s=copy.point(N.swall1e)}"axis"===B&&(c=get_point_place(i.e,Y.axis),void 0!==(v=objectIndexById(walls.db,Y.id))&&(i.links.s={object:"wall",id:Y.id,index:v,side:c},i.links.so={object:"wall",id:Y.id,index:v,side:c},i.links.si={object:"wall",id:Y.id,index:v,side:c}))}"wall"===mouse.down.object&&mouse.down.connection&&crosshair4.draw(!0)}if(mouse.end.x<i.s.x+10&&mouse.end.x>i.s.x-10&&(mouse.end.x=i.s.x),mouse.end.y<i.s.y+10&&mouse.end.y>i.s.y-10&&(mouse.end.y=i.s.y),30<i.length&&(LIB.isObjectEmpty(D.diagonal1)||(m=get_point_projection(mouse.end,D.diagonal1))&&get_distance(mouse.end,m)<10&&(mouse.end=copy_point(m)),LIB.isObjectEmpty(D.diagonal2)||(y=get_point_projection(mouse.end,D.diagonal2))&&get_distance(mouse.end,y)<10&&(mouse.end=copy_point(y))),sCircle.cx(i.s.x).cy(i.s.y),mouse.up.search(t),"wall"===mouse.up.object&&"wall"===mouse.up.part_role){if(T&&N.eConnection)if(is_line_on_line(i,T))if(is_point_on_line(i.e,T))return n=closestPoint(i.s,T.s,T.e),mouse.end=copy.point(n),void(i.e=copy.point(n));N.eConnection&&N.eConnection!==mouse.up.type&&(console.warn("RE-CONNECT"),null!==N.ewall1s&&(T.s=copy.point(N.ewall1s),N.ewall1s=null),null!==N.ewall1e&&(T.e=copy.point(N.ewall1e),N.ewall1e=null),i.e=copy.point(mouse.end),i.draw(),walls.draw(),N.ewall1index=null,N.eConnection=!1),N.eConnection||(console.warn("CONNECT"),N.eConnection=mouse.up.type,N.ewall1index||(N.ewall1index=mouse.up.wall,T=walls.db[mouse.up.wall],N.ewall1s=copy.point(T.s),N.ewall1e=copy.point(T.e),get_two_lines_angle(i,T),(b=is_point_on_straigth(i.s,T))&&("snode"!==(l=mouse.up.type)&&"sO"!==l&&"sI"!==l||(mouse.up.point=copy.point(T.s),ke=copy.point(T.s),i.e_birthplace=mouse.up.type),"enode"!==l&&"eO"!==l&&"eI"!==l||(mouse.up.point=copy.point(T.e),ke=copy.point(T.e),i.e_birthplace=mouse.up.type)),b||("snode"!==(f=mouse.up.type)&&"sO"!==f&&"sI"!==f||0===T.walls_s.length&&null===T.links.s&&(T.s=copy.point(mouse.up.point),ke=copy.point(T.s),i.e_birthplace=mouse.up.type),"enode"!==f&&"eO"!==f&&"eI"!==f||0===T.walls_e.length&&null===T.links.e&&(T.e=copy.point(mouse.up.point),ke=copy.point(T.e),i.e_birthplace=mouse.up.type),"axis"===f&&(I=get_point_place(i.s,T.axis),void 0!==(C=objectIndexById(walls.db,T.id))&&(i.links.e={object:"wall",id:T.id,index:C,side:I},i.links.eo={object:"wall",id:T.id,index:C,side:I},i.links.ei={object:"wall",id:T.id,index:C,side:I}),i.draw(),T.draw())),i.draw(),i.initConnectedWalls("all"))),mouse.end=copy.point(mouse.up.point)}if("pillar"===mouse.up.object){if(null===N.ePillarIndex){i.draw(),N.ePillarIndex=mouse.up.index;let e=pillars.db[N.ePillarIndex];e.draw()}mouse.end=copy.point(mouse.up.point)}if(null===mouse.up.object&&(N.eConnection&&(console.warn("DISCONNECT"),null!==N.ewall1s&&(T.s=copy.point(N.ewall1s),N.ewall1s=null,T.draw()),null!==N.ewall1e&&(T.e=copy.point(N.ewall1e),N.ewall1e=null,T.draw()),i.e=copy.point(mouse.end),i.draw(),walls.draw(),T&&T.draw(),Le&&Le.draw(),N.ewall1index=null,N.ewall1point=null,T=!1),N.eConnection=!1,null!==N.ePillarIndex)){i.e=copy.point(mouse.end),i.draw();let e=pillars.db[N.ePillarIndex];e.draw(),N.ePillarIndex=null}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id!==i.id&&(e.links.s&&e.links.s.id===i.id&&e.draw(),e.links.e&&e.links.e.id===i.id&&e.draw())}if(magnets2.x_closing.hide(),magnets2.y_closing.hide(),null===mouse.up.object&&allow.magnet){B=Math.abs(mouse.end.x-mouse.start.x),v=Math.abs(mouse.end.y-mouse.start.y);if(mouse.end.x>mouse.start.x&&v<B||mouse.end.x<mouse.start.x&&v<B){let s;N.wall_points.forEach(function(n){if(mouse.end.x>n.point.x-n.distance&&mouse.end.x<n.point.x+n.distance){let e,t,i;"s"===n.type&&(t=walls.db[n.wall].l1,i=walls.db[n.wall].r1),"e"===n.type&&(t=walls.db[n.wall].l2,i=walls.db[n.wall].r2),e=Math.abs(mouse.start.x-t.x)<Math.abs(mouse.start.x-i.x)?t:i,s=e.x,mouse.end.x=e.x,magnets2.x_closing.plot(mouse.end.x,mouse.end.y,e.x,e.y).show()}})}if(mouse.end.y<mouse.start.y&&B<v||mouse.end.y>mouse.start.y&&B<v){let s;N.wall_points.forEach(function(n){if(mouse.end.y>n.point.y-n.distance&&mouse.end.y<n.point.y+n.distance){let e,t,i;"s"===n.type&&(t=walls.db[n.wall].l1,i=walls.db[n.wall].r1),"e"===n.type&&(t=walls.db[n.wall].l2,i=walls.db[n.wall].r2),e=Math.abs(mouse.start.y-t.y)<Math.abs(mouse.start.y-i.y)?t:i,s=e.y,mouse.end.y=e.y,magnets2.y_closing.plot(mouse.end.x,mouse.end.y,e.x,e.y).show()}})}}if(i.e=copy.point(mouse.end),i.draw(!0),i.drawConnectedWalls("all"),eCircle.cx(i.e.x).cy(i.e.y).show(),null===mouse.up.object?eCircle.fill("#fafafa"):eCircle.fill("#ffb2c1"),"pillar"===mouse.up.object&&null!==N.ePillarIndex){let e=pillars.db[N.ePillarIndex];e.draw()}null!==i.links.s&&(c=i.links.s.index,walls.db[c]&&walls.db[c].draw()),null!==i.links.e&&(m=i.links.e.index,walls.db[m]&&walls.db[m].draw())}if(3<mouse.delta&&null===S.wall&&eCircle.hide(),mouse.delta<mouse.min_delta&&null!==S.wall&&walls.db[S.wall]){crosshair4.hide();let e=walls.db[S.wall];if(e.delete(),Y&&Y.draw(),Be&&Be.draw(),null!==N.swall1){let e=walls.db[N.swall1index];N.swall1s&&(e.s=copy.point(N.swall1s),N.swall1s=null),N.swall1e&&(e.e=copy.point(N.swall1e),N.swall1e=null),e.draw(),N.swall1=null}S.wall=null,N.ewall1index=null}}if("ruler"===tool&&($("body").css("cursor","crosshair"),mouse.delta=get_distance(mouse.start,mouse.end),10<mouse.delta&&(null===S.ruler&&(rulers.db.push(new U({s:mouse.start,e:mouse.end,plan:plan})),S.ruler=rulers.db.length-1),null!==S.ruler))){let e=rulers.db[S.ruler];e.e=mouse.end,e.draw()}if("freeline"===tool&&S.freeline){freelineControlE.hide(),S.freeline.color=freelines.temp_color,S.freeline.paint(),mouse.end.x<S.freeline.s.x+4&&mouse.end.x>S.freeline.s.x-4&&(mouse.end.x=S.freeline.s.x),mouse.end.y<S.freeline.s.y+4&&mouse.end.y>S.freeline.s.y-4&&(mouse.end.y=S.freeline.s.y);y=LIB.line45(S.freeline.s,45),n=LIB.projection(mouse.end,y),l=(n&&LIB.distance(mouse.end,n)<4&&(mouse.end=n),LIB.line45(S.freeline.s,-45)),b=LIB.projection(mouse.end,l);b&&LIB.distance(mouse.end,b)<4&&(mouse.end=b);for(let e=0;e<freelines.db.length;e++){var k=freelines.db[e];k.plan===plan&&k.id!==S.freeline.id&&(get_distance(mouse.end,k.s)<10&&(mouse.end=copy.point(k.s),S.freeline.color=k.color,S.freeline.paint(),10<LIB.lineLength(S.freeline)&&freelineControlE.fire("on",{center:mouse.end})),get_distance(mouse.end,k.e)<10&&(mouse.end=copy.point(k.e),S.freeline.color=k.color,S.freeline.paint(),10<LIB.lineLength(S.freeline)&&freelineControlE.fire("on",{center:mouse.end})))}S.freeline.e=copy.point(mouse.end),S.freeline.update()}}if(manager_lining.svg_mousemove(t),!allow.draw)if(customCursor.fire("move",t),"pillar"===tool||"gypsum_box"===tool)cursors.pillar.fire("move",t);else if("pillar_air"===tool)cursors.pillar_air.fire("move",t);else if("pillar_water"===tool)cursors.pillar_water.fire("move",t);else if("doors"===tool_group)cursors.door.fire("move",t);else if("windows"===tool_group)cursors.window.fire("move",t);else if("warm_floor"===tool){mouse.over.room=null;let i=get_line(mouse.end,LIB.point(mouse.end.x,-1e6)),n=get_line(mouse.end,LIB.point(-1e6,mouse.end.y)),s=get_line(mouse.end,LIB.point(mouse.end.x,1e6)),o=get_line(mouse.end,LIB.point(1e6,mouse.end.y));for(let t=0;t<rooms2.data.length;t++){var L=rooms2.data[t];if(is_point_inside_polygon(mouse.end,L.polygon))for(let e=0;e<L.edges.length;e++){var E=L.edges[e],W=(mouse.over.room=t,line_and_line_intersection(i,E)),P=line_and_line_intersection(n,E),Q=line_and_line_intersection(o,E),E=line_and_line_intersection(s,E);W&&(i.e=W),P&&(n.e=P),Q&&(o.e=Q),E&&(s.e=E)}}z.crosshair.clear(),null!==mouse.over.room&&allow.crosshair&&(15<LIB.lineLength(i)&&z.crosshair.add(new DimensionSimple({s:i.s,e:i.e,style:"clear",center:!1,s_line:!1})),15<LIB.lineLength(n)&&z.crosshair.add(new DimensionSimple({s:n.s,e:n.e,style:"clear",center:!1,s_line:!1})),15<LIB.lineLength(s)&&z.crosshair.add(new DimensionSimple({s:s.s,e:s.e,style:"clear",center:!1,s_line:!1})),15<LIB.lineLength(o)&&z.crosshair.add(new DimensionSimple({s:o.s,e:o.e,style:"clear",center:!1,s_line:!1})))}else if("stairs"===tool_group)cursors.own.fire("move_stair",t);else if("furniture"===tool_group)"ventilation_hole"===tool?cursors.own.fire("move_ventHole",t):("break_radiator"===tool||"break_electric_shield"===tool?customCursor:cursors.own).fire("move",t);else if("waterspots"!==tool_group||in_array(tool,piping.tools)){if("sockets"===tool_group)cursors.own.fire("move",t);else if("wires"===tool_group)cursors.own.fire("move",t);else if("lights"===tool_group)cursors.own.fire("move",t);else if("switches"===tool_group&&"cable"!==tool)cursors.own.fire("move",t);else if("ai_wall"===tool||"ai_balcony"===tool){z.lock.hide();for(let e=0;e<handlines.db.length;e++){var M=handlines.db[e];get_distance(mouse.end,M.s)<4&&z.lock.move(M.s.x-9,M.s.y-11).show(),get_distance(mouse.end,M.e)<4&&z.lock.move(M.e.x-9,M.e.y-11).show()}}}else cursors.own.fire("move",t);if("drawing"===mode&&t.stopImmediatePropagation(),"panning"===mode&&(tool_events.hasOwnProperty("canvas_move")?tool_events.canvas_move++:tool_events.canvas_move=1,grid.update()),!0===allow.sector&&"break_part"===tool&&($("body").css("cursor","default"),null!==mouse.down.wall&&null===mouse.down.sector)){let e=walls.db[mouse.down.wall];if("wall"===e.role)if(3<mouse.delta&&null===S.sector&&((f=LIB.projection(mouse.end,O))&&(sectors.db.push(new F({s:copy.point(mouse.start),e:copy.point(f),id_wall:walls.db[mouse.down.wall].id,wall_index:mouse.down.wall})),S.sector=sectors.db.length-1,C=sectors.db[S.sector],e.init(),eCircle.cx(C.e.x).cy(C.e.y).show().front(),are_points_equal(C.s,O.s)&&(ye=!0),are_points_equal(C.s,O.e)&&(be=!0))),3<mouse.delta&&null!==S.sector){let e=sectors.db[S.sector],t=walls.db[e.wall_index];I=LIB.projection(mouse.end,O);I&&(e.e=I,get_distance(e.e,e.s)<=10?(be&&(e.e=LIB.pointOnLine(O.s,O.e,-10)),ye&&(e.e=LIB.pointOnLine(O.e,O.s,-10)),e.draw()):(get_distance(e.e,O.s)<3&&(e.e=copy.point(O.s)),get_distance(e.e,O.e)<3&&(e.e=copy.point(O.e))),e.draw(),t.init(),eCircle.cx(e.e.x).cy(e.e.y))}}}),svg.on("mouseup",function(e){if("freeline"===tool){if(S.freeline){if(LIB.lineLength(S.freeline)<=5)return warning.show("yellow",l10n.freeline_min_length.replace("[x]","5 см")),S.freeline.remove(),freelineControlS.fire("off"),void(mode="free");project.localSave()}S.freeline&&(!(LIB.distance(S.freeline.e,mouse.end)<=4)||freelineControlE.activated?freelineControlS.fire("off"):freelineControlS.fire("on",{center:S.freeline.e})),freelineControlE.fire("off")}if("gypsum_box"===tool&&"pillarMovement"===tool2&&cursors.pillar.fire("create"),!(in_array(mode,["free","drawing"])&&manager_lining.svg_mouseup(this.room?rooms2.data[this.room].id:"")||Z)){if("delimiter"===(tool="comment"===tool?"none":tool)){if(null===zoneDelimiter.E.room&&(tool_reset(),zoneDelimiter.fire("off"),warning.show("yellow",l10n.delimiter_install_in_room)),null!==zoneDelimiter.S.room&&null!==zoneDelimiter.E.room&&zoneDelimiter.S.room===zoneDelimiter.E.room){let t=rooms2.data[zoneDelimiter.S.room],i,n,s;"build"===plan&&(i=t.zones),"floor"===plan&&(i=t.floors),"hydroisolation"===plan&&(i=t.hydroisolation),"ceiling"===plan&&(i=t.ceilings);var l=LIB.point(zoneDelimiter.S.cx(),zoneDelimiter.S.cy()),r=LIB.point(zoneDelimiter.E.cx(),zoneDelimiter.E.cy());let o=get_line(l,r);"build"===plan&&(o.type="zone"),"floor"===plan&&(o.type="floor"),"hydroisolation"===plan&&(o.type="hydroisolation"),"ceiling"===plan&&(o.type="ceiling");for(let e=0;e<t.edges.length;e++)if(is_line_over_line(t.edges[e],o))return tool_reset(),s_size.fire("off"),e_size.fire("off"),zoneDelimiter.fire("off"),void warning.show("yellow",l10n.delimiter_incorrect_break);for(let e=0;e<t.delimiters.length;e++){var a=t.delimiters[e];if(o.type===a.type)if(line_and_line_intersection(o,a))return tool_reset(),s_size.fire("off"),e_size.fire("off"),zoneDelimiter.fire("off"),void warning.show("yellow",l10n.delimiter_not_cross_delimiter)}var h=get_center(l,r);for(let e=0;e<i.length;e++)is_point_inside_polygon(h,i[e].polygon)&&(n=i[e],s=e);l=LIB.splitPolygonByLine(n.polygon,o);2===l.length&&(i.splice(s,1),i.push({polygon:l[0],id:LIB.id()}),i.push({polygon:l[1],id:LIB.id()}),t.delimiters.push(o),t.draw(),project.localSave())}s_size.fire("off"),e_size.fire("off"),zoneDelimiter.fire("off")}if("delimiter"!==tool){function n(e){mode="free",allow.draw=!1,mouse.down.reset(),mouse.up.reset(),N.reset(),z.reset(),magnets2.hide(),e.delete("complex"),S.reset(),pillars.draw(),walls.draw()}var i;sCircle.animate(150).attr({r:0}).after(function(){this.attr({r:4}),this.hide()}),eCircle.animate(150).attr({r:0}).after(function(){this.attr({r:4}),this.hide()}),Ie=null,N.ewall1index=null,crosshair4.hide(),"panning"===mode&&get_distance(X,q),"pillar"===tool&&(mode="drawing",drawing=!0);for(let t=0;t<windows.db.length;t++){let e=windows.db[t];!1===e.demount&&LIB.lineLength(e)<=1&&(e.erase(),windows.db.splice(t,1),t--)}if(1===e.which&&("windows"===tool_group&&cursors.window.fire("create"),"doors"===tool_group&&cursors.door.fire("create"),"pillar"!==tool&&"gypsum_box"!==tool||cursors.pillar.fire("create"),"pillar_air"===tool&&cursors.pillar_air.fire("create"),"pillar_water"===tool&&cursors.pillar_water.fire("create")),"drawing"===mode&&1===e.which){if("wall"===tool||"balcony"===tool){z.reset(),magnets2.hide(),(null===mouse.delta||mouse.delta<=defs.wall.min_length)&&(tool_events.hasOwnProperty("click_wo_wall")?tool_events.click_wo_wall++:tool_events.click_wo_wall=1);r=null!==S.wall&&mouse.delta>defs.wall.min_length;let i;if(null!==S.wall&&(i=walls.db[S.wall]),r){if("init"!==i.label&&"build"!==i.label)return project.errors.wallWrongLabel++,n(i),void warning.show("red",l10n.wall_error_try_again);if(!is_point_exists(i.s))return project.errors.wallNoPointS++,n(i),void warning.show("red",l10n.wall_error_try_again);if(!is_point_exists(i.e))return project.errors.wallNoPointE++,n(i),void warning.show("red",l10n.wall_error_try_again)}if(r&&i.force_connection("e"),i&&i.calc(),r)for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if(t.id!==i.id)if("init_copy"!==t.label)if("init"!==plan||"build"!==t.label)if("build"!==plan||"break"!==t.label)if(is_point_inside_polygon(get_center(t.s,t.e),i.polygon))return Y&&(Y.s=copy.point(N.swall1s),Y.e=copy.point(N.swall1e),Y.draw()),T&&(T.s=copy.point(N.ewall1s),T.e=copy.point(N.ewall1e),T.draw()),n(i),void warning.show("red",l10n.wall_not_up_other_wall)}if(r){var l=get_point_near_line_center(i.s,i.e,i.outer_depth,"L"),s=get_point_near_line_center(i.s,i.e,i.inner_depth,"R"),o=LIB.pointOnLine(i.l1,l,-10),g=LIB.pointOnLine(i.l2,l,-10),_=LIB.pointOnLine(i.r1,s,-10),d=LIB.pointOnLine(i.r2,s,-10);for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if(e.isAvailable())if(e.id!==i.id)if(!is_point_inside_polygon(i.c,e.polygon)){var p=is_point_on_line(o,e.EdgeO)&&is_point_on_line(g,e.EdgeO),c=is_point_on_line(o,e.EdgeI)&&is_point_on_line(g,e.EdgeI),A=is_point_on_line(_,e.EdgeO)&&is_point_on_line(d,e.EdgeO),u=is_point_on_line(_,e.EdgeI)&&is_point_on_line(d,e.EdgeI);if(p||c||A||u)return warning.show("red",l10n.wall_not_install_to_closely_wall),void n(i)}}}if(r){if(null!==i.links.s&&"pillar"===i.links.s.object){l=i.links.s.index,s=pillars.db[l],l=i.links.s.side;let e,t;if("T"===l&&(e=is_point_on_line(i.l1,s.edge_t),t=is_point_on_line(i.r1,s.edge_t)),"R"===l&&(e=is_point_on_line(i.l1,s.edge_r),t=is_point_on_line(i.r1,s.edge_r)),"B"===l&&(e=is_point_on_line(i.l1,s.edge_b),t=is_point_on_line(i.r1,s.edge_b)),"L"===l&&(e=is_point_on_line(i.l1,s.edge_l),t=is_point_on_line(i.r1,s.edge_l)),!e||!t)return warning.show("red",l10n.wall_invalid_to_pillar),void n(i)}if(null!==i.links.e&&"pillar"===i.links.e.object){l=i.links.e.index,s=pillars.db[l],l=i.links.e.side;let e,t;if("T"===l&&(e=is_point_on_line(i.l2,s.edge_t),t=is_point_on_line(i.r2,s.edge_t)),"R"===l&&(e=is_point_on_line(i.l2,s.edge_r),t=is_point_on_line(i.r2,s.edge_r)),"B"===l&&(e=is_point_on_line(i.l2,s.edge_b),t=is_point_on_line(i.r2,s.edge_b)),"L"===l&&(e=is_point_on_line(i.l2,s.edge_l),t=is_point_on_line(i.r2,s.edge_l)),!e||!t)return warning.show("red",l10n.wall_invalid_to_pillar),void n(i)}}if(r){var w=LIB.pointOnLine(i.s,i.c,-5),m=LIB.pointOnLine(i.e,i.c,-5);if("init"===plan)for(let e=0;e<walls.db.length;e++){var f=walls.db[e];if("build"===f.label){var I=is_point_on_line(w,f.axis),C=is_point_on_line(m,f.axis),j=is_point_on_line(f.c,i.axis),f=line_and_line_intersection(i,f);if(I||C||j||f)return n(i),void warning.show("red",l10n.wall_not_up_other_wall)}}}if(r){if(i.calc(),i.draw(),null!==i.links.eo&&"pillar"===i.links.eo.object){l=i.links.eo.index;let e=pillars.db[l];e.draw()}wall_magnet.cx(i.e.x).cy(i.e.y).hide()}if(r){var R=walls.db[S.wall];for(let t=0;t<questions.db.length;t++){let e=questions.db[t];is_point_inside_polygon(e.center,R.polygon)&&e.delete()}}if(r){var y=walls.db[S.wall];let t=[],i=[];for(let e=0;e<walls.db.length;e++){var b,v,x,B,k=walls.db[e];k.label===y.label&&k.id!==y.id&&(b=is_point_on_line(y.s,k.axis),v=is_point_on_line(y.e,k.axis),x=is_point_on_line(k.s,y.axis),B=is_point_on_line(k.e,y.axis),b||v||x||B||are_lines_on_straight(y.axis,k.axis)&&(0===y.walls_s.length&&(0===k.walls_s.length&&t.push({xy:k.s,id_wall:k.id,wall_end:"s",distance:get_distance(y.s,k.s)}),0===k.walls_e.length&&t.push({xy:k.e,id_wall:k.id,wall_end:"e",distance:get_distance(y.s,k.e)})),0===y.walls_e.length&&(0===k.walls_s.length&&i.push({xy:k.s,id_wall:k.id,wall_end:"s",distance:get_distance(y.e,k.s)}),0===k.walls_e.length&&i.push({xy:k.e,id_wall:k.id,wall_end:"e",distance:get_distance(y.e,k.e)}))))}t.sort(compare_distance),i.sort(compare_distance);s=t[0];if(s){l=get_distance(y.s,s.xy);if(1<l&&l<120){var L=get_center(y.s,s.xy);let t=!0;for(let e=0;e<pillars.db.length;e++)if(is_point_inside_polygon(L,pillars.db[e].polygon)){t=!1;break}t&&(questions.db.push(new J({s:s.xy,e:y.s,center:L,s_wall:{id:s.id_wall,end:s.wall_end},e_wall:{id:y.id,end:"s"},plan:plan})),project.localSave())}}l=i[0];if(l&&!is_point_on_line(y.s,{s:l.xy,e:y.e})){s=get_distance(y.e,l.xy);if(1<s&&s<120){var E=get_center(y.e,l.xy);let t=!0;for(let e=0;e<pillars.db.length;e++)if(is_point_inside_polygon(E,pillars.db[e].polygon)){t=!1;break}t&&(questions.db.push(new J({s:y.e,e:l.xy,center:E,s_wall:{id:y.id,end:"e"},e_wall:{id:l.id_wall,end:l.wall_end},plan:plan})),project.localSave())}}}if(r){walls.calc();let t=walls.db[S.wall],i,n,s,o;if("wall"===t.role||"balcony"===t.role){if(0<t.walls_s.length)for(let e=0;e<t.walls_s.length;e++){var W=t.walls_s[e].wall,P=walls.db[W],W=t.walls_s[e].type;if(t.depth===P.depth&&t.material===P.material&&is_line_on_line_2(t.axis,P.axis)&&t.label===P.label&&t.role===P.role){if("s"===W){i=copy_point(P.e),n=P;for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.id_wall===P.id&&("single"!==e.type&&"door_coupe"!==e.type||(e.rotate(),e.rotate()),"double"===this.type&&e.rotate(),"door_penal"===this.type&&e.rotate())}for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.id_wall===P.id&&"windoor"===e.type&&(e.rotate(),e.rotate())}}"e"===W&&(i=copy_point(P.s),n=P)}}if(0<t.walls_e.length)for(let e=0;e<t.walls_e.length;e++){var Q=t.walls_e[e].id,Q=objectIndexById(walls.db,Q);if(void 0!==Q){var M=walls.db[Q],Q=t.walls_e[e].type;if(t.depth===M.depth&&t.material===M.material&&is_line_on_line_2(t.axis,M.axis)&&t.label===M.label&&t.role===M.role&&("s"===Q&&(s=copy_point(M.e),o=M),"e"===Q)){s=copy_point(M.s),o=M;for(let t=0;t<doors.db.length;t++){let e=doors.db[t];e.id_wall===M.id&&("single"!==e.type&&"door_coupe"!==e.type||(e.rotate(),e.rotate()),"double"===this.type&&e.rotate(),"door_penal"===this.type&&e.rotate())}}}}}i&&(n.delete(),t.s=copy.point(i),walls.draw(),windows.expand(),doors.expand(),t.init()),s&&(o.delete(),t.e=copy.point(s),walls.draw(),windows.expand(),doors.expand(),t.init())}r&&(pillars.draw(),walls.calc(),walls.init()),r&&(i.delete_rooms(),create_rooms(),project.localSave())}if("break_part"===tool){if(null!==S.sector){let e=sectors.db[S.sector],t=get_object(walls.db,e.id_wall);LIB.lineLength(e)<=defs.sector.min_length?(warning.show("yellow",l10n.break_min_length.replace("[x]",defs.sector.min_length+" см.")),e.delete(),t&&t.init(),S.reset(),mouse.down.wall=null,N.reset(),selected.wall=null,selected.sector=null,S.sector=null):(e.bind("wall"),e.draw(),e.delete_rooms2(),e.demountWindowsDoors())}if(null!==S.sector){let i=sectors.db[S.sector];i.id_wall;for(let e=0;e<2;e++)for(let t=0;t<sectors.db.length;t++){let e=sectors.db[t];if(i.id!==e.id&&i.id_wall===e.id_wall&&is_line_on_line(i,e)){if(are_points_equal(i.s,e.s)){i.s=copy_point(e.e),e.delete(t),i.draw(),i.demountWindowsDoors();break}if(are_points_equal(i.s,e.e)){i.s=copy_point(e.s),e.delete(t),i.draw(),i.demountWindowsDoors();break}if(are_points_equal(i.e,e.s)){i.e=copy_point(e.e),e.delete(t),i.draw(),i.demountWindowsDoors();break}if(are_points_equal(i.e,e.e)){i.e=copy_point(e.s),e.delete(t),i.draw(),i.demountWindowsDoors();break}}}for(let e=0;e<2;e++)for(let t=0;t<sectors.db.length;t++){let e=sectors.db[t];if(i.id!==e.id&&i.id_wall===e.id_wall&&is_line_on_line(i,e)){if(is_point_inside_polygon(i.s,e.polygon)){var D=get_distance(i.e,e.s),O=get_distance(i.e,e.e);O<D&&(i.s=copy_point(e.s)),D<O&&(i.s=copy_point(e.e)),e.delete(t),i.draw(),i.demountWindowsDoors();break}if(is_point_inside_polygon(i.e,e.polygon)){D=get_distance(i.s,e.s),O=get_distance(i.s,e.e);O<D&&(i.e=copy_point(e.s)),D<O&&(i.e=copy_point(e.e)),e.delete(t),i.draw(),i.demountWindowsDoors();break}}}i.demountVentHoles();s=objectIndexById(walls.db,i.id_wall);void 0!==s&&walls.db[s].init()}for(let e=0;e<sectors.db.length;e++){var F=sectors.db[e];for(let t=0;t<sectors.db.length;t++)if(t!==e){let e=sectors.db[t];is_line_over_line(e,F)&&(e.remove=!0)}}for(let t=0;t<sectors.db.length;t++){let e=sectors.db[t];!0===e.remove?(e.delete(),t--):(e.demountWindowsDoors(),void 0!==(i=objectIndexById(walls.db,e.id_wall))&&walls.db[i].init())}null!==S.sector&&(walls.get_axis_lines(),project.localSave())}"ruler"===tool&&null!==S.ruler&&project.localSave(),"furniture"!==tool_group&&"sockets"!==tool_group&&"lights"!==tool_group&&"switches"!==tool_group&&"waterspots"!==tool_group&&"wires"!==tool_group&&"cables"!==tool_group||(console.warn("[Tool]",tool),1===e.which&&"none"!==tool&&("ventilation_hole"===tool?cursors.own.fire("create2","ventHole"):cursors.own.fire("create"))),"stairs"===tool_group&&1===e.which&&"none"!==tool&&cursors.own.fire("create2","stair");var G=get_svg_point({x:e.clientX,y:e.clientY});for(let e=0;e<rooms2.data.length;e++)if(is_point_inside_polygon(G,rooms2.data[e].polygon)){e;break}null!==mouse.over.room&&rooms2.data[mouse.over.room],"warm_floor"===tool&&null!==S.warm_floor&&(xe(),project.localSave()),allow.draw=!1,S.reset(),mouse.down.reset(),mouse.up.reset(),N.reset(),z.reset(),magnets2.hide()}allow.sector=!1,panning&&(Ce.end={x:e.clientX,y:e.clientY},3<get_distance(Ce.start,Ce.end)&&("wall"!==N.tool&&"balcony"!==N.tool||("wall"===N.tool&&$("#plannertool_wall").addClass("active"),"balcony"===N.tool&&$("#plannertool_balcony").addClass("active"),tool=N.tool,tool_group="walls",N.tool=null,N.tool_group=null))),S.wall=null,S.window=null,S.door=null,mouse.down.reset(),mouse.up.reset(),get_borders_links()}allow.draw=!1,drawing=!1,panning=!1,mode="free",nwall=!1,Y=!1,Be=!1,T=!1,ke=!1,Le=!1,$("body").css("cursor","default"),in_array(tool_group,["sockets","lights"])&&$("body").css("cursor","none"),"ruler"===tool&&$("body").css("cursor","crosshair"),"freeline"===tool&&$("body").css("cursor","crosshair"),customCursor.fire("click")}}),svg.on("wheel",function(){let e=svg.zoom();.2===e&&(e=0),$("#planner_ui_zoom_slider").val(e),grid.update(),tool_events.hasOwnProperty("canvas_zoom")?tool_events.canvas_zoom++:tool_events.canvas_zoom=1}),window.DimensionSimple=function(e){var t=e.s,i=e.e,n=e.style,s=e.center,o={stroke:"#000000","stroke-width":.4};let l=svg.group(),r,a,h=get_distance(t,i).toFixed(),g=get_center(t,i);!1===s&&40<h&&(g=LIB.pointOnLine(i,t,-20));var s=LIB.pointOnLine(t,g,-10),_=LIB.pointOnLine(i,g,-10),_=("light"===n&&(r="#000000",a="#ffffff",l.add(svg.line(t.x,t.y,i.x,i.y).attr(o))),"clear"===n&&(r="transparent",a="transparent",l.add(svg.line(t.x,t.y,s.x,s.y).attr(o)),l.add(svg.line(i.x,i.y,_.x,_.y).attr(o))),"dark"===n&&(r="#000000",a="#cbe0f4",l.add(svg.line(t.x,t.y,i.x,i.y).attr(o))),!1!==e.s_line&&(s={s:point_near_line_end(i,t,3,"L"),e:point_near_line_end(i,t,3,"R")},l.add(svg.line(s.s.x,s.s.y,s.e.x,s.e.y).attr(o).rotate(45))),{s:point_near_line_end(t,i,3,"L"),e:point_near_line_end(t,i,3,"R")});l.add(svg.line(_.s.x,_.s.y,_.e.x,_.e.y).attr(o).rotate(45)),l.rect(20,12).radius(2).attr({stroke:r,"stroke-width":.1,fill:a}).cx(g.x).cy(g.y);let d=9;return"big"===project.font&&(d=13),l.plain(h.toString()).font({family:"Arial",size:d,stroke:"#161616","stroke-width":.4,fill:"#161616"}).cx(g.x).cy(g.y),l};function Pe(e,t,i){var n=get_center(e,t);let s=get_distance(e,t).toFixed(0),o=svg.group(),l=(o.rect(18,10).radius(2).attr({stroke:"#000000","stroke-width":0,fill:i}).cx(n.x).cy(n.y),8),r=.4;return"big"===project.font&&(l=12,r=.6),o.plain(s.toString()).font({family:"Arial",size:l,stroke:"#000000","stroke-width":r,fill:"#000000"}).cx(n.x).cy(n.y),o}function Qe(e,t,i,n,s){let o=this,l=(this.s=e,this.e=t,this.type=i,this.offset=n=n||6,this.parent=s,this.attr={stroke:"#000000","stroke-width":.4},this.IMAGE=svg.group().on("mousedown",function(){console.warn("Parent:",o.parent)}),this.line=this.IMAGE.line().attr(this.attr),this.s_border=this.IMAGE.line().attr(this.attr),this.e_border=this.IMAGE.line().attr(this.attr),this.s_dash=this.IMAGE.line().attr(this.attr),this.e_dash=this.IMAGE.line().attr(this.attr),this.background=this.IMAGE.rect(16,8).radius(2).attr({stroke:"none","stroke-width":0,fill:"#fafafa",opacity:.75}),8),r=.4;return"big"===project.font&&(l=12,r=.6),this.value=this.IMAGE.plain("").font({family:"Arial",size:l,stroke:"#000000","stroke-width":r,fill:"#000000"}),this.draw(),this.IMAGE}function Me(t,i,n){let s=this;this.wall=t;var e=get_point_near_line_end(this.wall.s,i.center,this.wall.depth/2+5,"L"),o=get_point_near_line_end(this.wall.s,i.center,this.wall.depth/2+5,"R"),l=get_line_angle(this.wall);return this.IMAGE=layers.ventHoles.group().draggable().on("mouseover",function(e){"init"!==plan&&"build"!==plan||t.label!==plan||i.selected||("none"===tool&&(customCursor.overObject=!0,s.paint("orange")),"eraser"===tool&&(customCursor.overObject=!0,s.paint("crimson")))}).on("mouseleave",function(e){"init"!==plan&&"build"!==plan||t.label!==plan||i.selected||"none"!==tool&&"eraser"!==tool||(customCursor.overObject=!1,s.paint())}).on("mousedown",function(e){if("init"===plan||"build"===plan){if($(".contextmenu").hide(),Q(),t.ventHoles[n].selected=!0,t.draw(),selected.wall=s.wall,id.ventHole=i.id,selectedObject="ventHole",1===e.detail){if(1===e.which){if("eraser"===tool)return this.draggable(!1),customCursor.overObject=!1,t.removeVentHole(i.id),void t.draw();"none"===tool&&(customCursor.overObject=!1,r={wall:t,index:n})}3===e.which&&(cursors.own.fire("off"),showContextmenu("#vent_hole_contextmenu",e.clientX,e.clientY,canvas.position().top),r={wall:t,index:n})}2===e.detail&&(cursors.own.fire("off"),s.paint("orange"),showContextmenu("#vent_hole_contextmenu",e.clientX,e.clientY,canvas.position().top),r={wall:t,index:n})}}).on("dragstart",function(t){if("init"===plan||"build"===plan){let e=s.wall;e.buildRealAxis("short"),this.baseline=LIB.extendLine(e.realAxis,-i.width/2,-i.width/2),this.start=LIB.pointSVG(t.detail.event.clientX,t.detail.event.clientY)}}).on("dragmove",function(e){e.preventDefault(),"init"!==plan&&"build"!==plan||(e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),3<LIB.distance(e,this.start)&&((e=LIB.projection(e,this.baseline))&&(e=LIB.distance(t.s,e),t.ventHoles[n].sdistance=e,t.draw())))}),this.IMAGE.add(svg.rect(i.width,this.wall.depth).attr({"stroke-width":1.4}).cx(i.center.x).cy(i.center.y).rotate(l)),this.IMAGE.add(svg.path("M5.6,8.5c0,0,0-0.1,0-0.1l0-6.3l0.1,0.1C5.8,2.3,5.9,2.4,6,2.5l1.8,1.8C8,4.5,8.3,4.6,8.6,4.4c0.3-0.2,0.3-0.6,0.1-0.9c0,0,0,0-0.1-0.1L5.5,0.2c-0.3-0.3-0.7-0.3-0.9,0c0,0,0,0,0,0L1.3,3.4c-0.3,0.3-0.3,0.7,0,0.9c0,0,0,0,0.1,0.1C1.7,4.6,2,4.5,2.2,4.3L4,2.5c0.1-0.1,0.2-0.2,0.2-0.3L4.4,2l0,6.3c0,0.3,0.2,0.6,0.5,0.7C5.2,9,5.6,8.8,5.6,8.5z").attr({"stroke-width":.6}).addClass("arrow").cx(e.x).cy(e.y).rotate(l)),this.IMAGE.add(svg.path("M5.6,8.5c0,0,0-0.1,0-0.1l0-6.3l0.1,0.1C5.8,2.3,5.9,2.4,6,2.5l1.8,1.8C8,4.5,8.3,4.6,8.6,4.4c0.3-0.2,0.3-0.6,0.1-0.9c0,0,0,0-0.1-0.1L5.5,0.2c-0.3-0.3-0.7-0.3-0.9,0c0,0,0,0,0,0L1.3,3.4c-0.3,0.3-0.3,0.7,0,0.9c0,0,0,0,0.1,0.1C1.7,4.6,2,4.5,2.2,4.3L4,2.5c0.1-0.1,0.2-0.2,0.2-0.3L4.4,2l0,6.3c0,0.3,0.2,0.6,0.5,0.7C5.2,9,5.6,8.8,5.6,8.5z").attr({"stroke-width":.6}).addClass("arrow").cx(o.x).cy(o.y).rotate(l+180)),i.selected?this.paint("orange"):this.paint(),this.IMAGE}function De(e,t="big"){let i=svg.group();return"big"===t&&(i.add(svg.circle(24).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(e.x).cy(e.y)),i.add(svg.path(paths.sign_destroy).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(e.x).cy(e.y))),"small"===t&&(i.add(svg.circle(18).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(e.x).cy(e.y)),i.add(svg.path(paths.sign_destroy).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).width(10).height(10).cx(e.x).cy(e.y))),i}Qe.prototype.draw=function(){let e,t,i,n;"L"===this.type&&(e=point_near_line_end(this.e,this.s,this.offset,"R"),t=point_near_line_end(this.s,this.e,this.offset,"L"),i=point_near_line_end(this.e,this.s,this.offset+4,"R"),n=point_near_line_end(this.s,this.e,this.offset+4,"L")),"center"===this.type&&(e=this.s,t=this.e),"R"===this.type&&(e=point_near_line_end(this.e,this.s,this.offset,"L"),t=point_near_line_end(this.s,this.e,this.offset,"R"),i=point_near_line_end(this.e,this.s,this.offset+4,"L"),n=point_near_line_end(this.s,this.e,this.offset+4,"R")),this.line.plot(e.x,e.y,t.x,t.y),"L"!==this.type&&"R"!==this.type||(this.s_border.plot(this.s.x,this.s.y,i.x,i.y),this.e_border.plot(this.e.x,this.e.y,n.x,n.y));var s={s:point_near_line_end(t,e,3,"L"),e:point_near_line_end(t,e,3,"R")},s=(this.s_dash.plot(s.s.x,s.s.y,s.e.x,s.e.y).untransform().rotate(45),{s:point_near_line_end(e,t,3,"L"),e:point_near_line_end(e,t,3,"R")}),s=(this.e_dash.plot(s.s.x,s.s.y,s.e.x,s.e.y).untransform().rotate(45),get_center(e,t));let o=get_distance(e,t).toFixed(0);this.background.cx(s.x).cy(s.y),this.value.plain(o.toString()).cx(s.x).cy(s.y)},Qe.prototype.hide=function(){this.IMAGE.hide()},Qe.prototype.show=function(){this.IMAGE.show()},Qe.prototype.erase=function(){this.IMAGE.clear()},Me.prototype.paint=function(e){if(!e){let e="#1d95da";"B"===plan_group&&(e=colors.grey),this.IMAGE.each(function(){this.hasClass("arrow")?this.attr({stroke:e,fill:e}):this.attr({stroke:e,fill:"#fafafa"})})}e&&this.IMAGE.each(function(){this.hasClass("arrow")?this.attr({stroke:e,fill:e}):this.attr({stroke:e,fill:hatch[e]})})};window.WallPattern=function(e){switch(e){case"glass":return layers.walls.pattern(10,10,function(e){e.rect(10,10).attr({"stroke-width":0,fill:"#fefefe"}),e.path("M2,8l6-6 M2,5l3.1-3").attr({"stroke-width":.8,stroke:colors.glass,fill:"#fefefe"})});case"bar":return layers.walls.pattern(10,10,function(e){e.path("M5.8,9.2h-5V0.8h5V9.2z").attr({"stroke-width":1.4,stroke:"brown",fill:"#fefefe"})})}return!1};let j=function(e){this.s=e.s,this.e=e.e,this.s_bak=e.s_bak,this.e_bak=e.e_bak,this.links={},this.links.s=null,this.links.so=null,this.links.si=null,this.links.e=null,this.links.eo=null,this.links.ei=null,this.pos_s=e.pos_s,this.pos_e=e.pos_e,this.free={},this.axis_nodes=[],this.axis_lines=[],this.depth=e.depth,this.role=e.role,e.patch?this.patch=e.patch:this.patch=!1,e.material?this.material=e.material:this.material=material,this.label=e.label,e.outer_depth?this.outer_depth=e.outer_depth:this.outer_depth=this.depth/2,e.inner_depth?this.inner_depth=e.inner_depth:this.inner_depth=this.depth/2,this.outer_depth>this.inner_depth&&(this.aligned="L"),this.outer_depth===this.inner_depth&&(this.aligned="center"),this.outer_depth<this.inner_depth&&(this.aligned="R"),this.height=params.total_height,e.part?this.part=!0:this.part=!1,e.pillar?this.pillar=e.pillar:this.pillar=!1,e.id?this.id=e.id:this.id=LIB.id(),this.pillar_part=void 0,this.parts=[],this.walls_s=[],this.walls_e=[],this.s_node=null,this.e_node=null,this.s_birthplace=null,this.selected=!1,this.axis={s:this.s,e:this.e},this.roomO=null,this.roomI=null,this.points={},this.controlLines={},this.borders={},this.wallItems=[],e.ventHoles?this.ventHoles=e.ventHoles:this.ventHoles=[],this.ps_break_wall=!1,this.pe_break_wall=!1,this.MICROBORDERS=layers.walls.group(),this.border_attr={stroke:this.borderColor,"stroke-width":1.4},this.pattern=!1,"glass"!==this.material&&"bar"!==this.material||(this.pattern=new WallPattern(this.material).addClass("CustomPattern")),"init"===this.label&&(this.material="none"),this.init()};function Oe(){"eraser"===tool&&(this.toolBackup=tool),"break"===tool&&(this.toolBackup=tool),warning.hide(),$(".contextmenu").hide(),project.paint(),pointJoystick.fire("off"),wallControls.fire("off"),doorControl.fire("off"),windowControl.fire("off"),z.reset(),magnets2.hide(),hide(),signs.reset(),this.toolBackup&&(tool=this.toolBackup),this.toolBackup=void 0}j.prototype.init=function(e=!0){this.erase(),this.parts=[],this.index=get_wall_index(this.id),this.parts_points=[],this.calc(),this.collect_points();for(let e=0;e<this.parts_points.length-1;e++){var t=this.parts_points[e].xy,i=this.parts_points[e+1].xy,n=this.parts_points[e].role;this.parts[e]=new o(t,i,n,this)}1==e&&this.draw()},j.prototype.get_point_bak=function(e){var t=get_big_line(this.axis),i=get_big_line({s:e.r1,e:e.r2}),e=get_big_line({s:e.l1,e:e.l2}),i=line_and_line_intersection(t,i),t=line_and_line_intersection(t,e);if(i&&t){var e=get_distance(this.c,i),n=get_distance(this.c,t);if(n<e)return i;if(e<n)return t}return!1},j.prototype.bind=function(e){function t(t){let i=[];e:for(let e=0;e<t.length;e++){var n=t[e];for(let e=0;e<i.length;e++)if(i[e].wall===n.wall)continue e;i.push(n)}return i}function i(t){function e(e,t){return e.angle-t.angle}let i=[],n=[],s=[];for(let e=0;e<t.length;e++)"axis"===t[e].place&&(i.push(t[e]),n.push(t[e])),"L"===t[e].place&&i.push(t[e]),"R"===t[e].place&&n.push(t[e]);return n.sort(e),i.sort(e),0<i.length&&0<n.length&&(s[0]=i[0],s[1]=n[0]),0===i.length&&0<n.length&&(s[0]=n[0],s[1]=n[1]),0<i.length&&0===n.length&&(s[0]=i[0],s[1]=i[1]),s}if(this.links.s=null,this.links.so=null,this.links.si=null,this.links.e=null,this.links.eo=null,this.links.ei=null,this.walls_s=[],this.walls_e=[],this.s_node=null,this.e_node=null,this.isAvailable()){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var n,s,o,l,r,a;e.id!==this.id&&e.isAvailable()&&!is_line_on_line(this.axis,e.axis)&&LIB.lineLength(e)>this.depth+2&&(n=get_short_line(e.axis,this.depth/2+1),a=get_short_line(e.EdgeO,this.depth/2+1),s=get_short_line(e.EdgeI,this.depth/2+1),r=is_point_on_line(this.s,a),o=is_point_on_line(this.s,s),l=is_point_on_line(this.s,n),(r||o||l)&&(r=get_point_place(this.e,e.axis),this.links.s={object:"wall",id:e.id,index:t,side:r},this.links.so={object:"wall",id:e.id,index:t,side:r},this.links.si={object:"wall",id:e.id,index:t,side:r},this.walls_s=[]),o=is_point_on_line(this.e,a),l=is_point_on_line(this.e,s),r=is_point_on_line(this.e,n),(o||l||r)&&(a=get_point_place(this.s,e.axis),this.links.e={object:"wall",id:e.id,index:t,side:a},this.links.eo={object:"wall",id:e.id,index:t,side:a},this.links.ei={object:"wall",id:e.id,index:t,side:a},this.walls_e=[]))}for(let t=0;t<pillars.db.length;t++){var h=pillars.db[t];if("pillar"===h.role){let e=!1;if(is_point_close_to_line(this.s,h.edge_t)?e="T":is_point_close_to_line(this.s,h.edge_r)?e="R":is_point_close_to_line(this.s,h.edge_b)?e="B":is_point_close_to_line(this.s,h.edge_l)&&(e="L"),e){this.links.s={object:"pillar",id:h.id,index:t,side:e},this.links.so={object:"pillar",id:h.id,index:t,side:e},this.links.si={object:"pillar",id:h.id,index:t,side:e};break}}}for(let t=0;t<pillars.db.length;t++){var g=pillars.db[t];if("pillar"===g.role){let e=!1;if(is_point_close_to_line(this.e,g.edge_t)?e="T":is_point_close_to_line(this.e,g.edge_r)?e="R":is_point_close_to_line(this.e,g.edge_b)?e="B":is_point_close_to_line(this.e,g.edge_l)&&(e="L"),e){this.links.e={object:"pillar",id:g.id,index:t,side:e},this.links.eo={object:"pillar",id:g.id,index:t,side:e},this.links.ei={object:"pillar",id:g.id,index:t,side:e};break}}}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id!==this.id&&e.isAvailable()&&(null===this.links.s&&(are_points_equal(this.s,e.s)&&(this.walls_s.push({wall:t,id:e.id,type:"s",label:e.label,role:e.role,angle:get_angle(e.e,this.s,this.e,"deg"),place:get_point_place(e.e,this.axis)}),this.s_node=this.s),are_points_equal(this.s,e.e)&&(this.walls_s.push({wall:t,id:e.id,type:"e",label:e.label,role:e.role,angle:get_angle(e.s,this.s,this.e,"deg"),place:get_point_place(e.s,this.axis)}),this.s_node=this.s)),null===this.links.e&&(are_points_equal(this.e,e.s)&&(this.walls_e.push({wall:t,id:e.id,type:"s",label:e.label,role:e.role,angle:get_angle(e.e,this.e,this.s,"deg"),place:get_point_place(e.e,this.axis)}),this.e_node=this.e),are_points_equal(this.e,e.e)&&(this.walls_e.push({wall:t,id:e.id,type:"e",label:e.label,role:e.role,angle:get_angle(e.s,this.e,this.s,"deg"),place:get_point_place(e.s,this.axis)}),this.e_node=this.e)))}this.walls_s=t(this.walls_s),this.walls_e=t(this.walls_e),2<this.walls_s.length&&(this.walls_s=i(this.walls_s)),2<this.walls_e.length&&(this.walls_e=i(this.walls_e)),2===this.walls_s.length&&(void 0===this.walls_s[0]&&this.walls_s.splice(0,1),void 0===this.walls_s[1]&&this.walls_s.splice(1,1)),2===this.walls_e.length&&(void 0===this.walls_e[0]&&this.walls_e.splice(0,1),void 0===this.walls_e[1]&&this.walls_e.splice(1,1))}},j.prototype.get_lines_a=function(){let i=[];i.push({coords:this.s,distance:0,free:!0}),i.push({coords:this.e,distance:get_distance(this.s,this.e),free:!0});for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id!==this.id&&e.isAvailable()&&(null!==e.links.s&&e.links.s.id===this.id&&i.push({coords:e.s,distance:get_distance(this.s,e.s),free:!0}),null!==e.links.e&&e.links.e.id===this.id&&i.push({coords:e.e,distance:get_distance(this.s,e.e),free:!0}))}for(let e=0;e<windows.db.length;e++){var t=windows.db[e];t.id_wall===this.id&&(i.push({coords:t.s,distance:get_distance(this.s,t.s),free:!1}),i.push({coords:t.e,distance:get_distance(this.s,t.s),free:!0}))}for(let e=0;e<doors.db.length;e++){var n=doors.db[e];n.id_wall===this.id&&(i.push({coords:n.s,distance:get_distance(this.s,n.s),free:!1}),i.push({coords:n.e,distance:get_distance(this.s,n.s),free:!0}))}if(i.sort(compare_distances),2<i.length)for(let e=0;e<i.length-1;e++){var s,o;i[e]&&i[e+1]&&(s=i[e].coords,o=i[e+1].coords,are_points_equal(s,o)&&(!0===i[e].free&&(i.splice(e,1),e--),!0===i[e+1].free&&(i.splice(e+1,1),e--)))}this.LinesA=[];for(let e=0;e<i.length-1;e++){var l;i[e].free&&(l=get_line(i[e].coords,i[e+1].coords),this.LinesA.push(l))}},j.prototype.get_points_on_edge=function(e){let o,l,r;"O"===e&&(o=this.EdgeO,l=this.points.o,r=this.controlLines.o),"I"===e&&(o=this.EdgeI,l=this.points.i,r=this.controlLines.i),"S"===e&&(o=this.EdgeS,l=this.points.s,r=this.controlLines.s),"E"===e&&(o=this.EdgeE,l=this.points.e,r=this.controlLines.e);for(let e=0;e<walls.db.length;e++){let s=walls.db[e];if(s.id!==this.id&&s.isAvailable()){let e=!1,t=!1,i=!1,n=!1;is_point_on_line(s.l1,o)&&(l.push({coords:s.l1,distance:get_distance(s.l1,o.s)}),i=!0,e=!0),is_point_on_line(s.r1,o)&&(l.push({coords:s.r1,distance:get_distance(s.r1,o.s)}),i=!0,t=!0),is_point_on_line(s.l2,o)&&(l.push({coords:s.l2,distance:get_distance(s.l2,o.s)}),n=!0,e=!0),is_point_on_line(s.r2,o)&&(l.push({coords:s.r2,distance:get_distance(s.r2,o.s)}),n=!0,t=!0),e&&r.push(s.EdgeO),t&&r.push(s.EdgeI),i&&r.push(s.EdgeS),n&&r.push(s.EdgeE)}}let t,i;"init"!==plan&&"break"!==plan||(t="pillar",i="no-role"),"build"===plan&&(t="pillar",i="gypsum");for(let e=0;e<pillars.db.length;e++){var s=pillars.db[e];if(s.role===t||s.role===i){let e=!1,t=!1,i=!1,n=!1;is_point_on_line(s.p1,o)&&(l.push({coords:s.p1,distance:get_distance(s.p1,o.s)}),n=!0,e=!0),is_point_on_line(s.p2,o)&&(l.push({coords:s.p2,distance:get_distance(s.p2,o.s)}),e=!0,t=!0),is_point_on_line(s.p3,o)&&(l.push({coords:s.p3,distance:get_distance(s.p3,o.s)}),t=!0,i=!0),is_point_on_line(s.p4,o)&&(l.push({coords:s.p4,distance:get_distance(s.p4,o.s)}),i=!0,n=!0),e&&r.push(s.edge_t),t&&r.push(s.edge_r),i&&r.push(s.edge_b),n&&r.push(s.edge_l)}}l.sort(compare_distances)},j.prototype.get_borders_o=function(){this.points.o=[],this.borders.o=[],this.controlLines.o=[],this.points.o.push({coords:this.l1,distance:0}),this.points.o.push({coords:this.l2,distance:get_distance(this.l1,this.l2)}),this.get_points_on_edge("O");for(let e=0;e<this.points.o.length-1;e++){let i=get_line(this.points.o[e].coords,this.points.o[e+1].coords);if(i.type="L",.1<LIB.lineLength(i)){let t=!0;for(let e=0;e<this.controlLines.o.length;e++){var n=this.controlLines.o[e];if(is_line_over_line(i,n)){t=!1;break}}t&&this.borders.o.push(i)}}},j.prototype.get_borders_i=function(){this.points.i=[],this.borders.i=[],this.controlLines.i=[],this.points.i.push({coords:this.r1,distance:0}),this.points.i.push({coords:this.r2,distance:get_distance(this.r1,this.r2)}),this.get_points_on_edge("I");for(let e=0;e<this.points.i.length-1;e++){var t=this.points.i[e].coords,n=this.points.i[e+1].coords;let i=get_line(t,n);if(i.c=get_center(t,n),i.type="R",.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<this.controlLines.i.length;e++){var s=this.controlLines.i[e];if(is_point_between_line_points(i.c,s)){t=!1;break}}t&&this.borders.i.push(i)}}},j.prototype.get_borders_s=function(){if(this.points.s=[],this.borders.s=[],this.controlLines.s=[],null===this.links.so&&0===this.walls_s.length){this.points.s.push({coords:this.l1,distance:0}),this.points.s.push({coords:this.r1,distance:get_distance(this.l1,this.r1)}),this.get_points_on_edge("S");for(let e=0;e<this.points.s.length-1;e++){let i=get_line(this.points.s[e].coords,this.points.s[e+1].coords);if(i.type="L",.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<this.controlLines.s.length;e++){var n=this.controlLines.s[e];if(is_line_over_line(i,n)){t=!1;break}}t&&this.borders.s.push(i)}}}else if(this.points.s.push({coords:this.l1,distance:0}),this.points.s.push({coords:this.r1,distance:get_distance(this.l1,this.r1)}),this.get_points_on_edge("S"),2<this.points.s.length){for(let e=0;e<this.points.s.length-1;e++){let i=get_line(this.points.s[e].coords,this.points.s[e+1].coords);if(i.type="L",.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<this.controlLines.s.length;e++){var s=this.controlLines.s[e];if(is_line_over_line(i,s)){t=!1;break}}t&&this.borders.s.push(i)}}1===this.borders.s.length&&are_lines_equal(this.borders.s[0],this.EdgeS)&&(this.borders.s=[])}else this.points.s=[]},j.prototype.get_borders_e=function(){if(this.points.e=[],this.borders.e=[],this.controlLines.e=[],null===this.links.eo&&0===this.walls_e.length){this.points.e.push({coords:this.l2,distance:0}),this.points.e.push({coords:this.r2,distance:get_distance(this.l2,this.r2)}),this.get_points_on_edge("E");for(let e=0;e<this.points.e.length-1;e++){let i=get_line(this.points.e[e].coords,this.points.e[e+1].coords);if(i.type="R",.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<this.controlLines.e.length;e++){var n=this.controlLines.e[e];if(is_line_over_line(i,n)){t=!1;break}}t&&this.borders.e.push(i)}}}else if(this.points.e.push({coords:this.l2,distance:0}),this.points.e.push({coords:this.r2,distance:get_distance(this.l2,this.r2)}),this.get_points_on_edge("E"),2<this.points.e.length){for(let e=0;e<this.points.e.length-1;e++){let i=get_line(this.points.e[e].coords,this.points.e[e+1].coords);if(i.type="R",.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<this.controlLines.e.length;e++){var s=this.controlLines.e[e];if(is_line_over_line(i,s)){t=!1;break}}t&&this.borders.e.push(i)}}1===this.borders.e.length&&are_lines_equal(this.borders.e[0],this.EdgeE)&&(this.borders.e=[])}else this.points.e=[]},j.prototype.get_adjoining_rooms=function(){this.sO_R1=null,this.sI_R1=null,this.eO_R1=null,this.eI_R1=null;for(let t=0;t<rooms1.data.length;t++){var i=rooms1.data[t];for(let e=0;e<i.points.length;e++){var n=i.polygon[e];n&&(are_points_equal(this.l1,n)&&(this.sO_R1={room:t,point:e}),are_points_equal(this.l2,n)&&(this.eO_R1={room:t,point:e}),are_points_equal(this.r1,n)&&(this.sI_R1={room:t,point:e}),are_points_equal(this.r2,n)&&(this.eI_R1={room:t,point:e}))}}this.sO_R2=null,this.sI_R2=null,this.eO_R2=null,this.eI_R2=null;for(let t=0;t<rooms2.data.length;t++){var s=rooms2.data[t];for(let e=0;e<s.points.length;e++){var o=s.polygon[e];o&&(are_points_equal(this.l1,o)&&(this.sO_R2={room:t,point:e}),are_points_equal(this.l2,o)&&(this.eO_R2={room:t,point:e}),are_points_equal(this.r1,o)&&(this.sI_R2={room:t,point:e}),are_points_equal(this.r2,o)&&(this.eI_R2={room:t,point:e}))}}},j.prototype.move_adjoining_rooms=function(){if(null!==this.sO_R1){var t=this.sO_R1.room,i=this.sO_R1.point;let e=rooms1.data[t];e.points[i]=copy.point(this.l1),"init"===plan&&e.redraw()}if(null!==this.eO_R1){t=this.eO_R1.room,i=this.eO_R1.point;let e=rooms1.data[t];e.points[i]=copy.point(this.l2),"init"===plan&&e.redraw()}if(null!==this.sI_R1){t=this.sI_R1.room,i=this.sI_R1.point;let e=rooms1.data[t];e.points[i]=copy.point(this.r1),"init"===plan&&e.redraw()}if(null!==this.eI_R1){t=this.eI_R1.room,i=this.eI_R1.point;let e=rooms1.data[t];e.points[i]=copy.point(this.r2),"init"===plan&&e.redraw()}if(null!==this.sO_R2){t=this.sO_R2.room,i=this.sO_R2.point;let e=rooms2.data[t];e.points[i]=copy.point(this.l1),"build"===plan&&e.redraw()}if(null!==this.eO_R2){t=this.eO_R2.room,i=this.eO_R2.point;let e=rooms2.data[t];e.points[i]=copy.point(this.l2),"build"===plan&&e.redraw()}if(null!==this.sI_R2){t=this.sI_R2.room,i=this.sI_R2.point;let e=rooms2.data[t];e.points[i]=copy.point(this.r1),"build"===plan&&e.redraw()}if(null!==this.eI_R2){t=this.eI_R2.room,i=this.eI_R2.point;let e=rooms2.data[t];e.points[i]=copy.point(this.r2),"build"===plan&&e.redraw()}},j.prototype.get_connected_walls=function(){this.connected_walls=[];for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.connected=!1;var i=are_points_equal(this.s,e.s)||are_points_equal(this.s,e.e),n=are_points_equal(this.e,e.s)||are_points_equal(this.e,e.e);(i||n)&&(e.connected=!0,this.connected_walls.push(t))}for(let t=0;t<this.connected_walls.length;t++){let e=walls.db[this.connected_walls[t]];e.get_adjoining_rooms()}},j.prototype.move_connected_walls=function(){for(let t=0;t<this.connected_walls.length;t++){let e=walls.db[this.connected_walls[t]];e.move_adjoining_rooms()}},j.prototype.get_orientation=function(){var e=0<=Math.abs(this.s.x-this.e.x)&&Math.abs(this.s.x-this.e.x)<.1&&this.s.y!==this.e.y,t=0<=Math.abs(this.s.y-this.e.y)&&Math.abs(this.s.y-this.e.y)<.1&&this.s.x!==this.e.x;this.orientation="D",!0==e&&(this.orientation="V"),!0==t&&(this.orientation="H")},j.prototype.get_linked_walls=function(){var e;this.parent_walls=[],this.links.s&&"wall"===this.links.s.object&&(e=this.links.s.index,this.parent_walls.push(e)),this.links.e&&"wall"===this.links.e.object&&(e=this.links.e.index,this.parent_walls.push(e)),this.child_walls=[];for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id!==this.id&&e.isAvailable()&&(null!==e.links.s&&e.links.s.id===this.id&&(e.collectItems(),this.child_walls.push({index:t,end:"S"})),null!==e.links.e&&e.links.e.id===this.id&&(e.collectItems(),this.child_walls.push({index:t,end:"E"})))}this.s_connected_walls=[],this.e_connected_walls=[];for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id!==this.id&&e.isAvailable()&&(are_points_equal(this.s,e.s)&&(e.collectItems(),this.s_connected_walls.push({index:t,end:"s"})),are_points_equal(this.s,e.e)&&(e.collectItems(),this.s_connected_walls.push({index:t,end:"e"})),are_points_equal(this.e,e.s)&&(e.collectItems(),this.e_connected_walls.push({index:t,end:"s"})),are_points_equal(this.e,e.e)&&(e.collectItems(),this.e_connected_walls.push({index:t,end:"e"})))}},j.prototype.get_linked_pillars=function(){var e;this.spillar=!1,this.epillar=!1,null!==this.links.s&&"pillar"===this.links.s.object&&(e=this.links.s.index,this.spillar=pillars.db[e]),null!==this.links.e&&"pillar"===this.links.e.object&&(e=this.links.e.index,this.epillar=pillars.db[e])},j.prototype.get_linked_windows=function(){this.linked_windows=[];for(let e=0;e<windows.db.length;e++){var t=windows.db[e];t.id_wall===this.id&&this.linked_windows.push({index:e,distance:get_distance(this.s,t.center)})}},j.prototype.get_linked_doors=function(){this.linked_doors=[];for(let e=0;e<doors.db.length;e++){var t=doors.db[e];t.id_wall===this.id&&this.linked_doors.push({index:e,distance:get_distance(this.s,t.center)})}},j.prototype.move_linked_walls=function(){if(0<this.parent_walls.length)for(let t=0;t<this.parent_walls.length;t++){var i=this.parent_walls[t];let e=walls.db[i];e.draw()}if(0<this.child_walls.length)for(let t=0;t<this.child_walls.length;t++){var n,s=this.child_walls[t];let e=walls.db[s.index];"S"!==s.end||(n=line_and_line_intersection(get_big_line(this.axis),get_big_line(e.axis)))&&(e.s=copy.point(n),e.draw(),this.draw()),"E"!==s.end||(n=line_and_line_intersection(get_big_line(this.axis),get_big_line(e.axis)))&&(e.e=copy.point(n),e.draw(),this.draw())}for(let t=0;t<this.s_connected_walls.length;t++){var o=this.s_connected_walls[t].index,l=this.s_connected_walls[t].end;let e=walls.db[o];"s"===l&&(e.s=copy.point(this.s)),"e"===l&&(e.e=copy.point(this.s)),e.draw(),e.drawConnectedWalls("all")}for(let t=0;t<this.e_connected_walls.length;t++){var r=this.e_connected_walls[t].index,a=this.e_connected_walls[t].end;let e=walls.db[r];"s"===a&&(e.s=copy.point(this.e)),"e"===a&&(e.e=copy.point(this.e)),e.draw(),e.drawConnectedWalls("all")}},j.prototype.move_linked_pillars=function(){this.spillar&&this.spillar.draw(),this.epillar&&this.epillar.draw()},j.prototype.move_linked_windows=function(){if(0!==this.linked_windows.length){for(let t=0;t<this.linked_windows.length;t++){var i=this.linked_windows[t].index,n=this.linked_windows[t].distance;let e=windows.db[i];e.center=LIB.pointOnLine(this.e,this.s,-n),e.draw()}this.init()}},j.prototype.move_linked_doors=function(){if(0!==this.linked_doors.length){for(let t=0;t<this.linked_doors.length;t++){var i=this.linked_doors[t].index,n=this.linked_doors[t].distance;let e=doors.db[i];e.center=LIB.pointOnLine(this.e,this.s,-n),e.draw()}this.init()}},j.prototype.get_moving_limits=function(e){let o;if("S"===e&&(o=this.s),"C"===e&&(o=this.c),"E"===e&&(o=this.e),this.x_min=-1e5,this.x_max=1e5,this.y_min=-1e5,this.y_max=1e5,"C"===e){let n=[],s=[];for(let e=0;e<this.walls_s.length;e++){var t=this.walls_s[e].wall,t=walls.db[t];n.push(t.s.x),s.push(t.s.y),n.push(t.e.x),s.push(t.e.y)}for(let e=0;e<this.walls_e.length;e++){var i=this.walls_e[e].wall,i=walls.db[i];n.push(i.s.x),s.push(i.s.y),n.push(i.e.x),s.push(i.e.y)}for(let e=0;e<this.parent_walls.length;e++){var l=this.parent_walls[e],l=walls.db[l];n.push(l.s.x),s.push(l.s.y),n.push(l.e.x),s.push(l.e.y)}for(let e=0;e<this.child_walls.length;e++){var r=this.child_walls[e].index,r=walls.db[r];n.push(r.s.x),s.push(r.s.y),n.push(r.e.x),s.push(r.e.y)}if(0<n.length){let t=[],i=[];for(let e=0;e<n.length;e++)n[e]>o.x+5&&i.push(n[e]),n[e]<o.x-5&&t.push(n[e]);this.x_min=Math.max.apply(null,t)+20,this.x_max=Math.min.apply(null,i)-20}if(0<s.length){let t=[],i=[];for(let e=0;e<s.length;e++)s[e]<o.y-5&&t.push(s[e]),s[e]>o.y+5&&i.push(s[e]);this.y_min=Math.max.apply(null,t)+20,this.y_max=Math.min.apply(null,i)-20}var a;null!==this.links.s&&"pillar"===this.links.s.object&&(e=this.links.s.index,e=pillars.db[e],"T"===(a=this.links.s.side)&&(this.x_min=LIB.pointOnLine(e.p2,e.p1,-this.outer_depth).x,this.x_max=LIB.pointOnLine(e.p1,e.p2,-this.inner_depth).x),"R"===a&&(this.y_min=LIB.pointOnLine(e.p3,e.p2,-this.outer_depth).y,this.y_max=LIB.pointOnLine(e.p2,e.p3,-this.inner_depth).y),"B"===a&&(this.x_min=LIB.pointOnLine(e.p3,e.p4,-this.inner_depth).x,this.x_max=LIB.pointOnLine(e.p4,e.p3,-this.outer_depth).x),"L"===a&&(this.y_min=LIB.pointOnLine(e.p4,e.p1,-this.inner_depth).y,this.y_max=LIB.pointOnLine(e.p1,e.p4,-this.outer_depth).y)),null!==this.links.e&&"pillar"===this.links.e.object&&(a=this.links.e.index,e=pillars.db[a],"T"===(a=this.links.e.side)&&(this.x_min=LIB.pointOnLine(e.p2,e.p1,-this.outer_depth).x,this.x_max=LIB.pointOnLine(e.p1,e.p2,-this.inner_depth).x),"R"===a&&(this.y_min=LIB.pointOnLine(e.p3,e.p2,-this.outer_depth).y,this.y_max=LIB.pointOnLine(e.p2,e.p3,-this.inner_depth).y),"B"===a&&(this.x_min=LIB.pointOnLine(e.p3,e.p4,-this.inner_depth).x,this.x_max=LIB.pointOnLine(e.p4,e.p3,-this.outer_depth).x),"L"===a&&(this.y_min=LIB.pointOnLine(e.p4,e.p1,-this.inner_depth).y,this.y_max=LIB.pointOnLine(e.p1,e.p4,-this.outer_depth).y)),"V"===this.orientation&&(me.plot(this.x_min,-1e4,this.x_min,1e4).show(),fe.plot(this.x_max,-1e4,this.x_max,1e4).show()),"H"===this.orientation&&(me.plot(-1e4,this.y_min,1e4,this.y_min).show(),fe.plot(-1e4,this.y_max,1e4,this.y_max).show())}},j.prototype.force_connection=function(i){let e,n,s=("s"===i&&(e=this.s,n=this.e),"e"===i&&(e=this.e,n=this.s),[]);for(let e=0;e<walls.db.length;e++){var t,o,l=walls.db[e];l.id===this.id||"init_copy"===l.label||"build"===l.label&&"init"===plan||"break"===l.label&&"build"===plan||is_point_on_line(n,l)||(t=line_and_line_intersection(this,l))&&(o=get_distance(n,t),s.push({object:"wall",coords:t,distance:o,wall:l}))}for(let e=0;e<pillars.db.length;e++){var r=pillars.db[e];if("init"!==this.label||"pillar"===r.role){if("build"===this.label){if("pillar_air"===r.role)continue;if("pillar_water"===r.role)continue}var a,h,g=line_and_line_intersection(this,r.edge_t),g=(g&&(a=get_distance(n,g),s.push({object:"pillar",coords:g,distance:a,edge:r.edge_t,pillar:r})),line_and_line_intersection(this,r.edge_r)),g=(g&&(a=get_distance(n,g),s.push({object:"pillar",coords:g,distance:a,edge:r.edge_r,pillar:r})),line_and_line_intersection(this,r.edge_b)),g=(g&&(h=get_distance(n,g),s.push({object:"pillar",coords:g,distance:h,edge:r.edge_b,pillar:r})),line_and_line_intersection(this,r.edge_l));g&&(h=get_distance(n,g),s.push({object:"pillar",coords:g,distance:h,edge:r.edge_l,pillar:r}))}}let _=!1;if(0<s.length){if(console.warn("Перелет"),s.sort(compare_distance),"wall"===s[0].object){var d=s[0].coords;let t=s[0].wall;if(!is_point_on_line(n,t)){var p=LIB.pointOnLine(t.e,t.s,-this.depth),c=LIB.pointOnLine(t.s,t.e,-this.depth),A=get_line(t.s,p),u=get_line(t.e,c),p=get_line(p,c);let e;is_point_on_line(d,A)?t.free.s?(c=line_and_line_intersection(get_big_line(this),get_big_line(t)),e=copy.point(c),t.s=copy.point(c)):(t.s=copy.point(d),_=!0):is_point_on_line(d,u)?t.free.e?(A=line_and_line_intersection(get_big_line(this),get_big_line(t)),e=copy.point(A),t.e=copy.point(A)):(t.e=copy.point(d),_=!0):is_point_on_line(d,p)&&(e=copy.point(d)),e&&("s"===i&&(this.s=copy.point(e),this.s_bak=void 0),"e"===i&&(this.e=copy.point(e),this.e_bak=void 0))}}if("pillar"===s[0].object){let e=s[0].coords;c=s[0].edge;let t=s[0].pillar;"L"===get_point_place(n,c)&&(u=get_big_line(c,1e3,1e3),A=get_distance(line_and_line_intersection(this.EdgeO,u),line_and_line_intersection(this.EdgeI,u))/2,get_distance(e,c.s)<A&&(e=LIB.pointOnLine(c.e,c.s,-A)),get_distance(e,c.e)<A&&(e=LIB.pointOnLine(c.s,c.e,-A)),"s"===i&&(this.s=copy.point(e)),"e"===i&&(this.e=copy.point(e)),this.draw(),t.draw())}}0===(s=_?[]:s).length&&("s"===i&&this.free.s&&this.force_connection_simple("s"),"e"===i&&this.free.e&&this.force_connection_simple("e"));for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if(e.id!==this.id&&("init_copy"!==e.label&&("init"!==plan||"build"!==e.label))){if("build"===plan){if("init"===e.label)continue;if("break"===e.label)continue}var w,m,f,I,C=get_big_line(e,100);e.free.s&&(m=get_point_to_line_distance(e.s,this),f=get_point_place(e.s,this),w=get_point_place(e.e,this),("L"===f&&"L"===w||"R"===f&&"R"===w)&&(f=this.outer_depth+20,1<=m&&m<=f&&(e.s=line_and_line_intersection(C,this),e.s_bak=void 0,e.calc()))),e.free.e&&(w=get_point_to_line_distance(e.e,this),m=get_point_place(e.s,this),f=get_point_place(e.e,this),("L"===m&&"L"===f||"R"===m&&"R"===f)&&(I=this.outer_depth+20,1<=w&&w<=I&&(e.e=line_and_line_intersection(C,this),e.e_bak=void 0,e.calc())))}}},j.prototype.force_connection_simple=function(n){let s,o;"s"===n&&(s=this.s,o=this.e),"e"===n&&(s=this.e,o=this.s);for(let e=0;e<walls.db.length;e++){let i=walls.db[e];if(i.id!==this.id&&("init_copy"!==i.label&&!("build"===i.label&&"init"===plan||"break"===i.label&&"build"===plan||is_point_on_line(o,i)))){var l=get_two_lines_angle(this,i),r=l<5||175<l;if("1lt0ixz"===i.id&&console.warn(i.id,l,r),r){var l=is_point_over_polygon(s,i.polygon),t=is_point_between_line_points(i.c,this);if(l||t)return(l=get_distance(o,i.s))<(t=get_distance(o,i.e))&&("s"===n&&(this.s=copy.point(i.s)),"e"===n&&(this.e=copy.point(i.s))),t<l&&("s"===n&&(this.s=copy.point(i.e)),"e"===n&&(this.e=copy.point(i.e))),void this.calc()}if(!r){var t=LIB.pointOnLine(i.e,i.s,-this.depth),l=LIB.pointOnLine(i.s,i.e,-this.depth),r=get_line(i.s,t),a=get_line(i.e,l),l=get_line(t,l),h=get_big_line(this,100),g=get_big_line(i.axis,100),h=line_and_line_intersection(h,g);if(h){var g=get_point_place(o,g);let e;"L"===g&&(e=i.outer_depth+20),"R"===g&&(e=i.inner_depth+20);let t;get_distance(h,s)<e&&(is_point_on_line(h,r)?i.free.s?(g=line_and_line_intersection(get_big_line(this),get_big_line(i)),t=copy.point(g),i.s=copy.point(g)):i.links.s&&"pillar"===i.links.s.object||(t=copy.point(i.s)):is_point_on_line(h,a)?i.free.e?(r=line_and_line_intersection(get_big_line(this),get_big_line(i)),t=copy.point(r),i.e=copy.point(r)):i.links.e&&"pillar"===i.links.e.object||(t=copy.point(i.e)):is_point_on_line(h,l)&&(t=copy.point(h))),t&&("s"===n&&(this.s=copy.point(t),this.s_bak=void 0),"e"===n&&(this.e=copy.point(t),this.e_bak=void 0))}}}}for(let e=0;e<pillars.db.length;e++){let i=pillars.db[e];if("pillar"===i.role&&get_distance(s,i.center)<i.max_diagonal/2+10){let e,t;var _,d,p=LIB.projection(s,i.edge_t),c=(p&&get_distance(s,p)<20&&(30<(c=get_two_lines_angle(this,i.edge_t))&&c<150&&"L"===get_point_place(s,i.edge_t)&&(e=p,t=i.edge_t)),LIB.projection(s,i.edge_r)),p=(c&&get_distance(s,c)<20&&(30<(p=get_two_lines_angle(this,i.edge_r))&&p<150&&"L"===get_point_place(s,i.edge_r)&&(e=c,t=i.edge_r)),LIB.projection(s,i.edge_b)),A=(p&&get_distance(s,p)<20&&(30<(A=get_two_lines_angle(this,i.edge_b))&&A<150&&"L"===get_point_place(s,i.edge_b)&&(e=p,t=i.edge_b)),LIB.projection(s,i.edge_l));A&&get_distance(s,A)<20&&(30<(p=get_two_lines_angle(this,i.edge_l))&&p<150&&"L"===get_point_place(s,i.edge_l)&&(e=A,t=i.edge_l)),e&&(p=get_big_line(t,1e3,1e3),d=get_big_line(this.EdgeO,1e3,1e3),_=get_big_line(this.EdgeI,1e3,1e3),d=get_distance(line_and_line_intersection(d,p),line_and_line_intersection(_,p))/2,get_distance(e,t.s)<d&&(e=LIB.pointOnLine(t.e,t.s,-d)),get_distance(e,t.e)<d&&(e=LIB.pointOnLine(t.s,t.e,-d)),"s"===n&&(this.s=copy.point(e),this.s_bak=void 0),"e"===n&&(this.e=copy.point(e),this.e_bak=void 0),this.draw(),i.draw())}}},j.prototype.calc=function(r=!1){if(this.straight_o=get_parallel(this.s,this.e,this.outer_depth,"L"),this.straight_i=get_parallel(this.s,this.e,this.inner_depth,"R"),r&&!0===r){if(null!==this.links.so&&"pillar"===this.links.so.object){let t=pillars.db[this.links.so.index];if(t){let e;"T"===this.links.so.side&&(e=t.edge_t),"B"===this.links.so.side&&(e=t.edge_b),"R"===this.links.so.side&&(e=t.edge_r);r=get_big_line(e="L"===this.links.so.side?t.edge_l:e),r=get_distance(line_and_line_intersection(this.straight_o,r),line_and_line_intersection(this.straight_i,r))/2;get_distance(this.s,e.s)<3+r&&(this.s=LIB.pointOnLine(e.e,e.s,-r)),get_distance(this.s,e.e)<3+r&&(this.s=LIB.pointOnLine(e.s,e.e,-r)),t.draw()}}if(null!==this.links.e&&"pillar"===this.links.e.object){let t=pillars.db[this.links.e.index];if(t){let e;"T"===this.links.e.side&&(e=t.edge_t),"B"===this.links.e.side&&(e=t.edge_b),"R"===this.links.e.side&&(e=t.edge_r);r=get_big_line(e="L"===this.links.e.side?t.edge_l:e),r=get_distance(line_and_line_intersection(this.straight_o,r),line_and_line_intersection(this.straight_i,r))/2;get_distance(this.e,e.s)<3+r&&(this.e=LIB.pointOnLine(e.e,e.s,-r)),get_distance(this.e,e.e)<3+r&&(this.e=LIB.pointOnLine(e.s,e.e,-r)),t.draw()}}}if(this.l1=LIB.pointAtLinePoint(this,this.s,this.outer_depth,"L"),this.l2=LIB.pointAtLinePoint(this,this.e,this.outer_depth,"L"),this.r1=LIB.pointAtLinePoint(this,this.s,this.inner_depth,"R"),this.r2=LIB.pointAtLinePoint(this,this.e,this.inner_depth,"R"),this.c=get_center(this.s,this.e),this.axis={s:this.s,e:this.e},this.straight_o=get_parallel(this.s,this.e,this.outer_depth,"L"),this.straight_i=get_parallel(this.s,this.e,this.inner_depth,"R"),this.bind(params),1===this.walls_s.length&&(r=walls.db[this.walls_s[0].wall],h=this.walls_s[0].type,(a=is_line_on_line(this.axis,r.axis))||"s"!==h||(this.l1=line_and_line_intersection(this.straight_o,r.straight_i),this.r1=line_and_line_intersection(this.straight_i,r.straight_o)),a||"e"!==h||(this.l1=line_and_line_intersection(this.straight_o,r.straight_o),this.r1=line_and_line_intersection(this.straight_i,r.straight_i))),1===this.walls_e.length&&(a=this.walls_e[0].wall,h=walls.db[a],r=this.walls_e[0].type,(a=is_line_on_line(this.axis,h.axis,"_pvdr1x6ko"))||"s"!==r||(this.l2=line_and_line_intersection(this.straight_o,h.straight_o),this.r2=line_and_line_intersection(this.straight_i,h.straight_i)),a||"e"!==r||(this.l2=line_and_line_intersection(this.straight_o,h.straight_i),this.r2=line_and_line_intersection(this.straight_i,h.straight_o))),2===this.walls_s.length&&void 0!==this.walls_s[0]){let e,t,i,n,s,o,l;"_7tff0vi0b"===this.id&&console.warn(this.walls_s[0].angle,this.walls_s[1].angle),o=this.walls_s[0].angle<this.walls_s[1].angle?(e=walls.db[this.walls_s[0].wall],t=this.walls_s[0].type,i=this.walls_s[0].place,s=walls.db[this.walls_s[1].wall],this.walls_s[1].type):(e=walls.db[this.walls_s[1].wall],t=this.walls_s[1].type,i=this.walls_s[1].place,s=walls.db[this.walls_s[0].wall],this.walls_s[0].type),n=is_line_on_line(this.axis,e.axis),l=is_line_on_line(this.axis,s.axis),"s"===t&&"L"===i&&(n||(a=line_and_line_intersection(this.straight_o,e.straight_i))&&(this.l1=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_i,s.straight_o))&&(this.r1=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_i,s.straight_i))&&(this.r1=h)),"s"===t&&"R"===i&&(n||(a=line_and_line_intersection(this.straight_i,e.straight_o))&&(this.r1=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_o,s.straight_i))&&(this.l1=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_o,s.straight_o))&&(this.l1=h)),"e"===t&&"L"===i&&(n||(a=line_and_line_intersection(this.straight_o,e.straight_o))&&(this.l1=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_i,s.straight_o))&&(this.r1=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_i,s.straight_i))&&(this.r1=h)),"e"===t&&"R"===i&&(n||(a=line_and_line_intersection(this.straight_i,e.straight_i))&&(this.r1=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_o,s.straight_i))&&(this.l1=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_o,s.straight_o))&&(this.l1=h))}if(2===this.walls_e.length&&void 0!==this.walls_e[0]){let e,t,i,n,s,o,l;o=this.walls_e[0].angle<this.walls_e[1].angle?(e=walls.db[this.walls_e[0].wall],t=this.walls_e[0].type,i=this.walls_e[0].place,s=walls.db[this.walls_e[1].wall],this.walls_e[1].type):(e=walls.db[this.walls_e[1].wall],t=this.walls_e[1].type,i=this.walls_e[1].place,s=walls.db[this.walls_e[0].wall],this.walls_e[0].type),n=is_line_on_line(this.axis,e.axis),l=is_line_on_line(this.axis,s.axis),"s"===t&&"L"===i&&(n||(a=line_and_line_intersection(this.straight_o,e.straight_o))&&(this.l2=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_i,s.straight_i))&&(this.r2=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_i,s.straight_o))&&(this.r2=h)),"s"===t&&"R"===i&&(n||(a=line_and_line_intersection(this.straight_i,e.straight_i))&&(this.r2=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_o,s.straight_o))&&(this.l2=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_o,s.straight_i))&&(this.l2=h)),"e"===t&&"L"===i&&(n||(a=line_and_line_intersection(this.straight_o,e.straight_i))&&(this.l2=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_i,s.straight_i))&&(this.r2=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_i,s.straight_o))&&(this.r2=h)),"e"===t&&"R"===i&&(n||(a=line_and_line_intersection(this.straight_i,e.straight_o))&&(this.r2=a),l||"s"!==o||(r=line_and_line_intersection(this.straight_o,s.straight_o))&&(this.l2=r),l||"e"!==o||(h=line_and_line_intersection(this.straight_o,s.straight_i))&&(this.l2=h))}if(null!==this.links.so){if("pillar"===this.links.so.object){var a=pillars.db[this.links.so.index],r=this.links.so.side;let e;"T"===r?e=a.edge_t:"R"===r?e=a.edge_r:"B"===r?e=a.edge_b:"L"===r&&(e=a.edge_l),e&&(this.l1=line_and_line_intersection(this.straight_o,get_big_line(e)))}if("wall"===this.links.so.object){var h=walls.db[this.links.so.index],r=this.links.so.side;let e;"L"===r&&(e=h.EdgeO),(e="R"===r?h.EdgeI:e)&&(this.l1=line_and_line_intersection(this.straight_o,get_big_line(e)))}}if(null!==this.links.si){if("pillar"===this.links.si.object){a=pillars.db[this.links.si.index],r=this.links.si.side;let e;"T"===r?e=a.edge_t:"R"===r?e=a.edge_r:"B"===r?e=a.edge_b:"L"===r&&(e=a.edge_l),e&&(this.r1=line_and_line_intersection(this.straight_i,get_big_line(e)))}if("wall"===this.links.si.object){h=walls.db[this.links.si.index],r=this.links.si.side;let e;"L"===r&&(e=h.EdgeO),(e="R"===r?h.EdgeI:e)&&(this.r1=line_and_line_intersection(this.straight_i,get_big_line(e)))}}if(null!==this.links.eo){if("pillar"===this.links.eo.object){a=pillars.db[this.links.eo.index],r=this.links.eo.side;let e;"T"===r?e=a.edge_t:"R"===r?e=a.edge_r:"B"===r?e=a.edge_b:"L"===r&&(e=a.edge_l),e&&(this.l2=line_and_line_intersection(this.straight_o,get_big_line(e)))}if("wall"===this.links.eo.object){h=walls.db[this.links.eo.index],r=this.links.eo.side;let e;"L"===r&&(e=h.EdgeO),(e="R"===r?h.EdgeI:e)&&(this.l2=line_and_line_intersection(this.straight_o,get_big_line(e)))}}if(null!==this.links.ei){if("pillar"===this.links.ei.object){a=pillars.db[this.links.ei.index],r=this.links.ei.side;let e;"T"===r?e=a.edge_t:"R"===r?e=a.edge_r:"B"===r?e=a.edge_b:"L"===r&&(e=a.edge_l),e&&(this.r2=line_and_line_intersection(this.straight_i,get_big_line(e)))}if("wall"===this.links.ei.object){h=walls.db[this.links.ei.index],r=this.links.ei.side;let e;"L"===r&&(e=h.EdgeO),(e="R"===r?h.EdgeI:e)&&(this.r2=line_and_line_intersection(this.straight_i,get_big_line(e)))}}is_point_exists(this.l1)||(this.l1=LIB.pointAtLinePoint(this,this.s,this.outer_depth,"L")),is_point_exists(this.l2)||(this.l2=LIB.pointAtLinePoint(this,this.e,this.outer_depth,"L")),is_point_exists(this.r1)||(this.r1=LIB.pointAtLinePoint(this,this.s,this.inner_depth,"R")),is_point_exists(this.r2)||(this.r2=LIB.pointAtLinePoint(this,this.e,this.inner_depth,"R")),this.polygon=[{x:this.s.x,y:this.s.y},{x:this.l1.x,y:this.l1.y},{x:this.l2.x,y:this.l2.y},{x:this.e.x,y:this.e.y},{x:this.r2.x,y:this.r2.y},{x:this.r1.x,y:this.r1.y}],this.EdgeO={s:this.l1,e:this.l2},this.EdgeI={s:this.r1,e:this.r2},this.EdgeS={s:this.l1,e:this.r1},this.EdgeE={s:this.l2,e:this.r2};a=LIB.lineLength(this.EdgeO),r=LIB.lineLength(this.EdgeI);this.area={outer:R(a*this.height/1e4),inner:R(r*this.height/1e4)},this.l1=LIB.fixPoint(this.l1),this.r1=LIB.fixPoint(this.r1),this.l2=LIB.fixPoint(this.l2),this.r2=LIB.fixPoint(this.r2),0===this.walls_s.length&&(this.s_node=null),0===this.walls_e.length&&(this.e_node=null),this.get_lines_a(),this.get_borders_o(),this.get_borders_i(),this.get_borders_s(),this.get_borders_e(),this.length=LIB.lineLength(this.axis),this.free.s=!0,this.free.e=!0,0===this.walls_s.length&&null===this.links.s||(this.free.s=!1),0===this.walls_e.length&&null===this.links.e||(this.free.e=!1)},j.prototype.calc_only=function(){var e,t,i;if(this.l1=LIB.pointAtLinePoint(this,this.s,this.outer_depth,"L"),this.l2=LIB.pointAtLinePoint(this,this.e,this.outer_depth,"L"),this.r1=LIB.pointAtLinePoint(this,this.s,this.inner_depth,"R"),this.r2=LIB.pointAtLinePoint(this,this.e,this.inner_depth,"R"),this.c=get_center(this.s,this.e),this.straight_o=get_parallel(this.s,this.e,this.outer_depth,"L"),this.straight_i=get_parallel(this.s,this.e,this.inner_depth,"R"),1===this.walls_s.length&&(i=walls.db[this.walls_s[0].wall],t=this.walls_s[0].type,(e=is_line_on_line(this.axis,i.axis))||"s"!==t||(this.l1=line_and_line_intersection(this.straight_o,i.straight_i),this.r1=line_and_line_intersection(this.straight_i,i.straight_o)),e||"e"!==t||(this.l1=line_and_line_intersection(this.straight_o,i.straight_o),this.r1=line_and_line_intersection(this.straight_i,i.straight_i))),1===this.walls_e.length&&(e=walls.db[this.walls_e[0].wall],t=this.walls_e[0].type,(i=is_line_on_line(this.axis,e.axis))||"s"!==t||(this.l2=line_and_line_intersection(this.straight_o,e.straight_o),this.r2=line_and_line_intersection(this.straight_i,e.straight_i)),i||"e"!==t||(this.l2=line_and_line_intersection(this.straight_o,e.straight_i),this.r2=line_and_line_intersection(this.straight_i,e.straight_o))),2===this.walls_s.length){let e,t,i,n,s,o,l;o=this.walls_s[0].angle<this.walls_s[1].angle?(e=walls.db[this.walls_s[0].wall],t=this.walls_s[0].type,i=this.walls_s[0].place,s=walls.db[this.walls_s[1].wall],this.walls_s[1].type):(e=walls.db[this.walls_s[1].wall],t=this.walls_s[1].type,i=this.walls_s[1].place,s=walls.db[this.walls_s[0].wall],this.walls_s[0].type),n=is_line_on_line(this.axis,e.axis),l=is_line_on_line(this.axis,s.axis),"s"===t&&"L"===i&&(n||(this.l1=line_and_line_intersection(this.straight_o,e.straight_i)),l||"s"!==o||(this.r1=line_and_line_intersection(this.straight_i,s.straight_o)),l||"e"!==o||(this.r1=line_and_line_intersection(this.straight_i,s.straight_i))),"s"===t&&"R"===i&&(n||(this.r1=line_and_line_intersection(this.straight_i,e.straight_o)),l||"s"!==o||(this.l1=line_and_line_intersection(this.straight_o,s.straight_i)),l||"e"!==o||(this.l1=line_and_line_intersection(this.straight_o,s.straight_o))),"e"===t&&"L"===i&&(n||(this.l1=line_and_line_intersection(this.straight_o,e.straight_o)),l||"s"!==o||(this.r1=line_and_line_intersection(this.straight_i,s.straight_o)),l||"e"!==o||(this.r1=line_and_line_intersection(this.straight_i,s.straight_i))),"e"===t&&"R"===i&&(n||(this.r1=line_and_line_intersection(this.straight_i,e.straight_i)),l||"s"!==o||(this.l1=line_and_line_intersection(this.straight_o,s.straight_i)),l||"e"!==o||(this.l1=line_and_line_intersection(this.straight_o,s.straight_o)))}if(2===this.walls_e.length&&void 0!==this.walls_e[0]&&void 0!==this.walls_e[1]){let e,t,i,n,s,o,l;o=this.walls_e[0].angle<this.walls_e[1].angle?(e=walls.db[this.walls_e[0].wall],t=this.walls_e[0].type,i=this.walls_e[0].place,s=walls.db[this.walls_e[1].wall],this.walls_e[1].type):(e=walls.db[this.walls_e[1].wall],t=this.walls_e[1].type,i=this.walls_e[1].place,s=walls.db[this.walls_e[0].wall],this.walls_e[0].type),n=is_line_on_line(this.axis,e.axis),l=is_line_on_line(this.axis,s.axis),"s"===t&&"L"===i&&(n||(this.l2=line_and_line_intersection(this.straight_o,e.straight_o)),l||"s"!==o||(this.r2=line_and_line_intersection(this.straight_i,s.straight_i)),l||"e"!==o||(this.r2=line_and_line_intersection(this.straight_i,s.straight_o))),"s"===t&&"R"===i&&(n||(this.r2=line_and_line_intersection(this.straight_i,e.straight_i)),l||"s"!==o||(this.l2=line_and_line_intersection(this.straight_o,s.straight_o)),l||"e"!==o||(this.l2=line_and_line_intersection(this.straight_o,s.straight_i))),"e"===t&&"L"===i&&(n||(this.l2=line_and_line_intersection(this.straight_o,e.straight_i)),l||"s"!==o||(this.r2=line_and_line_intersection(this.straight_i,s.straight_i)),l||"e"!==o||(this.r2=line_and_line_intersection(this.straight_i,s.straight_o))),"e"===t&&"R"===i&&(n||(this.r2=line_and_line_intersection(this.straight_i,e.straight_o)),l||"s"!==o||(this.l2=line_and_line_intersection(this.straight_o,s.straight_o)),l||"e"!==o||(this.l2=line_and_line_intersection(this.straight_o,s.straight_i)))}this.EdgeO={s:this.l1,e:this.l2},this.EdgeI={s:this.r1,e:this.r2},this.polygon=[{x:this.s.x,y:this.s.y},{x:this.l1.x,y:this.l1.y},{x:this.l2.x,y:this.l2.y},{x:this.e.x,y:this.e.y},{x:this.r2.x,y:this.r2.y},{x:this.r1.x,y:this.r1.y}],this.free.s=!0,this.free.e=!0,0===this.walls_s.length&&null===this.links.s||(this.free.s=!1),0===this.walls_e.length&&null===this.links.e||(this.free.e=!1)},j.prototype.collect_points=function(){if(!(this.parts_points=[])===this.patch){for(let t=0;t<doors.db.length;t++){let e=doors.db[t];if("init"===this.label||"break"===this.label){if(("init"===plan||"break"===plan)&&"build"===e.plan)continue;if(("build"===plan||"B"===plan_group)&&1==e.hasReplacement)continue}if("build"===this.label){if("init"===e.plan)continue;if(!0===e.demount)continue}is_point_inside_polygon(e.center,this.polygon)&&(e.id_wall=this.id,"door_coupe"===e.type?("inner_left"!==e.opening&&"outer_left"!==e.opening||(this.parts_points.push({xy:copy_point(e.s),end:"s",role:"door",id:e.id}),this.parts_points.push({xy:copy_point(e.e),end:"e",role:"wall"})),"inner_right"!==e.opening&&"outer_right"!==e.opening||(this.parts_points.push({xy:copy_point(e.s),end:"s",role:"door",id:e.id}),this.parts_points.push({xy:copy_point(e.e),end:"e",role:"wall"}))):"door_penal"===e.type?("left"===e.opening&&(this.parts_points.push({xy:copy_point(e.s),end:"s",role:"door",id:e.id}),this.parts_points.push({xy:copy_point(e.e),end:"e",role:"wall"})),"right"===e.opening&&(this.parts_points.push({xy:copy_point(e.s),end:"s",role:"door",id:e.id}),this.parts_points.push({xy:copy_point(e.e),end:"e",role:"wall"}))):(this.parts_points.push({xy:copy_point(e.s),end:"s",role:"door",id:e.id}),this.parts_points.push({xy:copy_point(e.e),end:"e",role:"wall",id:e.id})))}if("init"===this.label&&"break"===plan)for(let e=0;e<sectors.db.length;e++){var t,i=sectors.db[e];is_point_inside_polygon(get_center(i.s,i.e),this.polygon)&&(sectors.id_wall=this.id,(t=analyze_two_vectors({s:this.s,e:this.e},{s:i.s,e:i.e}).codirection)&&(this.parts_points.push({xy:copy_point(i.s2),role:"break"}),this.parts_points.push({xy:copy_point(i.e2),role:"wall"})),t||(this.parts_points.push({xy:copy_point(i.e2),role:"break"}),this.parts_points.push({xy:copy_point(i.s2),role:"wall"})))}for(let t=0;t<windows.db.length;t++){let e=windows.db[t];if("init"!==this.label&&"break"!==this.label||"build"!==e.plan){if("build"===this.label){if("init"===e.plan)continue;if(!0===e.break)continue}is_point_inside_polygon(get_center(e.s,e.e),this.polygon)&&(e.id_wall=this.id,this.parts_points.push({xy:copy_point(e.s),end:"s",role:"window",id:e.id}),"windoor"===e.type&&e.connection_point&&this.parts_points.push({xy:copy_point(e.connection_point),end:"c",role:"window",id:e.id}),this.parts_points.push({xy:copy_point(e.e),end:"e",role:"wall"}))}}if("build"===plan)for(let e=0;e<walls.db.length;e++){var n=walls.db[e];!0===n.patch&&is_point_inside_polygon(n.c,this.polygon)&&(this.parts_points.push({xy:copy_point(n.s),role:"wall"}),this.parts_points.push({xy:copy_point(n.e),role:"wall"}))}this.parts_points.push({xy:copy_point(this.s),role:"wall"}),this.parts_points.push({xy:copy_point(this.e),role:"wall"});for(let e=0;e<this.parts_points.length;e++)this.parts_points[e].distance=get_distance(this.s,this.parts_points[e].xy);this.parts_points.sort(compare_distance),this.parts_points=function(i){let e=[];e:for(let t=0;t<i.length;t++){for(let e=0;e<i.length;e++)if(e!==t&&are_points_equal(i[t].xy,i[e].xy)&&"wall"===i[t].role&&"s"===i[e].end)continue e;e.push(i[t])}return e}(this.parts_points)}!0===this.patch&&(this.parts_points.push({xy:copy_point(this.s),role:"wall"}),this.parts_points.push({xy:copy_point(this.e),role:"wall"}))},j.prototype.draw=function(e=!1){this.s=LIB.fixPoint(this.s),this.e=LIB.fixPoint(this.e),this.calc(e),"init_copy"!==this.label&&this.collect_points();var i,e=is_point_exists(this.l1)&&is_point_exists(this.r1)&&is_point_exists(this.l2)&&is_point_exists(this.r2);if(e&&"init_copy"!==this.label){for(let e=0;e<this.parts_points.length-1;e++)this.parts[e]&&(this.parts[e].s=this.parts_points[e].xy,this.parts[e].e=this.parts_points[e+1].xy,this.parts[e].draw());if(this.MICROBORDERS.clear(),0!==this.walls_s.length)for(let e=0;e<this.walls_s.length;e++){var t,n=this.walls_s[e].type,s=this.walls_s[e].wall,s=walls.db[s];this.depth>=s.depth&&is_line_on_line(this.axis,s.axis)&&("s"===n&&(are_points_equal(this.l1,s.r1)||(t={s:this.l1,e:s.r1},1<LIB.lineLength(t)&&are_lines_perpendicular(t,this.axis)&&this.MICROBORDERS.line(t.s.x,t.s.y,t.e.x,t.e.y).attr(this.border_attr).show()),are_points_equal(this.r1,s.l1)||(t={s:this.r1,e:s.l1},1<LIB.lineLength(t)&&are_lines_perpendicular(t,this.axis)&&this.MICROBORDERS.line(t.s.x,t.s.y,t.e.x,t.e.y).attr(this.border_attr).show())),"e"===n&&(are_points_equal(this.r1,s.r2)||(n={s:this.r1,e:s.r2},1<LIB.lineLength(n)&&are_lines_perpendicular(n,this.axis)&&this.MICROBORDERS.line(n.s.x,n.s.y,n.e.x,n.e.y).attr(this.border_attr).show()),are_points_equal(this.l1,s.l2)||(n={s:this.l1,e:s.l2},1<LIB.lineLength(n)&&are_lines_perpendicular(n,this.axis)&&this.MICROBORDERS.line(n.s.x,n.s.y,n.e.x,n.e.y).attr(this.border_attr).show())))}if(0!==this.walls_e.length)for(let e=0;e<this.walls_e.length;e++){var o,l=this.walls_e[e].type,r=this.walls_e[e].wall,r=walls.db[r];this.depth>=r.depth&&is_line_on_line(this.axis,r.axis)&&("s"===l&&(are_points_equal(this.l2,r.l1)||(o={s:this.l2,e:r.l1},1<LIB.lineLength(o)&&are_lines_perpendicular(o,this.axis)&&this.MICROBORDERS.line(o.s.x,o.s.y,o.e.x,o.e.y).attr(this.border_attr).show()),are_points_equal(this.r2,r.r1)||(o={s:this.r2,e:r.r1},1<LIB.lineLength(o)&&are_lines_perpendicular(o,this.axis)&&this.MICROBORDERS.line(o.s.x,o.s.y,o.e.x,o.e.y).attr(this.border_attr).show())),"e"===l&&(are_points_equal(this.l2,r.r2)||(l={s:this.l2,e:r.r2},1<LIB.lineLength(l)&&are_lines_perpendicular(l,this.axis)&&this.MICROBORDERS.line(l.s.x,l.s.y,l.e.x,l.e.y).attr(this.border_attr).show()),are_points_equal(this.r2,r.l2)||(l={s:this.r2,e:r.l2},1<LIB.lineLength(l)&&are_lines_perpendicular(l,this.axis)&&this.MICROBORDERS.line(l.s.x,l.s.y,l.e.x,l.e.y).attr(this.border_attr).show())))}this.eraseVentHoles();for(let t=0;t<this.ventHoles.length;t++){let e=this.ventHoles[t];(!0!==e.demount||"build"!==plan&&"B"!==plan_group)&&((i=LIB.pointOnLine(this.e,this.s,-e.sdistance))&&(e.center=i,images.ventHoles["ventHole_"+e.id]=new Me(this,e,t)))}}},j.prototype.UPDATE=function(){this.collect_points();for(let e=0;e<this.parts_points.length-1;e++)this.parts[e]&&(this.parts[e].s=this.parts_points[e].xy,this.parts[e].e=this.parts_points[e+1].xy,this.parts[e].draw())},j.prototype.redraw=function(){this.calc_only();var t,i,n,s,o,l,r={s:this.s,e:this.e};for(let e=0;e<sectors.length;e++)sectors[e].id_wall===this.id&&(t=sectors[e].s,n=point_near_line_end(i=sectors[e].e,t,100,"R"),s=point_near_line_end(t,i,100,"L"),n={s:n,e:point_near_line_end(i,t,100,"L")},s={s:s,e:point_near_line_end(t,i,100,"R")},sectors[e].s=line_and_line_intersection(n,r),sectors[e].e=line_and_line_intersection(s,r));for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.id_wall===this.id&&(o=get_normal(e.s,e.e),e.center=line_and_line_intersection(o,r),e.draw())}for(let e=0;e<doors.db.length;e++)doors.db[e].id_wall===this.id&&(l=get_normal(doors.db[e].s,doors.db[e].e),doors.db[e].center=line_and_line_intersection(l,r),doors.db[e].draw());this.draw()},j.prototype.unselect=function(){for(let t=0;t<this.parts.length;t++){let e=this.parts[t];"wall"===e.role&&(e.BACKGROUND.fill(e.filling),e.BORDERS.each(function(){this.stroke(e.borderColor)}))}this.selected=!1},j.prototype.drawConnectedWalls=function(){for(let t=0;t<this.walls_s.length;t++){var i=this.walls_s[t].wall;let e=walls.db[i];e.init()}for(let t=0;t<this.walls_e.length;t++){var n=this.walls_e[t].wall;let e=walls.db[n];e.init()}},j.prototype.initConnectedWalls=function(){for(let t=0;t<this.walls_s.length;t++){var i=this.walls_s[t].wall;let e=walls.db[i];e.init()}for(let t=0;t<this.walls_e.length;t++){var n=this.walls_e[t].wall;let e=walls.db[n];e.init()}},j.prototype.split=function(t,i){if(!are_points_equal(t,this.s)&&!are_points_equal(t,this.e)){"break"!==plan&&"build"!==plan||"init"!==this.label||"build"!==i&&"sector"!==i||this.part||copy.wall(this);var n=copy.point(this.e);this.e=copy.point(t),this.splitted=i,this.calc(),walls.db.push(new j({s:copy.point(t),e:copy.point(n),depth:this.depth,outer_depth:this.outer_depth,inner_depth:this.inner_depth,label:this.label,role:this.role,pillar:this.pillar,material:this.material}));let e=walls.db[walls.db.length-1];e.splitted=i,"break"!==plan&&"build"!==plan||"init"!==this.label||"build"!==i&&"sector"!==i||(this.part=!0,e.part=!0)}},j.prototype.split_other_walls=function(i){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var n,s,o,l;e.label===i.target&&e.id!==this.id&&(n={s:LIB.pointOnLine(e.e,e.s,-e.depth/2),e:LIB.pointOnLine(e.s,e.e,-e.depth/2)},s=is_line_on_line(this.axis,e.axis),o=are_points_equal(this.s,e.s)||are_points_equal(this.s,e.e),l=are_points_equal(this.e,e.s)||are_points_equal(this.e,e.e),i.end&&"s"!==i.end||s||o||!is_point_on_line(this.s,n)||e.split(this.s,this.label),i.end&&"e"!==i.end||s||l||!is_point_on_line(this.e,n)||e.split(this.e,this.label))}},j.prototype.merge_other_walls=function(e){function t(e,t,i,n){let s=walls.db[e],o=walls.db[i];if(s.label===o.label){var e=is_line_on_line(s.axis,o.axis),l=s.depth===o.depth;if(e&&l){let e=!1;"s"===t&&"s"===n&&(s.s=copy.point(o.e),o.e_bak&&(s.s_bak=copy.point(o.e_bak)),e=!0),"e"===t&&"s"===n&&(s.e=copy.point(o.e),o.e_bak&&(s.e_bak=copy.point(o.e_bak)),e=!0),"s"===t&&"e"===n&&(s.s=copy.point(o.s),o.s_bak&&(s.s_bak=copy.point(o.s_bak)),e=!0),"e"===t&&"e"===n&&(s.e=copy.point(o.s),o.s_bak&&(s.e_bak=copy.point(o.s_bak)),e=!0),e&&(o.erase(),walls.db.splice(i,1),walls.calc())}}}console.warn("Объединение стен");let i=0,n=0;for(let e=0;e<walls.db.length;e++){var s=walls.db[e];s.id===this.id||"init"===this.label&&("build"===s.label||"break"===s.label)||"break"===this.label&&"break"===s.label||((are_points_equal(this.s,s.s)||are_points_equal(this.s,s.e))&&i++,(are_points_equal(this.e,s.s)||are_points_equal(this.e,s.e))&&n++)}var o,l,r,a,h,g;e&&"s"!==e||2===i&&this.walls_s[0]&&this.walls_s[1]&&(r=this.walls_s[0].wall,a=this.walls_s[0].type,g=this.walls_s[1].wall,h=this.walls_s[1].type,o=walls.db[r],l=walls.db[g],o&&l&&(o=is_point_on_line(this.e,o.axis),l=is_point_on_line(this.e,l.axis),o||l||t(r,a,g,h))),e&&"e"!==e||2===n&&this.walls_e[0]&&this.walls_e[1]&&(o=this.walls_e[0].wall,l=this.walls_e[0].type,r=this.walls_e[1].wall,a=this.walls_e[1].type,g=walls.db[o],h=walls.db[r],g&&h&&(e=is_point_on_line(this.s,g.axis),g=is_point_on_line(this.s,h.axis),e||g||t(o,l,r,a)))},j.prototype.is_vertically=function(){return 0<=Math.abs(this.s.x-this.e.x)&&Math.abs(this.s.x-this.e.x)<.1&&this.s.y!==this.e.y},j.prototype.is_horizontally=function(){return 0<=Math.abs(this.s.y-this.e.y)&&Math.abs(this.s.y-this.e.y)<.1&&this.s.x!==this.e.x},j.prototype.get_stops=function(t){s_stop=this.s,e_stop=this.e;for(let e=0;e<this.parts.length;e++){var i=this.parts[e];if("wall"===i.role){if(are_points_equal(t.s,i.s)){var n=get_big_line(i.axis),s=get_point_projection(i.l2,n),n=get_point_projection(i.r2,n),o=get_distance(t.s,s),l=get_distance(t.s,n);o<l&&(s_stop=s),l<=o&&(s_stop=n);break}if(are_points_equal(t.s,i.e)){s=get_big_line(i.axis),l=get_point_projection(i.l1,s),o=get_point_projection(i.r1,s),n=get_distance(t.s,l),i=get_distance(t.s,o);n<i&&(s_stop=l),i<=n&&(s_stop=o);break}}}for(let e=0;e<this.parts.length;e++){var r=this.parts[e];if("wall"===r.role){if(are_points_equal(t.e,r.s)){var a=get_big_line(r.axis),h=get_point_projection(r.l2,a),a=get_point_projection(r.r2,a),g=get_distance(t.e,h),_=get_distance(t.e,a);g<_&&(e_stop=h),_<=g&&(e_stop=a);break}if(are_points_equal(t.e,r.e)){h=get_big_line(r.axis),_=get_point_projection(r.l1,h),g=get_point_projection(r.r1,h),a=get_distance(t.e,_),r=get_distance(t.e,g);a<r&&(e_stop=_),r<=a&&(e_stop=g);break}}}},j.prototype.erase=function(){this.eraseVentHoles();for(let e=0;e<this.parts.length;e++)this.parts[e].erase();this.MICROBORDERS.clear()},j.prototype.move_point=function(e,t){t=t||"+";var i,n,s=get_point_near_line_center(this.s,this.e,this.outer_depth,"L"),o=get_point_near_line_center(this.s,this.e,this.inner_depth,"R");"s"===e&&(i=get_distance(s,this.l1),n=get_distance(o,this.r1),"+"===t&&(n<i&&(this.s=point_to_line_projection(this.l1,this.axis)),i<n&&(this.s=point_to_line_projection(this.r1,this.axis))),"-"===t&&(n<i&&(this.s=point_to_line_projection(this.r1,this.axis)),i<n&&(this.s=point_to_line_projection(this.l1,this.axis)))),"e"===e&&(i=get_distance(s,this.l2),n=get_distance(o,this.r2),"+"===t&&(n<i&&(this.e=point_to_line_projection(this.l2,this.axis)),i<n&&(this.e=point_to_line_projection(this.r2,this.axis))),"-"===t&&(n<i&&(this.e=point_to_line_projection(this.r2,this.axis)),i<n&&(this.e=point_to_line_projection(this.l2,this.axis))))},j.prototype.bind_edges_to_rooms=function(){this.roomO=null,this.roomI=null;for(let e=0;e<rooms1.data.length;e++){var t=rooms1.data[e];for(let e=0;e<t.edges.length;e++){var i=t.edges[e];are_lines_equal(this.EdgeO,i)&&(this.roomO=t.id),are_lines_equal(this.EdgeI,i)&&(this.roomI=t.id)}}console.warn(this.roomO,this.roomI)},j.prototype.replace_linked_walls=function(){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var i;e.id!==this.id&&e.isAvailable()&&(e.links.s&&e.links.s.id===this.id&&("L"===(i=e.links.s.side)&&(e.s=line_and_line_intersection(e.axis,this.EdgeO)),"R"===i&&(e.s=line_and_line_intersection(e.axis,this.EdgeI)),e.draw()),e.links.e&&e.links.e.id===this.id&&("L"===(i=e.links.e.side)&&(e.e=line_and_line_intersection(e.axis,this.EdgeO)),"R"===i&&(e.e=line_and_line_intersection(e.axis,this.EdgeI)),e.draw()))}},j.prototype.move_closest_walls=function(){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var i,n;e.id!==this.id&&(i=is_point_on_line(e.s,this.EdgeO),n=is_point_on_line(e.s,this.EdgeI),(i||n)&&(i=get_big_line(e.axis),(n=line_and_line_intersection(this.axis,i))&&is_point_on_line(n,{s:LIB.pointOnLine(this.e,this.s,-e.depth),e:LIB.pointOnLine(this.s,this.e,-e.depth)})&&(e.s=copy.point(n),e.draw())),i=is_point_on_line(e.e,this.EdgeO),n=is_point_on_line(e.e,this.EdgeI),(i||n)&&(i=get_big_line(e.axis),(n=line_and_line_intersection(this.axis,i))&&is_point_on_line(n,{s:LIB.pointOnLine(this.e,this.s,-e.depth),e:LIB.pointOnLine(this.s,this.e,-e.depth)})&&(e.e=copy.point(n),e.draw())))}},j.prototype.get_axis_lines=function(){if("init"===this.label){function e(e,t){e=LIB.projection(e,s);e&&r.push({coords:e,parent:t})}function t(e,t){var i=is_point_on_line(e,o),n=is_point_on_line(e,l);(i||n)&&(i=LIB.projection(e,s))&&r.push({coords:i,parent:t})}function i(e,t){is_point_on_line(e,s)&&r.push({coords:e,parent:t})}this.axis_nodes=[];let s=re(this),o=this.EdgeO,l=this.EdgeI,r=this.axis_nodes;for(let e=0;e<pillars.db.length;e++){var n=pillars.db[e];"pillar"===n.role&&(t(n.p1,"pillar"),t(n.p2,"pillar"),t(n.p3,"pillar"),t(n.p4,"pillar"))}e(this.l1,"wall"),e(this.r1,"wall"),e(this.l2,"wall"),e(this.r2,"wall");for(let e=0;e<doors.db.length;e++){var a=doors.db[e];a.id_wall===this.id&&(i(a.s,"door"),i(a.e,"door"))}for(let e=0;e<windows.db.length;e++){var h=windows.db[e];h.id_wall===this.id&&(i(h.s,"window"),i(h.e,"window"))}for(let e=0;e<sectors.db.length;e++){var g=sectors.db[e];g.id_wall===this.id&&(i(g.s,"sector"),i(g.e,"sector"))}for(let i=0;i<this.axis_nodes.length;i++){let e=this.axis_nodes[i],t=get_distance(this.s,e.coords);e.distance=parseInt(t.toFixed(0))}this.axis_nodes.sort(compare_distances),this.axis_nodes=function(i){let e=[];e:for(let t=0;t<i.length;t++){for(let e=0;e<i.length;e++)if(e!==t&&are_points_equal(i[t].coords,i[e].coords)&&"wall"===i[t].parent){var n="pillar"===i[e].parent,s="door"===i[e].parent,o="window"===i[e].parent,l="sector"===i[e].parent;if(n||s||o||l)continue e}e.push(i[t])}return e}(this.axis_nodes),this.axis_lines=[];for(let i=0;i<this.axis_nodes.length-1;i++){var _=this.axis_nodes[i],d=this.axis_nodes[i+1];let e=_.coords,t=d.coords;e.parent=_.parent,t.parent=d.parent;_=get_distance(e,t);0<=_&&_<=1||this.axis_lines.push({s:e,e:t})}for(let e=0;e<this.axis_lines.length;e++){this.axis_lines[e].s,this.axis_lines[e].e;let t=this.axis_lines[e];for(let e=0;e<pillars.db.length;e++){var p,c,A,u,w=pillars.db[e];"pillar"===w.role&&(p=LIB.projection(w.p1,this.axis),A=LIB.projection(w.p2,this.axis),u=LIB.projection(w.p3,this.axis),w=LIB.projection(w.p4,this.axis),p&&A&&(c=get_line(p,A),are_lines_equal(t,c)&&(t.remove=!0)),A&&u&&(c=get_line(A,u),are_lines_equal(t,c)&&(t.remove=!0)),u&&w&&(A=get_line(u,w),are_lines_equal(t,A)&&(t.remove=!0)),w&&p&&(u=get_line(w,p),are_lines_equal(t,u)&&(t.remove=!0)))}for(let e=0;e<sectors.db.length;e++){var m=sectors.db[e],f=are_lines_equal(t,m),m=is_point_on_line(m.cp,t);(f||m)&&(t.remove=!0)}for(let e=0;e<windows.db.length;e++){var I=windows.db[e];are_lines_equal(t,I)&&(t.remove=!0)}for(let e=0;e<doors.db.length;e++){var C=doors.db[e];are_lines_equal(t,C)&&(t.remove=!0)}}for(let e=0;e<this.axis_lines.length;e++)!0===this.axis_lines[e].remove&&(this.axis_lines.splice(e,1),e--)}},j.prototype.find_objects=function(){this.has_objects=!1;for(let e=0;e<doors.db.length;e++)if(is_point_inside_polygon(doors.db[e].center,this.polygon))return this.has_objects=!0;for(let e=0;e<windows.db.length;e++)if(is_point_inside_polygon(windows.db[e].center,this.polygon))return this.has_objects=!0;for(let e=0;e<sectors.db.length;e++)if(is_point_inside_polygon(sectors.db[e].cp,this.polygon))return this.has_objects=!0;return!1},j.prototype.delete=function(e="simple"){if(e&&("simple"===e&&(this.erase(),void 0!==(t=objectIndexById(walls.db,this.id))&&walls.db.splice(t,1)),"complex"===e)){console.warn("full delete");var t=objectIndexById(walls.db,this.id);if(void 0!==t&&t!==S.wall&&"init"===this.label){let t=!1;for(let e=0;e<walls.db.length;e++){var i=walls.db[e];if("build"===i.label){if(is_point_inside_polygon(i.s,this.polygon)){t=!0;break}if(is_point_inside_polygon(i.e,this.polygon)){t=!0;break}}}if(t)return void warning.show("red",l10n.wall_delete_interfere_wall_build)}if(!0===this.patch)return void warning.show("yellow",l10n.wall_for_delete_unset_marked_break);var n,s;for(let t=0;t<items.db.length;t++){let e=items.db[t];"wall"===e.model.anchor&&e.props.projection&&(n=is_point_on_line(e.props.projection,this.EdgeO),s=is_point_on_line(e.props.projection,this.EdgeI),(n||s)&&(e.delete(),t--))}this.remove("sectors"),this.remove("windows"),this.remove("doors"),this.merge_other_walls();e=objectIndexById(walls.db,this.id);if(void 0===e)return;if(1===this.walls_s.length){let e=walls.db[this.walls_s[0].wall];t=this.walls_s[0].type;is_line_on_line(this.axis,e.axis)||(l=extendLine(this.EdgeO,1e4,1e4),o=extendLine(this.EdgeI,1e4,1e4),l=line_and_line_intersection(l,e),o=line_and_line_intersection(o,e),"build"===this.label&&"init"===e.label?e[t+"_bak"]&&(e[t]=copy.point(e[t+"_bak"])):(l&&(e[t]=copy.point(l)),o&&(e[t]=copy.point(o))))}if(1===this.walls_e.length){let e=walls.db[this.walls_e[0].wall];var o,l=this.walls_e[0].type;is_line_on_line(this.axis,e.axis)||(t=extendLine(this.EdgeO,1e4,1e4),o=extendLine(this.EdgeI,1e4,1e4),t=line_and_line_intersection(t,e),o=line_and_line_intersection(o,e),"build"===this.label&&"init"===e.label?e[l+"_bak"]&&(e[l]=copy.point(e[l+"_bak"])):(t&&(e[l]=copy.point(t)),o&&(e[l]=copy.point(o))))}for(let t=0;t<questions.db.length;t++){let e=questions.db[t];e.s_wall.id!==this.id&&e.e_wall.id!==this.id||(e.delete(),t--)}this.replace_linked_walls(),"build"===this.label&&(this.get_adjacent_rooms(),this.remove_adjacent_rooms()),this.erase(),walls.db.splice(e,1)}this.MICROBORDERS.remove(),this.eraseVentHoles();for(let e=0;e<this.parts.length;e++)this.parts[e].erase();customCursor.fire("reset")},j.prototype.delete_BAK=function(e="simple"){this.MICROBORDERS.remove(),this.eraseVentHoles();for(let e=0;e<this.parts.length;e++)this.parts[e].erase();if(e&&("simple"===e&&(this.erase(),void 0!==(t=objectIndexById(walls.db,this.id))&&walls.db.splice(t,1)),"complex"===e)){console.warn("full delete");var i,n,t=objectIndexById(walls.db,this.id);if(void 0!==t&&t!==S.wall&&"init"===this.label){let t=!1;for(let e=0;e<walls.db.length;e++){var s=walls.db[e];if("build"===s.label){if(is_point_inside_polygon(s.s,this.polygon)){t=!0;break}if(is_point_inside_polygon(s.e,this.polygon)){t=!0;break}}}if(t)return void warning.show("red",l10n.wall_delete_interfere_wall_build)}if(!0===this.patch)return void warning.show("yellow",l10n.wall_for_delete_unset_marked_break);for(let t=0;t<items.db.length;t++){let e=items.db[t];"wall"===e.model.anchor&&(i=is_point_on_line(e.props.projection,this.EdgeO),n=is_point_on_line(e.props.projection,this.EdgeI),(i||n)&&(e.delete(),t--))}this.remove("sectors"),this.remove("windows"),this.remove("doors"),this.merge_other_walls();e=objectIndexById(walls.db,this.id);if(console.warn("IND",e),void 0===e)return;if(e===walls.db.length-1){if(console.warn("IND",e),1===this.walls_s.length&&0===this.walls_e.length){let e=walls.db[this.walls_s[0].wall];is_line_on_line(this.axis,e.axis)||(console.warn(this.s_birthplace),"eO"===this.s_birthplace&&e.move_point("e","-"),"eI"===this.s_birthplace&&e.move_point("e","+"),"sO"===this.s_birthplace&&e.move_point("s","-"),"sI"===this.s_birthplace&&e.move_point("s","+"))}if(1===this.walls_e.length){let e=walls.db[this.walls_e[0].wall];is_line_on_line(this.axis,e.axis)||("enode"===this.e_birthplace&&e.move_point("e","+"),"eO"===this.e_birthplace&&e.move_point("e","-"),"eI"===this.e_birthplace&&e.move_point("e","+"),"snode"===this.e_birthplace&&e.move_point("s","+"),"sO"===this.e_birthplace&&e.move_point("s","-"),"sI"===this.e_birthplace&&e.move_point("s","+"))}}else{if(1===this.walls_s.length){t=this.walls_s[0].wall;let e=walls.db[t];console.warn(e);t=this.walls_s[0].type;is_line_on_line(this.axis,e.axis)||("build"===this.label&&"init"===e.label&&(!1===e.part&&("s"===t&&e.s_bak&&(e.s=copy.point(e.s_bak),e.s_bak=void 0),"e"===t&&e.e_bak&&(e.e=copy.point(e.e_bak),e.e_bak=void 0)),!0===e.part&&("s"===t&&e.move_point("s","-"),"e"===t&&e.move_point("e","-"))),"build"===this.label&&"build"===e.label&&("s"===t&&e.move_point("s","+"),"e"===t&&e.move_point("e","+")))}if(1===this.walls_e.length){t=this.walls_e[0].wall;let e=walls.db[t];t=this.walls_e[0].type;is_line_on_line(this.axis,e.axis)||(console.warn("GAGA"),"build"===this.label&&"init"===e.label&&(!1===e.part&&("s"===t&&e.s_bak&&(e.s=copy.point(e.s_bak),e.s_bak=void 0),"e"===t&&e.e_bak&&(e.e=copy.point(e.e_bak),e.e_bak=void 0)),!0===e.part&&("s"===t&&e.move_point("s","-"),"e"===t&&e.move_point("e","-"))),"build"===this.label&&"build"===e.label&&("s"===t&&e.move_point("s","+"),"e"===t&&e.move_point("e","+")))}}for(let t=0;t<questions.db.length;t++){let e=questions.db[t];e.s_wall.id!==this.id&&e.e_wall.id!==this.id||(e.delete(),t--)}this.replace_linked_walls(),"build"===this.label&&(this.get_adjacent_rooms(),this.remove_adjacent_rooms()),this.erase(),walls.db.splice(e,1)}customCursor.fire("reset")},j.prototype.delete_rooms=function(){"init"===plan&&this.delete_rooms2(),"break"===plan&&this.delete_rooms2(),"build"===plan&&this.delete_rooms2()},j.prototype.delete_rooms2=function(){var i=get_point_near_line_center(this.l1,this.l2,5,"L"),n=get_point_near_line_center(this.r1,this.r2,5,"R");for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];is_point_inside_polygon(i,e.polygon)&&(e.remove=!0),is_point_inside_polygon(n,e.polygon)&&(e.remove=!0)}for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];!0===e.remove&&(e.delete(),console.log("Удалена комната2",t),t--)}},j.prototype.vector=function(){return{x:this.e.x-this.s.x,y:this.e.y-this.s.y}},j.prototype.scalar=function(e){return this.vector().x*e.vector().x+this.vector().y*e.vector().y},j.prototype.length=function(){return Math.sqrt(Math.pow(this.vector().x,2)+Math.pow(this.vector().y,2))},j.prototype.angle_between=function(e){const t=this.scalar(e)/(this.length()*e.length());return Math.acos(+t.toFixed(10))/Math.PI*180},j.prototype.get_adjacent_rooms=function(){this.adjacent_rooms_indexes=[];for(let t=0;t<rooms2.data.length;t++){var i=rooms2.data[t];for(let e=0;e<i.edges.length;e++){var n=i.edges[e];if(is_line_over_line(n,this.EdgeO)){this.adjacent_rooms_indexes.push(t);break}if(is_line_over_line(n,this.EdgeI)){this.adjacent_rooms_indexes.push(t);break}}}},j.prototype.remove_adjacent_rooms=function(){for(let t=0;t<this.adjacent_rooms_indexes.length;t++){var i=this.adjacent_rooms_indexes[t];let e=rooms2.data[i];e.to_remove=!0}for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];!0===e.to_remove&&(console.log("Удалена комната2",t),e.delete(),t--)}this.adjacent_rooms_indexes=[]},j.prototype.removeBreakLabel=function(){this.label="init";for(let t=0;t<windows.db.length;t++){let e=windows.db[t];is_point_inside_polygon(get_center(e.s,e.e),this.polygon)&&(e.demount=!1,e.draw())}for(let t=0;t<doors.db.length;t++){let e=doors.db[t];is_point_inside_polygon(get_center(e.s,e.e),this.polygon)&&(e.demount=!1,e.draw())}},j.prototype.has_items=function(){for(let e=0;e<items.db.length;e++){var i=items.db[e];if("wall"===i.model.anchor){let e,t;if(t=0===i.model.offset?(e=is_point_on_line(i.pbp,this.EdgeO),is_point_on_line(i.pbp,this.EdgeI)):(i=get_line(i.tp,i.bp),e=line_and_line_intersection(i,this.EdgeO),line_and_line_intersection(i,this.EdgeI)),e||t)return!0}}return!1},j.prototype.collectItems=function(){if(0===this.wallItems.length)for(let e=0;e<items.db.length;e++){let t=items.db[e],i,n;var s;if(n=0===t.model.offset?(i=is_point_on_line(t.pbp,this.EdgeO),is_point_on_line(t.pbp,this.EdgeI)):(s=get_line(t.tp,t.bp),i=line_and_line_intersection(s,this.EdgeO),line_and_line_intersection(s,this.EdgeI)),i||n){let e;i&&(e="L"),n&&(e="R"),t.findComment(),this.wallItems.push({item:t,position:e})}}this.wallLength=Math.round(get_distance(this.s,this.e))},j.prototype.counterItems=function(){let n={};for(let i=0;i<items.db.length;i++){var s,o=items.db[i];let e,t;t=0===o.model.offset?(e=is_point_on_line(o.pbp,this.EdgeO),is_point_on_line(o.pbp,this.EdgeI)):(s=get_line(o.tp,o.bp),e=line_and_line_intersection(s,this.EdgeO),line_and_line_intersection(s,this.EdgeI)),(e||t)&&(n[o.props.id]=o.props.name)}return n},j.prototype.moveItems=function(){let i={};for(let e=0;e<this.wallItems.length;e++){let t=this.wallItems[e].item;i[t.props.id]=t.props.name;var n=this.wallItems[e].position,s=get_distance(t.pbp,t.props.center),o=LIB.projection(t.props.center,this);if(o&&n){t.props.center=get_point_near_line_end(this.s,o,s+this.depth/2-parseInt(t.model.offset),n);o=get_line_angle(this);"R"===n&&(t.props.angle=o+180,t.props.projection=LIB.projection(t.props.center,this.EdgeI)),"L"===n&&(t.props.angle=o,t.props.projection=LIB.projection(t.props.center,this.EdgeO)),360===t.props.angle&&(t.props.angle=0),t.get("points"),t.draw(),t.get("parentRoom"),t.updateComment();let e=get_object(rooms2.data,t.props.id_room);e&&e.draw()}}this.wallItems=[];try{if(0<Object.keys(i).length){let t=this.counterItems();if(Object.keys(i).length>Object.keys(t).length){let e=[];this.id,Object.keys(i).length,Object.keys(t).length;for(var l in i)t.hasOwnProperty(l)||e.push(l+" - "+i[l]);send_warning_signal_after_saving_project(signal_types[2],"Перемещение стены "+this.id+". Количество предметов до "+Object.keys(i).length+", после "+Object.keys(t).length+". Длина до "+this.wallLength+", после "+Math.round(get_distance(this.s,this.e))+". Отвязавшиеся предметы: "+e.join(", "),1)}}}catch(e){send_error_js(e.name,e.message,e.stack)}},j.prototype.isDraggable=function(){if("build"===this.label&&"build"===plan){for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if("break"===t.label&&is_point_inside_polygon(this.c,t.polygon))return warning.show("red",l10n.wall_break_not_move),!1}for(let e=0;e<sectors.db.length;e++)if(is_point_inside_polygon(sectors.db[e].cp,this.polygon))return warning.show("red",l10n.wall_sector_break_not_move),!1;for(let e=0;e<doors.db.length;e++){var i=doors.db[e];if(!0===i.demount&&is_point_inside_polygon(i.center,this.polygon))return warning.show("red",l10n.wall_door_break_not_move),!1}}return!0},j.prototype.movePoint=function(e,t){var i=get_big_line(this),n=get_big_line(get_line(t.l1,t.l2)),t=get_big_line(get_line(t.r1,t.r2)),n=line_and_line_intersection(i,n),i=line_and_line_intersection(i,t),t=farthestPoint(this.c,n,i);t&&("s"===e&&(this.s=copy.point(t)),"e"===e&&(this.e=copy.point(t)))},$("#item-size").on("input","input:text",function(){defs.wall.depth=parseInt($(this).val())}),j.prototype.isActive=function(){return this.plan===plan},j.prototype.paint=function(i=!1){if(!i){let e,t;"A"===plan_group&&("init"===plan&&(t=hatch.grey,e=colors.grey,"balcony"===this.role&&(t=hatch.green,e=colors.green)),"break"===plan&&"break"===this.label&&(t=hatch.crimson,e=colors.crimson),"build"===plan&&("pgb"===this.material&&(t=hatch.pgb,e=colors.pgb),"blocks"===this.material&&(t=hatch.block,e=colors.block),"bricks"===this.material&&(t=hatch.brick,e=colors.brick),"gypsum"===this.material&&(t=hatch.gypsum,e=colors.gypsum),"glass"===this.material&&(this.pattern.each(function(){this.stroke(colors.glass)}),e=colors.glass),"bar"===this.material&&this.pattern.each(function(){this.stroke("brown")}))),"B"===plan_group&&(t=this.pattern?(this.pattern.each(function(){this.stroke("#000000")}),e=colors.grey,this.pattern):(e=colors.grey,hatch.grey));for(let t=0;t<this.parts.length;t++){let e=this.parts[t];e.draw()}}if(i)for(let t=0;t<this.parts.length;t++){let e=this.parts[t];"wall"!==e.role&&"break"!==e.role||("glass"===this.material?(this.pattern.each(function(){this.stroke(i)}),e.BORDERS.each(function(){this.stroke(i)})):"bar"===this.material?this.pattern.each(function(){this.stroke(i)}):(e.BACKGROUND.fill(hatch[i]),e.BORDERS.each(function(){this.stroke(colors[i])})))}this.selected=!0},j.prototype.glow=function(e){var t;"on"!==e||this.glowVisible||(this.glowVisible=!0,t=[this.l1,this.l2,this.r2,this.r1],this.GLOW=svg.polygon(t).attr({stroke:"red","stroke-width":2,"stroke-linecap":"round",fill:"none",opacity:.6}),customCursor.overObject=!0),"off"===e&&this.glowVisible&&(this.glowVisible=!1,customCursor.overObject=!1,this.GLOW.remove())},j.prototype.hasSectors=function(){for(let e=0;e<sectors.db.length;e++)if(is_point_inside_polygon(sectors.db[e].cp,this.polygon))return!0;return!1},j.prototype.hasWallOver=function(){if("init"===this.label||"break"===this.label)for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if(t.id!==this.id&&("build"===t.label&&is_point_inside_polygon(t.c,this.polygon)))return!0}return!1},j.prototype.isAvailable=function(){return!("init"!==plan&&"break"!==plan||"init"!==this.label&&"break"!==this.label)||!("build"!==plan&&"B"!==plan_group||"init"!==this.label&&"build"!==this.label)},j.prototype.remove=function(e,t){if("windows"===e&&"init"===this.label)for(let t=0;t<windows.db.length;t++){let e=windows.db[t];e.id_wall===this.id&&(e.delete(),t--)}if("doors"===e)for(let t=0;t<doors.db.length;t++){let e=doors.db[t];"init"===e.plan&&"build"===this.label||"build"===e.plan&&"init"===this.label||is_point_inside_polygon(e.center,this.polygon)&&(e.delete(),t--)}if("sectors"===e&&"init"===this.label)for(let t=0;t<sectors.db.length;t++){let e=sectors.db[t];is_point_inside_polygon(get_center(e.s,e.e),this.polygon)&&(e.delete(),t--)}},j.prototype.removeVentHole=function(e){for(let t=0;t<this.ventHoles.length;t++){var i=this.ventHoles[t];if(i.id===e){let e=images.ventHoles["ventHole_"+i.id];e&&(e.remove(),delete images.ventHoles["ventHole_"+i.id]),this.ventHoles.splice(t,1);break}}},j.prototype.eraseVentHoles=function(){for(let t=0;t<this.ventHoles.length;t++){var i=this.ventHoles[t];let e=images.ventHoles["ventHole_"+i.id];e&&(e.remove(),delete images.ventHoles["ventHole_"+i.id])}},j.prototype.buildRealAxis=function(e){if("short"===e){let e=[],t=[];var l=LIB.extendLine(this,1e4,1e4);let i=LIB.projection(this.l1,l),n=(i.distance=LIB.distance(i,l.e),LIB.projection(this.r1,l)),s=(n.distance=LIB.distance(n,l.e),e.push(i,n),e.sort(compare_distance),LIB.projection(this.l2,l)),o=(s.distance=LIB.distance(s,l.s),LIB.projection(this.r2,l));o.distance=LIB.distance(o,l.s),t.push(s,o),t.sort(compare_distance),this.realAxis=LIB.line(e[0],t[0])}if("long"===e){let e=[];l=LIB.extendLine(this,1e4,1e4);let t=LIB.projection(this.l1,l),i=(t.distance=LIB.distance(t,l.s),LIB.projection(this.l2,l)),n=(i.distance=LIB.distance(i,l.s),LIB.projection(this.r1,l)),s=(n.distance=LIB.distance(n,l.s),LIB.projection(this.r2,l));s.distance=LIB.distance(s,l.s),e.push(t,i,n,s),e.sort(compare_distance),this.realAxis=LIB.line(e[0],e[e.length-1])}};let o=function(e,t,i,n,s){this.s=e,this.e=t,this.c=get_center(this.s,this.e),this.role=i,this.wall=n,this.id=LIB.id(),this.selected=!1,this.additional_s_lines=!1,this.additional_e_lines=!1,"wall"===this.role||"break"===this.role?(this.filling=hatch.grey,this.borderColor=colors.grey):(this.filling="none",this.borderColor="none"),"door"===this.role&&(this.filling="red",this.borderColor="red"),"break"===plan&&"break"===this.wall.label&&(this.filling=hatch.crimson,this.borderColor=colors.crimson),"A"===plan_group&&("balcony"===this.wall.role&&(this.filling=hatch.green,this.borderColor=colors.green),"pgb"===this.wall.material&&(this.filling=hatch.pgb,this.borderColor=colors.pgb),"blocks"===this.wall.material&&(this.filling=hatch.block,this.borderColor=colors.block),"bricks"===this.wall.material&&(this.filling=hatch.brick,this.borderColor=colors.brick),"gypsum"===this.wall.material&&(this.filling=hatch.gypsum,this.borderColor=colors.gypsum),"glass"===this.wall.material&&(this.filling=this.wall.pattern,this.filling.each(function(){this.stroke(colors.glass)}),this.borderColor=colors.glass),"bar"===this.wall.material&&(this.filling=this.wall.pattern,this.filling.each(function(){this.stroke(colors.bar)}),this.borderColor="transparent"),"window"!==this.role&&"door"!==this.role||(this.filling="none",this.borderColor="none")),"B"===plan_group&&(this.borderColor=colors.grey,"window"!==this.role&&"door"!==this.role||(this.filling="none",this.borderColor="none"),"glass"===this.wall.material&&(this.filling=this.wall.pattern,this.filling.each(function(){this.stroke(colors.grey)}),this.borderColor=colors.grey),"bar"===this.wall.material&&(this.filling=this.wall.pattern,this.filling.each(function(){this.stroke(colors.grey)}),this.borderColor="transparent"));let o=this;this.BACKGROUND=layers.walls.polygon().on("mouseover",function(e){o.mouseover(e)}).on("mouseleave",function(e){o.mouseleave(e)}).on("mousedown",function(e){o.mousedown(e)}),this.BORDERS=layers.walls.group(),this.DIMENSIONS=layers.wallsDimensions.group(),this.attr={stroke:this.borderColor,"stroke-width":1.4},"wall"!==this.role&&"break"!==this.role||(this.selector=layers.walls.polygon().attr({stroke:colors.orange,"stroke-width":1.4,fill:hatch.orange})),this.calc(),this.draw()},F=(o.prototype.calc=function(){var e=this.wall;this.axis={s:this.s,e:this.e},this.l1=point_near_line_end(this.e,this.s,e.outer_depth,"R"),this.l2=point_near_line_end(this.s,this.e,e.outer_depth,"L"),this.r1=point_near_line_end(this.e,this.s,e.inner_depth,"L"),this.r2=point_near_line_end(this.s,this.e,e.inner_depth,"R"),are_points_equal(this.s,e.s)&&(this.l1=e.l1,this.r1=e.r1,this.s_on_s=!0),are_points_equal(this.e,e.e)&&(this.l2=e.l2,this.r2=e.r2,this.e_on_e=!0),this.EdgeO={s:this.l1,e:this.l2},this.EdgeI={s:this.r1,e:this.r2},this.polygon=getPolygon(this,"big")},o.prototype.draw=function(){if(this.calc(),is_point_exists(this.l1)&&is_point_exists(this.r1)&&is_point_exists(this.l2)&&is_point_exists(this.r2)){let i=[];this.points={},this.points.o=[],this.points.i=[],this.points.o.push({xy:this.l1,draw:!0}),this.points.o.push({xy:this.l2,draw:!1}),this.points.i.push({xy:this.r1,draw:!0}),this.points.i.push({xy:this.r2,draw:!1});for(let e=0;e<this.wall.points.o.length;e++){var t=this.wall.points.o[e];is_point_on_line(t.coords,this.EdgeO)&&this.points.o.push({xy:t.coords,draw:t.draw})}for(let e=0;e<this.wall.points.i.length;e++){var n=this.wall.points.i[e];is_point_on_line(n.coords,this.EdgeI)&&this.points.i.push({xy:n.coords,draw:n.draw})}if("init"===plan)for(let e=0;e<pillars.db.length;e++){var s=pillars.db[e];"pillar"===s.role&&(is_point_on_line(s.p1,this.EdgeO)&&this.points.o.push({xy:s.p1,draw:!0}),is_point_on_line(s.p2,this.EdgeO)&&this.points.o.push({xy:s.p2,draw:!0}),is_point_on_line(s.p3,this.EdgeO)&&this.points.o.push({xy:s.p3,draw:!0}),is_point_on_line(s.p4,this.EdgeO)&&this.points.o.push({xy:s.p4,draw:!0}),is_point_on_line(s.p1,this.EdgeI)&&this.points.i.push({xy:s.p1,draw:!1}),is_point_on_line(s.p2,this.EdgeI)&&this.points.i.push({xy:s.p2,draw:!1}),is_point_on_line(s.p3,this.EdgeI)&&this.points.i.push({xy:s.p3,draw:!1}),is_point_on_line(s.p4,this.EdgeI)&&this.points.i.push({xy:s.p4,draw:!1}),i.push(s.edge_t),i.push(s.edge_r),i.push(s.edge_b),i.push(s.edge_l))}if("build"===plan||"B"===plan_group)for(let e=0;e<pillars.db.length;e++){var o=pillars.db[e];"pillar"!==o.role&&"gypsum"!==o.role||(is_point_on_line(o.p1,this.EdgeO)&&this.points.o.push({xy:o.p1,draw:!0}),is_point_on_line(o.p2,this.EdgeO)&&this.points.o.push({xy:o.p2,draw:!0}),is_point_on_line(o.p3,this.EdgeO)&&this.points.o.push({xy:o.p3,draw:!0}),is_point_on_line(o.p4,this.EdgeO)&&this.points.o.push({xy:o.p4,draw:!0}),is_point_on_line(o.p1,this.EdgeI)&&this.points.i.push({xy:o.p1,draw:!1}),is_point_on_line(o.p2,this.EdgeI)&&this.points.i.push({xy:o.p2,draw:!1}),is_point_on_line(o.p3,this.EdgeI)&&this.points.i.push({xy:o.p3,draw:!1}),is_point_on_line(o.p4,this.EdgeI)&&this.points.i.push({xy:o.p4,draw:!1}),i.push(o.edge_t),i.push(o.edge_r),i.push(o.edge_b),i.push(o.edge_l))}for(let e=0;e<this.points.o.length;e++)this.points.o[e].distance=get_distance(this.points.o[e].xy,this.l1);for(let e=0;e<this.points.i.length;e++)this.points.i[e].distance=get_distance(this.points.i[e].xy,this.r1);this.points.o.sort(compare_distance),this.points.i.sort(compare_distance),"wall"===this.role&&(this.BACKGROUND.plot(this.polygon).attr({stroke:"transparent","stroke-width":1.4,fill:this.filling}),"build"!==plan&&"B"!==plan_group||"glass"!==this.wall.material&&"bar"!==this.wall.material||(this.filling.untransform(),this.filling.transform({rotation:get_line_angle(this.wall)}),this.filling.transform({x:this.wall.l1.x,y:this.wall.l1.y}),this.BACKGROUND.plot(this.polygon).attr({stroke:"transparent","stroke-width":1.4,fill:this.filling}))),this.BORDERS.clear(),this.DIMENSIONS.clear();for(let e=0;e<this.points.o.length-1;e++){var l=this.points.o[e].xy,r=this.points.o[e+1].xy;if(1<get_distance(l,r)){let t=!0;var a,h,g=get_line(l,r);for(let e=0;e<i.length;e++)is_line_over_line(g,i[e])&&(t=!1);for(let e=0;e<this.wall.controlLines.o.length;e++)is_line_over_line(g,this.wall.controlLines.o[e])&&(t=!1);t&&(this.BORDERS.add(svg.line(l.x,l.y,r.x,r.y).attr(this.attr)),a="wall"===this.role,h="break"===this.role&&"break"===plan,(a||h)&&this.DIMENSIONS.add(new Qe(l,r,"L",!1,"wall")))}}for(let e=0;e<this.points.i.length-1;e++){var _=this.points.i[e].xy,d=this.points.i[e+1].xy;if(1<get_distance(_,d)){let t=!0;var p,c,A=get_line(_,d);for(let e=0;e<i.length;e++)is_line_over_line(A,i[e])&&(t=!1);for(let e=0;e<this.wall.controlLines.i.length;e++)is_line_over_line(A,this.wall.controlLines.i[e])&&(t=!1);t&&(this.BORDERS.add(svg.line(_.x,_.y,d.x,d.y).attr(this.attr)),p="wall"===this.role,c="break"===this.role&&"break"===plan,(p||c)&&this.DIMENSIONS.add(new Qe(_,d,"R",!1,"wall")))}}"wall"!==this.role&&"break"!==this.role||(this.BORDER_S=this.BORDERS.line(this.l1.x,this.l1.y,this.r1.x,this.r1.y).attr(this.attr),this.BORDER_E=this.BORDERS.line(this.l2.x,this.l2.y,this.r2.x,this.r2.y).attr(this.attr),!0===this.s_on_s&&(null!==this.wall.links.s||this.s_on_s&&0<this.wall.walls_s.length)&&this.BORDER_S.hide(),!0===this.e_on_e&&(null!==this.wall.links.e||this.e_on_e&&0<this.wall.walls_e.length)&&this.BORDER_E.hide())}},o.prototype.select=function(){let e=get_object(walls.db,this.wall.id);e&&e.paint("orange")},o.prototype.unselect=function(){this.selected=!1;let e=get_wall[this.wall.id];e.paint()},o.prototype.erase=function(){this.BACKGROUND.remove(),this.BORDERS.remove(),this.DIMENSIONS.remove(),this.selector&&this.selector.remove()},o.prototype.moving=function(){project.paint(),this.wall.paint("orange"),cursors.own.fire("off"),z.reset(),magnets2.hide(),signs.reset(),selected.id_wall=this.wall.id,selected.wall=get_wall_index(this.wall.id);get_object(walls.db,id.wall);wallControls.fire("on",{wallPoint:selected.wallPoint})},o.prototype.mouseover=function(e){"free"===mode&&isContextmenuHidden()&&(this.wall.label===plan&&("none"===tool&&this.wall.paint("orange"),"eraser"===tool&&(customCursor.overObject=!0,this.wall.paint("crimson"))),"init"===plan&&"break"===this.wall.label&&("none"===tool&&this.wall.paint("orange"),"eraser"===tool&&(customCursor.overObject=!0,this.wall.paint("crimson"))),"break"===plan&&("init"===this.wall.label&&"wall"===this.wall.role&&"break"===tool&&this.wall.glow("on"),"break"===this.wall.label&&"wall"===this.wall.role&&"eraser"===tool&&(customCursor.overObject=!0,this.wall.paint("crimson"))))},o.prototype.mouseleave=function(e){"free"===mode&&"moving"!==tool&&isContextmenuHidden()&&(this.wall.paint(),warning.hide(),"break"===plan&&(this.wall.glow("off"),customCursor.overObject=!1))},o.prototype.mousedown=function(t){if("wall_split"===tool&&(tool="none"),console.warn(tool),newHide(),Oe(),this.wall.glow("off"),this.wall.isActive()&&this.paint("orange"),selectedObject="wall",selected.wall=this.wall,ue=this.wall,id.wall=this.wall.id,selected.id_wall=this.wall.id,id.wall=this.wall.id,"B"!==plan_group){if("init"===plan&&("none"===tool||"eraser"===tool)){if("init"===this.wall.label&&this.wall.hasSectors())return void warning.show("yellow",l10n.wall_sector_marked_break);if("break"===this.wall.label)return void warning.show("yellow",l10n.wall_marked_break)}if(1===t.which){if("init"===plan){if("init"===this.wall.label&&"eraser"===(tool="moving"===tool?"none":tool))return customCursor.fire("eraserReaction",t),this.wall.delete("complex"),project.draw(),void project.localSave();if("break"===this.wall.label){if("eraser"===tool&&this.wall.hasWallOver())return void warning.show("yellow",l10n.wall_marked_break_and_new_wall);if("eraser"===tool)return customCursor.fire("eraserReaction",t),this.wall.delete("complex"),project.draw(),void project.localSave()}}if("break"===plan){if("init"===this.wall.label){if("balcony"===this.wall.role)return void warning.show("yellow",l10n.wall_balcony_not_break);if("wall"===this.wall.role){if("break"===tool)return this.wall.label,this.wall.init(),void console.warn("HK");if("break_part"===tool)return void this.wall.paint();if("none"===tool||"eraser"===tool)return void warning.show("yellow",l10n.wall_source_on_init_plan)}}if("break"===this.wall.label){if("eraser"===tool&&this.wall.hasWallOver())return void warning.show("yellow",l10n.wall_install_new_wall);if("eraser"===tool)return this.wall.label,customCursor.fire("knock"),this.wall.removeBreakLabel(),void project.draw()}}if("build"===plan){if("init"===this.wall.label)return void warning.show("yellow",l10n.wall_source_on_init_plan);if("build"===this.wall.label&&"eraser"===tool){let e=!1;0<this.wall.walls_s.length&&(e=!0),0<this.wall.walls_e.length&&(e=!0),this.wall.links.s&&(e=!0),this.wall.links.e&&(e=!0);this.wall.walls_s.length,this.wall.walls_e.length;return customCursor.fire("eraserReaction",t),this.wall.delete("complex"),e&&project.draw(),void project.localSave()}}}if(3===t.which||2===t.detail){if("init"===plan&&"break"===this.wall.label&&("none"===tool||"eraser"===tool))return void warning.show("yellow",l10n.wall_marked_break);if("break"===plan&&"init"===this.wall.label)return void warning.show("yellow",l10n.wall_source_on_init_plan);if("build"===plan&&"init"===this.wall.label)return void warning.show("yellow",l10n.wall_source_on_init_plan);this.showContextmenu(t)}if(1===t.which&&"none"===tool){var t="init"===plan&&"init"===this.wall.label,e="build"===plan&&"build"===this.wall.label;if(t||e){if(!1===this.wall.isDraggable())return;this.moving()}}isContextmenuHidden()||wallControls.fire("off")}},o.prototype.showContextmenu=function(e){if(wallControls.fire("off"),this.wall.paint("orange"),$(".tools_item.active").removeClass("active"),tool="none",tool_group="none","break"===plan&&"break"===this.wall.label)showContextmenu("#wall-sector-contextmenu",e.clientX,e.clientY,canvas.position().top);else{selected.wallPoint=null,selected.wall=get_wall_index(this.wall.id);var t=get_object(walls.db,id.wall);if(t&&("wall"===this.wall.role||"balcony"===this.wall.role)){if(!this.wall.patch){if(this.wall.selected=!0,$("#select-wall-material").hide(),"build"===this.wall.label){switch($("#select-wall-material option").prop("selected",!1),this.wall.material){case"pgb":$("#select-wall-material [value='1']").prop("selected",!0);break;case"blocks":$("#select-wall-material [value='2']").prop("selected",!0);break;case"bricks":$("#select-wall-material [value='3']").prop("selected",!0);break;case"gypsum":$("#select-wall-material [value='4']").prop("selected",!0);break;case"glass":$("#select-wall-material [value='5']").prop("selected",!0);break;case"bar":$("#select-wall-material [value='6']").prop("selected",!0)}$("#select-wall-material").show()}var i=LIB.lineLength(t.EdgeO),n=LIB.lineLength(t.EdgeI),i=Math.min(i,n).toFixed();$("#wall_length_input").val("").attr("placeholder",i),$("#wall_depth_input").val("").attr("placeholder",t.depth),$(".align").removeClass("active"),$(".contextmenu_item_align").addClass("disabled"),(10<t.depth||t.depth<10)&&($(".contextmenu_item_align").removeClass("disabled"),"L"===t.aligned&&$(".align .outer").addClass("active"),"center"===t.aligned&&$(".align .center").addClass("active"),"R"===t.aligned&&$(".align .inner").addClass("active")),showContextmenu("#wall-contextmenu",e.clientX,e.clientY,canvas.position().top)}this.wall.patch}}},function(e){this.s=e.s,this.e=e.e,e.id?this.id=e.id:this.id=LIB.id(),this.id_wall=e.id_wall,this.s_s=!1,this.s_e=!1,this.e_s=!1,this.e_e=!1,this.s_equal_other_sector_end=!1,this.e_equal_other_sector_end=!1,this.height=params.total_height,e.like_wall?this.like_wall=e.like_wall:this.like_wall=!1,this.filling=hatch.crimson,this.borderColor=colors.crimson;let t=this;this.image=layers.sectors.group().on("mouseover",function(e){"break"===plan&&"eraser"===tool&&(customCursor.overObject=!0)}).on("mouseleave",function(e){"break"===plan&&"eraser"===tool&&(customCursor.overObject=!1)}).on("mousedown",function(e){id.sector=t.id,mouse.down.sector=objectIndexById(sectors.db,t.id),"break"===plan&&"eraser"===tool?(t.delete(),customCursor.fire("knock")):t.mousedown(e)}).on("dblclick",function(e){id.sector=t.id,mouse.down.sector=objectIndexById(sectors.db,t.id),t.showContextmenu(e)}),this.draw()}),H=(F.prototype.bind__=function(){var t=get_center(this.s,this.e);for(let e=0;e<walls.db.length;e++){var i=walls.db[e];"build"!==i.label&&is_point_inside_polygon(t,i.polygon)&&(this.id_wall=i.id)}},F.prototype.get_s_points=function(){this.cp=get_center(this.s,this.e);for(let e=0;e<walls.db.length;e++){var t=walls.db[e];"build"!==t.label&&is_point_inside_polygon(this.cp,t.polygon)&&(this.id_wall=t.id,this.wall_index=e)}var e,i,n,s,o,l=get_object(walls.db,this.id_wall);l&&(this.axis={s:this.s,e:this.e},e=get_point_near_line_center(this.s,this.e,this.depth_o,"L"),i=get_point_near_line_center(this.s,this.e,this.depth_i,"R"),n=get_distance(e,l.l1),s=get_distance(i,l.r1),o=Math.abs(n-s),n<=s?(this.l1=copy.point(l.l1),this.r1=LIB.pointOnLine(l.r2,l.r1,-o)):(this.l1=LIB.pointOnLine(l.l2,l.l1,-o),this.r1=copy.point(l.r1)),n=get_distance(e,l.l2),s=get_distance(i,l.r2),o=Math.abs(n-s),n<=s?(this.l2=copy.point(l.l2),this.r2=LIB.pointOnLine(l.r1,l.r2,-o)):(this.l2=LIB.pointOnLine(l.l1,l.l2,-o),this.r2=copy.point(l.r2)))},F.prototype.get_e_points=function(){this.cp=get_center(this.s,this.e);var e,t,i,n=get_object(walls.db,this.id_wall);n&&(this.axis={s:this.s,e:this.e},e=get_point_near_line_center(this.s,this.e,this.depth_o,"L"),t=get_point_near_line_center(this.s,this.e,this.depth_i,"R"),e=get_distance(e,n.l2),t=get_distance(t,n.r2),i=Math.abs(e-t),e<=t?(this.l2=copy.point(n.l2),this.r2=LIB.pointOnLine(n.r1,n.r2,-i)):(this.l2=LIB.pointOnLine(n.l1,n.l2,-i),this.r2=copy.point(n.r2)))},F.prototype.calc_BAK=function(){this.cp=get_center(this.s,this.e);for(let e=0;e<walls.db.length;e++){var t=walls.db[e];"build"!==t.label&&is_point_inside_polygon(this.cp,t.polygon)&&(this.id_wall=t.id,this.wall_index=e)}var e,i,n,s,o,l=get_object(walls.db,this.id_wall);l&&(this.axis={s:this.s,e:this.e},this.l1=LIB.pointAtLinePoint(this,this.s,this.depth_o,"L"),this.l2=LIB.pointAtLinePoint(this,this.e,this.depth_o,"L"),this.r1=LIB.pointAtLinePoint(this,this.s,this.depth_i,"R"),this.r2=LIB.pointAtLinePoint(this,this.e,this.depth_i,"R"),get_point_near_line_center(this.s,this.e,this.depth_o,"L"),get_point_near_line_center(this.s,this.e,this.depth_i,"R"),e=get_point_near_line_center(l.s,l.e,this.depth_o,"L"),i=get_point_near_line_center(l.s,l.e,this.depth_i,"R"),are_points_equal(this.s,l.s)&&(console.log("s-s"),n=get_distance(e,l.l1),s=get_distance(i,l.r1),o=Math.abs(n-s),n===s&&(this.l1=copy.point(l.l1),this.r1=copy.point(l.r1)),s<n&&(this.l1=LIB.pointOnLine(e,l.l1,-o),this.r1=copy.point(l.r1)),n<s&&(this.l1=copy.point(l.l1),this.r1=LIB.pointOnLine(i,l.r2,-o))),are_points_equal(this.s,l.e)&&(console.log("s-e"),n=get_distance(e,l.l2),s=get_distance(i,l.r2),o=Math.abs(n-s),n===s&&(this.l2=copy.point(l.l2),this.r2=copy.point(l.r2)),s<n&&(this.l2=LIB.pointOnLine(e,l.l2,-o),this.r2=copy.point(l.r2)),n<s&&(this.l2=copy.point(l.l2),this.r2=LIB.pointOnLine(i,l.r2,-o))),are_points_equal(this.e,l.s)&&console.log("e-s"),are_points_equal(this.e,l.e)&&(console.log("e-e"),n=get_distance(e,l.l2),s=get_distance(i,l.r2),o=Math.abs(n-s),n===s&&(this.l2=copy.point(l.l2),this.r2=copy.point(l.r2)),s<n&&(this.l2=LIB.pointOnLine(e,l.l2,-o),this.r2=copy.point(l.r2)),n<s&&(this.l2=copy.point(l.l2),this.r2=LIB.pointOnLine(i,l.r2,-o))),this.polygon=[{x:this.l1.x,y:this.l1.y},{x:this.l2.x,y:this.l2.y},{x:this.r2.x,y:this.r2.y},{x:this.r1.x,y:this.r1.y}])},F.prototype.bind=function(e){if(e&&"wall"===e){var t=get_center(this.s,this.e);for(let e=0;e<walls.db.length;e++){var i,n,s,o,l,r,a=walls.db[e];"init"!==a.label&&"break"!==a.label||is_point_inside_polygon(t,a.polygon)&&(this.id_wall=a.id,n=get_big_line(this.axis),l=LIB.projection(a.l1,n),r=LIB.projection(a.r1,n),i=LIB.projection(a.l2,n),n=LIB.projection(a.r2,n),s=are_points_equal(this.s,l),o=are_points_equal(this.s,r),(s||o)&&(this.s=copy.point(a.s),this.s_s=!0),s=are_points_equal(this.s,i),o=are_points_equal(this.s,n),(s||o)&&(this.s=copy.point(a.e),this.s_e=!0),s=are_points_equal(this.e,l),o=are_points_equal(this.e,r),(s||o)&&(this.e=copy.point(a.s),this.e_s=!0),l=are_points_equal(this.e,i),r=are_points_equal(this.e,n),(l||r)&&(this.e=copy.point(a.e),this.e_e=!0))}}if(e&&"sectors"===e)for(let e=0;e<sectors.db.length;e++){var h=sectors.db[e];this.id!==h.id&&(are_points_equal(this.s,h.s)||are_points_equal(this.s,h.e)?this.s_equal_other_sector_end=!0:(are_points_equal(this.e,h.s)||are_points_equal(this.e,h.e))&&(this.e_equal_other_sector_end=!0))}},F.prototype.calc=function(){this.cp=get_center(this.s,this.e),this.wall=void 0,this.id_wall=void 0,this.wall_index=void 0;for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if("build"!==t.label&&is_point_inside_polygon(this.cp,t.polygon)){this.wall=t,this.id_wall=t.id,this.wall_index=e;break}}if(this.id_wall){var e=this.wall,i=(this.axis={s:this.s,e:this.e},re(e)),n=get_distance(this.s,e.s),s=get_distance(this.e,e.s);(n<s||0===n)&&(this.depth_o=e.outer_depth,this.depth_i=e.inner_depth),(s<n||0===s)&&(this.depth_o=e.inner_depth,this.depth_i=e.outer_depth),this.s_equal_other_sector_end=!1,this.e_equal_other_sector_end=!1;for(let e=0;e<sectors.db.length;e++){var o=sectors.db[e];this.id!==o.id&&(are_points_equal(this.s,o.s)||are_points_equal(this.s,o.e)?this.s_equal_other_sector_end=!0:(are_points_equal(this.e,o.s)||are_points_equal(this.e,o.e))&&(this.e_equal_other_sector_end=!0))}this.s2=this.s,are_points_equal(this.s,e.s)&&(this.s2=copy.point(i.s)),are_points_equal(this.s,e.e)&&(this.s2=copy.point(i.e)),this.e2=this.e,are_points_equal(this.e,e.s)&&(this.e2=copy.point(i.s)),are_points_equal(this.e,e.e)&&(this.e2=copy.point(i.e)),this.l1=get_point_near_line_end(this.e2,this.s2,this.depth_o,"R"),this.r1=get_point_near_line_end(this.e2,this.s2,this.depth_i,"L"),this.l2=get_point_near_line_end(this.s2,this.e2,this.depth_o,"L"),this.r2=get_point_near_line_end(this.s2,this.e2,this.depth_i,"R"),!0===this.s_equal_other_sector_end&&(are_points_equal(this.s,e.s)?(this.l1=copy.point(e.l1),this.r1=copy.point(e.r1)):are_points_equal(this.s,e.e)&&(this.l1=copy.point(e.r2),this.r1=copy.point(e.l2))),!0===this.e_equal_other_sector_end&&(are_points_equal(this.e,e.s)?(this.l2=copy.point(e.r1),this.r2=copy.point(e.l1)):are_points_equal(this.e,e.e)&&(this.l2=copy.point(e.l2),this.r2=copy.point(e.r2))),this.polygon=[{x:this.l1.x,y:this.l1.y},{x:this.l2.x,y:this.l2.y},{x:this.r2.x,y:this.r2.y},{x:this.r1.x,y:this.r1.y}];n=get_distance(this.l1,this.l2),s=get_distance(this.r1,this.r2);this.area=R(n<=s?n*this.height/1e4:s*this.height/1e4)}},F.prototype.demountVentHoles=function(e=!0){if(!0===e&&this.wall)for(let t=0;t<this.wall.ventHoles.length;t++){let e=this.wall.ventHoles[t];LIB.isPointInsidePolygon(e.center,this.polygon)&&(e.demount=!0)}if(!1===e&&this.wall)for(let t=0;t<this.wall.ventHoles.length;t++){let e=this.wall.ventHoles[t];LIB.isPointInsidePolygon(e.center,this.polygon)&&(e.demount=!1)}},F.prototype.draw=function(e){"bind"===e&&sectors.bind(),this.calc(),this.wall&&is_point_exists(this.l1)&&is_point_exists(this.r1)&&is_point_exists(this.l2)&&is_point_exists(this.r2)&&(this.image.clear(),this.image.polygon(this.polygon).attr({stroke:this.borderColor,"stroke-width":1.4,fill:this.filling}),layers.sectors.add(this.image))},F.prototype.demountAllWall=function(){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"!==e.label&&"init_copy"!==e.label||are_lines_equal(this,e)&&(e.merge_other_walls(),e.label="break",console.warn(e.id))}},F.prototype.split=function(e){if("wall"===e){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var i,n;"init"===e.label&&(i=are_points_equal(this.s,e.s),n=are_points_equal(this.s,e.e),i||n||(i=is_point_on_line(this.s,e.axis),n=is_point_on_line(this.e,e.axis),i&&n&&e.split(this.s,"sector")))}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var s,o;"init"===e.label&&(s=are_points_equal(this.e,e.s),o=are_points_equal(this.e,e.e),s||o||(s=is_point_on_line(this.s,e.axis),o=is_point_on_line(this.e,e.axis),s&&o&&e.split(this.e,"sector")))}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if("init"===e.label&&are_lines_equal(this,e)){e.delete();break}}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];!0===e.part&&e.length<2&&(e.delete(),t--)}}},F.prototype.merge_wall=function(){this.s_eq_wall_point&&this.wall.merge_other_walls("s"),this.e_eq_wall_point&&this.wall.merge_other_walls("e")},F.prototype.mousedown=function(e){1===e.which&&"break"===plan&&"remove_break"===tool&&(this.delete(),project.draw(),create_rooms(),project.localSave()),3===e.which&&this.showContextmenu(e)},F.prototype.showContextmenu=function(e){$(".contextmenu").hide(),hide(),allow.pan=!1,selected.sector=objectIndexById(sectors.db,this.id),showContextmenu("#sector_contextmenu",e.clientX,e.clientY,canvas.position().top)},F.prototype.erase=function(){this.image.clear()},F.prototype.delete_rooms2=function(){var i=get_point_near_line_center(this.l1,this.l2,5,"L"),n=get_point_near_line_center(this.r1,this.r2,5,"R"),e=LIB.pointOnLine(this.e,this.s,-10),t=LIB.pointOnLine(this.s,this.e,-10),s=(get_object(walls.db,this.id_wall),get_point_near_line_point(this.axis,e,this.depth_o+5,"L")),o=get_point_near_line_point(this.axis,e,this.depth_i+5,"R"),l=get_point_near_line_point(this.axis,t,this.depth_o+5,"L"),r=get_point_near_line_point(this.axis,t,this.depth_i+5,"R");for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.to_delete=!1,is_point_inside_polygon(i,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(n,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(s,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(o,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(l,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(r,e.polygon)&&(e.to_delete=!0)}for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];!0===e.to_delete&&(e.delete(),console.log("Удалена комната",t),t--)}},F.prototype.merge_other_walls=function(e){function t(e,t,i,n){let s=walls.db[e],o=walls.db[i];var e=is_line_on_line(s.axis,o.axis),l=s.depth===o.depth,r=s.label===o.label;if(e&&l&&r){let e=!1;"s"===t&&"s"===n&&(s.s=copy.point(o.e),e=!0),"e"===t&&"s"===n&&(s.e=copy.point(o.e),e=!0),"s"===t&&"e"===n&&(s.s=copy.point(o.s),e=!0),"e"===t&&"e"===n&&(s.e=copy.point(o.s),e=!0),e&&(o.erase(),walls.db.splice(i,1),walls.calc())}}console.warn("Объединение стен по точкам сектора");let i=[],n=[];for(let e=0;e<walls.db.length;e++){var s=walls.db[e];"init"===s.label&&s.id!==this.id_wall&&(are_points_equal(this.s,s.s)&&i.push({wall:e,end:"s"}),are_points_equal(this.s,s.e)&&i.push({wall:e,end:"e"}),are_points_equal(this.e,s.s)&&n.push({wall:e,end:"s"}),are_points_equal(this.e,s.e)&&n.push({wall:e,end:"e"}))}var o,l,r,a,h,g;e&&"s"!==e||2===i.length&&i[0]&&i[1]&&(r=i[0].wall,a=i[0].end,h=i[1].wall,g=i[1].end,o=walls.db[r],l=walls.db[h],o&&l&&t(r,a,h,g)),e&&"e"!==e||2===n.length&&n[0]&&n[1]&&(o=n[0].wall,l=n[0].end,r=n[1].wall,a=n[1].end,h=walls.db[o],g=walls.db[r],h&&g&&t(o,l,r,a))},F.prototype.delete=function(){this.bind("wall"),this.demountVentHoles(!1);let i=get_object(walls.db,this.id_wall);if(i){for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if("build"===t.label){var n=is_point_inside_polygon(this.cp,t.polygon),s=is_point_inside_polygon(this.s,t.polygon),o=is_point_inside_polygon(this.e,t.polygon),t=is_point_inside_polygon(t.c,this.polygon);if(n||s||o||t)return void warning.show("red",l10n.wall_delete_mark)}}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var l;"build"!==e.label||is_line_on_line(i.axis,e.axis)||(l=i.depth,get_distance(e.s,i.s)<=l&&(e.s=copy.point(i.s)),get_distance(e.s,i.e)<=l&&(e.s=copy.point(i.e)),get_distance(e.e,i.s)<=l&&(e.e=copy.point(i.s)),get_distance(e.e,i.e)<=l&&(e.e=copy.point(i.e)))}this.delete_rooms2(),this.erase();var e=objectIndexById(sectors.db,this.id);void 0!==e&&sectors.db.splice(e,1),i.init(),walls.get_axis_lines()}},F.prototype.demountWindowsDoors=function(){for(let e=0;e<doors.db.length;e++){let t=doors.db[e];if(t.id_wall===this.id_wall&&"init"===t.plan){let e=!1;(are_points_equal(this.s,t.s)||are_points_equal(this.s,t.e))&&(e=!0),(e=are_points_equal(this.e,t.s)||are_points_equal(this.e,t.e)?!0:e)&&(t.demount=!0,t.draw(),t.delete_rooms2())}}this.calc(),this.draw()},function(e){let t=this;this.role=e.role,this.center=e.center,this.bp=e.bp,this.width=e.width,this.height=e.height,e.angle?this.angle=e.angle:this.angle=0,e.background?this.background=e.background:this.background=!1,e.inside_room?this.inside_room=e.inside_room:this.inside_room=!1,this.p1=e.p1,this.p2=e.p2,this.p3=e.p3,this.p4=e.p4,this.selected=!1,e.id?this.id=e.id:this.id=LIB.id(),e.anchor?this.anchor=e.anchor:this.anchor="floor","pillar_water"===this.role&&(this.props=e.props||{},this.props.pipes||(this.props.pipes={}),this.props.pipes_conditioner||(this.props.pipes_conditioner={})),"pillar"===this.role?this.plan="init":"pillar_air"===this.role||"pillar_water"===this.role?(this.plan=e.plan,void 0===this.plan&&(this.plan="init")):"gypsum"===this.role&&(this.plan="build"),this.IMAGE_WATER=svg.group(d).draggable(!1),this.IMAGE=svg.group(d).on("mouseover",function(){t.mouseover(d)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}).on("dragstart",function(e){this.cursorStart=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),in_array(tool,["ruler","moving"])||(this.deleted=!1,checkSVG("before"))}).on("dragmove",function(e){e.preventDefault();var e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY);this.cursorDelta=get_distance(this.cursorStart,e),3<this.cursorDelta&&!1===this.deleted&&t.plan===plan&&("pillar"===t.role&&(tool="pillar",tool2="pillarMovement",defs.pillar.width=t.width,defs.pillar.height=t.height,e={role:"pillar",id:t.id,center:t.center,width:t.width,height:t.height,angle:t.angle,anchor:t.anchor},cursors.pillar.fire("init",{backup:e}),t.delete({delete_pipe:!1}),this.deleted=!0,this.cursorDelta=0,pillars.draw(),walls.draw(),create_rooms(),create_rooms()),"gypsum"===t.role&&(console.warn(this.deleted,t.plan,t.role),tool="gypsum_box",tool2="pillarMovement",defs.gypsum_box.width=t.width,defs.gypsum_box.height=t.height,e={role:"gypsum",id:t.id,center:copy.point(t.center),width:t.width,height:t.height,angle:t.angle,anchor:t.anchor},t.delete({delete_pipe:!1}),this.deleted=!0,this.cursorDelta=0,pillars.draw(),walls.draw(),create_rooms(),cursors.pillar.fire("init",{backup:e})),"pillar_air"===t.role&&(tool="pillar_air",tool2="pillarMovement",defs.pillar_air.width=t.width,defs.pillar_air.height=t.height,e={role:"pillar_air",id:t.id,center:t.center,width:t.width,height:t.height,angle:t.angle,anchor:t.anchor},cursors.pillar_air.fire("init",{backup:e}),t.delete({delete_pipe:!1}),this.deleted=!0,this.cursorDelta=0),"pillar_water"===t.role&&(tool="pillar_water",tool2="pillarMovement",defs.pillar_water.width=20,defs.pillar_water.height=20,e={role:"pillar_water",id:t.id,center:t.center,width:t.width,height:t.height,angle:t.angle,anchor:t.anchor,props:t.props||{}},cursors.pillar_water.fire("init",{backup:e}),t.delete({delete_pipe:!1}),this.deleted=!0,this.cursorDelta=0))}).on("dragend",function(e){console.warn("end"),"eraser"!==tool&&(this.cursorDelta=0,!1===i&&(tool="none",tool2="none"),checkSVG("after"))}),this.DIMENSIONS=svg.group(),this.draw()}),u=(H.prototype.get_borders_BAK=function(){let s=[],o=(s.push({coords:this.p1,distance:0,parent:"pillar"}),s.push({coords:this.p2,distance:get_distance(this.p1,this.p2),parent:"pillar"}),[]),l=(o.push({coords:this.p2,distance:0,parent:"pillar"}),o.push({coords:this.p3,distance:get_distance(this.p2,this.p3),parent:"pillar"}),[]),r=(l.push({coords:this.p3,distance:0,parent:"pillar"}),l.push({coords:this.p4,distance:get_distance(this.p3,this.p4),parent:"pillar"}),[]),a=(r.push({coords:this.p4,distance:0,parent:"pillar"}),r.push({coords:this.p1,distance:get_distance(this.p4,this.p1),parent:"pillar"}),[]);for(let e=0;e<walls.db.length;e++){var h,g,_,d,p,c,A,u,w=walls.db[e];if("init"!==plan&&"break"!==plan||"build"!==w.label){if("build"===plan||"B"===plan_group){if("break"===w.label)continue;if("init_copy"===w.label)continue}let e=!1,t=!1,i=!1,n=!1;is_point_on_line(w.l1,this.edge_t)?(h=get_distance(this.edge_t.s,w.l1),s.push({coords:w.l1,distance:h,parent:"wall"}),e=!0,i=!0):is_point_on_line(w.l1,this.edge_b)?(h=get_distance(this.edge_b.s,w.l1),l.push({coords:w.l1,distance:h,parent:"wall"}),e=!0,i=!0):is_point_on_line(w.l1,this.edge_r)?(g=get_distance(this.edge_r.s,w.l1),o.push({coords:w.l1,distance:g,parent:"wall"}),e=!0,i=!0):is_point_on_line(w.l1,this.edge_l)&&(g=get_distance(this.edge_l.s,w.l1),r.push({coords:w.l1,distance:g,parent:"wall"}),e=!0,i=!0),is_point_on_line(w.r1,this.edge_t)?(_=get_distance(this.edge_t.s,w.r1),s.push({coords:w.r1,distance:_,parent:"wall"}),t=!0,i=!0):is_point_on_line(w.r1,this.edge_r)?(_=get_distance(this.edge_r.s,w.r1),o.push({coords:w.r1,distance:_,parent:"wall"}),t=!0,i=!0):is_point_on_line(w.r1,this.edge_b)?(d=get_distance(this.edge_b.s,w.r1),l.push({coords:w.r1,distance:d,parent:"wall"}),t=!0,i=!0):is_point_on_line(w.r1,this.edge_l)&&(d=get_distance(this.edge_l.s,w.r1),r.push({coords:w.r1,distance:d,parent:"wall"}),t=!0,i=!0),is_point_on_line(w.l2,this.edge_t)?(p=get_distance(this.edge_t.s,w.l2),s.push({coords:w.l2,distance:p,parent:"wall"}),e=!0,n=!0):is_point_on_line(w.l2,this.edge_r)?(p=get_distance(this.edge_r.s,w.l2),o.push({coords:w.l2,distance:p,parent:"wall"}),e=!0,n=!0):is_point_on_line(w.l2,this.edge_b)?(c=get_distance(this.edge_b.s,w.l2),l.push({coords:w.l2,distance:c,parent:"wall"}),e=!0,n=!0):is_point_on_line(w.l2,this.edge_l)&&(c=get_distance(this.edge_l.s,w.l2),r.push({coords:w.l2,distance:c,parent:"wall"}),e=!0,n=!0),is_point_on_line(w.r2,this.edge_t)?(A=get_distance(this.edge_t.s,w.r2),s.push({coords:w.r2,distance:A,parent:"wall"}),t=!0,n=!0):is_point_on_line(w.r2,this.edge_r)?(A=get_distance(this.edge_r.s,w.r2),o.push({coords:w.r2,distance:A,parent:"wall"}),t=!0,n=!0):is_point_on_line(w.r2,this.edge_b)?(u=get_distance(this.edge_b.s,w.r2),l.push({coords:w.r2,distance:u,parent:"wall"}),t=!0,n=!0):is_point_on_line(w.r2,this.edge_l)&&(u=get_distance(this.edge_l.s,w.r2),r.push({coords:w.r2,distance:u,parent:"wall"}),t=!0,n=!0),e&&a.push(w.EdgeO),t&&a.push(w.EdgeI),i&&a.push(w.EdgeS),n&&a.push(w.EdgeE)}}for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if("init"!==plan&&"break"!==plan||"build"!==t.label){if("build"===plan||"B"===plan_group){if("break"===t.label)continue;if("init_copy"===t.label)continue}(is_line_over_line(this.edge_t,t.EdgeO)||is_line_over_line(this.edge_t,t.EdgeI))&&(s=[]),(is_line_over_line(this.edge_r,t.EdgeO)||is_line_over_line(this.edge_r,t.EdgeI))&&(o=[]),(is_line_over_line(this.edge_b,t.EdgeO)||is_line_over_line(this.edge_b,t.EdgeI))&&(l=[]),(is_line_over_line(this.edge_l,t.EdgeO)||is_line_over_line(this.edge_l,t.EdgeI))&&(r=[])}}for(let e=0;e<pillars.db.length;e++){var m=pillars.db[e];if(m.id!==this.id&&("init"!==plan&&"break"!==plan||"pillar"===m.role&&"pillar"===this.role)){if("build"===plan){if("pillar_air"===m.role)continue;if("pillar_water"===m.role)continue}var f=get_distance(this.center,m.center),I=(this.max_diagonal+m.max_diagonal)/2+10;if(!(I<f)){let e=!1,t=!1,i=!1,n=!1;is_point_on_line(m.p1,this.edge_t)?(e=!0,I=get_distance(m.p1,this.edge_t.s),s.push({coords:m.p1,distance:I,parent:"pillar"})):is_point_on_line(m.p2,this.edge_t)?(t=!0,f=get_distance(m.p2,this.edge_t.s),s.push({coords:m.p2,distance:f,parent:"pillar"})):is_point_on_line(m.p3,this.edge_t)?(i=!0,I=get_distance(m.p3,this.edge_t.s),s.push({coords:m.p3,distance:I,parent:"pillar"})):is_point_on_line(m.p4,this.edge_t)&&(n=!0,f=get_distance(m.p4,this.edge_t.s),s.push({coords:m.p4,distance:f,parent:"pillar"})),is_point_on_line(m.p1,this.edge_r)?(e=!0,I=get_distance(m.p1,this.edge_r.s),o.push({coords:m.p1,distance:I,parent:"pillar"})):is_point_on_line(m.p2,this.edge_r)?(t=!0,f=get_distance(m.p2,this.edge_r.s),o.push({coords:m.p2,distance:f,parent:"pillar"})):is_point_on_line(m.p3,this.edge_r)?(i=!0,I=get_distance(m.p3,this.edge_r.s),o.push({coords:m.p3,distance:I,parent:"pillar"})):is_point_on_line(m.p4,this.edge_r)&&(n=!0,f=get_distance(m.p4,this.edge_r.s),o.push({coords:m.p4,distance:f,parent:"pillar"})),is_point_on_line(m.p1,this.edge_b)?(e=!0,is_point_on_line(m.p1,this.edge_b)&&(I=get_distance(m.p1,this.edge_b.s),l.push({coords:m.p1,distance:I,parent:"pillar"})),is_point_on_line(m.p2,this.edge_b)&&(f=get_distance(m.p2,this.edge_b.s),l.push({coords:m.p2,distance:f,parent:"pillar"}))):is_point_on_line(m.p2,this.edge_b)?(t=!0,I=get_distance(m.p2,this.edge_b.s),l.push({coords:m.p2,distance:I,parent:"pillar"})):is_point_on_line(m.p3,this.edge_b)?(i=!0,f=get_distance(m.p3,this.edge_b.s),l.push({coords:m.p3,distance:f,parent:"pillar"})):is_point_on_line(m.p4,this.edge_b)&&(n=!0,I=get_distance(m.p4,this.edge_b.s),l.push({coords:m.p4,distance:I,parent:"pillar"})),is_point_on_line(m.p1,this.edge_l)?(e=!0,f=get_distance(m.p1,this.edge_l.s),r.push({coords:m.p1,distance:f,parent:"pillar"})):is_point_on_line(m.p2,this.edge_l)?(t=!0,I=get_distance(m.p2,this.edge_l.s),r.push({coords:m.p2,distance:I,parent:"pillar"})):is_point_on_line(m.p3,this.edge_l)?(i=!0,f=get_distance(m.p3,this.edge_l.s),r.push({coords:m.p3,distance:f,parent:"pillar"})):is_point_on_line(m.p4,this.edge_l)&&(n=!0,I=get_distance(m.p4,this.edge_l.s),r.push({coords:m.p4,distance:I,parent:"pillar"})),e&&a.push(m.edge_t),t&&a.push(m.edge_r),i&&a.push(m.edge_b),n&&a.push(m.edge_l)}}}for(let e=0;e<pillars.db.length;e++){var i=pillars.db[e];i.id!==this.id&&"pillar_air"!==i.role&&"pillar_water"!==i.role&&((is_line_over_line(this.edge_t,i.edge_t)||is_line_over_line(this.edge_t,i.edge_r)||is_line_over_line(this.edge_t,i.edge_b)||is_line_over_line(this.edge_t,i.edge_l))&&(s=[]),(is_line_over_line(this.edge_r,i.edge_t)||is_line_over_line(this.edge_r,i.edge_r)||is_line_over_line(this.edge_r,i.edge_b)||is_line_over_line(this.edge_r,i.edge_l))&&(o=[]),(is_line_over_line(this.edge_b,i.edge_t)||is_line_over_line(this.edge_b,i.edge_r)||is_line_over_line(this.edge_b,i.edge_b)||is_line_over_line(this.edge_b,i.edge_l))&&(l=[]),(is_line_over_line(this.edge_l,i.edge_t)||is_line_over_line(this.edge_l,i.edge_r)||is_line_over_line(this.edge_l,i.edge_b)||is_line_over_line(this.edge_l,i.edge_l))&&(r=[]))}2<s.length&&s.sort(compare_distances),2<o.length&&o.sort(compare_distances),2<l.length&&l.sort(compare_distances),2<r.length&&r.sort(compare_distances);let n=[];for(let e=0;e<s.length-1;e++){var C=s[e].coords,y=s[e+1].coords;let i=get_line(C,y);if(i.c=get_center(C,y),.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<a.length;e++){var R=a[e];if(is_point_between_line_points(i.c,R)){t=!1;break}}t&&n.push(i)}}let b=[];for(let e=0;e<o.length-1;e++){var v=o[e].coords,x=o[e+1].coords;let i=get_line(v,x);if(i.c=get_center(v,x),.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<a.length;e++){var F=a[e];if(is_point_between_line_points(i.c,F)){t=!1;break}}t&&b.push(i)}}let B=[];for(let e=0;e<l.length-1;e++){var k=l[e].coords,L=l[e+1].coords;let i=get_line(k,L);if(i.c=get_center(k,L),.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<a.length;e++){var G=a[e];if(is_point_between_line_points(i.c,G)){t=!1;break}}t&&B.push(i)}}let E=[];for(let e=0;e<r.length-1;e++){var W=r[e].coords,P=r[e+1].coords;let i=get_line(W,P);if(i.c=get_center(W,P),.2<LIB.lineLength(i)){let t=!0;for(let e=0;e<a.length;e++){var S=a[e];if(is_point_between_line_points(i.c,S)){t=!1;break}}t&&E.push(i)}}this.borders=[];for(let e=0;e<n.length;e++){var Q=n[e];.2<LIB.lineLength(Q)&&this.borders.push(Q)}for(let e=0;e<b.length;e++){var M=b[e];.2<LIB.lineLength(M)&&this.borders.push(M)}for(let e=0;e<B.length;e++){var D=B[e];.2<LIB.lineLength(D)&&this.borders.push(D)}for(let e=0;e<E.length;e++){var O=E[e];.2<LIB.lineLength(O)&&this.borders.push(O)}for(let e=0;e<this.borders.length;e++){let t=this.borders[e];for(let e=0;e<pillars.db.length;e++){var j=pillars.db[e];if(j.id!==this.id&&("pillar_air"!==j.role&&"pillar_water"!==j.role)){if(is_point_on_line(t.c,j.edge_t)){t.remove=!0;break}if(is_point_on_line(t.c,j.edge_r)){t.remove=!0;break}if(is_point_on_line(t.c,j.edge_b)){t.remove=!0;break}if(is_point_on_line(t.c,j.edge_l)){t.remove=!0;break}}}}for(let e=0;e<this.borders.length;e++)!0===this.borders[e].remove&&(this.borders.splice(e,1),e--)},H.prototype.drawBorders=function(){this.DIMENSIONS.clear();for(let e=0;e<this.borders.length;e++){var t=this.borders[e];1<LIB.lineLength(t)&&(this.IMAGE.add(svg.line(t.s.x,t.s.y,t.e.x,t.e.y).attr({stroke:"#000000","stroke-width":1.4})),this.DIMENSIONS.add(new Qe(t.s,t.e,"L",!1,"pillar")))}layers.pillarsDimensions.add(this.DIMENSIONS)},H.prototype.draw=function(){if(is_point_exists(this.center)){this.IMAGE.clear(),this.IMAGE_WATER.clear(),this.get("parents"),this.p0={x:this.center.x-2,y:this.center.y-2},this.p1={x:this.center.x-this.width/2,y:this.center.y-this.height/2},this.p2={x:this.center.x+this.width/2,y:this.center.y-this.height/2},this.p3={x:this.center.x+this.width/2,y:this.center.y+this.height/2},this.p4={x:this.center.x-this.width/2,y:this.center.y+this.height/2};var i=get_distance(this.p1,this.p3),n=get_distance(this.p2,this.p4);if(this.max_diagonal=parseInt(Math.max(i,n)),this.polygon=[this.p1,this.p2,this.p3,this.p4],"pillar"===this.role){var i={x:this.center.x,y:this.center.y};let e;e=this.bp||{x:i.x+this.height/2*Math.cos((this.angle+90)*Math.PI/180),y:i.y+this.height/2*Math.sin((this.angle+90)*Math.PI/180)};var n=LIB.pointOnLine(e,i,this.height/2);this.p1=point_near_line_end(e,n,this.width/2,"L"),this.p2=point_near_line_end(e,n,this.width/2,"R"),this.p3=point_near_line_end(n,e,this.width/2,"L"),this.p4=point_near_line_end(n,e,this.width/2,"R"),this.polygon=[this.p1,this.p2,this.p3,this.p4],this.edge_t={s:this.p1,e:this.p2},this.edge_r={s:this.p2,e:this.p3},this.edge_b={s:this.p3,e:this.p4},this.edge_l={s:this.p4,e:this.p1},this.edge1_on_wall=!1,this.edge2_on_wall=!1,this.edge3_on_wall=!1,this.edge4_on_wall=!1;let t=hatch.pillar;"B"===plan_group&&(t=hatch.grey),this.IMAGE.polygon([this.p1,this.p2,this.p3,this.p4]).attr({stroke:"none","stroke-width":0,fill:t}).addClass("background"),this.get("anchor"),this.get("borders"),this.drawBorders(),layers.pillars.add(this.IMAGE)}if("pillar_air"===this.role){let e="#000000";"build"===plan&&"build"===this.plan&&(e=colors.blue),this.IMAGE.rect(this.width,this.height).cx(this.center.x).cy(this.center.y).attr({stroke:e,"stroke-width":1.4,fill:"#ffffff"}),this.IMAGE.line(this.p0.x,this.p0.y,this.p1.x,this.p1.y).attr({stroke:e,"stroke-width":1.4,"stroke-linecap":"round"}),this.IMAGE.line(this.p0.x,this.p0.y,this.p2.x,this.p2.y).attr({stroke:e,"stroke-width":1.4,"stroke-linecap":"round"}),this.IMAGE.line(this.p0.x,this.p0.y,this.p4.x,this.p4.y).attr({stroke:e,"stroke-width":1.4,"stroke-linecap":"round"}),this.IMAGE.untransform(),this.IMAGE.rotate(this.angle),layers.pillars.add(this.IMAGE)}if("pillar_water"===this.role&&(this.IMAGE.rect(this.width,this.height).cx(this.center.x).cy(this.center.y).attr({stroke:"transparent","stroke-width":1.4,fill:"transparent"}).addClass("background"),!0===this.background&&this.IMAGE_WATER.rect(this.width,this.height).cx(this.center.x).cy(this.center.y).attr({stroke:"#000000","stroke-width":1.4,fill:"#ffffff"}).addClass("background"),i=this.IMAGE.bbox().cx,n=this.IMAGE.bbox().cy,this.IMAGE.circle(7).attr({stroke:"#000000","stroke-width":1,fill:"#fafafa"}).cx(i).cy(n-3),this.IMAGE.circle(5).attr({stroke:"#000000","stroke-width":.4,fill:"blue"}).cx(i-4).cy(n+4),this.IMAGE.circle(5).attr({stroke:"#000000","stroke-width":.4,fill:"red"}).cx(i+4).cy(n+4),this.IMAGE_WATER.untransform(),this.IMAGE_WATER.rotate(this.angle),this.IMAGE.untransform(),this.IMAGE.rotate(this.angle),layers.pillars.add(this.IMAGE_WATER),layers.pillars_water.add(this.IMAGE),"pillar_water"===this.role&&manager_lining.pillar_draw(this)),"gypsum"===this.role&&("build"===plan||"B"===plan_group)&&0!==this.height&&0!==this.width){i={x:this.center.x,y:this.center.y};let e;e=this.bp||{x:i.x+this.height/2*Math.cos((this.angle+90)*Math.PI/180),y:i.y+this.height/2*Math.sin((this.angle+90)*Math.PI/180)};n=LIB.pointOnLine(e,i,this.height/2);if(this.p1=point_near_line_end(e,n,this.width/2,"L"),this.p2=point_near_line_end(e,n,this.width/2,"R"),this.p3=point_near_line_end(n,e,this.width/2,"L"),this.p4=point_near_line_end(n,e,this.width/2,"R"),this.polygon=[this.p1,this.p2,this.p3,this.p4],is_point_exists(this.p1)&&is_point_exists(this.p2)&&is_point_exists(this.p3)&&is_point_exists(this.p4)){this.IMAGE.clear(),this.IMAGE.polygon(this.polygon).attr({stroke:"none","stroke-width":0,fill:colors.yellow}).addClass("background"),this.room=null;for(let e=0;e<rooms2.data.length;e++){var t=rooms2.data[e];is_point_inside_polygon(this.center,t.polygon)&&(this.room=e)}this.edge_t={s:this.p1,e:this.p2},this.edge_r={s:this.p2,e:this.p3},this.edge_b={s:this.p3,e:this.p4},this.edge_l={s:this.p4,e:this.p1},this.edge_t__on_wall=!1,this.edge_r__on_wall=!1,this.edge_b__on_wall=!1,this.edge_l__on_wall=!1;for(let e=0;e<walls.db.length;e++){var s=walls.db[e];is_line_on_line(this.edge_t,s.EdgeO)&&(this.edge_t__on_wall=!0),is_line_on_line(this.edge_r,s.EdgeO)&&(this.edge_r__on_wall=!0),is_line_on_line(this.edge_b,s.EdgeO)&&(this.edge_b__on_wall=!0),is_line_on_line(this.edge_l,s.EdgeO)&&(this.edge_l__on_wall=!0),is_line_on_line(this.edge_t,s.EdgeI)&&(this.edge_t__on_wall=!0),is_line_on_line(this.edge_r,s.EdgeI)&&(this.edge_r__on_wall=!0),is_line_on_line(this.edge_b,s.EdgeI)&&(this.edge_b__on_wall=!0),is_line_on_line(this.edge_l,s.EdgeI)&&(this.edge_l__on_wall=!0)}this.DIMENSIONS.show(),"build"===plan&&(this.get("borders"),this.drawBorders(),this.DIMENSIONS.show()),layers.gypsum_boxes.add(this.IMAGE)}this.get("anchor")}this.area=R(polygon_area(this.polygon)/1e4),this.edge_t={s:this.p1,e:this.p2},this.edge_r={s:this.p2,e:this.p3},this.edge_b={s:this.p3,e:this.p4},this.edge_l={s:this.p4,e:this.p1};for(let t=0;t<walls.db.length;t++){let e=walls.db[t];var o=get_point_near_line_center(e.l1,e.l2,3,"L"),l=get_point_near_line_center(e.r1,e.r2,3,"R");is_point_inside_polygon(o,this.polygon)&&(e.pillar_part=this.id),is_point_inside_polygon(l,this.polygon)&&(e.pillar_part=this.id)}this.paint(),this.plan===plan?this.IMAGE.draggable():this.IMAGE.draggable(!1)}},H.prototype.get=function(e){if("borders"===e){let i=[],n=(i.push({coords:this.p1,distance:0,parent:"pillar"}),i.push({coords:this.p2,distance:get_distance(this.p1,this.p2),parent:"pillar"}),[]),s=(n.push({coords:this.p2,distance:0,parent:"pillar"}),n.push({coords:this.p3,distance:get_distance(this.p2,this.p3),parent:"pillar"}),[]),o=(s.push({coords:this.p3,distance:0,parent:"pillar"}),s.push({coords:this.p4,distance:get_distance(this.p3,this.p4),parent:"pillar"}),[]);o.push({coords:this.p4,distance:0,parent:"pillar"}),o.push({coords:this.p1,distance:get_distance(this.p4,this.p1),parent:"pillar"});for(let e=0;e<walls.db.length;e++){var t,g,_,d,p,c,A,u,w=walls.db[e];"init_copy"!==w.label&&("init"!==plan&&"break"!==plan||"build"!==w.label)&&("build"!==plan&&"B"!==plan_group||"break"!==w.label)&&(is_point_on_line(w.l1,this.edge_t)?(t=get_distance(this.edge_t.s,w.l1),i.push({coords:w.l1,distance:t,parent:"wall"})):is_point_on_line(w.l1,this.edge_b)?(t=get_distance(this.edge_b.s,w.l1),s.push({coords:w.l1,distance:t,parent:"wall"})):is_point_on_line(w.l1,this.edge_r)?(g=get_distance(this.edge_r.s,w.l1),n.push({coords:w.l1,distance:g,parent:"wall"})):is_point_on_line(w.l1,this.edge_l)&&(g=get_distance(this.edge_l.s,w.l1),o.push({coords:w.l1,distance:g,parent:"wall"})),is_point_on_line(w.r1,this.edge_t)?(_=get_distance(this.edge_t.s,w.r1),i.push({coords:w.r1,distance:_,parent:"wall"})):is_point_on_line(w.r1,this.edge_r)?(_=get_distance(this.edge_r.s,w.r1),n.push({coords:w.r1,distance:_,parent:"wall"})):is_point_on_line(w.r1,this.edge_b)?(d=get_distance(this.edge_b.s,w.r1),s.push({coords:w.r1,distance:d,parent:"wall"})):is_point_on_line(w.r1,this.edge_l)&&(d=get_distance(this.edge_l.s,w.r1),o.push({coords:w.r1,distance:d,parent:"wall"})),is_point_on_line(w.l2,this.edge_t)?(p=get_distance(this.edge_t.s,w.l2),i.push({coords:w.l2,distance:p,parent:"wall"})):is_point_on_line(w.l2,this.edge_r)?(p=get_distance(this.edge_r.s,w.l2),n.push({coords:w.l2,distance:p,parent:"wall"})):is_point_on_line(w.l2,this.edge_b)?(c=get_distance(this.edge_b.s,w.l2),s.push({coords:w.l2,distance:c,parent:"wall"})):is_point_on_line(w.l2,this.edge_l)&&(c=get_distance(this.edge_l.s,w.l2),o.push({coords:w.l2,distance:c,parent:"wall"})),is_point_on_line(w.r2,this.edge_t)?(A=get_distance(this.edge_t.s,w.r2),i.push({coords:w.r2,distance:A,parent:"wall"})):is_point_on_line(w.r2,this.edge_r)?(A=get_distance(this.edge_r.s,w.r2),n.push({coords:w.r2,distance:A,parent:"wall"})):is_point_on_line(w.r2,this.edge_b)?(u=get_distance(this.edge_b.s,w.r2),s.push({coords:w.r2,distance:u,parent:"wall"})):is_point_on_line(w.r2,this.edge_l)&&(u=get_distance(this.edge_l.s,w.r2),o.push({coords:w.r2,distance:u,parent:"wall"})))}for(let e=0;e<pillars.db.length;e++){var m=pillars.db[e];if(m.id!==this.id&&("init"!==plan&&"break"!==plan||"pillar"===m.role&&"pillar"===this.role)){if("build"===plan){if("pillar_air"===m.role)continue;if("pillar_water"===m.role)continue}var f=get_distance(this.center,m.center);(this.max_diagonal+m.max_diagonal)/2+10<f||(is_point_on_line(m.p1,this.edge_t)?(f=get_distance(m.p1,this.edge_t.s),i.push({coords:m.p1,distance:f,parent:"pillar"})):is_point_on_line(m.p1,this.edge_r)?(f=get_distance(m.p1,this.edge_r.s),n.push({coords:m.p1,distance:f,parent:"pillar"})):is_point_on_line(m.p1,this.edge_b)?(f=get_distance(m.p1,this.edge_b.s),s.push({coords:m.p1,distance:f,parent:"pillar"})):is_point_on_line(m.p1,this.edge_l)&&(f=get_distance(m.p1,this.edge_l.s),o.push({coords:m.p1,distance:f,parent:"pillar"})),is_point_on_line(m.p2,this.edge_t)?(f=get_distance(m.p2,this.edge_t.s),i.push({coords:m.p2,distance:f,parent:"pillar"})):is_point_on_line(m.p2,this.edge_r)?(f=get_distance(m.p2,this.edge_r.s),n.push({coords:m.p2,distance:f,parent:"pillar"})):is_point_on_line(m.p2,this.edge_b)?(f=get_distance(m.p2,this.edge_b.s),s.push({coords:m.p2,distance:f,parent:"pillar"})):is_point_on_line(m.p2,this.edge_l)&&(f=get_distance(m.p2,this.edge_l.s),o.push({coords:m.p2,distance:f,parent:"pillar"})),is_point_on_line(m.p3,this.edge_t)?(f=get_distance(m.p3,this.edge_t.s),i.push({coords:m.p3,distance:f,parent:"pillar"})):is_point_on_line(m.p3,this.edge_r)?(f=get_distance(m.p3,this.edge_r.s),n.push({coords:m.p3,distance:f,parent:"pillar"})):is_point_on_line(m.p3,this.edge_b)?(f=get_distance(m.p3,this.edge_b.s),s.push({coords:m.p3,distance:f,parent:"pillar"})):is_point_on_line(m.p3,this.edge_l)&&(f=get_distance(m.p3,this.edge_l.s),o.push({coords:m.p3,distance:f,parent:"pillar"})),is_point_on_line(m.p4,this.edge_t)?(f=get_distance(m.p4,this.edge_t.s),i.push({coords:m.p4,distance:f,parent:"pillar"})):is_point_on_line(m.p4,this.edge_r)?(f=get_distance(m.p4,this.edge_r.s),n.push({coords:m.p4,distance:f,parent:"pillar"})):is_point_on_line(m.p4,this.edge_b)?(f=get_distance(m.p4,this.edge_b.s),s.push({coords:m.p4,distance:f,parent:"pillar"})):is_point_on_line(m.p4,this.edge_l)&&(f=get_distance(m.p4,this.edge_l.s),o.push({coords:m.p4,distance:f,parent:"pillar"})))}}2<i.length&&i.sort(compare_distances),2<n.length&&n.sort(compare_distances),2<s.length&&s.sort(compare_distances),2<o.length&&o.sort(compare_distances);let l=[];for(let t=0;t<i.length-1;t++){var I=i[t].coords,C=i[t+1].coords;let e=get_line(I,C);e.c=get_center(I,C),l.push(e)}let r=[];for(let t=0;t<n.length-1;t++){var y=n[t].coords,b=n[t+1].coords;let e=get_line(y,b);e.c=get_center(y,b),r.push(e)}let a=[];for(let t=0;t<s.length-1;t++){var v=s[t].coords,x=s[t+1].coords;let e=get_line(v,x);e.c=get_center(v,x),a.push(e)}let h=[];for(let t=0;t<o.length-1;t++){var B=o[t].coords,k=o[t+1].coords;let e=get_line(B,k);e.c=get_center(B,k),h.push(e)}this.borders=[];for(let e=0;e<l.length;e++){var L=l[e];.2<LIB.lineLength(L)&&this.borders.push(L)}for(let e=0;e<r.length;e++){var E=r[e];.2<LIB.lineLength(E)&&this.borders.push(E)}for(let e=0;e<a.length;e++){var W=a[e];.2<LIB.lineLength(W)&&this.borders.push(W)}for(let e=0;e<h.length;e++){var P=h[e];.2<LIB.lineLength(P)&&this.borders.push(P)}for(let e=0;e<this.borders.length;e++){let t=this.borders[e];var Q=get_point_near_line_center(t.s,t.e,5,"L"),M=get_point_near_line_center(t.s,t.e,5,"R");for(let e=0;e<walls.db.length;e++){var D=walls.db[e];if("init_copy"!==D.label&&(("init"!==plan&&"break"!==plan||"build"!==D.label)&&("build"!==plan&&"B"!==plan_group||"break"!==D.label))){if(is_point_inside_polygon(Q,D.polygon)){t.remove=!0;break}if(is_point_inside_polygon(M,D.polygon)){t.remove=!0;break}}}for(let e=0;e<pillars.db.length;e++){var O=pillars.db[e];if(O.id!==this.id&&("pillar_air"!==O.role&&"pillar_water"!==O.role&&!("init"===plan&&"gypsum"===O.role||"break"===plan&&"gypsum"===O.role))){if(is_point_inside_polygon(Q,O.polygon)){t.remove=!0;break}if(is_point_inside_polygon(M,O.polygon)){t.remove=!0;break}}}}for(let e=0;e<this.borders.length;e++)!0===this.borders[e].remove&&(this.borders.splice(e,1),e--)}if("parents"===e){this.id_room=void 0;for(let e=0;e<rooms2.data.length;e++){var i=rooms2.data[e];if(is_point_inside_polygon(this.center,i.polygon)){this.id_room=i.id;break}}}if("anchor"===e){this.anchor="floor";for(let e=0;e<walls.db.length;e++){var n=walls.db[e];"init_copy"!==n.label&&"break"!==n.label&&((is_line_over_line(this.edge_t,n.EdgeO)||is_line_over_line(this.edge_t,n.EdgeI))&&(this.edge1_on_wall=!0,this.anchor="wall"),(is_line_over_line(this.edge_r,n.EdgeO)||is_line_over_line(this.edge_r,n.EdgeI))&&(this.edge2_on_wall=!0,this.anchor="wall"),(is_line_over_line(this.edge_b,n.EdgeO)||is_line_over_line(this.edge_b,n.EdgeI))&&(this.edge3_on_wall=!0,this.anchor="wall"),(is_line_over_line(this.edge_l,n.EdgeO)||is_line_over_line(this.edge_l,n.EdgeI))&&(this.edge4_on_wall=!0,this.anchor="wall"))}this.paint(),this.plan===plan?this.IMAGE.draggable():this.IMAGE.draggable(!1)}},H.prototype.bind=function(){for(let e=0;e<rooms2.data.length;e++){var t=rooms2.data[e];if(is_point_inside_polygon(this.center,t.polygon)){this.id_room=t.id;break}}},H.prototype.fillSpace=function(e){var i=get_line_center(this.edge_t),n=get_line_center(this.edge_r),s=get_line_center(this.edge_b),o=get_line_center(this.edge_l);if(console.warn("direction",e),"t"===e){var l=get_ray(s,i,100);let t=[];for(let e=0;e<walls.db.length;e++){var r,a=walls.db[e],h=line_and_line_intersection(l,a.EdgeO),a=line_and_line_intersection(l,a.EdgeI);!h||(r=parseInt(get_distance(h,s)))>defs.pillar.min_height&&t.push({coords:h,distance:r}),!a||(h=parseInt(get_distance(a,s)))>defs.pillar.min_height&&t.push({coords:a,distance:h})}0<t.length&&(t.sort(compare_distance),m=get_distance(s,f=t[0].coords)-4,this.height>=m&&(this.center=get_center(s,f),this.height=2*get_distance(s,this.center),this.draw()))}if("r"===e){var g=get_ray(o,n,100);let t=[];for(let e=0;e<walls.db.length;e++){var _,d=walls.db[e],p=line_and_line_intersection(g,d.EdgeO),d=line_and_line_intersection(g,d.EdgeI);!p||(_=parseInt(get_distance(p,o)))>defs.pillar.min_width&&t.push({coords:p,distance:_}),!d||(p=parseInt(get_distance(d,o)))>defs.pillar.min_width&&t.push({coords:d,distance:p})}0<t.length&&(t.sort(compare_distance),f=get_distance(o,m=t[0].coords)-4,this.width>=f&&(this.center=get_center(o,m),this.width=2*get_distance(o,this.center),this.draw()))}if("b"===e){var c=get_ray(i,s,100);let t=[];for(let e=0;e<walls.db.length;e++){var A,u=walls.db[e],w=line_and_line_intersection(c,u.EdgeO),u=line_and_line_intersection(c,u.EdgeI);!w||(A=parseInt(get_distance(w,i)))>defs.pillar.min_height&&t.push({coords:w,distance:A}),!u||(w=parseInt(get_distance(u,i)))>defs.pillar.min_height&&t.push({coords:u,distance:w})}0<t.length&&(t.sort(compare_distance),m=get_distance(i,f=t[0].coords)-4,this.height>=m&&(this.center=get_center(i,f),this.height=2*get_distance(i,this.center),this.draw()))}if("l"===e){var m,f,I=get_ray(n,o,100);let t=[];for(let e=0;e<walls.db.length;e++){var C,y=walls.db[e],b=line_and_line_intersection(I,y.EdgeO),y=line_and_line_intersection(I,y.EdgeI);!b||(C=parseInt(get_distance(b,n)))>defs.pillar.min_width&&t.push({coords:b,distance:C}),!y||(b=parseInt(get_distance(y,n)))>defs.pillar.min_width&&t.push({coords:y,distance:b})}0<t.length&&(t.sort(compare_distance),f=get_distance(n,m=t[0].coords)-4,this.width>=f&&(this.center=get_center(n,m),this.width=2*get_distance(n,this.center),this.draw()))}},H.prototype.erase=function(){this.IMAGE.clear(),this.IMAGE_WATER.clear(),this.DIMENSIONS.clear()},H.prototype.delete=function(e={}){if(console.warn("Pillar deleting"),e.delete_pipe=void 0===e.delete_pipe||e.delete_pipe,e.delete_pipe&&"pillar_water"===this.role&&manager_lining.pillar_delete(this),e.target&&"rooms"===e.target){var i=get_point_near_line_center(this.p1,this.p2,5,"L"),n=get_point_near_line_center(this.p2,this.p3,5,"L"),s=get_point_near_line_center(this.p3,this.p4,5,"L"),o=get_point_near_line_center(this.p4,this.p1,5,"L");for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];is_point_inside_polygon(i,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(n,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(s,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(o,e.polygon)&&(e.to_delete=!0)}for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];!0===e.to_delete&&(e.delete(),t--)}}else{if("pillar"===this.role)for(let i=0;i<items.db.length;i++){let t=items.db[i];if("wall"===t.model.anchor&&t.props.projection){let e=!1;(e=is_point_on_line(t.props.projection,this.edge_t)||is_point_on_line(t.props.projection,this.edge_r)||is_point_on_line(t.props.projection,this.edge_b)||is_point_on_line(t.props.projection,this.edge_l)||is_point_inside_polygon(t.props.center,this.polygon)?!0:e)&&(t.delete(),i--)}}if("pillar"===this.role)for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];"pillar_air"!==e.role&&"pillar_water"!==e.role||is_point_inside_polygon(e.center,this.polygon)&&(e.erase(),pillars.db.splice(t,1))}this.erase();e=objectIndexById(pillars.db,this.id);void 0!==e&&pillars.db.splice(e,1)}},H.prototype.define_adjacent_walls=function(e){this.adjacent_walls=[];for(let e=0;e<walls.db.length;e++){var t=walls.db[e];t.links.s&&"pillar"===t.links.s.object&&t.links.s.id===this.id&&this.adjacent_walls.push(t.id),t.links.e&&"pillar"===t.links.e.object&&t.links.e.id===this.id&&this.adjacent_walls.push(t.id)}},H.prototype.draw_adjacent_walls=function(e){for(let e=0;e<this.adjacent_walls.length;e++){var i=this.adjacent_walls[e];for(let t=0;t<walls.db.length;t++){let e=walls.db[t];e.id===i&&e.draw()}}},H.prototype.define_adjacent_rooms2=function(e){this.adjacent_rooms=[];var t=get_point_near_line_center(this.p1,this.p2,5,"L"),i=get_point_near_line_center(this.p2,this.p3,5,"L"),n=get_point_near_line_center(this.p3,this.p4,5,"L"),s=get_point_near_line_center(this.p4,this.p1,5,"L");for(let e=0;e<rooms2.data.length;e++){var o=rooms2.data[e];is_point_inside_polygon(t,o.polygon)&&this.adjacent_rooms.push(o.id),is_point_inside_polygon(i,o.polygon)&&this.adjacent_rooms.push(o.id),is_point_inside_polygon(n,o.polygon)&&this.adjacent_rooms.push(o.id),is_point_inside_polygon(s,o.polygon)&&this.adjacent_rooms.push(o.id)}},H.prototype.remove_adjacent_rooms2=function(e){for(let e=0;e<this.adjacent_rooms.length;e++){var i=this.adjacent_rooms[e];for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.id===i&&(e.delete(),t--)}}},H.prototype.paint=function(t){if(this.selected){if("pillar"!==this.role&&"pillar_air"!==this.role&&"gypsum"!==this.role||this.IMAGE.each(function(){this.fill(hatch.orange),this.stroke(colors.orange)}),"pillar_water"===this.role){let e=this;this.IMAGE.each(function(){this.hasClass("background")&&(this.fill(hatch.orange),!0===e.background&&this.stroke("#000000"))})}}else{if(!t){if(this.selected=!1,"pillar"===this.role){let e=hatch.pillar;"B"===plan_group&&(e=hatch.grey),this.IMAGE.each(function(){this.fill(e),this.stroke(colors.grey)})}if("pillar_air"===this.role){let e=colors.grey;"build"===this.plan&&"build"===plan&&(e=colors.blue),this.IMAGE.each(function(){this.fill("#ffffff"),this.stroke(e)})}"pillar_water"===this.role&&this.IMAGE.each(function(){this.hasClass("background")&&(this.fill("transparent"),this.stroke("transparent"))}),"gypsum"===this.role&&this.IMAGE.each(function(){this.fill(colors.yellow),this.stroke(colors.grey)})}if(t&&("pillar"!==this.role&&"pillar_air"!==this.role&&"gypsum"!==this.role||this.IMAGE.each(function(){this.fill(hatch[t]),this.stroke(colors[t])}),"pillar_water"===this.role)){let e=this;this.IMAGE.each(function(){this.hasClass("background")&&(this.fill(hatch[t]),!0===e.background&&this.stroke("#000000"))})}}},H.prototype.mouseover=function(e){"pillar_water"===this.role&&manager_lining.pillar_mouseover(this),"B"!==plan_group&&this.plan===plan&&isContextmenuHidden()&&("none"===tool&&(this.paint("orange"),$("body").css("cursor","pointer"),customCursor.overObject=!0),"eraser"===tool&&(this.paint("crimson"),customCursor.overObject=!0))},H.prototype.mouseleave=function(e){"pillar_water"===this.role&&manager_lining.pillar_mouseleave(this),"B"!==plan_group&&this.plan===plan&&isContextmenuHidden()&&!1===this.selected&&($("body").css("cursor","default"),warning.hide(),customCursor.overObject=!1,this.paint())},H.prototype.mousedown=function(e){if("moving"===tool&&(tool="none"),in_array(tool,["ruler","moving"]))return drawing=!0,mode="drawing",void(mouse.start=get_svg_point({x:e.clientX,y:e.clientY}));if(newHide(),1===e.which&&"pillar_water"===this.role&&manager_lining.pillar_mousedown(this),"B"!==plan_group){if(console.warn(this.plan),this.plan!==plan){if("pillar"===this.role)return void warning.show("yellow",l10n.pillar_on_init_plan);if("pillar_air"===this.role)return void warning.show("yellow",l10n.pillar_air_availability);if("pillar_water"===this.role)return void warning.show("yellow",l10n.pillar_water_on_init_plan)}var t;if(id.pillar=this.id,this.selected=!0,selected.pillar=this,selectedObject="pillar",this.paint("orange"),1===e.which)if(this.plan===plan)if("gypsum"===this.role&&"comment"===tool&&(t=LIB.point(e.clientX,e.clientY,"svg"),create_comment(t)),"eraser"===tool)return customCursor.fire("eraserReaction",e),this.delete(),pillars.draw(),walls.draw(),create_rooms(),void project.localSave();3!==e.which&&2!==e.detail||this.plan===plan&&(allow.pan=!1,$("#pillar-resize").hide(),"pillar"!==this.role&&"gypsum"!==this.role||$("#pillar-resize").show(),showContextmenu("#pillar_contextmenu",e.clientX,e.clientY,canvas.position().top))}},H.prototype.isOver=function(e){var t=get_center(this.p1,this.p2),i=get_center(this.p2,this.p3),n=get_center(this.p3,this.p4),s=get_center(this.p4,this.p1),o=get_center(n,t),l=LIB.pointOnLine(n,t,-3),r=LIB.pointOnLine(s,i,-3),a=LIB.pointOnLine(t,n,-3),h=LIB.pointOnLine(i,s,-3),g=get_line(l,a),_=get_line(r,h);let d=!1;if("pillar"===e)for(let e=0;e<pillars.db.length;e++){var p=pillars.db[e];if(p.id!==this.id&&("pillar_water"!==p.role&&!0===(d=!1===(d=is_point_inside_polygon(o,p.polygon)||is_point_inside_polygon(l,p.polygon)||is_point_inside_polygon(r,p.polygon)||is_point_inside_polygon(a,p.polygon)||is_point_inside_polygon(h,p.polygon)||is_point_inside_polygon(this.p1,p.polygon)||is_point_inside_polygon(this.p2,p.polygon)||is_point_inside_polygon(this.p3,p.polygon)||is_point_inside_polygon(this.p4,p.polygon)||is_point_inside_polygon(this.p4,p.polygon)?!0:d)&&!1===(d=line_and_line_intersection(g,p.edge_t)||line_and_line_intersection(g,p.edge_r)||line_and_line_intersection(g,p.edge_b)||line_and_line_intersection(g,p.edge_l)?!0:d)&&(line_and_line_intersection(_,p.edge_t)||line_and_line_intersection(_,p.edge_r)||line_and_line_intersection(_,p.edge_b)||line_and_line_intersection(_,p.edge_l))?!0:d)))break}return d},function(e){for(var t in this.props=e,this.center=e.center,e.s?this.s=e.s:this.s={},e.e?this.e=e.e:this.e={},e.demount?this.demount=e.demount:this.demount=!1,this.id_wall=e.id_wall,this.width=e.width,this.depth=6,this.type=e.type,this.window_width=e.window_width,"windoor"===this.type&&(e.window_height?this.window_height=e.window_height:this.window_height=defs.windoor.window_height),this.door_width=e.door_width,"windoor"===this.type&&(e.door_height?this.door_height=e.door_height:this.door_height=defs.windoor.door_height),this.door_position=e.door_position,this.opening=e.opening,e.id?this.id=e.id:this.id=LIB.id(),this.label=e.label,this.plan=e.plan,e.height?this.height=e.height:this.height=defs.window.height,void 0!==e.floor_height?this.floor_height=e.floor_height:this.floor_height=defs.window.floor_height,e.slopes?this.slopes=e.slopes:this.slopes=defs.window.slopes,this.custom_options=e.custom_options,e.values?this.values=e.values:this.values={},this.custom_options){var i,n=this.custom_options[t].name;if(this.custom_options[t].hasOwnProperty("options")){if(!this.values.hasOwnProperty(n))for(var s in this.custom_options[t].options){s=this.custom_options[t].options[s];"1"===s.value&&(this.values[n]={value:s.value,title:s.title})}}else this.values.hasOwnProperty(n)||(i=this.custom_options[t],this.values[i.name]={title:i.title,value:i.value})}this.selected=!1,this.filling="#eaeaea",this.borderColor="#000000";let o=this;this.IMAGE=layers.windows.group().on("mouseover",function(e){o.mouseover(e)}).on("mouseleave",function(e){o.mouseleave(e)}).on("mousedown",function(e){o.mousedown(e)}),this.DIMENSION=this.IMAGE.group().on("mouseover",function(e){o.mouseover(e)}).on("mouseleave",function(e){o.mouseleave(e)}).on("mousedown",function(e){o.mousedown(e)}),this.background=svg.polygon().attr({stroke:this.borderColor,"stroke-width":.3,fill:"#ffffff"}),this.frame=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),this.doorway=svg.polygon().attr({stroke:"transparent",fill:"transparent"}),this.door_leaf=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),this.door_arc=svg.path().attr({stroke:"#6588bf","stroke-width":.8,fill:"transparent"}),this.draw()}),w=(u.prototype.expand=function(){var e,t=get_object(walls.db,this.id_wall);t&&(e=get_distance(this.s,t.s),get_distance(this.e,t.s)<e&&(t=copy.point(this.s),this.s=copy.point(this.e),this.e=copy.point(t),this.draw()))},u.prototype.bind=function(){this.wall=!1,this.id_wall=!1;for(let e=0;e<walls.db.length;e++){var t=walls.db[e];"init"!==this.plan||"init"!==t.label&&"break"!==t.label||is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id),"build"===this.plan&&"build"===t.label&&is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id)}},u.prototype.get_room_info=function(){this.rooms={},this.rooms.front="none",this.rooms.behind="none";var t=get_point_near_line_center(this.l1,this.l2,5,"L"),i=get_point_near_line_center(this.r1,this.r2,5,"R");for(let e=0;e<rooms2.data.length;e++){var n=rooms2.data[e];is_point_inside_polygon(t,n.polygon)&&(this.rooms.behind=n.id,this.room_o=n.id),is_point_inside_polygon(i,n.polygon)&&(this.rooms.front=n.id,this.room_i=n.id)}},u.prototype.draw=function(){var e=get_object(walls.db,this.id_wall);if(e){if("window"===this.type&&(this.s=LIB.pointOnLine(e.s,this.center,-this.width/2),this.e=LIB.pointOnLine(e.e,this.center,-this.width/2),this.axis={s:this.s,e:this.e},this.angle=get_line_angle(this.axis),this.l1=point_near_line_end_point(this.e,this.s,e.outer_depth,"R"),this.l2=point_near_line_end_point(this.s,this.e,e.outer_depth,"L"),this.r1=point_near_line_end_point(this.e,this.s,e.inner_depth,"L"),this.r2=point_near_line_end_point(this.s,this.e,e.inner_depth,"R"),this.polygon=getPolygon(this),is_point_exists(this.l1)&&is_point_exists(this.l2)&&is_point_exists(this.r2)&&is_point_exists(this.r1)&&(this.background.plot([[this.l1.x,this.l1.y],[this.l2.x,this.l2.y],[this.r2.x,this.r2.y],[this.r1.x,this.r1.y]]).fill("#ffffff"),l=get_center(this.l1,this.r1),s=point_near_line_end_point(n=get_center(this.l2,this.r2),l,this.depth/2,"R"),o=point_near_line_end_point(l,n,this.depth/2,"L"),r=point_near_line_end_point(n,l,this.depth/2,"L"),l=point_near_line_end_point(l,n,this.depth/2,"R"),this.frame.plot([[s.x,s.y],[o.x,o.y],[l.x,l.y],[r.x,r.y]]))),"windoor"===this.type){0===this.door_width&&(this.door_width=defs.windoor.door_min_width),this.width=this.window_width+this.door_width,this.s=LIB.pointOnLine(e.s,this.center,-this.width/2),this.e=LIB.pointOnLine(e.e,this.center,-this.width/2),this.axis={s:this.s,e:this.e},this.angle=get_line_angle(this.axis),this.l1=point_near_line_end_point(this.e,this.s,e.outer_depth,"R"),this.l2=point_near_line_end_point(this.s,this.e,e.outer_depth,"L"),this.r1=point_near_line_end_point(this.e,this.s,e.inner_depth,"L"),this.r2=point_near_line_end_point(this.s,this.e,e.inner_depth,"R"),this.polygon=getPolygon(this,"small"),this.background.plot(this.polygon).fill("#ffffff");var n=get_center(this.l1,this.r1),s=get_center(this.l2,this.r2),o=point_near_line_end_point(s,n,this.depth/2,"R"),l=point_near_line_end_point(s,n,this.depth/2,"L"),r=point_near_line_end_point(n,s,this.depth/2,"L"),a=point_near_line_end_point(n,s,this.depth/2,"R");let t,i;"left"===this.door_position&&(t=LIB.pointOnLine(o,r,-this.window_width),i=LIB.pointOnLine(l,a,-this.window_width),this.connection_point=LIB.pointOnLine(n,s,-this.window_width)),"right"===this.door_position&&(t=LIB.pointOnLine(r,o,-this.window_width),i=LIB.pointOnLine(a,l,-this.window_width),this.connection_point=LIB.pointOnLine(s,n,-this.window_width)),"left"===this.door_position&&(this.d_sO=copy.point(this.l1),this.d_sI=copy.point(this.r1),this.d_eO=get_point_near_line_end(this.s,this.connection_point,e.outer_depth,"L"),this.d_eI=get_point_near_line_end(this.s,this.connection_point,e.inner_depth,"R"),this.w_sO=copy.point(this.d_eO),this.w_sI=copy.point(this.d_eI),this.w_eO=copy.point(this.l2),this.w_eI=copy.point(this.r2)),"right"===this.door_position&&(this.w_sO=copy.point(this.l1),this.w_sI=copy.point(this.r1),this.w_eO=get_point_near_line_end(this.s,this.connection_point,e.outer_depth,"L"),this.w_eI=get_point_near_line_end(this.s,this.connection_point,e.inner_depth,"R"),this.d_sO=copy.point(this.w_eO),this.d_sI=copy.point(this.w_eI),this.d_eO=copy.point(this.l2),this.d_eI=copy.point(this.r2));s=defs.windoor.depth;if("left"===this.door_position){let e;"inner_left"===this.opening&&(e=p(l,i,this.door_width,s,"inner_left")),"outer_left"===this.opening&&(e=p(o,t,this.door_width,s,"outer_left")),this.frame.plot([[t.x,t.y],[r.x,r.y],[a.x,a.y],[i.x,i.y]]),this.doorway.plot([[o.x,o.y],[t.x,t.y],[i.x,i.y],[l.x,l.y]]),this.door_leaf.plot(e.polygon),this.door_arc.plot(e.path)}if("right"===this.door_position){let e;"inner_right"===this.opening&&(e=p(i,a,this.door_width,s,"inner_right")),"outer_right"===this.opening&&(e=p(t,r,this.door_width,s,"outer_right")),this.frame.plot([[o.x,o.y],[t.x,t.y],[i.x,i.y],[l.x,l.y]]),this.doorway.plot([[t.x,t.y],[r.x,r.y],[a.x,a.y],[i.x,i.y]]),this.door_leaf.plot(e.polygon),this.door_arc.plot(e.path)}}this.width=get_distance(this.s,this.e),this.area=R(this.width*this.height/1e4),this.EdgeO={s:this.l1,e:this.l2},this.EdgeI={s:this.r1,e:this.r2},this.get_room_info(),this.IMAGE.clear(),this.IMAGE.add(this.background),this.IMAGE.add(this.frame),this.IMAGE.add(this.doorway),this.IMAGE.add(this.door_leaf),this.IMAGE.add(this.door_arc),this.DIMENSION.clear(),this.DIMENSION.add(new Pe(this.s,this.e,"#f8f8f8")),layers.windowsDimensions.add(this.DIMENSION),"break"===plan&&!0===this.demount&&(this.DIMENSION.add(svg.circle(24).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(this.center.x).cy(this.center.y)),this.DIMENSION.add(svg.path(paths.sign_destroy).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(this.center.x).cy(this.center.y))),this.paint()}else!1===this.demount&&(this.erase(),void 0!==(n=objectIndexById(windows.db,this.id))&&windows.db.splice(n,1))},u.prototype.hide=function(){this.IMAGE.hide(),this.DIMENSION.clear()},u.prototype.show=function(){this.IMAGE.show(),this.DIMENSION.show()},u.prototype.select=function(e){"remove"===e&&this.DIMENSION.hide();let t=hatch.crimson;"eraser"===tool&&(t=hatch.orange),this.background.attr({stroke:"red",fill:t}),this.frame.attr({stroke:"red",fill:t}),this.doorway.attr({stroke:"red",fill:t}),this.door_leaf.attr({stroke:"red",fill:t}),this.door_arc.attr({stroke:"red",fill:t}),this.draw()},u.prototype.unselect=function(){this.DIMENSION.show(),this.background.attr({stroke:this.borderColor,"stroke-width":.3,fill:"#ffffff"}),this.frame.attr({stroke:this.borderColor,fill:this.filling}),this.doorway.attr({stroke:"transparent",fill:"transparent"}),this.door_leaf.attr({stroke:this.borderColor,fill:this.filling}),this.door_arc.attr({stroke:"#6588bf","stroke-width":.8,fill:"transparent"}),this.draw()},u.prototype.erase=function(){this.IMAGE.clear(),this.DIMENSION.clear()},u.prototype.delete=function(){var e=objectIndexById(walls.db,this.id_wall),t=objectIndexById(windows.db,this.id);void 0!==e&&void 0!==t&&(this.erase(),windows.db.splice(t,1),walls.db[e].init(),customCursor.fire("reset"))},u.prototype.isActive=function(){return this.plan===plan},u.prototype.split=function(e){if("wall"===e){let i=get_line(this.s,this.e);var n,s,o,l,r,a,h,g;!this.s_s&&!this.e_e||(e=get_object(walls.db,this.id_wall))&&(this.s_s&&(i.s=copy.point(e.s)),this.e_e&&(i.e=copy.point(e.e)));for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"===e.label&&is_point_inside_polygon(this.center,e.polygon)&&(n=are_points_equal(i.s,e.s),s=are_points_equal(i.s,e.e),o=is_point_on_line(i.s,e.axis),l=is_point_on_line(i.e,e.axis),n||s||o&&l&&e.split(i.s,"sector"))}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"===e.label&&is_point_inside_polygon(this.center,e.polygon)&&(r=are_points_equal(i.e,e.s),a=are_points_equal(i.e,e.e),h=is_point_on_line(i.s,e.axis),g=is_point_on_line(i.e,e.axis),r||a||h&&g&&e.split(i.e,"sector"))}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if("init"===e.label&&are_lines_equal(i,e)){e.delete();break}}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];!0===e.part&&e.length<2&&(e.delete(),t--)}}},u.prototype.paint=function(e=!1){if(!e){let e=colors.grey,t=colors.white;!0===this.demount&&"break"===plan&&(e=colors.crimson,t=hatch.crimson),this.background.attr({stroke:e,fill:t}),this.frame.attr({stroke:e,fill:t}),this.door_leaf.attr({stroke:e,fill:t})}e&&(this.background.attr({stroke:colors[e],fill:hatch[e]}),this.frame.attr({stroke:colors[e],fill:hatch[e]}),this.door_leaf.attr({stroke:colors[e],fill:hatch[e]}))},u.prototype.glow=function(e){"on"!==e||"break"!==plan||"break_door"!==tool||!1!==this.demount||this.glowVisible||(this.glowVisible=!0,customCursor.overObject=!0,this.GLOW=svg.polygon(this.polygon).attr({stroke:"red","stroke-width":2,"stroke-linecap":"round",fill:"none",opacity:.6})),"off"===e&&"break"===plan&&"break_door"===tool&&this.glowVisible&&(this.glowVisible=!1,customCursor.overObject=!1,this.GLOW.remove())},u.prototype.mouseover=function(e){if(isContextmenuHidden()&&(this.plan===plan&&("none"===tool&&this.paint("orange"),"eraser"===tool&&(this.paint("crimson"),customCursor.overObject=!0)),"break"===plan)){if(!1===this.demount){if("break"===tool){let e=get_object(walls.db,this.id_wall);e&&e.glow("on"),customCursor.overObject=!0}"break_door"===tool&&(this.glow("on"),customCursor.overObject=!0)}!0===this.demount&&"eraser"===tool&&(this.paint("crimson"),customCursor.overObject=!0)}},u.prototype.mouseleave=function(e){if("moving"!==tool&&isContextmenuHidden()&&(this.plan===plan&&(this.paint(),customCursor.overObject=!1),"break"===plan&&("break_door"===tool&&(this.glow("off"),customCursor.overObject=!1),"break"===tool))){let e=get_object(walls.db,this.id_wall);e&&e.glow("off"),customCursor.overObject=!1}},u.prototype.mousedown=function(e){var t=tool;if(Oe(),tool=t,this.glow("off"),this.isActive()&&this.paint("orange"),id.window=this.id,id.wall=this.id_wall,selected.window=this,selectedObject="window","B"!==plan_group&&($("body").hasClass("is_admin")||"break_door"!==tool)){if(1===e.detail){if(1===e.which){if("init"===plan){if(!0===this.demount){let e=l10n.window_marked_break;return"windoor"===this.type&&(e=l10n.windoor_marked_break),void warning.show("red",e)}if("eraser"===tool&&"init"===this.plan)return customCursor.fire("knock"),customCursor.fire("eraserReaction",e),this.delete(),void project.localSave()}if("break"===plan){if("break"!==tool&&"break_door"!==tool&&"eraser"!==tool&&!1===this.demount){let e=l10n.window_on_init_plan;return"windoor"===this.type&&(e=l10n.windoor_on_init_plan),void warning.show("yellow",e)}if("break_door"===tool){if(this.glow("off"),!0===this.hasReplacement){let e=l10n.window_not_break;return"doorway"===this.type&&(e=l10n.windoor_not_break),void warning.show("yellow",e)}if(!1===this.demount)return this.demount=!0,this.draw(),customCursor.fire("knock"),void project.localSave()}if("eraser"===tool){if(!1===this.demount){let e=l10n.window_on_init_plan;return"windoor"===this.type&&(e=l10n.windoor_on_init_plan),void warning.show("yellow",e)}if(!0===this.demount){let e=get_object(walls.db,this.id_wall);e&&("break"===e.label&&(e.removeBreakLabel(),customCursor.fire("knock"),project.draw(),project.localSave()),"break"!==e.label&&!0===this.demount&&(this.demount=!1,this.draw(),customCursor.fire("knock"),project.localSave()))}}}if("build"===plan&&"init"===this.plan){let e=l10n.window_on_init_plan;return"windoor"===this.type&&(e=l10n.windoor_on_init_plan),void warning.show("yellow",e)}if(("none"===tool||"moving"===tool)&&plan===this.plan)return void windowControl.fire("on")}3===e.which&&this.showContextmenu(e)}if(2===e.detail){if("init"===plan&&!0===this.demount){let e=l10n.window_marked_break;return"windoor"===this.type&&(e=l10n.windoor_marked_break),void warning.show("red",e)}this.glow("off"),this.showContextmenu(e)}}},u.prototype.showContextmenu=function(e){if(("init"===plan||"build"===plan)&&this.plan===plan){if(this.selected=!0,allow.pan=!1,selected.wall=this.wall,$("#window_contextmenu_custom_options span").remove(),$("#window_contextmenu_custom_options div").remove(),!1!==this.custom_options){let e=this.custom_options;for(var t in e)if(e[t].hasOwnProperty("options")){var i,n=e[t].name;for(i in $("#window_contextmenu_custom_options").append('<div class="contextmenu_item textinput" id=""><span>'+e[t].title+'</span><div class="contextmenu_item_input"><select name="" id="'+n+'"></select></div></div>'),e[t].options){var s=e[t].options[i].title,o=e[t].options[i].value;this.values[n]&&o===this.values[n].value?$("#"+n).append(new Option(s,o,!0,!0)):$("#"+n).append(new Option(s,o))}}}if(!1!==this.custom_options){let e=this.custom_options;for(var l in e){var r;e[l].hasOwnProperty("options")||(r=e[l].name,e[l].value,this.values[r]&&this.values[r].value,$("#window_contextmenu_custom_options").append('<div class="contextmenu_item input"><span>'+e[l].title+'</span><div class="contextmenu_item_input"><input id="'+e[l].name+'" type="text" maxlength="5" placeholder="'+this.values[r].value+'" /><span>ОК</span><em>см</em></div></div>'))}}"window"===this.type&&($("#window_width_input").val("").attr("placeholder",this.width.toFixed()),$("#window_height_input").val("").attr("placeholder",this.height.toFixed()),$("#window_floor_height_input").val("").attr("placeholder",this.floor_height.toFixed()),$("#window_slopes_input").val("").attr("placeholder",this.slopes.toFixed()),showContextmenu("#window_contextmenu",e.clientX,e.clientY,canvas.position().top)),"windoor"===this.type&&($("#windoor_window_width_input").val("").attr("placeholder",this.window_width.toFixed()),$("#windoor_window_height_input").val("").attr("placeholder",this.window_height.toFixed()),$("#windoor_door_width_input").val("").attr("placeholder",this.door_width.toFixed()),$("#windoor_door_height_input").val("").attr("placeholder",this.door_height.toFixed()),$("#windoor_slopes_input").val("").attr("placeholder",this.slopes.toFixed()),showContextmenu("#windoor_contextmenu",e.clientX,e.clientY,canvas.position().top))}var a;"break"===plan&&!0===this.demount&&(a=get_object(walls.db,this.id_wall))&&("break"===a.label?showContextmenu("#wall-sector-contextmenu",e.clientX,e.clientY,canvas.position().top):showContextmenu("#window_contextmenu_v2",e.clientX,e.clientY,canvas.position().top))},u.prototype.rotate=function(){if("windoor"===this.type){switch(this.opening){case"inner_left":this.door_position="left",this.opening="outer_left";break;case"outer_left":this.door_position="right",this.opening="outer_right";break;case"outer_right":this.door_position="right",this.opening="inner_right";break;case"inner_right":this.door_position="left",this.opening="inner_left"}this.draw()}},function(e){for(var t in(this.props=e).s?this.s=e.s:this.s={},e.e?this.e=e.e:this.e={},this.id_wall=e.id_wall,this.center=e.center,this.width=e.width,this.type=e.type,this.plan=e.plan,e.id?this.id=e.id:this.id=LIB.id(),e.height?this.height=e.height:this.height=defs.door.height,e.demount?this.demount=e.demount:this.demount=!1,e.hasReplacement?this.hasReplacement=e.hasReplacement:this.hasReplacement=!1,e.replacement?this.replacement=e.replacement:this.replacement=!1,e.entrance?this.props.entrance=e.entrance:this.props.entrance=!1,e.opening?this.opening=e.opening:this.setOpening(),this.s_s=!1,this.s_e=!1,this.e_s=!1,this.e_e=!1,this.custom_options=e.custom_options,e.values?this.values=e.values:this.values={},this.custom_options){var i,n=this.custom_options[t].name;if(this.custom_options[t].hasOwnProperty("options")){if(!this.values.hasOwnProperty(n))for(var s in this.custom_options[t].options){s=this.custom_options[t].options[s];"1"===s.value&&(this.values[n]={value:s.value,title:s.title})}}else this.values.hasOwnProperty(n)||(i=this.custom_options[t],this.values[i.name]={title:i.title,value:i.value})}this.selected=!1;let o=this;this.filling="#ffffff",this.borderColor="#000000","build"===plan&&"build"===this.plan&&(this.borderColor=colors.blue),this.IMAGE=svg.group().on("mouseover",function(e){o.mouseover(e)}).on("mouseleave",function(e){o.mouseleave(e)}).on("mousedown",function(e){o.mousedown(e)}),this.background=svg.polygon().attr({stroke:this.borderColor,"stroke-width":.3,fill:"#ffffff"}),this.BORDER_S=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4}),this.BORDER_E=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4}),this.door_leaf=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),this.door_leaf_1=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),this.door_leaf_2=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),this.door_arc=svg.path().attr({stroke:"#6588bf","stroke-width":.8,fill:"transparent"}),this.door_arc_1=svg.path().attr({stroke:"#6588bf","stroke-width":.8,fill:"transparent"}),this.door_arc_2=svg.path().attr({stroke:"#6588bf","stroke-width":.8,fill:"transparent"}),this.coupe_leaf=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),"door_penal"===this.type&&(this.border_center=svg.line().attr({stroke:"#ffffff","stroke-width":1.4}),this.leaf=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),this.border_left=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4}),this.border_right=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4}),this.border_top=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4,"stroke-linecap":"round"}),this.border_bottom=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4,"stroke-linecap":"round"})),"door_penal"!==this.type?(layers.doors.add(this.IMAGE),this.DIMENSION=layers.doors.group().on("mouseover",function(e){o.mouseover(e)}).on("mouseleave",function(e){o.mouseleave(e)}).on("mousedown",function(e){o.mousedown(e)})):(layers.doors_penal.add(this.IMAGE),this.DIMENSION=layers.doors_penal.group().on("mouseover",function(e){o.mouseover(e)}).on("mouseleave",function(e){o.mouseleave(e)}).on("mousedown",function(e){o.mousedown(e)})),this.draw()});function je(e,t){let i=[],n=!0;var s=copy.point(e.s);let o="E",l=0,r=!1;for(;"E"===o?e&&e.elink?(i.push(e.e),e.passed=!0,"S"===e.elink.end?o="E":"E"===e.elink.end&&(o="S"),e=t[e.elink.index]):r=!0:"S"===o&&(e&&e.slink?(i.push(e.s),e.passed=!0,"S"===e.slink.end?o="E":"E"===e.slink.end&&(o="S"),e=t[e.slink.index]):r=!0),1<i.length&&are_points_equal(s,i[i.length-1])&&(e&&(e.passed=!0),n=!1),l++,!0===n&&l<t.length;);return r||l===t.length?($(".contextmenu").hide(),!1):i=Ge(i)}w.prototype.setOpening=function(){"single"===this.type&&(this.opening="inner_right"),"double"===this.type&&(this.opening="R"),"door_coupe"===this.type&&(this.opening="inner_right"),"door_penal"===this.type&&(this.opening="right"),"door_penal"===this.type&&(this.border_center=svg.line().attr({stroke:"#ffffff","stroke-width":1.4}),this.leaf=svg.polygon().attr({stroke:this.borderColor,fill:this.filling}),this.border_left=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4}),this.border_right=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4}),this.border_top=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4,"stroke-linecap":"round"}),this.border_bottom=svg.line().attr({stroke:this.borderColor,"stroke-width":1.4,"stroke-linecap":"round"}))},w.prototype.expand=function(){var e,t=get_object(walls.db,this.id_wall);t&&(e=get_distance(this.s,t.s),get_distance(this.e,t.s)<e&&(t=copy.point(this.s),this.s=copy.point(this.e),this.e=copy.point(t),this.draw()))},w.prototype.bind=function(){this.wall=!1,this.id_wall=!1;for(let e=0;e<walls.db.length;e++){var t=walls.db[e];"init"!==this.plan&&"break"!==this.plan||"init"!==t.label&&"break"!==t.label||is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id),"build"!==this.plan||"init"!==t.label&&"build"!==t.label||is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id)}get_center(this.s,this.e);for(let e=0;e<walls.db.length;e++){var i=walls.db[e];"init_copy"!==i.label&&"build"!==i.label&&(LIB.distance(this.l1,i.l1)<=2&&(this.s_s=!0),LIB.distance(this.r1,i.r1)<=2&&(this.s_s=!0),are_points_equal(this.l1,i.l1)&&(this.s_s=!0),are_points_equal(this.r1,i.r1)&&(this.s_s=!0),LIB.distance(this.l2,i.l2)<=2&&(this.e_e=!0),LIB.distance(this.r2,i.r2)<=2&&(this.e_e=!0),are_points_equal(this.l2,i.l2)&&(this.e_e=!0),are_points_equal(this.r2,i.r2)&&(this.e_e=!0))}},w.prototype.calc=function(){this.bind(),this.length=get_distance(this.s,this.e)},w.prototype.draw_BAK=function(){for(let e=0;e<walls.db.length;e++){var t=walls.db[e];"init"!==this.plan&&"break"!==this.plan||"init"!==t.label&&"break"!==t.label||is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id),"build"===this.plan&&"build"===t.label&&is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id)}var i=get_object(walls.db,this.id_wall),i=(i&&(this.s=LIB.pointOnLine(i.s,this.center,-this.width/2),this.e=LIB.pointOnLine(i.e,this.center,-this.width/2),this.s_bak=copy.point(this.s),this.e_bak=copy.point(this.e),this.depth_o=i.outer_depth,this.depth_i=i.inner_depth),this.axis={s:this.s,e:this.e},this.angle=get_line_angle(this.axis),this.l1=point_near_line_end_point(this.e,this.s,this.depth_o,"R"),this.l2=point_near_line_end_point(this.s,this.e,this.depth_o,"L"),this.r1=point_near_line_end_point(this.e,this.s,this.depth_i,"L"),this.r2=point_near_line_end_point(this.s,this.e,this.depth_i,"R"),this.c_outer=LIB.pointOnLine(this.l1,this.l2,-this.width/2),this.c_inner=LIB.pointOnLine(this.r1,this.r2,-this.width/2),this.polygon=getPolygon(this),i&&(are_points_equal(this.l1,i.l1)&&(this.s_s=!0),are_points_equal(this.r1,i.r1)&&(this.s_s=!0),are_points_equal(this.l2,i.l2)&&(this.e_e=!0),are_points_equal(this.r2,i.r2)&&(this.e_e=!0)),is_point_exists(this.l1));if(i){if("doorway"===this.type&&this.background.plot([this.l1,this.l2,this.r2,this.r1]),"single"===this.type){var i=point_near_line_end_point(this.e,this.s,defs.door.depth/2,"R"),n=point_near_line_end_point(this.e,this.s,defs.door.depth/2,"L"),s=point_near_line_end_point(this.s,this.e,defs.door.depth/2,"L"),o=point_near_line_end_point(this.s,this.e,defs.door.depth/2,"R");this.background.plot([this.l1,this.l2,this.r2,this.r1]);let e;"inner_right"===this.opening&&(e=p(n,o,this.width,defs.door.depth,"inner_right")),"inner_left"===this.opening&&(e=p(n,o,this.width,defs.door.depth,"inner_left")),"outer_right"===this.opening&&(e=p(i,s,this.width,defs.door.depth,"outer_right")),"outer_left"===this.opening&&(e=p(i,s,this.width,defs.door.depth,"outer_left")),this.door_leaf.plot(e.polygon),this.door_arc.plot(e.path)}if("double"===this.type){var n=point_near_line_end_point(this.e,this.s,defs.door_double.depth/2,"R"),o=point_near_line_end_point(this.e,this.s,defs.door_double.depth/2,"L"),i=point_near_line_end_point(this.s,this.e,defs.door_double.depth/2,"L"),s=point_near_line_end_point(this.s,this.e,defs.door_double.depth/2,"R"),l=LIB.pointOnLine(n,i,-this.width/2),r=LIB.pointOnLine(o,s,-this.width/2);this.background.plot([this.l1,this.l2,this.r2,this.r1]);let e,t;"R"===this.opening&&(e=p(o,r,this.width/2,defs.door_double.depth,"inner_left"),t=p(r,s,this.width/2,defs.door_double.depth,"inner_right")),"L"===this.opening&&(e=p(n,l,this.width/2,defs.door_double.depth,"outer_left"),t=p(l,i,this.width/2,defs.door_double.depth,"outer_right")),"R"!==this.opening&&"L"!==this.opening||(this.door_leaf_1.plot(e.polygon),this.door_arc_1.plot(e.path),this.door_leaf_2.plot(t.polygon),this.door_arc_2.plot(t.path))}if("door_coupe"===this.type){this.background.plot([this.l1,this.l2,this.r2,this.r1]);let e;"inner_left"===this.opening&&(e=c(this.r1,this.r2,this.width,defs.door_coupe.depth,this.opening)),"inner_right"===this.opening&&(e=c(this.r1,this.r2,this.width,defs.door_coupe.depth,this.opening)),"outer_left"===this.opening&&(e=c(this.l1,this.l2,this.width,defs.door_coupe.depth,this.opening)),"outer_right"===this.opening&&(e=c(this.l1,this.l2,this.width,defs.door_coupe.depth,this.opening)),this.coupe_leaf.plot(e.polygon)}"door_penal"===this.type&&("left"===this.opening&&(o=LIB.pointOnLine(this.e,this.s,defs.door_penal.width),r=point_near_line_end_point(this.e,o,this.depth_o,"R"),s=point_near_line_end_point(this.e,o,this.depth_i,"L"),this.background.plot([r,this.l2,this.r2,s]),n=point_near_line_end_point(this.s,o,defs.door_penal.depth/2,"R"),l=point_near_line_end_point(o,this.s,defs.door_penal.depth/2,"L"),i=point_near_line_end_point(this.s,o,defs.door_penal.depth/2,"L"),o=point_near_line_end_point(o,this.s,defs.door_penal.depth/2,"R"),e=this.width,a=LIB.pointOnLine(l,n,.3*-e),n=LIB.pointOnLine(n,l,.3*e),l=LIB.pointOnLine(i,o,.3*e),o=LIB.pointOnLine(o,i,.3*-e),this.leaf.plot([a,n,l,o]),this.border_top.plot(r.x,r.y,this.l1.x,this.l1.y),this.border_bottom.plot(s.x,s.y,this.r1.x,this.r1.y),this.border_left.plot(r.x,r.y,s.x,s.y),this.border_right.plot(this.l2.x,this.l2.y,this.r2.x,this.r2.y)),"right"===this.opening&&(i=LIB.pointOnLine(this.s,this.e,defs.door_penal.width),e=point_near_line_end_point(this.s,i,this.depth_o,"L"),a=point_near_line_end_point(this.s,i,this.depth_i,"R"),this.background.plot([this.l1,e,a,this.r1]),n=point_near_line_end_point(i,this.e,defs.door_penal.depth/2,"R"),l=point_near_line_end_point(this.e,i,defs.door_penal.depth/2,"L"),o=point_near_line_end_point(i,this.e,defs.door_penal.depth/2,"L"),r=point_near_line_end_point(this.e,i,defs.door_penal.depth/2,"R"),s=this.width,i=LIB.pointOnLine(l,n,.3*s),n=LIB.pointOnLine(n,l,.3*-s),l=LIB.pointOnLine(o,r,.3*-s),r=LIB.pointOnLine(r,o,.3*s),this.leaf.plot([i,n,l,r]),this.border_top.plot(this.l2.x,this.l2.y,e.x,e.y),this.border_bottom.plot(this.r2.x,this.r2.y,a.x,a.y),this.border_left.plot(this.l1.x,this.l1.y,this.r1.x,this.r1.y),this.border_right.plot(e.x,e.y,a.x,a.y))),this.BORDER_S.plot(this.l1.x,this.l1.y,this.r1.x,this.r1.y),this.BORDER_E.plot(this.l2.x,this.l2.y,this.r2.x,this.r2.y),this.area=R(this.width*this.height/1e4),this.DIMENSION.clear(),"A"===plan_group&&("init"===this.plan&&this.DIMENSION.add(new Pe(this.s,this.e,"#f8f8f8")),"build"===this.plan&&this.DIMENSION.add(new Pe(this.s,this.e,"#cfdced"))),this.s=LIB.fixPoint(this.s),this.e=LIB.fixPoint(this.e),this.EdgeO={s:this.l1,e:this.l2},this.EdgeI={s:this.r1,e:this.r2};var e,a,h=get_point_near_line_center(this.l1,this.l2,5,"L"),g=get_point_near_line_center(this.r1,this.r2,5,"R");for(let e=0;e<rooms2.data.length;e++){var _=rooms2.data[e];is_point_inside_polygon(h,_.polygon)&&(this.room_o=_.id),is_point_inside_polygon(g,_.polygon)&&(this.room_i=_.id)}}this.IMAGE.clear(),"doorway"===this.type&&this.IMAGE.add(this.background),"single"===this.type&&(this.IMAGE.add(this.background),this.IMAGE.add(this.door_leaf),this.IMAGE.add(this.door_arc)),"double"===this.type&&(this.IMAGE.add(this.background),this.IMAGE.add(this.door_leaf_1),this.IMAGE.add(this.door_arc_1),this.IMAGE.add(this.door_leaf_2),this.IMAGE.add(this.door_arc_2)),"door_coupe"===this.type&&(this.IMAGE.add(this.background),this.IMAGE.add(this.coupe_leaf)),"door_penal"===this.type&&("left"===this.opening&&this.IMAGE.add(this.background),"right"===this.opening&&this.IMAGE.add(this.background)),"door_penal"===this.type&&(this.IMAGE.add(this.border_center),this.IMAGE.add(this.leaf),this.IMAGE.add(this.border_left),this.IMAGE.add(this.border_right),this.IMAGE.add(this.border_top),this.IMAGE.add(this.border_bottom));let d="#000000";"build"===plan&&"build"===this.plan&&(d=colors.blue),this.IMAGE.each(function(){this.stroke({color:d})}),"break"===plan&&!0===this.demount&&(this.IMAGE.add(svg.circle(24).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(this.center.x).cy(this.center.y)),this.IMAGE.add(svg.path(paths.sign_destroy).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(this.center.x).cy(this.center.y)))},w.prototype.draw=function(){for(let e=0;e<walls.db.length;e++){var t=walls.db[e];"init"!==this.plan&&"break"!==this.plan||"init"!==t.label&&"break"!==t.label||is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id),"build"===this.plan&&"build"===t.label&&is_point_inside_polygon(this.center,t.polygon)&&(this.wall=e,this.id_wall=walls.db[e].id)}var e=get_object(walls.db,this.id_wall),i=(e&&(this.s=LIB.pointOnLine(e.s,this.center,-this.width/2),this.e=LIB.pointOnLine(e.e,this.center,-this.width/2),this.s_bak=copy.point(this.s),this.e_bak=copy.point(this.e),this.depth_o=e.outer_depth,this.depth_i=e.inner_depth),this.axis={s:this.s,e:this.e},this.angle=get_line_angle(this.axis),this.l1=point_near_line_end_point(this.e,this.s,this.depth_o,"R"),this.l2=point_near_line_end_point(this.s,this.e,this.depth_o,"L"),this.r1=point_near_line_end_point(this.e,this.s,this.depth_i,"L"),this.r2=point_near_line_end_point(this.s,this.e,this.depth_i,"R"),this.c_outer=LIB.pointOnLine(this.l1,this.l2,-this.width/2),this.c_inner=LIB.pointOnLine(this.r1,this.r2,-this.width/2),this.polygon=getPolygon(this),e&&(LIB.distance(this.l1,e.l1)<=2&&(this.s_s=!0),LIB.distance(this.r1,e.r1)<=2&&(this.s_s=!0),are_points_equal(this.l1,e.l1)&&(this.s_s=!0),are_points_equal(this.r1,e.r1)&&(this.s_s=!0),LIB.distance(this.l2,e.l2)<=2&&(this.e_e=!0),LIB.distance(this.r2,e.r2)<=2&&(this.e_e=!0),are_points_equal(this.l2,e.l2)&&(this.e_e=!0),are_points_equal(this.r2,e.r2)&&(this.e_e=!0)),is_point_exists(this.l1));if(i){if("doorway"===this.type&&this.background.plot([this.l1,this.l2,this.r2,this.r1]),"single"===this.type){var i=point_near_line_end_point(this.e,this.s,defs.door.depth/2,"R"),n=point_near_line_end_point(this.e,this.s,defs.door.depth/2,"L"),s=point_near_line_end_point(this.s,this.e,defs.door.depth/2,"L"),o=point_near_line_end_point(this.s,this.e,defs.door.depth/2,"R");this.background.plot([this.l1,this.l2,this.r2,this.r1]);let e;"inner_right"===this.opening&&(e=p(n,o,this.width,defs.door.depth,"inner_right")),"inner_left"===this.opening&&(e=p(n,o,this.width,defs.door.depth,"inner_left")),"outer_right"===this.opening&&(e=p(i,s,this.width,defs.door.depth,"outer_right")),"outer_left"===this.opening&&(e=p(i,s,this.width,defs.door.depth,"outer_left")),this.door_leaf.plot(e.polygon),this.door_arc.plot(e.path)}if("double"===this.type){var n=point_near_line_end_point(this.e,this.s,defs.door_double.depth/2,"R"),o=point_near_line_end_point(this.e,this.s,defs.door_double.depth/2,"L"),i=point_near_line_end_point(this.s,this.e,defs.door_double.depth/2,"L"),s=point_near_line_end_point(this.s,this.e,defs.door_double.depth/2,"R"),l=LIB.pointOnLine(n,i,-this.width/2),r=LIB.pointOnLine(o,s,-this.width/2);this.background.plot([this.l1,this.l2,this.r2,this.r1]);let e,t;"R"===this.opening&&(e=p(o,r,this.width/2,defs.door_double.depth,"inner_left"),t=p(r,s,this.width/2,defs.door_double.depth,"inner_right")),"L"===this.opening&&(e=p(n,l,this.width/2,defs.door_double.depth,"outer_left"),t=p(l,i,this.width/2,defs.door_double.depth,"outer_right")),"R"!==this.opening&&"L"!==this.opening||(this.door_leaf_1.plot(e.polygon),this.door_arc_1.plot(e.path),this.door_leaf_2.plot(t.polygon),this.door_arc_2.plot(t.path))}if("door_coupe"===this.type){this.background.plot([this.l1,this.l2,this.r2,this.r1]);let e;"inner_left"===this.opening&&(e=c(this.r1,this.r2,this.width,defs.door_coupe.depth,this.opening)),"inner_right"===this.opening&&(e=c(this.r1,this.r2,this.width,defs.door_coupe.depth,this.opening)),"outer_left"===this.opening&&(e=c(this.l1,this.l2,this.width,defs.door_coupe.depth,this.opening)),"outer_right"===this.opening&&(e=c(this.l1,this.l2,this.width,defs.door_coupe.depth,this.opening)),this.coupe_leaf.plot(e.polygon)}"door_penal"===this.type&&("left"===this.opening&&(o=LIB.pointOnLine(this.e,this.s,defs.door_penal.width),r=point_near_line_end_point(this.e,o,this.depth_o,"R"),s=point_near_line_end_point(this.e,o,this.depth_i,"L"),this.background.plot([r,this.l2,this.r2,s]),n=point_near_line_end_point(this.s,o,defs.door_penal.depth/2,"R"),l=point_near_line_end_point(o,this.s,defs.door_penal.depth/2,"L"),i=point_near_line_end_point(this.s,o,defs.door_penal.depth/2,"L"),o=point_near_line_end_point(o,this.s,defs.door_penal.depth/2,"R"),a=this.width,h=LIB.pointOnLine(l,n,.3*-a),n=LIB.pointOnLine(n,l,.3*a),l=LIB.pointOnLine(i,o,.3*a),o=LIB.pointOnLine(o,i,.3*-a),this.leaf.plot([h,n,l,o]),this.border_top.plot(r.x,r.y,this.l1.x,this.l1.y),this.border_bottom.plot(s.x,s.y,this.r1.x,this.r1.y),this.border_left.plot(r.x,r.y,s.x,s.y),this.border_right.plot(this.l2.x,this.l2.y,this.r2.x,this.r2.y)),"right"===this.opening&&(i=LIB.pointOnLine(this.s,this.e,defs.door_penal.width),a=point_near_line_end_point(this.s,i,this.depth_o,"L"),h=point_near_line_end_point(this.s,i,this.depth_i,"R"),this.background.plot([this.l1,a,h,this.r1]),n=point_near_line_end_point(i,this.e,defs.door_penal.depth/2,"R"),l=point_near_line_end_point(this.e,i,defs.door_penal.depth/2,"L"),o=point_near_line_end_point(i,this.e,defs.door_penal.depth/2,"L"),r=point_near_line_end_point(this.e,i,defs.door_penal.depth/2,"R"),s=this.width,i=LIB.pointOnLine(l,n,.3*s),n=LIB.pointOnLine(n,l,.3*-s),l=LIB.pointOnLine(o,r,.3*-s),r=LIB.pointOnLine(r,o,.3*s),this.leaf.plot([i,n,l,r]),this.border_top.plot(this.l2.x,this.l2.y,a.x,a.y),this.border_bottom.plot(this.r2.x,this.r2.y,h.x,h.y),this.border_left.plot(this.l1.x,this.l1.y,this.r1.x,this.r1.y),this.border_right.plot(a.x,a.y,h.x,h.y))),"door_penal"!==this.type&&(this.BORDER_S.plot(this.l1.x,this.l1.y,this.r1.x,this.r1.y),this.BORDER_E.plot(this.l2.x,this.l2.y,this.r2.x,this.r2.y)),this.area=R(this.width*this.height/1e4),this.DIMENSION.clear(),"A"===plan_group&&("init"===this.plan&&this.DIMENSION.add(new Pe(this.s,this.e,"#f8f8f8")),"build"===this.plan&&this.DIMENSION.add(new Pe(this.s,this.e,"#cfdced"))),this.s=LIB.fixPoint(this.s),this.e=LIB.fixPoint(this.e),this.EdgeO={s:this.l1,e:this.l2},this.EdgeI={s:this.r1,e:this.r2};var a,h,g=get_point_near_line_center(this.l1,this.l2,5,"L"),_=get_point_near_line_center(this.r1,this.r2,5,"R");for(let e=0;e<rooms2.data.length;e++){var d=rooms2.data[e];is_point_inside_polygon(g,d.polygon)&&(this.room_o=d.id),is_point_inside_polygon(_,d.polygon)&&(this.room_i=d.id)}}this.IMAGE.clear(),"door_penal"!==this.type&&(this.IMAGE.add(this.background),this.IMAGE.add(this.BORDER_S),this.IMAGE.add(this.BORDER_E),"single"===this.type&&(this.IMAGE.add(this.door_leaf),this.IMAGE.add(this.door_arc)),"double"===this.type&&(this.IMAGE.add(this.door_leaf_1),this.IMAGE.add(this.door_arc_1),this.IMAGE.add(this.door_leaf_2),this.IMAGE.add(this.door_arc_2)),"door_coupe"===this.type&&this.IMAGE.add(this.coupe_leaf),layers.doors.add(this.IMAGE),layers.doorsDimensions.add(this.DIMENSION)),"door_penal"===this.type&&(this.IMAGE.add(this.background),this.IMAGE.add(this.leaf),this.IMAGE.add(this.border_top),this.IMAGE.add(this.border_bottom),this.IMAGE.add(this.border_left),this.IMAGE.add(this.border_right),layers.penalDoors.add(this.IMAGE),layers.doorsDimensions.add(this.DIMENSION)),this.paint(),this.DIMENSION.show(),e&&"break"===plan&&!0===this.demount&&(this.DIMENSION.hide(),this.IMAGE.add(svg.circle(24).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(this.center.x).cy(this.center.y)),this.IMAGE.add(svg.path(paths.sign_destroy).attr({stroke:"crimson","stroke-width":.8,fill:"#ffffff"}).cx(this.center.x).cy(this.center.y)))},w.prototype.demountAllWall=function(){for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"!==e.label&&"init_copy"!==e.label||this.s&&this.e&&are_lines_equal(this.axis,e)&&(e.label="break")}},w.prototype.split=function(e){if("wall"===e&&"init"===this.plan){let i=get_line(this.s,this.e);var n,s,o,l,r,a,h,g;!this.s_s&&!this.e_e||(e=get_object(walls.db,this.id_wall))&&(this.s_s&&(i.s=copy.point(e.s)),this.e_e&&(i.e=copy.point(e.e)));for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"===e.label&&is_point_inside_polygon(this.center,e.polygon)&&(n=are_points_equal(i.s,e.s),s=are_points_equal(i.s,e.e),o=is_point_on_line(i.s,e.axis),l=is_point_on_line(i.e,e.axis),n||s||o&&l&&e.split(i.s,"sector"))}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];"init"===e.label&&is_point_inside_polygon(this.center,e.polygon)&&(r=are_points_equal(i.e,e.s),a=are_points_equal(i.e,e.e),h=is_point_on_line(i.s,e.axis),g=is_point_on_line(i.e,e.axis),r||a||h&&g&&e.split(i.e,"sector"))}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];if("init"===e.label&&are_lines_equal(i,e)){e.delete();break}}for(let t=0;t<walls.db.length;t++){let e=walls.db[t];!0===e.part&&e.length<2&&(e.delete(),t--)}}},w.prototype.select=function(e){var t="orange",i=hatch.orange;this.background.attr({stroke:t,fill:i}),this.door_leaf.attr({stroke:t,fill:i}),this.door_leaf_1.attr({stroke:t,fill:i}),this.door_leaf_2.attr({stroke:t,fill:i})},w.prototype.paint=function(e){this.filling="#ffffff",this.borderColor="#000000","break"===plan&&!0===this.demount&&(this.filling=hatch.crimson,this.borderColor=colors.crimson),"build"===plan&&"build"===this.plan&&(this.borderColor=colors.blue),"select"===e&&(this.filling=hatch.orange,this.borderColor="orange"),this.background.attr({stroke:this.borderColor,fill:this.filling}),this.leaf&&this.leaf.attr({stroke:this.borderColor,fill:this.filling}),this.coupe_leaf&&this.coupe_leaf.attr({stroke:this.borderColor,fill:this.filling}),this.door_leaf.attr({stroke:this.borderColor,fill:this.filling}),this.door_leaf_1.attr({stroke:this.borderColor,fill:this.filling}),this.door_leaf_2.attr({stroke:this.borderColor,fill:this.filling})},w.prototype.rotate=function(){if("single"===this.type||"door_coupe"===this.type)switch(this.opening){case"inner_right":this.opening="inner_left",this.draw();break;case"inner_left":this.opening="outer_left",this.draw();break;case"outer_left":this.opening="outer_right",this.draw();break;case"outer_right":this.opening="inner_right",this.draw()}if("double"===this.type)switch(this.opening){case"R":this.opening="L",this.draw();break;case"L":this.opening="R",this.draw()}if("door_penal"===this.type)switch(this.opening){case"right":this.opening="left",this.draw();break;case"left":this.opening="right",this.draw()}},w.prototype.hide=function(){this.IMAGE.hide(),this.DIMENSION.hide()},w.prototype.show=function(){this.IMAGE.show(),this.DIMENSION.show()},w.prototype.erase=function(){this.IMAGE.clear(),this.DIMENSION.clear()},w.prototype.delete=function(){if("init"===this.plan)for(let e=0;e<walls.db.length;e++){var t=walls.db[e];if("build"===t.label&&is_point_inside_polygon(this.center,t.polygon))return void warning.show("red",l10n.door_delete_interfere_wall_build)}let e=get_object(walls.db,this.id_wall);this.deleteOnly(),e&&e.init(),customCursor.fire("reset")},w.prototype.deleteOnly=function(){this.erase();var e=objectIndexById(doors.db,this.id);void 0!==e&&doors.db.splice(e,1)},w.prototype.delete_rooms2=function(){var i=get_point_near_line_center(this.l1,this.l2,5,"L"),n=get_point_near_line_center(this.r1,this.r2,5,"R");for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.to_delete=!1,is_point_inside_polygon(i,e.polygon)&&(e.to_delete=!0),is_point_inside_polygon(n,e.polygon)&&(e.to_delete=!0)}for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];!0===e.to_delete&&(e.delete(),console.log("Удалена комната",t),t--)}},w.prototype.isEntrance=function(){if(this.entrance=!1,is_point_exists(this.s)&&is_point_exists(this.e)){var n=get_point_near_line_center(this.l1,this.l2,5,"L"),s=get_point_near_line_center(this.r1,this.r2,5,"R");let t=!1,i=!1;for(let e=0;e<rooms2.data.length;e++){var o=rooms2.data[e];is_point_inside_polygon(n,o.polygon)&&(t=!0),is_point_inside_polygon(s,o.polygon)&&(i=!0)}(t&&!i||!t&&i)&&(this.entrance=!0)}},w.prototype.isDraggable=function(){if("build"===plan&&"build"===this.plan)for(let e=0;e<doors.db.length;e++){var t=doors.db[e];if(!0===t.hasReplacement&&are_points_equal(this.center,t.center))return warning.show("yellow",l10n.door_replace_door_not_move),!1}return!0===this.demount?(warning.show("yellow",l10n.door_marked_break_not_move),!1):!0!==this.hasReplacement||(warning.show("yellow",l10n.door_not_move_it_replace),!1)},w.prototype.isActive=function(){return this.plan===plan},w.prototype.isAvailable=function(){var e=this.plan===plan,t="break_door"===tool&&"break"===plan;return e||t},w.prototype.isDemountable=function(){return"break_door"===tool&&"break"===plan&&!1===this.demount},w.prototype.paint=function(e=!1){if(!e){let e=colors.grey,t=colors.white;"break"===plan&&!0===this.demount&&(e=colors.crimson,t=hatch.crimson),"build"===plan&&"build"===this.plan&&(e=colors.blue),this.background.attr({stroke:e,fill:t}),this.door_leaf.attr({stroke:e,fill:t}),this.door_leaf_1.attr({stroke:e,fill:t}),this.door_leaf_2.attr({stroke:e,fill:t})}e&&(this.background.attr({stroke:colors[e],fill:hatch[e]}),this.door_leaf.attr({stroke:colors[e],fill:hatch[e]}),this.door_leaf_1.attr({stroke:colors[e],fill:hatch[e]}),this.door_leaf_2.attr({stroke:colors[e],fill:hatch[e]}))},w.prototype.glow=function(e){"on"!==e||"break"!==plan||"break_door"!==tool||!1!==this.demount||this.glowVisible||(this.glowVisible=!0,customCursor.overObject=!0,this.GLOW=svg.polygon(this.polygon).attr({stroke:"red","stroke-width":2,"stroke-linecap":"round",fill:"none",opacity:.6})),"off"===e&&"break"===plan&&"break_door"===tool&&this.glowVisible&&(this.glowVisible=!1,customCursor.overObject=!1,this.GLOW.remove())},w.prototype.mouseover=function(e){if(isContextmenuHidden()&&(this.plan===plan&&("none"===tool&&this.paint("orange"),"eraser"===tool&&(this.paint("crimson"),customCursor.overObject=!0)),"break"===plan)){if(!1===this.demount){if("break"===tool){let e=get_object(walls.db,this.id_wall);e&&e.glow("on"),customCursor.overObject=!0}"break_door"===tool&&(this.glow("on"),customCursor.overObject=!0)}!0===this.demount&&"eraser"===tool&&(this.paint("crimson"),customCursor.overObject=!0)}},w.prototype.mouseleave=function(e){if("moving"!==tool&&isContextmenuHidden()&&(this.plan===plan&&(this.paint(),customCursor.overObject=!1),"break"===plan&&("break_door"===tool&&(this.glow("off"),customCursor.overObject=!0),"break"===tool))){let e=get_object(walls.db,this.id_wall);e&&e.glow("off"),customCursor.overObject=!0}},w.prototype.mousedown=function(e){var t=tool;if(Oe(),tool=t,this.glow("off"),this.isActive()&&this.paint("orange"),id.door=this.id,id.wall=this.id_wall,selectedObject="door","B"!==plan_group){if(1===e.detail){if(1===e.which){if("init"===plan){if(!0===this.demount){let e=l10n.door_marked_break;return"doorway"===this.type&&(e=l10n.doorway_marked_break),void warning.show("red",e)}if("eraser"===tool&&"init"===this.plan)return customCursor.fire("knock"),this.delete(),void project.localSave();if(("none"===tool||"moving"===tool)&&"init"===plan)return!1===this.isDraggable()?void 0:void doorControl.fire("on")}if("break"===plan){if("break"!==tool&&"break_door"!==tool&&"eraser"!==tool&&!1===this.demount){let e=l10n.door_on_init_plan;return"doorway"===this.type&&(e=l10n.doorway_on_init_plan),void warning.show("yellow",e)}if("break_door"===tool){if(!0===this.hasReplacement)return void warning.show("yellow",l10n.door_not_break);if(!1===this.demount)return this.demount=!0,this.draw(),this.delete_rooms2(),customCursor.fire("knock"),void project.localSave()}if("eraser"===tool){if(!1===this.demount){let e=l10n.door_on_init_plan;return"doorway"===this.type&&(e=l10n.doorway_on_init_plan),void warning.show("yellow",e)}if(!0===this.demount){let e=get_object(walls.db,this.id_wall);e&&("break"===e.label&&(e.removeBreakLabel(),customCursor.fire("knock"),project.draw(),project.localSave()),"break"!==e.label&&!0===this.demount&&(this.demount=!1,this.draw(),this.delete_rooms2(),customCursor.fire("knock"),project.localSave()))}}}if("build"===plan){if("build"!==this.plan&&"door"!==tool){let e=l10n.door_on_init_plan;return"doorway"===this.type&&(e=l10n.doorway_on_init_plan),void warning.show("yellow",e)}if("eraser"===tool&&"build"===this.plan)return $('#door_contextmenu [action="delete"]').trigger("click"),void customCursor.fire("knock");if(("none"===tool||"moving"===tool)&&plan===this.plan)return!1===this.isDraggable()?void 0:void doorControl.fire("on")}}3===e.which&&(this.glow("off"),this.showContextmenu(e))}2===e.detail&&(this.glow("off"),this.showContextmenu(e))}},w.prototype.showContextmenu=function(e){var t;if(("init"===plan||"build"===plan)&&(this.plan===plan&&(this.selected=!0,allow.pan=!1,selected.wall=this.wall,"doorway"===this.type&&($("#doorway_width_input").val("").attr("placeholder",this.width.toFixed()),$("#doorway_height_input").val("").attr("placeholder",this.height.toFixed()),showContextmenu("#doorway_contextmenu",e.clientX,e.clientY,canvas.position().top)),"doorway"!==this.type))){var i;if($("#door_width_input").val("").attr("placeholder",this.width.toFixed()),$("#door_height_input").val("").attr("placeholder",this.height.toFixed()),$("#window_contextmenu_custom_options span").remove(),$("#window_contextmenu_custom_options div").remove(),!1!==this.custom_options){let e=this.custom_options;for(var n in e)if(e[n].hasOwnProperty("options")){var s,o=e[n].name;for(s in $("#window_contextmenu_custom_options").append('<div class="contextmenu_item textinput" id=""><span>'+e[n].title+'</span><div class="contextmenu_item_input"><select name="" id="'+o+'"></select></div></div>'),e[n].options){var l=e[n].options[s].title,r=e[n].options[s].value;this.values[o]&&r===this.values[o].value?$("#"+o).append(new Option(l,r,!0,!0)):$("#"+o).append(new Option(l,r))}}}if(!1!==this.custom_options){let e=this.custom_options;for(var a in e)e[a].hasOwnProperty("options")||(i=e[a].name,e[a].value,this.values[i]&&this.values[i].value,$("#window_contextmenu_custom_options").append('<div class="contextmenu_item input"><span>'+e[a].title+'</span><div class="contextmenu_item_input"><input id="'+e[a].name+'" type="text" maxlength="5" placeholder="'+this.values[i].value+'" /><span>ОК</span><em>см</em></div></div>'))}showContextmenu("#door_contextmenu",e.clientX,e.clientY,canvas.position().top)}"break"===plan&&this.demount&&(t=get_object(walls.db,this.id_wall))&&("break"===t.label?showContextmenu("#wall-sector-contextmenu",e.clientX,e.clientY,canvas.position().top):showContextmenu("#door_contextmenu_v2",e.clientX,e.clientY,canvas.position().top))},w.prototype.rollback=function(){console.warn("ROLL"),this.typeBak&&this.openingBak&&(this.type=this.typeBak,this.opening=this.openingBak,this.hasReplacement=!1,this.draw(),delete this.typeBak,delete this.openingBak)},window.rooms1={data:[],create:function(){walls.define_inside_rooms("init");var s,o=ee("init");for(let n=0;n<o.length;n++){let t=o[n],i=.4;"pillar"===t.parent&&(i=.6);for(let e=0;e<o.length;e++)e!==n&&(s=o[e],get_distance(t.s,s.s)<i?t.slink={index:e,end:"S"}:get_distance(t.s,s.e)<1&&(t.slink={index:e,end:"E"}),get_distance(t.e,s.s)<i?t.elink={index:e,end:"S"}:get_distance(t.e,s.e)<1&&(t.elink={index:e,end:"E"}))}let n=[];for(let e=0;e<o.length;e++){var t=o[e];t.passed||(t=je(t,o))&&n.push(t)}for(let t=0;t<n.length;t++){var i=n[t];for(let e=0;e<walls.db.length;e++){var l=walls.db[e];if(!l.inside_room&&("build"!==l.label&&"init_copy"!==l.label&&is_point_inside_polygon(l.c,i))){n.splice(t,1),t--;break}}}for(let i=0;i<n.length;i++){var r=n[i];if(4===r.length)for(let e=0;e<pillars.db.length;e++){var a=pillars.db[e];if(is_point_inside_polygon(a.center,r)){let t=0;for(let e=0;e<r.length;e++)if(are_points_equal(r[e],a.p1)&&t++,are_points_equal(r[e],a.p2)&&t++,are_points_equal(r[e],a.p3)&&t++,are_points_equal(r[e],a.p4)&&t++,4===t){n.splice(i,1),i--;break}}}}for(let t=0;t<n.length;t++){var h=get_polygon_centroid(n[t]);for(let e=0;e<n.length;e++)if(t!==e){var g=get_polygon_centroid(n[e]);if(are_points_equal(h,g)){n.splice(t,1),t--;break}}}for(let e=0;e<n.length;e++)(function(n){for(let e=0;e<n.length-1;e++){var t=n[e],i=n[e+1];are_points_equal(t,i)&&(n[e].remove=!0)}for(let e=0;e<n.length;e++)!0===n[e].remove&&(n.splice(e,1),e--);for(let i=0;i<n.length;i++){let e,t;t=0===i?(e=n[n.length-1],n[1]):i===n.length-1?(e=n[n.length-2],n[0]):(e=n[i-1],n[i+1]);var s=get_line(e,t);is_point_on_line(n[i],s)&&(n[i].remove=!0)}for(let e=0;e<n.length;e++)!0===n[e].remove&&(n.splice(e,1),e--)})(n[e]);rooms1.remove();for(let e=0;e<n.length;e++)rooms1.data.push(new Fe(n[e]))},erase:function(){for(let e=0;e<rooms1.data.length;e++)rooms1.data[e].erase()},remove:function(){rooms1.erase(),rooms1.data=[]}};function Re(e,t){let i=this;e.id?this.id=e.id:this.id=LIB.id(),this.data=e,"zone"===this.data.type&&(this.plan="build"),"floor"===this.data.type&&(this.plan="floor"),"hydroisolation"===this.data.type&&(this.plan="hydroisolation"),"ceiling"===this.data.type&&(this.plan="ceiling");var n=get_point_near_line_end(e.e,e.s,5,"R"),s=get_point_near_line_end(e.s,e.e,5,"L"),o=get_point_near_line_end(e.e,e.s,5,"L"),l=get_point_near_line_end(e.s,e.e,5,"R");return this.IMAGE=layers.delimiters.group().on("mouseover",function(e){i.mouseover(e)}).on("mouseleave",function(e){i.mouseleave(e)}).on("mousedown",function(e){i.mousedown(e)}),this.LINE=this.IMAGE.line(e.s.x,e.s.y,e.e.x,e.e.y).attr({"stroke-width":.8,stroke:"#000000","stroke-dasharray":4}),this.BACKGROUND=this.IMAGE.polygon([[n.x,n.y],[s.x,s.y],[l.x,l.y],[o.x,o.y]]).attr({stroke:"none",fill:"transparent"}),this.IMAGE}let Fe=function(e){this.points=e,this.points=delete_empties(this.points),this.plan="init",this.id=LIB.id(),this.polygon=this.points.slice(),background_image_loaded?this.filling="transparent":this.filling="#ffffff",this.FLOOR=layers.rooms.polygon(this.points).attr({fill:this.filling}).on("mousedown",function(e){in_array(tool,["ruler","moving"])||(delete_empty_comment(),1===e.which&&newHide(),3===e.which&&oldHide())}),this.edges=[];for(let i=0;i<this.points.length;i++){let e=this.points[i],t;t=i===this.points.length-1?this.points[0]:this.points[i+1],this.edges[i]={s:e,e:t,parent:"wall"};var n=get_point_near_line_center(e,t,5,"L"),s=get_point_near_line_center(e,t,5,"R");is_point_inside_polygon(n,this.points)&&(this.edges[i].room_side="L"),is_point_inside_polygon(s,this.points)&&(this.edges[i].room_side="R"),this.edges[i].inside_room=!1}for(let e=0;e<walls.db.length;e++){var o=walls.db[e];if("init"===o.label&&(!0===o.inside_room&&is_point_inside_polygon(o.c,this.polygon))){let i=[];for(let e=0;e<o.borders.o.length;e++)i.push(o.borders.o[e]);for(let e=0;e<o.borders.i.length;e++)i.push(o.borders.i[e]);for(let e=0;e<o.borders.s.length;e++)i.push(o.borders.s[e]);for(let e=0;e<o.borders.e.length;e++)i.push(o.borders.e[e]);for(let t=0;t<i.length;t++){var l=i[t],r=get_point_near_line_center(l.s,l.e,5,"L"),a=get_point_near_line_center(l.s,l.e,5,"R");let e;is_point_inside_polygon(r,o.polygon)&&(e="R"),is_point_inside_polygon(a,o.polygon)&&(e="L"),this.edges.push({s:l.s,e:l.e,room_side:e,parent:"wall",inside_room:o.inside_room})}}}for(let e=0;e<pillars.db.length;e++){var t=pillars.db[e];if(is_point_inside_polygon(t.center,this.polygon)&&"pillar"===t.role)for(let e=0;e<t.borders.length;e++){var i=t.borders[e];this.edges.push({s:i.s,e:i.e,room_side:"L",parent:"pillar",inside_room:t.inside_room})}}for(let e=0;e<2;e++)for(let e=0;e<this.edges.length;e++)LIB.mergeLines(this.edges[e],e,this.edges);if(0<this.points.length){if(this.area=R(polygon_area(this.points)/1e4,1),"init"===plan||"break"===plan)for(let e=0;e<pillars.db.length;e++){var h=pillars.db[e];"floor"!==h.anchor||"pillar"!==h.role&&"pillar_air"!==h.role||is_point_inside_polygon(h.center,this.points)&&(this.area-=h.area)}for(let e=0;e<walls.db.length;e++){var g=walls.db[e];!1!==g.inside_room&&"init_copy"!==g.label&&"build"!==g.label&&is_point_inside_polygon(g.c,this.points)&&(g=get_polygon_area(g.polygon),this.area-=g)}this.area=R(this.area,1),this.center=get_polygon_centroid(this.points)}if(.5<this.area){let t=this;this.AREA=layers.rooms.text(function(e){e.tspan(t.area.toString()+" м").font({size:12,stroke:"#dc143c","stroke-width":.1,fill:"#dc143c"}),e.tspan("2").font({size:7,stroke:"#dc143c","stroke-width":.1,fill:"#dc143c"}).dy(-4)}),this.AREA.cx(this.center.x).cy(this.center.y)}};Fe.prototype.erase=function(){this.FLOOR&&this.FLOOR.remove(),this.AREA&&this.AREA.remove()};function Ge(i){let n=[];e:for(let t=0;t<i.length;t++){for(let e=0;e<n.length;e++)if(are_points_equal(n[e],i[t]))continue e;n.push(i[t])}return n}Re.prototype.mouseover=function(e){this.plan===plan&&isContextmenuHidden()&&("none"===tool&&this.LINE.attr({"stroke-width":1.4,stroke:"orange","stroke-dasharray":4}),"eraser"===tool&&(customCursor.overObject=!0,this.LINE.attr({"stroke-width":1.4,stroke:"crimson","stroke-dasharray":4})))},Re.prototype.mouseleave=function(e){this.plan!==plan||!isContextmenuHidden()||"none"!==tool&&"eraser"!==tool||(customCursor.overObject=!1,this.LINE.attr({"stroke-width":.8,stroke:"#000000","stroke-dasharray":4}))},Re.prototype.mousedown=function(e){if(this.plan===plan&&(1===e.which&&"eraser"===tool&&(id.room=this.data.id_room,id.delimiter=this.id,customCursor.fire("eraserReaction",e),$('#delimiter-contextmenu [action="delete"]').trigger("click")),(3===e.which||2===e.detail)&&"none"===tool)){var t="build"===plan&&"zone"===this.data.type,i="floor"===plan&&"floor"===this.data.type,n="hydroisolation"===plan&&"hydroisolation"===this.data.type,s="ceiling"===plan&&"ceiling"===this.data.type;if(t||i||n||s){for(var o in $(".contextmenu").hide(),hide(),arrow.hide(),allow.pan=!1,P(),id.room=this.data.id_room,id.delimiter=this.data.id,images.delimiters){let e=images.delimiters[o];e.each(function(){"line"===this.type&&this.attr({"stroke-width":.8,stroke:"#000000","stroke-dasharray":4})})}this.LINE.attr({stroke:"orange","stroke-width":1.4}),showContextmenu("#delimiter-contextmenu",e.clientX,e.clientY,canvas.position().top)}}};window.create_rooms=function(){"init"!==plan&&"break"!==plan||rooms1.create(),console.warn("create_rooms"),"build"===plan&&rooms2.create()},window.rooms2={data:[],calc:function(){for(let e=0;e<rooms2.data.length;e++)rooms2.data[e].calc()},draw:function(){if("build"===plan||"B"===plan_group)for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.draw()}},erase:function(){for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.erase()}},copy:function(){let t=[];for(let e=0;e<rooms2.data.length;e++){var i=rooms2.data[e];for(let t=0;t<i.floors.length;t++){let e=i.floors[t];delete e.filling,delete e.edges,delete e.center}for(let t=0;t<i.hydroisolation.length;t++){let e=i.hydroisolation[t];delete e.filling,delete e.edges,delete e.center}for(let t=0;t<i.ceilings.length;t++){let e=i.ceilings[t];delete e.center,e.edges2&&delete e.edges2}t[e]={points:i.points,polygon:i.polygon,center:i.center,zones:i.zones,floors:i.floors,hydroisolation:i.hydroisolation,ceilings:i.ceilings,delimiters:i.delimiters,edges:i.edges,corners:i.corners,name:i.name,floor:i.floor,floorMoldings:i.floorMoldings,warm_floors:i.warm_floors,decor:i.decor,ceiling:i.ceilings,ceilingMoldings:i.ceilingMoldings,isolation:i.isolation,plaster:i.plaster,led_strips:i.led_strips,cap:i.cap,cap_type:i.cap_type,cap_center:i.cap_center,id:i.id,id_parent_room:i.id_parent_room,plan:i.plan,height:i.height,area:i.area,in_pillar:i.in_pillar,perimeter:i.perimeter,perimeter_walls:i.perimeter_walls}}return t},get_walls_info:function(){for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.get_walls_info()}},delete:function(){rooms2.erase(),rooms2.data=[]},create:function(){walls.define_inside_rooms("build");let r=ee("build");for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.edges.length<3&&(e.erase(),rooms2.data.splice(t,1),t--)}for(let i=0;i<r.length;i++){var e=r[i];if(("pillar"!==e.parent||"floor"!==e.parent_anchor)&&(("pillar"!==e.parent||"gypsum"!==e.parent_role)&&3<LIB.lineLength(e))){var n=get_line_center(e);for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];is_point_inside_polygon(n,e.polygon)&&(console.warn(i,"Room2 ("+e.zones[0].area+") edge inside"),e.remove=!0)}}}for(let l=0;l<rooms2.data.length;l++){let o=rooms2.data[l];for(let e=0;e<o.edges.length;e++){var a=o.edges[e];if(!a.inside_room||!0!==a.inside_room){var h=LIB.lineLength(a);if(h<=10){var i=get_line_center(a);let t=!1;for(let e=0;e<r.length;e++)if(is_point_on_line(i,r[e],.05)){t=!0;break}t||(console.warn(l,"Room2 ("+o.zones[0].area+") air edge"),o.remove=!0)}if(10<h){var h=get_line_center(a),g=LIB.pointOnLine(a.e,a.s,-3),_=LIB.pointOnLine(a.s,a.e,-3),d=LIB.pointOnLine(a.e,h,-3),h=LIB.pointOnLine(a.s,h,-3),p=get_perpendicular_line(a,d,6),c=get_perpendicular_line(a,h,6);let t=!1,i=!1,n=!1,s=!1;for(let e=0;e<r.length;e++){var A=r[e];is_point_on_line_1_sm(g,A,.05)&&(t=!0),is_point_on_line_1_sm(_,A,.05)&&(i=!0),line_and_line_intersection(p,A)&&(n=!0),line_and_line_intersection(c,A)&&(s=!0)}t&&i&&(n||s)||(console.warn(l,"Room2 ("+o.zones[0].area+") air edge"),o.remove=!0)}}}}for(let e=0;e<r.length;e++){let t=r[e];t.hasRoom=!1;var s=t.s,o=t.e;let i=LIB.pointOnLine(t.e,t.s,-3),n=LIB.pointOnLine(t.s,t.e,-3);LIB.lineLength(t)<10&&(i=LIB.pointOnLine(t.e,t.s,-.8),n=LIB.pointOnLine(t.s,t.e,-.8));for(let e=0;e<rooms2.data.length;e++){var l=rooms2.data[e];for(let e=0;e<l.edges.length;e++){var u=l.edges[e],w=is_point_on_line(s,u),m=is_point_on_line(i,u),f=is_point_on_line(o,u),u=is_point_on_line(n,u);(w&&m||f&&u)&&(t.hasRoom=!0)}}}for(let e=0;e<r.length;e++){var I=r[e];if(!1===I.hasRoom&&.99<LIB.lineLength(I))for(let i=0;i<rooms2.data.length;i++){let t=rooms2.data[i];for(let e=0;e<t.edges.length;e++){var C=t.edges[e],y=is_point_on_line(I.s,C),C=is_point_on_line(I.e,C);(y||C)&&(console.warn(i,"Room2 ("+t.zones[0].area+") hasRoom false"),t.remove=!0)}}}for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];!0===e.remove&&(e.erase(),rooms2.data.splice(t,1),t--)}0<project.errors.roomRebuild&&console.warn("Есть постоянно пересоздающаяся комната");for(let t=0;t<r.length;t++){var b=r[t],v=get_point_near_line_center(b.s,b.e,3,"L"),x=get_point_near_line_center(b.s,b.e,3,"R");for(let e=0;e<rooms2.data.length;e++){var B=rooms2.data[e],k=is_point_inside_polygon(v,B.polygon),B=is_point_inside_polygon(x,B.polygon);if(k||B){r.splice(t,1),t--;break}}}var L;for(let i=0;i<r.length;i++){let t=r[i];t.sConnects=0;for(let e=t.eConnects=0;e<r.length;e++)e!==i&&(L=r[e],get_distance(t.s,L.s)<.6?(t.slink={index:e,end:"S"},t.sConnects++):get_distance(t.s,L.e)<.6&&(t.slink={index:e,end:"E"},t.sConnects++),get_distance(t.e,L.s)<.6?(t.elink={index:e,end:"S"},t.eConnects++):get_distance(t.e,L.e)<.6&&(t.elink={index:e,end:"E"},t.eConnects++))}let E=[];for(let e=0;e<r.length;e++){var t=r[e];LIB.lineLength(t)<=.6||(LIB.lineCenter(t),t.passed||(t=je(t,r))&&E.push(t))}for(let t=0;t<E.length;t++){var W=E[t];for(let e=0;e<walls.db.length;e++){var P=walls.db[e];if(!0!==P.inside_room&&("break"!==P.label&&"init_copy"!==P.label&&is_point_inside_polygon(P.c,W))){E.splice(t,1),t--;break}}}for(let e=0;e<E.length;e++){let i=E[e];if(i){for(let e=0;e<pillars.db.length;e++){var Q=pillars.db[e];if("pillar_air"!==Q.role&&("pillar_water"!==Q.role&&is_point_inside_polygon(Q.center,i)))for(let e=0;e<i.length;e++)are_points_equal(i[e],Q.p1)&&(i[e].pillar=!0),are_points_equal(i[e],Q.p2)&&(i[e].pillar=!0),are_points_equal(i[e],Q.p3)&&(i[e].pillar=!0),are_points_equal(i[e],Q.p4)&&(i[e].pillar=!0)}let t=0;for(let e=0;e<i.length;e++)!0===i[e].pillar&&t++;t===i.length&&(i.remove=!0)}}for(let e=0;e<E.length;e++)!0===E[e].remove&&(E.splice(e,1),e--);for(let t=0;t<E.length;t++){var M=get_polygon_centroid(E[t]);for(let e=0;e<E.length;e++)if(t!==e){var D=get_polygon_centroid(E[e]);if(are_points_equal(M,D)){E.splice(t,1),t--;break}}}for(let e=0;e<E.length;e++)rooms2.data.push(new G({points:E[e],plan:"build"}));for(let t=0;t<rooms2.data.length;t++){let e=rooms2.data[t];e.area<=.1&&(e.erase(),rooms2.data.splice(t,1),t--)}Ae.restore(),rooms2.draw()},remove:function(){rooms2.erase(),rooms2.data=[]}};let G=function(e){this.points=e.points,this.plan=e.plan,e.id?this.id=e.id:this.id=LIB.id(),e.name?this.name=e.name:this.name="none","?"===e.name&&(this.name="none"),e.delimiters?this.delimiters=e.delimiters:this.delimiters=[],e.zones?this.zones=e.zones:this.zones=[],e.floors?this.floors=e.floors:this.floors=[],e.hydroisolation?this.hydroisolation=e.hydroisolation:this.hydroisolation=[],e.ceilings?this.ceilings=e.ceilings:this.ceilings=[],e.ceilingMoldings?this.ceilingMoldings=e.ceilingMoldings:this.ceilingMoldings=[],e.floorMoldings?this.floorMoldings=e.floorMoldings:this.floorMoldings=[],e.in_pillar?this.in_pillar=e.in_pillar:this.in_pillar=!1,e.warm_floors?this.warm_floors=e.warm_floors:this.warm_floors=[],e.decor?this.decor=e.decor:this.decor=[],e.isolation?this.isolation=e.isolation:this.isolation=[],e.plaster?this.plaster=e.plaster:this.plaster=[],e.cap?this.cap=e.cap:this.cap="none",e.cap_type?this.cap_type=e.cap_type:this.cap_type="none",this.cap_center=e.cap_center,e.center?this.center=e.center:this.get_center(),this.id_parent_room=e.id_parent_room,this.height=params.total_height,this.polygon=[],this.border_dimensions=[],this.draw()};function l(e){this.s=e.s,this.e=e.e,this.label=e.label,void 0===e.id&&(this.id=LIB.id()),this.lines=layers.wallsDimensions.group().addClass("BaselineGroup"),this.sizes=layers.wallsDimensions.group().addClass("BaselineGroup")}function Se(e){this.s=e.edge.s,this.e=e.edge.e,this.room_side=e.edge.room_side,void 0===e.id&&(this.id=LIB.id()),this.lines=layers.itemsDimensions.group().addClass("roomDimension_"+e.pid),this.sizes=layers.itemsDimensions.group().addClass("roomDimension_"+e.pid),this.draw()}G.prototype.get_center=function(){this.center=polygon_center(this.points);var e,t={s:{x:this.center.x,y:-5e3},e:{x:this.center.x,y:5e3}};let i;2===(e=Ge(get_line_polygon_intersections({s:{x:-5e3,y:this.center.y},e:{x:5e3,y:this.center.y}},this.points))).length&&(i=get_center(e[0],e[1]));let n;2===(e=Ge(get_line_polygon_intersections(t,this.points))).length&&(n=get_center(e[0],e[1])),i&&n&&(this.center.x=i.x,this.center.y=n.y)},G.prototype.build=function(e){if("demolines"===e){if(in_array(plan,["floor","walls","isolation","plaster"])){var s;this.demolines=[];for(let e=0;e<this.edges.length;e++){var t,i,n=this.edges[e];"L"===n.room_side&&(t=point_near_line_end(n.e,n.s,5,"R"),i=point_near_line_end(n.s,n.e,5,"L"),this.demolines.push({s:t,s0:copy.point(n.s),e:i,e0:copy.point(n.e)})),"R"===n.room_side&&(t=point_near_line_end(n.e,n.s,5,"L"),i=point_near_line_end(n.s,n.e,5,"R"),this.demolines.push({s:t,s0:copy.point(n.s),e:i,e0:copy.point(n.e)}))}for(let n=0;n<this.demolines.length;n++)for(let i=0;i<this.demolines.length;i++)if(i!==n){let e=this.demolines[n],t=this.demolines[i];line_and_line_intersection(e,t)&&(s=line_and_line_intersection(e,t),get_distance(e.s,s)<get_distance(e.e,s)?e.s=s:e.e=s,get_distance(t.s,s)<get_distance(t.e,s)?t.s=s:t.e=s)}for(let e=0;e<this.demolines.length;e++){var o=this.demolines[e].s,l=this.demolines[e].e;this.demolines[e].IMAGE=layers.demolines.line(o.x,o.y,l.x,l.y).attr({stroke:"transparent","stroke-width":2,"stroke-dasharray":"none"}).addClass("r2_"+this.id)}if("floor"===plan){if(this.floorMoldings.length!==this.demolines.length){this.floorMoldings=[];for(let e=0;e<this.demolines.length;e++)this.floorMoldings[e]={exist:!1}}if(0<this.floorMoldings.length)for(let e=0;e<this.floorMoldings.length;e++)!0===this.floorMoldings[e].exist&&(this.floorMoldings[e].height=this.height)}if("walls"===plan){if(this.decor.length!==this.demolines.length){this.decor=[];for(let e=0;e<this.demolines.length;e++)this.decor[e]={exist:!1}}if(0<this.decor.length)for(let e=0;e<this.decor.length;e++)!0===this.decor[e].exist&&(this.decor[e].height=this.height)}if("isolation"===plan){if(this.isolation.length!==this.demolines.length){this.isolation=[];for(let e=0;e<this.demolines.length;e++)this.isolation[e]={exist:!1}}if(0<this.isolation.length)for(let e=0;e<this.isolation.length;e++)!0===this.isolation[e].exist&&(this.isolation[e].height=this.height)}if("plaster"===plan){if(this.plaster.length!==this.demolines.length){this.plaster=[];for(let e=0;e<this.demolines.length;e++)this.plaster[e]={exist:!1}}if(0<this.plaster.length)for(let e=0;e<this.plaster.length;e++)!0===this.plaster[e].exist&&(this.plaster[e].height=this.height)}}if("ceiling"===plan){this.demolines=[];for(let e=0;e<this.edges.length;e++){var r=this.edges[e];this.demolines.push({s:r.s,e:r.e,room_side:r.room_side})}let t=[];for(let e=0;e<this.ceilings.length;e++){var a=this.ceilings[e];if(a.niches)for(let e=0;e<a.niches.length;e++){var h,g,_,d=a.niches[e];!0===d.exist&&d.ps&&d.pe&&(_=get_point_near_line_center(h=d.ps,g=d.pe,d.depth,"L"),d=get_point_near_line_center(h,g,d.depth,"R"),t.push({s:h,e:g,po:_,pi:d}))}}for(let e=0;e<t.length;e++){var p=t[e];for(let t=0;t<this.demolines.length;t++){let e=this.demolines[t];var c=is_point_on_line(p.po,e),A=is_point_on_line(p.pi,e);(c||A)&&(are_lines_collinear(e,p)?(e.s=copy.point(p.s),e.e=copy.point(p.e)):(e.s=copy.point(p.e),e.e=copy.point(p.s)))}}for(let t=0;t<this.demolines.length;t++){let e=this.demolines[t];e.s0=copy.point(e.s),e.e0=copy.point(e.e),"L"===e.room_side&&(e.s=point_near_line_end(e.e0,e.s0,5,"R"),e.e=point_near_line_end(e.s0,e.e0,5,"L")),"R"===e.room_side&&(e.s=point_near_line_end(e.e0,e.s0,5,"L"),e.e=point_near_line_end(e.s0,e.e0,5,"R"))}for(let n=0;n<this.demolines.length;n++)for(let i=0;i<this.demolines.length;i++)if(i!==n){let e=this.demolines[n],t=this.demolines[i];var u;line_and_line_intersection(e,t)&&(u=line_and_line_intersection(e,t),get_distance(e.s,u)<get_distance(e.e,u)?e.s=u:e.e=u,get_distance(t.s,u)<get_distance(t.e,u)?t.s=u:t.e=u)}for(let e=0;e<this.demolines.length;e++){var w=this.demolines[e].s,m=this.demolines[e].e;this.demolines[e].IMAGE=layers.demolines.line(w.x,w.y,m.x,m.y).attr({stroke:"transparent","stroke-width":2,"stroke-dasharray":"none"}).addClass("r2_"+this.id)}if(this.ceilingMoldings.length!==this.demolines.length){this.ceilingMoldings=[];for(let e=0;e<this.demolines.length;e++)this.ceilingMoldings[e]={exist:!1}}}}},G.prototype.get_walls_info=function(){if("build"===plan)for(let e=0;e<this.edges.length;e++){let t=this.edges[e];t.wall_info=[];for(let e=0;e<walls.db.length;e++){var i,n=walls.db[e];"init"!==n.label&&"build"!==n.label||("L"===(i=function(t,i){for(let e=0;e<t.borders.o.length;e++)if(is_point_on_line(get_line_center(t.borders.o[e]),i))return"L";for(let e=0;e<t.borders.i.length;e++)if(is_point_on_line(get_line_center(t.borders.i[e]),i))return"R";return!1}(n,t))&&t.wall_info.push({id:n.id,edge:"L"}),"R"===i&&t.wall_info.push({id:n.id,edge:"R"}))}}},G.prototype.get_corners_info=function(){this.corners=[];for(let n=0;n<this.edges.length;n++){let e,t;t=n===this.edges.length-1?(e=this.edges[this.edges.length-1],this.edges[0]):(e=this.edges[n],this.edges[n+1]);var s=get_point_near_line_center(e.s,e.e,5,"L"),o=get_point_near_line_center(e.s,e.e,5,"R");let i;is_point_inside_polygon(s,this.polygon)&&(i="O"),is_point_inside_polygon(o,this.polygon)&&(i="I");s=get_point_place(t.e,e);"O"===i&&("L"===s&&this.corners.push("R"),"R"===s&&this.corners.push("L")),"I"===i&&("L"===s&&this.corners.push("L"),"R"===s&&this.corners.push("R"))}},G.prototype.calc=function(){for(let e=0;e<this.points.length;e++);this.polygon=this.points.slice();let n="none";"init"!==plan&&"break"!==plan||(n="build"),"build"!==plan&&"B"!==plan_group||(n="init_copy");for(let i=0,e=this.points.length;i<e;i++)for(let e=0,t=walls.db.length;e<t;e++){var s=walls.db[e];s.label!==n&&(are_points_equal(this.points[i],s.s)&&(is_point_inside_polygon(s.l1,this.points)&&this.polygon.push(s.l1),is_point_inside_polygon(s.r1,this.points)&&this.polygon.push(s.r1)),are_points_equal(this.points[i],s.e)&&(is_point_inside_polygon(s.l2,this.points)&&this.polygon.push(s.l2),is_point_inside_polygon(s.r2,this.points)&&this.polygon.push(s.r2)))}this.polygon=Ge(this.polygon),this.polygon=delete_empties(this.polygon),this.edges=[];for(let i=0;i<this.polygon.length;i++){let e=this.polygon[i],t;t=i===this.polygon.length-1?this.polygon[0]:this.polygon[i+1],this.edges[i]={s:e,e:t,parent:"wall"};var o=get_point_near_line_center(e,t,5,"L"),l=get_point_near_line_center(e,t,5,"R");is_point_inside_polygon(o,this.polygon)&&(this.edges[i].room_side="L"),is_point_inside_polygon(l,this.polygon)&&(this.edges[i].room_side="R"),this.edges[i].inside_room=!1}for(let e=0;e<walls.db.length;e++){var r=walls.db[e];if("init_copy"!==r.label&&("break"!==r.label&&!0===r.inside_room&&is_point_inside_polygon(r.c,this.polygon))){let i=[];for(let e=0;e<r.borders.o.length;e++)i.push(r.borders.o[e]);for(let e=0;e<r.borders.i.length;e++)i.push(r.borders.i[e]);for(let e=0;e<r.borders.s.length;e++)i.push(r.borders.s[e]);for(let e=0;e<r.borders.e.length;e++)i.push(r.borders.e[e]);for(let t=0;t<i.length;t++){var a=i[t],h=get_point_near_line_center(a.s,a.e,5,"L"),g=get_point_near_line_center(a.s,a.e,5,"R");let e;is_point_inside_polygon(h,r.polygon)&&(e="R"),is_point_inside_polygon(g,r.polygon)&&(e="L"),this.edges.push({s:a.s,e:a.e,room_side:e,parent:"wall",inside_room:r.inside_room})}}}for(let e=0;e<pillars.db.length;e++){var t=pillars.db[e];if(is_point_inside_polygon(t.center,this.polygon)&&("pillar"===t.role||"gypsum"===t.role))for(let e=0;e<t.borders.length;e++){var i=t.borders[e];this.edges.push({s:i.s,e:i.e,room_side:"L",parent:"pillar",inside_room:t.inside_room})}}for(let e=0;e<2;e++)for(let e=0;e<this.edges.length;e++)LIB.mergeLines(this.edges[e],e,this.edges);if(0===this.zones.length&&(this.zones=[],this.zones[0]={},this.zones[0].id=LIB.id(),this.zones[0].polygon=this.polygon.slice(),this.removeDelimiters("zone")),1<this.zones.length){for(let e=0;e<this.zones.length;e++){var _=this.zones[e];if(!1===_.exist||!1===_.polygon){this.zones=[],this.zones[0]={},this.zones[0].id=LIB.id(),this.zones[0].polygon=this.polygon.slice(),this.removeDelimiters("zone");break}}let t=0;for(let e=0;e<this.delimiters.length;e++)"zone"===this.delimiters[e].type&&t++;this.zones.length!==t+1&&(this.zones=[],this.zones[0]={},this.zones[0].id=LIB.id(),this.zones[0].polygon=this.polygon.slice(),this.removeDelimiters("zone"))}if(0===this.floors.length&&(this.floors[0]={},this.floors[0].exist=!1,this.floors[0].id=LIB.id(),this.floors[0].polygon=this.polygon.slice(),this.removeDelimiters("floor")),1<this.floors.length){for(let e=0;e<this.floors.length;e++){var d=this.floors[e];if(!1===d.exist||!1===d.polygon){this.floors=[],this.floors[0]={},this.floors[0].id=LIB.id(),this.floors[0].polygon=this.polygon.slice(),this.removeDelimiters("floor");break}}let t=0;for(let e=0;e<this.delimiters.length;e++)"floor"===this.delimiters[e].type&&t++;this.floors.length!==t+1&&(this.floors=[],this.floors[0]={},this.floors[0].id=LIB.id(),this.floors[0].polygon=this.polygon.slice(),this.removeDelimiters("floor"))}if(0===this.hydroisolation.length&&(this.hydroisolation[0]={},this.hydroisolation[0].exist=!1,this.hydroisolation[0].id=LIB.id(),this.hydroisolation[0].polygon=this.polygon.slice(),this.removeDelimiters("hydroisolation")),1<this.hydroisolation.length){for(let e=0;e<this.hydroisolation.length;e++){var p=this.hydroisolation[e];if(!1===p.exist||!1===p.polygon){this.hydroisolation=[],this.hydroisolation[0]={},this.hydroisolation[0].id=LIB.id(),this.hydroisolation[0].polygon=this.polygon.slice(),this.removeDelimiters("hydroisolation");break}}let t=0;for(let e=0;e<this.delimiters.length;e++)"hydroisolation"===this.delimiters[e].type&&t++;this.hydroisolation.length!==t+1&&(this.hydroisolation=[],this.hydroisolation[0]={},this.hydroisolation[0].id=LIB.id(),this.hydroisolation[0].polygon=this.polygon.slice(),this.removeDelimiters("hydroisolation"))}if(0===this.ceilings.length&&(this.ceilings[0]={},this.ceilings[0].id=LIB.id(),this.ceilings[0].polygon=this.polygon.slice(),this.removeDelimiters("ceiling")),1<this.ceilings.length){for(let e=0;e<this.ceilings.length;e++){var c=this.ceilings[e];if(!1===c.exist||!1===c.polygon){this.ceilings=[],this.ceilings[0]={},this.ceilings[0].id=LIB.id(),this.ceilings[0].polygon=this.polygon.slice(),this.removeDelimiters("ceiling");break}}let t=0;for(let e=0;e<this.delimiters.length;e++)"ceiling"===this.delimiters[e].type&&t++;this.ceilings.length!==t+1&&(this.ceilings=[],this.ceilings[0]={},this.ceilings[0].id=LIB.id(),this.ceilings[0].polygon=this.polygon.slice(),this.removeDelimiters("ceiling"))}for(let e=0;e<this.zones.length;e++){let i=this.zones[e];if(i.edges=get_polygon_edges(i.polygon),"build"===plan)for(let e=0;e<i.edges.length;e++){let t=i.edges[e];t.wall_info=[];for(let e=0;e<walls.db.length;e++){var A=walls.db[e];"init"!==A.label&&"build"!==A.label||(A=function(t,i){for(let e=0;e<t.borders.o.length;e++){var n=t.borders.o[e],s=is_line_over_line(i,n),n=is_line_over_line(n,i);if(s||n)return{id:t.id,edge:"L"}}for(let e=0;e<t.borders.i.length;e++){var o=t.borders.i[e],l=is_line_over_line(i,o),o=is_line_over_line(o,i);if(l||o)return{id:t.id,edge:"R"}}return!1}(A,t))&&t.wall_info.push(A)}}}for(let t=0;t<this.floors.length;t++){let e=this.floors[t];e.edges=get_polygon_edges(e.polygon),!0!==e.exist||!is_empty(e.cover)&&"ruler"!==e.cover||(e.exist=!1,send_warning_signals(signal_types[4],"Комната "+this.id+". Ошибка напольного покрытия: ",e.cover,1))}for(let e=0;e<this.ceilings.length;e++){let t=this.ceilings[e];if(t.edges=get_polygon_edges(t.polygon),!t.niches||t.niches&&0===t.niches.length){t.niches=[];for(let e=0;e<t.edges.length;e++)t.niches[e]={exist:!1,id:LIB.id()}}if(t.niches)for(let e=0;e<t.niches.length;e++)null===t.niches[e]&&(t.niches[e]={exist:!1,id:LIB.id()})}let u=0;for(let e=0;e<this.edges.length;e++)u+=LIB.lineLength(this.edges[e]);this.perimeter=parseFloat((u/100).toFixed(2));let w=u;for(let e=0;e<doors.db.length;e++){var m=doors.db[e];if(m.s&&m.e){var f=get_point_near_line_center(m.s,m.e,m.depth/2+5,"L"),I=get_point_near_line_center(m.s,m.e,m.depth/2+5,"R");let e=0;is_point_inside_polygon(f,this.points)&&(e=get_distance(m.l1,m.l2)),is_point_inside_polygon(I,this.points)&&(e=get_distance(m.r1,m.r2)),w-=e}}if(this.perimeter_walls=parseFloat((w/100).toFixed(2)),this.area=R(polygon_area(this.polygon)/1e4,1),"init"===plan||"break"===plan)for(let e=0;e<pillars.db.length;e++){var C=pillars.db[e];"floor"!==C.anchor||"pillar"!==C.role&&"pillar_air"!==C.role||is_point_inside_polygon(C.center,this.polygon)&&(this.area-=C.area)}if("build"===plan||"B"===plan_group)for(let e=0;e<pillars.db.length;e++){var y=pillars.db[e];"floor"!==y.anchor||"pillar"!==y.role&&"pillar_air"!==y.role&&"gypsum"!==y.role||is_point_inside_polygon(y.center,this.polygon)&&(this.area-=y.area)}this.area=R(this.area,1),this.build("demolines")},G.prototype.draw=function(){let t=this;if(this.demolines)for(let e=0;e<this.demolines.length;e++)this.demolines[e].IMAGE&&this.demolines[e].IMAGE.attr({stroke:"transparent"});this.erase(),this.calc(),background_image_loaded?this.filling="transparent":this.filling="#ffffff",layers.rooms.polygon(this.polygon).attr({fill:this.filling}).on("mousedown",function(e){in_array(tool,["ruler","moving"])||(Q(),id.room=t.id,delete_empty_comment(),1===e.which&&newHide(),3===e.which&&oldHide())}).addClass("r2_"+this.id),this.draw_("zones"),this.draw_("warm_floors"),this.draw_("border_dimensions"),this.draw_("floors"),this.draw_("hydroisolation"),this.draw_("ceilings"),this.draw_("decor"),this.draw_("isolation"),this.draw_("plaster"),this.draw_("cap"),this.draw_("delimiters"),this.get_corners_info();for(let t=0;t<items.db.length;t++){let e=items.db[t];e.get("parentRoom")}},G.prototype.draw_=function(e,t={}){if("delimiters"===e){if("build"===plan||"rooms"===plan)for(let t=0;t<this.delimiters.length;t++){let e=this.delimiters[t];"zone"===e.type&&(e.id||(e.id=LIB.id()),e.id_room=this.id,new Re(e).addClass("r2_"+this.id))}if("floor"===plan)for(let t=0;t<this.delimiters.length;t++){let e=this.delimiters[t];"floor"===e.type&&(e.id||(e.id=LIB.id()),e.id_room=this.id,new Re(e).addClass("r2_"+this.id))}if("hydroisolation"===plan)for(let t=0;t<this.delimiters.length;t++){let e=this.delimiters[t];"hydroisolation"===e.type&&(e.id||(e.id=LIB.id()),e.id_room=this.id,new Re(e).addClass("r2_"+this.id))}if("ceiling"===plan)for(let t=0;t<this.delimiters.length;t++){let e=this.delimiters[t];"ceiling"===e.type&&(e.id||(e.id=LIB.id()),e.id_room=this.id,new Re(e).addClass("r2_"+this.id))}}else if("zones"===e){let i=this;for(let e=0;e<this.zones.length;e++){let t=this.zones[e];if(t.polygon){t.id=LIB.id(),t.id_room=this.id,t.area=R(polygon_area(t.polygon)/1e4,1),t.height=this.height,2<t.polygon.length&&(t.center||(t.center=get_polygon_centroid(t.polygon))),t.name||(t.name="none");for(let e=0;e<walls.db.length;e++){var n=walls.db[e];!1!==n.inside_room&&"init_copy"!==n.label&&"break"!==n.label&&is_point_inside_polygon(n.c,t.polygon)&&(n=get_polygon_area(n.polygon),t.area-=n)}for(let e=0;e<pillars.db.length;e++){var s=pillars.db[e];"pillar_water"!==s.role&&is_point_inside_polygon(s.center,t.polygon)&&(t.area-=s.area)}t.area=R(t.area,1),"build"===plan&&t.polygon&&.5<t.area&&svg.text(function(e){e.tspan(t.area.toString()+" м").font({size:12,stroke:"#dc143c","stroke-width":.1,fill:"#dc143c"}),e.tspan("2").font({size:7,stroke:"#dc143c","stroke-width":.1,fill:"#dc143c"}).dy(-4)}).draggable().on("dragstart",function(){$("body").css("cursor","move"),this.center_before={x:this.cx(),y:this.cy()}}).on("dragend",function(){$("body").css("cursor","default"),this.center_after={x:this.cx(),y:this.cy()},is_point_inside_polygon(this.center_after,t.polygon)?t.center=this.center_after:t.center=this.center_before,i.draw()}).cx(t.center.x).cy(t.center.y).addClass("r2_"+this.id),"rooms"===plan&&t.polygon&&.5<t.area&&new ZoneLabel(t).addClass("r2_"+this.id)}}}else if("border_dimensions"===e)if(t&&!1===t.remove)for(let t=0;t<this.border_dimensions.length;t++){let e=this.border_dimensions[t];e.draw("color")}else{let t=SVG.select(".roomDimension_"+this.id);for(let e=0;e<t.members.length;e++)t.members[e].remove();if(this.border_dimensions=[],"B"===plan_group)for(let e=0;e<this.edges.length;e++){var i=this.edges[e];this.border_dimensions.push(new Se({pid:this.id,edge:i}))}}else if("floors"===e){if("floor"===plan){for(let t=0;t<this.floors.length;t++){let e=this.floors[t];if(e.polygon&&(e.area=get_polygon_area(e.polygon),e.id||(e.id=LIB.id()),e.exist)){var o=e.cover;let t=tools[o],i=t.stroke_width;e.filling=layers.floors.pattern(t.width,t.height,function(e){e.rect(t.width,t.height).attr({fill:"#ffffff"}),e.path(t.path).attr({"stroke-width":i,stroke:"#000000"})}).rotate(e.angle).addClass("r2_"+this.id),new Floor({id:e.id,pid:this.id,polygon:e.polygon,filling:e.filling,strokeWidth:i}).addClass("r2_"+this.id)}}for(let e=0;e<this.floorMoldings.length;e++){var l=this.floorMoldings[e];!0===l.exist&&this.demolines[e].IMAGE.attr({stroke:l.color})}}}else if("warm_floors"===e){if("warm_floor"===plan)for(let g=0;g<this.warm_floors.length;g++){let h=this.warm_floors[g];if(is_point_exists(h.s)&&is_point_exists(h.e)){let i=this,o=layers.warm_floors.group().on("mouseover",function(e){"warm_floor"===plan&&"eraser"===tool&&(customCursor.overObject=!0)}).on("mouseleave",function(e){"warm_floor"===plan&&"eraser"===tool&&(customCursor.overObject=!1)}).on("mousedown",function(e){"warm_floor"===plan&&"eraser"===tool&&(index.room=objectIndexById(rooms2.data,i.id),index.warm_floor=g,customCursor.fire("eraserReaction",e),$('#warm_floor_contextmenu [action="delete"]').trigger("click"))}).on("contextmenu",function(e){index.room=objectIndexById(rooms2.data,i.id),index.warm_floor=g;var t=i.warm_floors[g],t=get_screen_point({x:(t.s.x+t.s2.x)/2,y:(t.s.y+t.e2.y)/2});$(".contextmenu").hide(),showContextmenu("#warm_floor_contextmenu",t.x,t.y,128),cabling_warm_floor.temporary_line.hide()}).on("dblclick",function(e){index.room=objectIndexById(rooms2.data,i.id),index.warm_floor=g;var t=i.warm_floors[g],t=get_screen_point({x:(t.s.x+t.s2.x)/2,y:(t.s.y+t.e2.y)/2});$(".contextmenu").hide(),showContextmenu("#warm_floor_contextmenu",t.x,t.y,128),cabling_warm_floor.temporary_line.hide()}).on("mouseup",function(e){"warm_floor"===tool&&null!==S.warm_floor&&xe()}).addClass("r2_"+this.id);"warm_floor"===h&&(null!==index.room&&(rooms2.data[index.room],index.warm_floor),console.warn(index.room,index.warm_floor),null!==index.room&&(rooms2.data[index.room],index.room));var _=get_vertical(h.s),d=get_horizontal(h.s),p=get_vertical(h.e),c=get_horizontal(h.e);h.s2=line_and_line_intersection(d,p),h.e2=line_and_line_intersection(_,c),h.polygon=[h.s,h.s2,h.e,h.e2],o.polygon(h.polygon).attr({stroke:"#dc143c","stroke-width":1,fill:hatch.crimson_2});let l={},r={};if(h.width=get_distance(h.s,h.s2),h.height=get_distance(h.s,h.e2),30<h.width&&30<h.height){h.e.x<h.s.x&&h.e.y<h.s.y&&(l.start=h.s2,l.end=h.s,l.place="L",r.start=h.s2,r.end=h.e,r.place="R"),h.e.x>h.s.x&&h.e.y<h.s.y&&(l.start=h.s,l.end=h.s2,l.place="L",r.start=h.s,r.end=h.e2,r.place="R"),h.e.x<h.s.x&&h.e.y>h.s.y&&(l.start=h.e,l.end=h.e2,l.place="L",r.start=h.e,r.end=h.s2,r.place="R"),h.e.x>h.s.x&&h.e.y>h.s.y&&(l.start=h.e2,l.end=h.e,l.place="L",r.start=h.s,r.end=h.e2,r.place="L");let e,t,i,n,s;d={stroke:"#000000","stroke-width":.5};e=point_near_line_end(l.end,l.start,9,"R"),t=point_near_line_end(l.start,l.end,9,"L"),i=get_center(e,t),n=LIB.pointOnLine(e,i,-10),s=LIB.pointOnLine(t,i,-10),o.line(e.x,e.y,n.x,n.y).attr(d),o.line(e.x,e.y-3,e.x,e.y+3).attr(d).rotate(45),o.line(t.x,t.y,s.x,s.y).attr(d),o.line(t.x,t.y-3,t.x,t.y+3).attr(d).rotate(45),o.plain(h.width.toFixed()).font({size:9,fill:"#000000"}).cx(i.x).cy(i.y),"L"===r.place&&(e=point_near_line_end(r.end,r.start,9,"R"),t=point_near_line_end(r.start,r.end,9,"L")),"R"===r.place&&(e=point_near_line_end(r.end,r.start,9,"L"),t=point_near_line_end(r.start,r.end,9,"R")),i=get_center(e,t),n=LIB.pointOnLine(e,i,-10),s=LIB.pointOnLine(t,i,-10),o.line(e.x,e.y,n.x,n.y).attr(d),o.line(e.x,e.y-3,e.x,e.y+3).attr(d).rotate(45),o.line(t.x,t.y,s.x,s.y).attr(d),o.line(t.x,t.y-3,t.x,t.y+3).attr(d).rotate(45),o.plain(h.height.toFixed()).font({size:9,fill:"#000000"}).cx(i.x).cy(i.y)}let t,n,s,a;if(15<h.width&&15<h.height){h.e.x<h.s.x&&h.e.y<h.s.y&&(t={s:h.e,e:{x:h.e.x,y:-1e6}},n={s:h.e,e:{x:-1e6,y:h.e.y}},s={s:h.s,e:{x:h.s.x,y:1e6}},a={s:h.s,e:{x:1e6,y:h.s.y}}),h.e.x>h.s.x&&h.e.y<h.s.y&&(t={s:h.e2,e:{x:h.e2.x,y:-1e6}},n={s:h.e2,e:{x:-1e6,y:h.e2.y}},s={s:h.s2,e:{x:h.s2.x,y:1e6}},a={s:h.s2,e:{x:1e6,y:h.s2.y}}),h.e.x<h.s.x&&h.e.y>h.s.y&&(t={s:h.s2,e:{x:h.s2.x,y:-1e6}},n={s:h.s2,e:{x:-1e6,y:h.s2.y}},s={s:h.e2,e:{x:h.e2.x,y:1e6}},a={s:h.e2,e:{x:1e6,y:h.e2.y}}),h.e.x>h.s.x&&h.e.y>h.s.y&&(t={s:h.s,e:{x:h.s.x,y:-1e6}},n={s:h.s,e:{x:-1e6,y:h.s.y}},s={s:h.e,e:{x:h.e.x,y:1e6}},a={s:h.e,e:{x:1e6,y:h.e.y}});for(let e=0;e<this.edges.length;e++){var A=this.edges[e],u=line_and_line_intersection(t,A),w=line_and_line_intersection(n,A),m=line_and_line_intersection(a,A),A=line_and_line_intersection(s,A);u&&(t.e=u),w&&(n.e=w),m&&(a.e=m),A&&(s.e=A)}p=LIB.lineLength(t)+LIB.lineLength(n),_=LIB.lineLength(s)+LIB.lineLength(a);p<_&&(15<LIB.lineLength(t)&&o.add(new DimensionSimple({s:t.s,e:t.e,style:"clear",center:!1})),15<LIB.lineLength(n)&&o.add(new DimensionSimple({s:n.s,e:n.e,style:"clear",center:!1}))),_<p&&(o.add(new DimensionSimple({s:s.s,e:s.e,style:"clear",center:!1})),o.add(new DimensionSimple({s:a.s,e:a.e,style:"clear",center:!1}))),polygon_center(h.polygon),(polygon_area(h.polygon)/1e4).toFixed(2)}}else cabling_warm_floor.delete_lines(get_warm_floor(h.id)),this.warm_floors.splice(g,1),g--}}else if("ceilings"===e){if("ceiling"===plan||"light"===plan){let i=!1;"light"===plan&&(i=!0);for(let e=0;e<this.ceilings.length;e++){let o=this.ceilings[e];if(o.polygon&&(o.edges=get_polygon_edges(o.polygon),o.center=get_polygon_centroid(o.polygon),o.area=get_polygon_area(o.polygon),o.id||(o.id=LIB.id()),o.exist)){for(let t=o.area_niches=0;t<o.edges.length;t++){var r=o.edges[t],a=get_point_near_line_center(r.s,r.e,10,"L"),h=get_point_near_line_center(r.s,r.e,10,"R");if(o.niches){let e=o.niches[t];e&&!0===e.exist&&(e.hasOwnProperty("depth")||(e.depth=defs.ceiling_niche.depth),is_point_inside_polygon(a,o.polygon)&&(e.ps=point_near_line_end(r.e,r.s,e.depth,"R"),e.pe=point_near_line_end(r.s,r.e,e.depth,"L"),e.pc=get_center(e.ps,e.pe),e.width=get_distance(e.ps,e.pe)),is_point_inside_polygon(h,o.polygon)&&(e.ps=point_near_line_end(r.e,r.s,e.depth,"L"),e.pe=point_near_line_end(r.s,r.e,e.depth,"R"),e.pc=get_center(e.ps,e.pe),e.width=get_distance(e.ps,e.pe)))}}if(o.niches){for(let n=0;n<o.niches.length;n++){let i=o.niches[n];if(i&&!0===i.exist)if(i.ps_free_end=!0,i.pe_free_end=!0,i.ps&&i.pe){var g=LIB.pointOnLine(i.pe,i.ps,100),f=LIB.pointOnLine(i.ps,i.pe,100),g={s:i.pc,e:g},f={s:i.pc,e:f};let e,t;t=0===n?(e=o.niches.length-1,1):n===o.niches.length-1?(e=o.niches.length-2,0):(e=n-1,n+1);var I,C=o.niches[e],y=o.niches[t];C&&y&&(!0===C.exist&&((I=line_and_line_intersection(g,C=get_big_line({s:C.ps,e:C.pe})))&&(i.ps=copy.point(I),i.ps_free_end=!1),(I=line_and_line_intersection(f,C))&&(i.pe=copy.point(I),i.pe_free_end=!1)),!0===y.exist&&((I=line_and_line_intersection(g,C=get_big_line({s:y.ps,e:y.pe})))&&(i.ps=copy.point(I),i.ps_free_end=!1),(g=line_and_line_intersection(f,C))&&(i.pe=copy.point(g),i.pe_free_end=!1)))}else o.niches.splice(n,1),n--}for(let t=0;t<o.niches.length;t++){let e=o.niches[t];var b,v;e&&!0===e.exist&&(v=[(b=o.edges[t]).s,b.e,e.pe,e.ps],e.area=get_polygon_area(v),o.area_niches+=e.area,new CeilingNiche({p1:b.s,p2:b.e,p3:e.pe,p4:e.ps,depth:e.depth,index:t,id_room:this.id,id_ceiling:o.id,id_niche:e.id,color:"#fffd74",ps_free_end:e.ps_free_end,pe_free_end:e.pe_free_end},i).addClass("r2_"+this.id),!1===e.temp&&!1===e.comment_exist&&(comments.db.push(new Comment({s:get_center(e.ps,e.pe),text:e.comment,label:"niche",id_item:e.id,plan:plan})),e.comment_exist=!0))}o.area-=o.area_niches}let s=[];if(o.niches)for(let e=0;e<o.edges.length;e++){var x,B,k=o.niches[e];k&&(!0===k.exist&&(B=o.niches[e],x=LIB.pointOnLine(B.pe,B.ps,5),B=LIB.pointOnLine(B.ps,B.pe,5),s[e]=get_line(x,B)),!1===k.exist&&(x=o.edges[e],B=LIB.pointOnLine(x.e,x.s,5),k=LIB.pointOnLine(x.s,x.e,5),s[e]=get_line(B,k)))}for(let n=0;n<s.length;n++){let e,t,i=(t=0===n?(e=s.length-1,1):n===s.length-1?(e=s.length-2,0):(e=n-1,n+1),s[n]);var L=s[e],E=s[t];i&&L&&E&&((L=line_and_line_intersection(i,L))&&(i.s=copy.point(L)),(L=line_and_line_intersection(i,E))&&(i.e=copy.point(L)))}for(let e=o.perimeter=0;e<s.length;e++)s[e]&&(o.perimeter+=LIB.lineLength(s[e]));if(o.perimeter=parseFloat((o.perimeter/=100).toFixed(2)),"ceiling"===plan&&!1===o.complex&&(o.hasOwnProperty("level")||(o.level=7.5,"paint_ceiling"===o.material&&(o.level=0),"whitewash_ceiling"===o.material&&(o.level=0)),new Ceiling(this,o,"ceiling").addClass("r2_"+this.id)),!0===o.complex){o.hasOwnProperty("level2")||(o.level=15,o.level2=7.5,o.material="gypsum_ceiling",o.material2="stretch_ceiling",o.type="closed");var W=new ComplexCeiling(this,o,i).addClass("r2_"+this.id);if(!LIB.isObjectEmpty(W)){o.polygon2=[];for(let e=0;e<o.edges2.length;e++){var P=o.edges2[e];o.polygon2.push(P.s),o.polygon2.push(P.e)}o.area2=get_polygon_area(o.polygon2),o.area-=o.area2,o.area=parseFloat(o.area.toFixed(2));for(let e=o.perimeter2=0;e<o.edges2.length;e++){var Q=o.edges2[e];o.perimeter2+=LIB.lineLength(Q)}o.perimeter2=parseFloat((o.perimeter2/=100).toFixed(2))}}}}if(this.build("demolines"),this.demolines)for(let e=0;e<this.ceilingMoldings.length;e++){var M=this.ceilingMoldings[e];!0===M.exist&&this.demolines[e]&&this.demolines[e].IMAGE&&this.demolines[e].IMAGE.attr({stroke:M.stroke}),!1===M.exist&&this.demolines[e]&&this.demolines[e].IMAGE&&this.demolines[e].IMAGE.attr({stroke:"transparent"})}}}else if("niches"!==e)if("isolation"===e){if("isolation"===plan)for(let e=0;e<this.isolation.length;e++){var D=this.isolation[e];!0===D.exist&&this.demolines[e].IMAGE.attr({stroke:D.color})}}else if("hydroisolation"===e){if("hydroisolation"===plan){let n=this;for(let e=0;e<this.hydroisolation.length;e++){let i=this.hydroisolation[e];if(i.polygon&&(i.id||(i.id=LIB.id()),i.exist)){var j=i.cover;let t=tools[j];i.filling=layers.floors.pattern(t.width,t.height,function(e){e.rect(t.width,t.height).attr({fill:"#ffffff"}),e.path(t.path).attr({"stroke-width":t.stroke_width,stroke:t.stroke_color})}).addClass("r2_"+this.id);layers.floors.polygon(i.polygon).fill(i.filling).on("mouseover",function(e){"hydroisolation"===plan&&tool!==i.cover&&(customCursor.overObject=!0)}).on("mouseleave",function(e){"hydroisolation"===plan&&(customCursor.overObject=!1)}).on("mousedown",function(e){"hydroisolation"===plan&&$(".contextmenu").hide()}).on("contextmenu",function(e){id.room=n.id,id.roomHydroisolation=i.id,$(".contextmenu").hide(),showContextmenu("#hydroisolation_contextmenu",e.clientX,e.clientY,canvas.position().top)}).on("dblclick",function(e){id.room=n.id,id.roomHydroisolation=i.id,$(".contextmenu").hide(),showContextmenu("#hydroisolation_contextmenu",e.clientX,e.clientY,canvas.position().top)}).addClass("r2_"+this.id)}}}}else if("plaster"===e){if("plaster"===plan)for(let e=0;e<this.plaster.length;e++){var O=this.plaster[e];!0===O.exist&&this.demolines[e].IMAGE.attr({stroke:O.color})}}else if("decor"===e){if("walls"===plan)for(let e=0;e<this.decor.length;e++)this.decor[e].exist&&this.demolines[e].IMAGE.attr({stroke:this.decor[e].color})}else"cap"===e&&"floor_cap"===plan&&this.cap&&.5<this.area&&(this.cap_center||(this.cap_center=this.center),new RoomCap(this).addClass("r2_"+this.id))},G.prototype.removeDelimiter=function(t){let i;for(let e=0;e<this.delimiters.length;e++)this.delimiters[e].id===t&&(i=this.delimiters[e]);let o,l=("zone"===i.type&&(o=this.zones),"floor"===i.type&&(o=this.floors),"hydroisolation"===i.type&&(o=this.hydroisolation),"ceiling"===i.type&&(o=this.ceilings),[]),r=[];var a,h,g,n=get_point_near_line_center(i.s,i.e,1,"L"),s=get_point_near_line_center(i.s,i.e,1,"R"),_=get_point_near_line_center(i.s,i.e,3,"L"),d=get_point_near_line_center(i.s,i.e,3,"R"),p=get_point_near_line_center(i.s,i.e,5,"R"),c=get_point_near_line_center(i.s,i.e,5,"L");for(let e=0;e<o.length;e++){var A,u,w,m,f,I,C=o[e];C.polygon&&(A=is_point_inside_polygon(n,C.polygon),u=is_point_inside_polygon(s,C.polygon),w=is_point_inside_polygon(_,C.polygon),m=is_point_inside_polygon(d,C.polygon),f=is_point_inside_polygon(c,C.polygon),I=is_point_inside_polygon(p,C.polygon),(A||u||w||m||f||I)&&(l.push(C),r.push(e)))}console.warn(l);try{if(1===l.length){var y=i.type;"zone"===y&&(this.zones=[]),"floor"===y&&(this.floors=[]),"hydroisolation"===y&&(this.hydroisolation=[]),"ceiling"===y&&(this.ceilings=[]);for(let e=0;e<this.delimiters.length;e++)this.delimiters[e].type===y&&(this.delimiters.splice(e,1),e--);return warning.show("red",l10n.zone_error_try_again),void this.draw()}if(2===l.length){let i=l[0],n=l[1];for(let t=0;t<comments.db.length;t++){let e=comments.db[t];"niche"===e.label&&(a=is_point_inside_polygon(e.s,i.polygon),h=is_point_inside_polygon(e.s,n.polygon),(a||h)&&(e.delete(),t--))}function e(n,s){for(let i=0;i<n.polygon.length;i++){let e,t;t=i===n.polygon.length-1?(e=n.polygon[i],n.polygon[0]):(e=n.polygon[i],n.polygon[i+1]);var o=get_line(e,t);for(let e=0;e<s.polygon.length;e++){var l=s.polygon[e];is_point_between_line_points(l,o)&&(n.polygon.splice(i+1,0,copy.point(l)),i++)}}}function b(t,i){for(let e=0;e<t.edges.length;e++){var n=t.edges[e],s=get_point_near_line_center(n.s,n.e,3,"L"),n=get_point_near_line_center(n.s,n.e,3,"R"),s=is_point_inside_polygon(s,i.polygon),n=is_point_inside_polygon(n,i.polygon);(s||n)&&(t.edges.splice(e,1),e--)}}e(i,n),e(n,i),i.edges=get_polygon_edges(i.polygon),n.edges=get_polygon_edges(n.polygon),b(i,n),b(n,i);let s=[];for(let e=0;e<l.length;e++){var v=l[e];for(let e=0;e<v.edges.length;e++)s.push(v.edges[e])}for(let e=0;e<s.length;e++)LIB.lineLength(s[e])<1&&(s.splice(e,1),e--);for(let i=0;i<s.length;i++){let t=s[i];for(let e=0;e<s.length;e++)e!==i&&(g=s[e],get_distance(t.s,g.s)<1?t.slink={index:e,end:"S"}:get_distance(t.s,g.e)<1&&(t.slink={index:e,end:"E"}),get_distance(t.e,g.s)<1?t.elink={index:e,end:"S"}:get_distance(t.e,g.e)<1&&(t.elink={index:e,end:"E"}))}var x=function(e,t){let i=[],n=!0;var s=copy.point(e.s);let o="E",l=0,r=!1;for(;"E"===o?e&&e.elink?(i.push(e.e),e.passed=!0,"S"===e.elink.end?o="E":"E"===e.elink.end&&(o="S"),e=t[e.elink.index]):r=!0:"S"===o&&(e&&e.slink?(i.push(e.s),e.passed=!0,"S"===e.slink.end?o="E":"E"===e.slink.end&&(o="S"),e=t[e.slink.index]):r=!0),1<i.length&&are_points_equal(s,i[i.length-1])&&(e.passed=!0,n=!1),l++,!0===n&&l<t.length;);return!r&&i}(s[0],s),x=LIB.simplifyPolygon(x);r.sort(),o.splice(r[1],1),o.splice(r[0],1),o.push({polygon:x})}}catch(e){console.warn(e.name,e.message);var B=i.type;"zone"===B&&(this.zones=[]),"floor"===B&&(this.floors=[]),"hydroisolation"===B&&(this.hydroisolation=[]),"ceiling"===B&&(this.ceilings=[]);for(let e=0;e<this.delimiters.length;e++)this.delimiters[e].type===B&&(this.delimiters.splice(e,1),e--);return warning.show("red",l10n.zone_error_try_again),void this.draw()}let k=null;for(let e=0;e<this.delimiters.length;e++)if(this.delimiters[e].id===i.id){k=e;break}let L=images.delimiters["delimiter_"+i.id],E=(L&&L.remove(),this.delimiters.splice(k,1),console.warn("after",this.delimiters),0);for(let e=0;e<this.delimiters.length;e++)"floor"===this.delimiters[e].type&&E++;0===E&&(this.floors=[],this.floors[0]={},this.floors[0].exist=!1,this.floors[0].id=LIB.id(),this.floors[0].polygon=this.polygon.slice()),this.draw()},G.prototype.removeDelimiters=function(e){for(let t=0;t<this.delimiters.length;t++){var i=this.delimiters[t];if(i.type===e){let e=images.delimiters["delimiter_"+i.id];e&&e.remove(),this.delimiters.splice(t,1),t--}}},G.prototype.removeFloorMoldings=function(){for(let e=0;e<this.floorMoldings.length;e++)if(!0===this.floorMoldings[e].exist){for(let e=0;e<this.floorMoldings.length;e++)this.floorMoldings[e]={exist:!1},this.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"});break}},G.prototype.erase=function(){let t=SVG.select(".r2_"+this.id);for(let e=0;e<t.members.length;e++)"g"===t.members[e].type&&t.members[e].clear(),t.members[e].remove();if(this.demolines)for(let e=0;e<this.demolines.length;e++)this.demolines[e].IMAGE&&this.demolines[e].IMAGE.remove();if(0<this.border_dimensions.length)for(let e=0;e<this.border_dimensions.length;e++)this.border_dimensions[e].erase()},G.prototype.delete=function(){this.erase(),this.border_dimensions=[];for(let e=0;e<this.warm_floors.length;e++)cabling_warm_floor.delete_lines(get_warm_floor(this.warm_floors[e].id));var e=objectIndexById(rooms2.data,this.id);void 0!==e&&rooms2.data.splice(e,1)},G.prototype.resetSurfaceColoring=function(){if("floor"===plan)for(let e=0;e<this.floorMoldings.length;e++){var t=this.floorMoldings[e];!0===t.exist?this.demolines[e].IMAGE.attr({stroke:t.color,"stroke-dasharray":"none"}):this.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}if("walls"===plan)for(let e=0;e<this.decor.length;e++){var i=this.decor[e];!0===i.exist?this.demolines[e].IMAGE.attr({stroke:i.color,"stroke-dasharray":"none"}):this.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}if("isolation"===plan)for(let e=0;e<this.isolation.length;e++){var n=this.isolation[e];!0===n.exist?this.demolines[e].IMAGE.attr({stroke:n.color,"stroke-dasharray":"none"}):this.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}if("plaster"===plan)for(let e=0;e<this.plaster.length;e++){var s=this.plaster[e];!0===s.exist?this.demolines[e].IMAGE.attr({stroke:s.color,"stroke-dasharray":"none"}):this.demolines[e].IMAGE.attr({stroke:"transparent","stroke-dasharray":"none"})}},window.baselines={db:[],create:function(e){let t=SVG.select(".BaselineGroup");for(let e=0;e<t.members.length;e++)t.members[e].clear(),t.members[e].remove();if(baselines.db=[],walls.calc(),"init"===plan){for(let e=0;e<walls.db.length;e++){var i=walls.db[e];"init_copy"===i.label||"init"===plan&&"build"===i.label||"build"===plan&&"break"===i.label||(baselines.db.push(new l({s:i.EdgeO.s,e:i.EdgeO.e,label:"L"})),baselines.db.push(new l({s:i.EdgeI.s,e:i.EdgeI.e,label:"R"})))}for(let e=0;e<pillars.db.length;e++){var n=pillars.db[e];"gypsum"===n.role&&baselines.db.push(new l({s:n.p3,e:n.p4,label:"L"}))}for(let e=0;e<3;e++)for(let e=0;e<baselines.db.length;e++)LIB.mergeLines(baselines.db[e],e,baselines.db)}else{for(let e=0;e<walls.db.length;e++){var s=walls.db[e];"init_copy"===s.label||"init"===plan&&"build"===s.label||"build"===plan&&"break"===s.label||(baselines.db.push(new l({s:s.EdgeO.s,e:s.EdgeO.e,label:"L"})),baselines.db.push(new l({s:s.EdgeI.s,e:s.EdgeI.e,label:"R"})))}for(let e=0;e<pillars.db.length;e++){var o=pillars.db[e];"gypsum"===o.role&&baselines.db.push(new l({s:o.p3,e:o.p4,label:"L"}))}for(let e=0;e<3;e++)for(let e=0;e<baselines.db.length;e++)LIB.mergeLines(baselines.db[e],e,baselines.db)}},copy:function(){let t=[];for(let e=0;e<baselines.db.length;e++)t[e]={s:baselines.db[e].s,e:baselines.db[e].e,label:baselines.db[e].e,id:baselines.db[e].id};return t},erase:function(){for(let e=0;e<baselines.db.length;e++)baselines.db[e].erase()},delete:function(){baselines.erase(),baselines.db=[]}},l.prototype.draw=function(e){this.s=LIB.fixPoint(this.s),this.e=LIB.fixPoint(this.e);this.erase();var i,n={s:this.s,e:this.e};let s=[this.s,this.e];for(let t=0;t<items.db.length;t++){let e=items.db[t];"furniture"!==e.model.group&&"wall"===e.model.anchor&&e.model.plan.hasOwnProperty(plan)&&is_point_on_line(i=e.props.projection,n)&&s.push(i)}if(cursors.own.visible&&cursors.own.projection&&"none"!==tool&&"furniture"!==cursors.own.settings.group&&is_point_on_line(cursors.own.projection,n)&&s.push(cursors.own.projection),2<s.length){sort_points_by_distance(this.s,s);for(let e=0;e<s.length-1;e++){var t=new We(s[e],s[e+1],this.label,"#ffffff",20);this.lines.add(t.lines),this.sizes.add(t.size)}}},l.prototype.erase=function(){console.warn("try erase"),this.lines.clear(),this.sizes.clear()},Se.prototype.draw=function(e){this.erase(),this.s=LIB.fixPoint(this.s),this.e=LIB.fixPoint(this.e);var i,t,n={s:this.s,e:this.e};let s=[this.s,this.e];for(let t=0;t<items.db.length;t++){let e=items.db[t];"furniture"!==e.model.group&&"wall"===e.model.anchor&&e.model.plan.hasOwnProperty(plan)&&(i=e.props.projection)&&is_point_on_line(i,n)&&s.push(i),"waterspot_drainage"===e.props.name&&e.model.need_show_baseline&&"free"===e.model.anchor&&e.model.plan.hasOwnProperty(plan)&&e.props.projection&&is_point_on_line(e.props.projection,n)&&s.push(e.props.projection)}if(cursors.own.visible&&cursors.own.projection&&"none"!==tool&&"furniture"!==cursors.own.settings.group&&is_point_on_line(cursors.own.projection,n)&&s.push(cursors.own.projection),2<s.length){sort_points_by_distance(this.s,s);for(let e=0;e<s.length-1;e++)this.room_side&&(t=new We(s[e],s[e+1],this.room_side,"#ffffff",20),this.lines.add(t.lines),this.sizes.add(t.size))}},Se.prototype.erase=function(){this.lines.clear(),this.sizes.clear()};function Ne(e,t,i,n){n=n||6;var s={stroke:"#000000","stroke-width":.4};let o=svg.group(),l=get_distance(e,t).toFixed(0),r,a;"L"===i&&(r=point_near_line_end(t,e,n,"R"),a=point_near_line_end(e,t,n,"L")),"center"===i&&(r=e,a=t),"R"===i&&(r=point_near_line_end(t,e,n,"L"),a=point_near_line_end(e,t,n,"R"));var i=get_center(r,a),e=point_near_line_end(a,r,3,"R"),t=point_near_line_end(a,r,3,"L"),n=point_near_line_end(r,a,3,"L"),h=point_near_line_end(r,a,3,"R");return o.line(r.x,r.y,a.x,a.y).attr(s),o.line(e.x,e.y,t.x,t.y).attr(s),o.line(n.x,n.y,h.x,h.y).attr(s),o.line(e.x,e.y,t.x,t.y).attr(s).rotate(45),o.line(n.x,n.y,h.x,h.y).attr(s).rotate(45),o.rect(16,8).radius(2).attr({stroke:"none","stroke-width":0,fill:"#fafafa",opacity:.75}).cx(i.x).cy(i.y),o.plain(l.toString()).font({family:"Arial",size:8,stroke:"#000000","stroke-width":.4,fill:"#000000"}).cx(i.x).cy(i.y),o}function m(e,t=!1){var i=e.s,n=e.e,e=e.is_item?get_center(i,n):LIB.pointOnLine(n,i,-32);let s=t?"1/2":Math.round(get_distance(i,n)),o=svg.group();return o.add(svg.line(i.x,i.y,n.x,n.y).attr({stroke:"#000000","stroke-width":.4})),o.add(svg.rect(22,12).radius(2).attr({stroke:"#000000","stroke-width":0,fill:"#ffffff",opacity:.9}).cx(e.x).cy(e.y)),o.add(svg.plain(s.toString()).attr({x:e.x,y:e.y}).font({family:"Arial",size:9,stroke:"#000000","stroke-width":.3,fill:"#000000"}).cx(e.x).cy(e.y)),o}let _=function(t){t=copy.object(t);let p=this;if("athletic-bench"===t.name?t.name="athletic_bench":"kup"===t.name&&(t.name="electric_kup"),socketsGroup.is_allow(t.name)){t.socket_group=[];for(let e=0;e<t.length;e++)t.socket_group.push({name:t.name,id:LIB.id()}),t.settings.plan[socketsGroup.types[t.name].plan]=1;t.name="socket_group"}if("socket_group"===t.name&&t.socket_group)for(let e=0;e<t.socket_group.length;e++)t.socket_group[e].id||(t.socket_group[e].id=LIB.id());if(cabling_socket.multi_spots[t.name]&&t[cabling_socket.name_object_lines])for(var e in t[cabling_socket.name_object_lines])!t[cabling_socket.name_object_lines].hasOwnProperty(e)||Array.isArray(t[cabling_socket.name_object_lines][e])||(t[cabling_socket.name_object_lines][e]=t[cabling_socket.name_object_lines][e]?[t[cabling_socket.name_object_lines][e]]:[]);if(piping.multi_spots[t.name]&&t[piping.name_object_lines])for(var i in t[piping.name_object_lines])!t[piping.name_object_lines].hasOwnProperty(i)||Array.isArray(t[piping.name_object_lines][i])||(t[piping.name_object_lines][i]=t[piping.name_object_lines][i]?[t[piping.name_object_lines][i]]:[]);for(var n in t.settings.plan&&t.settings.plan.sockets_lowcurrent&&(delete t.settings.plan.sockets_lowcurrent,t.settings.plan.sockets=1,t.plan="sockets"),t.settings.plan&&(t.settings.plan.sockets||t.settings.plan.init)&&in_array(t.name,["electric_shield","electric_shield_internal","electric_shield_old"])&&(t.settings.plan.cables=1),(this.props=t).settings.plan&&"switches"===t.settings.group&&t.settings.plan.light&&(delete t.settings.plan.light,t.settings.plan.light_connections=1,this.findComment(),this.comment&&(this.comment.plan="light_connections")),"waterspot_node"===t.name&&t.pipes&&(t.settings.filling="#fafafa",t.settings.width=t.pipes.drainage_pipe_id?2:1,t.settings.height=t.pipes.drainage_pipe_id?2:1,t.settings.width_changed=t.pipes.drainage_pipe_id?2:1,t.settings.height_changed=t.pipes.drainage_pipe_id?2:1,t.settings.stroke_width=1),"electrospot_node"===t.name&&(t.stripes_light||t.line_strips)&&(t.settings.width=3,t.settings.height=3,t.settings.width_changed=3,t.settings.height_changed=3,t.settings.stroke_width=1),"electrospot_node"===t.name&&t.led_strips&&(t.settings.width=2,t.settings.height=2,t.settings.width_changed=2,t.settings.height_changed=2,t.settings.stroke_width=1),"socket_group"===t.name&&(t.socket_group?this.props.socket_group=t.socket_group:this.props.socket_group=[],t.settings.width=7*(this.props.socket_group.length+1),t.settings.height=14,t.settings.width_changed=t.settings.width,t.settings.height_changed=t.settings.height,t.settings.legend="",this.props.length=this.props.socket_group.length,this.legends_socket_group={},this.polygons_socket_group=[],this.selected_socket_group=null,!is_empty(this.props.socket_group)&&t.settings.plan&&1<Object.keys(t.settings.plan).length&&(t.settings.plan=socketsGroup.get_plans(this.props.socket_group))),this.model=t.settings,this.model.offset||(this.model.offset=0),tools)t.name===n&&(this.model.path=tools[n].path);for(var s in t.id?this.props.id=t.id:(this.props.id=LIB.id(),LogItems.add(this.props.id,this.props.name)),this.props.over_floor?this.props.over_floor=t.over_floor:this.props.over_floor={value:this.model.over_floor.value,display:this.model.over_floor.display},""===this.model.path&&(this.model.path=get_pseudo_tool_path(this.model.width,this.model.height)),t.width?this.props.width=t.width:this.props.width=this.model.width,t.height?this.props.height=t.height:this.props.height=this.model.height,t.comment?this.props.comment=t.comment:this.props.comment={exist:!1,id:""},t.dimensions?this.props.dimensions=t.dimensions:this.props.dimensions={display:!0},t.rotated?this.props.rotated=t.rotated:this.props.rotated=!1,t.rotated_manually?this.props.rotated_manually=t.rotated_manually:this.props.rotated_manually=!1,t.demount?this.props.demount=t.demount:this.props.demount=!1,this.selected=!1,this.demount=!1,"string"!=typeof this.props.center.x&&"string"!=typeof this.props.center.y||(this.props.center.x=parseFloat(this.props.center.x),this.props.center.y=parseFloat(this.props.center.y)),this.click_zone=layers.items1.polygon().attr({stroke:0,fill:"transparent"}).draggable().on("mouseover",function(e){p.mouseover(e)}).on("mouseleave",function(e){p.mouseleave(e)}).on("mousedown",function(e){p.mousedown(e)}).on("mouseup",function(e){p.mouseup(e)}).on("mousemove",function(e){"socket_group"===p.props.name&&p.polygons_socket_group&&!this.moving&&isContextmenuHidden()&&(e=LIB.point(e.clientX,e.clientY,"svg"),in_array(plan,["sockets","light_connections"])&&"none"===tool&&(p.selected_socket_group=socketsGroup.getIdSocketByPoint(e,p),socketsGroup.setDefaultColor(p.image,p.props.name,p),p.selected_socket_group&&socketsGroup.setAttr(p.image,p.props.name,{stroke:"orange"},p.selected_socket_group)),plan===cabling_socket.plan&&in_array(tool,cabling_socket.tools)?(p.selected_socket_group=socketsGroup.getIdSocketByPoint(e,p),socketsGroup.setDefaultColor(p.image,p.props.name,p),p.selected_socket_group&&cabling_socket.mouseover(p,p.selected_socket_group)):plan===cabling.plan&&in_array(tool,cabling.tools)&&(p.selected_socket_group=socketsGroup.getIdSocketByPoint(e,p),socketsGroup.setDefaultColor(p.image,p.props.name,p),p.selected_socket_group&&cabling.mouseover(p,p.selected_socket_group)))}).on("beforedrag",function(e){if(this.allowed=!1,"none"===tool&&p.isAvailable(!0)){baselines.create(),this.moving=!0,layers.upper.clear(),this.mStart=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.mEnd=copy.point(this.mStart),this.center_before=p.props.center,this.angle_before=p.props.angle,this.path_before=p.image.attr("d"),this.baseline=!1;e=in_array(p.props.name,outer_room_items);if(!e){if(p.get("parentRoom"),this.room=get_object(rooms2.data,p.props.id_room),p.props.projection&&this.room&&0<this.room.border_dimensions.length)for(let e=0;e<this.room.border_dimensions.length;e++){var t=this.room.border_dimensions[e];if(is_point_on_line(p.props.projection,t)){this.baseline=t;t=get_point_place(in_array(p.props.name,piping.water_items)?p.tp:p.props.center,this.baseline);this.position="L"===t?"L":"R";break}}if(!this.baseline&&0<p.model.offset){var i=get_line(p.tp,p.bp);for(let e=0;e<baselines.db.length;e++){var n=baselines.db[e];if(line_and_line_intersection(i,n)){this.baseline=n;n=get_point_place(p.props.center,this.baseline);this.position="L"===n?"L":"R";break}}}}if(!p.props.name||e||"sockets"===p.model.group&&p.s&&isNaN(p.s.x))for(let e=0;e<baselines.db.length;e++){var s=baselines.db[e];if(is_point_on_line(p.props.projection,s)){this.baseline=s;s=get_point_place(p.tp,this.baseline);this.position="L"===s?"L":"R";break}}if("electric_shield_old"===p.props.name)for(let e=0;e<baselines.db.length;e++){var o=baselines.db[e];if(is_point_on_line(p.props.projection,o)){this.baseline=o;o=get_point_place(p.props.center,this.baseline);this.position="L"===o?"L":"R";break}}p.findComment(),"fire_detector"===p.props.name&&p.lines.clear(),manager_lining.item_beforedrag(p),"light"===plan&&in_array(p.props.name,light_reference_lines.tools)&&light_reference_lines.build(p.props.id)}}).on("dragmove",function(e){if(e.preventDefault(),!0===this.moving&&(this.mEnd=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.allowed||3<get_distance(this.mStart,this.mEnd)&&(this.allowed=!0),this.allowed)){if($("body").css("cursor","pointer"),p.legend.clear(),p.legend_over_floor.clear(),p.legends_socket_group)for(var t in p.legends_socket_group)p.legends_socket_group[t].clear();switch(p.dimensions.clear(),p.model.anchor){case"wall":if(this.baseline){var i={s:LIB.pointOnLine(this.baseline.e,this.baseline.s,-7),e:LIB.pointOnLine(this.baseline.s,this.baseline.e,-7)},i=LIB.projection(this.mEnd,i);if(i){if(p.props.center=point_near_line_end(this.baseline.s,i,p.image.bbox().h/2-p.model.offset,this.position),"socket_group"===p.props.name&&p.image.node&&p.image.node.children&&p.props.socket_group)for(let e=0;e<p.props.socket_group.length;e++){var n=p.image.node.children[e].getBoundingClientRect(),s=get_svg_point({x:n.left,y:n.top}),n=get_svg_point({x:n.right,y:n.bottom});p.props.socket_group[e].center_moving=get_center(s,n)}p.props.projection=copy_point(i),this.baseline.draw()}}break;case"ceiling":striping_light.moved_strip_light?(i=striping_light.get_point_moved_strip_light(this.mEnd))&&(this.mEnd=i,p.props.center=copy_point(this.mEnd)):("light"===plan&&in_array(p.props.name,light_reference_lines.tools)&&(this.mEnd=light_reference_lines.show(this.mEnd)),p.props.center=copy_point(this.mEnd)),"lights"===p.model.group&&(p.get("parentRoom"),1!=p.props.dimensions.display||in_array(p.props.name,striping_light.track_spots)||(allow.magnet&&p.parent_room&&in_array(p.props.name,["chandelier","ceiling_chandelier_shades","ceiling_chandelier_led","hanging_chandelier_shades","hanging_chandelier_led","cascading_chandelier","crystal_chandelier"])&&(get_distance(this.mEnd,p.parent_room.center)<20?(this.mEnd=copy.point(p.parent_room.center),p.props.center=copy_point(this.mEnd),light_reference_lines.build_center_room(p.parent_room)):light_reference_lines.erase()),"light"===plan&&in_array(p.props.name,light_reference_lines.tools)?items.build_dimensions():p.build("XDimensions")));break;case"free":i=in_array(p.props.name,outer_room_items);if(!i){var o=this.mEnd.x-this.mStart.x,l=this.mEnd.y-this.mStart.y;if(manager_lining.item_dragmove(p)||(p.props.center={x:this.center_before.x+o,y:this.center_before.y+l}),p.props.rotated&&!p.props.rotated_manually&&(p.props.angle=0,p.props.rotated=!1),!p.props.rotated){let n=20;if("width"===p.model.pairing?n=p.model.height_changed*p.model.height_k/2+10:"height"===p.model.pairing&&(n=p.model.width_changed*p.model.width_k/2+10),allow.magnet&&!in_array(p.props.name,["waterspot_node","electrospot_node"])&&("waterspot_drainage"!==p.props.name||p.model.need_show_baseline)){p.props.edge=null,mouse.over.search("room");let e=!1;if(mouse.over.ROOM){let i=mouse.over.ROOM,t=[];for(let e=0;e<i.edges.length;e++){var r=i.edges[e],r=LIB.projection(this.mEnd,r);r&&(r=get_distance(this.mEnd,r),t.push({edge:e,distance:r}))}if(t.sort(compare_distance),t[0].distance<=n&&(p.props.edge=t[0].edge),null!==p.props.edge){o=i.edges[p.props.edge],l=get_point_place(this.mEnd,o);let t=LIB.projection(this.mEnd,o);if(t){var a=get_distance(this.mEnd,t),h=get_distance(t,o.s),g=get_distance(t,o.e),_=p.model.height_changed/2+p.h_delta/2-parseInt(p.model.offset);if(a<n){if(p.model.need_show_baseline)if(this.baseline)this.baseline.draw();else{i.draw_("border_dimensions");for(let e=0;e<i.border_dimensions.length;e++){var d=i.border_dimensions[e];if(is_point_on_line(t,d)){this.baseline=d;d=get_point_place(p.props.center,this.baseline);this.position="L"===d?"L":"R";break}}}"L"===o.room_side&&"L"===l&&(p.props.center=point_near_line_end(o.s,t,_,"L"),p.props.angle=get_line_angle(o),h<g&&h<=p.model.width_changed/2+20&&(t=LIB.pointOnLine(o.e,o.s,-p.model.width_changed/2),p.props.center=point_near_line_end(o.s,t,_,"L")),g<h&&g<=p.model.width_changed/2+20&&(t=LIB.pointOnLine(o.s,o.e,-p.model.width_changed/2),p.props.center=point_near_line_end(o.s,t,_,"L")),p.props.projection=t),"R"===o.room_side&&"R"===l&&(p.props.center=point_near_line_end(o.s,t,_,"R"),p.props.angle=get_line_angle(o)+180,h<g&&h<=p.model.width_changed/2+20&&(t=LIB.pointOnLine(o.e,o.s,-p.model.width_changed/2),p.props.center=point_near_line_end(o.s,t,_,"R")),g<h&&g<=p.model.width_changed/2+20&&(t=LIB.pointOnLine(o.s,o.e,-p.model.width_changed/2),p.props.center=point_near_line_end(o.s,t,_,"R")),p.props.projection=t)}}}else e=!0}else e=!0;p.model.need_show_baseline&&e&&this.baseline&&(this.baseline.erase(),p.props.projection=null,this.baseline=null,this.room.draw_("border_dimensions")),null===p.props.edge&&(p.props.angle=0)}}}if(i){a=p.model.height_changed/2;let e=LIB.projection(this.mEnd,this.baseline);e&&(p.props.center=point_near_line_end(this.baseline.s,e,a,this.position),(l=get_distance(e,this.baseline.s))<(h=get_distance(e,this.baseline.e))&&l<=p.model.width_changed/2+20&&(e=LIB.pointOnLine(this.baseline.e,this.baseline.s,-p.model.width_changed/2),p.props.center=point_near_line_end(this.baseline.s,e,a,this.position)),h<l&&h<=p.model.width_changed/2+20&&(e=LIB.pointOnLine(this.baseline.s,this.baseline.e,-p.model.width_changed/2),p.props.center=point_near_line_end(this.baseline.s,e,a,this.position)),p.props.projection=e,p.props.angle=get_line_angle(this.baseline))}}p.move(),p.paint("orange"),p.updateComment()}}).on("dragend",function(e){if(this.allowed){"none"===tool&&("stairs"===p.model.group&&"porch"!==p.props.name&&(p.props.id_room=mouse.over.id_room,p.get("points"),p.draw(),p.get("parentRoom"),p.get("parentWall"),p.get("parentPillar")),"stairs"!==p.model.group&&("furniture"!==p.model.group&&"santeh"!==p.model.group&&(mouse.over.search("room"),null!==mouse.over.room||in_array(p.props.name,["waterspot_node","electrospot_node"])?(p.props.id_room=mouse.over.id_room,p.get("points")):in_array(p.props.name,piping.water_drainage_items)&&p.props.id_room?p.get("points"):in_array(p.props.name,outer_room_items)||(p.props.center={x:this.center_before.x,y:this.center_before.y},p.props.angle=this.angle_before,p.draw(),this.baseline&&(p.props.projection=LIB.projection(p.props.center,this.baseline)),this.baseline&&this.baseline.draw(),this.comment&&(this.comment.s=p.props.center,this.comment.draw()))),p.get("parentRoom"),p.get("parentWall"),p.get("parentPillar")));let e={};(in_array(p.model.group,["switches","sockets","lights","wires"])||"furniture"===p.model.group&&p.props.over_floor&&0<p.props.over_floor.value)&&"cables"!==plan&&(e.set_layer=!0),p.draw(null,e),p.updateComment(),project.localSave()}if(p.update_dimensions(),delete this.mStart,delete this.mEnd,delete this.baseline,delete this.room,delete this.center_before,delete this.angle_before,delete this.moving,delete this.path_before,delete this.position,this.moving=!1,"socket_group"===p.props.name&&p.props.socket_group)for(let e=0;e<p.props.socket_group.length;e++)delete p.props.socket_group[e].center_moving;manager_lining.item_dragend(p),light_reference_lines.erase(),"waterspot_drainage"!==p.props.name||!p.model.need_show_baseline||p.props.id_wall||p.props.id_pillar||delete p.model.need_show_baseline}),this.model.custom_options){var o,l=this.model.custom_options[s].name;if(this.model.custom_options[s].hasOwnProperty("options")){if(!this.props.hasOwnProperty(l))for(var r in this.model.custom_options[s].options){r=this.model.custom_options[s].options[r];"1"===r.value&&(this.props[l]={value:r.value,title:r.title})}}else this.props.hasOwnProperty(l)||(o=this.model.custom_options[s],this.props[o.name]={title:o.title,value:o.value})}void 0!==CustomIcons[t.name]?this.image=CustomIcons[t.name].group(this.props.waterspots_change_sequence):"socket_group"===t.name?this.image=socketsGroup.get_image(this.props.socket_group):("fire_detector"===this.props.name&&(this.model.stroke_color="red",this.model.stroke_width=1.4),"gas_pipe"===this.props.name?(this.model.stroke_color="#000000",this.model.stroke_width=1.4,this.model.filling="yellow",this.image=layers.items1.circle(8)):"heat_pipe"===this.props.name?(this.model.stroke_color="#000000",this.model.stroke_width=1.4,this.model.filling="red",this.image=layers.items1.circle(8)):in_array(this.props.name,["waterspot_node","electrospot_node"])?this.image=layers.items1.circle(t.settings.width):this.image=layers.items1.path(this.model.path).attr({stroke:this.model.stroke_color,"stroke-width":this.model.stroke_width,fill:"green"})),this.image.addClass("item_x_"+this.props.id),this.click_zone.addClass("item_x_"+this.props.id);var a=this.image.bbox(svg);if(this.model.width_k=parseFloat((a.w/this.model.width).toFixed(2)),this.model.height_k=parseFloat((a.h/this.model.height).toFixed(2)),this.model.width_k||(this.model.width_k=1),this.model.height_k||(this.model.height_k=1),"electric_shield_old"!==this.props.name&&"radiator_old"!==this.props.name||(this.DEMOUNT=layers.demounts.group().on("mousedown",function(e){if(id.item=p.props.id,1===e.detail){if(1===e.which&&"eraser"===tool)return p.props.demount=!1,p.draw(),void project.localSave();3===e.which&&p.contextmenu(e)}2===e.detail&&p.contextmenu(e)})),this.get("points"),this.get("parentRoom"),this.get("parentWall"),this.get("parentPillar"),in_array(this.props.name,piping.water_drainage_items)&&this.props.id_room){this.model.offset=4.5;var h=get_object(rooms2.data,this.props.id_room);if(h&&this.props.projection&&0<h.border_dimensions.length)for(let e=0;e<h.border_dimensions.length;e++){var g=h.border_dimensions[e];if(is_point_on_line(this.props.projection,g)){var _=get_point_place(this.props.center,g);this.props.center=point_near_line_end(g.s,this.props.projection,this.image.bbox().h/2-this.model.offset,"L"===_?"L":"R");break}}}try{if(0===this.model.offset&&in_array(this.model.group,["sockets","switches"])&&this.props.projection){let t=!0;var d=LIB.pointOnLine(this.tp,this.bp,-3);for(let e=0;e<rooms2.data.length;e++){rooms2.data[e];if(is_point_inside_polygon(d,rooms2.data[e].points)){t=!1;break}}if(t||!LIB.arePointsEqual(this.props.projection,this.bp)&&is_point_on_line(this.props.projection,get_big_line(get_line(this.props.center,this.bp)))){if(!this.props.id_room)for(let e=0;e<rooms2.data.length;e++){rooms2.data[e];if(is_point_inside_polygon(this.tp,rooms2.data[e].points)){this.props.id_room=rooms2.data[e].id;break}}if(this.props.id_room){let t=get_object(rooms2.data,this.props.id_room);if(t){if(0===t.border_dimensions.length)for(let e=0;e<t.edges.length;e++){var c=t.edges[e];t.border_dimensions.push(new Se({pid:t.id,edge:c}))}if(0<t.border_dimensions.length)for(let e=0;e<t.border_dimensions.length;e++){var A=t.border_dimensions[e];if(is_point_on_line(this.props.projection,A,1)){var u=LIB.projection(this.props.center,A);if(u&&!LIB.arePointsEqual(this.props.projection,u)){this.props.projection=u,this.findComment();var w=get_point_place(this.tp,A);this.props.center=point_near_line_end(A.s,this.props.projection,this.image.bbox().h/2,"L"===w?"L":"R"),this.updateComment(),console.warn("Restore sockets"),send_warning_signals(signal_types[1],"Ремонт съехавших розеток/выключателей: ",this.props.id,1,1);break}}}}}}}}catch(e){send_error_js(e.name,e.message,e.stack)}if(this.legend=layers.items1.plain("").font(E).attr({fill:this.model.legend_color}),this.legend_over_floor=layers.items1.plain("").font(E).attr({fill:this.model.legend_color}),this.lines=layers.itemsDimensions.group(),this.sizes=layers.itemsDimensions.group(),this.dimensions=layers.itemsDimensions.group(),this.dimension_front=layers.itemsDimensions.group(),this.dimension_side=layers.itemsDimensions.group(),this.setLayers(),!this.props.comment.removed&&!this.props.comment.exist&&""!==this.model.comment){let e=get_key_by_value(this.model.plan,1);"electric_shield_old"===tool&&(e=plan),comments.db.push(new Comment({s:this.props.center,text:this.model.comment,label:this.model.label,id_item:this.props.id,name_item:this.props.name,plan:e}));a=comments.db[comments.db.length-1];this.props.comment.exist=!0,this.props.comment.id=a.id}"light"===plan&&in_array(this.props.name,striping_light.track_spots)&&null!==striping_light.selected_strip_light&&(this.props.angle=striping_light.selected_strip_light.angle,striping_light.set_spot_in_strip(this)),this.draw(),"waterspot_drainage"!==this.props.name||!this.model.need_show_baseline||this.props.id_wall||this.props.id_pillar||delete this.model.need_show_baseline,this.props.name};function ze(){$("body").css("cursor","default"),deactivate_tool(),$(".options_preset").hide(),hide2.contextmenu(),$(".footer_bar_tool").removeClass("active"),allow.pan=!0,walls.paint(),pillars.paint(),items.paint(),cursors.hide(),signs.reset(),layers.upper.clear(),z.reset(),magnets2.hide(),hide(),signs.reset(),ne.fire("remove"),SVG.select("#custom_cursor").hide(),layers.upper.clear()}function U(e){let t=this;this.s=e.s,this.e=e.e,this.plan=e.plan,e.type?this.type=e.type:this.type="one",e.id?this.id=e.id:this.id=LIB.id(),this.attr={stroke:"crimson","stroke-width":.4},this.IMAGE=layers.rulers.group().on("mouseover",function(e){"eraser"===tool&&(customCursor.overObject=!0)}).on("mouseleave",function(e){"eraser"===tool&&(customCursor.overObject=!1)}).on("mousedown",function(e){id.ruler=t.id,selectedObject="ruler","eraser"===tool&&t.delete()}).on("contextmenu",function(e){id.ruler=t.id,t.showContextmenu(e)}).on("dblclick",function(e){id.ruler=t.id,t.showContextmenu(e)}),this.m_line=svg.line().attr(this.attr),this.m_line_bg=svg.polygon().attr({stroke:"none","stroke-width":0,fill:"transparent"}),this.l_line=svg.line().attr(this.attr),this.r_line=svg.line().attr(this.attr),this.r_dash=svg.line().attr(this.attr),this.l_dash=svg.line().attr(this.attr),this.background=svg.rect(16,8).radius(2).attr({stroke:"none","stroke-width":0,fill:"#fafafa",opacity:1}),this.text=svg.plain("").font({family:"Arial",stroke:"crimson",fill:"crimson"}),this.draw()}_.prototype.get=function(e){if("points"===e)if("sofa_double"===this.props.name&&(s=this.model.width_changed,n=this.model.height_changed,this.props.angle?this.bp={x:this.props.center.x+n/2*Math.cos((this.props.angle+90)*Math.PI/180),y:this.props.center.y+n/2*Math.sin((this.props.angle+90)*Math.PI/180)}:this.bp={x:this.props.center.x,y:this.props.center.y+n/2},this.cp=copy.point(this.props.center),this.props.icon_center=copy.point(this.props.center),this.tp=LIB.pointOnLine(this.bp,this.cp,n/2),this.tp_outer=copy.point(this.tp),this.rp=point_near_line_end(this.bp,this.cp,s/2,"R"),this.lp=point_near_line_end(this.bp,this.cp,s/2,"L"),this.op=point_near_line_end(this.bp,this.tp,s/2,"R"),this.w=get_distance(this.lp,this.rp),this.h=get_distance(this.tp,this.bp),this.props.tp=LIB.fixPoint(this.tp),this.props.bp=LIB.fixPoint(this.bp),this.props.lp=LIB.fixPoint(this.lp),this.props.rp=LIB.fixPoint(this.rp),this.p1=get_point_near_line_end(this.bp,this.tp_outer,i=s/2,"L"),this.p2=get_point_near_line_end(this.bp,this.tp_outer,i,"R"),this.p3=get_point_near_line_end(this.tp_outer,this.bp,i,"L"),this.p4=get_point_near_line_end(this.tp_outer,this.bp,i,"R"),this.pbp={x:this.props.center.x+n/2*Math.cos((this.props.angle+90)*Math.PI/180),y:this.props.center.y+n/2*Math.sin((this.props.angle+90)*Math.PI/180)},this.ptp=LIB.pointOnLine(this.bp,this.props.center,n/2),this.pp1=get_point_near_line_end(this.pbp,this.ptp,s/2,"L"),this.pp2=get_point_near_line_end(this.pbp,this.ptp,s/2,"R"),this.pp3=get_point_near_line_end(this.ptp,this.pbp,s/2,"L"),this.pp4=get_point_near_line_end(this.ptp,this.pbp,s/2,"R"),this.props.center3d=copy.point(this.cp)),"electric_shield_old"===this.props.name){var i=this.model.width,n=this.model.height,s=(this.props.angle?this.bp={x:this.props.center.x+n/2*Math.cos((this.props.angle+90)*Math.PI/180),y:this.props.center.y+n/2*Math.sin((this.props.angle+90)*Math.PI/180)}:this.bp={x:this.props.center.x,y:this.props.center.y+n/2},this.cp=LIB.pointOnLine(this.bp,this.props.center,0),this.props.icon_center=LIB.pointOnLine(this.bp,this.props.center,0),this.tp=LIB.pointOnLine(this.bp,this.cp,n/2),this.tp_outer=LIB.pointOnLine(this.bp,this.tp,0),this.rp=point_near_line_end(this.bp,this.cp,i/2,"R"),this.lp=point_near_line_end(this.bp,this.cp,i/2,"L"),this.op=point_near_line_end(this.bp,this.tp,i/2,"R"),this.w=get_distance(this.lp,this.rp),this.h=get_distance(this.tp,this.bp),this.props.tp=LIB.fixPoint(this.tp),this.props.bp=LIB.fixPoint(this.bp),this.props.lp=LIB.fixPoint(this.lp),this.props.rp=LIB.fixPoint(this.rp),i/2);this.p1=get_point_near_line_end(this.bp,this.tp_outer,s,"L"),this.p2=get_point_near_line_end(this.bp,this.tp_outer,s,"R"),this.p3=get_point_near_line_end(this.tp_outer,this.bp,s,"L"),this.p4=get_point_near_line_end(this.tp_outer,this.bp,s,"R"),this.pbp={x:this.props.center.x+n/2*Math.cos((this.props.angle+90)*Math.PI/180),y:this.props.center.y+n/2*Math.sin((this.props.angle+90)*Math.PI/180)},this.ptp=LIB.pointOnLine(this.bp,this.props.center,n/2),this.pp1=get_point_near_line_end(this.pbp,this.ptp,i/2,"L"),this.pp2=get_point_near_line_end(this.pbp,this.ptp,i/2,"R"),this.pp3=get_point_near_line_end(this.ptp,this.pbp,i/2,"L"),this.pp4=get_point_near_line_end(this.ptp,this.pbp,i/2,"R"),this.props.center3d=copy.point(this.cp)}else{let e=this.model.width_changed,t=this.model.height_changed;in_array(this.props.name,["electrospot_node","waterspot_node"])&&(e=8,t=8),(piping.is_node(this)||striping_light.is_node(this)||striping_led.is_node(this)||striping_line.is_node(this))&&(e=12,t=12);s=e*this.model.width_k,n=t*this.model.height_k,i=n-t,i=(this.props.angle?this.bp={x:this.props.center.x+n/2*Math.cos((this.props.angle+90)*Math.PI/180),y:this.props.center.y+n/2*Math.sin((this.props.angle+90)*Math.PI/180)}:this.bp={x:this.props.center.x,y:this.props.center.y+n/2},this.cp=LIB.pointOnLine(this.bp,this.props.center,-i/2),this.props.icon_center=LIB.pointOnLine(this.bp,this.props.center,-i/2),this.tp=LIB.pointOnLine(this.bp,this.cp,t/2),this.tp_outer=LIB.pointOnLine(this.bp,this.tp,i),this.rp=point_near_line_end(this.bp,this.cp,s/2,"R"),this.lp=point_near_line_end(this.bp,this.cp,s/2,"L"),this.op=point_near_line_end(this.bp,this.tp,s/2,"R"),this.w=get_distance(this.lp,this.rp),this.h=get_distance(this.tp,this.bp),this.props.tp=LIB.fixPoint(this.tp),this.props.bp=LIB.fixPoint(this.bp),this.props.lp=LIB.fixPoint(this.lp),this.props.rp=LIB.fixPoint(this.rp),s/2);this.p1=get_point_near_line_end(this.bp,this.tp_outer,i,"L"),this.p2=get_point_near_line_end(this.bp,this.tp_outer,i,"R"),this.p3=get_point_near_line_end(this.tp_outer,this.bp,i,"L"),this.p4=get_point_near_line_end(this.tp_outer,this.bp,i,"R"),this.pbp={x:this.props.center.x+n/2*Math.cos((this.props.angle+90)*Math.PI/180),y:this.props.center.y+n/2*Math.sin((this.props.angle+90)*Math.PI/180)},this.ptp=LIB.pointOnLine(this.bp,this.props.center,n/2),this.pp1=get_point_near_line_end(this.pbp,this.ptp,s/2,"L"),this.pp2=get_point_near_line_end(this.pbp,this.ptp,s/2,"R"),this.pp3=get_point_near_line_end(this.ptp,this.pbp,s/2,"L"),this.pp4=get_point_near_line_end(this.ptp,this.pbp,s/2,"R"),this.props.center3d=copy.point(this.cp)}if("parentRoom"===e)if(this.props.id_room=void 0,"init"===this.props.plan)for(let e=0;e<rooms1.data.length;e++){var t=rooms1.data[e];if(is_point_inside_polygon(this.props.center,t.polygon)){this.props.id_room=t.id,this.parent_room=t;break}}else for(let e=0;e<rooms2.data.length;e++){var o=rooms2.data[e];if(is_point_inside_polygon(0===this.model.offset?this.props.center:this.tp,o.polygon)){this.props.id_room=o.id,this.parent_room=o;for(let e=0;e<o.zones.length;e++){var l=o.zones[e];is_point_inside_polygon(0===this.model.offset?this.props.center:this.tp,l.polygon)&&(this.props.id_room_zone=l.id)}break}}if("parentWall"===e){var r=get_line(this.tp,this.bp);this.props.id_wall=void 0;for(let e=0;e<walls.db.length;e++){var a=walls.db[e];if(0===this.model.offset?is_point_on_line(this.bp,a.EdgeO):line_and_line_intersection(r,a.EdgeO)){this.props.id_wall=a.id;break}if(0===this.model.offset?is_point_on_line(this.bp,a.EdgeI):line_and_line_intersection(r,a.EdgeI)){this.props.id_wall=a.id;break}}}if("parentPillar"===e){var h=get_line(this.tp,this.bp);this.props.id_pillar=void 0;for(let e=0;e<pillars.db.length;e++){var g=pillars.db[e];if(in_array(g.role,["pillar","gypsum"])){if(!0!==g.edge1_on_wall&&!0!==g.edge_b__on_wall&&0===this.model.offset?is_point_on_line(this.bp,g.edge_b):line_and_line_intersection(h,g.edge_b)){this.props.id_pillar=g.id;break}if(!0!==g.edge2_on_wall&&!0!==g.edge_l__on_wall&&0===this.model.offset?is_point_on_line(this.bp,g.edge_l):line_and_line_intersection(h,g.edge_l)){this.props.id_pillar=g.id;break}if(!0!==g.edge3_on_wall&&!0!==g.edge_r__on_wall&&0===this.model.offset?is_point_on_line(this.bp,g.edge_r):line_and_line_intersection(h,g.edge_r)){this.props.id_pillar=g.id;break}if(!0!==g.edge4_on_wall&&!0!==g.edge_t__on_wall&&0===this.model.offset?is_point_on_line(this.bp,g.edge_t):line_and_line_intersection(h,g.edge_t)){this.props.id_pillar=g.id;break}}}}},_.prototype.getPolygon=function(){var e=copy.point(this.props.center),t=this.model.width_changed,i=this.model.height_changed,t=t*this.model.width_k,n=i*this.model.height_k,s=n-i,n={x:e.x+n/2*Math.cos((this.props.angle+90)*Math.PI/180),y:e.y+n/2*Math.sin((this.props.angle+90)*Math.PI/180)},e=LIB.pointOnLine(n,e,-s/2),e=LIB.pointOnLine(n,e,i/2),i=LIB.pointOnLine(n,e,s),e=get_point_near_line_end(n,i,t/2,"L"),s=get_point_near_line_end(n,i,t/2,"R"),o=get_point_near_line_end(i,n,t/2,"L"),i=get_point_near_line_end(i,n,t/2,"R");this.polygon=[],this.polygon.push(e,s,o,i)},_.prototype.build=function(s){if("XDimensions"===s){s=copy.point(this.props.center);if(this.t_line={s:s,e:{x:s.x,y:-1e6}},this.l_line={s:s,e:{x:-1e6,y:s.y}},this.b_line={s:s,e:{x:s.x,y:1e6}},this.r_line={s:s,e:{x:1e6,y:s.y}},this.parent_room){for(let e=0;e<this.parent_room.edges.length;e++){var t=this.parent_room.edges[e],i=line_and_line_intersection(this.t_line,t),n=line_and_line_intersection(this.l_line,t),o=line_and_line_intersection(this.r_line,t),t=line_and_line_intersection(this.b_line,t);i&&(this.t_line.e=i),n&&(this.l_line.e=n),o&&(this.r_line.e=o),t&&(this.b_line.e=t)}if("light"===plan&&in_array(this.props.name,light_reference_lines.tools)){let e={s:s,e:{x:s.x,y:-1e6}},t={s:s,e:{x:-1e6,y:s.y}},i={s:s,e:{x:s.x,y:1e6}},n={s:s,e:{x:1e6,y:s.y}};var l=copy.line(this.t_line),r=copy.line(this.l_line),a=copy.line(this.b_line),h=copy.line(this.r_line),g=light_reference_lines.get_close_item_point(e,this.props.id),_=light_reference_lines.get_close_item_point(t,this.props.id),d=light_reference_lines.get_close_item_point(i,this.props.id),p=light_reference_lines.get_close_item_point(n,this.props.id);g&&(e.e=g,LIB.lineLength(e)<=LIB.lineLength(this.t_line)&&(this.t_line.e=g,this.t_line.is_item=!0)),_&&(t.e=_,LIB.lineLength(t)<=LIB.lineLength(this.l_line)&&(this.l_line.e=_,this.l_line.is_item=!0)),d&&(i.e=d,LIB.lineLength(i)<=LIB.lineLength(this.b_line)&&(this.b_line.e=d,this.b_line.is_item=!0)),p&&(n.e=p,LIB.lineLength(n)<=LIB.lineLength(this.r_line)&&(this.r_line.e=p,this.r_line.is_item=!0)),LIB.lineLength(this.t_line)<=LIB.lineLength(this.b_line)?(this.lines.add(new m(this.t_line)),(this.b_line.is_item&&LIB.lineLength(this.b_line)<=100||this.t_line.is_item&&!this.b_line.is_item&&LIB.lineLength(l)>LIB.lineLength(a))&&this.lines.add(new m(this.b_line))):(this.lines.add(new m(this.b_line)),(this.t_line.is_item&&LIB.lineLength(this.t_line)<=100||this.b_line.is_item&&!this.t_line.is_item&&LIB.lineLength(l)<=LIB.lineLength(a))&&this.lines.add(new m(this.t_line))),LIB.lineLength(this.l_line)<=LIB.lineLength(this.r_line)?(this.lines.add(new m(this.l_line)),(this.r_line.is_item&&LIB.lineLength(this.r_line)<=100||this.l_line.is_item&&!this.r_line.is_item&&LIB.lineLength(r)>LIB.lineLength(h))&&this.lines.add(new m(this.r_line))):(this.lines.add(new m(this.r_line)),(this.l_line.is_item&&LIB.lineLength(this.l_line)<=100||this.r_line.is_item&&!this.l_line.is_item&&LIB.lineLength(r)<=LIB.lineLength(h))&&this.lines.add(new m(this.l_line)))}else{let e=!1;!this.props.id_room||(g=get_room(this.props.id_room))&&g.center&&LIB.arePointsEqual(g.center,s)&&(e=!0);_=LIB.lineLength(this.t_line),d=LIB.lineLength(this.b_line),p=LIB.lineLength(this.l_line),l=LIB.lineLength(this.r_line);_<=d?this.lines.add(new m(this.t_line,e&&Math.abs(_-d)<.2)):this.lines.add(new m(this.b_line,e&&Math.abs(_-d)<.2)),p<=l?this.lines.add(new m(this.l_line,e&&Math.abs(p-l)<.2)):this.lines.add(new m(this.r_line,e&&Math.abs(p-l)<.2))}}}},_.prototype.draw=function(e,t={}){if("B"!==plan_group||"fire_detector"!==this.props.name){if("electric_shield_old"===this.props.name)this.image.show(),this.image.untransform(),this.image.width(this.model.width_changed),this.image.cx(this.props.center.x).cy(this.props.center.y),this.image.rotate(this.props.angle),this.get("points"),this.paint(e,t);else if(is_point_exists(this.props.center)){var s=parseFloat(this.model.width_changed*this.model.width_k,10),o=parseFloat(this.model.height_changed*this.model.height_k,10);if(this.w_delta=s-this.model.width_changed,this.h_delta=o-this.model.height_changed,this.image.show(),"lights"!==this.model.group&&"ventilation_hole"!==this.props.name&&(0!==s&&0!==o?(this.image.width(s),this.image.height(o)):(this.image.width(this.model.width_changed),this.image.height(this.model.height_changed))),this.lines.clear(),this.sizes.clear(),this.image.untransform(),this.image.cx(this.props.center.x).cy(this.props.center.y),this.image.rotate(this.props.angle),this.image.scale(this.props.scale_x,this.props.scale_y),"lights"===this.model.group&&this.image.attr({}),"wall"===this.model.anchor&&in_array(this.model.group,["sockets","switches"])&&(s=this.props.width/2+10,this.s=get_point_near_line_end(this.props.center,this.props.projection,s,"L"),this.e=get_point_near_line_end(this.props.center,this.props.projection,s,"R"),this.pairing_line={s:this.s,e:this.e}),"wall"===this.model.anchor){o=Math.round(get_line_angle(get_line(this.p3,this.p4)));let i=!1,n="";function l(e,t){0==t||180==t?e.rotate(-90):90!=t&&-90!=t&&(-30<t&&t<150?e.rotate(t-90):e.rotate(t+90))}project.print_mode&&this.image.node&&(""!==this.model.legend||0<this.props.over_floor.value&&!0===this.props.over_floor.display||"socket_group"===this.props.name)&&(s=get_svg_point({x:(s=this.image.node.getBoundingClientRect()).right,y:s.bottom}),n="L"===(n=get_point_place(s,get_line(this.bp,this.props.center)))?"L":"R");if(""!==this.model.legend){this.legend.remove(),this.legend=layers.items1.plain(this.model.legend).font({size:7,family:"Arial","stroke-width":0,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"}).attr({fill:this.model.legend_color}),this.legend.show();let e=LIB.pointOnLine(this.bp,this.props.center,27);""!==n&&(e=get_point_near_line_end(this.bp,e,2.5,n)),this.legend.attr({x:e.x,y:e.y}),l(this.legend,o),i=!0}if("socket_group"===this.props.name&&this.image.node&&this.image.node.children&&this.props.socket_group){if(this.legends_socket_group)for(var r in this.legends_socket_group)this.legends_socket_group[r].remove();var a=Math.round(get_line_angle(this.pairing_line));for(let t=0;t<this.props.socket_group.length;t++){var h=this.image.node.children[t].getBoundingClientRect(),g=get_svg_point({x:h.left,y:h.top}),_=get_svg_point({x:h.left,y:h.bottom}),d=get_svg_point({x:h.right,y:h.top}),h=get_svg_point({x:h.right,y:h.bottom}),p=get_center(g,h);if(this.polygons_socket_group[t]=[g,d,h,_],this.props.socket_group[t].center=p,""!==socketsGroup.get_legend(this.props.socket_group[t].name)&&socketsGroup.get_plan(this.props.socket_group[t].name)===plan){g=LIB.projection(p,this.pairing_line);let e=LIB.pointOnLine(g,p,27);""!==n&&(e=get_point_near_line_end(g,e,2.5,n)),this.legends_socket_group[t]=layers.items1.plain(socketsGroup.get_legend(this.props.socket_group[t].name)).font({size:7,family:"Arial","stroke-width":0,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"}).attr({fill:this.model.legend_color}),this.legends_socket_group[t].show(),this.legends_socket_group[t].attr({x:e.x,y:e.y}),l(this.legends_socket_group[t],a),i=!0}}}if(0<this.props.over_floor.value&&!0===this.props.over_floor.display){s=this.props.over_floor.value.toString()+" см.";this.legend_over_floor.remove();try{this.legend_over_floor.remove()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}this.legend_over_floor=layers.items1.plain(s).font({size:8,family:"Arial","stroke-width":.1,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"}).attr({fill:this.model.legend_color}),this.legend_over_floor.show();s=+$(this.legend_over_floor.node).width()/svg.zoom();let e=LIB.pointOnLine(this.bp,this.props.center,(i?40:20)+s/2+this.model.offset);""!==n&&(e=get_point_near_line_end(this.bp,e,2.5,n)),this.legend_over_floor.attr({x:e.x,y:e.y}),l(this.legend_over_floor,o)}}if("wall"===this.model.anchor&&"santeh"===this.model.group){this.image.untransform();let e=baselines.db[this.props.edge],t;"width"===this.model.pairing&&(t=parseInt(this.props.height)),"height"===this.model.pairing&&(t=parseInt(this.props.width));let i;"L"===e.label&&(i=point_near_line_end(e.s,this.props.projection,t/2,"L")),is_point_exists(i="R"===e.label?point_near_line_end(e.s,this.props.projection,t/2,"R"):i)&&(this.props.center=copy.point(i)),this.image.cx(this.props.center.x).cy(this.props.center.y),this.image.rotate(this.props.angle);s=(t+t/2*this.props.length)/2+10;this.s=get_point_near_line_end(this.props.center,this.props.projection,s,"L"),this.e=get_point_near_line_end(this.props.center,this.props.projection,s,"R"),this.pairing_line={s:this.s,e:this.e};let n;"L"===e.label&&(n="L"),"R"===e.label&&(n="R"),cp=get_point_near_line_center(this.s,this.e,40,n);o=this.props.projection,s=LIB.pointOnLine(cp,o,-20);this.btn_plus_center=point_near_line_end(o,s,11,"R"),this.btn_minus_center=point_near_line_end(o,s,11,"L"),e.draw()}"ceiling"===this.model.anchor&&this.props.dimensions.display&&!in_array(this.props.name,striping_light.track_spots)&&(this.get("parentRoom"),this.props.id_room&&this.build("XDimensions")),"fire_detector"===this.props.name&&this.props.dimensions.display&&(this.get("parentRoom"),this.props.id_room&&this.build("XDimensions")),this.get("points"),this.update_dimensions(),this.props.width=this.model.width_changed,this.props.height=this.model.height_changed,manager_lining.item_draw(this),this.paint(e,t)}is_point_exists(this.p1)&&this.click_zone.plot([this.p1,this.p2,this.p3,this.p4])}},_.prototype.move=function(){is_point_exists(this.props.center)&&(this.image.untransform(),this.image.cx(this.props.center.x).cy(this.props.center.y),this.image.rotate(this.props.angle),this.image.scale(this.props.scale_x,this.props.scale_y),"ceiling"===this.model.anchor&&this.props.dimensions.display&&(this.lines.clear(),this.sizes.clear(),this.props.id_room&&!in_array(this.props.name,striping_light.track_spots)&&("light"===plan&&in_array(this.props.name,light_reference_lines.tools)?items.build_dimensions():this.build("XDimensions"))),manager_lining.item_move(this))},_.prototype.resize=function(t,i){let n=!1,s=!1,o=!1;if(console.warn(this.props.id_room),this.props.id_room){let t;if(t="init"===this.props.plan?get_object(rooms1.data,this.props.id_room):get_object(rooms2.data,this.props.id_room)){for(let e=0;e<t.edges.length;e++){var l=t.edges[e];if(is_point_on_line(this.bp,l)){n=!0;break}}for(let e=0;e<t.edges.length;e++){var r=t.edges[e];if(is_point_on_line(this.lp,r)){s=!0;break}}for(let e=0;e<t.edges.length;e++){var a=t.edges[e];if(is_point_on_line(this.rp,a)){o=!0;break}}}}if(null!==i&&(n&&(h=i*this.model.height_k,is_point_exists(h=LIB.pointOnLine(this.props.center,this.bp,-h/2))&&(this.props.center=copy.point(h))),this.model.height_changed=i,this.draw()),null!==t)if(t>=this.props.width&&s&&o)warning.show("yellow",l10n.item_not_resize);else{if(s&&!o){var h=(t-this.model.width_changed)/2;let e;0<h&&(e=get_point_near_line_end(this.bp,this.props.center,Math.abs(h),"R")),is_point_exists(e=h<0?get_point_near_line_end(this.bp,this.props.center,Math.abs(h),"L"):e)&&(this.props.center=copy.point(e))}if(!s&&o){i=(t-this.model.width_changed)/2;let e;0<i&&(e=get_point_near_line_end(this.bp,this.props.center,Math.abs(i),"L")),is_point_exists(e=i<0?get_point_near_line_end(this.bp,this.props.center,Math.abs(i),"R"):e)&&(this.props.center=copy.point(e))}this.model.width_changed=t,this.draw()}},_.prototype.setLayers=function(){let e=this.model.zindex;if(e=e||4,(this.model.plan.hasOwnProperty("furniture")||this.model.plan.hasOwnProperty("santeh"))&&(layers.furniture0.add(this.image),layers.furniture0.add(this.click_zone)),"stairs"===this.model.group)"init"===this.props.plan?(layers.stairs1.add(this.image),layers.stairs1.add(this.click_zone)):"build"===this.props.plan&&(layers.stairs2.add(this.image),layers.stairs2.add(this.click_zone));else if(this.model.plan.hasOwnProperty("furniture")){if("furniture"===plan){this.layer=e;try{layers["furniture"+e].add(this.image),layers["furniture"+e].add(this.click_zone)}catch(e){layers.furniture0.add(this.image),layers.furniture0.add(this.click_zone),send_error_js(e.name,e.message,e.stack),console.error(e)}}}else if(this.model.plan.hasOwnProperty("santeh")){if("santeh"===plan){this.layer=e;try{layers["furniture"+e].add(this.image),layers["furniture"+e].add(this.click_zone)}catch(e){layers.furniture0.add(this.image),layers.furniture0.add(this.click_zone),send_error_js(e.name,e.message,e.stack),console.error(e)}}}else if("switches"===this.model.group||"sockets"===this.model.group){if(layers.sockets.add(this.image),layers.sockets.add(this.legend),layers.sockets.add(this.legend_over_floor),this.legends_socket_group)for(var t in this.legends_socket_group)layers.sockets.add(this.legends_socket_group[t]);layers.sockets.add(this.click_zone)}else try{layers["items"+e].add(this.legend),layers["items"+e].add(this.legend_over_floor),layers["items"+e].add(this.image),layers["items"+e].add(this.click_zone)}catch(e){layers.items0.add(this.legend),layers.items0.add(this.legend_over_floor),layers.items0.add(this.image),layers.items0.add(this.click_zone),send_error_js(e.name,e.message,e.stack),console.error(e)}this.model.plan.hasOwnProperty("santeh")&&"furniture"===plan&&(this.layer=0,layers.furniture0.add(this.image),layers.furniture0.add(this.click_zone)),this.model.plan.hasOwnProperty("furniture")&&"santeh"===plan&&(this.layer=0,layers.furniture0.add(this.image),layers.furniture0.add(this.click_zone));try{if(in_array(this.model.group,["switches","sockets","lights","wires"])&&"cables"!==plan){var i=[this.cp,this.p1,this.p2,this.p3,this.p4,this.bp,this.tp,this.lp,this.rp];for(let e=0;e<items.db.length;e++)if(0!==items.db[e].model.offset&&"waterspots"!==items.db[e].model.group){var n=[items.db[e].p1,items.db[e].p2,items.db[e].p3,items.db[e].p4];let t=!1;for(let e=0;e<i.length;e++)if(is_point_inside_polygon(i[e],n)){if(layers.sockets_up.add(this.image),layers.sockets_up.add(this.legend),layers.sockets_up.add(this.legend_over_floor),this.legends_socket_group)for(var s in this.legends_socket_group)layers.sockets_up.add(this.legends_socket_group[s]);layers.sockets_up.add(this.click_zone),t=!0;break}if(t)break}}if("furniture"===this.model.group){var o=[this.cp,this.p1,this.p2,this.p3,this.p4,this.bp,this.tp,this.lp,this.rp];for(let e=0;e<items.db.length;e++)if(0!==items.db[e].model.offset&&"toilet_with_frame"===items.db[e].props.name&&this.props.over_floor&&this.props.over_floor.value&&items.db[e].props.over_floor&&items.db[e].props.over_floor.value&&+this.props.over_floor.value>+items.db[e].props.over_floor.value){var l=[items.db[e].p1,items.db[e].p2,items.db[e].p3,items.db[e].p4];let i=!1;for(let e=0;e<o.length;e++)if(is_point_inside_polygon(o[e],l)){if(layers.furniture_up.add(this.image),layers.furniture_up.add(this.legend),layers.furniture_up.add(this.legend_over_floor),this.legends_socket_group)for(var r in this.legends_socket_group)layers.furniture_up.add(this.legends_socket_group[r]);layers.furniture_up.add(this.click_zone),i=!0;break}if(!i){var a=LIB.polygonEdges([this.p1,this.p2,this.p3,this.p4]),h=LIB.polygonEdges(l);for(let t=0;t<a.length;t++){for(let e=0;e<h.length;e++)if(LIB.twoLinesIntersection(a[t],h[e])){if(layers.furniture_up.add(this.image),layers.furniture_up.add(this.legend),layers.furniture_up.add(this.legend_over_floor),this.legends_socket_group)for(var g in this.legends_socket_group)layers.furniture_up.add(this.legends_socket_group[g]);layers.furniture_up.add(this.click_zone),i=!0;break}if(i)break}}if(i)break}}}catch(e){send_error_js(e.name,e.message,e.stack)}in_array(this.props.name,["kitchen_sink","kitchen_sink_large","kitchen_sink_corner","sink_standalone","sink_table"])&&(layers.furniture1_1.add(this.image),layers.furniture1_1.add(this.click_zone),"furniture"===plan&&(this.layer=e,layers["furniture"+e].add(this.image),layers["furniture"+e].add(this.click_zone)));for(let e=0;e<manager_lining.get_lining_with_nodes().length;e++)if(manager_lining.get_lining_with_nodes()[e].is_node(this)){layers.trees_nodes.add(this.image),layers.trees_nodes.add(this.click_zone);break}0!==this.model.offset&&(in_array(this.props.name,piping.water_drainage_items)?(layers.water.add(this.image),layers.water.add(this.click_zone)):(layers.furniture_up_walls.add(this.image),layers.furniture_up_walls.add(this.click_zone))),in_array(this.props.name,["electric_shield_internal","electric_shield_old","gas_pipe","heat_pipe"])&&(layers.furniture_up_pillars.add(this.image),layers.furniture_up_pillars.add(this.click_zone)),in_array(this.props.name,["gas_pipe","heat_pipe"])&&(layers.risers.add(this.image),layers.risers.add(this.click_zone)),in_array(this.props.name,striping_light.track_spots)&&(layers.track_spots.add(this.image),layers.track_spots.add(this.click_zone))},_.prototype.update_dimensions=function(){this.dimensions.clear();var t=parseInt(this.model.width_changed),i=parseInt(this.model.height_changed);if(("1"===this.model.front_size||"2"===this.model.front_size)&&this.props.dimensions.display){let e;"1"===this.model.front_size&&(e="R"),"2"===this.model.front_size&&(e="L");var n=point_near_line_end(this.bp,this.tp,t/2,"L"),t=point_near_line_end(this.bp,this.tp,t/2,"R");this.dimensions.add(new Ne(n,t,e,14))}if(("1"===this.model.side_size||"2"===this.model.side_size)&&this.props.dimensions.display){let e="R";"1"===this.model.side_size&&(e="R"),"2"===this.model.side_size&&(e="L");n=point_near_line_end(this.rp,this.lp,i/2,"L"),t=point_near_line_end(this.rp,this.lp,i/2,"R");this.dimensions.add(new Ne(n,t,e,14))}},_.prototype.findComment=function(){this.comment=void 0;for(let e=0;e<comments.db.length;e++){var t=comments.db[e];!in_array(this.props.name,["waterspot_node","electrospot_node"])&&are_points_equal(this.props.center,t.s)&&(this.comment=t)}},_.prototype.updateComment=function(){manager_lining.is_lining_plan(this)||this.comment&&(this.comment.s=copy.point(this.props.center),this.comment.draw())},_.prototype.blink=function(e){let t,i,n=("cancel"===(e=e||"cancel")&&(t="#dc143c",i=1.5*this.model.stroke_width),"ok"===e&&(t=this.model.stroke_color,i=1.5*this.model.stroke_width),this.image.attr({stroke:t,"stroke-width":i}),this);setTimeout(function(){manager_lining.item_blink(n)||n.image.attr({stroke:n.model.stroke_color,"stroke-width":n.model.stroke_width})},150)},_.prototype.select=function(e){this.model.stroke_width;this.model.group,this.image.attr({stroke:e}),CustomIcons.setAttr(this.image,this.props.name,{stroke:e}),socketsGroup.setAttr(this.image,this.props.name,{stroke:e},this.selected_socket_group)},_.prototype.glow=function(e){var t,i;"on"===e&&"break"===plan&&(t="break_radiator"===tool&&"radiator_old"===this.props.name,i="break_electric_shield"===tool&&"electric_shield_old"===this.props.name,!t&&!i||!1!==this.props.demount||this.glowVisible||(this.glowVisible=!0,customCursor.overObject=!0,this.GLOW=svg.polygon([this.p1,this.p2,this.p3,this.p4]).attr({stroke:"red","stroke-width":2,"stroke-linecap":"round",fill:"none",opacity:.6}))),"off"===e&&"break"===plan&&(t="break_radiator"===tool&&"radiator_old"===this.props.name,i="break_electric_shield"===tool&&"electric_shield_old"===this.props.name,(t||i)&&this.glowVisible&&(this.glowVisible=!1,customCursor.overObject=!1,this.GLOW.remove()))},_.prototype.hide=function(){if(this.image.hide(),this.click_zone.hide(),this.legend.hide(),this.legend_over_floor.hide(),this.legends_socket_group)for(var e in this.legends_socket_group)this.legends_socket_group[e].hide();this.lines.hide(),this.sizes.hide()},_.prototype.hide_dimensions=function(){this.dimensions.hide()},_.prototype.hide_comment=function(){if(!0===this.props.comment.exist){let e=get_object(comments.db,this.props.comment.id);e&&e.hide()}},_.prototype.show=function(e={}){if(this.legend.hide(),this.legend_over_floor.hide(),this.legends_socket_group)for(var t in this.legends_socket_group)this.legends_socket_group[t].hide();if(this.isAvailable(!0)&&(this.legend.show(),this.legend_over_floor.show(),this.legends_socket_group))for(var i in this.legends_socket_group)this.legends_socket_group[i].show();this.image.show(),!0!==e.only_image&&(this.click_zone.show(),this.lines.show(),this.sizes.show())},_.prototype.showDimensions=function(e){this.dimensions.show()},_.prototype.showComment=function(){if(!0===this.props.comment.exist){let e=get_object(comments.db,this.props.comment.id);e&&e.show()}},_.prototype.erase=function(){this.DEMOUNT&&this.DEMOUNT.remove(),this.click_zone.remove();try{this.image.clear()}catch(e){}this.image.remove(),this.legend.remove(),this.legend_over_floor.remove();try{this.legend_over_floor.remove()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}if(this.legends_socket_group)for(var e in this.legends_socket_group)this.legends_socket_group[e].remove();this.lines.remove(),this.sizes.remove(),this.dimensions.clear()},_.prototype.delete=function(e={}){if("socket_group"===this.props.name&&this.selected_socket_group&&1<this.props.socket_group.length){if(this.findComment(),this.legends_socket_group)for(var t in this.legends_socket_group)this.legends_socket_group[t].remove();var i,n=socketsGroup.getIndexSocketById(this,this.selected_socket_group);if(LogItems.remove(this.selected_socket_group,this.props.name+" ("+this.props.socket_group[n].name+")"),this.props.socket_group[n][cabling_socket.name_object_lines])for(var s in this.props.socket_group[n][cabling_socket.name_object_lines])if(this.props.socket_group[n][cabling_socket.name_object_lines].hasOwnProperty(s)){let e=get_cable_socket(this.props.socket_group[n][cabling_socket.name_object_lines][s]);e&&e.deleteByItem(this.selected_socket_group)}if(this.props.socket_group[n].cables)for(i of Object.values(this.props.socket_group[n].cables)){let e=get_cable(i);e&&e.deleteByItem(this.selected_socket_group)}this.props.socket_group.splice(n,1),this.polygons_socket_group.splice(n,1),delete this.legends_socket_group[n],this.selected_socket_group=null,this.model.plan=socketsGroup.get_plans(this.props.socket_group),1===Object.keys(this.model.plan).length&&(this.props.plan=Object.keys(this.model.plan)[0],"light_connections"===this.props.plan?this.model.group="switches":"sockets"===this.props.plan&&(this.model.group="sockets"));try{this.image.clear()}catch(e){}return this.image.remove(),this.dimensions.clear(),this.image=socketsGroup.get_image(this.props.socket_group),this.model.width=7*(this.props.socket_group.length+1),this.model.width_changed=this.model.width,this.props.center=LIB.pointOnLine(this.props.projection,this.props.center,socketsGroup.get_max_height(this.props.socket_group)/2-get_distance(this.props.projection,this.props.center)),this.updateComment(),this.props.length=this.props.socket_group.length,this.get("points"),void this.draw()}e&&!0===e.no_delete_lines||manager_lining.item_delete(this);var e=this.model.anchor,o=this.props.id_room;this.getPolygon();for(let t=0;t<comments.db.length;t++){let e=comments.db[t];if(e.id_item&&e.id_item===this.props.id&&are_points_equal(e.s,this.props.center)){e.delete();break}if(is_point_inside_polygon(e.s,this.polygon)){e.delete();break}}this.erase(),this.dimensions.remove();var l=SVG.select(".item_x_"+this.props.id);if(0<l.members.length){for(let t=0;t<l.members.length;t++){let e=l.members[t];try{"g"===e.type&&e.clear(),e.remove()}catch(e){}}var r=0<SVG.select(".item_x_"+this.props.id).members.length?" (error)":"";send_warning_signals(signal_types[9],"Повторный erase предмета"+r+": ",this.props.id+" '"+this.props.name+"'",1,0)}let a=null;for(let e=0;e<items.db.length;e++)if(items.db[e].props.id===this.props.id){a=e;break}if(null===a?(send_warning_signals(signal_types[8],"Не найден индекс предмета при удалении: ",this.props.id+" '"+this.props.name+"'",1,0),LogItems.remove_without_index(this.props.id,this.props.name,(new Error).stack)):(items.db.splice(a,1),LogItems.remove(this.props.id,this.props.name,a)),("wall"===e||this.model.need_show_baseline)&&o){let t=get_object(rooms2.data,o);if(t&&t.border_dimensions)for(let e=0;e<t.border_dimensions.length;e++)t.border_dimensions[e].draw()}customCursor.fire("reset"),"light"===plan&&in_array(this.props.name,light_reference_lines.tools)&&items.build_dimensions()},_.prototype.copy=function(){var e=LIB.pointOnLine(this.bp,this.cp,30),e=get_point_near_line_end(this.bp,e,30,"R");let t=Object.assign({},this.props),i=(t.settings=Object.assign({},this.props.settings),t.center=copy.point(e),t.id=null,items.db.push(new _(t)),items.db[items.db.length-1]);this.paint(),i.paint("orange"),i.setLayers(),project.localSave()},_.prototype.setActive=function(){this.active=!1,this.isAvailable()&&(this.active=!0)},_.prototype.isAvailable=function(e=!1){if("break"===plan&&"radiator_old"===this.props.name)return!0;if("break"===plan&&"electric_shield_old"===this.props.name)return!0;if("santeh_furniture"===this.model.group&&("furniture"===plan||"santeh"===plan))return!0;if(this.model.plan.hasOwnProperty("santeh")&&"furniture"===plan&&in_array(this.props.name,["kitchen_sink","kitchen_sink_large","kitchen_sink_corner","sink_standalone","sink_table","washing_machine","dishwashing_machine"]))return!0;return!(!this.model.plan.hasOwnProperty(plan)&&this.props.plan!==plan)||!e&&manager_lining.is_lining_plan(this)},_.prototype.paint=function(n,s={}){if(this.image.attr({stroke:"green"}),n)this.image.attr({stroke:n});else if(this.selected=!1,this.hide(),this.hide_dimensions(),"init"!==plan&&"break"!==plan||"build"!==this.props.plan){n=this.isAvailable();if(!0===n){if(this.legend.show(),this.legend_over_floor.show(),this.legends_socket_group)for(var o in this.legends_socket_group)this.legends_socket_group[o].show();this.props.dimensions.display&&(this.dimension_front&&this.dimension_front.show(),this.dimension_side&&this.dimension_side.show()),this.show(),this.showDimensions(),manager_lining.is_lining_plan(this)&&(this.click_zone&&!0===this.click_zone.moving&&(this.click_zone.moving=!1),this.lines.clear(),this.sizes.clear())}if(!1===n){if(this.legend.hide(),this.legend_over_floor.hide(),this.legends_socket_group)for(var l in this.legends_socket_group)this.legends_socket_group[l].hide();this.dimension_front&&this.dimension_front.hide(),this.dimension_side&&this.dimension_side.hide(),this.model.plan.hasOwnProperty("init")&&(!1===this.props.demount&&(this.show(),this.hide_dimensions()),!0===this.props.demount&&("break"===plan&&(this.show(),this.hide_dimensions()),"build"!==plan&&"B"!==plan_group||(this.hide(),this.hide_dimensions()))),"stairs"===this.model.group&&("init"!==this.props.plan||in_array(plan,["walls","ceiling","isolation","plaster"])||(this.show(),this.hide_dimensions()),"build"!==this.props.plan||in_array(plan,["init","break","walls","ceiling","isolation","plaster"])||(this.show(),this.hide_dimensions())),this.model.plan.hasOwnProperty("furniture")&&visibility.furniture&&(this.show(),this.hide_dimensions()),this.model.plan.hasOwnProperty("santeh")&&(in_array(plan,["water"])||visibility.furniture)&&(this.show(),this.hide_dimensions()),this.model.plan.hasOwnProperty("radiators")&&"waterspot_node"!==this.props.name&&in_array(plan,["santeh","furniture"])&&(this.show(),this.hide_dimensions()),this.model.plan.hasOwnProperty("sockets")&&visibility.sockets&&(this.show(),this.hide_dimensions(),this.lines.clear(),this.sizes.clear()),this.model.plan.hasOwnProperty("light_connections")&&visibility.sockets&&(this.show(),this.hide_dimensions())}"init"!==plan&&"break"!==plan||"build"===this.props.plan&&this.hide(),s&&s.set_layer&&this.setLayers();let e=this.model.stroke_color,t=this.model.stroke_width,i=this.model.filling;if(n||"gas_pipe"!==this.props.name&&"heat_pipe"!==this.props.name&&(e=colors.of_shading,i="none"),!0===this.props.demount&&"break"===plan&&(e="crimson",i=hatch.crimson),n&&(e=manager_lining.item_get_stroke(this,e),t=manager_lining.item_get_stroke_width(this,t),i=manager_lining.item_get_filling(this,i),in_array(this.props.name,striping_light.track_spots)&&(e=striping_light.get_color_by_type())),"stairs"===this.model.group&&(e="#000000",i="#ffffff","build"===this.props.plan&&"build"===plan&&(e=colors.pgb)),this.image.attr({stroke:e,"stroke-width":t,fill:i}),CustomIcons.setDefaultColor(this.image,this.props.name,this),socketsGroup.setDefaultColor(this.image,this.props.name,this),e===colors.of_shading&&socketsGroup.setAttr(this.image,this.props.name,{stroke:e}),"radiator_old"===this.props.name&&(this.hide(),this.image.attr({stroke:this.model.stroke_color,"stroke-width":t,fill:this.model.filling}),!1===this.props.demount&&("A"!==plan_group&&"radiators"!==plan&&"furniture"!==plan||this.show(),"build"!==plan&&"radiators"!==plan&&"furniture"!==plan||(this.image.attr({stroke:this.model.shading_color,"stroke-width":t,fill:this.model.filling}),this.show())),!0===this.props.demount&&("init"===plan&&this.show(),"break"===plan&&(this.image.attr({stroke:colors.crimson,"stroke-width":t,fill:this.model.filling}),this.show()))),"electric_shield_old"===this.props.name&&(this.hide(),this.image.attr({stroke:this.model.stroke_color,"stroke-width":t,fill:this.model.filling}),!1===this.props.demount&&("init"!==plan&&"break"!==plan||this.show(),"build"!==plan&&"sockets"!==plan&&"cables"!==plan||("cables"!==plan&&this.image.attr({stroke:this.model.shading_color,"stroke-width":t,fill:this.model.filling}),this.show())),!0===this.props.demount&&("init"===plan&&this.show(),"break"===plan&&(this.image.attr({stroke:colors.crimson,"stroke-width":t,fill:this.model.filling}),this.show()))),0!==this.model.offset&&this.image.attr({fill:this.model.filling}),"fire_detector"===this.props.name&&(this.hide(),"init"===plan&&this.image.attr({stroke:"red","stroke-width":t,fill:i}),"break"===plan&&this.lines.clear(),"A"===plan_group&&this.show()),("electric_shield_old"===this.props.name||"radiator_old"===this.props.name)&&(this.DEMOUNT.clear(),!0===this.props.demount&&"break"===plan)){let e="big";"electric_shield_old"===this.props.name&&(e="small"),this.DEMOUNT.add(new De(this.props.center,e))}}},_.prototype.mousedown=function(i){var e,t;if($(".contextmenu").hide(),warning.hide(),selected.item=this,console.warn(tool,this.props.name,this.props.plan),this.props.plan!==plan&&("heat_pipe"===this.props.name&&warning.show("yellow",l10n.pipe_heat_availability),"gas_pipe"===this.props.name&&warning.show("yellow",l10n.pipe_gas_availability)),"delimiter"===tool)return allow.draw=!0,mode="drawing",drawing=!0,panning=!1,e=zoneDelimiter.S.edge===zoneDelimiter.E.edge,t=null===zoneDelimiter.S.room,e||t?void warning.show("yellow",l10n.delimiter_install_in_room):(null!==zoneDelimiter.S.room&&(e=LIB.point(zoneDelimiter.S.cx(),zoneDelimiter.S.cy()),zoneDelimiter.E.cx(e.x).cy(e.y).show(),zoneDelimiter.LINE.plot(e.x,e.y,e.x,e.y).show()),void(mouse.start=LIB.point(i.clientX,i.clientY,"svg")));if(in_array(tool,["ruler","moving"]))return drawing=!0,mode="drawing",void(mouse.start=LIB.point(i.clientX,i.clientY,"svg"));if("comment"===tool)return t=LIB.point(i.clientX,i.clientY,"svg"),void create_comment(t);if("eraser"!==tool||"break"!==plan||"radiator_old"!==this.props.name&&"electric_shield_old"!==this.props.name||!1!==this.props.demount){if("freeline"===tool)return mode="drawing",void freelines.create(i);if(this.isAvailable()){if(window.test_item_mousedown&&console.log(this,this.props.id,this.props.name),allow.pan=!1,project.paint(),"none"===tool||"eraser"===tool||in_array(plan,["sockets","water","cables","light_connections"])||"init"!==this.props.plan&&cursors.own.fire("create"),itemControls.fire("off"),id.item=null,this.isAvailable()&&(id.item=this.id,selectedObject="item",M={name:this.props.name,anchor:this.props.settings.anchor,group:this.props.settings.group,need_show_baseline:this.model.need_show_baseline}),1===i.which){if("break_radiator"===tool&&"radiator_old"===this.props.name&&"break"===plan)return this.props.demount=!0,this.glow("off"),this.draw(),customCursor.fire("knock"),void project.localSave();if("break_electric_shield"===tool&&"electric_shield_old"===this.props.name&&"break"===plan)return this.props.demount=!0,this.glow("off"),this.draw(),customCursor.fire("knock"),void project.localSave();if("eraser"===tool){if("break"===plan&&!0===this.props.demount)return this.props.demount=!1,this.draw(),void project.localSave();if(this.isAvailable(!0))return this.click_zone.draggable(!1),this.delete(),customCursor.fire("eraserReaction",i),void project.localSave()}if("warm_floor"===tool&&(allow.draw=!0,mouse.start=LIB.point(i.clientX,i.clientY,"svg"),ve(i)),this.isAvailable()){if(in_array(tool,manager_lining.get_all_tools())||manager_lining.is_lining_plan(this)||(items.paint(),this.select("orange"),this.selected=!0),id.item=this.props.id,"furniture"===tool_group&&cursors.own.settings.plan.hasOwnProperty(plan)&&!0===cursors.own.changed)return void warning.show("yellow",l10n.item_not_higher_other_item);if(allow.pan=!0,"wall_elements"===tool_group)return mouse.start=get_svg_point({x:i.clientX,y:i.clientY}),void svg.fire("mouseup");if("comment"===tool){this.getPolygon();for(let e=0;e<comments.db.length;e++){var n=comments.db[e];if(n.plan===plan&&is_point_inside_polygon(n.s,this.polygon))return void warning.show("yellow",l10n.item_comment_already_exist)}return id.item=this.props.id,void create_comment(this.props.center)}if(manager_lining.item_mousedown(this))return;"none"!==tool&&(deactivate_tool(),this.select("orange"))}}if(3===i.which||2===i.detail){if("build"===plan){var s=LIB.point(i.clientX,i.clientY,"svg");for(let t=0;t<pillars.db.length;t++){let e=pillars.db[t];if(is_point_inside_polygon(s,e.polygon))return void(3===i.which&&e.contextmenu(i))}}id.item=this.props.id,this.contextmenu(i)}}else"none"!==tool&&"furniture"===this.props.settings.group&&in_array(tool,manager_lining.get_all_tools())&&manager_lining.svg_mousedown()}},_.prototype.mouseover=function(e){"eraser"===tool&&"break"===plan&&("radiator_old"===this.props.name||"electric_shield_old"===this.props.name)&&!1===this.props.demount||in_array(tool,["ruler","moving","freeline"])||manager_lining.item_mouseover_check(this)||(this.glow("on"),"none"===tool&&isContextmenuHidden()&&!1===itemControls.activated&&this.isAvailable(!0)&&(this.image.attr({stroke:"orange"}),CustomIcons.setAttr(this.image,this.props.name,{stroke:"orange"}),"cables"===plan&&socketsGroup.setAttr(this.image,this.props.name,{stroke:"orange"}),manager_lining.change_size_node(this,"up")),"eraser"===tool?this.isAvailable(!0)&&(customCursor.overObject=!0,manager_lining.change_size_node(this,"up"),this.image.attr({stroke:"crimson",fill:hatch.crimson}),CustomIcons.setAttr(this.image,this.props.name,{stroke:"crimson",fill:hatch.crimson}),socketsGroup.setAttr(this.image,this.props.name,{stroke:"crimson",fill:hatch.crimson})):(!this.isAvailable()||in_array(tool,manager_lining.get_all_tools())||manager_lining.is_lining_plan(this)||($("body").css("cursor","pointer"),manager_lining.item_select(this)),manager_lining.item_mouseover(this)))},_.prototype.mouseleave=function(e){in_array(tool,["ruler","moving","freeline"])||(this.glow("off"),isContextmenuHidden()&&!1===itemControls.activated&&!this.selected&&("none"!==tool&&"eraser"!==tool||(customCursor.overObject=!1,this.paint()),this.click_zone.moving||manager_lining.change_size_node(this,"down")),$("body").css("cursor","default"),"socket_group"===this.props.name&&isContextmenuHidden()&&(this.selected_socket_group=null),manager_lining.item_mouseleave(this))},_.prototype.mouseup=function(e){1===e.which&&("warm_floor"===tool&&xe(),"none"!==tool&&"furniture"===this.props.settings.group&&in_array(tool_group,["sockets","waterspots"])&&(mode="drawing"))},_.prototype.contextmenu=function(t){if(!in_array(plan,["sockets","light_connections"])||"none"!==tool||"socket_group"!==this.props.name||this.selected_socket_group)if(items.paint(),this.isAvailable(!0)){if(this.image.attr({stroke:"orange"}),layers.upper.clear(),$(".contextmenu").hide(),z.stop.hide(),allow.pan=!1,this.select("orange"),this.selected=!0,selected.item=this,console.warn(this.props.name),this.props.delete_only&&showContextmenu("#item-contextmenu-simple",t.clientX,t.clientY,canvas.position().top),!this.props.delete_only){let e;if("stairs"===this.model.group||"furniture"===this.model.group){$("#align1").show(),$("#align2").show();var i=parseInt(this.model.width_changed),n=parseInt(this.model.height_changed),s=parseInt(this.model.self_height),o=($("#furniture_height_input_wrap").show(),$("#furniture-contextmenu [action='change']").show(),"electric_shield_old"===this.props.name&&$("#furniture-contextmenu [action='change']").hide(),$("#furniture_height_input_wrap").show(),0===s&&$("#furniture_height_input_wrap").hide(),$("#furniture_over_floor_input_wrap").show(),this.model.over_floor||$("#furniture_over_floor_input_wrap").hide(),parseInt(this.props.over_floor.value));if($(".width_input_wrap").show(),$(".depth_input_wrap").show(),this.model.show_sizes&&(!1===this.model.show_sizes.width&&$(".width_input_wrap").hide(),!1===this.model.show_sizes.height&&$(".depth_input_wrap").hide()),$("#furniture_width_input").val("").attr("placeholder",i),$("#furniture_depth_input").val("").attr("placeholder",n),$("#furniture_height_input").val("").attr("placeholder",s),$("#furniture_over_floor_input").val("").attr("placeholder",o),this.props.dimensions.display&&($("#show-dimensions").hide(),$("#hide-dimensions").show()),this.props.dimensions.display||($("#hide-dimensions").hide(),$("#show-dimensions").show()),$('#furniture-contextmenu [action="copy"]').hide(),"furniture"===this.model.group||"santeh"===this.model.group){let e=!0;(e="wall"===this.model.anchor?!1:e)&&$('#furniture-contextmenu [action="copy"]').show()}e="#furniture-contextmenu","radiators"===plan&&($("#align1").hide(),$("#align2").hide()),"sockets"===plan&&($("#align1").hide(),$("#align2").hide())}if("sockets"===this.model.group&&((this.model.plan.hasOwnProperty("sockets")||this.model.plan.hasOwnProperty("light_connections"))&&(e="#socket-contextmenu",$("#socket-over-floor").val("").attr("placeholder",this.props.over_floor.value)),this.model.plan.hasOwnProperty("warm_floor")&&(e="#socket-lc-contextmenu",$("#socket-lc-over-floor").val("").attr("placeholder",this.props.over_floor.value))),"wires"===this.model.group&&(e="#wire-contextmenu",$("#wire-over-floor").val("").attr("placeholder",this.props.over_floor.value)),"lights"===this.model.group&&($("#lights_show_dimensions").hide(),$("#lights_hide_dimensions").hide(),$("#lights_over_floor").hide(),"wall"!==this.model.anchor&&(this.props.dimensions.display&&($("#lights_show_dimensions").hide(),$("#lights_hide_dimensions").show()),this.props.dimensions.display||($("#lights_hide_dimensions").hide(),$("#lights_show_dimensions").show())),"wall"===this.model.anchor&&this.props.over_floor.value&&($("#lights_over_floor_input").val("").attr("placeholder",this.props.over_floor.value),$("#lights_over_floor").show()),e="#lights-contextmenu"),"switches"===this.model.group&&(console.log(this.props.over_floor.value),e="#switch-contextmenu",$("#switch-over-floor").val("").attr("placeholder",this.props.over_floor.value)),"waterspots"===this.model.group&&(e="#waterspots-contextmenu","waterspot_node"===this.props.name?$("#waterspots-over-floor").closest(".contextmenu_item.input").hide():$("#waterspots-over-floor").closest(".contextmenu_item.input").show(),$("#waterspots-contextmenu .contextmenu_item.unset_element").hide(),$("#waterspots-contextmenu .contextmenu_item.pointer.change_sequence").hide(),"waterspot_drainage_cold_hot"===this.props.name&&($('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_hot"]').show(),$('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_cold"]').show(),$('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_drainage"]').show(),$("#waterspots-contextmenu .contextmenu_item.pointer.change_sequence").show()),"waterspot_drainage_hot"===this.props.name&&($('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_hot"]').show(),$('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_drainage"]').show(),$("#waterspots-contextmenu .contextmenu_item.pointer.change_sequence").show()),"waterspot_drainage_cold"===this.props.name&&($('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_cold"]').show(),$('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_drainage"]').show(),$("#waterspots-contextmenu .contextmenu_item.pointer.change_sequence").show()),"waterspot_cold_hot"===this.props.name&&($('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_cold"]').show(),$('#waterspots-contextmenu .contextmenu_item.pointer.unset_element[action="waterspot_hot"]').show(),$("#waterspots-contextmenu .contextmenu_item.pointer.change_sequence").show()),$("#waterspots-over-floor").val("").attr("placeholder",this.props.over_floor.value)),in_array(this.props.name,["waterspot_node","electrospot_node"])&&(e="#item_delete_only-contextmenu",$('#tree_node-contextmenu .contextmenu_item.pointer[action="union_line"]').hide(),manager_lining.is_allow_union_line(this.props.id)&&(e="#tree_node-contextmenu",$('#tree_node-contextmenu .contextmenu_item.pointer[action="union_line"]').show())),$("#furniture_contextmenu_custom_options span").remove(),$("#furniture_contextmenu_custom_options div").remove(),!1!==this.model.custom_options){let e=this.model.custom_options;for(var l in e)if(e[l].hasOwnProperty("options")){var r,a=e[l].name;for(r in $("#furniture_contextmenu_custom_options").append('<div class="contextmenu_item textinput" id=""><span>'+e[l].title+'</span><div class="contextmenu_item_input"><select name="" id="'+a+'"></select></div></div>'),e[l].options){var h=e[l].options[r].title,g=e[l].options[r].value;this.props[a]&&g===this.props[a].value?$("#"+a).append(new Option(h,g,!0,!0)):$("#"+a).append(new Option(h,g))}}}if(!1!==this.model.custom_options){let e=this.model.custom_options;for(var _ in e){var d;e[_].hasOwnProperty("options")||(d=e[_].name,e[_].value,this.props[d]&&this.props[d].value,$("#furniture_contextmenu_custom_options").append('<div class="contextmenu_item input"><span>'+e[_].title+'</span><div class="contextmenu_item_input"><input id="'+e[_].name+'" type="text" maxlength="5" placeholder="'+this.props[d].value+'" /><span>ОК</span><em>см</em></div></div>'))}}showContextmenu(e,t.clientX,t.clientY,canvas.position().top)}}else this.model.plan.hasOwnProperty("init")||"break"===plan?!0===this.props.demount&&(selected.item=this,showContextmenu("#item_contextmenu_v2",t.clientX,t.clientY,canvas.position().top),allow.pan=!1):warning.show("yellow",l10n.item_not_allow_on_plan)},window.Item=_,$('#furniture-contextmenu [action="scale_x"]').on("click",function(){let e=get_item();e.props.scale_x&&e.props.scale_y?(e.props.scale_x=-e.props.scale_x,e.props.scale_y=e.props.scale_y):(e.props.scale_x=-1,e.props.scale_y=1),e.draw(),project.localSave()}),$('#furniture-contextmenu [action="scale_y"]').on("click",function(){let e=get_item();e.props.scale_x&&e.props.scale_y?(e.props.scale_x=e.props.scale_x,e.props.scale_y=-e.props.scale_y):(e.props.scale_x=1,e.props.scale_y=-1),e.draw(),project.localSave()}),$('#furniture-contextmenu [action="change"]').on("click",function(){hide2.contextmenu(),layers.upper.clear(),selected.item&&itemControls.fire("on",selected.item)}),$("#show-dimensions").on("click",function(){$("#show-dimensions").hide(),$("#hide-dimensions").show();let e=get_item();e.props.dimensions.display=!0,e.draw(),project.localSave()}),$("#hide-dimensions").on("click",function(){$("#hide-dimensions").hide(),$("#show-dimensions").show();let e=get_item();e.props.dimensions.display=!1,e.draw(),project.localSave()}),$("#lights_show_dimensions").on("click",function(){$("#lights_show_dimensions").hide(),$("#lights_hide_dimensions").show();let e=get_item();e.props.dimensions.display=!0,e.draw(),project.localSave()}),$("#lights_hide_dimensions").on("click",function(){$("#lights_hide_dimensions").hide(),$("#lights_show_dimensions").show();let e=get_item();e.props.dimensions.display=!1,e.draw(),project.localSave()}),window.Comment=function(e){this.s=e.s,this.center=e.center,this.text=e.text,this.label=e.label,this.plan=e.plan,e.id?this.id=e.id:this.id=LIB.id(),this.id_item=e.id_item,this.name_item=e.name_item,this.color=e.color||"#000000";let t=this;this.line=layers.comments.line().attr({stroke:"#000000","stroke-width":.4}),!LIB.isObjectEmpty(this.s)&&LIB.isPoint(this.s)&&(this.circle=layers.comments.circle(3).cx(this.s.x).cy(this.s.y).attr({stroke:"#000000","stroke-width":1.4,fill:"#f4f4f4"})),this.image=layers.comments.group().draggable().on("mouseover",function(e){"eraser"===tool&&(customCursor.overObject=!0)}).on("mouseleave",function(e){"eraser"===tool&&(customCursor.overObject=!1)}).on("mousedown",function(e){if(id.comment=t.id,selectedObject="comment",1===e.detail){if("eraser"===tool)return void t.delete();3===e.which&&t.contextmenu(e)}2===e.detail&&t.contextmenu(e)}).on("dragstart",function(){"eraser"!==tool&&ze()}).on("dragmove",function(e){e.preventDefault();e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY);get_distance(t.s,e)<200&&(t.center=e,t.draw())}).on("dragend",function(e){project.localSave()}),this.bubble=this.image.rect().attr({stroke:this.color,"stroke-width":.6,fill:"#ffffff",cursor:"pointer"}),this.legend=this.image.plain("").font({family:"Arial",size:10,stroke:this.color,"stroke-width":.3,fill:this.color,cursor:"pointer"}),this.draw()},Comment.prototype.draw__=function(){var e=this.legend.bbox();0!==e.w&&(this.bubbleWidth=e.w),0!==e.h&&(this.bubbleHeight=e.h),console.warn(e.w,e.h),this.center||(this.center={x:this.s.x+50+e.w/2,y:this.s.y-50+e.h/2}),LIB.isObjectEmpty(this.s)||this.circle.cx(this.s.x).cy(this.s.y),this.line.plot(this.s.x,this.s.y,this.center.x,this.center.y),this.bubble.width(this.bubbleWidth+16).height(this.bubbleHeight+8),this.x_min=this.center.x-e.w/2-8,this.x_max=this.center.x+e.w/2+8,this.y_min=this.center.y-e.h/2-4,this.y_max=this.center.y+e.h/2+4,this.bubble.cx(this.center.x).cy(this.center.y),this.legend.cx(this.center.x).cy(this.center.y)},Comment.prototype.draw=function(){this.legend.text(this.text);var e=this.legend.bbox();0!==e.w&&(this.bubbleWidth=e.w),0!==e.h&&(this.bubbleHeight=e.h),this.center||(this.center={x:this.s.x+50+e.w/2,y:this.s.y-50+e.h/2}),!LIB.isObjectEmpty(this.s)&&LIB.isPoint(this.s)&&this.circle.cx(this.s.x).cy(this.s.y),this.line.plot(this.s.x,this.s.y,this.center.x,this.center.y),this.bubble.width(this.bubbleWidth+16).height(this.bubbleHeight+8).cx(this.center.x).cy(this.center.y),this.legend.center(this.center.x,this.center.y),this.x_min=this.center.x-e.w/2-8,this.x_max=this.center.x+e.w/2+8,this.y_min=this.center.y-e.h/2-4,this.y_max=this.center.y+e.h/2+4},Comment.prototype.show=function(){this.circle&&this.circle.show(),this.line.show(),this.bubble.show(),this.legend.show(),this.image.show()},Comment.prototype.hide=function(){this.circle&&this.circle.hide(),this.line.hide(),this.bubble.hide(),this.legend.hide(),this.image.hide()},Comment.prototype.erase=function(){this.circle&&this.circle.remove(),this.line.remove(),this.bubble.remove(),this.legend.remove(),this.image.remove()},Comment.prototype.delete=function(e){for(let t=0;t<items.db.length;t++){let e=items.db[t];this.id===e.props.comment.id&&(e.props.comment={exist:!1,id:"",removed:!0})}this.erase();var t=objectIndexById(comments.db,this.id);void 0!==t&&comments.db.splice(t,1),customCursor.fire("reset")},Comment.prototype.contextmenu=function(e){$(".contextmenu").hide(),allow.pan=!1,selected.comment=objectIndexById(comments.db,this.id);var t=comments.db[selected.comment];t&&(showContextmenu("#comment_contextmenu",e.clientX,e.clientY,canvas.position().top),$("#comment_input").val(t.text).focus(),open_color_wrapper("#comment_contextmenu",t.color))},Comment.prototype.setColor=function(e){this.color=e,this.bubble.attr({stroke:this.color}),this.legend.attr({stroke:this.color,fill:this.color})},U.prototype.draw=function(){if(this.e.x<this.s.x+10&&this.e.x>this.s.x-10&&(this.e.x=this.s.x),this.e.y<this.s.y+10&&this.e.y>this.s.y-10&&(this.e.y=this.s.y),this.l1=get_point_near_line_end(this.e,this.s,5,"R"),this.l2=get_point_near_line_end(this.s,this.e,5,"L"),this.r1=get_point_near_line_end(this.e,this.s,5,"L"),this.r2=get_point_near_line_end(this.s,this.e,5,"R"),is_point_exists(this.l1)){let e=get_distance(this.s,this.e).toFixed(0);var n=get_center(this.s,this.e),s={s:point_near_line_end(this.e,this.s,3,"L"),e:point_near_line_end(this.e,this.s,3,"R")},o={s:point_near_line_end(this.s,this.e,3,"L"),e:point_near_line_end(this.s,this.e,3,"R")};this.m_line.plot(this.s.x,this.s.y,this.e.x,this.e.y),this.m_line_bg.plot([this.l1,this.l2,this.r2,this.r1]),this.l_line.plot(s.s.x,s.s.y,s.e.x,s.e.y),this.r_line.plot(o.s.x,o.s.y,o.e.x,o.e.y),this.l_dash.untransform(),this.l_dash.plot(s.s.x,s.s.y,s.e.x,s.e.y).rotate(45),this.r_dash.untransform(),this.r_dash.plot(o.s.x,o.s.y,o.e.x,o.e.y).rotate(45),this.background.cx(n.x).cy(n.y);let t=8,i=.4;"big"===project.font&&(t=12,i=.6),this.text.plain(e.toString()).cx(n.x).cy(n.y).font({size:t,"stroke-width":i}),this.IMAGE.clear(),this.IMAGE.add(this.m_line),this.IMAGE.add(this.m_line_bg),this.IMAGE.add(this.l_line),this.IMAGE.add(this.r_line),this.IMAGE.add(this.r_dash),this.IMAGE.add(this.l_dash),this.IMAGE.add(this.background),this.IMAGE.add(this.text)}},U.prototype.show=function(){this.IMAGE.show()},U.prototype.hide=function(){this.IMAGE.hide()},U.prototype.erase=function(){this.IMAGE.clear()},U.prototype.delete=function(){this.erase();var e=objectIndexById(rulers.db,this.id);void 0!==e&&rulers.db.splice(e,1),customCursor.fire("reset")},U.prototype.showContextmenu=function(e){$(".contextmenu").hide(),allow.pan=!1,showContextmenu("#ruler_contextmenu",e.clientX,e.clientY,canvas.position().top)},$('#ruler_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu(),console.warn(id.ruler);let e=get_object(rulers.db,id.ruler);e&&(e.delete(),project.localSave())}),$("#rulers").on("mousedown",function(e){ze(),customCursor.fire("off"),$("body").css("cursor","crosshair"),tool="ruler"});let J=function(e){this.id=LIB.id(),this.plan=e.plan,this.s=e.s,this.e=e.e,this.center=e.center,this.s_wall=e.s_wall,this.e_wall=e.e_wall;let t=this;this.IMAGE=layers.questions.group().on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.bind(),this.update()},K=(J.prototype.bind=function(){for(let e=0;e<walls.db.length;e++){var t=walls.db[e];is_point_on_straight(this.center,t.axis)&&(are_points_equal(this.s,t.s)&&(this.s_wall={id:t.id,end:"s"}),are_points_equal(this.s,t.e)&&(this.s_wall={id:t.id,end:"e"}),are_points_equal(this.e,t.s)&&(this.e_wall={id:t.id,end:"s"}),are_points_equal(this.e,t.e)&&(this.e_wall={id:t.id,end:"e"}))}},J.prototype.erase=function(){this.IMAGE.clear()},J.prototype.update=function(){this.IMAGE.clear(),this.IMAGE.add(svg.circle(24).attr({stroke:"#dc143c","stroke-width":.2,fill:"#ffedf2"}).cx(this.center.x).cy(this.center.y)),this.IMAGE.add(svg.plain("?").font({family:"Arial",size:14,stroke:"#dc143c","stroke-width":.4,fill:"#dc143c"}).cx(this.center.x).cy(this.center.y))},J.prototype.delete=function(){this.erase();var e=objectIndexById(questions.db,this.id);void 0!==e&&questions.db.splice(e,1)},J.prototype.mouseover=function(e){$("body").css("cursor","pointer")},J.prototype.mouseleave=function(e){$("body").css("cursor","default")},J.prototype.mousedown=function(e){hide2.contextmenu(),selected.question=this,1===e.which&&showContextmenu("#question_contextmenu",e.clientX,e.clientY,canvas.position().top),3!==e.which&&2!==e.detail||showContextmenu("#question_contextmenu",e.clientX,e.clientY,canvas.position().top)},$('#question_contextmenu [action="door"]').on("click",function(){hide2.contextmenu();let e=selected.question;var t=get_wall_index(e.s_wall.id),i=get_wall_index(e.e_wall.id);let n=walls.db[t],s=walls.db[i],o,l,r,a=!1;"s"===e.s_wall.end&&(o=copy_point(n.s)),"e"===e.s_wall.end&&(o=copy_point(n.e)),"s"===e.e_wall.end&&(l=copy_point(s.s)),"e"===e.e_wall.end&&(l=copy_point(s.e)),r=get_center(o,l),"s"===e.s_wall.end&&(n.s=r,n.draw()),"e"===e.s_wall.end&&(n.e=r,n.draw()),"s"===e.e_wall.end&&(s.s=r,s.draw()),"e"===e.e_wall.end&&(s.e=r,s.draw()),"s"===e.s_wall.end&&"s"===e.e_wall.end&&(n.s=copy.point(s.e),a=!0),"e"===e.s_wall.end&&"s"===e.e_wall.end&&(n.e=copy.point(s.e),a=!0),"s"===e.s_wall.end&&"e"===e.e_wall.end&&(n.s=copy.point(s.s),a=!0),"e"===e.s_wall.end&&"e"===e.e_wall.end&&(n.e=copy.point(s.s),a=!0),a&&(e.delete(),s.delete(),walls.calc(),0<(t=get_distance(o,l))&&t<=90&&doors.db.push(new w({id_wall:n.id,center:r,width:t,type:"single",plan:plan})),90<t&&t<=120&&doors.db.push(new w({id_wall:n.id,center:r,width:t,type:"double",plan:plan})),n.init(),project.localSave()),pillars.draw(),walls.draw(),create_rooms(),project.localSave()}),$('#question_contextmenu [action="doorway"]').on("click",function(){hide2.contextmenu();let e=selected.question;var t=get_wall_index(e.s_wall.id),i=get_wall_index(e.e_wall.id);let n=walls.db[t],s=walls.db[i],o,l,r,a=!1;"s"===e.s_wall.end&&(o=copy_point(n.s)),"e"===e.s_wall.end&&(o=copy_point(n.e)),"s"===e.e_wall.end&&(l=copy_point(s.s)),"e"===e.e_wall.end&&(l=copy_point(s.e)),r=get_center(o,l),"s"===e.s_wall.end&&(n.s=r,n.draw()),"e"===e.s_wall.end&&(n.e=r,n.draw()),"s"===e.e_wall.end&&(s.s=r,s.draw()),"e"===e.e_wall.end&&(s.e=r,s.draw()),"s"===e.s_wall.end&&"s"===e.e_wall.end&&(n.s=copy.point(s.e),a=!0),"e"===e.s_wall.end&&"s"===e.e_wall.end&&(n.e=copy.point(s.e),a=!0),"s"===e.s_wall.end&&"e"===e.e_wall.end&&(n.s=copy.point(s.s),a=!0),"e"===e.s_wall.end&&"e"===e.e_wall.end&&(n.e=copy.point(s.s),a=!0),a&&(e.delete(),s.delete(),walls.calc(),doors.db.push(new w({id_wall:n.id,type:"doorway",center:r,width:get_distance(o,l),plan:plan})),n.init(),project.localSave(),console.log(doors.db[doors.db.length-1])),pillars.draw(),walls.draw(),create_rooms(),project.localSave()}),$('#question_contextmenu [action="window"]').on("click",function(){let e=selected.question;var t=get_wall_index(e.s_wall.id),i=get_wall_index(e.e_wall.id);let n=walls.db[t],s=walls.db[i],o,l,r,a=!1;"s"===e.s_wall.end&&(o=copy_point(n.s)),"e"===e.s_wall.end&&(o=copy_point(n.e)),"s"===e.e_wall.end&&(l=copy_point(s.s)),"e"===e.e_wall.end&&(l=copy_point(s.e)),r=get_center(o,l),"s"===e.s_wall.end&&(n.s=r,n.draw()),"e"===e.s_wall.end&&(n.e=r,n.draw()),"s"===e.e_wall.end&&(s.s=r,s.draw()),"e"===e.e_wall.end&&(s.e=r,s.draw()),"s"===e.s_wall.end&&"s"===e.e_wall.end&&(n.s=copy.point(s.e),a=!0),"e"===e.s_wall.end&&"s"===e.e_wall.end&&(n.e=copy.point(s.e),a=!0),"s"===e.s_wall.end&&"e"===e.e_wall.end&&(n.s=copy.point(s.s),a=!0),"e"===e.s_wall.end&&"e"===e.e_wall.end&&(n.e=copy.point(s.s),a=!0),a&&(e.delete(),s.delete(),walls.calc(),windows.db.push(new u({id_wall:n.id,type:"window",center:r,width:get_distance(o,l),opening:"R",label:plan,plan:plan})),project.draw(),project.localSave()),hide2.contextmenu(),pillars.draw(),walls.draw(),create_rooms(),project.localSave()}),$('#question_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=selected.question;e.delete(),project.localSave()}),{});function Ye(e){let t=this;return this.pc=e.pc,this.ps=e.ps,this.pe=e.pe,this.id_door=e.id_door,this.IMAGE=layers.doors.group().on("mousedown",function(e){t.contextmenu(e)}),this.IMAGE.circle(24).attr({stroke:"#dc143c","stroke-width":.2,fill:"#ffedf2"}).cx(this.pc.x).cy(this.pc.y),this.IMAGE.plain("?").font({family:"Arial",size:14,stroke:"#dc143c","stroke-width":.4,fill:"#dc143c"}).cx(this.pc.x).cy(this.pc.y),this.IMAGE}Ye.prototype.contextmenu=function(e){hide2.contextmenu(),K.pc=this.pc,K.ps=this.ps,K.pe=this.pe,id.door=this.id_door,showContextmenu("#door_question_contextmenu",e.clientX,e.clientY,canvas.position().top)},$('#door_question_contextmenu [action="door"]').on("click",function(){hide2.contextmenu();let t=get_object(doors.db,id.door);if(t){t.props.destroyed=!0,draw.doors_questions(),doors.db.push(new w({center:K.pc,width:get_distance(K.ps,K.pe),type:"single",plan:plan}));var i=doors.db[doors.db.length-1];let e=get_object(walls.db,i.id_wall);e.init(),project.localSave()}}),$('#door_question_contextmenu [action="doorway"]').on("click",function(){hide2.contextmenu();let e=get_object(doors.db,id.door);e&&(e.props.destroyed=!0,draw.doors_questions(),doors.db.push(new w({center:K.pc,width:get_distance(K.ps,K.pe),type:"doorway",plan:plan})),project.localSave())}),$('#door_question_contextmenu [action="wall"]').on("click",function(){hide2.contextmenu();let t=get_object(doors.db,id.door);if(t){let e=get_object(walls.db,t.id_wall);e&&(t.props.destroyed=!0,draw.doors_questions(),walls.db.push(new j({s:K.ps,e:K.pe,depth:e.depth,outer_depth:e.outer_depth,inner_depth:e.inner_depth,label:plan,role:"wall",patch:!0,material:"pgb"})),e.init(),project.draw(),project.localSave())}}),$('#door_question_contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=get_object(doors.db,id.door);e&&(e.props.destroyed=!0,draw.doors_questions(),project.localSave())}),window.handlines={db:[],delete:function(){for(let e=0;e<handlines.db.length;e++)handlines.db[e].delete(),e--}};let V=function(e){this.s=e.s,this.e=e.e,this.label=e.label,this.id=LIB.id();let t,i=("wall"===this.label&&(t="#dc143c"),"balcony"===this.label&&(t="#006400"),"window"===this.label&&(t="blue"),"doorway"===this.label&&(t="#9ACD32"),"door"===this.label&&(t="grey"),this.image=svg.group(),this.line=this.image.line().attr({stroke:t,"stroke-width":2}),this.s_circle=this.image.circle(3).attr({"stroke-width":0,fill:t}),this.e_circle=this.image.circle(3).attr({"stroke-width":0,fill:t}),this);this.background=this.image.polygon().attr({stroke:"transparent","stroke-width":0,fill:"transparent"}).on("mouseover",function(e){}).on("mouseleave",function(e){}).on("contextmenu",function(e){i.contextmenu(e)})},n=(V.prototype.draw=function(){this.line.plot(this.s.x,this.s.y,this.e.x,this.e.y),this.s_circle.cx(this.s.x).cy(this.s.y),this.e_circle.cx(this.e.x).cy(this.e.y),this.l1=get_point_near_line_end(this.e,this.s,5,"R"),this.l2=get_point_near_line_end(this.s,this.e,5,"L"),this.r1=get_point_near_line_end(this.e,this.s,5,"L"),this.r2=get_point_near_line_end(this.s,this.e,5,"R"),isNaN(this.l1.x)||isNaN(this.l1.y)||isNaN(this.r1.x)||isNaN(this.r2.y)||isNaN(this.l2.x)||isNaN(this.l2.y)||isNaN(this.r2.x)||isNaN(this.r2.y)||this.background.plot([this.l1,this.l2,this.r2,this.r1])},V.prototype.erase=function(){this.image.clear()},V.prototype.delete=function(){var e=objectIndexById(handlines.db,this.id);this.erase(),void 0!==e&&handlines.db.splice(e,1)},V.prototype.contextmenu=function(e){$(".contextmenu").hide(),allow.pan=!1,selected.handline=objectIndexById(handlines.db,this.id),showContextmenu("#handline-contextmenu",e.clientX,e.clientY,canvas.position().top)},$('#handline-contextmenu [action="delete"]').on("click",function(){hide2.contextmenu();let e=handlines.db[selected.handline];e.delete(),tool=tool_save,$("body").css("cursor","crosshair")}),window.freelines={db:[],default_color:"#148515",create:function(e){mouse.start=LIB.point(e.clientX,e.clientY,"svg"),this.add_new_line()},add_new_line:function(){this.temp_color=this.default_color;for(let e=0;e<freelines.db.length;e++){var t=freelines.db[e];t.plan===plan&&(get_distance(mouse.start,t.s)<4?(mouse.start=copy.point(t.s),this.temp_color=t.color):get_distance(mouse.start,t.e)<4&&(mouse.start=copy.point(t.e),this.temp_color=t.color))}var e={plan:plan,s:copy.point(mouse.start),e:copy.point(mouse.end),color:this.temp_color};freelines.db.push(new n(e)),S.freeline=freelines.db[freelines.db.length-1]},copy:function(){let t=[];for(let e=0;e<freelines.db.length;e++){var i=freelines.db[e];t[e]={plan:i.plan,id:i.id,s:i.s,e:i.e,color:i.color||this.default_color}}return t},update:function(){for(let t=0;t<freelines.db.length;t++){let e=freelines.db[t];e.update(),e.plan===plan&&e.show(),e.plan!==plan&&e.hide()}},paint:function(){for(let t=0;t<freelines.db.length;t++){let e=freelines.db[t];e.paint()}},clear:function(){for(let t=0;t<freelines.db.length;t++){let e=freelines.db[t];e.clear()}},restore:function(t){freelines.db=[];for(let e=0;e<t.length;e++)freelines.db.push(new n(t[e]))},remove:function(){for(let t=0;t<freelines.db.length;t++){let e=freelines.db[t];e.remove(),t--}}},function(e){let t=this;e.id?this.id=e.id:this.id=LIB.id(),this.plan=e.plan,this.s=e.s,this.e=e.e,this.color=e.color||freelines.default_color,this.LINE=layers.freelines.line().attr({stroke:this.color,"stroke-width":1.4,"stroke-linecap":"round"}),this.CLICK_ZONE=layers.freelines.polygon().attr({stroke:"transparent","stroke-width":0,fill:"transparent"}).on("mouseover",function(e){t.mouseover(e)}).on("mouseleave",function(e){t.mouseleave(e)}).on("mousedown",function(e){t.mousedown(e)}),this.update()});function Te(e){let t;var i=parseInt($("#move-value").html());"s"===arrow.point_type&&(t=walls.db[arrow.wall].s),"e"===arrow.point_type&&(t=walls.db[arrow.wall].e),"top"===e&&(t.y-=i),"bottom"===e&&(t.y+=i),"left"===e&&(t.x-=i),"right"===e&&(t.x+=i),arrow.update()}n.prototype.update=function(){this.LINE.plot(this.s.x,this.s.y,this.e.x,this.e.y);var e=get_point_near_line_end(this.e,this.s,5,"R"),t=get_point_near_line_end(this.s,this.e,5,"L"),i=get_point_near_line_end(this.e,this.s,5,"L"),n=get_point_near_line_end(this.s,this.e,5,"R");is_point_exists(e)&&is_point_exists(t)&&is_point_exists(i)&&is_point_exists(n)&&this.CLICK_ZONE.plot([e,t,n,i])},n.prototype.show=function(){this.CLICK_ZONE.show(),this.LINE.show()},n.prototype.hide=function(){this.CLICK_ZONE.hide(),this.LINE.hide()},n.prototype.clear=function(){this.CLICK_ZONE.remove(),this.LINE.remove()},n.prototype.remove=function(){for(let e=0;e<freelines.db.length;e++)if(freelines.db[e].id===this.id){this.CLICK_ZONE.remove(),this.LINE.remove(),freelines.db.splice(e,1);break}},n.prototype.paint=function(e){e=e||this.color,this.LINE.attr({stroke:e,"stroke-width":1.4,"stroke-linecap":"round"})},n.prototype.mouseover=function(e){isContextmenuHidden()&&("none"===tool&&(this.paint("orange"),selected.freeline=this),"eraser"===tool&&(this.paint("crimson"),customCursor.overObject=!0))},n.prototype.mouseleave=function(e){isContextmenuHidden()&&(customCursor.overObject=!1,selected.freeline=!1,this.paint())},n.prototype.mousedown=function(e){1===e.which&&this.plan===plan&&"eraser"===tool&&(customCursor.fire("eraserReaction",e),this.remove()),3!==e.which&&2!==e.detail||this.plan===plan&&($(".contextmenu").hide(),allow.pan=!1,selected.freeline=this,showContextmenu("#freeline-contextmenu",e.clientX,e.clientY,canvas.position().top),this.paint("orange"),open_color_wrapper("#freeline-contextmenu",this.color))},n.prototype.setColor=function(i){this.lines=[this.id],this.collectJoinLines(this);for(let t=0;t<this.lines.length;t++){let e=get_freeline(this.lines[t]);e.color=i,e.LINE.attr({stroke:e.color})}delete this.lines},n.prototype.collectJoinLines=function(t){for(let e=0;e<freelines.db.length;e++){var i=freelines.db[e];in_array(i.id,this.lines)||i.plan===plan&&(are_points_equal(t.s,i.s)&&(this.lines.push(i.id),this.collectJoinLines(i)),are_points_equal(t.s,i.e)&&(this.lines.push(i.id),this.collectJoinLines(i)),are_points_equal(t.e,i.e)&&(this.lines.push(i.id),this.collectJoinLines(i)),are_points_equal(t.e,i.s)&&(this.lines.push(i.id),this.collectJoinLines(i)))}},$('#freeline-contextmenu [action="delete"]').on("click",function(){hide2.contextmenu(),selected.freeline&&(selected.freeline.remove(),project.localSave())}),arrow={wall:null,point_type:null,image:svg.path().attr({fill:"#dc143c"}).hide(),update:function(){let e,t;"s"===this.point_type&&(e=walls.db[this.wall].e,t=walls.db[this.wall].s),"e"===this.point_type&&(e=walls.db[this.wall].s,t=walls.db[this.wall].e);var i=LIB.pointOnLine(e,t,-6),n=LIB.pointOnLine(e,t,8),s=point_near_line_end_point(e,i,4,"R"),o=LIB.pointOnLine(e,t,-4),i=point_near_line_end_point(e,i,4,"L");this.image.plot("M"+n.x+","+n.y+" L"+s.x+","+s.y+" L"+o.x+","+o.y+" L"+i.x+","+i.y+" Z")},show:function(){this.image.show()},hide:function(){this.image.hide()}},$("#move-value1").on("click",function(){$("#move-value").html(1)}),$("#move-value2").on("click",function(){$("#move-value").html(10)}),$("#move-value3").on("click",function(){$("#move-value").html(100)}),$("#move-value4").on("click",function(){$("#move-value").html(1e3)}),$("#move-top").on("click",function(){Te("top"),project.draw()}),$("#move-bottom").on("click",function(){Te("bottom"),project.draw()}),$("#move-left").on("click",function(){Te("left"),project.draw()}),$("#move-right").on("click",function(){Te("right"),project.draw()}),project.load("server"),a_line.fire("init"),zoneDelimiter.fire("on");function He(e,t,i){let n=svg.group().draggable();return n.circle(20).cx(e.x).cy(e.y).attr({stroke:"#000000","stroke-width":.4,fill:i}),n.plain(t).attr({x:e.x,y:e.y}).font({size:12,family:"Helvetica","stroke-width":.6,fill:"#000000",anchor:"middle","dominant-baseline":"central"}),n}let a=svg.group(),h=($("#test_walls1").on("click",function(e){console.log("test =========================================="),a.clear();for(let t=0;t<walls.db.length;t++){var i=walls.db[t];let e;"init_copy"===i.label&&(e="#fcf8e3"),"init"===i.label&&(e="#e8e8e8"),"build"===i.label&&(e="#a2bbfd"),"break"===i.label&&(e="pink");var n=get_center(i.s,i.e),n=(He(n,t,e),LIB.pointOnLine(i.e,i.s,-10)),s=LIB.pointOnLine(i.s,i.e,-10);a.plain("S").attr({x:n.x,y:n.y}).font({size:10,family:"Helvetica",stroke:"#dc143c","stroke-width":.8,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"}),a.plain("E").attr({x:s.x,y:s.y}).font({size:10,family:"Helvetica",stroke:"#dc143c","stroke-width":.8,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"}),console.log(t,i.id,i.label,"IR",i.inside_room,i)}console.log("test done =====================================")}),$("#test_walls2").on("click",function(e){console.warn(walls.db);for(let e=0;e<walls.db.length;e++){var t=walls.db[e];svg.circle(3).cx(t.s.x).cy(t.s.y).attr({stroke:"red","stroke-width":1,fill:"red"}),svg.circle(3).cx(t.s.x).cy(t.s.y).attr({stroke:"red","stroke-width":1,fill:"red"}),svg.circle(3).cx(t.e.x).cy(t.e.y).attr({stroke:"red","stroke-width":1,fill:"red"}),svg.line(t.s.x,t.s.y,t.e.x,t.e.y).attr({stroke:"red","stroke-width":.4})}}),$("#test_pillars").on("click",function(e){console.log("test ==========================================");for(let e=0;e<pillars.db.length;e++){var t=pillars.db[e];layers.temp_images.add(new He(t.center,e,"pink")),console.log(e,t.id,t)}console.log("test done =====================================")}),$("#test_doors").on("click",function(e){console.log("=== Doors test ========"),a.clear();for(let t=0;t<doors.db.length;t++){var i=doors.db[t];let e;"init"===i.plan&&(e="#e8e8e8"),"build"===i.plan&&(e="#a2bbfd");var n=get_center(i.s,i.e);a.circle(20).draggable().cx(n.x).cy(n.y).attr({stroke:"#000000","stroke-width":.4,fill:e}),a.plain(t).attr({x:n.x,y:n.y}).font({size:12,family:"Helvetica","stroke-width":.6,fill:"#000000",anchor:"middle","dominant-baseline":"central"}),console.log(t,i.id,i.plan)}console.log("doors.db",doors.db),console.log("=== Doors test done ===")}),$("#test_windows").on("click",function(e){console.log("=== Windows test ==="),a.clear();for(let e=0;e<windows.db.length;e++){var t=windows.db[e],i=get_center(t.s,t.e);a.circle(20).cx(i.x).cy(i.y).attr({stroke:"#000000","stroke-width":.4,fill:"#a2bbfd"}),a.plain(e).attr({x:i.x,y:i.y}).font({size:12,family:"Helvetica","stroke-width":.6,fill:"#000000",anchor:"middle","dominant-baseline":"central"}),console.log(e,t.id,t.plan),a.plain("S").attr({x:t.s.x,y:t.s.y}).font({size:10,family:"Helvetica",stroke:"#dc143c","stroke-width":.8,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"}),a.plain("E").attr({x:t.e.x,y:t.e.y}).font({size:10,family:"Helvetica",stroke:"#dc143c","stroke-width":.8,fill:"#dc143c",anchor:"middle","dominant-baseline":"central"})}console.log("windows.db",windows.db),console.log("=== Windows test done ===")}),$("#test_rooms_1").on("click",function(){let n=svg.group();console.warn("rooms1.data.length:",rooms1.data.length);for(let e=0;e<rooms1.data.length;e++)console.log("Room1 #",e);for(let i=1;i<rooms1.data.length+1;i++)setTimeout(function(){n.clear();for(let e=0;e<rooms1.data[i-1].edges.length;e++){rooms1.data[i-1].image.fill("#fcf8e3");var t=rooms1.data[i-1].edges[e];n.add(svg.line(t.s.x,t.s.y,t.e.x,t.e.y).attr({stroke:"red","stroke-width":3}))}i===rooms1.data.length&&setTimeout(function(){n.clear()},1e3)},1e3*i)}),$("#test_rooms_2").on("click",function(){let n=svg.group();console.warn("rooms2.data.length:",rooms2.data.length);for(let i=1;i<rooms2.data.length+1;i++)setTimeout(function(){n.clear();for(let e=0;e<rooms2.data[i-1].edges.length;e++){rooms2.data[i-1].image.fill("#fcf8e3");var t=rooms2.data[i-1].edges[e];n.add(svg.line(t.s.x,t.s.y,t.e.x,t.e.y).attr({stroke:"red","stroke-width":3}))}i===rooms2.data.length&&setTimeout(function(){n.clear()},1e3)},1e3*i)}),$("#test_items").on("click",function(){console.log("test ==========================================");for(let e=0;e<items.db.length;e++){var t=items.db[e];He(t.props.center,e,"#a2bbfd"),console.warn(e,t.props.name,t.props.center,t.props.bp)}console.log(items.db),console.log("test done =====================================")}),$("#test-warm-floors").on("click",function(){let t=0;for(let e=1;e<rooms2.data.length;e++){var i=rooms2.data[e];t+=i.warm_floors.length}console.warn("Количество теплых полов:",t)}),$("#find_class").on("click",function(){var e=SVG.get("PPP");console.warn(e)}),-1),g=-1,Ue=svg.polygon().attr({stroke:"red","stroke-width":3,fill:"#fcf8e3"}).hide();function Je(t=!1){try{if(!copy_this)return void(t&&alert("Нет данных распознавания для отправки"));void 0!==window.__debugP&&(copy_this.errors=window.__debugP.outputErrors(),copy_this.logs=window.__debugP.outputLogs()),$.ajax({type:"POST",url:"https://engineer.jelastic.regruhosting.ru/spec_09122019.php",data:{plan:JSON.stringify(copy_this)},success:function(e){t&&(e=+e,!isNaN(parseFloat(e))&&isFinite(e)&&0<e?setTimeout(function(){alert("Данные текущего распознавания отправлены Дмитрию для анализа. Номер "+e+".")},250):alert("Неудача, повторите попытку"))},failure:function(e){}})}catch(e){send_error_js(e.name,e.message,e.stack)}}function Ke(t){plan="init",project.delete();for(let e=0;e<t.length;e++)"pillar"===t[e].label&&pillars.db.push(new H({role:"pillar",center:t[e].center,width:t[e].width,height:t[e].depth}));for(let e=0;e<t.length;e++)"wall"!==t[e].label&&"balcony"!==t[e].label||walls.db.push(new j({s:t[e].s,e:t[e].e,depth:t[e].depth,outer_depth:t[e].outer_depth,inner_depth:t[e].inner_depth,label:"init",role:t[e].label,material:"none"}));for(let e=0;e<t.length;e++)"door"===t[e].label?doors.db.push(new w({center:t[e].center,width:t[e].width,type:"single",plan:plan})):"door_double"===t[e].label?doors.db.push(new w({center:t[e].center,width:t[e].width,type:"double",plan:plan})):"window"===t[e].label?windows.db.push(new u({type:"window",center:t[e].center,width:t[e].width,label:plan,plan:plan})):"doorway"===t[e].label?doors.db.push(new w({type:"doorway",center:t[e].center,width:t[e].width})):"windoor"===t[e].label&&windows.db.push(new u({type:"windoor",center:t[e].center,width:t[e].width,window_width:t[e].windoor.window_width,door_width:t[e].windoor.door_width,opening:"inner_left",door_position:"left",label:plan,plan:plan}));for(let t=0;t<walls.db.length;t++){let e=walls.db[t];0===get_distance(e.s,e.e)&&e.full_delete(t)}project.draw()}$("#test_rooms_1_plus").on("click",function(){if(++h>=rooms1.data.length)h=rooms1.data.length;else{Ue.plot(rooms1.data[h].points).show();let e=rooms1.data[h];e.image.floor.fill("#fcf8e3"),console.log("Room1 #"+(h+1)+"("+rooms1.data.length+")")}}),$("#test_rooms_1_minus").on("click",function(){if(--h<=-1)h=-1;else{Ue.plot(rooms1.data[h].points).show();let e=rooms1.data[h+1];e.image.floor.fill("#fafafa"),console.log("Room1 #"+(h+1)+"("+rooms1.data.length+")")}}),$("#test_rooms_clear").on("click",function(){Ue.hide();for(let e=0;e<rooms1.data.length;e++)rooms1.data[e].image.floor.fill("#fafafa");for(let e=0;e<rooms2.data.length;e++)rooms2.data[e].image.fill("#fafafa");h=-1,g=-1}),$("#test_rooms_2_plus").on("click",function(){++g>=rooms2.data.length?g=rooms2.data.length:(Ue.plot(rooms2.data[g].polygon).show(),rooms2.data[g].image.fill("#fcf8e3"),console.log("Room2 #"+(g+1)+"("+rooms2.data.length+") "+rooms2.data[g].id))}),$("#test_rooms_2_minus").on("click",function(){--g<=-1?g=-1:(Ue.plot(rooms2.data[g].polygon).show(),rooms2.data[g+1].image.fill("#fafafa"),console.log("Room2 #"+(g+1)+"("+rooms2.data.length+")"))}),$("#delete_items").on("click",function(){items.delete()}),$("#test_sectors").on("click",function(e){console.log("TestSectors");for(let e=0;e<sectors.db.length;e++){var t=sectors.db[e];layers.temp_images.add(new He(t.cp,e,"#fcf8e3")),e,console.log(e,t)}console.log("====================================");for(let e=0;e<sectors.db.length;e++){var i=sectors.db[e];console.log(e,i.id,"s_equal",i.s_equal_other_sector_end,"e_equal",i.e_equal_other_sector_end)}console.log("TestSectors done"),console.log("====================================")}),$("#test2").on("click",function(e){console.log("======= test 2 ======="),console.log("======= test 2 done ==")}),$("#testing").on("change focus",function(){var e=$(this).val();"plan"===e&&console.log('plan: "'+plan+'", plan_group "'+plan_group+'"'),"tool"===e&&console.log('tool: "'+tool+'", tool_group "'+tool_group+'"'),"windows.db.length"===e&&console.log('windows.db.length: "'+windows.db.length+'"'),"items.db.length"===e&&console.log('items.db.length: "'+items.db.length+'"'),"rooms2.data.length"===e&&console.log('rooms2.data.length: "'+rooms2.data.length+'"'),"rooms1.data.length"===e&&console.log('rooms1.data.length: "'+rooms1.data.length+'"')}),$("#tmp-save").on("click",function(){localStorage.setItem("tmp-copy",JSON.stringify(project.copy()))}),$("#tmp-load").on("click",function(){var e=localStorage.getItem("tmp-copy");e&&(project.erase(),project.restore(JSON.parse(e)),project.draw())}),scale_recognition_rect_tool=svg.group().on("init",function(e){scale_recognition_line_tool.hide(),this.show();var t={stroke:"orange","stroke-width":1,fill:"transparent",cursor:"pointer"},i={x:canvas.width()/2,y:canvas.height()/2};let o=this;this._rect=this.rect(100,100).attr({stroke:"orange","stroke-width":2,fill:"none"}).cx(i.x).cy(i.y),this._circle_tl=this.circle(10).attr(t).cx(i.x-50).cy(i.y-50).draggable().on("dragmove",function(e){e.preventDefault();var e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),t=(this.cx(e.x).cy(e.y),o._circle_br.cx()-this.cx()),i=o._circle_br.cy()-this.cy();if(t<30||i<30)return this.cx(o._circle_bl.cx()),void this.cy(o._circle_tr.cy());o._rect.width(t).height(i).x(e.x).y(e.y),o._circle_tr.cx(e.x+t).cy(e.y),o._circle_bl.cx(e.x).cy(e.y+i)}),this._circle_tr=this.circle(10).attr(t).cx(i.x+50).cy(i.y-50).draggable().on("dragmove",function(e){e.preventDefault();var e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),t=(this.cx(e.x).cy(e.y),this.cx()-o._circle_bl.cx()),i=o._circle_bl.cy()-this.cy();if(t<30||i<30)return this.cx(o._circle_br.cx()),void this.cy(o._circle_tl.cy());var n=(this.cx()+o._circle_bl.cx())/2,s=(o._circle_bl.cy()+this.cy())/2;o._rect.width(t).height(i).cx(n).cy(s),o._circle_tl.cx(e.x-t).cy(e.y),o._circle_br.cx(e.x).cy(e.y+i)}),this._circle_br=this.circle(10).attr(t).cx(i.x+50).cy(i.y+50).draggable().on("dragmove",function(e){e.preventDefault();var e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),t=(this.cx(e.x).cy(e.y),this.cx()-o._circle_tl.cx()),i=this.cy()-o._circle_tl.cy();if(t<30||i<30)return this.cx(o._circle_tr.cx()),void this.cy(o._circle_bl.cy());var n=(this.cx()+o._circle_tl.cx())/2,s=(this.cy()+o._circle_tl.cy())/2;o._rect.width(t).height(i).cx(n).cy(s),o._circle_tr.cx(e.x).cy(e.y-i),o._circle_bl.cx(e.x-t).cy(e.y)}),this._circle_bl=this.circle(10).attr(t).cx(i.x-50).cy(i.y+50).draggable().on("dragmove",function(e){e.preventDefault();var e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),t=(this.cx(e.x).cy(e.y),o._circle_tr.cx()-this.cx()),i=this.cy()-o._circle_tr.cy();o._rect.bbox(svg);if(t<30||i<30)return this.cx(o._circle_tl.cx()),void this.cy(o._circle_br.cy());var n=(this.cx()+o._circle_tr.cx())/2,s=(this.cy()+o._circle_tr.cy())/2;o._rect.width(t).height(i).cx(n).cy(s),o._circle_tl.cx(e.x).cy(e.y-i),o._circle_br.cx(e.x+t).cy(e.y)})}).on("recognize",function(e){this.hide();var t=(this._rect.width()*this._rect.height()/1e4).toFixed(2),e=parseFloat(e.detail.value),e=Math.sqrt(e/t),t=project.background.IMAGE.width(),i=project.background.IMAGE.height();project.background.IMAGE.width(t*e),project.background.IMAGE.height(i*e),project.background.IMAGE.cx(canvas.width()/2),project.background.IMAGE.cy(canvas.height()/2)}).on("delete",function(){this.clear()}),scale_recognition_line_tool=svg.group().on("init",function(){scale_recognition_rect_tool.hide(),this.show();var e={stroke:"green","stroke-width":1,fill:"transparent",cursor:"pointer"};let t=this;var i={x:canvas.width()/2,y:canvas.height()/2};this.s={x:i.x-50,y:i.y},this.e={x:i.x+50,y:i.y},this.main_line=this.line(this.s.x,this.s.y,this.e.x,this.e.y).attr({stroke:"green","stroke-width":2}),this.s_circle=this.circle(10).attr(e).cx(this.s.x).cy(this.s.y).draggable().on("dragmove",function(e){e.preventDefault();e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.cx(e.x).cy(e.y),t.s=e,e=get_distance(t.s,t.e);e<30&&(t.s=LIB.pointOnLine(t.s,t.e,-30),this.cx(t.s.x),this.cy(t.s.y)),t.main_line.plot(t.s.x,t.s.y,t.e.x,t.e.y)}),this.e_circle=this.circle(10).attr(e).cx(this.e.x).cy(this.e.y).draggable().on("dragmove",function(e){e.preventDefault();e=LIB.pointSVG(e.detail.event.clientX,e.detail.event.clientY),this.cx(e.x).cy(e.y),t.e=e,e=get_distance(t.s,t.e);e<30&&(t.e=LIB.pointOnLine(t.e,t.s,-30),this.cx(t.e.x),this.cy(t.e.y)),t.main_line.plot(t.s.x,t.s.y,t.e.x,t.e.y)})}).on("recognize",function(e){this.hide();var t=get_distance(this.s,this.e);let i=parseFloat(e.detail.value);i<10&&(i*=100),1e3<=i&&(i/=10);var e=i/t,t=project.background.IMAGE.width(),n=project.background.IMAGE.height();project.background.IMAGE.width(t*e),project.background.IMAGE.height(n*e),project.background.IMAGE.cx(canvas.width()/2),project.background.IMAGE.cy(canvas.height()/2)}).on("delete",function(){this.clear()}),$("#file-input").hide(),$("#file-input-before").on("click",function(){$("#file-input").click()}),$("#file-input").on("change",function(e){project.viewbox_reset(),ze(),$("#footer_bar_content .footer_bar_banner_start_button").addClass("loading"),$("#footer_bar_content .footer_bar_banner_start_button").removeClass("loading"),$("#footer_bar_content .footer_bar_banner_start_button").addClass("active"),e.preventDefault();e=(e=e.originalEvent).dataTransfer||e.target,e=e&&e.files&&e.files[0];let t=window.webkitURL||window.URL;e=t.createObjectURL(e);let i=new Image;i.src=e,i.onload=function(){project.background.fire("init",{src:this.src}),project.background.hide(),$("#bg_mode").click()},background_image_loaded=!0,console.warn("background_image_loaded",background_image_loaded),$(this).val("")}),$("#file_input_cancel").on("click",function(){$("#footer_bar_content .footer_bar_banner_start_button").removeClass("active"),$("#footer_bar_content .footer_bar_banner_start_button").addClass("loading"),$("#footer_bar_content .footer_bar_banner_start_button").removeClass("loading"),preplan_scale_close(),project.background.fire("delete"),background_image_loaded=!1}),window.switch_plans=!0,window.copy_this=null,$("#ai_mode").on("click",function(){background_image_loaded&&(change_group("ai"),close_footer_bar(),$("#footer_bar_content .footer_bar_banner_start_button").removeClass("active"),$("#footer_bar_content .footer_bar_banner_start_button").addClass("loading"),$("#footer_bar_content .footer_bar_banner_start_button").removeClass("loading"),project.background.show(),switch_plans=!1,$("#ai_balcony").show())}),$("#bg_mode").on("click",function(){background_image_loaded&&(change_group("init"),project.background.show(),$("#preplan_scale").prop("data-type","2"),open_help_window("preplan_scale"),$("#canvas_v2_wrapper").addClass("background_mode"),$("#planner_ui_direct").addClass("hidden"),tool_reset())}),$("#background_rotate_plus").on("click",function(){window.image_rotate+=.1,$("#canvas image").css({"transform-origin":"center center",transform:"rotate("+window.image_rotate+"deg)"})}),$("#background_rotate_minus").on("click",function(){window.image_rotate-=.1,$("#canvas image").css({"transform-origin":"center center",transform:"rotate("+window.image_rotate+"deg)"})}),$("#footer_bar_ai_save").on("click",function(e){$("#fog").show(),setTimeout(function(){{var s=function(){$("#fog").hide()};let t=[];for(let e=0;e<handlines.db.length;e++)t.push([{x:handlines.db[e].s.x,y:handlines.db[e].s.y},{x:handlines.db[e].e.x,y:handlines.db[e].e.y},handlines.db[e].label]);copy_this={lines:t};let i=project.background.IMAGE.bbox("svg"),n=(copy_this.coordinate=i,new Image);plannerCanvas=new PlannerCanvas(i.height,i.width),(plannerParser=new PlannerParser).array_lines=copy.object(t),plannerParser.movingCoordinate(i),n.onload=function(){plannerParser.clearStartData(),plannerCanvas.setImage(n);var e=plannerParser.analyzePoints(),e=(-1===e&&(plannerParser.autoParserWalls(),plannerParser.decreaseWallsGeneral()),plannerParser.pillarsGeneral(),plannerParser.restoreCoordinate(i),plannerParser.generateResult());$("#background-delete").click(),toDataURL(project.background.IMAGE.src,function(e){copy_this.image=e,Je()});try{Ke(e),handlines.delete(),background.remove(),background=svg.image(),image_loaded=!1,change_group("init"),console.log("handlines",handlines.db),project.draw(),create_rooms(),project.localSave()}catch(e){send_error_js(e.name,e.message,e.stack),console.error(e)}s()},n.src=project.background.IMAGE.src}plan="init",project.focus()},1e3)}),$("#ai_mode_cancel").on("click",function(e){switch_plans=!0,handlines.delete(),project.background.fire("delete"),scale_recognition_rect_tool.fire("delete"),scale_recognition_line_tool.fire("delete"),handlines.db=[],preplan_scale_close(),background_image_loaded=!1,change_group("init"),project.draw()}),$("#upload_recognition").on("click",function(){Je(!0)}),$("#hide-grid").on("click",function(){$(this).html()===l10n.hide_grid?($(this).html(l10n.show_grid),grid.hide()):$(this).html()===l10n.show_grid&&($(this).html(l10n.hide_grid),grid.show())}),$("#planner_ui_zoom_less").on("click",function(){var e=$("#planner_ui_zoom_slider").val();let t=parseFloat(e,10)-zoom_factor;$("#planner_ui_zoom_slider").val(t),t<zoom_min&&(t=zoom_min),svg.zoom(t),grid.update()}),$("#planner_ui_zoom_slider").on("input",function(){var e=$(this).val();let t=parseFloat(e,10);(t=t<zoom_min?zoom_min:t)>zoom_max&&(t=zoom_max),svg.zoom(t),grid.update()}),$("#planner_ui_zoom_more").on("click",function(){var e=$("#planner_ui_zoom_slider").val();let t=parseFloat(e,10)+zoom_factor;$("#planner_ui_zoom_slider").val(t),t>zoom_max&&(t=zoom_max),svg.zoom(t),grid.update()}),$("#test_room1").on("click",function(){project.delete();project.restore({walls:[{s:{x:395,y:201},e:{x:805,y:201},s0:{x:395,y:201},l1:{x:390,y:196},r1:{x:400,y:206},l2:{x:810,y:196},r2:{x:800,y:206},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_zeixwu5yt",area:{L:11.34,R:10.8}},{s:{x:805,y:201},e:{x:805,y:611},s0:{x:805,y:201},l1:{x:810,y:196},r1:{x:800,y:206},l2:{x:810,y:616},r2:{x:800,y:606},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_fiipn0lnw",area:{L:11.34,R:10.8}},{s:{x:805,y:611},e:{x:395,y:611},s0:{x:805,y:611},l1:{x:810,y:616},r1:{x:800,y:606},l2:{x:390,y:616},r2:{x:400,y:606},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_vb43qjck1",area:{L:11.34,R:10.8}},{s:{x:395,y:611},e:{x:395,y:201},s0:{x:395,y:611},l1:{x:390,y:616},r1:{x:400,y:606},l2:{x:390,y:196},r2:{x:400,y:206},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_s8jyuyfa1",area:{L:11.34,R:10.8}}],pillars:[],sectors:[],rooms1:[{id:"_qceqdztbr",points:[{x:800,y:206},{x:800,y:606},{x:400,y:606},{x:400,y:206}],polygon:[{x:800,y:206},{x:800,y:606},{x:400,y:606},{x:400,y:206}],name:"none",ceiling:{exist:!1,area:16},isolation:[],plaster:[],cap:"none"}],rooms2:[{points:[{x:800,y:206},{x:800,y:606},{x:400,y:606},{x:400,y:206}],polygon:[{x:800,y:206},{x:800,y:606},{x:400,y:606},{x:400,y:206}],edges:[{s:{x:800,y:206},e:{x:800,y:606},wall_info:[{id:"_fiipn0lnw",edge:"R"}]},{s:{x:800,y:606},e:{x:400,y:606},wall_info:[{id:"_vb43qjck1",edge:"R"}]},{s:{x:400,y:606},e:{x:400,y:206},wall_info:[{id:"_s8jyuyfa1",edge:"R"}]},{s:{x:400,y:206},e:{x:800,y:206},wall_info:[{id:"_zeixwu5yt",edge:"R"}]}],name:"none",warm_floors:[],decor:[],ceiling:{exist:!1,area:16},isolation:[],plaster:[],niches:[{exist:!1},{exist:!1},{exist:!1},{exist:!1}],complex_ceiling:{exist:!1},cap:"none",cap_type:"none",id:"_t2m1j7f55",area:16,border_walls:[{id:"_zeixwu5yt",edge:"R"},{id:"_fiipn0lnw",edge:"R"},{id:"_vb43qjck1",edge:"R"},{id:"_s8jyuyfa1",edge:"R"}],in_pillar:!1,perimeter:16,perimeter_walls:16,center:{x:600,y:405.99999999999955},height:270}],windows:[],doors:[],items:[],led_strips:[],wires:[],baselines:[{s:{x:390,y:196},e:{x:810,y:196},label:{x:810,y:196},id:"_gonwpa5nh"},{s:{x:400,y:206},e:{x:800,y:206},label:{x:800,y:206},id:"_afgmihes9"},{s:{x:810,y:196},e:{x:810,y:616},label:{x:810,y:616},id:"_7fudpz7y2"},{s:{x:800,y:206},e:{x:800,y:606},label:{x:800,y:606},id:"_nk4bho2ma"},{s:{x:810,y:616},e:{x:390,y:616},label:{x:390,y:616},id:"_ebxpcn72t"},{s:{x:800,y:606},e:{x:400,y:606},label:{x:400,y:606},id:"_a0wg8s266"},{s:{x:390,y:616},e:{x:390,y:196},label:{x:390,y:196},id:"_qdj4vkfr2"},{s:{x:400,y:606},e:{x:400,y:206},label:{x:400,y:206},id:"_5dop34v6p"}],comments:[],rulers:[],questions:[],make_update2:!0}),project.draw(),project.focus()}),$("#test_room2").on("click",function(){project.delete();project.restore({walls:[{s:{x:504.9999694824219,y:152.0104217529297},e:{x:660,y:152.0104217529297},s0:{x:504.9999694824219,y:152.0104217529297},l1:{x:499.9999694824219,y:147.0104217529297},r1:{x:509.9999694824219,y:157.0104217529297},l2:{x:660,y:147.0104217529297},r2:{x:655,y:157.0104217529297},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_9qa5z2q6l",area:{L:4.32,R:3.92}},{s:{x:815,y:152.0104217529297},e:{x:815,y:307.01043701171875},s0:{x:815,y:152.0104217529297},l1:{x:820,y:147.0104217529297},r1:{x:810,y:157.0104217529297},l2:{x:820,y:307.01043701171875},r2:{x:810,y:302.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_e7q2g96vb",area:{L:4.32,R:3.92}},{s:{x:815,y:462.0104370117187},e:{x:660,y:462.0104370117187},s0:{x:815,y:462.0104370117187},l1:{x:819.9999999999999,y:467.0104370117187},r1:{x:809.9999999999999,y:457.0104370117187},l2:{x:660,y:467.0104370117187},r2:{x:665,y:457.0104370117187},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_nmlyt408j",area:{L:4.32,R:3.91}},{s:{x:504.9999694824219,y:152.0104217529297},e:{x:504.9999694824219,y:307.01043701171875},s0:{x:504.9999694824219,y:152.0104217529297},l1:{x:509.9999694824219,y:157.0104217529297},r1:{x:499.9999694824219,y:147.0104217529297},l2:{x:509.9999694824219,y:302.01043701171875},r2:{x:499.9999694824219,y:307.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_e1cicyx7c",area:{L:3.92,R:4.32}},{s:{x:660,y:152.0104217529297},e:{x:660,y:307.01043701171875},s0:{x:660,y:152.0104217529297},l1:{x:665,y:157.0104217529297},r1:{x:655,y:157.0104217529297},l2:{x:665,y:302.01043701171875},r2:{x:655,y:302.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_or78w5a5x",area:{L:3.92,R:3.92}},{s:{x:660,y:152.0104217529297},e:{x:815,y:152.0104217529297},s0:{x:660,y:152.0104217529297},l1:{x:660,y:147.0104217529297},r1:{x:665,y:157.0104217529297},l2:{x:820,y:147.0104217529297},r2:{x:810,y:157.0104217529297},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_gub7vkwv4",area:{L:4.32,R:3.92}},{s:{x:660,y:462.0104370117187},e:{x:504.9999694824219,y:462.0104370117187},s0:{x:660,y:462.0104370117187},l1:{x:660,y:467.0104370117187},r1:{x:654.9999999999999,y:457.0104370117187},l2:{x:499.9999694824219,y:467.0104370117187},r2:{x:509.9999694824219,y:457.0104370117187},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_qr6xxh6vv",area:{L:4.32,R:3.92}},{s:{x:660,y:307.01043701171875},e:{x:504.9999694824219,y:307.01043701171875},s0:{x:660,y:307.01043701171875},l1:{x:654.9999999999999,y:312.01043701171875},r1:{x:655,y:302.01043701171875},l2:{x:509.9999694824219,y:312.01043701171875},r2:{x:509.9999694824219,y:302.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_yprrhlx7e",area:{L:3.92,R:3.92}},{s:{x:660,y:307.01043701171875},e:{x:660,y:462.0104370117187},s0:{x:660,y:307.01043701171875},l1:{x:665,y:312.01043701171875},r1:{x:655,y:312.01043701171875},l2:{x:665,y:457.01043701171875},r2:{x:655,y:457.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_hcxskcw7f",area:{L:3.92,R:3.92}},{s:{x:504.9999694824219,y:307.01043701171875},e:{x:504.9999694824219,y:462.0104370117187},s0:{x:504.9999694824219,y:307.01043701171875},l1:{x:509.9999694824219,y:312.01043701171875},r1:{x:499.9999694824219,y:307.01043701171875},l2:{x:509.9999694824219,y:457.01043701171875},r2:{x:499.9999694824219,y:467.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_ju1zydjiq",area:{L:3.92,R:4.32}},{s:{x:660,y:307.01043701171875},e:{x:815,y:307.01043701171875},s0:{x:660,y:307.01043701171875},l1:{x:665,y:302.01043701171875},r1:{x:665.0000000000001,y:312.01043701171875},l2:{x:810,y:302.01043701171875},r2:{x:810,y:312.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_dt7wjy5zi",area:{L:3.92,R:3.91}},{s:{x:815,y:307.01043701171875},e:{x:815,y:462.0104370117187},s0:{x:815,y:307.01043701171875},l1:{x:820,y:307.01043701171875},r1:{x:810,y:312.01043701171875},l2:{x:820,y:467.01043701171875},r2:{x:810,y:457.01043701171875},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_n3gqzw4vb",area:{L:4.32,R:3.92}}],pillars:[],sectors:[],rooms1:[{id:"_9ajmwpvaw",points:[{x:509.9999694824219,y:312.01043701171875},{x:509.9999694824219,y:457.01043701171875},{x:654.9999999999999,y:457.0104370117187},{x:655,y:312.01043701171875}],polygon:[{x:509.9999694824219,y:312.01043701171875},{x:509.9999694824219,y:457.01043701171875},{x:654.9999999999999,y:457.0104370117187},{x:655,y:312.01043701171875}],name:"none",ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],cap:"none"},{id:"_w9prxcly8",points:[{x:509.9999694824219,y:302.01043701171875},{x:509.9999694824219,y:157.0104217529297},{x:655,y:157.0104217529297},{x:655,y:302.01043701171875}],polygon:[{x:509.9999694824219,y:302.01043701171875},{x:509.9999694824219,y:157.0104217529297},{x:655,y:157.0104217529297},{x:655,y:302.01043701171875}],name:"none",ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],cap:"none"},{id:"_n8veewb1r",points:[{x:810,y:302.01043701171875},{x:810,y:157.0104217529297},{x:665,y:157.0104217529297},{x:665,y:302.01043701171875}],polygon:[{x:810,y:302.01043701171875},{x:810,y:157.0104217529297},{x:665,y:157.0104217529297},{x:665,y:302.01043701171875}],name:"none",ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],cap:"none"},{id:"_w326ncabu",points:[{x:810,y:312.01043701171875},{x:810,y:457.01043701171875},{x:665,y:457.0104370117187},{x:665,y:312.01043701171875}],polygon:[{x:810,y:312.01043701171875},{x:810,y:457.01043701171875},{x:665,y:457.0104370117187},{x:665,y:312.01043701171875}],name:"none",ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],cap:"none"}],rooms2:[{points:[{x:509.9999694824219,y:312.01043701171875},{x:509.9999694824219,y:457.01043701171875},{x:654.9999999999999,y:457.0104370117187},{x:655,y:312.01043701171875}],polygon:[{x:509.9999694824219,y:312.01043701171875},{x:509.9999694824219,y:457.01043701171875},{x:654.9999999999999,y:457.0104370117187},{x:655,y:312.01043701171875}],edges:[{s:{x:509.9999694824219,y:312.01043701171875},e:{x:509.9999694824219,y:457.01043701171875},wall_info:[{id:"_ju1zydjiq",edge:"L"}]},{s:{x:509.9999694824219,y:457.01043701171875},e:{x:654.9999999999999,y:457.0104370117187},wall_info:[{id:"_qr6xxh6vv",edge:"R"}]},{s:{x:654.9999999999999,y:457.0104370117187},e:{x:655,y:312.01043701171875},wall_info:[{id:"_hcxskcw7f",edge:"R"}]},{s:{x:655,y:312.01043701171875},e:{x:509.9999694824219,y:312.01043701171875},wall_info:[{id:"_yprrhlx7e",edge:"L"}]}],name:"none",warm_floors:[],decor:[],ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],niches:[{exist:!1},{exist:!1},{exist:!1},{exist:!1}],complex_ceiling:{exist:!1},cap:"none",cap_type:"none",id:"_awdu63n21",area:2.1,in_pillar:!1,perimeter:5.8,perimeter_walls:5.8,center:{x:582.4999847412105,y:384.5104370117183},height:270},{points:[{x:509.9999694824219,y:302.01043701171875},{x:509.9999694824219,y:157.0104217529297},{x:655,y:157.0104217529297},{x:655,y:302.01043701171875}],polygon:[{x:509.9999694824219,y:302.01043701171875},{x:509.9999694824219,y:157.0104217529297},{x:655,y:157.0104217529297},{x:655,y:302.01043701171875}],edges:[{s:{x:509.9999694824219,y:302.01043701171875},e:{x:509.9999694824219,y:157.0104217529297},wall_info:[{id:"_e1cicyx7c",edge:"L"}]},{s:{x:509.9999694824219,y:157.0104217529297},e:{x:655,y:157.0104217529297},wall_info:[{id:"_9qa5z2q6l",edge:"R"}]},{s:{x:655,y:157.0104217529297},e:{x:655,y:302.01043701171875},wall_info:[{id:"_or78w5a5x",edge:"R"}]},{s:{x:655,y:302.01043701171875},e:{x:509.9999694824219,y:302.01043701171875},wall_info:[{id:"_yprrhlx7e",edge:"R"}]}],name:"none",warm_floors:[],decor:[],ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],niches:[{exist:!1},{exist:!1},{exist:!1},{exist:!1}],complex_ceiling:{exist:!1},cap:"none",cap_type:"none",id:"_3q6bv9oqb",area:2.1,in_pillar:!1,perimeter:5.8,perimeter_walls:5.8,center:{x:582.4999847412109,y:229.51042938232376},height:270},{points:[{x:810,y:302.01043701171875},{x:810,y:157.0104217529297},{x:665,y:157.0104217529297},{x:665,y:302.01043701171875}],polygon:[{x:810,y:302.01043701171875},{x:810,y:157.0104217529297},{x:665,y:157.0104217529297},{x:665,y:302.01043701171875}],edges:[{s:{x:810,y:302.01043701171875},e:{x:810,y:157.0104217529297},wall_info:[{id:"_e7q2g96vb",edge:"R"}]},{s:{x:810,y:157.0104217529297},e:{x:665,y:157.0104217529297},wall_info:[{id:"_gub7vkwv4",edge:"R"}]},{s:{x:665,y:157.0104217529297},e:{x:665,y:302.01043701171875},wall_info:[{id:"_or78w5a5x",edge:"L"}]},{s:{x:665,y:302.01043701171875},e:{x:810,y:302.01043701171875},wall_info:[{id:"_dt7wjy5zi",edge:"L"}]}],name:"none",warm_floors:[],decor:[],ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],niches:[{exist:!1},{exist:!1},{exist:!1},{exist:!1}],complex_ceiling:{exist:!1},cap:"none",cap_type:"none",id:"_s9t3ol275",area:2.1,border_walls:[{id:"_e7q2g96vb",edge:"R"},{id:"_or78w5a5x",edge:"L"},{id:"_gub7vkwv4",edge:"R"},{id:"_dt7wjy5zi",edge:"L"}],in_pillar:!1,perimeter:5.8,perimeter_walls:5.8,center:{x:737.5,y:229.51042938232376},height:270},{points:[{x:810,y:312.01043701171875},{x:810,y:457.01043701171875},{x:665,y:457.0104370117187},{x:665,y:312.01043701171875}],polygon:[{x:810,y:312.01043701171875},{x:810,y:457.01043701171875},{x:665,y:457.0104370117187},{x:665,y:312.01043701171875}],edges:[{s:{x:810,y:312.01043701171875},e:{x:810,y:457.01043701171875},wall_info:[{id:"_n3gqzw4vb",edge:"R"}]},{s:{x:810,y:457.01043701171875},e:{x:665,y:457.0104370117187},wall_info:[{id:"_nmlyt408j",edge:"R"}]},{s:{x:665,y:457.0104370117187},e:{x:665,y:312.01043701171875},wall_info:[{id:"_hcxskcw7f",edge:"L"}]},{s:{x:665,y:312.01043701171875},e:{x:810,y:312.01043701171875},wall_info:[{id:"_dt7wjy5zi",edge:"R"}]}],name:"none",warm_floors:[],decor:[],ceiling:{exist:!1,area:2.1},isolation:[],plaster:[],niches:[{exist:!1},{exist:!1},{exist:!1},{exist:!1}],complex_ceiling:{exist:!1},cap:"none",cap_type:"none",id:"_c5rs7ho0m",area:2.1,border_walls:[{id:"_nmlyt408j",edge:"R"},{id:"_hcxskcw7f",edge:"L"},{id:"_dt7wjy5zi",edge:"R"},{id:"_n3gqzw4vb",edge:"R"}],in_pillar:!1,perimeter:5.8,perimeter_walls:5.8,center:{x:737.4999999999995,y:384.5104370117183},height:270}],windows:[],doors:[],items:[],led_strips:[],wires:[],baselines:[{s:{x:499.9999694824219,y:147.0104217529297},e:{x:820,y:147.0104217529297},label:{x:820,y:147.0104217529297},id:"_jpqz0t0n2"},{s:{x:509.9999694824219,y:157.0104217529297},e:{x:655,y:157.0104217529297},label:{x:655,y:157.0104217529297},id:"_nu0jrejpn"},{s:{x:820,y:147.0104217529297},e:{x:820,y:467.01043701171875},label:{x:820,y:467.01043701171875},id:"_h0zrpa6kd"},{s:{x:810,y:157.0104217529297},e:{x:810,y:302.01043701171875},label:{x:810,y:302.01043701171875},id:"_7khual23b"},{s:{x:819.9999999999999,y:467.0104370117187},e:{x:499.9999694824219,y:467.0104370117187},label:{x:499.9999694824219,y:467.0104370117187},id:"_gup9a1q67"},{s:{x:809.9999999999999,y:457.0104370117187},e:{x:665,y:457.0104370117187},label:{x:665,y:457.0104370117187},id:"_pxd8q4q5k"},{s:{x:509.9999694824219,y:157.0104217529297},e:{x:509.9999694824219,y:302.01043701171875},label:{x:509.9999694824219,y:302.01043701171875},id:"_tg9vggguq"},{s:{x:499.9999694824219,y:147.0104217529297},e:{x:499.9999694824219,y:467.01043701171875},label:{x:499.9999694824219,y:467.01043701171875},id:"_e3x2ulgqk"},{s:{x:665,y:157.0104217529297},e:{x:665,y:302.01043701171875},label:{x:665,y:302.01043701171875},id:"_ap54d8ytu"},{s:{x:655,y:157.0104217529297},e:{x:655,y:302.01043701171875},label:{x:655,y:302.01043701171875},id:"_it2lty3tg"},{s:{x:665,y:157.0104217529297},e:{x:810,y:157.0104217529297},label:{x:810,y:157.0104217529297},id:"_eoxoeil6w"},{s:{x:654.9999999999999,y:457.0104370117187},e:{x:509.9999694824219,y:457.0104370117187},label:{x:509.9999694824219,y:457.0104370117187},id:"_0ohdwydd4"},{s:{x:654.9999999999999,y:312.01043701171875},e:{x:509.9999694824219,y:312.01043701171875},label:{x:509.9999694824219,y:312.01043701171875},id:"_2dqrpdz07"},{s:{x:655,y:302.01043701171875},e:{x:509.9999694824219,y:302.01043701171875},label:{x:509.9999694824219,y:302.01043701171875},id:"_dhn5vmvdz"},{s:{x:665,y:312.01043701171875},e:{x:665,y:457.01043701171875},label:{x:665,y:457.01043701171875},id:"_60l670044"},{s:{x:655,y:312.01043701171875},e:{x:655,y:457.01043701171875},label:{x:655,y:457.01043701171875},id:"_gev2a5tho"},{s:{x:509.9999694824219,y:312.01043701171875},e:{x:509.9999694824219,y:457.01043701171875},label:{x:509.9999694824219,y:457.01043701171875},id:"_82yis7bw7"},{s:{x:665,y:302.01043701171875},e:{x:810,y:302.01043701171875},label:{x:810,y:302.01043701171875},id:"_k7i76js1r"},{s:{x:665.0000000000001,y:312.01043701171875},e:{x:810,y:312.01043701171875},label:{x:810,y:312.01043701171875},id:"_mtkdyug38"},{s:{x:810,y:312.01043701171875},e:{x:810,y:457.01043701171875},label:{x:810,y:457.01043701171875},id:"_ln67m2rme"}],comments:[],rulers:[],questions:[],make_update2:!0}),project.draw(),project.focus()}),$("#test_room3").on("click",function(){project.delete();project.restore({walls:[{s:{x:539,y:256.0104064941406},e:{x:693.5555419921875,y:256.0104064941406},s0:{x:539,y:256.0104064941406},l1:{x:534,y:251.01040649414062},r1:{x:544,y:261.0104064941406},l2:{x:693.5555419921875,y:251.01040649414062},r2:{x:683.5555419921874,y:261.0104064941406},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_0zb9e5hkc",area:{L:4.31,R:3.77}},{s:{x:849,y:256.0104064941406},e:{x:849,y:566.0104370117188},s0:{x:849,y:256.0104064941406},l1:{x:854,y:251.01040649414062},r1:{x:844,y:261.0104064941406},l2:{x:854,y:571.0104370117188},r2:{x:844,y:561.0104370117188},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_iq2bjfsw5",area:{L:8.64,R:8.1}},{s:{x:849,y:566.0104370117188},e:{x:693.5555419921875,y:566.0104370117188},s0:{x:849,y:566.0104370117188},l1:{x:854,y:571.0104370117188},r1:{x:844,y:561.0104370117188},l2:{x:693.5555419921875,y:571.0104370117188},r2:{x:703.5555419921875,y:561.0104370117188},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_zsvuzxfw5",area:{L:4.33,R:3.79}},{s:{x:539,y:566.0104370117188},e:{x:539,y:256.0104064941406},s0:{x:539,y:566.0104370117188},l1:{x:534,y:571.0104370117188},r1:{x:544,y:561.0104370117188},l2:{x:534,y:251.01040649414062},r2:{x:544,y:261.0104064941406},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_ro2nwiprz",area:{L:8.64,R:8.1}},{s:{x:693.5555419921875,y:256.0104064941406},e:{x:693.5555419921875,y:566.0104370117188},s0:{x:693.5555419921875,y:256.0104064941406},l1:{x:703.5555419921875,y:261.0104064941406},r1:{x:683.5555419921875,y:261.0104064941406},l2:{x:703.5555419921875,y:561.0104370117188},r2:{x:683.5555419921875,y:561.0104370117188},depth:20,outer_depth:10,inner_depth:10,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_6ofrgzm3q",area:{L:8.1,R:8.1}},{s:{x:693.5555419921875,y:256.0104064941406},e:{x:849,y:256.0104064941406},s0:{x:693.5555419921875,y:256.0104064941406},l1:{x:693.5555419921875,y:251.01040649414062},r1:{x:703.5555419921875,y:261.0104064941406},l2:{x:854,y:251.01040649414062},r2:{x:844,y:261.0104064941406},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_c40btsg6u",area:{L:4.33,R:3.79}},{s:{x:693.5555419921875,y:566.0104370117188},e:{x:539,y:566.0104370117188},s0:{x:693.5555419921875,y:566.0104370117188},l1:{x:693.5555419921875,y:571.0104370117188},r1:{x:683.5555419921875,y:561.0104370117188},l2:{x:534,y:571.0104370117188},r2:{x:543.9999999999999,y:561.0104370117188},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_w5c0rw61b",area:{L:4.31,R:3.77}}],pillars:[],sectors:[],rooms1:[{id:"_znyx51n55",points:[{x:703.5555419921875,y:561.0104370117188},{x:844,y:561.0104370117188},{x:844,y:261.0104064941406},{x:703.5555419921875,y:261.0104064941406}],polygon:[{x:703.5555419921875,y:561.0104370117188},{x:844,y:561.0104370117188},{x:844,y:261.0104064941406},{x:703.5555419921875,y:261.0104064941406}],name:"none",ceiling:{exist:!1,area:4.21},isolation:[],plaster:[],cap:"none"},{id:"_4m4w483x1",points:[{x:683.5555419921875,y:561.0104370117188},{x:543.9999999999999,y:561.0104370117188},{x:544,y:261.0104064941406},{x:683.5555419921875,y:261.0104064941406}],polygon:[{x:683.5555419921875,y:561.0104370117188},{x:543.9999999999999,y:561.0104370117188},{x:544,y:261.0104064941406},{x:683.5555419921875,y:261.0104064941406}],name:"none",ceiling:{exist:!1,area:4.19},isolation:[],plaster:[],cap:"none"}],rooms2:[{points:[{x:703.5555419921875,y:561.0104370117188},{x:844,y:561.0104370117188},{x:844,y:261.0104064941406},{x:703.5555419921875,y:261.0104064941406}],polygon:[{x:703.5555419921875,y:561.0104370117188},{x:844,y:561.0104370117188},{x:844,y:261.0104064941406},{x:703.5555419921875,y:261.0104064941406}],edges:[{s:{x:703.5555419921875,y:561.0104370117188},e:{x:844,y:561.0104370117188},wall_info:[{id:"_zsvuzxfw5",edge:"R"}]},{s:{x:844,y:561.0104370117188},e:{x:844,y:261.0104064941406},wall_info:[{id:"_iq2bjfsw5",edge:"R"}]},{s:{x:844,y:261.0104064941406},e:{x:703.5555419921875,y:261.0104064941406},wall_info:[{id:"_c40btsg6u",edge:"R"}]},{s:{x:703.5555419921875,y:261.0104064941406},e:{x:703.5555419921875,y:561.0104370117188},wall_info:[{id:"_6ofrgzm3q",edge:"L"}]}],name:"none",warm_floors:[],decor:[],ceiling:{exist:!1,area:4.21},isolation:[],plaster:[],niches:[{exist:!1},{exist:!1},{exist:!1},{exist:!1}],complex_ceiling:{exist:!1},cap:"none",cap_type:"none",id:"_xlp3311u2",area:4.21,border_walls:[{id:"_iq2bjfsw5",edge:"R"},{id:"_zsvuzxfw5",edge:"R"},{id:"_6ofrgzm3q",edge:"L"},{id:"_c40btsg6u",edge:"R"}],in_pillar:!1,perimeter:8.81,perimeter_walls:8.81,center:{x:773.7777709960938,y:411.0104217529297},height:270},{points:[{x:683.5555419921875,y:561.0104370117188},{x:543.9999999999999,y:561.0104370117188},{x:544,y:261.0104064941406},{x:683.5555419921875,y:261.0104064941406}],polygon:[{x:683.5555419921875,y:561.0104370117188},{x:543.9999999999999,y:561.0104370117188},{x:544,y:261.0104064941406},{x:683.5555419921875,y:261.0104064941406}],edges:[{s:{x:683.5555419921875,y:561.0104370117188},e:{x:543.9999999999999,y:561.0104370117188},wall_info:[{id:"_w5c0rw61b",edge:"R"}]},{s:{x:543.9999999999999,y:561.0104370117188},e:{x:544,y:261.0104064941406},wall_info:[{id:"_ro2nwiprz",edge:"R"}]},{s:{x:544,y:261.0104064941406},e:{x:683.5555419921875,y:261.0104064941406},wall_info:[{id:"_0zb9e5hkc",edge:"R"}]},{s:{x:683.5555419921875,y:261.0104064941406},e:{x:683.5555419921875,y:561.0104370117188},wall_info:[{id:"_6ofrgzm3q",edge:"R"}]}],name:"none",warm_floors:[],decor:[],ceiling:{exist:!1,area:4.19},isolation:[],plaster:[],niches:[{exist:!1},{exist:!1},{exist:!1},{exist:!1}],complex_ceiling:{exist:!1},cap:"none",cap_type:"none",id:"_hthy4s8ut",area:4.19,border_walls:[{id:"_0zb9e5hkc",edge:"R"},{id:"_ro2nwiprz",edge:"R"},{id:"_6ofrgzm3q",edge:"R"},{id:"_w5c0rw61b",edge:"R"}],in_pillar:!1,perimeter:8.79,perimeter_walls:8.79,center:{x:613.7777709960938,y:411.0104217529297},height:270}],windows:[],doors:[],items:[],led_strips:[],wires:[],baselines:[{s:{x:534,y:251.01040649414062},e:{x:854,y:251.01040649414062},label:{x:854,y:251.01040649414062},id:"_xxpajakmh"},{s:{x:544,y:261.0104064941406},e:{x:683.5555419921874,y:261.0104064941406},label:{x:683.5555419921874,y:261.0104064941406},id:"_0ib8f5ghc"},{s:{x:854,y:251.01040649414062},e:{x:854,y:571.0104370117188},label:{x:854,y:571.0104370117188},id:"_jfb7hx1ni"},{s:{x:844,y:261.0104064941406},e:{x:844,y:561.0104370117188},label:{x:844,y:561.0104370117188},id:"_wf3g2aqv8"},{s:{x:854,y:571.0104370117188},e:{x:534,y:571.0104370117188},label:{x:534,y:571.0104370117188},id:"_di4esejhd"},{s:{x:844,y:561.0104370117188},e:{x:703.5555419921875,y:561.0104370117188},label:{x:703.5555419921875,y:561.0104370117188},id:"_g883dbor1"},{s:{x:534,y:571.0104370117188},e:{x:534,y:251.01040649414062},label:{x:534,y:251.01040649414062},id:"_oqy99yhgt"},{s:{x:544,y:561.0104370117188},e:{x:544,y:261.0104064941406},label:{x:544,y:261.0104064941406},id:"_ccv76l76f"},{s:{x:703.5555419921875,y:261.0104064941406},e:{x:703.5555419921875,y:561.0104370117188},label:{x:703.5555419921875,y:561.0104370117188},id:"_c5pbxubwu"},{s:{x:683.5555419921875,y:261.0104064941406},e:{x:683.5555419921875,y:561.0104370117188},label:{x:683.5555419921875,y:561.0104370117188},id:"_fmlkgbou9"},{s:{x:703.5555419921875,y:261.0104064941406},e:{x:844,y:261.0104064941406},label:{x:844,y:261.0104064941406},id:"_vmskdij12"},{s:{x:683.5555419921875,y:561.0104370117188},e:{x:543.9999999999999,y:561.0104370117188},label:{x:543.9999999999999,y:561.0104370117188},id:"_k0r7n75sv"}],comments:[],rulers:[],questions:[],make_update2:!0}),project.draw(),project.focus()}),$("#test_room4").on("click",function(){project.delete(),project.restore({walls:[{s:{x:500,y:201},e:{x:800,y:201},s_init:{x:500,y:201},e_init:{x:800,y:201},l1:{x:500,y:196},r1:{x:500,y:206},l2:{x:800,y:196},r2:{x:800,y:206},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"init",role:"wall",patch:!1,part:!1,pillar:!1,id:"_u9yb92vkd",area:{L:8.1,R:8.1}},{s:{x:650,y:201},e:{x:650,y:356},s_init:{x:650,y:201},e_init:{x:650,y:356},l1:{x:655,y:201},r1:{x:645,y:201},l2:{x:655,y:356},r2:{x:645,y:356},depth:10,outer_depth:5,inner_depth:5,height:270,material:"none",label:"break",role:"wall",patch:!1,part:!1,pillar:!1,id:"_jszcd9c2j",area:{L:4.18,R:4.18}}],pillars:[],sectors:[{s:{x:650,y:201},e:{x:650,y:356},height:270,id_wall:"_jszcd9c2j",wall_index:1,like_wall:!0,area:4.05}],rooms1:[],rooms2:[],windows:[],doors:[],items:[],led_strips:[],wires:[],comments:[],rulers:[],questions:[],make_update2:!0}),project.draw(),project.focus()}),$("#ceiling-delimiter").on("click",function(){tool="delimiter"}),$("#save_project_with_json").on("click",function(){var e=$(this).attr("data-href");project.save(),setTimeout(function(){window.location.replace(e)},1e3)}),$("#load_project_with_json").on("click",function(){$("#load_project_with_json_file input").click()}),$("#load_project_with_json_file input").on("change",function(){var e=$("#load_project_with_json_file input")[0].files[0],t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=function(e){LogItems.bad_item_removed=[],project.delete(),project.restore(JSON.parse(e.target.result)),project.draw(),LogItems.start(),LogItems.was_file_load=!0,project.focus()},t.onerror=function(e){alert("Error reading json file")}}),$("#test2").after('<div class="btn text-red" id="test_draw">нарисовать</div>'),$("#test_draw").click(function(){var e=prompt("Тест","");e&&Ke(JSON.parse(e))}),$("#test_draw").after('<div class="btn text-red" id="test_furniture_placement_bedroom">мебель - спальня</div>'),$("#test_furniture_placement_bedroom").click(function(){$("#fog").show(),console.warn("Расстановка мебели"),setTimeout(function(){try{let e=new Ve;e.do()}catch(e){console.error(e)}$("#fog").hide()},200)});class Ve{constructor(){this.rooms={},this.furniture={},this.init()}init(){for(let n=0;n<rooms2.data.length;n++){this.rooms[rooms2.data[n].id]={walls:[],index:n};let e=100,i={};for(let e=0;e<rooms2.data[n].edges.length;e++)i[e]=new j({s:rooms2.data[n].edges[e].s,e:rooms2.data[n].edges[e].e});for(let e=0;e<Object.keys(i).length;e++)are_points_equal(i[e].s,i[e].e,2)&&delete i[e];for(i=Object.values(i);0<e--;){let t=!1;for(let e=0;e<i.length-1;e++){var s=i[e].angle_between(i[e+1]);if(179<=s||s<=1){if(are_points_equal(i[e].s,i[e+1].s,2))i[e]=new j({s:i[e].e,e:i[e+1].e});else if(are_points_equal(i[e].s,i[e+1].e,2))i[e]=new j({s:i[e].e,e:i[e+1].s});else if(are_points_equal(i[e].e,i[e+1].s,2))i[e]=new j({s:i[e].s,e:i[e+1].e});else{if(!are_points_equal(i[e].e,i[e+1].e,2))continue;i[e]=new j({s:i[e].s,e:i[e+1].s})}t=!0,delete i[e+1],i=Object.values(i);break}}if(!t)break}for(let t=0;t<i.length;t++){let e=new j({s:i[t].s,e:i[t].e});e.index=t,this.rooms[rooms2.data[n].id].walls[t]={wall:e,doors:[],windows:[]}}}for(var e in this.rooms)this.rooms.hasOwnProperty(e)&&(this.rooms[e].walls.length<4?(delete this.rooms[e],console.warn(`Комната ${e} имеет меньше 4 стен`)):rooms2.data[this.rooms[e].index].area<5&&(delete this.rooms[e],console.warn(`Комната ${e} имеет площадь меньше 5`)));for(let t=0;t<doors.db.length;t++){if(doors.db[t].room_i&&void 0!==this.rooms[doors.db[t].room_i])for(let e=0;e<this.rooms[doors.db[t].room_i].walls.length;e++)is_point_on_line(doors.db[t].r1,this.rooms[doors.db[t].room_i].walls[e].wall,.01)&&is_point_on_line(doors.db[t].r2,this.rooms[doors.db[t].room_i].walls[e].wall,.01)&&this.rooms[doors.db[t].room_i].walls[e].doors.push({id:doors.db[t].id,index:t});if(doors.db[t].room_o&&void 0!==this.rooms[doors.db[t].room_o])for(let e=0;e<this.rooms[doors.db[t].room_o].walls.length;e++)is_point_on_line(doors.db[t].l1,this.rooms[doors.db[t].room_o].walls[e].wall,.01)&&is_point_on_line(doors.db[t].l2,this.rooms[doors.db[t].room_o].walls[e].wall,.01)&&this.rooms[doors.db[t].room_o].walls[e].doors.push({id:doors.db[t].id,index:t})}for(let t=0;t<windows.db.length;t++){if(windows.db[t].room_i&&void 0!==this.rooms[windows.db[t].room_i])for(let e=0;e<this.rooms[windows.db[t].room_i].walls.length;e++)is_point_on_line(windows.db[t].r1,this.rooms[windows.db[t].room_i].walls[e].wall,.01)&&is_point_on_line(windows.db[t].r2,this.rooms[windows.db[t].room_i].walls[e].wall,.01)&&this.rooms[windows.db[t].room_i].walls[e].windows.push({id:windows.db[t].id,index:t});if(windows.db[t].room_o&&void 0!==this.rooms[windows.db[t].room_o])for(let e=0;e<this.rooms[windows.db[t].room_o].walls.length;e++)is_point_on_line(windows.db[t].l1,this.rooms[windows.db[t].room_o].walls[e].wall,.01)&&is_point_on_line(windows.db[t].l2,this.rooms[windows.db[t].room_o].walls[e].wall,.01)&&this.rooms[windows.db[t].room_o].walls[e].windows.push({id:windows.db[t].id,index:t})}}do(){if(0<items.db.length){for(let e=0;e<items.db.length;e++)items.db[e].delete(),e--;console.error("мебель уже есть"),console.error("старая мебель удалена")}for(var e in this.rooms)this.rooms.hasOwnProperty(e)&&this.placement_bedroom(e)}placement_bedroom(i){let n=null,s=null,e=null,t=null,o=null,l=null,r=null,a=10,h=[];for(;0<a--&&!1!==(r=this.getWallWithoutDoorsAndWindows(i,h,{length_min:280}));){var g=this.getWallFromRoom(i,r,r.s),_=this.getWallFromRoom(i,r,r.e);if(void 0===g||void 0===_)return void console.warn(`В комнате ${i} проблема со стенами`);var d=this.getLinePlaceFurniture(i,r,g,+tools.ward_coupe.width),p=this.getLinePlaceFurniture(i,r,_,+tools.ward_coupe.width),c=this.getIntersectionDoor(i,g,d),A=this.getIntersectionWindow(i,g,d),u=this.getIntersectionDoor(i,_,p),w=this.getIntersectionWindow(i,_,p);if(!1===c&&!1===A?(c=this.getCoordinateByLine(i,g,d,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,g,"ward_coupe",c)):!1===u&&!1===w&&(A=this.getCoordinateByLine(i,_,p,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,_,"ward_coupe",A)),null===s)h.push(r.index);else if(this.getIntersectionDoorOpen(i,s)||this.getIntersectionWallsWithFurniture(i,s))h.push(r.index),this.deleteFurniture(s),s=null;else{d=this.getLineSideWall(s,r),g=this.getLineWallWithoutLine(i,r,d),c=this.getCoordinateByLine(i,r,g,+tools.bed_double.height);if(n=this.addFurnitureByPoint(i,r,"bed_double",c),this.getIntersectionDoorOpen(i,n)||this.getIntersectionWallsWithFurniture(i,n)||this.getIntersectionWindowWithFurniture(i,r,n)||this.getNearWallsWithFurniture(i,n))h.push(r.index),this.deleteFurniture(n),n=null,this.deleteFurniture(s),s=null;else{u=this.getOppositeWall(i,r,!0,!0);if(!1!==u){g=this.getProjectionLineOnWall(i,u,this.getLineSideWall(n,r)),w=this.getCoordinateByLine(i,u,g,+tools.tv.height);if(e=this.addFurnitureByPoint(i,u,"tv",w),this.getIntersectionDoorOpen(i,e)||this.getIntersectionWallsWithFurniture(i,e)){h.push(r.index),this.deleteFurniture(e),e=null,this.deleteFurniture(n),n=null,this.deleteFurniture(s),s=null;continue}}if(null!==e)break;h.push(r.index),this.deleteFurniture(n),n=null,this.deleteFurniture(s),s=null}}}if(null===n)for(a=10,h=[];0<a--&&!1!==(r=this.getWallWithoutDoorsAndWindows(i,h,{length_min:170}))&&(n=this.addFurniture(i,r,"bed_double"),this.getIntersectionDoorOpen(i,n)||this.getIntersectionWallsWithFurniture(i,n)||this.getIntersectionWindowWithFurniture(i,r,n)||this.getNearWallsWithFurniture(i,n));)h.push(r.index),this.deleteFurniture(n),n=null;if(null===n)for(a=10,h=[];0<a--;){var m=this.getWallWithWindow(i,h,{length_min:170});if(!1===m)break;r=m.wall;m=m.line;let e;if(e=get_distance(m.s,m.e)<265?this.getCoordinateByLineStart(i,r,m,+tools.bed_double.height,+tools.bed_double.width):this.getCoordinateByLine(i,r,m,+tools.bed_double.height),n=this.addFurnitureByPoint(i,r,"bed_double",e),!(this.getIntersectionDoorOpen(i,n)||this.getIntersectionWallsWithFurniture(i,n)||this.getIntersectionWindowWithFurniture(i,r,n)||this.getNearWallsWithFurniture(i,n)))break;h.push(r.index),this.deleteFurniture(n),n=null}if(null===n)for(a=10,h=[];0<a--;){var f=this.getWallWithDoor(i,h,{length_min:170});if(!1===f)break;r=f.wall;f=f.line;let e;if(e=get_distance(f.s,f.e)<265?this.getCoordinateByLineStart(i,r,f,+tools.bed_double.height,+tools.bed_double.width):this.getCoordinateByLine(i,r,f,+tools.bed_double.height),n=this.addFurnitureByPoint(i,r,"bed_double",e),!(this.getIntersectionDoorOpen(i,n)||this.getIntersectionWallsWithFurniture(i,n)||this.getIntersectionWindowWithFurniture(i,r,n)||this.getNearWallsWithFurniture(i,n)))break;h.push(r.index),this.deleteFurniture(n),n=null}if(null===n)for(a=10,h=[];0<a--&&!1!==(r=this.getWallWithoutDoors(i,h,{length_min:170}))&&(n=this.addFurniture(i,r,"bed_double"),this.getIntersectionDoorOpen(i,n)||this.getIntersectionWallsWithFurniture(i,n)||this.getIntersectionWindowWithFurniture(i,r,n)||this.getNearWallsWithFurniture(i,n));)h.push(r.index),this.deleteFurniture(n),n=null;if(null===n)console.warn(`В комнате ${i} некуда поставить кровать`);else{if(null===s){var I=this.getWallFromRoom(i,r,r.s),C=this.getWallFromRoom(i,r,r.e);if(void 0===I||void 0===C)return void console.warn(`В комнате ${i} проблема со стенами`);var y=this.getLinePlaceFurniture(i,r,I,+tools.ward_coupe.width),b=this.getLinePlaceFurniture(i,r,C,+tools.ward_coupe.width),v=this.getIntersectionDoor(i,I,y),x=this.getIntersectionWindow(i,I,y),B=this.getIntersectionDoor(i,C,b),k=this.getIntersectionWindow(i,C,b);null===s&&!1===v&&!1===x&&(v=this.getCoordinateByLine(i,I,y,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,I,"ward_coupe",v),(this.getIntersectionDoorOpen(i,s)||this.getIntersectionWallsWithFurniture(i,s)||this.getIntersectionFurniture(n,s)||this.getIntersectionNearFurniture(i,s,n))&&(this.deleteFurniture(s),s=null)),null===s&&!1===B&&!1===k&&(x=this.getCoordinateByLine(i,C,b,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,C,"ward_coupe",x),(this.getIntersectionDoorOpen(i,s)||this.getIntersectionWallsWithFurniture(i,s)||this.getIntersectionFurniture(n,s)||this.getIntersectionNearFurniture(i,s,n))&&(this.deleteFurniture(s),s=null))}if(null===s){y=this.getWallFromRoom(i,r,r.s),I=this.getWallFromRoom(i,r,r.e);if(void 0===y||void 0===I)return void console.warn(`В комнате ${i} проблема со стенами`);let e=this.getLinePlaceFurnitureOpposite(i,r,y,+tools.ward_coupe.width),t=this.getLinePlaceFurnitureOpposite(i,r,I,+tools.ward_coupe.width);var v=this.getIntersectionDoor(i,y,e),B=this.getIntersectionWindow(i,y,e),k=this.getIntersectionDoor(i,I,t),b=this.getIntersectionWindow(i,I,t);null===s&&!1===v&&!1===B&&(C=this.getCoordinateByLine(i,y,e,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,y,"ward_coupe",C),(this.getIntersectionDoorOpen(i,s)||this.getIntersectionWallsWithFurniture(i,s)||this.getIntersectionFurniture(n,s)||this.getIntersectionNearFurniture(i,s,n))&&(this.deleteFurniture(s),s=null)),null===s&&!1===k&&!1===b&&(x=this.getCoordinateByLine(i,I,t,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,I,"ward_coupe",x),(this.getIntersectionDoorOpen(i,s)||this.getIntersectionWallsWithFurniture(i,s)||this.getIntersectionFurniture(n,s)||this.getIntersectionNearFurniture(i,s,n))&&(this.deleteFurniture(s),s=null)),null===s&&(C=this.getIntersectionPoints([v,B]),x=this.getIntersectionPoints([k,b]),1!==C.length&&1!==x.length||(null===s&&1===C.length&&(v=get_distance(e.e,C[0]))<100&&(B=+tools.ward_coupe.width-v-10,e=this.getLinePlaceFurnitureOpposite(i,r,y,B),k=this.getCoordinateByLine(i,y,e,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,y,"ward_coupe",k,B),(this.getIntersectionDoorOpen(i,s)||this.getIntersectionWallsWithFurniture(i,s)||this.getIntersectionFurniture(n,s)||this.getIntersectionNearFurniture(i,s,n))&&(this.deleteFurniture(s),s=null)),null===s&&1===x.length&&(b=get_distance(t.e,x[0]))<100&&(C=+tools.ward_coupe.width-b-10,t=this.getLinePlaceFurnitureOpposite(i,r,I,C),v=this.getCoordinateByLine(i,I,t,+tools.ward_coupe.height),s=this.addFurnitureByPoint(i,I,"ward_coupe",v,C),(this.getIntersectionDoorOpen(i,s)||this.getIntersectionWallsWithFurniture(i,s)||this.getIntersectionFurniture(n,s)||this.getIntersectionNearFurniture(i,s,n))&&(this.deleteFurniture(s),s=null))))}var y=this.getLeftCoordinate(n,i,r,+tools.bedside_table.width,+tools.bedside_table.height);if(o=this.addFurnitureByPoint(i,r,"bedside_table",y),y=this.getRightCoordinate(n,i,r,+tools.bedside_table.width,+tools.bedside_table.height),l=this.addFurnitureByPoint(i,r,"bedside_table",y),(this.getIntersectionDoorOpen(i,o)||this.getIntersectionWallsWithFurniture(i,o)||s&&this.getIntersectionFurniture(o,s)||e&&this.getIntersectionFurniture(o,e))&&(this.deleteFurniture(o),o=null),(this.getIntersectionDoorOpen(i,l)||this.getIntersectionWallsWithFurniture(i,l)||s&&this.getIntersectionFurniture(l,s)||e&&this.getIntersectionFurniture(l,e))&&(this.deleteFurniture(l),l=null),null!==e||!1!==(k=this.getOppositeWall(i,r,!0,!0))&&(B=this.getProjectionLineOnWall(i,k,this.getLineSideWall(n,r)),x=this.getCoordinateByLine(i,k,B,+tools.tv.height),e=this.addFurnitureByPoint(i,k,"tv",x),(this.getIntersectionDoorOpen(i,e)||this.getIntersectionWallsWithFurniture(i,e))&&(this.deleteFurniture(e),e=null)),null===t){var b=this.getWallFromRoom(i,r,r.s),I=this.getWallFromRoom(i,r,r.e);if(void 0===b||void 0===I)return void console.warn(`В комнате ${i} проблема со стенами`);var v=this.getLinePlaceFurniture(i,r,b,+tools.beauty_table.width),C=this.getLinePlaceFurniture(i,r,I,+tools.beauty_table.width),y=this.getIntersectionDoor(i,b,v),B=this.getIntersectionWindow(i,b,v),k=this.getIntersectionDoor(i,I,C),x=this.getIntersectionWindow(i,I,C);null===t&&!1===y&&!1===B&&(y=this.getCoordinateByLine(i,b,v,+tools.beauty_table.height),t=this.addFurnitureByPoint(i,b,"beauty_table",y),(this.getIntersectionDoorOpen(i,t)||this.getIntersectionWallsWithFurniture(i,t)||this.getIntersectionFurniture(t,n)||s&&this.getIntersectionFurniture(t,s)||e&&this.getIntersectionFurniture(t,e)||o&&this.getIntersectionFurniture(t,o)||l&&this.getIntersectionFurniture(t,l)||this.getIntersectionNearFurniture(i,t,n)||s&&this.getIntersectionNearFurniture(i,t,s)||e&&this.getIntersectionNearFurniture(i,t,e)||o&&this.getIntersectionNearFurniture(i,t,o)||l&&this.getIntersectionNearFurniture(i,t,l))&&(this.deleteFurniture(t),t=null)),null===t&&!1===k&&!1===x&&(B=this.getCoordinateByLine(i,I,C,+tools.beauty_table.height),t=this.addFurnitureByPoint(i,I,"beauty_table",B),(this.getIntersectionDoorOpen(i,t)||this.getIntersectionWallsWithFurniture(i,t)||this.getIntersectionFurniture(t,n)||s&&this.getIntersectionFurniture(t,s)||e&&this.getIntersectionFurniture(t,e)||o&&this.getIntersectionFurniture(t,o)||l&&this.getIntersectionFurniture(t,l)||this.getIntersectionNearFurniture(i,t,n)||s&&this.getIntersectionNearFurniture(i,t,s)||e&&this.getIntersectionNearFurniture(i,t,e)||o&&this.getIntersectionNearFurniture(i,t,o)||l&&this.getIntersectionNearFurniture(i,t,l))&&(this.deleteFurniture(t),t=null))}null===t&&(v=this.getWallFromRoom(i,r,r.s),b=this.getWallFromRoom(i,r,r.e),void 0===v||void 0===b?console.warn(`В комнате ${i} проблема со стенами`):(y=this.getLinePlaceFurnitureOpposite(i,r,v,+tools.beauty_table.width),k=this.getLinePlaceFurnitureOpposite(i,r,b,+tools.beauty_table.width),x=this.getIntersectionDoor(i,v,y),C=this.getIntersectionWindow(i,v,y),I=this.getIntersectionDoor(i,b,k),B=this.getIntersectionWindow(i,b,k),null===t&&!1===x&&!1===C&&(x=this.getCoordinateByLine(i,v,y,+tools.beauty_table.height),t=this.addFurnitureByPoint(i,v,"beauty_table",x),(this.getIntersectionDoorOpen(i,t)||this.getIntersectionWallsWithFurniture(i,t)||this.getIntersectionFurniture(t,n)||s&&this.getIntersectionFurniture(t,s)||e&&this.getIntersectionFurniture(t,e)||o&&this.getIntersectionFurniture(t,o)||l&&this.getIntersectionFurniture(t,l)||this.getIntersectionNearFurniture(i,t,n)||s&&this.getIntersectionNearFurniture(i,t,s)||e&&this.getIntersectionNearFurniture(i,t,e)||o&&this.getIntersectionNearFurniture(i,t,o)||l&&this.getIntersectionNearFurniture(i,t,l))&&(this.deleteFurniture(t),t=null)),null===t&&!1===I&&!1===B&&(C=this.getCoordinateByLine(i,b,k,+tools.beauty_table.height),t=this.addFurnitureByPoint(i,b,"beauty_table",C),(this.getIntersectionDoorOpen(i,t)||this.getIntersectionWallsWithFurniture(i,t)||this.getIntersectionFurniture(t,n)||s&&this.getIntersectionFurniture(t,s)||e&&this.getIntersectionFurniture(t,e)||o&&this.getIntersectionFurniture(t,o)||l&&this.getIntersectionFurniture(t,l)||this.getIntersectionNearFurniture(i,t,n)||s&&this.getIntersectionNearFurniture(i,t,s)||e&&this.getIntersectionNearFurniture(i,t,e)||o&&this.getIntersectionNearFurniture(i,t,o)||l&&this.getIntersectionNearFurniture(i,t,l))&&(this.deleteFurniture(t),t=null)),null===t&&(y=this.getOppositeWall(i,r),v=this.getLineStartWall(i,y,+tools.beauty_table.width),x=this.getLineEndWall(i,y,+tools.beauty_table.width),I=this.getIntersectionDoor(i,y,v),B=this.getIntersectionWindow(i,y,v),k=this.getIntersectionDoor(i,y,x),b=this.getIntersectionWindow(i,y,x),null===t&&!1===I&&!1===B&&(C=this.getCoordinateByLine(i,y,v,+tools.beauty_table.height),t=this.addFurnitureByPoint(i,y,"beauty_table",C),(this.getIntersectionDoorOpen(i,t)||this.getIntersectionWallsWithFurniture(i,t)||this.getIntersectionFurniture(t,n)||s&&this.getIntersectionFurniture(t,s)||e&&this.getIntersectionFurniture(t,e)||o&&this.getIntersectionFurniture(t,o)||l&&this.getIntersectionFurniture(t,l)||this.getIntersectionNearFurniture(i,t,n)||s&&this.getIntersectionNearFurniture(i,t,s)||e&&this.getIntersectionNearFurniture(i,t,e)||o&&this.getIntersectionNearFurniture(i,t,o)||l&&this.getIntersectionNearFurniture(i,t,l))&&(this.deleteFurniture(t),t=null)),null===t&&!1===k&&!1===b&&(I=this.getCoordinateByLine(i,y,x,+tools.beauty_table.height),t=this.addFurnitureByPoint(i,y,"beauty_table",I),(this.getIntersectionDoorOpen(i,t)||this.getIntersectionWallsWithFurniture(i,t)||this.getIntersectionFurniture(t,n)||s&&this.getIntersectionFurniture(t,s)||e&&this.getIntersectionFurniture(t,e)||o&&this.getIntersectionFurniture(t,o)||l&&this.getIntersectionFurniture(t,l)||this.getIntersectionNearFurniture(i,t,n)||s&&this.getIntersectionNearFurniture(i,t,s)||e&&this.getIntersectionNearFurniture(i,t,e)||o&&this.getIntersectionNearFurniture(i,t,o)||l&&this.getIntersectionNearFurniture(i,t,l))&&(this.deleteFurniture(t),t=null)))))}}getCoordinateByCenterWall(e,t,i){var n=get_point_near_line_center(t.s,t.e,i/2,"R"),t=get_point_near_line_center(t.s,t.e,i/2,"L");return is_point_inside_polygon(n,rooms2.data[this.rooms[e].index].polygon)?n:t}getLeftCoordinate(e,t,i,n,s){var e=this.getLineSideWall(e),n=LIB.pointOnLine(e.s,e.e,-get_distance(e.s,e.e)-n),o=get_point_near_line_center(e.s,n,s/2,"R"),e=get_point_near_line_center(e.s,n,s/2,"L");return is_point_inside_polygon(o,rooms2.data[this.rooms[t].index].polygon)?o:e}getRightCoordinate(e,t,i,n,s){var e=this.getLineSideWall(e),n=LIB.pointOnLine(e.s,e.e,get_distance(e.s,e.e)+n),o=get_point_near_line_center(e.s,n,s/2,"R"),e=get_point_near_line_center(e.s,n,s/2,"L");return is_point_inside_polygon(o,rooms2.data[this.rooms[t].index].polygon)?o:e}getCoordinateByLine(e,t,i,n){var s=get_point_near_line_center(i.s,i.e,n/2,"R"),i=get_point_near_line_center(i.s,i.e,n/2,"L");return is_point_inside_polygon(s,rooms2.data[this.rooms[e].index].polygon)?s:i}getCoordinateByLineStart(e,t,i,n,s){var s=LIB.pointOnLine(i.s,i.e,-get_distance(i.s,i.e)+s),o=get_point_near_line_center(i.s,s,n/2,"R"),i=get_point_near_line_center(i.s,s,n/2,"L");return is_point_inside_polygon(o,rooms2.data[this.rooms[e].index].polygon)?o:i}getAngle(e,t){let i;e=rooms2.data[this.rooms[e].index],i=is_point_inside_polygon(get_point_near_line_center(t.e,t.s,10,"R"),e.polygon)?"L":"R",e=get_line_angle(t)+("R"===i?180:0);return e}addFurniture(e,t,i,n=null){var s=this.getCoordinateByCenterWall(e,t,+tools[i].height),o=this.getAngle(e,t),i=this.addItem(e,t,i,s,o,n);return this.furniture[items.db[i].props.id]={room_id:e,wall_id:t.index},items.db[i].props.id}addFurnitureByPoint(e,t,i,n,s=null){var o=this.getAngle(e,t),i=this.addItem(e,t,i,n,o,s);return this.furniture[items.db[i].props.id]={room_id:e,wall_id:t.index},items.db[i].props.id}addItem(e,t,i,n,s,o=null){let l=copy.object(tools[i]);null!==o&&(l.width_changed=o),l.hasOwnProperty("width_changed")||(l.width_changed=parseInt(l.width,10)),l.hasOwnProperty("height_changed")||(l.height_changed=parseInt(l.height,10)),l.width_k=1,l.height_k=1;o=get_point_projection(n,t);return items.db.push(new _({settings:l,name:i,edge:null,length:1,center:n,angle:s,projection:o,id_room:e,plan:plan})),items.db.length-1}getFurniture(t){for(let e=0;e<items.db.length;e++)if(t===items.db[e].props.id)return items.db[e];return!1}getLineSideWall(e,t=null){var i=this.furniture[e].room_id;t=null===t?this.rooms[i].walls[this.furniture[e].wall_id].wall:t;let n,s;var o=this.getFurniture(e);for(let e=1;e<=4;e++)if(is_point_on_line(o["p"+e],t,.05))if(void 0===n)n=o["p"+e];else{if(void 0!==s)break;s=o["p"+e]}return n&&s?new j({s:n,e:s}):(this.drawPoint(t.s),this.drawPoint(t.e),!1)}getInnerLengthWall(e,t){return t.roomI===e?get_distance(t.r1,t.r2):get_distance(t.l1,t.l2)}getOppositeWall(t,i,n=!1,s=!1){let o={};for(let e=0;e<this.rooms[t].walls.length;e++){var l;n&&0<this.rooms[t].walls[e].doors.length||s&&0<this.rooms[t].walls[e].windows.length||e===i.index||(176<=(l=i.angle_between(this.rooms[t].walls[e].wall))||l<=3)&&(o[this.rooms[t].walls[e].wall.length()]=this.rooms[t].walls[e].wall)}if(0<Object.keys(o).length){if(1===Object.keys(o).length)return o[Object.keys(o)[0]];var e=Object.keys(o).sort((e,t)=>e-t).reverse();return o[e[0]]}return!1}getLinePlaceFurnitureOpposite(e,t,i,n){let s;t=i["s"===(s=are_points_equal(t.s,i.s)||are_points_equal(t.s,i.e)?"s":"e")?"e":"s"],i=i[s],t=LIB.pointOnLine(t,i,-n);return new j({s:i,e:t})}getLinePlaceFurniture(e,t,i,n){let s;t=i["s"===(s=are_points_equal(t.s,i.s)||are_points_equal(t.s,i.e)?"s":"e")?"e":"s"],i=i[s],i=LIB.pointOnLine(i,t,-n);return new j({s:t,e:i})}getLineStartWall(e,t,i){i=LIB.pointOnLine(t.e,t.s,-i);return new j({s:t.s,e:i})}getLineEndWall(e,t,i){i=LIB.pointOnLine(t.s,t.e,-i);return new j({s:t.e,e:i})}getWallNear(t,i,n){let s="s";for(let e=0;e<i.walls_s.length;e++)if(i.walls_s[e].wall==this.walls[n.id].index){s="e";break}let o=null;for(let e=0;e<i[s+"_walls"].length;e++)if(void 0!==this.rooms[t].walls_ids[walls.db[i[s+"_walls"][e].wall].id]){o=walls.db[i[s+"_walls"][e].wall];break}return null!==o&&o}getIntersectionDoor(t,i,n){for(let e=0;e<this.rooms[t].walls[i.index].doors.length;e++){var s=doors.db[this.rooms[t].walls[i.index].doors[e].index],o=get_big_line(new j({s:s.r1,e:s.l1}),100),l=get_big_line(new j({s:s.r2,e:s.l2}),100),o=line_and_line_intersection(o,n),l=line_and_line_intersection(l,n);if(!1!==o||!1!==l)return{point1:o,point2:l,door:s}}return!1}getIntersectionWindow(t,i,n){for(let e=0;e<this.rooms[t].walls[i.index].windows.length;e++){var s=windows.db[this.rooms[t].walls[i.index].windows[e].index],o=get_big_line(new j({s:s.r1,e:s.l1}),100),l=get_big_line(new j({s:s.r2,e:s.l2}),100),o=line_and_line_intersection(o,n),l=line_and_line_intersection(l,n);if(!1!==o||!1!==l)return{point1:o,point2:l,window:s}}return!1}getIntersectionDoorOpen(n,s){for(let i=0;i<this.rooms[n].walls.length;i++)for(let t=0;t<this.rooms[n].walls[i].doors.length;t++){let e=doors.db[this.rooms[n].walls[i].doors[t].index];if(void 0!==e.opening){var o=-1!==e.opening.indexOf("R")?"_inner":"_outer",l=point_near_line_end_point(e["s"+o],e["e"+o],e.width-5,-1!==e.opening.indexOf("R")?"R":"L"),r=point_near_line_end_point(e["e"+o],e["s"+o],e.width-5,-1!==e.opening.indexOf("R")?"L":"R"),a=new j({s:l,e:r}),l=new j({s:e["e"+o],e:l}),o=new j({s:e["s"+o],e:r});if(!1!==this.getIntersectionLineWithFurniture(a,s))return!0;if(!1!==this.getIntersectionLineWithFurniture(l,s))return!0;if(!1!==this.getIntersectionLineWithFurniture(o,s))return!0}}return!1}getIntersectionWindowWithFurniture(l,r,a){for(let o=0;o<this.rooms[l].walls.length;o++)if(o!==r.index)for(let s=0;s<this.rooms[l].walls[o].windows.length;s++){var h=windows.db[this.rooms[l].walls[o].windows[s].index],g=rooms2.data[this.rooms[l].index];let e,t,i=point_near_line_end_point(h.s,h.e,50+r.depth/2,"R"),n=(e=new j({s:h.e,e:i}),is_point_inside_polygon(i,g.polygon)||(i=point_near_line_end_point(h.s,h.e,50+r.depth/2,"L"),e=new j({s:h.e,e:i})),point_near_line_end_point(h.e,h.s,50+r.depth/2,"R"));if(t=new j({s:h.s,e:n}),is_point_inside_polygon(n,g.polygon)||(n=point_near_line_end_point(h.e,h.s,50+r.depth/2,"L"),t=new j({s:h.s,e:i})),g=new j({s:i,e:n}),!1!==this.getIntersectionLineWithFurniture(g,a))return!0;if(!1!==this.getIntersectionLineWithFurniture(e,a))return!0;if(!1!==this.getIntersectionLineWithFurniture(t,a))return!0}return!1}getIntersectionNearFurniture(e,t,i,n=40){var s=this.getWallOutside(e,this.rooms[e].walls[this.furniture[t].wall_id].wall),o=this.getFurniture(t),e=this.getLineSideWall(t,this.rooms[e].walls[this.furniture[t].wall_id].wall);if(!1===e)return console.warn("ошибка в getIntersectionNearFurniture"),!1;let l;t=n+ +o.props.height;let r=point_near_line_end_point(e.s,e.e,t,"R"),a=(line_and_line_intersection(s,new j({s:e.e,e:r}))&&(r=point_near_line_end_point(e.s,e.e,t,"L"),new j({s:e.e,e:r})),point_near_line_end_point(e.e,e.s,t,"R"));line_and_line_intersection(s,new j({s:e.s,e:a}))&&(a=point_near_line_end_point(e.e,e.s,t,"L"),new j({s:e.s,e:r}));n=get_point_near_line_center(e.e,e.s,t,"R");return line_and_line_intersection(s,l=new j({s:get_center(e.s,e.e),e:n}))&&(n=get_point_near_line_center(e.e,e.s,t,"L"),l=new j({s:get_center(e.s,e.e),e:n})),new j({s:r,e:a}),!1!==this.getIntersectionLineWithFurniture(l,i)}getWallOutside(e,t,i=5){var e=rooms2.data[this.rooms[e].index],n=this.getParallel(t,i,"L"),t=this.getParallel(t,i,"R");return is_point_inside_polygon(get_center(n.s,n.e),e.polygon)?t:n}getWallInside(e,t,i=5){var e=rooms2.data[this.rooms[e].index],n=this.getParallel(t,i,"L"),t=this.getParallel(t,i,"R");return is_point_inside_polygon(get_center(n.s,n.e),e.polygon)?n:t}getParallel(e,t,i){var n=point_near_line_end_point(e.s,e.e,t,i),e=point_near_line_end_point(e.e,e.s,t,"L"===i?"R":"L");return new j({s:n,e:e})}getIntersectionWallsWithFurniture(t,i,n=!1){for(let e=0;e<this.rooms[t].walls.length;e++){var s=this.getWallOutside(t,this.rooms[t].walls[e].wall);if(!1!==this.getIntersectionLineWithFurniture(s,i))return n&&(this.drawPoint(this.rooms[t].walls[e].wall.s,"#000"),this.drawPoint(this.rooms[t].walls[e].wall.e,"#000"),this.drawPoint(s.s,"#555"),this.drawPoint(s.e,"#555"),this.drawPoint(this.getIntersectionLineWithFurniture(s,i))),!0}return!1}getNearWallsWithFurniture(t,i,n=!1){let s=this.rooms[t].walls[this.furniture[i].wall_id].wall,e=this.getLineSideWall(i,s);if(s.length()-e.length()<100)return!1;for(let e=0;e<this.rooms[t].walls.length;e++)if(e!==s.index){var o=this.getWallInside(t,this.rooms[t].walls[e].wall,40);if(!1!==this.getIntersectionLineWithFurniture(o,i))return n&&(this.drawPoint(this.rooms[t].walls[e].wall.s,"#000"),this.drawPoint(this.rooms[t].walls[e].wall.e,"#000"),this.drawPoint(o.s,"#555"),this.drawPoint(o.e,"#555"),this.drawPoint(this.getIntersectionLineWithFurniture(o,i))),!0}return!1}getIntersectionLineWithFurniture(e,t){var t=this.getFurniture(t),i=new j({s:t.p1,e:t.p2}),n=new j({s:t.p2,e:t.p3}),s=new j({s:t.p3,e:t.p4}),t=new j({s:t.p4,e:t.p1});let o=line_and_line_intersection(e,i);return(!1!==o||!1!==(o=line_and_line_intersection(e,n))||!1!==(o=line_and_line_intersection(e,s))||!1!==(o=line_and_line_intersection(e,t)))&&o}getIntersectionFurniture(e,t){var e=this.getFurniture(e),t=this.getFurniture(t),i=[e.p1,e.p2,e.p3,e.p4],n=[t.p1,t.p2,t.p3,t.p4];for(let e=0;e<i.length;e++)if(is_point_inside_polygon(i[e],n))return!0;for(let e=0;e<n.length;e++)if(is_point_inside_polygon(n[e],i))return!0;return!1}showIntersectionWindowsDoors(e,t="#ff0000"){!1!==e&&(!1!==e.point1&&this.drawPoint(e.point1,t),!1!==e.point2&&this.drawPoint(e.point2,t))}drawPoint(e,t="#ff0000",i=8){svg.circle(i).cx(e.x).cy(e.y).attr({stroke:t,"stroke-width":1,fill:t})}drawLine(e,t="#ff0000",i=1){svg.line(e.s.x,e.s.y,e.e.x,e.e.y).attr({stroke:t,"stroke-width":i})}getIntersectionPoints(t){let i=[];for(let e=0;e<t.length;e++)!1!==t[e]&&(!1!==t[e].point1&&i.push(t[e].point1),!1!==t[e].point2&&i.push(t[e].point2));return i}getWallFromRoom(t,i,n){for(let e=0;e<this.rooms[t].walls.length;e++)if(e!==i.index&&(are_points_equal(this.rooms[t].walls[e].wall.s,n)||are_points_equal(this.rooms[t].walls[e].wall.e,n)))return this.rooms[t].walls[e].wall;return!1}getWallWithoutDoorsAndWindows(t,i=[],n={}){let s={};for(let e=0;e<i.length;e++)s[i[e]]="";let o={};for(let e=0;e<this.rooms[t].walls.length;e++)0<this.rooms[t].walls[e].doors.length||0<this.rooms[t].walls[e].windows.length||void 0!==s[e]||n.length_min&&this.rooms[t].walls[e].wall.length()<n.length_min||(o[this.rooms[t].walls[e].wall.length()]=this.rooms[t].walls[e].wall);if(0<Object.keys(o).length){if(1===Object.keys(o).length)return o[Object.keys(o)[0]];var e=Object.keys(o).sort((e,t)=>e-t).reverse();return o[e[0]]}return!1}getWallWithoutDoors(t,i=[],n={}){let s={};for(let e=0;e<i.length;e++)s[i[e]]="";for(let e=0;e<this.rooms[t].walls.length;e++){var o=e,l=this.rooms[t].walls[o].wall;if(!(0<this.rooms[t].walls[o].doors.length||void 0!==s[o]||n.length_min&&get_distance(l.s,l.e)<n.length_min))return l}return!1}getWallWithWindow(n,t=[],s={}){let o={};for(let e=0;e<t.length;e++)o[t[e]]="";for(let i=0;i<this.rooms[n].walls.length;i++)if(1===this.rooms[n].walls[i].windows.length&&void 0===o[i]){var l=this.rooms[n].walls[i].wall,r=windows.db[this.rooms[n].walls[i].windows[0].index];let e=null,t=null;e=get_distance(l.s,r.s)<get_distance(l.s,r.e)?new j({s:l.s,e:r.s}):new j({s:l.s,e:r.e}),t=get_distance(l.e,r.s)<get_distance(l.e,r.e)?new j({s:l.e,e:r.s}):new j({s:l.e,e:r.e});r=get_distance(e.s,e.e)>get_distance(t.s,t.e)?e:t;if(get_distance((r=new j({s:get_point_projection(r.s,l),e:get_point_projection(r.e,l)})).s,r.e)>s.length_min)return{wall:l,line:r}}return!1}getWallWithDoor(i,t=[],n={}){let s={};for(let e=0;e<t.length;e++)s[t[e]]="";for(let e=0;e<this.rooms[i].walls.length;e++){var o=e;if(1===this.rooms[i].walls[o].doors.length&&void 0===s[o]){var l=this.rooms[i].walls[o].wall,o=doors.db[this.rooms[i].walls[o].doors[0].index];let e=null,t=null;e=get_distance(l.s,o.s)<get_distance(l.s,o.e)?new j({s:l.s,e:o.s}):new j({s:l.s,e:o.e}),t=get_distance(l.e,o.s)<get_distance(l.e,o.e)?new j({s:l.e,e:o.s}):new j({s:l.e,e:o.e});o=get_distance(e.s,e.e)>get_distance(t.s,t.e)?e:t;if(get_distance((o=new j({s:get_point_projection(o.s,l),e:get_point_projection(o.e,l)})).s,o.e)>n.length_min)return{wall:l,line:o}}}return!1}getLineWallWithoutLine(e,t,i){let n=null,s=null;n=get_distance(t.s,i.s)<get_distance(t.s,i.e)?new j({s:t.s,e:i.s}):new j({s:t.s,e:i.e}),s=get_distance(t.e,i.s)<get_distance(t.e,i.e)?new j({s:t.e,e:i.s}):new j({s:t.e,e:i.e});i=get_distance(n.s,n.e)>get_distance(s.s,s.e)?n:s;return new j({s:get_point_projection(i.s,t),e:get_point_projection(i.e,t)})}getProjectionLineOnWall(e,t,i){return new j({s:get_point_projection(i.s,t),e:get_point_projection(i.e,t)})}deleteFurniture(t){for(let e=0;e<items.db.length;e++)if(items.db[e].props.id===t){items.db[e].delete();break}}}}),window.plan_button_clicked=!1;let tool_events={};function select_tool(e){tool=e,material="none","wall_create_pgb"===(tool="zone_ceiling"===(tool="zone_floor"===(tool="zone"===tool?"delimiter":tool)?"delimiter":tool)?"delimiter":tool)&&(tool="wall",material="pgb"),"wall_create_blocks"===tool&&(tool="wall",material="blocks"),"wall_create_bricks"===tool&&(tool="wall",material="bricks"),"wall_create_gypsum"===tool&&(tool="wall",material="gypsum"),"wall_create_glass"===tool&&(tool="wall",material="glass"),"wall_create_bar"===tool&&(tool="wall",material="bar"),"ai_wall"!==tool&&"ai_window"!==tool&&"ai_doorway"!==tool&&"ai_door"!==tool&&"ai_window_balcony"!==tool||($(".show_on_ai").removeClass("active"),$("#plannertool_"+tool).addClass("active"),$("body").css("cursor","crosshair")),tool_events[tool]?tool_events[tool]++:tool_events[tool]=1,"cable"!==tool&&"water"!==tool||$("body").css("cursor","pointer")}function change_group(e,t){if($("#planner_container").hasClass("plan_change"))return!1;var i,n=$("#groups_navi_wrapper .groups_navi_item[data-plan='"+e+"']"),s=$("body").attr("data-object-id");$("body").attr("data-authkey");if(!n.length)return!1;{if(close_v2_modal(),a_line.fire("hide"),o_sign.hide(),s_size.hide(),e_size.hide(),s_size_2.hide(),e_size_2.hide(),warning.hide(),"ai"!==plan||switch_plans)return plan=e,visibility.set(rename_plan(plan)),tool="none",tool_group="none",selected.wallPoint=null,newHide(),project.reset(),id.reset(),comments.hide(),$("#box_cables_socket_wrapper").hide(),$(".contextmenu").hide(50),$("#planner_ui_options").removeClass("active"),customCursor.fire("off"),pointJoystick.fire("off"),wallControls.fire("off"),wall_magnet.hide(),$(".tmp-btn").hide(),plan=rename_plan(plan),console.warn("plan after",plan),"ceiling"===plan&&$("#complex_ceiling").show(),i="init"===plan||"break"===plan||"build"===plan,plan_group=i?"A":"B",plan_button_clicked&&(project.localSave(),plan_button_clicked=!1),console.log("plan -",plan,"::: plan_group -",plan_group),visibility.sockets?$("#sockets_switch").addClass("active"):$("#sockets_switch").removeClass("active"),visibility.furniture?$("#furniture_switch").addClass("active"):$("#furniture_switch").removeClass("active"),void 0!==dimensionsSwitch[plan]?dimensionsSwitch[plan]?$("#dimensions_switch").addClass("active"):$("#dimensions_switch").removeClass("active"):"A"===plan_group?$("#dimensions_switch").addClass("active"):"B"===plan_group&&$("#dimensions_switch").removeClass("active"),"water"===plan?$("#build_pipe_santeh_button").show():$("#build_pipe_santeh_button").hide(),background.remove(),"A"===plan_group&&($("#fog").show(),setTimeout(function(){var e=function(){!0===project_loaded&&$("#fog").hide()};if(project.draw(),"build"===plan)for(let e=0;e<walls.db.length;e++){var t=walls.db[e],i=parseInt(get_line_length(t));if(i<10&&0===t.walls_s.length&&null===t.links.s&&0===t.walls_e.length&&null===t.links.e&&!0===t.part){t=l10n.drawing_has_small_walls.replace("[x]",i+" см");warning.show("yellow",t,1e4);break}}e()},50)),"B"===plan_group&&($("#fog").show(),setTimeout(function(){var e,t;e=function(){!0===project_loaded&&$("#fog").hide()},t=plan,"init"!==plan_previous&&"break"!==plan_previous||(plan="build",project.draw()),plan=t,project.draw(),e()},50)),(i=new Date).setTime(i.getTime()+2592e6),n.hasClass("locked")||setCookie("active_plan_name",e,i,"/"),s||t?!!$("#planner_container").attr("data-oid")&&($(".autoclose_on_plan_change").removeClass("active"),$("#groups_subnavi").removeClass("opened"),$("#groups_subnavi").removeClass("slideFastUp"),$(".options_preset").removeClass("slideFastLeft"),$("#planner_container").addClass("plan_change"),$("#groups_navi_wrapper .groups_navi_item").removeClass("active"),n.addClass("active"),$(".tools_item").removeClass("active"),$(".tools_item").removeClass("show"),$(".tools_item.show_on_"+e).addClass("show"),$(".filter_plan_item").addClass("hidden"),$(".filter_plan_item.show_on_"+e).removeClass("hidden"),$("#planner_ui_help .planner_ui_help_adbanner").removeClass("active"),$("#planner_ui_help .planner_ui_help_adbanner.show_on_"+e).addClass("active"),$(".planner_ui_video").removeClass("active"),$(".planner_ui_video.show_on_"+e).addClass("active"),$(".tools_more_item").removeClass("active"),$(".tools_more_item.show_on_"+e).addClass("active"),$(".display_none").css("display","none"),$(".display_block_on_"+e).css("display","block"),$(".display_inline_on_"+e).css("display","inline-block"),$(".display_block").css("display","block"),$(".display_inline").css("display","inline-block"),$(".display_none_on_"+e).css("display","none"),init_navi_bar(),ui_open_help(e),show_tracker(e),void setTimeout(function(){$("#planner_container").removeClass("plan_change")},500)):!(window.location.href="/planner_v2/");warning.show("yellow",l10n.stop_recognition_process,2e3)}}function sleep(t){return new Promise(e=>setTimeout(e,t))}$(function(){window.get_tool_settings=function(e){for(var t in tools)if(t===e)return tools[t]},$("#planner_header").find(".groups_navi_item").on("click",function(){plan_button_clicked=!0}),$(document).on("click","#planner_ui_tools_wrapper .tools_item, #planner_ui_admin .tools_item, #planner_ui_tools_wrapper .subtools_item",function(e){if($(this).hasClass("tools_item")||$(this).hasClass("subtools_item")){$(this).hasClass("tools_item")&&deactivate_current_tool_menuitem();{if($(this).hasClass("is_pro"))return tool_deactivate(),!1;allow.draw=!1,newHide(),project.reset(),project.paint(),customCursor.fire("off"),pointJoystick.fire("off");let t;"delimiter"===tool?t={}:(t=get_tool_settings(tool))&&t.group&&(tool_group=t.group);for(let e=0;e<outer_room_items.length;e++)tool===outer_room_items[e]&&(t.name=outer_room_items[e],baselines.create());function i(e){$("#pillar_width").val(""),$("#pillar_width").attr("placeholder",e)}function n(e){$("#pillar_height").val(""),$("#pillar_height").attr("placeholder",e)}function s(e){$("#door_width").val(""),$("#door_width").attr("placeholder",e)}function o(e){$("#door_height").val(""),$("#door_height").attr("placeholder",e)}t&&""===t.path&&(t.path=get_pseudo_tool_path(t.width,t.height)),console.log("tool -",tool,"::: tool_group -",tool_group,"::: settings",t),$("#planner_ui_options").removeClass("active"),magnets2.hide(),warning.hide(),"wall"!==tool&&"balcony"!==tool||(wall_magnet.move(-1e4,-1e4).show(),drawing=!1,panning=!1),"delimiter"===tool&&(zoneDelimiter.S.move(-1e4,-1e4).show(),drawing=!1,panning=!1),"break"!==tool&&"break_door"!==tool||(mouse.down.reset(),drawing=!1,panning=!1,customCursor.fire("on",e),customCursor.settings=Object.assign({},t)),"break_part"===tool&&($("body").css("cursor","default"),walls.get_axis_lines()),"walls"===tool_group&&("pillar"===tool&&($("#planner_ui_options").addClass("active"),$("#options_preset_column").show(),i(defs.pillar.width),n(defs.pillar.height),tool="pillar",cursors.pillar.fire("init")),tool,"air"===tool&&($("#planner_ui_options").addClass("active"),$("#options_preset_column").show(),i(defs.pillar_air.width),n(defs.pillar_air.height),tool="pillar_air",cursors.pillar_air.fire("init")),"water"===tool&&(tool="pillar_water",cursors.pillar_water.fire("init")),"gypsum_box"===tool&&($("#planner_ui_options").addClass("active"),$("#options_preset_column").show(),i(defs.gypsum_box.width),n(defs.gypsum_box.height),cursors.pillar.fire("init"))),"windows"===tool_group&&($("#planner_ui_options").addClass("active"),"window"===tool&&($("#options_preset_window").show(),$("#window_width").val(""),$("#window_width").attr("placeholder",defs.window.width),$("#window_height").val(""),$("#window_height").attr("placeholder",defs.window.height),$("#window_floor_height").val(""),$("#window_floor_height").attr("placeholder",defs.window.floor_height),$("#window_slopes").val(""),$("#window_slopes").attr("placeholder",defs.window.slopes),tool="window",window_custom_options=t.custom_options,cursors.window.fire("init",{settings:Object.assign({},t)})),"window_balcony"===tool&&($("#windoor_window_width").val(""),$("#windoor_window_width").attr("placeholder",defs.windoor.window_width),$("#windoor_window_height").val(""),$("#windoor_window_height").attr("placeholder",defs.windoor.window_height),$("#windoor_door_width").val(""),$("#windoor_door_width").attr("placeholder",defs.windoor.door_width),$("#windoor_door_height").val(""),$("#windoor_door_height").attr("placeholder",defs.windoor.door_height),$("#windoor_slopes").val(""),$("#windoor_slopes").attr("placeholder",defs.windoor.slopes),$("#options_preset_balcony").show(),tool="windoor",cursors.window.fire("init",{settings:Object.assign({},t)}))),"doors"===tool_group&&($("#planner_ui_options").addClass("active"),"doorway"===tool&&($("#options_preset_door").show(),s(defs.doorway.width),o(defs.doorway.height),tool="doorway",cursors.door.fire("init",{settings:Object.assign({},t)})),"door"===tool&&($("#options_preset_door").show(),s(defs.door.width),o(defs.door.height),tool="door",cursors.door.fire("init",{settings:Object.assign({},t)})),"door_double"===tool&&($("#options_preset_door").show(),s(defs.door_double.width),o(defs.door_double.height),tool="door_double",cursors.door.fire("init",{settings:Object.assign({},t)})),"door_coupe"===tool&&($("#options_preset_door").show(),s(defs.door_coupe.width),o(defs.door_coupe.height),tool="door_coupe",cursors.door.fire("init",{settings:Object.assign({},t)})),"door_penal"===tool&&($("#options_preset_door").show(),s(defs.door_penal.width),o(defs.door_penal.height),tool="door_penal",cursors.door.fire("init",{settings:Object.assign({},t)}))),"stairs"===tool_group&&($("#planner_ui_options").addClass("active"),$("#options_preset_furniture").show(),$("#furniture_width_wrap").show(),$("#furniture_depth_wrap").show(),$("#furniture_width").val("").attr("placeholder",t.width),$("#furniture_depth").val("").attr("placeholder",t.height),t.stroke_color="#000000","build"===plan&&(t.stroke_color=colors.pgb),cursors.own.fire("init",{settings:Object.assign({},t)}),cursor_group="icons"),"demount"===tool_group&&"break_part"!==tool&&(customCursor.fire("on",e),customCursor.settings=Object.assign({},t)),"furniture"===tool_group&&($("#planner_ui_options").addClass("active"),$("#furniture_width_wrap").show(),$("#furniture_depth_wrap").show(),$("#options_preset_furniture").show(),t.show_sizes&&(r=!1===t.show_sizes.width,l=!1===t.show_sizes.height,r&&$("#furniture_width_wrap").hide(),l&&$("#furniture_depth_wrap").hide(),r&&l&&($("#planner_ui_options").removeClass("active"),$("#options_preset_furniture").hide())),$("#furniture_width").val("").attr("placeholder",t.width),$("#furniture_depth").val("").attr("placeholder",t.height),"ventilation_hole"===tool?(cursors.own.fire("init2",{target:"ventHole",settings:Object.assign({},t)}),cursor_group="icons",$("#furniture_width").val("").attr("placeholder",t.width),$("#furniture_depth_wrap").hide()):"break_radiator"===tool||"break_electric_shield"===tool?(customCursor.fire("on",e),customCursor.settings=Object.assign({},t)):(cursors.own.fire("init",{settings:Object.assign({},t)}),cursor_group="icons")),"sockets"===tool_group&&(t.plan.hasOwnProperty("sockets_lowcurrent")&&(t.plan.sockets_lowcurrent=1),t.plan.hasOwnProperty("warm_floor")&&(t.plan.warm_floor=1),cursors.own.fire("init",{settings:Object.assign({},t)}),cursor_group="icons"),"lights"!==tool_group&&"switches"!==tool_group&&"waterspots"!==tool_group&&"wires"!==tool_group||"cable"!==tool&&(cursors.own.fire("init",{settings:Object.assign({},t)}),cursor_group="icons"),"floor_elements"!==tool_group&&"molding"!==tool_group||(t.anchor="none","laminate"===tool&&(t.filling="#32bb33"),"linoleum"===tool&&(t.filling="#bd38bb"),"fitted_carpet"===tool&&(t.filling="#6163bc"),"floor_tile"===tool&&(t.filling="#dbd91d"),"parquet_board"===tool&&(t.filling="#fdaaab"),"wood_board"===tool&&(t.filling="#8bdddc"),"remove_flooring"===tool&&(t.filling="crimson"),"hydro_smearing"===tool&&(t.filling="grey"),"hydro_rolling"===tool&&(t.filling="green"),"hydro_melting"===tool&&(t.filling="orange"),customCursor.fire("on",e),customCursor.settings=Object.assign({},t),cursor_group="lines"),"wall_elements"===tool_group&&"molding"===tool&&(tool="ceiling_molding",tool_group="ceiling_elements",customCursor.fire("on",e),customCursor.settings=Object.assign({},t),cursor_group="lines");var l,r=["remove_flooring","remove_break","wall_cover_remove","remove_isolation","remove_plaster","ceiling_remove"];in_array(tool,r)&&(tool="eraser",tool_group="none",customCursor.fire("on",e)),"wall_elements"===tool_group&&(t.anchor="none",customCursor.fire("on",e),customCursor.settings=Object.assign({},t),cursor_group="lines"),"ceiling_elements"===tool_group&&(t.anchor="none",customCursor.fire("on",e),customCursor.settings=Object.assign({},t))}}})});